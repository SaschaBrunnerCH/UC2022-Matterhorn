var D=Object.defineProperty,z=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var A=(a,t,e)=>t in a?D(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,E=(a,t)=>{for(var e in t||(t={}))W.call(t,e)&&A(a,e,t[e]);if(w)for(var e of w(t))P.call(t,e)&&A(a,e,t[e]);return a},g=(a,t)=>z(a,O(t));import{H as d,M as m,fB as S,bi as T,mB as B,cR as b,js as R,b9 as G,bT as N,c4 as U,a6 as V,at as q,B as u,D as p,E as X,F as $,mC as y,fg as Y,mD as j}from"./vendor.fe24faac.js";import{r as C}from"./drawUtils.f401567c.js";function H(a,t){let e=null,n=null;return i=>{if(i.action==="cancel")return void(d(n)&&(n.execute({action:"cancel"}),e=null,n=null));const r={action:i.action,screenStart:i.start,screenEnd:i.screenPoint};i.action==="start"&&m(e)&&(e=new _,n=new _,t(a,e,n,i.pointerType,r)),d(e)&&e.execute(r),i.action==="end"&&d(e)&&(e=null,n=null)}}function ot(a,t){return a.events.on("drag",H(a,t))}function st(a,t){const e=[a.x,a.y,a.z],n=t,i=[Math.cos(n),Math.sin(n)],r=Math.sqrt(i[0]*i[0]+i[1]*i[1]);if(r===0)return null;i[0]/=r,i[1]/=r;const o=s=>{const l=(s.x-e[0])*i[0]+(s.y-e[1])*i[1];s.x=e[0]+l*i[0],s.y=e[1]+l*i[1]};return s=>(o(s.mapStart),o(s.mapEnd),s)}function Z(a,t){let e=null;return n=>{if(n.action==="start"&&(e=L(a,n.mapStart.spatialReference,t)),m(e))return null;const i=n.mapEnd.x-n.mapStart.x,r=n.mapEnd.y-n.mapStart.y,o=n.mapEnd.z-n.mapStart.z;return e.move(i,r,o),g(E({},n),{translationX:i,translationY:r,translationZ:o})}}function I(a,t){return m(a)?null:a.spatialReference.equals(t)?a.clone():b(a,t)}function L(a,t,e){const n=a.geometry;if(m(n))return null;if(n.type==="mesh")return k(a,n,t,e);const i=I(n,t),r=n.spatialReference;return m(i)?null:{move:(o,s,l)=>{const h=C(i.clone(),o,s,l);h.spatialReference.equals(r)?a.geometry=h:a.geometry=b(h,r)}}}function k(a,t,e,n){if(d(t.transform))return J(a,t,t.transform,e);if(!t.spatialReference.equals(e))return null;let i=0,r=0,o=0;return{move:(s,l,h)=>{const f=s-i,x=l-r,M=h-o;if(f||x||M){const F=new G(t.origin.x+f,t.origin.y+x,t.origin.z+M,t.origin.spatialReference);t.centerAt(F,{geographic:n===N.Global}),a.notifyGeometryChanged(),i=s,r=l,o=h}}}}function J(a,t,e,n){const i=I(e.getOriginPoint(t.spatialReference),n),r=t.spatialReference;return m(i)?null:{move:(o,s,l)=>{const h=C(i.clone(),o,s,l);if(h.spatialReference.equals(r))e.origin=R(h.x,h.y,h.z);else{const f=b(h,r);d(f)&&(e.origin=R(f.x,f.y,f.z))}a.notifyMeshTransformChanged(),a.notifyGeometryChanged()}}}function lt(a,t){const e=a.map(n=>T(Z(n,t))).filter(n=>d(n));return n=>{const i=n.mapEnd.x-n.mapStart.x,r=n.mapEnd.y-n.mapStart.y,o=n.mapEnd.z-n.mapStart.z;return e.forEach(s=>s(n)),g(E({},n),{translationX:i,translationY:r,translationZ:o})}}function K(a,t){const e=new Map;for(const n of t)e.set(n,U(a[n]));return n=>(e.forEach((i,r)=>{a[r]=i}),n)}function Q(a){return d(a.geometry)&&a.geometry.type==="mesh"?tt(a,a.geometry):K(a,["geometry"])}function tt(a,t){const e=d(t.transform)?t.transform.clone():null,n=t.vertexAttributes.clonePositional();return i=>(t.transform=e,t.vertexAttributes=n,a.notifyGeometryChanged(),i)}function ct(a){const t=a.map(e=>T(Q(e))).filter(e=>d(e));return e=>(t.forEach(n=>n(e)),e)}function ut(){let a=0,t=0,e=0;return n=>{n.action==="start"&&(a=n.mapStart.x,t=n.mapStart.y,e=n.mapStart.z);const i=n.mapEnd.x-a,r=n.mapEnd.y-t,o=n.mapEnd.z-e;return a=n.mapEnd.x,t=n.mapEnd.y,e=n.mapEnd.z,g(E({},n),{mapDeltaX:i,mapDeltaY:r,mapDeltaZ:o,mapDeltaSpatialReference:n.mapStart.spatialReference})}}function ht(){let a=0,t=0;return e=>{e.action==="start"&&(a=e.screenStart.x,t=e.screenStart.y);const n=e.screenEnd.x-a,i=e.screenEnd.y-t;return a=e.screenEnd.x,t=e.screenEnd.y,g(E({},e),{screenDeltaX:n,screenDeltaY:i})}}function pt(a,t){let e=null,n=0,i=0;return r=>{if(r.action==="start"&&(e=a.toScreen(t),e.x<0||e.x>a.width||e.y<0||e.y>a.height?e=null:(n=r.screenStart.x-e.x,i=r.screenStart.y-e.y)),e==null)return null;const o=S(r.screenEnd.x-n,0,a.width),s=S(r.screenEnd.y-i,0,a.height),l=B(o,s);return r.screenStart=e,r.screenEnd=l,r}}class _{constructor(){this.execute=()=>{}}next(t,e=new _){return d(t)&&(this.execute=n=>{const i=t(n);d(i)&&e.execute(i)}),e}}var v;(function(a){a[a.WhenToolEditable=0]="WhenToolEditable",a[a.WhenToolNotEditable=1]="WhenToolNotEditable",a[a.Always=2]="Always"})(v||(v={}));class et{constructor(){this._isToolEditable=!0,this._manipulators=new V,this._nextManipulatorId=0,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(t){this._isToolEditable=t}get length(){return this._manipulators.length}add(t,e=v.WhenToolEditable){return this.addMany([t],e)[0]}addMany(t,e=v.WhenToolEditable){return t.map(n=>{const i=this._nextManipulatorId++,r={id:i,manipulator:n,visibilityPredicate:e,attached:!1};return this._manipulators.add(r),this._attached&&this._updateManipulatorAttachment(r),i})}remove(t){if(typeof t=="number"){const n=t;for(let i=0;i<this._manipulators.length;i++)if(this._manipulators.getItemAt(i).id===n){const r=this._manipulators.splice(i,1)[0];return this._detachManipulator(r),r.id}return null}const e=t;for(let n=0;n<this._manipulators.length;n++)if(this._manipulators.getItemAt(n).manipulator===e){const i=this._manipulators.splice(n,1)[0];return this._detachManipulator(i),i.id}return null}removeAll(){this._manipulators.forEach(t=>{this._detachManipulator(t)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(t=>{this._updateManipulatorAttachment(t)}),this._attached=!0}detach(){this._manipulators.forEach(t=>{this._detachManipulator(t)}),this._attached=!1}destroy(){this._manipulators.forEach(({manipulator:t})=>{t.destroy&&t.destroy()}),this._manipulators.destroy(),this._resourceContexts=null}on(t,e){return this._manipulators.on(t,n=>{e(n)})}forEach(t){for(const e of this._manipulators.items)t(e)}some(t){return this._manipulators.items.some(t)}toArray(){const t=[];return this.forEach(e=>t.push(e.manipulator)),t}intersect(t,e){let n=null,i=Number.MAX_VALUE;return this._manipulators.forEach(({id:r,manipulator:o,attached:s})=>{if(!s||!o.interactive)return;const l=o.intersectionDistance(t,e);d(l)&&l<i&&(i=l,n={id:r,manipulator:o})}),n}findById(t){if(m(t))return null;for(const e of this._manipulators.items)if(t===e.id)return e.manipulator;return null}_updateManipulatorAttachment(t){this._isManipulatorItemVisible(t)?this._attachManipulator(t):this._detachManipulator(t)}_attachManipulator(t){t.attached||(t.manipulator.attach&&t.manipulator.attach(this._resourceContexts),t.attached=!0)}_detachManipulator(t){if(!t.attached)return;const e=t.manipulator;e.grabbing=!1,e.dragging=!1,e.hovering=!1,e.selected=!1,e.detach&&e.detach(this._resourceContexts),t.attached=!1}_isManipulatorItemVisible(t){return t.visibilityPredicate===v.Always||(this._isToolEditable?t.visibilityPredicate===v.WhenToolEditable:t.visibilityPredicate===v.WhenToolNotEditable)}}const at=q.getLogger("esri.views.interactive.InteractiveToolBase");let c=class extends ${constructor(a){super(a),this.manipulators=new et,this.preferManipulatorCursor=!1,this.automaticManipulatorSelection=!0,this.hasFocusedManipulators=!1,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[y.MANAGER,!0],[y.USER,!0]]),this._creationFinishedResolver=Y()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(a){this._get("visible")!==a&&(this._set("visible",a),this._syncVisible())}get editable(){return this.getEditableFlag(y.USER)}set editable(a){this.setEditableFlag(y.USER,a)}get updating(){return!1}get cursor(){return null}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){m(this.view)?at.error("Can't activate tool if view is not defined."):(j(this.view)&&this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(a){this.onInputEvent(a)}handleInputEventAfter(a){this.onInputEventAfter(a)}setEditableFlag(a,t){this._editableFlags.set(a,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),a===y.USER&&this.notifyChange("editable"),this.onEditableChange()}getEditableFlag(a){return this._editableFlags.get(a)}whenCreated(){return this._creationFinishedResolver.promise}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(a){}onInputEventAfter(a){}get internallyEditable(){return this.getEditableFlag(y.USER)&&this.getEditableFlag(y.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.constructed){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};u([p({constructOnly:!0})],c.prototype,"view",void 0),u([p({readOnly:!0})],c.prototype,"active",null),u([p({value:!0})],c.prototype,"visible",null),u([p({value:!0})],c.prototype,"editable",null),u([p({readOnly:!0})],c.prototype,"manipulators",void 0),u([p({readOnly:!0})],c.prototype,"updating",null),u([p()],c.prototype,"cursor",null),u([p({readOnly:!0})],c.prototype,"preferManipulatorCursor",void 0),u([p({readOnly:!0})],c.prototype,"automaticManipulatorSelection",void 0),u([p()],c.prototype,"hasFocusedManipulators",void 0),u([p({readOnly:!0})],c.prototype,"created",void 0),u([p({readOnly:!0})],c.prototype,"removeIncompleteOnCancel",void 0),c=u([X("esri.views.interactive.InteractiveToolBase")],c);export{pt as C,ut as D,_ as G,ct as M,lt as R,ht as b,c,st as d,ot as p,Q as w,Z as x,K as z};
