import{B as u,D as g,E as _,gq as S,aE as E,js as G,nD as D,pB as Y,mZ as k,mr as z,eL as m,eI as b,pC as h,ga as L,pD as j,f9 as C,pE as A,bu as H,pF as J,pG as U,pH as V,b9 as W,H as d,lA as K,pI as Q,lq as M,mS as Z,pJ as X,pK as B,M as f,pL as x,mn as y,pM as tt,pN as nt,d0 as rt,aw as et,kz as at,mg as ot,pO as it,pP as st,pQ as lt,pR as pt,pS as ct,pT as ut}from"./vendor.fe24faac.js";import{a as N,l as gt,x as ft}from"./axisAngleDegrees.a0167a56.js";var F;let c=F=class extends S{constructor(t){super(t),this.origin=E(),this.translation=E(),this.rotation=N(),this.scale=G(1,1,1),this.geographic=!0}get localMatrix(){const t=m();return D(t,this.scale),Y(t,t,ft(this.rotation),gt(this.rotation)),k(t,t,this.translation),t}get localMatrixInverse(){return z(m(),this.localMatrix)}applyLocal(t,r){return b(r,t,this.localMatrix)}applyLocalInverse(t,r){return b(r,t,this.localMatrixInverse)}project(t,r){const n=new Float64Array(t.length),e=h.fromTypedArray(n),a=h.fromTypedArray(t);if(this.geographic){const s=L(r),p=m();return j(r,this.origin,p,s),C(p,p,this.localMatrix),A(e,a,p),H(n,s,0,n,r,0,n.length/3),n}const{localMatrix:o,origin:i}=this;J(o,U)?V(e,a):A(e,a,o);for(let s=0;s<n.length;s+=3)n[s+0]+=i[0],n[s+1]+=i[1],n[s+2]+=i[2];return n}getOriginPoint(t){const[r,n,e]=this.origin;return new W({x:r,y:n,z:e,spatialReference:t})}equals(t){return d(t)&&this.geographic===t.geographic&&K(this.origin,t.origin)&&Q(this.localMatrix,t.localMatrix)}clone(){const t={origin:M(this.origin),translation:M(this.translation),rotation:N(this.rotation),scale:M(this.scale),geographic:this.geographic};return new F(t)}};u([g({type:[Number],nonNullable:!0,json:{write:!0}})],c.prototype,"origin",void 0),u([g({type:[Number],nonNullable:!0,json:{write:!0}})],c.prototype,"translation",void 0),u([g({type:[Number],nonNullable:!0,json:{write:!0}})],c.prototype,"rotation",void 0),u([g({type:[Number],nonNullable:!0,json:{write:!0}})],c.prototype,"scale",void 0),u([g({type:Boolean,nonNullable:!0,json:{write:!0}})],c.prototype,"geographic",void 0),u([g()],c.prototype,"localMatrix",null),u([g()],c.prototype,"localMatrixInverse",null),c=F=u([_("esri.geometry.support.MeshTransform")],c);const ht=c;function w(t,r){var n;return t.isGeographic||t.isWebMercator&&((n=r==null?void 0:r.geographic)!=null?n:!0)}function P(t,r,n){return w(r.spatialReference,n)?xt(t,r,n):At(t,r,n)}function yt(t,r,n){const{position:e,normal:a,tangent:o}=t;if(f(r))return{position:e,normal:a,tangent:o};const i=r.localMatrix;return P({position:pt(e,new Float64Array(e.length),i),normal:d(a)?ct(a,new Float32Array(a.length),i):null,tangent:d(o)?ut(o,new Float32Array(o.length),i):null},r.getOriginPoint(n),{geographic:r.geographic})}function Nt(t,r,n){var e;if(n==null?void 0:n.useTransform){const{position:a,normal:o,tangent:i}=t;return{vertexAttributes:{position:a,normal:o,tangent:i},transform:new ht({origin:[r.x,r.y,(e=r.z)!=null?e:0],geographic:w(r.spatialReference,n)})}}return{vertexAttributes:P(t,r,n),transform:null}}function mt(t,r,n){return w(r.spatialReference,n)?q(t,r,n):R(t,r,n)}function zt(t,r,n,e){if(f(r))return mt(t,n,e);const a=yt(t,r,n.spatialReference);return n.equals(r.getOriginPoint(n.spatialReference))?R(a,n,e):w(n.spatialReference,e)?q(a,n,e):R(a,n,e)}function At(t,r,n){const e=new Float64Array(t.position.length),a=t.position,o=r.x,i=r.y,s=r.z||0,{horizontal:p,vertical:T}=v(n?n.unit:null,r.spatialReference);for(let l=0;l<a.length;l+=3)e[l+0]=a[l+0]*p+o,e[l+1]=a[l+1]*p+i,e[l+2]=a[l+2]*T+s;return{position:e,normal:t.normal,tangent:t.tangent}}function xt(t,r,n){const e=r.spatialReference,a=I(r,n,$),o=new Float64Array(t.position.length),i=wt(t.position,a,e,o),s=B(O,a);return{position:i,normal:Tt(i,o,t.normal,s,e),tangent:Mt(i,o,t.tangent,s,e)}}function wt(t,r,n,e){A(h.fromTypedArray(e),h.fromTypedArray(t),r);const a=new Float64Array(t.length);return X(e,a,n)}function Tt(t,r,n,e,a){if(f(n))return null;const o=new Float32Array(n.length);return x(y.fromTypedArray(o),y.fromTypedArray(n),e),tt(o,t,r,a,o),o}function Mt(t,r,n,e,a){if(f(n))return null;const o=new Float32Array(n.length);x(y.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT),y.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT),e);for(let i=3;i<o.length;i+=4)o[i]=n[i];return nt(o,t,r,a,o),o}function R(t,r,n){const e=new Float64Array(t.position.length),a=t.position,o=r.x,i=r.y,s=r.z||0,{horizontal:p,vertical:T}=v(n?n.unit:null,r.spatialReference);for(let l=0;l<a.length;l+=3)e[l+0]=(a[l+0]-o)/p,e[l+1]=(a[l+1]-i)/p,e[l+2]=(a[l+2]-s)/T;return{position:e,normal:t.normal,tangent:t.tangent}}function q(t,r,n){const e=r.spatialReference;I(r,n,$);const a=z($t,$),o=new Float64Array(t.position.length),i=dt(t.position,e,a,o),s=B(O,a);return{position:i,normal:Ft(t.normal,t.position,o,e,s),tangent:Rt(t.tangent,t.position,o,e,s)}}function I(t,r,n){j(t.spatialReference,[t.x,t.y,t.z||0],n,L(t.spatialReference));const{horizontal:e,vertical:a}=v(r?r.unit:null,t.spatialReference);return Z(n,n,[e,e,a]),n}function dt(t,r,n,e){const a=it(t,r,e),o=h.fromTypedArray(a),i=new Float64Array(a.length),s=h.fromTypedArray(i);return A(s,o,n),i}function Ft(t,r,n,e,a){if(f(t))return null;const o=st(t,r,n,e,new Float32Array(t.length)),i=y.fromTypedArray(o);return x(i,i,a),o}function Rt(t,r,n,e,a){if(f(t))return null;const o=lt(t,r,n,e,new Float32Array(t.length)),i=y.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT);return x(i,i,a),o}function v(t,r){if(f(t))return vt;const n=r.isGeographic?1:rt(r),e=r.isGeographic?1:et(r),a=at(1,t,"meters");return{horizontal:a*n,vertical:a*e}}const $=m(),$t=m(),O=ot(),vt={horizontal:1,vertical:1};export{ht as L,mt as M,zt as P,yt as _,Nt as k,w as r,P as x};
