var m=Object.defineProperty,A=Object.defineProperties;var v=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var w=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var d=(e,r,a)=>r in e?m(e,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[r]=a,T=(e,r)=>{for(var a in r||(r={}))w.call(r,a)&&d(e,a,r[a]);if(I)for(var a of I(r))b.call(r,a)&&d(e,a,r[a]);return e},f=(e,r)=>A(e,v(r));import{aY as W,cS as F,cL as C,a6 as V}from"./vendor.fe24faac.js";import{a as n}from"./lazyLayerLoader.91d8dd2d.js";import{selectLayerClassPath as O}from"./portalLayers.a897ae4e.js";import"./layersLoader.6c8b0171.js";import"./jsonContext.2a78aab2.js";import"./portalItemUtils.b2245a1d.js";function B(e){return g(e,"notes")}function h(e){return g(e,"route")}function g(e,r){return!(!e.layerType||e.layerType!=="ArcGISFeatureLayer")&&e.featureCollectionType===r}async function U(e,r,a){if(!r)return;const y=[];for(const t of r){const i=J(t,a);t.layerType==="GroupLayer"?y.push(j(i,t,a)):y.push(i)}const L=await W(y);for(const t of L)!t.value||a.filter&&!a.filter(t.value)||e.add(t.value)}const D={ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",PointCloudLayer:"PointCloudLayer",ArcGISSceneServiceLayer:"SceneLayer",IntegratedMeshLayer:"IntegratedMeshLayer",OGCFeatureLayer:"OGCFeatureLayer",BuildingSceneLayer:"BuildingSceneLayer",ArcGISTiledElevationServiceLayer:"ElevationLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",GroupLayer:"GroupLayer",GeoJSON:"GeoJSONLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",VectorTileLayer:"VectorTileLayer",WFS:"WFSLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer",KML:"KMLLayer",RasterDataLayer:"UnsupportedLayer",Voxel:"VoxelLayer",LineOfSightLayer:"LineOfSightLayer"},x={ArcGISTiledElevationServiceLayer:"ElevationLayer",DefaultTileLayer:"ElevationLayer",RasterDataElevationLayer:"UnsupportedLayer"},E={ArcGISTiledMapServiceLayer:"TileLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",OpenStreetMap:"OpenStreetMapLayer",WebTiledLayer:"WebTileLayer",VectorTileLayer:"VectorTileLayer",ArcGISImageServiceLayer:"UnsupportedLayer",WMS:"UnsupportedLayer",ArcGISMapServiceLayer:"UnsupportedLayer",DefaultTileLayer:"TileLayer"},R={ArcGISAnnotationLayer:"UnsupportedLayer",ArcGISDimensionLayer:"UnsupportedLayer",ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISStreamLayer:"StreamLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",CSV:"CSVLayer",DefaultTileLayer:"TileLayer",GeoRSS:"GeoRSSLayer",GeoJSON:"GeoJSONLayer",GroupLayer:"GroupLayer",KML:"KMLLayer",OGCFeatureLayer:"OGCFeatureLayer",SubtypeGroupLayer:"UnsupportedLayer",VectorTileLayer:"VectorTileLayer",WFS:"WFSLayer",WMS:"WMSLayer",WebTiledLayer:"WebTileLayer"},k={ArcGISFeatureLayer:"FeatureLayer"},N={ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",VectorTileLayer:"VectorTileLayer",WebTiledLayer:"WebTileLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer"};async function J(e,r){return K(await P(e,r),e,r)}async function K(e,r,a){const y=new e;return y.read(r,a.context),y.type==="group"&&G(r)&&await Y(y,r,a.context),await F(y,a.context),y}async function P(e,r){const a=r.context,y=H(a);let L=e.layerType||e.type;!L&&r&&r.defaultLayerType&&(L=r.defaultLayerType);const t=y[L];let i=t?n[t]:n.UnknownLayer;if(M(e)){const s=a==null?void 0:a.portal;if(e.itemId){const o=new C({id:e.itemId,portal:s});await o.load();const c=(await O(o)).className||"UnknownLayer";i=n[c]}}else L==="ArcGISFeatureLayer"?B(e)?i=n.MapNotesLayer:h(e)?i=n.RouteLayer:G(e)&&(i=n.GroupLayer):e.wmtsInfo&&e.wmtsInfo.url&&e.wmtsInfo.layerIdentifier?i=n.WMTSLayer:L==="WFS"&&e.wfsInfo.version!=="2.0.0"&&(i=n.UnsupportedLayer);return i()}function G(e){var r,a,y;return e.layerType!=="ArcGISFeatureLayer"||M(e)?!1:((y=(a=(r=e.featureCollection)==null?void 0:r.layers)==null?void 0:a.length)!=null?y:0)>1}function M(e){return e.type==="Feature Collection"}function H(e){let r;if(e.origin==="web-scene")switch(e.layerContainerType){case"basemap":r=E;break;case"ground":r=x;break;default:r=D}else switch(e.layerContainerType){case"basemap":r=N;break;case"tables":r=k;break;default:r=R}return r}async function j(e,r,a){const y=new V,L=U(y,Array.isArray(r.layers)?r.layers:[],a),t=await e;if(await L,t.type==="group")return t.layers.addMany(y),t}async function Y(e,r,a){const y=n.FeatureLayer,L=await y(),t=r.featureCollection,i=t.showLegend,s=t.layers.map((o,c)=>{var S,u;const l=new L;l.read(o,a);const p=f(T({},a),{ignoreDefaults:!0});return l.read({id:`${e.id}-sublayer-${c}`,visibility:(u=(S=r.visibleLayers)==null?void 0:S.includes(c))!=null?u:!0},p),i!=null&&l.read({showLegend:i},p),l});e.layers.addMany(s)}export{U as populateOperationalLayers};
