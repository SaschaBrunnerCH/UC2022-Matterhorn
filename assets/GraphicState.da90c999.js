import{j as u,fF as H,ku as c,qI as U,jZ as q,kw as D,O as k,W as N,X as j,B as p,D as w,E as x,F as L,H as d,M as h,dd as $,aF as Y,eD as K,ah as I,jR as W,kv as A,f_ as E,lv as X,b5 as Z,d6 as P,bi as J,r5 as Q,b7 as ee,b8 as te,lw as T,r6 as se,ly as R,dh as re,lx as F,az as ie,eA as M,fm as oe,bu as ne,r7 as ae,fX as le,es as he,r8 as ce,aE as V}from"./vendor.fe24faac.js";import{V as B}from"./ExtendedLineVisualElement.eb8b9919.js";import{u as de,_ as ue}from"./VisualElementResources.9d2c136d.js";const r={main:new u([255,127,0]),selected:new u([255,255,255]),staged:new u([12,207,255]),outline:new u([0,0,0,.5]),selectedOutline:new u([255,255,255])},O=.3;function C(o,e){const s=o.clone();return s.a*=e,s}function pe(o,e){const s=o.clone(),t=U(s);t.s*=e;const i=q(t);return s.r=i.r,s.g=i.g,s.b=i.b,s}function l(o,e){if(e)for(const s in e)o[s]=e[s]}class _e{constructor(e){this.color=r.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=c.Opaque,l(this,e)}}class G{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=r.main,this.outlineColor=r.outline,this.renderOccluded=c.Opaque,this.hoverOutlineColor=r.selectedOutline,l(this,e)}apply(e,s){const t=this[e];s.setParameters({color:_(t),transparent:e!=="color"||t.a<1,renderOccluded:this.renderOccluded})}}class fe{constructor(e){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=C(r.main,.5),this.hoverColor=r.main,this.renderOccluded=c.Transparent,this.minSquaredEdgeLength=900,l(this,e)}apply(e,s){const t=this[e];s.setParameters({color:_(t),transparent:t.a<1,renderOccluded:this.renderOccluded})}}class ge{constructor(e){this.vertex=new G({color:r.main,outlineColor:r.outline}),this.edge=new G({color:pe(C(r.main,2/3),.5),outlineColor:C(r.outline,.5),size:8,collisionPadding:8}),this.selected=new G({color:r.selected,outlineColor:r.outline}),this.edgeOffset=new fe,l(this,e)}}class S{constructor(e){this.color=r.selected,this.width=1.5,this.stipplePattern=D(5),this.stippleOffColor=r.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=r.selected,this.renderOccluded=c.OccludeAndTransparent,l(this,e)}apply(e){e.color=_(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=_(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=_(this.innerColor),e.renderOccluded=this.renderOccluded}}class me{constructor(e){this.color=r.selected,this.size=4,this.outlineSize=1,this.outlineColor=r.outline,this.shape="square",l(this,e)}apply(e){e.color=_(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=_(this.outlineColor),e.primitive=this.shape}}class b{constructor(e){this.innerColor=r.selected,this.innerWidth=1,this.glowColor=r.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=O,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=r.main,l(this,e)}apply(e,s=1){const t={glowColor:u.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:u.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*s,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=t:e.laserlineStyle=t}}class we{constructor(e){this.outline=new S({color:r.outline,renderOccluded:c.OccludeAndTransparentStencil,stippleOffColor:r.selected,stipplePattern:D(5),width:1.5,innerWidth:0}),this.staged=new S({color:r.selected,renderOccluded:c.OccludeAndTransparentStencil,innerColor:r.staged,stippleOffColor:r.outline,stipplePattern:D(5),width:1.5}),this.shadowStyle=new b({globalAlpha:O,glowColor:r.main,glowFalloff:8,glowWidth:8,innerColor:r.selected,innerWidth:1}),l(this,e)}}class ye{constructor(e){this.outline=new me({color:r.selected,outlineColor:r.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new b({globalAlpha:O,glowColor:r.main,glowFalloff:1.5,glowWidth:6,innerColor:r.selected,innerWidth:1,radius:2}),l(this,e)}}class Oe extends S{constructor(e){super(),this.extensionType=B.GROUND_RAY,l(this,e)}}class Ce{constructor(e){this.lineGraphics=new we,this.pointGraphics=new ye,this.heightPlane=new b({globalAlpha:O,glowColor:r.main,glowFalloff:8,glowWidth:8,innerColor:r.selected,innerWidth:1}),this.heightBox=new b({globalAlpha:O,glowColor:r.main,glowFalloff:8,glowWidth:8,innerColor:r.selected,innerWidth:0,heightFillColor:r.main}),this.zVerticalLine=new Oe({color:C(r.main,5*O/3),falloff:2,innerColor:C(r.selected,0),renderOccluded:c.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:B.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,l(this,e)}}class ve{constructor(e){this.visualElements=new Ce,this.reshapeManipulators=new ge,this.zManipulator=new _e,l(this,e)}colorToVec4(e){return _(e)}}function _(o){return H(u.toUnitRGBA(o))}const De=new ve;class Re{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get resources(){return d(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){this.resourceFactory.recreateGeometry?h(this._resources)||(this._ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?h(this._resources)&&this._createResources():this._destroyResources()}_createResources(){var i;this._destroyResources();const e=this.resourceFactory.createResources(),s=new y({view:this.resourceFactory.view}),t=(i=this.resourceFactory.view.basemapTerrain)==null?void 0:i.overlayManager;this._resources={layerView:new y({view:this.resourceFactory.view}),external:e,geometriesAdded:!1},t&&(this._resources.drapeSourceRenderer=t.registerGeometryDrapeSource(s)),this._syncGeometriesToRenderer()}_destroyResources(){var s;if(h(this._resources))return;this._ensureRenderGeometriesRemoved();const e=(s=this.resourceFactory.view.basemapTerrain)==null?void 0:s.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){h(this._resources)||h(this._resources.drapeSourceRenderer)||!this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,$.Geometry.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){h(this._resources)||h(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,$.Geometry.UPDATE),this._resources.geometriesAdded=!0)}}let y=class extends k(L){constructor(o){super(o),this.drapeSourceType=N.Features,this.updatePolicy=j.SYNC}};p([w({constructOnly:!0})],y.prototype,"view",void 0),p([w({readOnly:!0})],y.prototype,"drapeSourceType",void 0),y=p([x("DrapedVisualElementLayerView")],y);class Se{constructor(e){this.view=null,this._attachmentOrigin=K(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new I,this._isDraped=!1,this._geometry=null,this._width=1,this._color=W(1,0,1,1),this._innerWidth=0,this._innerColor=W(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=c.OccludeAndTransparentStencil,this.resources=new de({view:e.view,createResources:t=>this._createResources(t),recreateGeometry:(t,i)=>(t.geometries.length=0,this._recreateGeometry(i,t.material,t.geometries),t.geometries)}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this.drapedResources=new Re({view:e.view,createResources:()=>this._createDrapedResources(),recreateGeometry:t=>{t.geometries=this._createRenderGeometriesDraped(t.material),this._attachmentOriginChanged()}});let s=!0;this._laserline=new ue({view:e.view});for(const t in e)t in this?t==="attached"?s=e[t]:this[t]=e[t]:console.error("Cannot set unknown property",t);this.attached=s}destroy(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this._updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}get laserlineAttached(){return this.attached&&this.visible&&d(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}get attached(){return this.resources.attached||this.drapedResources.attached}set attached(e){this._updateAttached(e)}_updateAttached(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){A(e,this._color)||(E(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){A(e,this._innerColor)||(E(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const s=d(e)!==d(this._stipplePattern);this._stipplePattern=e,s?this.resources.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&A(e,this._stippleOffColor)||(this._stippleOffColor=e?X(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,d(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=d(this.resources.resources)?this.resources.resources.geometries:null;if(!e||e.length===0)return null;Z(g,0,0,0);let s=0;for(const t of e){const i=t.vertexAttributes.get(P.POSITION),a=t.indices.get(P.POSITION),f=J(this.resources.resources).material.isClosed(i.data,a);Q(i,a,f,z)&&(ee(g,g,z),s++)}return s===0?null:(te(g,g,1/s),this.view.renderCoordsHelper.fromRenderCoords(g,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){d(this.resources.resources)&&this.resources.resources.material.setParameters(this.materialParameters),d(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameters(this.materialParameters)}get isClosed(){return d(this.geometry)&&this.geometry.type==="polygon"}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}get normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===c.OccludeAndTransparentStencil?c.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,s,t){const i=this._createRenderGeometries();for(const a of i)e.addGeometry(a,s),t.push(a);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createResources(e){const s=new T(this.materialParameters),t=[];return this._recreateGeometry(e,s,t),{material:s,geometries:t,forEach:i=>{i(s),t.forEach(i)}}}_createDrapedResources(){const e=new T(this.materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const s=this.geometry;if(h(s))return[];const t=se(s,this.view.basemapTerrain.spatialReference),i=[];for(const{position:a}of t.lines){const f={overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:a},removeDuplicateStartEnd:this.isClosed?R.REMOVE:R.KEEP},v=new re(F(f),e),n=ie(be);M(n,a),oe(v.boundingSphere,.5*(n[0]+n[3]),.5*(n[1]+n[4]),0,.5*Math.sqrt((n[3]-n[0])*(n[3]-n[0])+(n[4]-n[1])*(n[4]-n[1]))),i.push(v)}return i}calculateMapBounds(e){if(h(this.resources.resources))return!1;const s=this.view.renderCoordsHelper;for(const t of this.resources.resources.geometries){const i=t.vertexAttributes.get(P.POSITION),a=new Float64Array(i.data.length);ne(i.data,s.spatialReference,0,a,this.view.spatialReference,0,i.data.length/3),M(e,a)}return!0}_createRenderGeometries(){var a;const e=this.geometry;if(h(e))return[];const s=ae(e,this.view.elevationProvider,this.view.renderCoordsHelper,le.fromElevationInfo((a=this.elevationInfo)!=null?a:new he({mode:ce(e,null)}))),t=[],i=[];for(const{position:f,mapPosition:v}of s.lines){const n={overlayInfo:null,attributeData:{position:f,mapPosition:v},removeDuplicateStartEnd:this.isClosed?R.REMOVE:R.KEEP};t.push(F(n)),i.push(f)}return this._laserline.pathVerticalPlane=i,t}}const be=Y(),z=V(),g=V();let m=class extends I.EventedAccessor{constructor(o){super(o),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};p([w({constructOnly:!0})],m.prototype,"graphic",void 0),p([w()],m.prototype,"tracking",void 0),p([w()],m.prototype,"displaying",void 0),p([w()],m.prototype,"isDraped",void 0),m=p([x("esri.views.3d.layers.graphics.GraphicState")],m);export{Se as S,m as e,r,De as y};
