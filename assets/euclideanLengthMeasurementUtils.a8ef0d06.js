var J=Object.defineProperty,K=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,tt=Object.prototype.propertyIsEnumerable;var D=(t,n,e)=>n in t?J(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,N=(t,n)=>{for(var e in n||(n={}))$.call(n,e)&&D(t,e,n[e]);if(A)for(var e of A(n))tt.call(n,e)&&D(t,e,n[e]);return t},F=(t,n)=>K(t,W(n));import{M as P,aU as V,aI as j,H as d,lT as nt,ic as G,cv as q,lX as et,B as R,D as B,E as at,F as rt,aV as ot,gM as I,lY as it,lZ as L,b6 as M,g6 as H,b5 as st,aE as z}from"./vendor.fe24faac.js";import{G as U}from"./InteractiveToolBase.e7b97dce.js";import{e as lt}from"./SnappingContext.fb20e8e2.js";import{o as h}from"./quantityUtils.4cba5101.js";import{i as Q}from"./measurementUtils.0b0f9c2a.js";class mt{constructor(){this.next=new U}createSnapDragEventPipelineStep({predicate:n=()=>!0,cancel:e,snappingManager:a,snappingContext:s,updatingHandles:c}){if(P(a))return r=>r;let p=null,o=null;const y=()=>{p=G(p),a.doneSnapping(),d(o)&&o.frameTask.remove(),o=null};e.next(r=>(y(),r)),this.next=new U;const C=q(async({frameTask:r,point:u,context:m,event:v,dx:E,dy:Z},x)=>{const _=await r.schedule(()=>a.snap(u,m,x),x);if(_.valid){let b=await r.schedule(()=>_.apply(),x);u!==f&&(b=a.update(f,m)),et(b,g)||(v.mapEnd.x=b.x+E,v.mapEnd.y=b.y+Z,this.next.execute(v))}});let f,g;return r=>{if(!n(r))return r;if(r.action==="start"){const u=a.view.type==="3d"?a.view.resourceController.scheduler.registerTask(V.SNAPPING):j;o={context:new lt({editGeometryOperations:s.editGeometryOperations,elevationInfo:s.elevationInfo,pointer:s.pointer,vertexHandle:d(r.info)?r.info.handle:null,excludeFeature:s.excludeFeature,visualizer:s.visualizer}),originalPos:d(r.snapOrigin)?s.coordinateHelper.vectorToDehydratedPoint(r.snapOrigin):r.mapStart,frameTask:u}}if(d(o)){const u=o.context.coordinateHelper.vectorToDehydratedPoint(o.context.coordinateHelper.arrayToVector([o.originalPos.x,o.originalPos.y,o.originalPos.z]));u.x+=r.mapEnd.x-r.mapStart.x,u.y+=r.mapEnd.y-r.mapStart.y;const m=r.mapStart.x-o.originalPos.x,v=r.mapStart.y-o.originalPos.y,E=F(N({},r),{action:"update"}),Z=o.context,x=a.update(u,o.context);if(g=x,r.mapEnd.x=x.x+m,r.mapEnd.y=x.y+v,f=u,r.action!=="end"){const _=o.frameTask;d(p)||(p=new AbortController),c.addPromise(nt(C({frameTask:_,event:E,context:Z,point:u,dx:m,dy:v},p.signal)))}}return r.action==="end"&&y(),r}}}let w=class extends rt{constructor(t){super(t),this.stagedPoint=null,this._abortController=null,this._snap=q(async(n,e,a,s)=>{const c=await this._frameTask.schedule(()=>e.snap(n,a,s),s);c.valid&&await this._frameTask.schedule(()=>{this.stagedPoint=c.apply(),n!==this._snapMapPoint&&(this.stagedPoint=e.update(this._snapMapPoint,a))},s)})}initialize(){var n,e;const t=this.view.type==="3d"?(e=(n=this.view)==null?void 0:n.resourceController)==null?void 0:e.scheduler:null;this._frameTask=d(t)?t.registerTask(V.SNAPPING):j}destroy(){this._abortController=G(this._abortController),this._frameTask=ot(this._frameTask)}async snap(t,n,e){return this.stagedPoint=n.update(t,e),this._snapMapPoint=t,P(this._abortController)&&(this._abortController=new AbortController),this._snap(t,n,e,this._abortController.signal)}abort(){this._abortController=G(this._abortController)}};R([B({constructOnly:!0})],w.prototype,"view",void 0),R([B()],w.prototype,"stagedPoint",void 0),w=R([at("esri.views.interactive.snapping.SnappingOperation")],w);function Pt(t){return X(t,"direct")}function zt(t){return X(t,"horizontal")}function X(t,n){const{hasZ:e,spatialReference:a}=t,s=Q(a);let c=0;const p=L(s);if(P(p))return null;const o=n==="direct"?ut:Y;for(const y of t.paths){if(y.length<2)continue;const C=y.length-1;for(let f=0;f<C;++f){const g=y[f];i[0]=g[0],i[1]=g[1],i[2]=e?g[2]:0;const r=y[f+1];l[0]=r[0],l[1]=r[1],l[2]=e?r[2]:0;const u=o(i,l,a);if(P(u))return null;c+=u.value}}return h(c,p)}function _t(t,n){const{spatialReference:e}=t;return I(e,n.spatialReference)?(i[0]=t.x,i[1]=t.y,i[2]=t.hasZ?t.z:0,l[0]=n.x,l[1]=n.y,l[2]=n.hasZ?n.z:0,ct(i,l,e)):null}function bt(t,n){const{spatialReference:e}=t;return I(e,n.spatialReference)?(i[0]=t.x,i[1]=t.y,i[2]=t.hasZ?t.z:0,l[0]=n.x,l[1]=n.y,l[2]=n.hasZ?n.z:0,Y(i,l,e)):null}function wt(t,n){const{spatialReference:e}=t;return I(e,n.spatialReference)?(i[0]=t.x,i[1]=t.y,i[2]=t.hasZ?t.z:0,l[0]=n.x,l[1]=n.y,l[2]=n.hasZ?n.z:0,pt(i,l,e)):null}function Tt(t){return i[0]=t.x,i[1]=t.y,i[2]=t.hasZ?t.z:0,dt(i,t.spatialReference)}function ct(t,n,e){const a=k(t,n,e);return d(a)?{direct:h(a.direct,a.unit),horizontal:h(a.horizontal,a.unit),vertical:h(a.vertical,a.unit)}:null}function ut(t,n,e){const a=k(t,n,e,"direct");return d(a)?h(a.direct,a.unit):null}function Y(t,n,e){const a=k(t,n,e,"horizontal");return d(a)?h(a.horizontal,a.unit):null}function pt(t,n,e){const a=k(t,n,e,"vertical");return d(a)?h(a.verticalSigned,a.unit):null}function dt(t,n){const e=it(n);return d(e)?h(t[2],e):null}function k(t,n,e,a){const s=Q(e),c=L(s);if(P(c))return null;const p=n[2]-t[2];if(a==="vertical")return{verticalSigned:p,unit:c};if(!M(t,e,O,s)||!M(n,e,T,s))return null;if(a==="direct")return{direct:H(T,O),unit:c};if(st(S,t[0],t[1],n[2]),!M(S,e,S,s))return null;const o=H(S,T);return a==="horizontal"?{horizontal:o,unit:c}:{direct:H(T,O),horizontal:o,vertical:Math.abs(p),unit:c}}const i=z(),l=z(),O=z(),T=z(),S=z();export{Y as Z,zt as a,wt as b,mt as d,Pt as f,pt as g,w as h,_t as m,Tt as v,ut as x,bt as y};
