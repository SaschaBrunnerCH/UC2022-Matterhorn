import{r9 as C,rg as S,rh as x,re as D,k5 as I}from"./vendor.fe24faac.js";import{CIMSymbolRasterizer as v}from"./CIMSymbolRasterizer.7baf0e6e.js";import"./cimAnalyzer.08f329be.js";import"./CIMSymbolHelper.5633d3f2.js";import"./BidiEngine.4cfb7343.js";import"./enums.7bbb7f55.js";import"./number.08b65821.js";import"./definitions.bbcb6e26.js";const V=new v(null,!0),k=C.maxSize;async function P(t,e={}){const{size:m,maxSize:h,node:y,opacity:f}=e,g=e.cimOptions||e,{feature:w,fieldMap:M,geometryType:b,style:z}=g,u=S(t),d=typeof m=="number"?m:null,i=Math.min(d!=null?d:u,h!=null?h:I(k));i!==u&&(t=t.clone(),x(t,i,{preserveOutlineWidth:!0}));let s=3;t&&t.data&&t.data.symbol&&t.data.symbol.type!=="CIMPointSymbol"&&(s=1);const c=await V.rasterizeCIMSymbolAsync(t,w,M,b,{scaleFactor:s,style:z}),l=document.createElement("canvas");l.width=c.imageData.width,l.height=c.imageData.height,l.getContext("2d").putImageData(c.imageData,0,0);let o=l.width/s,n=l.height/s;if(m!=null&&((e==null?void 0:e.scale)==null||(e==null?void 0:e.scale))){const a=o/n;o=a<=1?Math.ceil(i*a):i,n=a<=1?i:Math.ceil(i/a)}const r=new Image(o,n);r.src=l.toDataURL(),f!=null&&(r.style.opacity=`${f}`);let p=r;if(e.effectView!=null){const a={shape:{type:"image",x:0,y:0,width:o,height:n,src:r.src},fill:null,stroke:null,offset:[0,0]};p=D([[a]],[o,n],{effectView:e.effectView})}return y&&y.appendChild(p),p}export{P as previewCIMSymbol};
