var WFe=Object.defineProperty,ZFe=Object.defineProperties;var XFe=Object.getOwnPropertyDescriptors;var wD=Object.getOwnPropertySymbols;var $ne=Object.prototype.hasOwnProperty,Lne=Object.prototype.propertyIsEnumerable;var Ine=(e,t,i)=>t in e?WFe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,F=(e,t)=>{for(var i in t||(t={}))$ne.call(t,i)&&Ine(e,i,t[i]);if(wD)for(var i of wD(t))Lne.call(t,i)&&Ine(e,i,t[i]);return e},me=(e,t)=>ZFe(e,XFe(t));var xD=(e,t)=>{var i={};for(var r in e)$ne.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&wD)for(var r of wD(e))t.indexOf(r)<0&&Lne.call(e,r)&&(i[r]=e[r]);return i};const Wk={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function T0e(e){return Wk[e]||Wk[e.toLowerCase()]}function vQ(e){var t;return(t=Wk[e])!=null?t:Wk[e.toLowerCase()]}function YFe(e){return[...vQ(e)]}function TG(e,t,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?e+(t-e)*r:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}function S0e(e,t,i,r=1){const s=(e%360+360)%360/360,n=i<=.5?i*(t+1):i+t-i*t,o=2*i-n;return[Math.round(255*TG(o,n,s+1/3)),Math.round(255*TG(o,n,s)),Math.round(255*TG(o,n,s-1/3)),r]}function JFe(e){const t=e.length>5,i=t?8:4,r=(1<<i)-1,s=t?1:17,n=t?e.length===9:e.length===5;let o=Number("0x"+e.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}function $(){return[0,0,0]}function Rn(e){return[e[0],e[1],e[2]]}function Ze(e,t,i){return[e,t,i]}function Tc(e){const t=$(),i=Math.min(3,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function _Q(e,t){return new Float64Array(e,t,3)}function E0e(){return $()}function C0e(){return Ze(1,1,1)}function A0e(){return Ze(1,0,0)}function M0e(){return Ze(0,1,0)}function bQ(){return Ze(0,0,1)}const Hl=E0e(),Cg=C0e(),QFe=A0e(),KFe=M0e(),O0e=bQ();Object.freeze(Object.defineProperty({__proto__:null,create:$,clone:Rn,fromValues:Ze,fromArray:Tc,createView:_Q,zeros:E0e,ones:C0e,unitX:A0e,unitY:M0e,unitZ:bQ,ZEROS:Hl,ONES:Cg,UNIT_X:QFe,UNIT_Y:KFe,UNIT_Z:O0e},Symbol.toStringTag,{value:"Module"}));const Ut=1e-6,$f=Math.random,e4e=Math.PI/180,t4e=180/Math.PI;function MV(e){return e*e4e}function i4e(e){return e*t4e}function r4e(e,t){return Math.abs(e-t)<=Ut*Math.max(1,Math.abs(e),Math.abs(t))}Object.freeze(Object.defineProperty({__proto__:null,EPSILON:Ut,RANDOM:$f,toRadian:MV,toDegree:i4e,equals:r4e},Symbol.toStringTag,{value:"Module"}));function Ue(e){const t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)}function pe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function he(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e}function we(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function xe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function OV(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function Zk(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function s4e(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function n4e(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function jH(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function R0e(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function P0e(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function o4e(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function a4e(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function fe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function _T(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function Pr(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}function uo(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function Vl(e){const t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function ll(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function l4e(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Re(e,t){const i=t[0],r=t[1],s=t[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e}function Pe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Tt(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];return e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o,e}function Pn(e,t,i,r){const s=t[0],n=t[1],o=t[2];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e}function c4e(e,t,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return e[0]=t[0]*a+i[0]*l+r[0]*c+s[0]*h,e[1]=t[1]*a+i[1]*l+r[1]*c+s[1]*h,e[2]=t[2]*a+i[2]*l+r[2]*c+s[2]*h,e}function u4e(e,t,i,r,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,p=3*l*o,f=l*n;return e[0]=t[0]*c+i[0]*h+r[0]*p+s[0]*f,e[1]=t[1]*c+i[1]*h+r[1]*p+s[1]*f,e[2]=t[2]*c+i[2]*h+r[2]*p+s[2]*f,e}function h4e(e,t){t=t||1;const i=2*$f()*Math.PI,r=2*$f()-1,s=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(i)*s,e[1]=Math.sin(i)*s,e[2]=r*t,e}function Xe(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12],e[1]=i[1]*r+i[5]*s+i[9]*n+i[13],e[2]=i[2]*r+i[6]*s+i[10]*n+i[14],e}function Pu(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=r*i[0]+s*i[3]+n*i[6],e[1]=r*i[1]+s*i[4]+n*i[7],e[2]=r*i[2]+s*i[5]+n*i[8],e}function Xh(e,t,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=t[0],l=t[1],c=t[2];let h=s*c-n*l,p=n*a-r*c,f=r*l-s*a,m=s*f-n*p,g=n*h-r*f,y=r*p-s*h;const x=2*o;return h*=x,p*=x,f*=x,m*=2,g*=2,y*=2,e[0]=a+h+m,e[1]=l+p+g,e[2]=c+f+y,e}function d4e(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function p4e(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function f4e(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function m4e(e,t){pe(TD,e),pe(SD,t),Re(TD,TD),Re(SD,SD);const i=Pe(TD,SD);return i>1?0:i<-1?Math.PI:Math.acos(i)}const TD=$(),SD=$();function g4e(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Ic(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function sS(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],n=t[0],o=t[1],a=t[2];return Math.abs(i-n)<=Ut*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=Ut*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=Ut*Math.max(1,Math.abs(s),Math.abs(a))}function Rv(e,t,i){const r=i[0]-t[0],s=i[1]-t[1],n=i[2]-t[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),e[0]=r*o,e[1]=s*o,e[2]=n*o,e):(e[0]=0,e[1]=0,e[2]=0,e)}const zu=xe,y4e=OV,v4e=Zk,wQ=Pr,xQ=uo,TQ=Ue,HH=Vl,Dne=Object.freeze(Object.defineProperty({__proto__:null,length:Ue,copy:pe,set:he,add:we,subtract:xe,multiply:OV,divide:Zk,ceil:s4e,floor:n4e,abs:jH,sign:R0e,min:P0e,max:o4e,round:a4e,scale:fe,scaleAndAdd:_T,distance:Pr,squaredDistance:uo,squaredLength:Vl,negate:ll,inverse:l4e,normalize:Re,dot:Pe,cross:Tt,lerp:Pn,hermite:c4e,bezier:u4e,random:h4e,transformMat4:Xe,transformMat3:Pu,transformQuat:Xh,rotateX:d4e,rotateY:p4e,rotateZ:f4e,angle:m4e,str:g4e,exactEquals:Ic,equals:sS,direction:Rv,sub:zu,mul:y4e,div:v4e,dist:wQ,sqrDist:xQ,len:TQ,sqrLen:HH},Symbol.toStringTag,{value:"Module"}));function Lf(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function _r(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function SQ(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function I0e(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function $0e(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function L0e(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function _4e(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function b4e(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function w4e(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e}function x4e(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e}function T4e(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function rL(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function S4e(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}function D0e(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function Xk(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return i*i+r*r+s*s+n*n}function EQ(e){const t=e[0],i=e[1],r=e[2],s=e[3];return Math.sqrt(t*t+i*i+r*r+s*s)}function CQ(e){const t=e[0],i=e[1],r=e[2],s=e[3];return t*t+i*i+r*r+s*s}function E4e(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function C4e(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function N0e(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=i*o,e[1]=r*o,e[2]=s*o,e[3]=n*o),e}function F0e(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function RV(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e[3]=a+r*(i[3]-a),e}function A4e(e,t){let i,r,s,n,o,a;t=t||1;do i=2*$f()-1,r=2*$f()-1,o=i*i+r*r;while(o>=1);do s=2*$f()-1,n=2*$f()-1,a=s*s+n*n;while(a>=1);const l=Math.sqrt((1-o)/a);return e[0]=t*i,e[1]=t*r,e[2]=t*s*l,e[3]=t*n*l,e}function jh(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,e[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,e[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,e[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,e}function M4e(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2],c=i[3],h=c*r+a*n-l*s,p=c*s+l*r-o*n,f=c*n+o*s-a*r,m=-o*r-a*s-l*n;return e[0]=h*c+m*-o+p*-l-f*-a,e[1]=p*c+m*-a+f*-o-h*-l,e[2]=f*c+m*-l+h*-a-p*-o,e[3]=t[3],e}function O4e(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function S3(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function k0e(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=Ut*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Ut*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=Ut*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=Ut*Math.max(1,Math.abs(n),Math.abs(c))}const R4e=I0e,P4e=$0e,I4e=L0e,$4e=D0e,L4e=Xk,D4e=EQ,N4e=CQ,U0e=Object.freeze(Object.defineProperty({__proto__:null,copy:Lf,set:_r,add:SQ,subtract:I0e,multiply:$0e,divide:L0e,ceil:_4e,floor:b4e,min:w4e,max:x4e,round:T4e,scale:rL,scaleAndAdd:S4e,distance:D0e,squaredDistance:Xk,length:EQ,squaredLength:CQ,negate:E4e,inverse:C4e,normalize:N0e,dot:F0e,lerp:RV,random:A4e,transformMat4:jh,transformQuat:M4e,str:O4e,exactEquals:S3,equals:k0e,sub:R4e,mul:P4e,div:I4e,dist:$4e,sqrDist:L4e,len:D4e,sqrLen:N4e},Symbol.toStringTag,{value:"Module"})),Nne=new Float32Array(1);function FA(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function He(e,t,i){return Math.min(Math.max(e,t),i)}function kA(e){return(e&e-1)==0}function TNt(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function SNt(e){return 10**Math.ceil(Math.LOG10E*Math.log(e))}function ui(e,t,i){return e+(t-e)*i}function Yt(e){return e*Math.PI/180}function Vu(e){return 180*e/Math.PI}function qH(e,t=1e-6){return(e<0?-1:1)/Math.max(Math.abs(e),t)}function Yn(e){return Math.acos(He(e,-1,1))}function tm(e){return Math.asin(He(e,-1,1))}function F4e(e,t,i=1e-6){if(isNaN(e)||isNaN(t))return!1;if(e===t)return!0;const r=Math.abs(e-t),s=Math.abs(e),n=Math.abs(t);if(e===0||t===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function Rg(e,t,i=1e-6){return isNaN(e)||isNaN(t)?!1:(e>t?e-t:t-e)<=i}function k4e(e){return z0e(Math.max(-WH,Math.min(e,WH)))}function z0e(e){return Nne[0]=e,Nne[0]}function UA(e,t,i){const r=He((i-e)/(t-e),0,1);return r*r*(3-2*r)}function Fne(e,t){const i=Ue(e),r=tm(e[2]/i),s=Math.atan2(e[1]/i,e[0]/i);return he(t,i,r,s),t}function ENt(e,t,i){return _r(e,t[0],t[1],t[2],t[3]*i)}function CNt(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],r=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(Rg(t,1)&&Rg(i,1)&&Rg(r,1))}const WH=z0e(34028234663852886e22),x1=null;function _(e){return e!=null}function M(e){return e==null}function wt(e,t){return _(e)?t(e):x1}function ANt(e){return e}function U4e(e,t){if(M(e))throw new Error(t);return e}function Ye(e,t){return _(e)?e:typeof t=="function"?t():t}function MNt(e,t){return _(e)?e:t}function We(e){return _(e)&&e.destroy(),null}function ht(e){return _(e)&&e.dispose(),null}function hn(e){return _(e)&&e.remove(),null}function Wn(e){return _(e)&&e.abort(),null}function br(e){return _(e)&&e.release(),null}function z4e(e,t,i){return _(e)&&_(t)?_(i)?i(e,t):e.equals(t):e===t}function V4e(e){return null}function ONt(e,t){const i=new Array;return e.forEach(r=>{const s=t(r);_(s)&&i.push(s)}),i}function RNt(e,t){const i=new Array;for(const r of e)i.push(Nh(r,null,t));return i}function B4e(e,t){for(const i of e)wt(i,t)}function Nh(e,t,i){return _(e)?i(e):t}function PNt(e){return e.filter(t=>_(t))}function Wr(e,...t){let i=e;for(let r=0;r<t.length&&i;++r)i=i[t[r]];return i}function INt(e){return e}let G1;function ye(e){return typeof G1[e]=="function"?G1[e]=G1[e](globalThis):G1[e]}var f0e,m0e,g0e,y0e;G1=((f0e=globalThis.dojoConfig)==null?void 0:f0e.has)||((m0e=globalThis.esriConfig)==null?void 0:m0e.has)?F(F({},(g0e=globalThis.dojoConfig)==null?void 0:g0e.has),(y0e=globalThis.esriConfig)==null?void 0:y0e.has):{},ye.add=(e,t,i,r)=>((r||G1[e]===void 0)&&(G1[e]=t),i&&ye(e)),ye.cache=G1,ye.add("esri-deprecation-warnings",!0),(()=>{var t;ye.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const e=typeof window!="undefined"&&typeof location!="undefined"&&typeof document!="undefined"&&window.location===location&&window.document===document;if(ye.add("host-browser",e),ye.add("host-node",typeof globalThis.process=="object"&&((t=globalThis.process.versions)==null?void 0:t.node)&&globalThis.process.versions.v8),ye.add("dom",e),ye("host-browser")){const i=navigator,r=i.userAgent,s=i.appVersion,n=parseFloat(s);if(ye.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),ye.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),ye.add("khtml",s.includes("Konqueror")?n:void 0),ye.add("edge",parseFloat(r.split("Edge/")[1])||void 0),ye.add("opr",parseFloat(r.split("OPR/")[1])||void 0),ye.add("webkit",!ye("wp")&&!ye("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),ye.add("chrome",!ye("edge")&&!ye("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),ye.add("android",!ye("wp")&&parseFloat(r.split("Android ")[1])||void 0),ye.add("safari",!s.includes("Safari")||ye("wp")||ye("chrome")||ye("android")||ye("edge")||ye("opr")?void 0:parseFloat(s.split("Version/")[1])),ye.add("mac",s.includes("Macintosh")),!ye("wp")&&r.match(/(iPhone|iPod|iPad)/)){const o=RegExp.$1.replace(/P/,"p"),a=r.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replace(/_/g,""));ye.add(o,l),ye.add("ios",l)}ye.add("trident",parseFloat(s.split("Trident/")[1])||void 0),ye("webkit")||(!r.includes("Gecko")||ye("wp")||ye("khtml")||ye("trident")||ye("edge")||ye.add("mozilla",n),ye("mozilla")&&ye.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),i=/iPhone/i.test(e);t&&ye.add("esri-mobile",t),i&&ye.add("esri-iPhone",i),ye.add("esri-geolocation",!!navigator.geolocation)}ye.add("esri-canvas-svg-support",!ye("trident")),ye.add("esri-wasm","WebAssembly"in globalThis),ye.add("esri-shared-array-buffer",()=>{const e="SharedArrayBuffer"in globalThis,t=globalThis.crossOriginIsolated===!1;return e&&!t}),ye.add("wasm-simd",()=>{const e=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(e))}),ye.add("esri-atomics","Atomics"in globalThis),ye.add("esri-workers","Worker"in globalThis),ye.add("web-feat:cache","caches"in globalThis),ye.add("esri-workers-arraybuffer-transfer",!ye("safari")||Number(ye("safari"))>=12),ye.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),ye.add("featurelayer-simplify-payload-size-factors",[1,1,4]),ye.add("featurelayer-snapshot-enabled",!0),ye.add("featurelayer-snapshot-point-min-threshold",8e4),ye.add("featurelayer-snapshot-point-max-threshold",4e5),ye.add("featurelayer-snapshot-point-coverage",.1),ye.add("featurelayer-advanced-symbols",!1),ye.add("featurelayer-pbf",!0),ye.add("featurelayer-pbf-statistics",!1),ye.add("feature-layers-workers",!0),ye.add("feature-polyline-generalization-factor",1),ye.add("mapview-transitions-duration",200),ye.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),ye.add("mapserver-pbf-enabled",!1),ye.add("mapimagelayer-popup-identify-max-tolerance",20),ye.add("heatmap-allow-raster-fallback",!0),ye.add("heatmap-force-raster",!1),ye("host-webworker")||ye("host-browser")&&(ye.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),ye.add("esri-image-decode",()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then(()=>{ye.add("esri-image-decode",!0,!0,!0)}).catch(()=>{ye.add("esri-image-decode",!1,!0,!0)})}return!1}),ye.add("esri-url-encodes-apostrophe",()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")}))})();class ep{constructor(t=1){this._seed=t}set seed(t){this._seed=t==null?Math.random()*ep._m:t}getInt(){return this._seed=(ep._a*this._seed+ep._c)%ep._m,this._seed}getFloat(){return this.getInt()/(ep._m-1)}getIntRange(t,i){return Math.round(this.getFloatRange(t,i))}getFloatRange(t,i){const r=i-t;return t+this.getInt()/ep._m*r}}ep._m=2147483647,ep._a=48271,ep._c=0;function G4e(e){if(!e)return;const t=e.length;return t>0?e[t-1]:void 0}function V0e(e){return e}function j4e(e,t=V0e){if(!e||e.length===0)return;let i=e[0],r=t(i);for(let s=1;s<e.length;++s){const n=e[s],o=Number(t(n));o>r&&(r=o,i=n)}return i}function B0e(e,t=V0e){return j4e(e,i=>-t(i))}function sL(e,t){return t?e.filter((i,r,s)=>s.findIndex(t.bind(null,i))===r):e.filter((i,r,s)=>s.indexOf(i)===r)}function wb(e,t,i){if(M(e)&&M(t))return!0;if(M(e)||M(t)||e.length!==t.length)return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function AQ(e,t){let i=e.length!==t.length;e.length=t.length;for(let r=0;r<t.length;++r)e[r]!==t[r]&&(e[r]=t[r],i=!0);return i}function H4e(e,t,i){let r,s;return i?(r=t.filter(n=>!e.some(o=>i(o,n))),s=e.filter(n=>!t.some(o=>i(o,n)))):(r=t.filter(n=>!e.includes(n)),s=e.filter(n=>!t.includes(n))),{added:r,removed:s}}function q4e(e){return e&&typeof e.length=="number"}function G0e(e,t){const i=e.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=t)r.push(e.slice(s,s+t));return r}const W4e=!!Array.prototype.fill;function Z4e(e,t){if(W4e)return new Array(e).fill(t);const i=new Array(e);for(let r=0;r<e;r++)i[r]=t;return i}function X4e(e,t){t===void 0&&(t=e,e=0);const i=new Array(t-e);for(let r=e;r<t;r++)i[r-e]=r;return i}function j0e(e,t,i){const r=e.length;let s=0,n=r-1;for(;s<n;){const a=s+Math.floor((n-s)/2);t>e[a]?s=a+1:n=a}const o=e[s];return i?t>=e[r-1]?-1:o===t?s:s-1:o===t?s:-1}function H0e(e,t,i){if(!e||e.length===0)return;const r=e.length-1,s=e[0];if(t<=i(s))return s;const n=e[r];if(t>=i(n))return n;let o=0,a=0,l=r;for(;o<l;){a=o+Math.floor((l-o)/2);const c=e[a],h=i(c);if(h===t)return c;if(t<h){if(a>0){const p=e[a-1],f=i(p);if(t>f)return t-f>=h-t?c:p}l=a}else{if(a<r){const p=e[a+1],f=i(p);if(t<f)return t-h>=f-t?p:c}o=a+1}}return e[a]}function q0e(e){return e.reduce((t,i)=>t.concat(i||[]),[])}class W0e{constructor(){this.last=0}}const Z0e=new W0e;function X0e(e,t,i,r){r=r||Z0e;const s=Math.max(0,r.last-10);for(let o=s;o<i;++o)if(e[o]===t)return r.last=o,o;const n=Math.min(s,i);for(let o=0;o<n;++o)if(e[o]===t)return r.last=o,o;return-1}function PV(e,t,i,r){const s=i==null?e.length:i,n=X0e(e,t,s,r);if(n!==-1)return e[n]=e[s-1],i==null&&e.pop(),t}const Dp=new Set;function Y4e(e,t,i=e.length,r=t.length,s,n){if(r===0||i===0)return i;Dp.clear();for(let a=0;a<r;++a)Dp.add(t[a]);s=s||Z0e;const o=Math.max(0,s.last-10);for(let a=o;a<i;++a)if(Dp.has(e[a])&&(n&&n.push(e[a]),Dp.delete(e[a]),e[a]=e[i-1],--i,--a,Dp.size===0||i===0))return Dp.clear(),i;for(let a=0;a<o;++a)if(Dp.has(e[a])&&(n&&n.push(e[a]),Dp.delete(e[a]),e[a]=e[i-1],--i,--a,Dp.size===0||i===0))return Dp.clear(),i;return Dp.clear(),i}function J4e(e){return e?(kne.seed=e,()=>kne.getFloat()):Math.random}function $Nt(e,t){const i=J4e(t);for(let r=e.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=e[r];e[r]=e[s],e[s]=n}return e}const kne=new ep;function MQ(e,t){const i=e.indexOf(t);return i!==-1?(e.splice(i,1),t):null}function Q4e(e,t){if(e.forEach)e.forEach(t);else for(let i=0;i<e.length;i++)t(e[i],i,e)}function OQ(e,t,i){if(e.slice)return e.slice(t,i);t===void 0?t=0:(t<0&&(t+=e.length),t=Math.min(e.length,Math.max(0,t))),i===void 0?i=e.length:(i<0&&(i+=e.length),i=Math.min(e.length,Math.max(0,i)));const r=Math.max(0,i-t),s=new e.constructor(r);for(let n=0;n<r;n++)s[n]=e[t+n];return s}function UO(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}function K4e(e){return e instanceof Int8Array||e&&e.constructor&&e.constructor.name==="Int8Array"}function Jx(e){return e instanceof Uint8Array||e&&e.constructor&&e.constructor.name==="Uint8Array"}function e5e(e){return e instanceof Uint8ClampedArray||e&&e.constructor&&e.constructor.name==="Uint8ClampedArray"}function Y0e(e){return e instanceof Int16Array||e&&e.constructor&&e.constructor.name==="Int16Array"}function Yk(e){return e instanceof Uint16Array||e&&e.constructor&&e.constructor.name==="Uint16Array"}function J0e(e){return e instanceof Int32Array||e&&e.constructor&&e.constructor.name==="Int32Array"}function Jk(e){return e instanceof Uint32Array||e&&e.constructor&&e.constructor.name==="Uint32Array"}function Q0e(e){return e instanceof Float32Array||e&&e.constructor&&e.constructor.name==="Float32Array"}function K0e(e){return e instanceof Float64Array||e&&e.constructor&&e.constructor.name==="Float64Array"}function t5e(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}function ED(e){return M(e)?0:128+e.buffer.byteLength+64}function eve(e,t){let i;if(t)for(i in e)e.hasOwnProperty(i)&&(e[i]===void 0?delete e[i]:e[i]instanceof Object&&eve(e[i],!0));else for(i in e)e.hasOwnProperty(i)&&e[i]===void 0&&delete e[i];return e}function ue(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=sve(e);if(_(t))return t;if(tve(e))return e.clone();if(ive(e))return e.map(ue);if(rve(e))return e.clone();const i={};for(const r of Object.getOwnPropertyNames(e))i[r]=ue(e[r]);return i}function ZH(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=sve(e);if(_(t))return t;if(ive(e)){let i=!0;const r=e.map(s=>{const n=ZH(s);return s!=null&&n==null&&(i=!1),n});return i?r:null}if(tve(e))return e.clone();if(!rve(e)){const i=new(Object.getPrototypeOf(e)).constructor;for(const r of Object.getOwnPropertyNames(e)){const s=e[r],n=ZH(s);if(s!=null&&n==null)return null;i[r]=n}return i}return null}function tve(e){return typeof e.clone=="function"}function ive(e){return typeof e.map=="function"&&typeof e.forEach=="function"}function rve(e){return typeof e.notifyChange=="function"&&typeof e.watch=="function"}function Une(e){if(Object.prototype.toString.call(e)!=="[object Object]")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}function sve(e){if(K4e(e)||Jx(e)||e5e(e)||Y0e(e)||Yk(e)||J0e(e)||Jk(e)||Q0e(e)||K0e(e))return OQ(e);if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;return e.forEach((i,r)=>{t.set(r,ue(i))}),t}if(e instanceof Set){const t=new Set;return e.forEach(i=>{t.add(ue(i))}),t}return null}function RQ(e,t){return e===t||typeof e=="number"&&isNaN(e)&&typeof t=="number"&&isNaN(t)||typeof(e||{}).getTime=="function"&&typeof(t||{}).getTime=="function"&&e.getTime()===t.getTime()||!1}function i5e(e,t){return e===t||(e==null||typeof e=="string"?e===t:typeof e=="number"?e===t||typeof t=="number"&&isNaN(e)&&isNaN(t):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&wb(e,t):e instanceof Set?t instanceof Set&&s5e(e,t):e instanceof Map?t instanceof Map&&n5e(e,t):!!Une(e)&&Une(t)&&r5e(e,t))}function r5e(e,t){if(e===null||t===null)return!1;const i=Object.keys(e);if(t===null||Object.keys(t).length!==i.length)return!1;for(const r of i)if(e[r]!==t[r]||!Object.prototype.hasOwnProperty.call(t,r))return!1;return!0}function s5e(e,t){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}function n5e(e,t){if(e.size!==t.size)return!1;for(const[i,r]of e){const s=t.get(i);if(s!==r||s===void 0&&!t.has(i))return!1}return!0}function nve(e,t,i=!1){return ave(e,t,i)}function QM(e,t){if(t!=null)return t[e]||ove(e.split("."),!1,t)}function Bu(e,t,i){const r=e.split("."),s=r.pop(),n=ove(r,!0,i);n&&s&&(n[s]=t)}function ove(e,t,i){let r=i;for(const s of e){if(r==null)return;if(!(s in r)){if(!t)return;r[s]={}}r=r[s]}return r}function ave(e,t,i){return t?Object.keys(t).reduce((r,s)=>{let n=r[s],o=t[s];return n===o?r:n===void 0?(r[s]=ue(o),r):(Array.isArray(o)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.concat():r[s]=[n]:r[s]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{n.includes(a)||n.push(a)}):r[s]=o.concat())):o&&typeof o=="object"?r[s]=ave(n,o,i):r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=o),r)},e||{}):e}var v0e;const or={apiKey:void 0,applicationUrl:(v0e=globalThis.location)==null?void 0:v0e.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(nve(or,globalThis.esriConfig,!0),delete or.has),!or.assetsPath){const e="4.24.5";or.assetsPath=`https://js.arcgis.com/${e.slice(0,-2)}/@arcgis/core/assets`}or.baseUrl&&console.warn("[esri.config]","baseUrl has been replaced by assetsPath"),Object.defineProperty(or,"baseUrl",{set(){console.warn("[esri.config]","baseUrl has been replaced by assetsPath")}}),or.request.corsEnabledServers=[],or.request.corsEnabledServers.push=function(){return console.warn("[esri.config]","request.corsEnabledServers is not supported and will be removed in a future release. See http://esriurl.com/cors8664"),0};const o5e=/\{([^\}]+)\}/g;function zne(e){return e==null?"":e}function Bg(e,t){return e.replace(o5e,typeof t=="object"?(i,r)=>zne(QM(r,t)):(i,r)=>zne(t(r)))}function PQ(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,i=>t&&t.includes(i)?i:`\\${i}`)}function IQ(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}function LNt(e){return new DOMParser().parseFromString(e||"","text/html").body.innerText||""}const Vne={info:0,warn:1,error:2,none:3};class ve{constructor(t){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},t.level!=null&&(this.level=t.level),t.writer!=null&&(this.writer=t.writer),this._module=t.module,ve._loggers[this.module]=this;const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=ve.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...t){this._log("error","always",...t)}warn(...t){this._log("warn","always",...t)}info(...t){this._log("info","always",...t)}errorOnce(...t){this._log("error","once",...t)}warnOnce(...t){this._log("warn","once",...t)}infoOnce(...t){this._log("info","once",...t)}errorOncePerTick(...t){this._log("error","oncePerTick",...t)}warnOncePerTick(...t){this._log("warn","oncePerTick",...t)}infoOncePerTick(...t){this._log("info","oncePerTick",...t)}get test(){const t=this;return{loggedMessages:t._loggedMessages,clearLoggedWarnings:()=>t._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(t={}){const i=ve._loggers;return ve._loggers=t,i},set throttlingDisabled(t){ve._throttlingDisabled=t}}}static getLogger(t){let i=ve._loggers[t];return i||(i=new ve({module:t})),i}_log(t,i,...r){if(!!this._matchLevel(t)){if(i!=="always"&&!ve._throttlingDisabled){const s=this._argsToKey(r),n=this._loggedMessages[t].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=ve._tickCounter)return;this._loggedMessages[t].set(s,ve._tickCounter),ve._scheduleTickCounterIncrement()}for(const s of or.log.interceptors)if(s(t,this.module,...r))return;this._inheritedWriter()(t,this.module,...r)}}_parentWithMember(t,i){let r=this;for(;_(r);){const s=r[t];if(_(s))return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(t,i,...r){console[t](`[${i}]`,...r)}_matchLevel(t){const i=or.log.level?or.log.level:"warn";return Vne[this._parentWithMember("level",i)]<=Vne[t]}_argsToKey(...t){const i=(r,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]";return IQ(JSON.stringify(t,i))}static _scheduleTickCounterIncrement(){ve._tickCounterScheduled||(ve._tickCounterScheduled=!0,Promise.resolve().then(()=>{ve._tickCounter++,ve._tickCounterScheduled=!1}))}}ve._loggers={},ve._tickCounter=0,ve._tickCounterScheduled=!1,ve._throttlingDisabled=!1;function Mn(e,t){for(const[i,r]of e)if(t(r,i))return!0;return!1}function DNt(e,t){for(const[i,r]of e)if(t(r,i))return r;return null}function $Q(e,t,i){const r=e.get(t);if(r!==void 0)return r;const s=i();return e.set(t,s),s}const sA=ve.getLogger("esri.core.Accessor");function a5e(e){return e==null?e:new Date(e)}function l5e(e){return e==null?e:!!e}function nL(e){return e==null?e:e.toString()}function tp(e){return e==null?e:(e=parseFloat(e),isNaN(e)?0:e)}function IV(e){return e==null?e:Math.round(parseFloat(e))}function lve(e){return e&&e.constructor&&e.constructor.__accessorMetadata__!==void 0}function Qk(e,t){return t!=null&&e&&!(t instanceof e)}function cve(e){return e&&"isCollection"in e}function Bne(e){return e&&e.Type?typeof e.Type=="function"?e.Type:e.Type.base:null}function c5e(e,t){if(!t||!t.constructor||!cve(t.constructor))return XH(e,t)?t:new e(t);const i=Bne(e.prototype.itemType),r=Bne(t.constructor.prototype.itemType);return i?r?i===r?t:i.prototype.isPrototypeOf(r.prototype)?new e(t):(XH(e,t),t):new e(t):t}function XH(e,t){return!!lve(t)&&(sA.error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+$V(e)+"'"),!0)}function xb(e,t){return t==null?t:cve(e)?c5e(e,t):Qk(e,t)?XH(e,t)?t:new e(t):t}function $V(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}const u5e=new WeakMap;function h5e(e){switch(e){case Number:return tp;case Zr:return IV;case Boolean:return l5e;case String:return nL;case Date:return a5e;default:return $Q(u5e,e,()=>xb.bind(null,e))}}function dn(e,t){const i=h5e(e);return arguments.length===1?i:i(t)}function E3(e,t,i){return arguments.length===1?E3.bind(null,e):t&&(Array.isArray(t)?t.map(r=>e(r,i)):[e(t,i)])}function d5e(e,t){return arguments.length===1?E3(dn.bind(null,e)):E3(dn.bind(null,e),t)}function uve(e,t,i){return t!==0&&Array.isArray(i)?i.map(r=>uve(e,t-1,r)):e(i)}function Kk(e,t,i){if(arguments.length===2)return Kk.bind(null,e,t);if(!i)return i;let r=t,s=i=uve(e,t,i);for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function p5e(e,t,i){return arguments.length===2?Kk(dn.bind(null,e),t):Kk(dn.bind(null,e),t,i)}function hve(e){return!!Array.isArray(e)&&!e.some(t=>{const i=typeof t;return!(i==="string"||i==="number"||i==="function"&&e.length>1)})}function YH(e,t){if(arguments.length===2)return YH(e).call(null,t);const i=new Set,r=e.filter(a=>typeof a!="function"),s=e.filter(a=>typeof a=="function");for(const a of e)typeof a!="string"&&typeof a!="number"||i.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(i.has(a)||s.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&s.some(p=>!Qk(a,p))?a:(h&&r.length?(n||(n=r.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),sA.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(p=>$V(p)).join(", ")),sA.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):sA.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function im(e,t){if(arguments.length===2)return im(e).call(null,t);const i={},r=[],s=[];for(const l in e.typeMap){const c=e.typeMap[l];i[l]=dn(c),r.push($V(c)),s.push(l)}const n=()=>`'${r.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof e.key=="string"?l=>l[e.key]:e.key;return l=>{if(e.base&&!Qk(e.base,l)||l==null)return l;const c=a(l)||e.defaultKeyValue,h=i[c];if(!h)return sA.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!Qk(e.typeMap[c],l))return l;if(typeof e.key=="string"&&!lve(l)){const p={};for(const f in l)f!==e.key&&(p[f]=l[f]);return h(p)}return h(l)}}class Zr{}const NNt={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function f5e(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function dve(e){switch(e.type){case"native":return dn(e.value);case"array":return E3(dve(e.value));case"one-of":return m5e(e);default:return null}}function m5e(e){let t=null;return(i,r)=>QH(i,e)?i:(t==null&&(t=JH(e)),sA.error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),r&&(r.valid=!1),null)}function JH(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Zr:return"integer";case Date:return"date";default:return $V(e.value)}case"array":return`array of ${JH(e.value)}`;case"one-of":{const t=e.values.map(i=>JH(i));return`one of ${t.slice(0,t.length-1)} or ${t[t.length-1]}`}}return"unknown"}function QH(e,t){if(e==null)return!0;switch(t.type){case"native":switch(t.value){case Number:case Zr:return typeof e=="number";case Boolean:return typeof e=="boolean";case String:return typeof e=="string"}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some(i=>!QH(i,t.value));case"one-of":return t.values.some(i=>QH(e,i))}}function CD(e){return He(IV(e),0,255)}function AD(e,t,i){return e=Number(e),isNaN(e)?i:e<t?t:e>i?i:e}class no{constructor(t){this.r=255,this.g=255,this.b=255,this.a=1,t&&this.setColor(t)}static blendColors(t,i,r,s=new no){return s.r=Math.round(t.r+(i.r-t.r)*r),s.g=Math.round(t.g+(i.g-t.g)*r),s.b=Math.round(t.b+(i.b-t.b)*r),s.a=t.a+(i.a-t.a)*r,s._sanitize()}static fromRgb(t,i){const r=t.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),n=r[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),no.fromArray(a,i)}return no.fromArray(s.map(a=>parseFloat(a)),i)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return no.fromArray(S0e(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(t,i=new no){if(t.length!==4&&t.length!==7||t[0]!=="#")return null;const r=t.length===4?4:8,s=(1<<r)-1;let n=Number("0x"+t.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=r,i[o]=r===4?17*a:a}),i.a=1,i)}static fromArray(t,i=new no){return i._set(Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(t,i){const r=T0e(t)?vQ(t):null;return r&&no.fromArray(r,i)||no.fromRgb(t,i)||no.fromHex(t,i)}static fromJSON(t){return t&&new no([t[0],t[1],t[2],t[3]/255])}static toUnitRGB(t){return _(t)?[t.r/255,t.g/255,t.b/255]:null}static toUnitRGBA(t){return _(t)?[t.r/255,t.g/255,t.b/255,t.a!=null?t.a:1]:null}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(t){var i,r,s,n;return typeof t=="string"?no.fromString(t,this):Array.isArray(t)?no.fromArray(t,this):(this._set((i=t.r)!=null?i:0,(r=t.g)!=null?r:0,(s=t.b)!=null?s:0,(n=t.a)!=null?n:1),t instanceof no||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const t=this.r.toString(16),i=this.g.toString(16),r=this.b.toString(16);return`#${t.length<2?"0"+t:t}${i.length<2?"0"+i:i}${r.length<2?"0"+r:r}`}toCss(t=!1){const i=this.r+", "+this.g+", "+this.b;return t?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(t=no.AlphaMode.ALWAYS){const i=CD(this.r),r=CD(this.g),s=CD(this.b);return t===no.AlphaMode.ALWAYS||this.a!==1?[i,r,s,CD(255*this.a)]:[i,r,s]}clone(){return new no(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(t){return _(t)&&t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a}_sanitize(){return this.r=Math.round(AD(this.r,0,255)),this.g=Math.round(AD(this.g,0,255)),this.b=Math.round(AD(this.b,0,255)),this.a=AD(this.a,0,1),this}_set(t,i,r,s){this.r=t,this.g=i,this.b=r,this.a=s}}no.prototype.declaredClass="esri.Color",function(e){var t;(t=e.AlphaMode||(e.AlphaMode={}))[t.ALWAYS=0]="ALWAYS",t[t.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(no||(no={}));const Le=no;function u(e,t,i,r){var s,n=arguments.length,o=n<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o}function FNt(e){const t=[];return function*(){yield*t;for(const i of e)t.push(i),yield i}}function kNt(e,t){for(const i of e)if(i!=null&&t(i))return i}function pve(e){return e!=null&&typeof e[Symbol.iterator]=="function"}function td(e){return Fo(()=>e.forEach(t=>_(t)&&t.remove()))}function Fo(e){return{remove:()=>{e&&(e(),e=void 0)}}}function UNt(e){return Fo(()=>{const t=e();_(t)&&t.remove()})}function zNt(e){return Fo(_(e)?()=>e.destroy():void 0)}function g5e(e,t){const i=setTimeout(e,t);return Fo(()=>clearTimeout(i))}function ho(e){return e?e.__accessor__?e.__accessor__:e.propertyInvalidated?e:null:null}function y5e(e,t){return e!=null&&e.metadatas&&e.metadatas[t]!=null}function F4(e,t,i){return i?eU(e,t,{policy:i,path:""}):eU(e,t,null)}function eU(e,t,i){return t?Object.keys(t).reduce((r,s)=>{let n=null,o="merge";if(i&&(n=i.path?`${i.path}.${s}`:s,o=i.policy(n)),o==="replace")return r[s]=t[s],r;if(r[s]===void 0)return r[s]=ue(t[s]),r;let a=r[s],l=t[s];if(a===l)return r;if(Array.isArray(l)||Array.isArray(r))a=a?Array.isArray(a)?r[s]=a.concat():r[s]=[a]:r[s]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(c=>{a.includes(c)||a.push(c)}));else if(l&&typeof l=="object")if(i){const c=i.path;i.path=n,r[s]=eU(a,l,i),i.path=c}else r[s]=eU(a,l,null);else r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=l);return r},e||{}):e}function fve(e){return Array.isArray(e)?e:e.split(".")}function Gne(e){return e.includes(",")?e.split(",").map(t=>t.trim()):[e.trim()]}function v5e(e){if(Array.isArray(e)){const t=[];for(const i of e)t.push(...Gne(i));return t}return Gne(e)}function mve(e,t,i,r){const s=v5e(t);if(s.length!==1){const n=s.map(o=>r(e,o,i));return td(n)}return r(e,s[0],i)}function LQ(e){let t=!1;return()=>{t||(t=!0,e())}}function gve(e,t){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.getItemAt(s)}const r=ho(t);return y5e(r,i)?r.get(i):t[i]}function yve(e,t,i){if(e==null)return e;const r=gve(t[i],e);return!r&&i<t.length-1?void 0:i===t.length-1?r:yve(r,t,i+1)}function oL(e,t,i=0){return typeof t!="string"||t.includes(".")?yve(e,fve(t),i):gve(t,e)}function tU(e,t){return oL(e,t)}function jne(e,t){return oL(t,e)!==void 0}var xg;(function(e){e[e.INITIALIZING=0]="INITIALIZING",e[e.CONSTRUCTING=1]="CONSTRUCTING",e[e.CONSTRUCTED=2]="CONSTRUCTED"})(xg||(xg={}));class Hne{constructor(t){this.autoDestroy=!1,this.properties=t}}function aL(e){let t=e.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!i){const r=Object.create(t.properties),s=t.autoDestroy;for(const n in r)r[n]=ue(r[n]);t=new Hne(r),t.autoDestroy=s,Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t=new Hne({}),Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function _5e(e){return aL(e).properties}function lL(e,t){const i=_5e(e);let r=i[t];return r||(r=i[t]={}),r}function b5e(e,t){return F4(e,t,x5e)}const w5e=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function x5e(e){return w5e.test(e)?"replace":"merge"}function T5e(e){return e&&e.release&&typeof e.release=="function"}function S5e(e){return e&&e.acquire&&typeof e.acquire=="function"}class un{constructor(t,i,r,s=1,n=0){if(this.ctor=t,this.acquireFunction=i,this.releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this.ctor)for(let o=0;o<n;o++)this._pool[o]=new this.ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...t){let i;if(un.test.disabled)i=new this.ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this.ctor}i=this._pool.pop()}return this.acquireFunction?this.acquireFunction(i,...t):S5e(i)&&i.acquire(...t),i}release(t){t&&!un.test.disabled&&(this.releaseFunction?this.releaseFunction(t):T5e(t)&&t.release(),this._pool.push(t))}prune(t=this._initialSize){if(!(t>=this._pool.length)){for(let i=t;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=t}}_dispose(t){t.dispose&&typeof t.dispose=="function"&&t.dispose()}}un.test={disabled:!1};var st;(function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.USER=6]="USER"})(st||(st={}));const KH=st.USER+1;function Hh(e){switch(e){case"defaults":return st.DEFAULTS;case"service":return st.SERVICE;case"portal-item":return st.PORTAL_ITEM;case"web-scene":return st.WEB_SCENE;case"web-map":return st.WEB_MAP;case"user":return st.USER}}function C3(e){switch(e){case st.DEFAULTS:return"defaults";case st.SERVICE:return"service";case st.PORTAL_ITEM:return"portal-item";case st.WEB_SCENE:return"web-scene";case st.WEB_MAP:return"web-map";case st.USER:return"user"}return void 0}function E5e(e){return C3(e)}var Gr;(function(e){e[e.Dirty=1]="Dirty",e[e.Overriden=2]="Overriden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"})(Gr||(Gr={}));let iU,aP=[];const C5e=ve.getLogger("esri.core.Accessor");function bi(e){iU!==void 0&&iU.onObservableAccessed(e)}let k4=!1,U4=!1;function uv(e,t,i){if(k4)return DQ(e,t,i);vve(e);const r=t.call(i);return _ve(),r}function A5e(e,t){return uv(void 0,e,t)}function DQ(e,t,i){const r=k4;k4=!0,vve(e);let s=null;try{s=t.call(i)}catch(n){U4&&C5e.error(n)}return _ve(),k4=r,s}function vve(e){iU=e,aP.push(e)}function _ve(){const e=aP.pop();iU=aP.length>0?aP[aP.length-1]:void 0,e!==void 0&&e.onTrackingEnd()}function bve(e,t){if(t.flags&Gr.DepTrackingInitialized)return;const i=U4;U4=!1,t.flags&Gr.AutoTracked?DQ(t,t.metadata.get,e):wve(e,t),U4=i}const M5e=[];function wve(e,t){t.flags&Gr.ExplicitlyTracking||(t.flags|=Gr.ExplicitlyTracking,DQ(t,()=>{const i=t.metadata.dependsOn||M5e;for(const r of i)if(typeof r!="string"||r.includes(".")){const s=fve(r);for(let n=0,o=e;n<s.length&&o!=null&&typeof o=="object";++n)o=qne(o,s[n],n!==s.length-1)}else qne(e,r,!1)}),t.flags&=~Gr.ExplicitlyTracking)}function qne(e,t,i){var n;const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const o=parseInt(r,10);if(!isNaN(o))return Array.isArray(e)?e[o]:e.getItemAt(o)}const s=(n=ho(e))==null?void 0:n.properties.get(r);return s&&(bi(s),bve(e,s)),i?e[r]:void 0}class xve{constructor(t,i){this._observers=t,this._observer=i}remove(){MQ(this._observers,this._observer)}}class Wne{constructor(t,i,r){this.properties=t,this.propertyName=i,this.metadata=r,this._observers=null,this._accessed=null,this._handles=null,this.flags=Gr.Dirty|(r.nonNullable?Gr.NonNullable:0)|(r.hasOwnProperty("value")?Gr.HasDefaultValue:0)|(r.get===void 0?Gr.DepTrackingInitialized:0)|(r.dependsOn===void 0?Gr.AutoTracked:0)}destroy(){if(this.flags&Gr.Dirty&&this._observers){const t=this._observers.slice();for(const i of t)i.onCommitted()}this._accessed=null,this._observers=null,this._clearObservationHandles()}getComputed(){bi(this);const t=this.properties.store,i=this.propertyName,r=this.flags,s=t.get(i);if(r&Gr.Computing||~r&Gr.Dirty&&t.has(i))return s;this.flags|=Gr.Computing;const n=this.properties.host;let o;r&Gr.AutoTracked?o=uv(this,this.metadata.get,n):(wve(n,this),o=this.metadata.get.call(n)),t.set(i,o,st.COMPUTED);const a=t.get(i);return a===s?this.flags&=~Gr.Dirty:A5e(this.commit,this),this.flags&=~Gr.Computing,a}onObservableAccessed(t){t!==this&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(t)||this._accessed.push(t))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=Gr.DepTrackingInitialized;const t=this._accessed;if(t===null)return;let i=this._handles;i===null&&(i=this._handles=[]);for(let r=0;r<t.length;++r)i.push(t[r].observe(this));t.length=0}observe(t){return this._observers===null&&(this._observers=[]),this._observers.includes(t)||this._observers.push(t),new xve(this._observers,t)}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}onInvalidated(){~this.flags&Gr.Overriden&&(this.flags|=Gr.Dirty);const t=this._observers;if(t!==null)for(let i=0;i<t.length;++i)t[i].onInvalidated()}commit(){this.flags&=~Gr.Dirty,this.onCommitted()}onCommitted(){if(this._observers===null)return;const t=this._observers.slice();for(let i=0;i<t.length;++i)t[i].onCommitted()}_clearObservationHandles(){const t=this._handles;if(t!==null){for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}}class NQ{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new NQ;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,ue(r))}),i}get(t){return this._values.get(t)}originOf(){return st.USER}keys(){return[...this._values.keys()]}set(t,i){this._values.set(t,i)}delete(t){this._values.delete(t)}has(t){return this._values.has(t)}forEach(t){this._values.forEach(t)}}function MD(e,t,i){return e!==void 0}function Zne(e,t,i,r){return e!==void 0&&(!(i==null&&e.flags&Gr.NonNullable)||(r.lifecycle,xg.INITIALIZING,!1))}function O5e(e){return e&&typeof e.destroy=="function"}ve.getLogger("esri.core.accessorSupport.Properties");class R5e{constructor(t){this.host=t,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=xg.INITIALIZING,this.store=new NQ,this._origin=st.USER;const i=this.host.constructor.__accessorMetadata__,r=i.properties;for(const s in r){const n=new Wne(this,s,r[s]);this.properties.set(s,n)}this.metadatas=r,this._autoDestroy=i.autoDestroy}initialize(){this.lifecycle=xg.CONSTRUCTING}constructed(){this.lifecycle=xg.CONSTRUCTED}destroy(){if(this.destroyed=!0,this._autoDestroy)for(const[t,i]of this.properties){const r=this.internalGet(t);r&&O5e(r)&&(r.destroy(),~i.flags&Gr.NonNullable&&this._internalSet(i,null)),i.destroy()}else for(const[t,i]of this.properties)i.destroy()}get initialized(){return this.lifecycle!==xg.INITIALIZING}get(t){const i=this.properties.get(t);if(i.metadata.get)return i.getComputed();bi(i);const r=this.store;return r.has(t)?r.get(t):i.metadata.value}originOf(t){const i=this.store.originOf(t);if(i===void 0){const r=this.properties.get(t);if(r!==void 0&&r.flags&Gr.HasDefaultValue)return"defaults"}return C3(i)}has(t){return!!this.properties.has(t)&&this.store.has(t)}keys(){return[...this.properties.keys()]}internalGet(t){const i=this.properties.get(t);if(MD(i))return this.store.has(t)?this.store.get(t):i.metadata.value}internalSet(t,i){const r=this.properties.get(t);MD(r)&&this._internalSet(r,i)}getDependsInfo(t,i,r){const s=this.properties.get(i);if(!MD(s))return"";const n=new Set,o=uv({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(t)});let a=`${r}${t.declaredClass.split(".").pop()}.${i}: ${o}
`;if(n.size===0)return a;r+="  ";for(const l of n){if(!(l instanceof Wne))continue;const c=l.properties.host,h=l.propertyName,p=ho(c);a+=p?p.getDependsInfo(c,h,r):`${r}${h}: undefined
`}return a}setAtOrigin(t,i,r){const s=this.properties.get(t);if(MD(s))return this._setAtOrigin(s,i,r)}isOverridden(t){const i=this.properties.get(t);return i!==void 0&&!!(i.flags&Gr.Overriden)}clearOverride(t){const i=this.properties.get(t);i!==void 0&&i.flags&Gr.Overriden&&(i.flags&=~Gr.Overriden,i.notifyChange())}override(t,i){const r=this.properties.get(t);if(!Zne(r,t,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:o,value:a}=n;if(SG.release(n),!o)return;i=a}r.flags|=Gr.Overriden,this._internalSet(r,i)}set(t,i){const r=this.properties.get(t);if(!Zne(r,t,i,this))return;const s=r.metadata.cast;if(s){const o=this._cast(s,i),{valid:a,value:l}=o;if(SG.release(o),!a)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(t){this._origin=Hh(t)}getDefaultOrigin(){return C3(this._origin)}notifyChange(t){const i=this.properties.get(t);i!==void 0&&i.notifyChange()}invalidate(t){const i=this.properties.get(t);i!==void 0&&i.invalidate()}commit(t){const i=this.properties.get(t);i!==void 0&&i.commit()}_internalSet(t,i){const r=this.lifecycle!==xg.INITIALIZING?this._origin:st.DEFAULTS;this._setAtOrigin(t,i,r)}_setAtOrigin(t,i,r){const s=this.store,n=t.propertyName;s.has(n,r)&&RQ(i,s.get(n))&&~t.flags&Gr.Overriden&&r===s.originOf(n)||(t.invalidate(),s.set(n,i,r),t.commit(),bve(this.host,t))}_cast(t,i){const r=SG.acquire();return r.valid=!0,r.value=i,t&&(r.value=t.call(this.host,i,r)),r}}class P5e{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}}const SG=new un(P5e);function I5e(e,t){return e.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(i,r)=>{if(r==="")return"$";const s=QM(r,t),n=s==null?"":s;if(n===void 0)throw new Error(`could not find key "${r}" in template`);return n.toString()})}class LV{constructor(t,i,r){this.name=t,this.details=r,this.message=void 0,this instanceof LV&&(this.message=i&&I5e(i,r)||"")}toString(){return"["+this.name+"]: "+this.message}}class W extends LV{constructor(t,i,r){if(super(t,i,r),!(this instanceof W))return new W(t,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(t,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return ue(i)}catch{return"[object]"}}))}}catch(t){throw ve.getLogger("esri.core.Error").error(t),t}return{name:this.name,message:this.message,details:this.details}}static fromJSON(t){return new W(t.name,t.message,t.details)}}W.prototype.type="error";function rU(e,t,i){if(e&&t)if(typeof t=="object")for(const r of Object.getOwnPropertyNames(t))rU(e,r,t[r]);else{if(t.includes(".")){const s=t.split("."),n=s.splice(s.length-1,1)[0];return void rU(tU(e,s),n,i)}const r=e.__accessor__;r!=null&&$5e(t,r),e[t]=i}}function $5e(e,t){if(ye("esri-unknown-property-errors")&&!L5e(e,t))throw new W("set:unknown-property",D5e(e,t))}function L5e(e,t){return t.metadatas[e]!=null}function D5e(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}ve.getLogger("esri.core.accessorSupport.set");function N5e(e){e.length=0}class Eu{constructor(t=50,i=50){this._pool=new un(Array,void 0,N5e,i,t)}acquire(){return this._pool.acquire()}release(t){this._pool.release(t)}prune(){this._pool.prune(0)}static acquire(){return EG.acquire()}static release(t){return EG.release(t)}static prune(){EG.prune()}}const EG=new Eu(100);class Tve extends un{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=V4e(this._set)}acquire(...t){const i=super.acquire(...t);return this._set.delete(i),i}release(t){t&&!this._set.has(t)&&(super.release(t),this._set.add(t))}_dispose(t){this._set.delete(t),super._dispose(t)}}const OD=[];function zA(e){OD.push(e),OD.length===1&&queueMicrotask(()=>{const t=OD.slice();OD.length=0;for(const i of t)i()})}const F5e=29;class cb{constructor(t,i=F5e){this.name=t,this._counter=0,this._items=new Array(i)}record(t){this._items[++this._counter%this._items.length]=t}get median(){return this._items.slice().sort((t,i)=>t-i)[Math.floor(this._items.length/2)]}get average(){return this._items.reduce((t,i)=>t+i,0)/this._items.length}get last(){return this._items[this._counter%this._items.length]}}var eq;(function(e){const t=(n,o,a,l)=>{let c=o,h=o;const p=a>>>1,f=n[c-1];for(;h<=p;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const m=n[h-1];if(l(m,f)<=0)break;n[c-1]=m,c=h}n[c-1]=f},i=(n,o)=>n<o?-1:n>o?1:0;function r(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)t(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)t(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l),yield}}e.sort=r,e.iterableSort=s})(eq||(eq={}));const Xne=eq,k5e=1.5,U5e=1.1;class ai{constructor(t){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new W0e,t&&(t.initialSize&&(this.data=new Array(t.initialSize)),t.allocator&&(this._allocator=t.allocator),t.deallocator!==void 0&&(this._deallocator=t.deallocator),t.shrink&&(this._shrink=()=>Yne(this)))}toArray(){return this.data.slice(0,this.length)}filter(t){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];t(s)&&i.push(s)}return i}getItemAt(t){if(!(t<0||t>=this._length))return this.data[t]}includes(t,i){const r=this.data.indexOf(t,i);return r!==-1&&r<this.length}get length(){return this._length}set length(t){if(t>this._length){if(this._allocator){for(;this._length<t;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=t}else{if(this._deallocator)for(let i=t;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=t,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(t){this.data[this._length++]=t}pushArray(t,i=t.length){for(let r=0;r<i;r++)this.data[this._length++]=t[r]}fill(t,i){for(let r=0;r<i;r++)this.data[this._length++]=t}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const t=this.data[this._length];return++this._length,t}unshift(t){this.data.unshift(t),this._length++,Yne(this)}pop(){if(this.length===0)return;const t=this.data[this.length-1];return this.length=this.length-1,this._shrink(),t}remove(t){const i=X0e(this.data,t,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,t}removeUnordered(t){const i=PV(this.data,t,this.length,this._hint);return i!==void 0&&(this.length=this.length-1),this._shrink(),i}removeUnorderedIndex(t){if(!(t>=this.length||t<0))return this.swapElements(t,this.length-1),this.pop()}removeUnorderedMany(t,i=t.length,r){this.length=Y4e(this.data,t,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(t,i){t>=this.length||i>=this.length||t===i||([this.data[t],this.data[i]]=[this.data[i],this.data[t]])}sort(t){Xne.sort(this.data,0,this.length,t)}iterableSort(t){return Xne.iterableSort(this.data,0,this.length,t)}some(t,i){for(let r=0;r<this.length;++r)if(t.call(i,this.data[r],r,this.data))return!0;return!1}filterInPlace(t,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];t.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(t,i){const r=this.length,s=this.data;for(let n=0;n<r;++n)t.call(i,s[n],n,s)}forEach(t,i){for(let r=0;r<this.length;++r)t.call(i,this.data[r],r,this.data)}map(t,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=t.call(i,this.data[s],s,this.data);return r}reduce(t,i){let r=i;for(let s=0;s<this.length;++s)r=t(r,this.data[s],s,this.data);return r}has(t){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===t)return!0;return!1}}function Yne(e){e.data.length>k5e*e.length&&(e.data.length=Math.floor(e.length*U5e))}function z5e(e){return{setTimeout:(t,i)=>{const r=e.setTimeout(t,i);return{remove:()=>e.clearTimeout(r)}}}}const DV=z5e(globalThis),Jne=new Set;function V5e(e,t,i=!1){i&&Jne.has(t)||(i&&Jne.add(t),e.warn(`\u{1F6D1} DEPRECATED - ${t}`))}function B5e(e,t,i={}){if(ye("esri-deprecation-warnings")){const{moduleName:r}=i;Sve(e,`Property: ${(r?r+"::":"")+t}`,i)}}function Sve(e,t,i={}){if(ye("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:o}=i;let a=t;r&&(a+=`
	\u{1F6E0}\uFE0F Replacement: ${r}`),s&&(a+=`
	\u2699\uFE0F Version: ${s}`),n&&(a+=`
	\u{1F517} See ${n} for more details.`),V5e(e,a,o)}}function NV(e){return e&&(typeof e.on=="function"||typeof e.addEventListener=="function")}function jS(e,t,i){if(!NV(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,i);if(Array.isArray(t)){const r=t.slice();for(const s of r)e.addEventListener(s,i);return{remove(){for(const s of r)e.removeEventListener(s,i)}}}return e.addEventListener(t,i),{remove(){e.removeEventListener(t,i)}}}function Eve(e,t,i){if(!NV(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,i);const r=jS(e,t,s=>{r.remove(),i.call(e,s)});return{remove(){r.remove()}}}function G5e(e,t,i){let r=!1;const s=jS(e,t,n=>{r||i.call(e,n)});return{resume(){r=!1},pause(){r=!0},remove(){s.remove()}}}const j5e={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function Mc({key:e}){return j5e[e]||e}function mi(e="Aborted"){return new W("AbortError",e)}function qt(e,t="Aborted"){if(an(e))throw mi(t)}function FV(e){return _(e)?"aborted"in e?e:e.signal:e}function an(e){const t=FV(e);return _(t)&&t.aborted}function cl(e){if(as(e))throw e}function sU(e){if(!as(e))throw e}function va(e,t){const i=FV(e);if(!M(i)){if(!i.aborted)return Eve(i,"abort",()=>t());t()}}function kV(e,t){const i=FV(e);if(!M(i))return qt(i),Eve(i,"abort",()=>t(mi()))}function VT(e,t){const i=FV(t);return M(i)?e:new Promise((r,s)=>{let n=va(t,()=>s(mi()));const o=()=>n=hn(n);e.then(o,o),e.then(r,s)})}function as(e){return e&&e.name==="AbortError"}async function VA(e){try{return await e}catch(t){if(!as(t))throw t}}async function VNt(e,t=ve.getLogger("esri")){try{return await e}catch(i){as(i)||t.error(i)}}function hv(){let e=null;const t=new Promise((i,r)=>{e={promise:void 0,resolve:i,reject:r}});return e.promise=t,e}async function Us(e){if(!e)return;if(typeof e.forEach!="function"){const i=Object.keys(e),r=i.map(o=>e[o]),s=await Us(r),n={};return i.map((o,a)=>n[o]=s[a]),n}const t=e;return new Promise(i=>{const r=[];let s=t.length;s===0&&i(r),t.forEach(n=>{const o={promise:n||Promise.resolve(n)};r.push(o),o.promise.then(a=>{o.value=a}).catch(a=>{o.error=a}).then(()=>{--s,s===0&&i(r)})})})}async function Cve(e){return(await Us(e)).filter(t=>!!t.value).map(t=>t.value)}function nS(e,t,i){const r=new AbortController;return va(i,()=>r.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(t)},e);va(r,()=>{o&&(clearTimeout(o),n(mi()))})})}function qu(e){return e&&typeof e.then=="function"}function tq(e){return qu(e)?e:Promise.resolve(e)}function UV(e,t=-1){let i,r,s,n,o=null;const a=(...l)=>{if(i){r=l,n&&n.reject(mi()),n=hv();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||hv(),n=null,t>0){const f=new AbortController;i=tq(e(...l,f.signal));const m=i;nS(t).then(()=>{i===m&&(n?f.abort():o=f)})}else i=1,i=tq(e(...l));const c=()=>{const f=r;r=s=i=o=null,f!=null&&a(...f)},h=i,p=s;return h.then(c,c),h.then(p.resolve,p.reject),p.promise};return a}function rm(){let e,t;const i=new Promise((s,n)=>{e=s,t=n}),r=s=>{e(s)};return r.resolve=s=>e(s),r.reject=s=>t(s),r.timeout=(s,n)=>DV.setTimeout(()=>r.reject(n),s),r.promise=i,r}function BNt(e,t){return e.then(t,t)}function Pv(e,t){let i,r=new AbortController;const s=e(r.signal);let n={promise:s,finished:!1,abort:()=>{r&&(r.abort(),r=null)}};const o=()=>{n&&(n.finished=!0,n=null),_(i)&&(i.remove(),i=null),r=null};return s.then(o,o),i=va(t,()=>{_(n)&&n.abort()}),n}async function Qne(e){await Promise.resolve(),qt(e)}function Ave(e){return 1e3*e}function FQ(e){return .001*e}class H5e{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}}class q5e{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}}let iq=0,rq=0;const zO={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},sq=["prepare","preRender","render","postRender","update","finish"],nq=[],oS=new ai;class W5e{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const nU={frameTasks:oS,willDispatch:!1,clearFrameTasks:Z5e,dispatch:Rve,executeFrameTasks:Y5e};function Zb(e){const t=new q5e(e);return nq.push(t),nU.willDispatch||(nU.willDispatch=!0,zA(Rve)),t}function aS(e){const t=new H5e(e);return oS.push(t),oU==null&&(iq=performance.now(),oU=requestAnimationFrame(Mve)),new W5e(t)}let oU=null;function Z5e(e=!1){oS.forAll(t=>{t.removed=!0}),e&&Ove()}function X5e(e){rq=Math.max(0,e)}function Mve(){const e=performance.now();oU=null,oU=oS.length>0?requestAnimationFrame(Mve):null,nU.executeFrameTasks(e)}function Y5e(e){const t=e-iq;iq=e;const i=rq>0?rq:1e3/60,r=Math.max(0,t-i);for(let s=0;s<sq.length;s++){const n=performance.now(),o=sq[s];oS.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(zO.time=e,zO.deltaTime=a.ticks===0?0:t,zO.elapsedFrameTime=performance.now()-e,zO.frameDuration=i-r,(l=a.phases[o])==null||l.call(a,zO)))}),Q5e[s].record(performance.now()-n)}Ove(),K5e.record(performance.now()-e)}const RD=new ai;function Ove(){oS.forAll(e=>{e.removed&&RD.push(e)}),oS.removeUnorderedMany(RD.data,RD.length),RD.clear()}function Rve(){for(;nq.length;){const e=nq.shift();e.isActive&&e.callback()}nU.willDispatch=!1}function J5e(e=1,t){const i=rm(),r=()=>{an(t)?i.reject(mi()):e===0?i():(--e,zA(()=>r()))};return r(),i.promise}const Q5e=sq.map(e=>new cb(e)),K5e=new cb("total");function z4(e,t){for(const i of e.entries())if(t(i[0]))return!0;return!1}function eke(e,t){const i=new Set;return _(e)&&e.forEach(r=>i.add(r)),_(t)&&t.forEach(r=>i.add(r)),i}let tke=0;const ike=0;function Dc(){return++tke}class zV{constructor(t){this._notify=t,this._accessed=[],this._handles=[],this._invalidCount=0}destroy(){this._accessed.length=0,this.clear()}onInvalidated(){this._invalidCount++}onCommitted(){const t=this._invalidCount;if(t===1)return this._invalidCount=0,void this._notify();this._invalidCount=t>0?t-1:0}onObservableAccessed(t){this._accessed.includes(t)||this._accessed.push(t)}onTrackingEnd(){const t=this._handles,i=this._accessed;for(let r=0;r<i.length;++r)t.push(i[r].observe(this));i.length=0}clear(){const t=this._handles;for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}let nA=!1;const aU=[];function Pve(e,t){let i=new zV(n),r=null,s=!1;function n(){if(!i||s)return;if(nA)return void Lve(n);const a=r;i.clear(),nA=!0,s=!0,r=uv(i,e),s=!1,nA=!1,t(r,a),Dve()}function o(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=uv(i,e),s=!1,{remove:o}}function Ive(e,t){let i=new zV(s),r=null;function s(){t(r,o)}function n(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=uv(i,e),r):null}return o(),{remove:n}}function $ve(e){let t=new zV(r),i=!1;function r(){t&&!i&&(nA?Lve(r):(t.clear(),nA=!0,i=!0,uv(t,e),i=!1,nA=!1,Dve()))}function s(){t&&(t.destroy(),t=null)}return i=!0,uv(t,e),i=!1,{remove:s}}function Lve(e){aU.includes(e)||aU.unshift(e)}function Dve(){for(;aU.length;)aU.pop()()}var RI;(function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"})(RI||(RI={}));class A3{constructor(){this.uid=Dc(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(t,i,r,s,n){return this.pool.acquire(RI.Untracked,t,i,r,s,n,RQ)}static acquireTracked(t,i,r,s){return this.pool.acquire(RI.Tracked,t,i,r,null,null,s)}notify(t,i){this.type===RI.Untracked?this.callback.call(this.target,t,i,this.path,this.target):this.callback.call(null,t,i)}acquire(t,i,r,s,n,o,a){this.uid=Dc(),this.removed=!1,this.type=t,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Dc(),this.removed=!0}}A3.pool=new Tve(A3);const V4=new Eu,Z0=new Set;let lU;function cU(e){Z0.delete(e),Z0.add(e),lU||(lU=Zb(nke))}function rke(e){if(e.removed)return;const t=e.oldValue,i=e.getValue();e.equals(t,i)||(e.oldValue=i,e.notify(i,t))}function ske(e){for(const t of Z0.values())t.target===e&&(t.removed=!0)}function nke(){let e=10;for(;lU&&e--;){lU=null;const t=oke(),i=V4.acquire();for(const r of t){const s=r.uid;rke(r),s===r.uid&&r.removed&&i.push(r)}for(const r of Z0)r.removed&&(i.push(r),Z0.delete(r));for(const r of i)A3.pool.release(r);V4.release(i),V4.release(t),oq.forEach(r=>r())}}function oke(){const e=V4.acquire();e.length=Z0.size;let t=0;for(const i of Z0)e[t]=i,++t;return Z0.clear(),e}const oq=new Set;function Nve(e){return oq.add(e),{remove(){oq.delete(e)}}}function ake(e,t,i){let r=mve(e,t,i,(s,n,o)=>{let a,l,c=Ive(()=>oL(s,n),(h,p)=>{s.__accessor__.destroyed||a&&a.uid!==l?r.remove():(a||(a=A3.acquireUntracked(h,o,p,s,n),l=a.uid),cU(a))});return{remove:LQ(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,cU(a)),a=null),r=c=null})}});return r}function lke(e,t,i){const r=mve(e,t,i,(s,n,o)=>{let a=!1;return Pve(()=>oL(s,n),(l,c)=>{s.__accessor__.destroyed?r.remove():a||(a=!0,RQ(c,l)||o.call(s,l,c,n,s),a=!1)})});return r}function cke(e,t,i,r=!1){return!e.__accessor__||e.__accessor__.destroyed?{remove(){}}:r?lke(e,t,i):ake(e,t,i)}function uke(e,t,i){let r,s,n=Ive(e,(o,a)=>{r&&r.uid!==s?n.remove():(r||(r=A3.acquireTracked(o,t,a,i),s=r.uid),cU(r))});return{remove:LQ(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,cU(r)),r=null),n=null})}}function hke(e,t,i){let r=!1;return Pve(e,(s,n)=>{r||(r=!0,i(n,s)||t(s,n),r=!1)})}function dke(e,t,i=!1,r=i5e){return i?hke(e,t,r):uke(e,t,r)}function Kne(e){return z4(Z0,t=>t.oldValue===e)}function d(e={}){return(t,i)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(t,i),s=lL(t,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in e&&ve.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${t.constructor.name}" already defined in the metadata`,e),s.value=e.value=r.value)),e.readOnly!=null&&(s.readOnly=e.readOnly);const n=e.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let p=tU(this,l);if(typeof p=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=tU(this,h);f&&(p=p.bind(f))}return p},s.readOnly||(s.set=c?function(p){p!==void 0?this._override(i,p):this._clearOverride(i)}:function(p){rU(this,l,p)})}const o=e.type,a=e.types;s.cast||(o?s.cast=pke(o):a&&(Array.isArray(a)?s.cast=E3(im(a[0])):s.cast=im(a))),e.range&&(s.cast=fke(s.cast,e.range)),b5e(s,e)}}function kQ(e,t,i){const r=lL(e,i);r.json||(r.json={});let s=r.json;return t!==void 0&&(s.origins||(s.origins={}),s.origins[t]||(s.origins[t]={}),s=s.origins[t]),s}function pke(e){let t=0,i=e;if(f5e(e))return dve(e);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],t++;const r=i;if(hve(r))return t===0?YH(r):Kk(YH(r),t);if(t===1)return d5e(r);if(t>1)return p5e(r,t);const s=e;return s.from?s.from:dn(s)}function fke(e,t){return i=>{let r=+e(i);return t.step!=null&&(r=Math.round(r/t.step)*t.step),t.min!=null&&(r=Math.max(t.min,r)),t.max!=null&&(r=Math.min(t.max,r)),r}}function mke(e){if(e.json&&e.json.origins){const t=e.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(t[r]){const s=t[r];i[r].forEach(n=>{t[n]=s}),delete t[r]}}}class Uc extends LV{constructor(t,i,r){if(super(t,i,r),!(this instanceof Uc))return new Uc(t,i,r)}}Uc.prototype.type="warning";function Fve(e){return!!e&&e.prototype&&e.prototype.declaredClass&&e.prototype.declaredClass.indexOf("esri.core.Collection")===0}const aq=ve.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function eoe(e,t,i){var r,s;e&&(!i&&!t.read||((r=t.read)==null?void 0:r.reader)||((s=t.read)==null?void 0:s.enabled)===!1||vke(e)&&Bu("read.reader",KM(e),t))}function KM(e){var i,r,s;const t=(i=e.ndimArray)!=null?i:0;if(t>1)return yke(e);if(t===1)return toe(e);if("type"in e&&Uve(e.type)){const n=(s=(r=e.type.prototype)==null?void 0:r.itemType)==null?void 0:s.Type,o=toe(typeof n=="function"?{type:n}:{types:n});return(a,l,c)=>{const h=o(a,l,c);return h&&new e.type(h)}}return UQ(e)}function UQ(e){return"type"in e?gke(e.type):_ke(e.types)}function gke(e){return e.prototype.read?(t,i,r)=>{if(t==null)return t;const s=typeof t;if(s!=="object")return void aq.error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${s}'`);const n=new e;return n.read(t,r),n}:e.fromJSON}function kve(e,t,i,r){return r!==0&&Array.isArray(t)?t.map(s=>kve(e,s,i,r-1)):e(t,void 0,i)}function yke(e){var s;const t=UQ(e),i=kve.bind(null,t),r=(s=e.ndimArray)!=null?s:0;return(n,o,a)=>{if(n==null)return n;n=i(n,a,r);let l=r,c=n;for(;l>0&&Array.isArray(c);)l--,c=c[0];if(c!==void 0)for(let h=0;h<l;h++)n=[n];return n}}function toe(e){const t=UQ(e);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=t(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=t(i,void 0,s);return n!==void 0?[n]:void 0}}function Uve(e){if(!Fve(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&(typeof t.Type=="function"?zQ(t.Type):zve(t.Type))}function vke(e){return"types"in e?zve(e.types):zQ(e.type)}function zQ(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||Uve(e))}function zve(e){for(const t in e.typeMap)if(!zQ(e.typeMap[t]))return!1;return!0}function _ke(e){var r;let t=null;const i=(r=e.errorContext)!=null?r:"type";return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void aq.error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);t||(t=bke(e));const l=e.key;if(typeof l!="string")return;const c=s[l],h=c?t[c]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!h){const f=`Type '${c||"unknown"}' is not supported`;return o&&o.messages&&s&&o.messages.push(new Uc(`${i}:unsupported`,f,{definition:s,context:o})),void aq.error(f)}const p=new h;return p.read(s,o),p}}function bke(e){var i,r;const t={};for(const s in e.typeMap){const n=e.typeMap[s],o=aL(n.prototype);if(typeof e.key=="function")continue;const a=o.properties[e.key];if(!a)continue;((i=a.json)==null?void 0:i.type)&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(t[a.json.type[0]]=n);const l=(r=a.json)==null?void 0:r.write;if(!l||!l.writer){t[s]=n;continue}const c=l.target,h=typeof c=="string"?c:e.key,p={};l.writer(s,p,h),p[h]&&(t[p[h]]=n)}return t}function wke(e){if(e.json||(e.json={}),roe(e.json),soe(e.json),ioe(e.json),e.json.origins)for(const t in e.json.origins)roe(e.json.origins[t]),soe(e.json.origins[t]),ioe(e.json.origins[t]);return!0}function ioe(e){e.name&&(e.read&&typeof e.read=="object"?e.read.source===void 0&&(e.read.source=e.name):e.read={source:e.name},e.write&&typeof e.write=="object"?e.write.target===void 0&&(e.write.target=e.name):e.write={target:e.name})}function roe(e){typeof e.read=="boolean"?e.read={enabled:e.read}:typeof e.read=="function"?e.read={enabled:!0,reader:e.read}:e.read&&typeof e.read=="object"&&e.read.enabled===void 0&&(e.read.enabled=!0)}function soe(e){typeof e.write=="boolean"?e.write={enabled:e.write}:typeof e.write=="function"?e.write={enabled:!0,writer:e.write}:e.write&&typeof e.write=="object"&&e.write.enabled===void 0&&(e.write.enabled=!0)}const xke=ve.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer");function noe(e,t){var r;if(!t.write||t.write.writer||t.write.enabled===!1&&!t.write.overridePolicy)return;const i=(r=e==null?void 0:e.ndimArray)!=null?r:0;e&&(i===1||"type"in e&&Fve(e.type))?t.write.writer=Eke:i>1?t.write.writer=Cke(i):t.types?Array.isArray(t.types)?t.write.writer=Ske(t.types[0]):t.write.writer=Tke(t.types):t.write.writer=M3}function Tke(e){return(t,i,r,s)=>t?Vve(t,e,s)?M3(t,i,r,s):void 0:M3(t,i,r,s)}function Vve(e,t,i){var r,s;for(const n in t.typeMap)if(e instanceof t.typeMap[n])return!0;if(i==null?void 0:i.messages){const n=(r=t.errorContext)!=null?r:"type",o=`Values of type '${(s=typeof t.key!="function"?e[t.key]:e.declaredClass)!=null?s:"Unknown"}' cannot be written`;i&&i.messages&&e&&i.messages.push(new W(`${n}:unsupported`,o,{definition:e,context:i})),xke.error(o)}return!1}function Ske(e){return(t,i,r,s)=>!t||!Array.isArray(t)?M3(t,i,r,s):M3(t.filter(n=>Vve(n,e,s)),i,r,s)}function M3(e,t,i,r){Bu(i,uU(e,r),t)}function uU(e,t){return e&&typeof e.write=="function"?e.write({},t):e&&typeof e.toJSON=="function"?e.toJSON():typeof e=="number"?hU(e):e}function hU(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function Eke(e,t,i,r){let s;e===null?s=null:e&&typeof e.map=="function"?(s=e.map(n=>uU(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[uU(e,r)],Bu(i,s,t)}function Bve(e,t,i){return i!==0&&Array.isArray(e)?e.map(r=>Bve(r,t,i-1)):uU(e,t)}function Cke(e){return(t,i,r,s)=>{let n;if(t===null)n=null;else{n=Bve(t,s,e);let o=e,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}Bu(r,n,i)}}function lq(e,t){return VQ(e,"read",t)}function Gve(e,t){return VQ(e,"write",t)}function VQ(e,t,i){let r=e&&e.json;if(e&&e.json&&e.json.origins&&i){const s=e.json.origins[i.origin];s&&(t==="any"||t in s)&&(r=s)}return r}function Ake(e){const t=Mke(e);if(e.json.origins)for(const i in e.json.origins){const r=e.json.origins[i],s=r.types?Oke(r):t;eoe(s,r,!1),r.types&&!r.write&&e.json.write&&e.json.write.enabled&&(r.write=F({},e.json.write)),noe(s,r)}eoe(t,e.json,!0),noe(t,e.json)}function Mke(e){return e.json.types?cq(e.json):e.type?jve(e):cq(e)}function Oke(e){return e.type?jve(e):cq(e)}function jve(e){if(!e.type)return;let t=0,i=e.type;for(;Array.isArray(i)&&!hve(i);)i=i[0],t++;return{type:i,ndimArray:t}}function cq(e){if(!e.types)return;let t=0,i=e.types;for(;Array.isArray(i);)i=i[0],t++;return{types:i,ndimArray:t}}function Rke(e){wke(e)&&(mke(e),Ake(e))}const CG=new Set,AG=new Set;function L(e){return t=>{t.prototype.declaredClass=e,Ike(t);const i=[],r=[];let s=t.prototype;for(;s;)s.hasOwnProperty("initialize")&&!CG.has(s.initialize)&&(CG.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!AG.has(s.destroy)&&(AG.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);CG.clear(),AG.clear();class n extends t{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0;for(let c=0;c<r.length;c++)r[c].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=aL(t.prototype),n.prototype.declaredClass=e,n}}function Pke(e,t){return t.get==null?function(){const i=this.__accessor__.properties.get(e);if(i===void 0)return;bi(i);const r=this.__accessor__.store;return r.has(e)?r.get(e):i.metadata.value}:function(){const i=this.__accessor__.properties.get(e);if(i!==void 0)return i.getComputed()}}function Ike(e){const t=e.prototype,i=aL(t).properties,r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];Rke(n),r[s]={enumerable:!0,configurable:!0,get:Pke(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===xg.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(e.prototype,r)}var Hve;function $ke(e){var t;if(e==null)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return((t=e.constructor)==null?void 0:t.__accessorMetadata__)||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}const lP=Symbol("Accessor-Handles");class Ee{constructor(...t){if(this[Hve]=null,this.constructor===Ee)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new R5e(this)}),t.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,t))}static createSubclass(t={}){if(Array.isArray(t))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=t;delete t.declaredClass,delete t.properties,delete t.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}aL(o.prototype);for(const a in t){const l=t[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let p;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{p=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,p}:t[a]}for(const a in i){const l=$ke(i[a]);d(l)(o.prototype,a)}return L(r)(o)}postscript(t){const i=this.__accessor__,r=i.ctorArgs||t;i.initialize(),r&&(this.set(r),i.ctorArgs=null),i.constructed(),this.initialize()}initialize(){}destroy(){this.destroyed||(wt(this[lP],t=>{t.forEach(i=>i.remove())}),this[lP]=null,ske(this),this.__accessor__.destroy())}get initialized(){return this.__accessor__&&this.__accessor__.initialized||!1}get constructed(){return this.__accessor__&&this.__accessor__.lifecycle===xg.CONSTRUCTED||!1}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(t){this.get(t)}get(t){return tU(this,t)}hasOwnProperty(t){return this.__accessor__?this.__accessor__.has(t):Object.prototype.hasOwnProperty.call(this,t)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(t,i){return rU(this,t,i),this}watch(t,i,r){return cke(this,t,i,r)}own(t){let i=this[lP];if(M(i)&&(i=this[lP]=new Set),pve(t))for(const r of t)i.add(r);else i.add(t)}_clearOverride(t){return this.__accessor__.clearOverride(t)}_override(t,i){return this.__accessor__.override(t,i)}_isOverridden(t){return this.__accessor__.isOverridden(t)}notifyChange(t){this.__accessor__.notifyChange(t)}_get(t){return this.__accessor__.internalGet(t)}_set(t,i){return this.__accessor__.internalSet(t,i),this}}Hve=lP;ve.getLogger("esri.core.Clonable");const Wu=e=>{let t=class extends e{clone(){var l;const i=U4e(ho(this),"unable to clone instance of non-accessor class"),r=i.metadatas,s=i.store,n={},o=new Map;for(const c in r){const h=r[c],p=s==null?void 0:s.originOf(c),f=h.clonable;if(h.readOnly||f===!1||p!==st.USER&&p!==st.DEFAULTS&&p!==st.WEB_MAP&&p!==st.WEB_SCENE)continue;const m=this[c];let g=null;g=typeof f=="function"?f(m):f==="reference"?m:ZH(m),m!=null&&g==null||(p===st.DEFAULTS?o.set(c,g):n[c]=g)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=ho(a))==null?void 0:l.store;if(c)for(const[h,p]of o)c.set(h,p,st.DEFAULTS)}return a}};return t=u([L("esri.core.Clonable")],t),t};let ooe=class extends Wu(Ee){};ooe=u([L("esri.core.Clonable")],ooe);class Tb{constructor(t,i){this.min=t,this.max=i,this.range=i-t}ndiff(t,i=0){return Math.ceil((t-i)/this.range)*this.range+i}_normalize(t,i,r,s=0,n=!1){return(r-=s)<t?r+=this.ndiff(t-r):r>i&&(r-=this.ndiff(r-i)),n&&r===i&&(r=t),r+s}normalize(t,i=0,r=!1){return this._normalize(this.min,this.max,t,i,r)}clamp(t,i=0){return He(t-i,this.min,this.max)+i}monotonic(t,i,r){return t<i?i:i+this.ndiff(t-i,r)}minimalMonotonic(t,i,r){return this._normalize(t,t+this.range,i,r)}center(t,i,r){return i=this.monotonic(t,i,r),this.normalize((t+i)/2,r)}diff(t,i,r){return this.monotonic(t,i,r)-t}shortestSignedDiff(t,i){t=this.normalize(t);const r=(i=this.normalize(i))-t,s=i<t?this.minimalMonotonic(t,i)-t:i-this.minimalMonotonic(i,t);return Math.abs(r)<Math.abs(s)?r:s}contains(t,i,r){return i=this.minimalMonotonic(t,i),(r=this.minimalMonotonic(t,r))>t&&r<i}}function BQ(e){for(const t in e){const i=e[t];i instanceof Function&&(e[t]=i.bind(e))}return e}const Lke=BQ(new Tb(0,2*Math.PI)),Sb=BQ(new Tb(-Math.PI,Math.PI)),VV=BQ(new Tb(0,360));class GQ{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new GQ;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,ue(r.value),r.origin)}),i}get(t,i){i=this._normalizeOrigin(i);const r=this._values.get(t);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(t){var i,r;return(r=(i=this._values.get(t))==null?void 0:i.origin)!=null?r:st.USER}keys(t){t=this._normalizeOrigin(t);const i=[...this._values.keys()];return t==null?i:i.filter(r=>{var s;return((s=this._values.get(r))==null?void 0:s.origin)===t})}set(t,i,r){if((r=this._normalizeOrigin(r))===st.DEFAULTS){const s=this._values.get(t);if(s&&s.origin!=null&&s.origin>r)return}this._values.set(t,new Dke(i,r))}delete(t,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(t))==null?void 0:r.origin)!==i||this._values.delete(t)}has(t,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(t))==null?void 0:r.origin)===i:this._values.has(t)}forEach(t){this._values.forEach(({value:i},r)=>t(i,r))}_normalizeOrigin(t){if(t!=null)return t===st.DEFAULTS?t:st.USER}}class Dke{constructor(t,i){this.value=t,this.origin=i}}function qve(e,t,i){t.keys().forEach(s=>{i.set(s,t.get(s),st.DEFAULTS)});const r=e.metadatas;Object.keys(r).forEach(s=>{e.internalGet(s)&&i.set(s,e.internalGet(s),st.DEFAULTS)})}function Nke(e,t,i){if(!e||!e.read||e.read.enabled===!1||!e.read.source)return!1;const r=e.read.source;if(typeof r=="string"){if(r===t||r.includes(".")&&r.indexOf(t)===0&&jne(r,i))return!0}else for(const s of r)if(s===t||s.includes(".")&&s.indexOf(t)===0&&jne(s,i))return!0;return!1}function Fke(e){return e&&(!e.read||e.read.enabled!==!1&&!e.read.source)}function kke(e,t,i,r,s){let n=lq(t[i],s);Fke(n)&&(e[i]=!0);for(const o of Object.getOwnPropertyNames(t))n=lq(t[o],s),Nke(n,i,r)&&(e[o]=!0)}function Uke(e,t,i,r){const s=i.metadatas,n=VQ(s[t],"any",r),o=n&&n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(e,t,r):o;a!==void 0&&i.set(t,a)}const Wve={origin:"service"};function Zve(e,t,i=Wve){if(!t||typeof t!="object")return;const r=ho(e),s=r.metadatas,n={};for(const o of Object.getOwnPropertyNames(t))kke(n,s,o,t,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(n)){const a=lq(s[o],i).read,l=a&&a.source;let c;c=l&&typeof l=="string"?oL(t,l):t[o],a&&a.reader&&(c=a.reader.call(e,c,t,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||Uke(e,o,r,i)}r.setDefaultOrigin("user")}function zke(e,t,i,r=Wve){var n;const s=me(F({},r),{messages:[]});i(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||e.loaded?r&&r.messages&&r.messages.push(o):e.loadWarnings.push(o)})}const Vke=ve.getLogger("esri.core.accessorSupport.write");function Bke(e,t,i,r,s){var o,a;const n={};return(a=(o=t.write)==null?void 0:o.writer)==null||a.call(e,r,n,i,s),n}function Xve(e,t,i,r,s,n){if(!r||!r.write)return!1;const o=e.get(i);if(!s&&r.write.overridePolicy){const a=r.write.overridePolicy.call(e,o,i,n);a!==void 0&&(s=a)}if(s||(s=r.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new W("web-document-write:property-required",`Missing value for required property '${i}' on '${e.declaredClass}'`,{propertyName:i,target:e});return a&&n&&n.messages?n.messages.push(a):a&&!n&&Vke.error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||(!t.store.multipleOriginsSupported||t.store.originOf(i)===st.DEFAULTS)&&Gke(e,i,n,r,o)||!s.ignoreOrigin&&n&&n.origin&&t.store.multipleOriginsSupported&&t.store.originOf(i)<Hh(n.origin))}function Gke(e,t,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(e,t,i);return wb(o,s)}return!1}return n===s}function jke(e,t,i,r){const s=ho(e),n=s.metadatas,o=Gve(n[t],r);return!!o&&Xve(e,s,t,o,i,r)}function Yve(e,t,i){var n,o;if(e&&typeof e.toJSON=="function"&&(!e.toJSON.isDefaultToJSON||!e.write))return F4(t,e.toJSON(i));const r=ho(e),s=r.metadatas;for(const a in s){const l=Gve(s[a],i);if(!Xve(e,r,a,l,void 0,i))continue;const c=e.get(a),h=Bke(e,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,i);Object.keys(h).length>0&&(t=F4(t,h),((o=(n=i==null?void 0:i.resources)==null?void 0:n.pendingOperations)==null?void 0:o.length)&&Promise.all(i.resources.pendingOperations).then(()=>F4(t,h)),i&&i.writtenProperties&&i.writtenProperties.push({target:e,propName:a,oldOrigin:E5e(r.store.originOf(a)),newOrigin:i.origin}))}return t}const eO=e=>{let t=class extends e{constructor(...i){super(...i);const r=ho(this),s=r.store,n=new GQ;r.store=n,qve(r,s,n)}read(i,r){Zve(this,i,r)}write(i={},r){return Yve(this,i,r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return Hke.call(this,i,r)}};return t=u([L("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function Hke(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(e,t),i}let Ce=class extends eO(Ee){};Ce=u([L("esri.core.JSONSupport")],Ce);const qke=Object.prototype.toString;function Wke(e){const t="__accessorMetadata__"in e?dn(e):e;return function(...i){if(i.push(t),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return Zke.apply(this,i)}}function Zke(e,t,i,r){lL(e,t).cast=r}function Xke(e){return(t,i)=>{lL(t,e).cast=t[i]}}function Jt(...e){if(e.length!==3||typeof e[1]!="string")return e.length===1&&qke.call(e[0])==="[object Function]"?Wke(e[0]):e.length===1&&typeof e[0]=="string"?Xke(e[0]):void 0}function De(e,t,i){let r,s;return t===void 0||Array.isArray(t)?(s=e,i=t,r=[void 0]):(s=t,r=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;r.forEach(l=>{const c=kQ(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}function it(e,t,i){let r,s;return t===void 0?(s=e,r=[void 0]):typeof t!="string"?(s=e,r=[void 0],i=t):(s=t,r=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;for(const l of r){const c=kQ(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}var ap;(function(e){e[e.CGCS2000=4490]="CGCS2000",e[e.GCSMARS2000=104971]="GCSMARS2000",e[e.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",e[e.GCSMOON2000=104903]="GCSMOON2000"})(ap||(ap={}));let v;const G={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(v=2e3;v<=2045;v++)G[v]=0;for(v=2056;v<=2065;v++)G[v]=0;for(v=2067;v<=2135;v++)G[v]=0;for(v=2137;v<=2154;v++)G[v]=0;for(v=2161;v<=2170;v++)G[v]=0;for(v=2172;v<=2193;v++)G[v]=0;for(v=2195;v<=2198;v++)G[v]=0;for(v=2200;v<=2203;v++)G[v]=0;for(v=2205;v<=2217;v++)G[v]=0;for(v=2222;v<=2224;v++)G[v]=1;for(v=2225;v<=2250;v++)G[v]=2;for(v=2251;v<=2253;v++)G[v]=1;for(v=2257;v<=2264;v++)G[v]=2;for(v=2274;v<=2279;v++)G[v]=2;for(v=2280;v<=2282;v++)G[v]=1;for(v=2283;v<=2289;v++)G[v]=2;for(v=2290;v<=2292;v++)G[v]=0;for(v=2308;v<=2313;v++)G[v]=0;for(v=2315;v<=2491;v++)G[v]=0;for(v=2494;v<=2866;v++)G[v]=0;for(v=2867;v<=2869;v++)G[v]=1;for(v=2870;v<=2888;v++)G[v]=2;for(v=2891;v<=2895;v++)G[v]=2;for(v=2896;v<=2898;v++)G[v]=1;for(v=2902;v<=2908;v++)G[v]=2;for(v=2915;v<=2920;v++)G[v]=2;for(v=2921;v<=2923;v++)G[v]=1;for(v=2924;v<=2930;v++)G[v]=2;for(v=2931;v<=2962;v++)G[v]=0;for(v=2964;v<=2968;v++)G[v]=2;for(v=2969;v<=2973;v++)G[v]=0;for(v=2975;v<=2991;v++)G[v]=0;for(v=2995;v<=3051;v++)G[v]=0;for(v=3054;v<=3079;v++)G[v]=0;for(v=3081;v<=3088;v++)G[v]=0;for(v=3092;v<=3101;v++)G[v]=0;for(v=3106;v<=3138;v++)G[v]=0;for(v=3146;v<=3151;v++)G[v]=0;for(v=3153;v<=3166;v++)G[v]=0;for(v=3168;v<=3172;v++)G[v]=0;for(v=3174;v<=3203;v++)G[v]=0;for(v=3294;v<=3358;v++)G[v]=0;for(v=3367;v<=3403;v++)G[v]=0;for(v=3408;v<=3416;v++)G[v]=0;for(v=3417;v<=3438;v++)G[v]=2;for(v=3441;v<=3446;v++)G[v]=2;for(v=3447;v<=3450;v++)G[v]=0;for(v=3451;v<=3459;v++)G[v]=2;for(v=3460;v<=3478;v++)G[v]=0;for(v=3554;v<=3559;v++)G[v]=0;for(v=3560;v<=3570;v++)G[v]=2;for(v=3571;v<=3581;v++)G[v]=0;for(v=3594;v<=3597;v++)G[v]=0;for(v=3601;v<=3604;v++)G[v]=0;for(v=3637;v<=3639;v++)G[v]=0;for(v=3665;v<=3667;v++)G[v]=0;for(v=3693;v<=3695;v++)G[v]=0;for(v=3701;v<=3727;v++)G[v]=0;for(v=3728;v<=3739;v++)G[v]=2;for(v=3740;v<=3751;v++)G[v]=0;for(v=3753;v<=3760;v++)G[v]=2;for(v=3761;v<=3773;v++)G[v]=0;for(v=3775;v<=3777;v++)G[v]=0;for(v=3779;v<=3781;v++)G[v]=0;for(v=3783;v<=3785;v++)G[v]=0;for(v=3788;v<=3791;v++)G[v]=0;for(v=3797;v<=3802;v++)G[v]=0;for(v=3814;v<=3816;v++)G[v]=0;for(v=3825;v<=3829;v++)G[v]=0;for(v=3832;v<=3841;v++)G[v]=0;for(v=3844;v<=3852;v++)G[v]=0;for(v=3873;v<=3885;v++)G[v]=0;for(v=3890;v<=3893;v++)G[v]=0;for(v=3907;v<=3912;v++)G[v]=0;for(v=3942;v<=3950;v++)G[v]=0;for(v=3968;v<=3970;v++)G[v]=0;for(v=3973;v<=3976;v++)G[v]=0;for(v=3986;v<=3989;v++)G[v]=0;for(v=3994;v<=3997;v++)G[v]=0;for(v=4048;v<=4051;v++)G[v]=0;for(v=4056;v<=4063;v++)G[v]=0;for(v=4093;v<=4096;v++)G[v]=0;for(v=4390;v<=4398;v++)G[v]=0;for(v=4399;v<=4413;v++)G[v]=2;for(v=4418;v<=4433;v++)G[v]=2;for(v=4455;v<=4457;v++)G[v]=2;for(v=4484;v<=4489;v++)G[v]=0;for(v=4491;v<=4554;v++)G[v]=0;for(v=4568;v<=4589;v++)G[v]=0;for(v=4652;v<=4656;v++)G[v]=0;for(v=4766;v<=4800;v++)G[v]=0;for(v=5014;v<=5016;v++)G[v]=0;for(v=5069;v<=5072;v++)G[v]=0;for(v=5105;v<=5130;v++)G[v]=0;for(v=5173;v<=5188;v++)G[v]=0;for(v=5253;v<=5259;v++)G[v]=0;for(v=5269;v<=5275;v++)G[v]=0;for(v=5292;v<=5311;v++)G[v]=0;for(v=5329;v<=5331;v++)G[v]=0;for(v=5343;v<=5349;v++)G[v]=0;for(v=5355;v<=5357;v++)G[v]=0;for(v=5387;v<=5389;v++)G[v]=0;for(v=5459;v<=5463;v++)G[v]=0;for(v=5479;v<=5482;v++)G[v]=0;for(v=5518;v<=5520;v++)G[v]=0;for(v=5530;v<=5539;v++)G[v]=0;for(v=5550;v<=5552;v++)G[v]=0;for(v=5562;v<=5583;v++)G[v]=0;for(v=5623;v<=5625;v++)G[v]=2;for(v=5631;v<=5639;v++)G[v]=0;for(v=5649;v<=5653;v++)G[v]=0;for(v=5663;v<=5680;v++)G[v]=0;for(v=5682;v<=5685;v++)G[v]=0;for(v=5875;v<=5877;v++)G[v]=0;for(v=5896;v<=5899;v++)G[v]=0;for(v=5921;v<=5940;v++)G[v]=0;for(v=6050;v<=6125;v++)G[v]=0;for(v=6244;v<=6275;v++)G[v]=0;for(v=6328;v<=6348;v++)G[v]=0;for(v=6350;v<=6356;v++)G[v]=0;for(v=6366;v<=6372;v++)G[v]=0;for(v=6381;v<=6387;v++)G[v]=0;for(v=6393;v<=6404;v++)G[v]=0;for(v=6480;v<=6483;v++)G[v]=0;for(v=6511;v<=6514;v++)G[v]=0;for(v=6579;v<=6581;v++)G[v]=0;for(v=6619;v<=6624;v++)G[v]=0;for(v=6625;v<=6627;v++)G[v]=2;for(v=6628;v<=6632;v++)G[v]=0;for(v=6634;v<=6637;v++)G[v]=0;for(v=6669;v<=6692;v++)G[v]=0;for(v=6707;v<=6709;v++)G[v]=0;for(v=6720;v<=6723;v++)G[v]=0;for(v=6732;v<=6738;v++)G[v]=0;for(v=6931;v<=6933;v++)G[v]=0;for(v=6956;v<=6959;v++)G[v]=0;for(v=7005;v<=7007;v++)G[v]=0;for(v=7057;v<=7070;v++)G[v]=2;for(v=7074;v<=7082;v++)G[v]=0;for(v=7109;v<=7118;v++)G[v]=0;for(v=7119;v<=7127;v++)G[v]=1;for(v=7374;v<=7376;v++)G[v]=0;for(v=7528;v<=7586;v++)G[v]=0;for(v=7587;v<=7645;v++)G[v]=2;for(v=7692;v<=7696;v++)G[v]=0;for(v=7755;v<=7787;v++)G[v]=0;for(v=7791;v<=7795;v++)G[v]=0;for(v=7799;v<=7801;v++)G[v]=0;for(v=7803;v<=7805;v++)G[v]=0;for(v=7825;v<=7831;v++)G[v]=0;for(v=7845;v<=7859;v++)G[v]=0;for(v=8013;v<=8032;v++)G[v]=0;for(v=8065;v<=8068;v++)G[v]=1;for(v=8518;v<=8529;v++)G[v]=2;for(v=8533;v<=8536;v++)G[v]=2;for(v=8538;v<=8540;v++)G[v]=2;for(v=8677;v<=8679;v++)G[v]=0;for(v=8836;v<=8840;v++)G[v]=0;for(v=8857;v<=8859;v++)G[v]=0;for(v=8908;v<=8910;v++)G[v]=0;for(v=9154;v<=9159;v++)G[v]=0;for(v=9205;v<=9218;v++)G[v]=0;for(v=9271;v<=9273;v++)G[v]=0;for(v=9295;v<=9297;v++)G[v]=0;for(v=9356;v<=9360;v++)G[v]=0;for(v=9404;v<=9407;v++)G[v]=0;for(v=9476;v<=9482;v++)G[v]=0;for(v=9487;v<=9494;v++)G[v]=0;for(v=9697;v<=9699;v++)G[v]=0;for(v=20002;v<=20032;v++)G[v]=0;for(v=20062;v<=20092;v++)G[v]=0;for(v=20135;v<=20138;v++)G[v]=0;for(v=20248;v<=20258;v++)G[v]=0;for(v=20348;v<=20358;v++)G[v]=0;for(v=20436;v<=20440;v++)G[v]=0;for(v=20822;v<=20824;v++)G[v]=0;for(v=20904;v<=20932;v++)G[v]=0;for(v=20934;v<=20936;v++)G[v]=0;for(v=21004;v<=21032;v++)G[v]=0;for(v=21035;v<=21037;v++)G[v]=0;for(v=21095;v<=21097;v++)G[v]=0;for(v=21148;v<=21150;v++)G[v]=0;for(v=21207;v<=21264;v++)G[v]=0;for(v=21307;v<=21364;v++)G[v]=0;for(v=21413;v<=21423;v++)G[v]=0;for(v=21453;v<=21463;v++)G[v]=0;for(v=21473;v<=21483;v++)G[v]=0;for(v=21780;v<=21782;v++)G[v]=0;for(v=21891;v<=21894;v++)G[v]=0;for(v=21896;v<=21899;v++)G[v]=0;for(v=22171;v<=22177;v++)G[v]=0;for(v=22181;v<=22187;v++)G[v]=0;for(v=22191;v<=22197;v++)G[v]=0;for(v=22234;v<=22236;v++)G[v]=0;for(v=22521;v<=22525;v++)G[v]=0;for(v=22991;v<=22994;v++)G[v]=0;for(v=23028;v<=23038;v++)G[v]=0;for(v=23830;v<=23853;v++)G[v]=0;for(v=23866;v<=23872;v++)G[v]=0;for(v=23877;v<=23884;v++)G[v]=0;for(v=23886;v<=23894;v++)G[v]=0;for(v=23946;v<=23948;v++)G[v]=0;for(v=24311;v<=24313;v++)G[v]=0;for(v=24342;v<=24347;v++)G[v]=0;for(v=24370;v<=24374;v++)G[v]=10;for(v=24375;v<=24381;v++)G[v]=0;for(v=24718;v<=24721;v++)G[v]=0;for(v=24817;v<=24821;v++)G[v]=0;for(v=24877;v<=24882;v++)G[v]=0;for(v=24891;v<=24893;v++)G[v]=0;for(v=25391;v<=25395;v++)G[v]=0;for(v=25828;v<=25838;v++)G[v]=0;for(v=26191;v<=26195;v++)G[v]=0;for(v=26391;v<=26393;v++)G[v]=0;for(v=26701;v<=26722;v++)G[v]=0;for(v=26729;v<=26799;v++)G[v]=2;for(v=26801;v<=26803;v++)G[v]=2;for(v=26811;v<=26813;v++)G[v]=2;for(v=26847;v<=26870;v++)G[v]=2;for(v=26891;v<=26899;v++)G[v]=0;for(v=26901;v<=26923;v++)G[v]=0;for(v=26929;v<=26946;v++)G[v]=0;for(v=26948;v<=26998;v++)G[v]=0;for(v=27037;v<=27040;v++)G[v]=0;for(v=27205;v<=27232;v++)G[v]=0;for(v=27258;v<=27260;v++)G[v]=0;for(v=27391;v<=27398;v++)G[v]=0;for(v=27561;v<=27564;v++)G[v]=0;for(v=27571;v<=27574;v++)G[v]=0;for(v=27581;v<=27584;v++)G[v]=0;for(v=27591;v<=27594;v++)G[v]=0;for(v=28191;v<=28193;v++)G[v]=0;for(v=28348;v<=28358;v++)G[v]=0;for(v=28402;v<=28432;v++)G[v]=0;for(v=28462;v<=28492;v++)G[v]=0;for(v=29118;v<=29122;v++)G[v]=0;for(v=29168;v<=29172;v++)G[v]=0;for(v=29177;v<=29185;v++)G[v]=0;for(v=29187;v<=29195;v++)G[v]=0;for(v=29900;v<=29903;v++)G[v]=0;for(v=30161;v<=30179;v++)G[v]=0;for(v=30491;v<=30494;v++)G[v]=0;for(v=30729;v<=30732;v++)G[v]=0;for(v=31251;v<=31259;v++)G[v]=0;for(v=31265;v<=31268;v++)G[v]=0;for(v=31275;v<=31279;v++)G[v]=0;for(v=31281;v<=31297;v++)G[v]=0;for(v=31461;v<=31469;v++)G[v]=0;for(v=31491;v<=31495;v++)G[v]=0;for(v=31917;v<=31922;v++)G[v]=0;for(v=31965;v<=32e3;v++)G[v]=0;for(v=32001;v<=32003;v++)G[v]=2;for(v=32005;v<=32031;v++)G[v]=2;for(v=32033;v<=32060;v++)G[v]=2;for(v=32064;v<=32067;v++)G[v]=2;for(v=32074;v<=32077;v++)G[v]=2;for(v=32081;v<=32086;v++)G[v]=0;for(v=32107;v<=32130;v++)G[v]=0;for(v=32133;v<=32158;v++)G[v]=0;for(v=32164;v<=32167;v++)G[v]=2;for(v=32180;v<=32199;v++)G[v]=0;for(v=32201;v<=32260;v++)G[v]=0;for(v=32301;v<=32360;v++)G[v]=0;for(v=32601;v<=32662;v++)G[v]=0;for(v=32664;v<=32667;v++)G[v]=2;for(v=32701;v<=32761;v++)G[v]=0;for(v=53001;v<=53004;v++)G[v]=0;for(v=53008;v<=53019;v++)G[v]=0;for(v=53021;v<=53032;v++)G[v]=0;for(v=53034;v<=53037;v++)G[v]=0;for(v=53042;v<=53046;v++)G[v]=0;for(v=53074;v<=53080;v++)G[v]=0;for(v=54001;v<=54004;v++)G[v]=0;for(v=54008;v<=54019;v++)G[v]=0;for(v=54021;v<=54032;v++)G[v]=0;for(v=54034;v<=54037;v++)G[v]=0;for(v=54042;v<=54046;v++)G[v]=0;for(v=54048;v<=54053;v++)G[v]=0;for(v=54074;v<=54080;v++)G[v]=0;for(v=54098;v<=54101;v++)G[v]=0;for(v=102001;v<=102040;v++)G[v]=0;for(v=102042;v<=102063;v++)G[v]=0;for(v=102065;v<=102067;v++)G[v]=0;for(v=102070;v<=102117;v++)G[v]=0;for(v=102122;v<=102216;v++)G[v]=0;for(v=102221;v<=102377;v++)G[v]=0;for(v=102382;v<=102388;v++)G[v]=0;for(v=102389;v<=102398;v++)G[v]=2;for(v=102399;v<=102444;v++)G[v]=0;for(v=102445;v<=102447;v++)G[v]=2;for(v=102448;v<=102458;v++)G[v]=0;for(v=102459;v<=102468;v++)G[v]=2;for(v=102469;v<=102499;v++)G[v]=0;for(v=102500;v<=102519;v++)G[v]=1;for(v=102520;v<=102524;v++)G[v]=0;for(v=102525;v<=102529;v++)G[v]=2;for(v=102530;v<=102588;v++)G[v]=0;for(v=102590;v<=102598;v++)G[v]=0;for(v=102601;v<=102603;v++)G[v]=0;for(v=102605;v<=102628;v++)G[v]=0;for(v=102629;v<=102646;v++)G[v]=2;for(v=102648;v<=102700;v++)G[v]=2;for(v=102701;v<=102703;v++)G[v]=0;for(v=102707;v<=102730;v++)G[v]=2;for(v=102733;v<=102758;v++)G[v]=2;for(v=102767;v<=102900;v++)G[v]=0;for(v=102901;v<=102933;v++)G[v]=2;for(v=102934;v<=102950;v++)G[v]=13;for(v=102951;v<=102955;v++)G[v]=0;for(v=102961;v<=102963;v++)G[v]=0;for(v=102965;v<=102969;v++)G[v]=0;for(v=102971;v<=102973;v++)G[v]=0;for(v=102975;v<=102989;v++)G[v]=0;for(v=102990;v<=102992;v++)G[v]=1;for(v=102997;v<=103002;v++)G[v]=0;for(v=103003;v<=103008;v++)G[v]=2;for(v=103009;v<=103011;v++)G[v]=0;for(v=103012;v<=103014;v++)G[v]=2;for(v=103019;v<=103021;v++)G[v]=0;for(v=103022;v<=103024;v++)G[v]=2;for(v=103029;v<=103031;v++)G[v]=0;for(v=103032;v<=103034;v++)G[v]=2;for(v=103065;v<=103068;v++)G[v]=0;for(v=103074;v<=103076;v++)G[v]=0;for(v=103077;v<=103079;v++)G[v]=1;for(v=103080;v<=103082;v++)G[v]=0;for(v=103083;v<=103085;v++)G[v]=2;for(v=103090;v<=103093;v++)G[v]=0;for(v=103097;v<=103099;v++)G[v]=0;for(v=103100;v<=103102;v++)G[v]=2;for(v=103107;v<=103109;v++)G[v]=0;for(v=103110;v<=103112;v++)G[v]=2;for(v=103113;v<=103116;v++)G[v]=0;for(v=103117;v<=103120;v++)G[v]=2;for(v=103153;v<=103157;v++)G[v]=0;for(v=103158;v<=103162;v++)G[v]=2;for(v=103163;v<=103165;v++)G[v]=0;for(v=103166;v<=103168;v++)G[v]=1;for(v=103169;v<=103171;v++)G[v]=2;for(v=103186;v<=103188;v++)G[v]=0;for(v=103189;v<=103191;v++)G[v]=2;for(v=103192;v<=103195;v++)G[v]=0;for(v=103196;v<=103199;v++)G[v]=2;for(v=103200;v<=103224;v++)G[v]=0;for(v=103225;v<=103227;v++)G[v]=1;for(v=103232;v<=103237;v++)G[v]=0;for(v=103238;v<=103243;v++)G[v]=2;for(v=103244;v<=103246;v++)G[v]=0;for(v=103247;v<=103249;v++)G[v]=2;for(v=103254;v<=103256;v++)G[v]=0;for(v=103257;v<=103259;v++)G[v]=2;for(v=103264;v<=103266;v++)G[v]=0;for(v=103267;v<=103269;v++)G[v]=2;for(v=103300;v<=103375;v++)G[v]=0;for(v=103381;v<=103383;v++)G[v]=0;for(v=103384;v<=103386;v++)G[v]=1;for(v=103387;v<=103389;v++)G[v]=0;for(v=103390;v<=103392;v++)G[v]=2;for(v=103397;v<=103399;v++)G[v]=0;for(v=103400;v<=103471;v++)G[v]=2;for(v=103476;v<=103478;v++)G[v]=0;for(v=103479;v<=103481;v++)G[v]=2;for(v=103486;v<=103488;v++)G[v]=0;for(v=103489;v<=103491;v++)G[v]=2;for(v=103492;v<=103495;v++)G[v]=0;for(v=103496;v<=103499;v++)G[v]=2;for(v=103528;v<=103543;v++)G[v]=0;for(v=103544;v<=103548;v++)G[v]=2;for(v=103549;v<=103551;v++)G[v]=0;for(v=103552;v<=103554;v++)G[v]=1;for(v=103555;v<=103557;v++)G[v]=2;for(v=103558;v<=103560;v++)G[v]=0;for(v=103571;v<=103573;v++)G[v]=0;for(v=103574;v<=103576;v++)G[v]=2;for(v=103577;v<=103580;v++)G[v]=0;for(v=103581;v<=103583;v++)G[v]=2;for(v=103595;v<=103694;v++)G[v]=0;for(v=103696;v<=103699;v++)G[v]=0;for(v=103700;v<=103793;v++)G[v]=2;for(v=103794;v<=103887;v++)G[v]=0;for(v=103900;v<=103971;v++)G[v]=2;const Yke={102113:!0,102100:!0,3857:!0,3785:!0},Jke={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},aoe='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',PD=[-20037508342788905e-9,20037508342788905e-9],ID=[-20037508342787e-6,20037508342787e-6],Jve={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:PD,origin:ID,dx:1e-5},102100:{wkTemplate:aoe,valid:PD,origin:ID,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:PD,origin:ID,dx:1e-5},3857:{wkTemplate:aoe,valid:PD,origin:ID,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function _a(e,t){return!M(e)&&!M(t)&&(e===t||(e.wkid!=null||t.wkid!=null?e.wkid===t.wkid||Gg(e)&&Gg(t)||t.latestWkid!=null&&e.wkid===t.latestWkid||e.latestWkid!=null&&t.wkid===e.latestWkid:!(!e.wkt||!t.wkt)&&e.wkt.toUpperCase()===t.wkt.toUpperCase()))}function X0(e){return ja(e)&&e.wkid&&Jve[e.wkid]||null}function BV(e){return!!ja(e)&&(e.wkid?G[e.wkid]==null:!!e.wkt&&!!/^\s*GEOGCS/i.test(e.wkt))}function O3(e){return!(ay(e)||ly(e))}function R3(e){return ja(e)&&e.wkid===4326}function Qve(e){return ja(e)&&e.wkid===ap.CGCS2000}function Gg(e){return ja(e)&&e.wkid!=null&&Yke[e.wkid]===!0}function P3(e){return ja(e)&&e.wkid===32662}function jQ(e){return e===ap.GCSMARS2000||e===ap.GCSMARS2000_SPHERE}function ay(e){return ja(e)&&e.wkid!=null&&jQ(e.wkid)}function HQ(e){return e===ap.GCSMOON2000}function ly(e){return ja(e)&&e.wkid!=null&&HQ(e.wkid)}function Qke(e){return ja(e)&&e.wkid!=null&&Jke[e.wkid]===!0}function ja(e){return _(e)&&(e.wkid!=null&&e.wkid>=2e3||e.wkt!=null)}const uq={wkid:4326,wkt:Bg(Jve[4326].wkTemplate,{Central_Meridian:"0.0"})},Kke={wkid:102100,latestWkid:3857},eUe={wkid:32662};var km;let Kr=km=class extends Ce{constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}static fromJSON(e){if(!e)return null;if(e.wkid){if(e.wkid===102100)return km.WebMercator;if(e.wkid===4326)return km.WGS84}const t=new km;return t.read(e),t}normalizeCtorArgs(e){return e&&typeof e=="object"?e:{[typeof e=="string"?"wkt":"wkid"]:e}}get isWGS84(){return R3(this)}get isWebMercator(){return Gg(this)}get isGeographic(){return BV(this)}get isWrappable(){return Qke(this)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===km.WGS84)return km.WGS84;if(this===km.WebMercator)return km.WebMercator;const e=new km;return this.wkid!=null?(e.wkid=this.wkid,this.latestWkid!=null&&(e.latestWkid=this.latestWkid),this.vcsWkid!=null&&(e.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(e.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(e.wkt=this.wkt),this.imageCoordinateSystem&&(e.imageCoordinateSystem=ue(this.imageCoordinateSystem)),e}equals(e){if(e==null)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(this.imageCoordinateSystem==null||e.imageCoordinateSystem==null)return!1;const{id:t,referenceServiceName:i}=e.imageCoordinateSystem,{geodataXform:r}=e.imageCoordinateSystem,s=this.imageCoordinateSystem;return t==null||r?JSON.stringify(s)===JSON.stringify(e.imageCoordinateSystem):i?s.id===t&&s.referenceServiceName===i:s.id===t}return _a(this,e)}toJSON(e){return this.write(void 0,e)}};Kr.GCS_NAD_1927=null,Kr.WGS84=null,Kr.WebMercator=null,Kr.PlateCarree=null,u([d({readOnly:!0})],Kr.prototype,"isWGS84",null),u([d({readOnly:!0})],Kr.prototype,"isWebMercator",null),u([d({readOnly:!0})],Kr.prototype,"isGeographic",null),u([d({readOnly:!0})],Kr.prototype,"isWrappable",null),u([d({type:Zr,json:{write:!0}})],Kr.prototype,"latestWkid",void 0),u([d({type:Zr,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],Kr.prototype,"wkid",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],Kr.prototype,"wkt",void 0),u([it("wkt"),it("web-scene","wkt")],Kr.prototype,"writeWkt",null),u([d({type:Zr,json:{write:!0}})],Kr.prototype,"vcsWkid",void 0),u([d({type:Zr,json:{write:!0}})],Kr.prototype,"latestVcsWkid",void 0),u([d()],Kr.prototype,"imageCoordinateSystem",void 0),Kr=km=u([L("esri.geometry.SpatialReference")],Kr),Kr.prototype.toJSON.isDefaultToJSON=!0,Kr.GCS_NAD_1927=new Kr({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Kr.WGS84=new Kr(uq),Kr.WebMercator=new Kr(Kke),Kr.PlateCarree=new Kr(eUe),Object.freeze&&(Object.freeze(Kr.GCS_NAD_1927),Object.freeze(Kr.WGS84),Object.freeze(Kr.WebMercator));const at=Kr;let Um=class extends Ce{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=at.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof at)return e;if(e!=null){const i=new at;return i.read(e,t),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};u([d()],Um.prototype,"type",void 0),u([d({readOnly:!0})],Um.prototype,"cache",null),u([d({readOnly:!0})],Um.prototype,"extent",null),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Um.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Um.prototype,"hasZ",void 0),u([d({type:at,json:{write:!0}})],Um.prototype,"spatialReference",void 0),u([De("spatialReference")],Um.prototype,"readSpatialReference",null),Um=u([L("esri.geometry.Geometry")],Um);const Gu=Um;function tUe(e,t,i,r){var s;return e.x=e.x+t,e.y=e.y+i,r!=null&&(e.z=((s=e.z)!=null?s:0)+r),e}function iUe(e,t){const i=e.x-t.x,r=e.y-t.y,s=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(i*i+r*r+s*s)}class qQ{constructor(t,i,r,s){this.semiMajorAxis=t,this.flattening=i,this.outerAtmosphereRimWidth=r;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const Qi=new qQ(6378137,1/298.257223563,3e5,.006694379990137799),Pg=new qQ(3396190,1/169.8944472236118,23e4),dv=new qQ(1737400,0,0),rUe=57.29577951308232,sUe=.017453292519943;function loe(e){return e*rUe}function coe(e){return e*sUe}function uoe(e){return e/Qi.radius}function dU(e){return Math.PI/2-2*Math.atan(Math.exp(-e/Qi.radius))}function hq(e){return e.wkid!=null||e.wkt!=null}const MG=[0,0];function pU(e,t,i,r,s){const n=e,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=t(n.x,n.y,MG,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=t(n.xmin,n.ymin,MG,r),[o.xmax,o.ymax]=t(n.xmax,n.ymax,MG,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const p=a[h];c=[],l.push(c);for(let f=0;f<p.length;f++)c.push(t(p[f][0],p[f][1],[0,0],r)),p[f].length>2&&c[f].push(p[f][2]),p[f].length>3&&c[f].push(p[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=t(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function Ig(e,t){const i=e&&(hq(e)?e:e.spatialReference),r=t&&(hq(t)?t:t.spatialReference);return!(e&&"type"in e&&e.type==="mesh"||t&&"type"in t&&t.type==="mesh"||!i||!r)&&(!!_a(r,i)||Gg(r)&&R3(i)||Gg(i)&&R3(r))}function HS(e,t){if(M(e))return null;const i=e.spatialReference,r=t&&(hq(t)?t:t.spatialReference);return Ig(i,r)?_a(i,r)?ue(e):Gg(r)?pU(e,bT,at.WebMercator,!1,ue(e)):R3(r)?pU(e,oA,at.WGS84,!1,ue(e)):null:null}function bT(e,t,i=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const r=coe(t);return i[0]=coe(e)*Qi.radius,i[1]=Qi.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function oA(e,t,i=[0,0],r=!1){const s=loe(e/Qi.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=loe(Math.PI/2-2*Math.atan(Math.exp(-t/Qi.radius))),i}function $g(e,t=!1,i=ue(e)){return pU(e,bT,at.WebMercator,t,i)}function RC(e,t=!1,i=ue(e)){return pU(e,oA,at.WGS84,t,i)}var B4;const VO=[0,0];function hoe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}const $D=ve.getLogger("esri.geometry.Point");let cc=B4=class extends Gu{constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const i=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(i)?i:i.clone())}normalizeCtorArgs(e,t,i,r,s){let n;if(Array.isArray(e))n=e,s=t,e=n[0],t=n[1],i=n[2],r=n[3];else if(e&&typeof e=="object"){if(n=e,e=n.x!=null?n.x:n.longitude,t=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new at(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)$D.warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)$D.warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=bT(n.longitude,n.latitude,VO);e=a[0],t=a[1]}}}else hoe(i)?(s=i,i=null):hoe(r)&&(s=r,r=null);const o={x:e,y:t};return o.x==null&&o.y!=null?$D.warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&$D.warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(e){e!==(this._get("m")!==void 0)&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return this.z!==void 0}set hasZ(e){e!==(this._get("z")!==void 0)&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){const{spatialReference:e,x:t,y:i}=this;if(e){if(e.isWebMercator)return oA(t,i,VO)[1];if(e.isGeographic)return i}return null}set latitude(e){const{spatialReference:t,x:i}=this;t&&(t.isWebMercator?this._set("y",bT(i,e,VO)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){const{x:e,y:t,spatialReference:i}=this;if(i){if(i.isWebMercator)return oA(e,t,VO)[0];if(i.isGeographic)return e}return null}set longitude(e){const{y:t,spatialReference:i}=this;i&&(i.isWebMercator?this._set("x",bT(e,t,VO)[0]):i.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,i){t[i]=isNaN(e)?"NaN":e}readX(e){return typeof e=="string"?NaN:e}clone(){const e=new B4;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return B4.copy(e,this),this}equals(e){if(M(e))return!1;const{x:t,y:i,z:r,m:s,spatialReference:n}=this,{z:o,m:a}=e;let{x:l,y:c,spatialReference:h}=e;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=bT(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=oA(l,c),h=n}return t===l&&i===c&&r===o&&s===a&&n.wkid===h.wkid}offset(e,t,i){return tUe(this,e,t,i)}normalize(){if(!this.spatialReference)return this;const e=X0(this.spatialReference);if(!e)return this;let t=this.x;const[i,r]=e.valid,s=2*r;let n;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s),this._set("x",t),this}distance(e){return iUe(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],cc.prototype,"cache",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],cc.prototype,"hasM",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],cc.prototype,"hasZ",null),u([d({type:Number})],cc.prototype,"latitude",null),u([d({type:Number})],cc.prototype,"longitude",null),u([d({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Jt(e=>isNaN(e)?e:tp(e))],cc.prototype,"x",void 0),u([it("x")],cc.prototype,"writeX",null),u([De("x")],cc.prototype,"readX",null),u([d({type:Number,json:{write:!0}})],cc.prototype,"y",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],cc.prototype,"z",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],cc.prototype,"m",void 0),cc=B4=u([L("esri.geometry.Point")],cc),cc.prototype.toJSON.isDefaultToJSON=!0;const dt=cc;let jy=class extends Wu(Ce){constructor(...e){super(...e),this.position=new dt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,i,r){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return t!=null&&(s.heading=t),i!=null&&(s.tilt=i),r!=null&&(s.fov=r),s}return e}writePosition(e,t,i,r){const s=e.clone();s.x=tp(e.x||0),s.y=tp(e.y||0),s.z=e.hasZ?tp(e.z||0):e.z,t[i]=s.write({},r)}readPosition(e,t){const i=new dt;return i.read(e,t),i.x=tp(i.x||0),i.y=tp(i.y||0),i.z=i.hasZ?tp(i.z||0):i.z,i}equals(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([d({type:dt,json:{write:{isRequired:!0}}})],jy.prototype,"position",void 0),u([it("position")],jy.prototype,"writePosition",null),u([De("position")],jy.prototype,"readPosition",null),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Jt(e=>VV.normalize(tp(e)))],jy.prototype,"heading",void 0),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Jt(e=>He(tp(e),-180,180))],jy.prototype,"tilt",void 0),u([d({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],jy.prototype,"fov",void 0),jy=u([L("esri.Camera")],jy);const ju=jy,OG=[0,0];function WQ(e,t){return!!_(t)&&Nl(e,t.x,t.y,t.z)}function GNt(e,t){if(!t.points||t.points.length)return!1;for(const i of t.points)if(!BA(e,i))return!1;return!0}function nUe(e,t){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=t;return e.hasZ&&t.hasZ?Nl(e,i,r,s)&&Nl(e,i,o,s)&&Nl(e,n,o,s)&&Nl(e,n,r,s)&&Nl(e,i,r,a)&&Nl(e,i,o,a)&&Nl(e,n,o,a)&&Nl(e,n,r,a):Nl(e,i,r)&&Nl(e,i,o)&&Nl(e,n,o)&&Nl(e,n,r)}function BA(e,t){return Nl(e,t[0],t[1])}function oUe(e,t){return Nl(e,t[0],t[1],t[2])}function Nl(e,t,i,r){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax&&(r==null||!e.hasZ||r>=e.zmin&&r<=e.zmax)}function aUe(e,t){return OG[1]=t.y,OG[0]=t.x,lUe(e,OG)}function lUe(e,t){return Kve(e.rings,t)}function Kve(e,t){if(!e)return!1;if(cUe(e))return doe(!1,e,t);let i=!1;for(let r=0,s=e.length;r<s;r++)i=doe(i,e[r],t);return i}function cUe(e){return!Array.isArray(e[0][0])}function doe(e,t,i){const[r,s]=i;let n=e,o=0;for(let a=0,l=t.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=t[a],[p,f]=t[o];(h<s&&f>=s||f<s&&h>=s)&&c+(s-h)/(f-h)*(p-c)<r&&(n=!n)}return n}function uUe(e,t){return WQ(e,t)}function hUe(e,t){const i=e.hasZ&&t.hasZ;let r,s,n;if(e.xmin<=t.xmin){if(r=t.xmin,e.xmax<r)return!1}else if(r=e.xmin,t.xmax<r)return!1;if(e.ymin<=t.ymin){if(s=t.ymin,e.ymax<s)return!1}else if(s=e.ymin,t.ymax<s)return!1;if(i&&t.hasZ){if(e.zmin<=t.zmin){if(n=t.zmin,e.zmax<n)return!1}else if(n=e.zmin,t.zmax<n)return!1}return!0}function dUe(e,t){const{points:i,hasZ:r}=t,s=r?oUe:BA;for(const n of i)if(s(e,n))return!0;return!1}const lS=[0,0],cS=[0,0],uS=[0,0],hS=[0,0],pUe=[lS,cS,uS,hS],e_e=[[uS,lS],[lS,cS],[cS,hS],[hS,uS]];function fUe(e,t){return mUe(e,t.rings)}function mUe(e,t){lS[0]=e.xmin,lS[1]=e.ymax,cS[0]=e.xmax,cS[1]=e.ymax,uS[0]=e.xmin,uS[1]=e.ymin,hS[0]=e.xmax,hS[1]=e.ymin;for(const i of pUe)if(Kve(t,i))return!0;for(const i of t){if(!i.length)continue;let r=i[0];if(BA(e,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(BA(e,n)||t_e(r,n,e_e))return!0;r=n}}return!1}function gUe(e,t){lS[0]=e.xmin,lS[1]=e.ymax,cS[0]=e.xmax,cS[1]=e.ymax,uS[0]=e.xmin,uS[1]=e.ymin,hS[0]=e.xmax,hS[1]=e.ymin;const i=t.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(BA(e,s))return!0;for(let n=1;n<r.length;n++){const o=r[n];if(BA(e,o)||t_e(s,o,e_e))return!0;s=o}}return!1}const wa=[0,0];function yUe(e){for(let t=0;t<e.length;t++){const i=e[t];for(let s=0;s<i.length-1;s++){const n=i[s],o=i[s+1];for(let a=t+1;a<e.length;a++)for(let l=0;l<e[a].length-1;l++){const c=e[a][l],h=e[a][l+1];if(dq(n,o,c,h,wa)&&!(wa[0]===n[0]&&wa[1]===n[1]||wa[0]===c[0]&&wa[1]===c[1]||wa[0]===o[0]&&wa[1]===o[1]||wa[0]===h[0]&&wa[1]===h[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const o=i[s],a=i[s+1];for(let l=s+2;l<n;l++){const c=i[l],h=i[l+1];if(dq(o,a,c,h,wa)&&!(wa[0]===o[0]&&wa[1]===o[1]||wa[0]===c[0]&&wa[1]===c[1]||wa[0]===a[0]&&wa[1]===a[1]||wa[0]===h[0]&&wa[1]===h[1]))return!0}}}return!1}function t_e(e,t,i){for(let r=0;r<i.length;r++)if(dq(e,t,i[r][0],i[r][1]))return!0;return!1}function dq(e,t,i,r,s){const[n,o]=e,[a,l]=t,[c,h]=i,[p,f]=r,m=p-c,g=n-c,y=a-n,x=f-h,b=o-h,S=l-o,T=x*y-m*S;if(T===0)return!1;const C=(m*b-x*g)/T,A=(y*b-S*g)/T;return C>=0&&C<=1&&A>=0&&A<=1&&(s&&(s[0]=n+C*(a-n),s[1]=o+C*(l-o)),!0)}function vUe(e){switch(e){case"esriGeometryEnvelope":case"extent":return hUe;case"esriGeometryMultipoint":case"multipoint":return dUe;case"esriGeometryPoint":case"point":return uUe;case"esriGeometryPolygon":case"polygon":return fUe;case"esriGeometryPolyline":case"polyline":return gUe}}var Md;function _Ue(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}function Yv(e,t,i){return t==null?i:i==null?t:e(t,i)}let Jo=Md=class extends Gu{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,i,r,s){return _Ue(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:typeof e=="object"?(e.spatialReference=e.spatialReference==null?at.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:i,ymax:r,spatialReference:s==null?at.WGS84:s}}static fromBounds(e,t){return new Md({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}static fromPoint(e){return new Md({xmin:e.x,ymin:e.y,zmin:e.z,xmax:e.x,ymax:e.y,zmax:e.z,spatialReference:e.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new dt({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return e.z!=null&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new Md;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,this.zmin!=null&&(e.zmin=this.zmin,e.zmax=this.zmax),this.mmin!=null&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Ig(t,i)&&(e=t.isWebMercator?$g(e):RC(e,!0)),e.type==="point"?WQ(this,e):e.type==="extent"&&nUe(this,e)}equals(e){if(this===e)return!0;if(M(e))return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Ig(t,i)&&(e=t.isWebMercator?$g(e):RC(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),i=this.width*t,r=this.height*t;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*t;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*t;this.mmin+=s,this.mmax-=s}return this}intersects(e){if(M(e))return!1;e.type==="mesh"&&(e=e.extent);const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Ig(t,i)&&(e=t.isWebMercator?$g(e):RC(e,!0)),vUe(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,i){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this===e||(this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=Yv(Math.min,this.zmin,e.zmin),this.zmax=Yv(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=Yv(Math.min,this.mmin,e.mmin),this.mmax=Yv(Math.max,this.mmax,e.mmax))),this}intersection(e){return this===e?this:M(e)||!this.intersects(e)?null:(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=Yv(Math.max,this.zmin,e.zmin),this.zmax=Yv(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=Yv(Math.max,this.mmin,e.mmin),this.mmax=Yv(Math.min,this.mmax,e.mmax)),this)}toJSON(e){return this.write({},e)}_shiftCM(e=X0(this.spatialReference)){if(!e||!this.spatialReference)return this;const t=this.spatialReference,i=this._getCM(e);if(i){const r=t.isWebMercator?RC(i):i;this.xmin-=i.x,this.xmax-=i.x,t.isWebMercator||(r.x=this._normalizeX(r.x,e).x),this.spatialReference=new at(Bg(t.isWGS84?e.altTemplate:e.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(e){let t=null;const[i,r]=e.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(t=this.center),t}_normalize(e,t,i){const r=this.spatialReference;if(!r)return this;if(!(i=i||X0(r)))return this;const s=this._getParts(i).map(a=>a.extent);if(s.length<2)return s[0]||this;if(s.length>2)return e?this._shiftCM(i):this.set({xmin:i.valid[0],xmax:i.valid[1]});if(e)return this._shiftCM(i);if(t)return s;let n=!0,o=!0;return s.forEach(a=>{a.hasZ||(n=!1),a.hasM||(o=!1)}),{rings:s.map(a=>{const l=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(n){const c=(a.zmax-a.zmin)/2;for(let h=0;h<l.length;h++)l[h].push(c)}if(o){const c=(a.mmax-a.mmin)/2;for(let h=0;h<l.length;h++)l[h].push(c)}return l}),hasZ:n,hasM:o,spatialReference:r}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;e=e||X0(o);const[p,f]=e.valid;h=this._normalizeX(this.xmin,e);const m=h.x,g=h.frameId;h=this._normalizeX(this.xmax,e);const y=h.x,x=h.frameId,b=m===y&&a>0;if(a>2*f){const S=new Md(l<c?m:y,s,f,n,o),T=new Md(p,s,l<c?y:m,n,o),C=new Md(0,s,f,n,o),A=new Md(p,s,0,n,o),O=[],D=[];S.contains(C)&&O.push(g),S.contains(A)&&D.push(g),T.contains(C)&&O.push(x),T.contains(A)&&D.push(x);for(let U=g+1;U<x;U++)O.push(U),D.push(U);t.push({extent:S,frameIds:[g]},{extent:T,frameIds:[x]},{extent:C,frameIds:O},{extent:A,frameIds:D})}else m>y||b?t.push({extent:new Md(m,s,f,n,o),frameIds:[g]},{extent:new Md(p,s,y,n,o),frameIds:[x]}):t.push({extent:new Md(m,s,y,n,o),frameIds:[g]});this.cache._parts=t}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<t.length;n++)t[n].extent.set(s)}return t}_normalizeX(e,t){const[i,r]=t.valid,s=2*r;let n,o=0;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s,o=n):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s,o=-n),{x:e,frameId:o}}};u([d({readOnly:!0})],Jo.prototype,"cache",null),u([d({readOnly:!0})],Jo.prototype,"center",null),u([d({readOnly:!0})],Jo.prototype,"extent",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Jo.prototype,"hasM",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Jo.prototype,"hasZ",null),u([d({readOnly:!0})],Jo.prototype,"height",null),u([d({readOnly:!0})],Jo.prototype,"width",null),u([d({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Jo.prototype,"xmin",void 0),u([d({type:Number,json:{write:!0}})],Jo.prototype,"ymin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Jo.prototype,"mmin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Jo.prototype,"zmin",void 0),u([d({type:Number,json:{write:!0}})],Jo.prototype,"xmax",void 0),u([d({type:Number,json:{write:!0}})],Jo.prototype,"ymax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Jo.prototype,"mmax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Jo.prototype,"zmax",void 0),Jo=Md=u([L("esri.geometry.Extent")],Jo),Jo.prototype.toJSON.isDefaultToJSON=!0;const yi=Jo;function GA(e,t,i=!1){let{hasM:r,hasZ:s}=e;Array.isArray(t)?t.length!==4||r||s?t.length===3&&i&&!r?(s=!0,r=!1):t.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&t.hasZ&&(!r||t.hasM),r=!r&&t.hasM&&(!s||t.hasZ)),e.hasZ=s,e.hasM=r}var pq;function poe(e){return(t,i)=>t==null?i:i==null?t:e(t,i)}function bUe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let N_=pq=class extends Gu{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return null;const i={};Array.isArray(e)?(i.points=e,i.spatialReference=t):bUe(e)?i.spatialReference=e:(e.points&&(i.points=e.points),e.spatialReference&&(i.spatialReference=e.spatialReference),e.hasZ&&(i.hasZ=e.hasZ),e.hasM&&(i.hasM=e.hasM));const r=i.points&&i.points[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new yi,i=this.hasZ,r=this.hasM,s=i?3:2,n=e[0],o=poe(Math.min),a=poe(Math.max);let l,c,h,p,[f,m]=n,[g,y]=n;for(let x=0,b=e.length;x<b;x++){const S=e[x],[T,C]=S;if(f=o(f,T),m=o(m,C),g=a(g,T),y=a(y,C),i&&S.length>2){const A=S[2];l=o(l,A),h=a(h,A)}if(r&&S.length>s){const A=S[s];c=o(c,A),p=a(p,A)}}return t.xmin=f,t.ymin=m,t.xmax=g,t.ymax=y,t.spatialReference=this.spatialReference,i?(t.zmin=l,t.zmax=h):(t.zmin=null,t.zmax=null),r?(t.mmin=c,t.mmax=p):(t.mmin=null,t.mmax=null),t}writePoints(e,t){t.points=ue(this.points)}addPoint(e){return GA(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:ue(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new pq(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],i={x:t[0],y:t[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=t[2],r=3),this.hasM&&(i.m=t[r]),new dt(i)}removePoint(e){if(!this._validateInputs(e))return null;const t=new dt(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?(GA(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write({},e)}_validateInputs(e){return e!=null&&e>=0&&e<this.points.length}};u([d({readOnly:!0})],N_.prototype,"cache",null),u([d()],N_.prototype,"extent",null),u([d({type:[[Number]],json:{write:{isRequired:!0}}})],N_.prototype,"points",void 0),u([it("points")],N_.prototype,"writePoints",null),N_=pq=u([L("esri.geometry.Multipoint")],N_),N_.prototype.toJSON.isDefaultToJSON=!0;const Wf=N_;function foe(e){if(!e)return null;if(Array.isArray(e))return e;const t=e.hasZ,i=e.hasM;if(e.type==="point")return i&&t?[e.x,e.y,e.z,e.m]:t?[e.x,e.y,e.z]:i?[e.x,e.y,e.m]:[e.x,e.y];if(e.type==="polygon")return e.rings.slice(0);if(e.type==="polyline")return e.paths.slice(0);if(e.type==="multipoint")return e.points.slice(0);if(e.type==="extent"){const r=e.clone().normalize();if(!r)return null;let s=!1,n=!1;return r.forEach(o=>{o.hasZ&&(s=!0),o.hasM&&(n=!0)}),r.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(s&&o.hasZ){const l=.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(n&&o.hasM){const l=.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a})}return null}function ZQ(e,t){const i=t[0]-e[0],r=t[1]-e[1];if(e.length>2&&t.length>2){const s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function i_e(e,t,i){const r=e[0]+i*(t[0]-e[0]),s=e[1]+i*(t[1]-e[1]);return e.length>2&&t.length>2?[r,s,e[2]+i*(t[2]-e[2])]:[r,s]}function wUe(e,t){return i_e(e,t,.5)}function r_e(e){const t=e.length;let i=0;for(let r=0;r<t-1;++r)i+=ZQ(e[r],e[r+1]);return i}function s_e(e,t){if(t<=0)return e[0];const i=e.length;let r=0;for(let s=0;s<i-1;++s){const n=ZQ(e[s],e[s+1]);if(t-r<n){const o=(t-r)/n;return i_e(e[s],e[s+1],o)}r+=n}return e[i-1]}function GV(e,t,i){const r=e.length;let s=0,n=0,o=0;for(let a=0;a<r;a++){const l=e[a],c=e[(a+1)%r];let h=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&i&&(n+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&t&&(o+=l[0]*c[h]-c[0]*l[h])}return s<=0&&n<=0&&o<=0}function jNt(e){if("rings"in e){for(const t of e.rings)t.length<3||t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]||t.push([t[0][0],t[0][1]]);if(e.rings.length>0&&!GV(e.rings[0],e.hasM,e.hasZ))for(let t=0;t<e.rings.length;++t)e.rings[t]=e.rings[t].reverse()}}function HNt(e){if("rings"in e)for(const t of e.rings)t.length<3||t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]||t.push([t[0][0],t[0][1]])}function qNt(e){return e.type!=="polygon"&&e.type!=="polyline"||xUe(e.type==="polygon"?e.rings:e.paths,e.spatialReference),e}function xUe(e,t){const i=X0(t);if(!i)return;const r=i.valid[0],s=i.valid[1],n=s-r;for(const o of e){let a=1/0,l=-1/0;o.forEach(h=>{let p=h[0];for(;p<r;)p+=n;for(;p>s;)p-=n;a=Math.min(a,p),l=Math.max(l,p),h[0]=p});const c=l-a;n-c<c&&o.forEach(h=>{h[0]<0&&(h[0]+=n)})}}function TUe(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null}function n_e(e){return e?o_e(e.rings,e.hasZ):null}function o_e(e,t){if(!e||!e.length)return null;const i=[],r=[],s=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=e.length;n<o;n++){const a=SUe(e[n],t,s);a&&r.push(a)}if(r.sort((n,o)=>{let a=n[2]-o[2];return a===0&&t&&(a=n[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],t&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||t&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=e[0]&&e[0].length?EUe(e[0],t):null;if(!n)return null;i[0]=n[0],i[1]=n[1],t&&n.length>2&&(i[2]=n[2])}return i}function SUe(e,t,i){let r=0,s=0,n=0,o=0,a=0;const l=e.length?e[0][0]:0,c=e.length?e[0][1]:0,h=e.length&&t?e[0][2]:0;for(let f=0;f<e.length;f++){const m=e[f],g=e[(f+1)%e.length],[y,x,b]=m,S=y-l,T=x-c,C=t?b-h:void 0,[A,O,D]=g,U=A-l,k=O-c,B=t?D-h:void 0,j=S*k-U*T;if(o+=j,r+=(S+U)*j,s+=(T+k)*j,t&&m.length>2&&g.length>2){const H=S*B-U*C;n+=(C+B)*H,a+=H}y<i[0]&&(i[0]=y),y>i[1]&&(i[1]=y),x<i[2]&&(i[2]=x),x>i[3]&&(i[3]=x),t&&(b<i[4]&&(i[4]=b),b>i[5]&&(i[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[r/(6*o)+l,s/(6*o)+c,o];return t&&(i[4]===i[5]||a===0?(p[3]=(i[4]+i[5])/2,p[4]=0):(p[3]=n/(6*a)+h,p[4]=a)),p}function EUe(e,t){const i=t?[0,0,0]:[0,0],r=t?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=e.length;l<c-1;l++){const h=e[l],p=e[l+1];if(h&&p){i[0]=h[0],i[1]=h[1],r[0]=p[0],r[1]=p[1],t&&h.length>2&&p.length>2&&(i[2]=h[2],r[2]=p[2]);const f=ZQ(i,r);if(f){s+=f;const m=wUe(h,p);n+=f*m[0],o+=f*m[1],t&&m.length>2&&(a+=f*m[2])}}}return s>0?t?[n/s,o/s,a/s]:[n/s,o/s]:e.length?e[0]:null}function a_e(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function l_e(e){return e.points!==void 0}function c_e(e){return e.x!==void 0&&e.y!==void 0}function u_e(e){return e.paths!==void 0}function h_e(e){return e.rings!==void 0}function d_e(e){return(t,i)=>t==null?i:i==null?t:e(t,i)}const j1=d_e(Math.min),H1=d_e(Math.max);function WNt(e,t){return u_e(t)?jA(e,t.paths,!1,!1):h_e(t)?jA(e,t.rings,!1,!1):l_e(t)?XQ(e,t.points,!1,!1,!1,!1):a_e(t)?p_e(e,t):(c_e(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function ZNt(e,t){return u_e(t)?jA(e,t.paths,!0,!1):h_e(t)?jA(e,t.rings,!0,!1):l_e(t)?XQ(e,t.points,!0,!1,!0,!1):a_e(t)?p_e(e,t,!0,!1,!0,!1):(c_e(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function jA(e,t,i,r){const s=i?3:2;if(!t.length||!t[0].length)return null;let n,o,a,l,[c,h]=t[0][0],[p,f]=t[0][0];for(let m=0;m<t.length;m++){const g=t[m];for(let y=0;y<g.length;y++){const x=g[y],[b,S]=x;if(c=j1(c,b),h=j1(h,S),p=H1(p,b),f=H1(f,S),i&&x.length>2){const T=x[2];n=j1(n,T),o=H1(o,T)}if(r&&x.length>s){const T=x[s];a=j1(n,T),l=H1(o,T)}}}return i?r?(e[0]=c,e[1]=h,e[2]=n,e[3]=a,e[4]=p,e[5]=f,e[6]=o,e[7]=l,e.length=8,e):(e[0]=c,e[1]=h,e[2]=n,e[3]=p,e[4]=f,e[5]=o,e.length=6,e):r?(e[0]=c,e[1]=h,e[2]=a,e[3]=p,e[4]=f,e[5]=l,e.length=6,e):(e[0]=c,e[1]=h,e[2]=p,e[3]=f,e.length=4,e)}function p_e(e,t,i,r,s,n){const o=t.xmin,a=t.xmax,l=t.ymin,c=t.ymax;let h=t.zmin,p=t.zmax,f=t.mmin,m=t.mmax;return s?(h=h||0,p=p||0,n?(f=f||0,m=m||0,e[0]=o,e[1]=l,e[2]=h,e[3]=f,e[4]=a,e[5]=c,e[6]=p,e[7]=m,e):(e[0]=o,e[1]=l,e[2]=h,e[3]=a,e[4]=c,e[5]=p,e)):n?(f=f||0,m=m||0,e[0]=o,e[1]=l,e[2]=f,e[3]=a,e[4]=c,e[5]=m,e):(e[0]=o,e[1]=l,e[2]=a,e[3]=c,e)}function XQ(e,t,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!t.length||!t[0].length)return null;let c,h,p,f,[m,g]=t[0],[y,x]=t[0];for(let b=0;b<t.length;b++){const S=t[b],[T,C]=S;if(m=j1(m,T),g=j1(g,C),y=H1(y,T),x=H1(x,C),l&&S.length>2){const A=S[2];c=j1(c,A),h=H1(h,A)}if(a&&S.length>o){const A=S[o];p=j1(c,A),f=H1(h,A)}}return s?(c=c||0,h=h||0,n?(p=p||0,f=f||0,e[0]=m,e[1]=g,e[2]=c,e[3]=p,e[4]=y,e[5]=x,e[6]=h,e[7]=f,e):(e[0]=m,e[1]=g,e[2]=c,e[3]=y,e[4]=x,e[5]=h,e)):n?(p=p||0,f=f||0,e[0]=m,e[1]=g,e[2]=p,e[3]=y,e[4]=x,e[5]=f,e):(e[0]=m,e[1]=g,e[2]=y,e[3]=x,e)}function CUe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function AUe(e){return e.points!==void 0}function MUe(e){return e.x!==void 0&&e.y!==void 0}function OUe(e){return e.paths!==void 0}function RUe(e){return e.rings!==void 0}const YQ=[];function f_e(e,t,i,r){return{xmin:e,ymin:t,xmax:i,ymax:r}}function m_e(e,t,i,r,s,n){return{xmin:e,ymin:t,zmin:i,xmax:r,ymax:s,zmax:n}}function g_e(e,t,i,r,s,n){return{xmin:e,ymin:t,mmin:i,xmax:r,ymax:s,mmax:n}}function y_e(e,t,i,r,s,n,o,a){return{xmin:e,ymin:t,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function JQ(e,t=!1,i=!1){return t?i?y_e(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):m_e(e[0],e[1],e[2],e[3],e[4],e[5]):i?g_e(e[0],e[1],e[2],e[3],e[4],e[5]):f_e(e[0],e[1],e[2],e[3])}function fq(e){return e?CUe(e)?e:MUe(e)?IUe(e):RUe(e)?QQ(e):OUe(e)?v_e(e):AUe(e)?PUe(e):null:null}function PUe(e){const{hasZ:t,hasM:i,points:r}=e;return JQ(XQ(YQ,r,t,i),t,i)}function IUe(e){const{x:t,y:i,z:r,m:s}=e,n=s!=null;return r!=null?n?y_e(t,i,r,s,t,i,r,s):m_e(t,i,r,t,i,r):n?g_e(t,i,s,t,i,s):f_e(t,i,t,i)}function QQ(e){const{hasZ:t,hasM:i,rings:r}=e,s=jA(YQ,r,t,i);return s?JQ(s,t,i):null}function v_e(e){const{hasZ:t,hasM:i,paths:r}=e,s=jA(YQ,r,t,i);return s?JQ(s,t,i):null}var G4;function moe(e){return!Array.isArray(e[0])}let zm=G4=class extends Gu{constructor(...e){super(...e),this.rings=[],this.type="polygon"}static fromExtent(e){const t=e.clone().normalize(),i=e.spatialReference;let r=!1,s=!1;for(const o of t)o.hasZ&&(r=!0),o.hasM&&(s=!0);const n={rings:t.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new G4(n)}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.rings?e.rings:null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||at.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=n.length>3):i===void 0?i=r?n.length>3:n.length>2:r===void 0&&(r=i?n.length>3:n.length>2)),{rings:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=n_e(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new dt;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=QQ(this);if(!t)return null;const i=new yi(t);return i.spatialReference=e,i}get isSelfIntersecting(){return yUe(this.rings)}writeRings(e,t){t.rings=ue(this.rings)}addRing(e){if(!e)return;const t=this.rings,i=t.length;if(moe(e)){const r=[];for(let s=0,n=e.length;s<n;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new G4;return e.spatialReference=this.spatialReference,e.rings=ue(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}equals(e){if(this===e)return!0;if(M(e))return!1;const t=this.spatialReference,i=e.spatialReference;if(_(t)!==_(i)||_(t)&&_(i)&&!t.equals(i)||this.rings.length!==e.rings.length)return!1;const r=([s,n,o,a],[l,c,h,p])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&p==null||a===p);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=e.rings[s];if(!wb(n,o,r))return!1}return!0}contains(e){if(!e)return!1;const t=HS(e,this.spatialReference);return aUe(this,_(t)?t:e)}isClockwise(e){let t;return t=moe(e)?e.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):e,GV(t,this.hasM,this.hasZ)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.rings[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new dt(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new dt(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new dt(i[0],i[1],i[2],i[3],this.spatialReference):new dt(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(GA(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e].splice(t,0,i),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new dt(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new dt(s,i));return this.notifyChange("rings"),r}setPoint(e,t,i){return this._validateInputs(e,t)?(GA(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e][t]=i,this.notifyChange("rings"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.rings.length)return!1;if(t!=null){const r=this.rings[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],zm.prototype,"cache",null),u([d({readOnly:!0})],zm.prototype,"centroid",null),u([d({readOnly:!0})],zm.prototype,"extent",null),u([d({readOnly:!0})],zm.prototype,"isSelfIntersecting",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],zm.prototype,"rings",void 0),u([it("rings")],zm.prototype,"writeRings",null),zm=G4=u([L("esri.geometry.Polygon")],zm),zm.prototype.toJSON.isDefaultToJSON=!0;const Uo=zm;var mq;function $Ue(e){return!Array.isArray(e[0])}let F_=mq=class extends Gu{constructor(...e){super(...e),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.paths?e.paths:null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||at.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=!1):i===void 0?i=!r&&n.length>3:r===void 0&&(r=!i&&n.length>3)),{paths:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=v_e(this);if(!t)return null;const i=new yi(t);return i.spatialReference=e,i}writePaths(e,t){t.paths=ue(this.paths)}addPath(e){if(!e)return;const t=this.paths,i=t.length;if($Ue(e)){const r=[];for(let s=0,n=e.length;s<n;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new mq;return e.spatialReference=this.spatialReference,e.paths=ue(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.paths[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new dt(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new dt(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new dt(i[0],i[1],i[2],i[3],this.spatialReference):new dt(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(GA(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e].splice(t,0,i),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new dt(s,i));return this.notifyChange("paths"),r}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new dt(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(e,t,i){return this._validateInputs(e,t)?(GA(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e][t]=i,this.notifyChange("paths"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.paths.length)return!1;if(t!=null){const r=this.paths[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],F_.prototype,"cache",null),u([d({readOnly:!0})],F_.prototype,"extent",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],F_.prototype,"paths",void 0),u([it("paths")],F_.prototype,"writePaths",null),F_=mq=u([L("esri.geometry.Polyline")],F_),F_.prototype.toJSON.isDefaultToJSON=!0;const Fa=F_;class Ti{constructor(t,i={ignoreUnknown:!1,useNumericKeys:!1}){this.jsonToAPI=t,this.options=i,this.apiValues=[],this.jsonValues=[],this.apiToJSON=this._invertMap(t),this.apiValues=this._getKeysSorted(this.apiToJSON),this.jsonValues=this._getKeysSorted(this.jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const o=this.toJSON(r);o!==void 0&&Bu(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(t){if(this.apiToJSON.hasOwnProperty(t)){const i=this.apiToJSON[t];return this.options.useNumericKeys?+i:i}return this.options.ignoreUnknown?void 0:t}fromJSON(t){return this.jsonToAPI.hasOwnProperty(t)?this.jsonToAPI[t]:this.options.ignoreUnknown?void 0:t}_invertMap(t){const i={};for(const r in t)i[t[r]]=r;return i}_getKeysSorted(t){const i=[];for(const r in t)i.push(r);return i.sort(),i}}function ml(){return function(e,t){return new Ti(e,F({ignoreUnknown:!0},t))}}const __e=ml()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),goe=ml()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function b_e(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function KQ(e){return e.points!==void 0}function eK(e){return e.x!==void 0&&e.y!==void 0}function tK(e){return e.paths!==void 0}function BT(e){return e.rings!==void 0}function jg(e){return M(e)?null:e instanceof Gu?e:eK(e)?dt.fromJSON(e):tK(e)?Fa.fromJSON(e):BT(e)?Uo.fromJSON(e):KQ(e)?Wf.fromJSON(e):b_e(e)?yi.fromJSON(e):null}function tO(e){return e?eK(e)?"esriGeometryPoint":tK(e)?"esriGeometryPolyline":BT(e)?"esriGeometryPolygon":b_e(e)?"esriGeometryEnvelope":KQ(e)?"esriGeometryMultipoint":null:null}const LUe={esriGeometryPoint:dt,esriGeometryPolyline:Fa,esriGeometryPolygon:Uo,esriGeometryEnvelope:yi,esriGeometryMultipoint:Wf};function w_e(e){return e&&LUe[e]||null}const qS={base:Gu,key:"type",typeMap:{extent:yi,multipoint:Wf,point:dt,polyline:Fa,polygon:Uo}};im(qS);class aA{constructor(){this._emitter=new aA.EventEmitter(this)}emit(t,i){return this._emitter.emit(t,i)}on(t,i){return this._emitter.on(t,i)}once(t,i){return this._emitter.once(t,i)}hasEventListener(t){return this._emitter.hasEventListener(t)}}(function(e){class t{constructor(s=null){this.target=s,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this.target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return td(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}e.EventEmitter=t,e.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([L("esri.core.Evented")],s),s};let i=class extends Ee{constructor(){super(...arguments),this._emitter=new aA.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=u([L("esri.core.Evented")],i),e.EventedAccessor=i})(aA||(aA={}));const cs=aA;var yr;(function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"})(yr||(yr={}));function iK(e){return(t,i)=>{t[i]=e}}class x_e{constructor(){this._observers=[]}observe(t){return this._observers.includes(t)||this._observers.push(t),new xve(this._observers,t)}notify(){const t=this._observers.slice();for(let i=0;i<t.length;++i){const r=t[i];r.onInvalidated(),r.onCommitted()}}}var M0;class DUe{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}}const pd=new un(DUe,void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1}),NUe=()=>{};function RG(e){return e?e instanceof Qx?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function PG(e){if(e&&e.length)return e[0]}function FUe(e,t,i,r){const s=Math.min(e.length-i,t.length-r);let n=0;for(;n<s&&e[i+n]===t[r+n];)n++;return n}function T_e(e,t,i,r){t&&t.forEach((s,n,o)=>{e.push(s),T_e(e,i.call(r,s,n,o),i,r)})}const Jv=new Set,Qv=new Set,Kv=new Set,IG=new Map;let kUe=0,Qx=M0=class extends cs.EventedAccessor{constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new x_e,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:kUe++})}static isCollection(e){return e!=null&&e instanceof M0}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof M0?{items:e}:e:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return bi(this._observable),this._items}set items(e){this._emitBeforeChanges(yr.ADD)||(this._splice(0,this.length,RG(e)),this._emitAfterChanges(yr.ADD))}hasEventListener(e){return e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e)}on(e,t){if(e==="change"){const i=this._chgListeners,r={removed:!1,callback:t};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=NUe,r.removed=!0,i.splice(i.indexOf(r),1)}}}return this._emitter.on(e,t)}once(e,t){const i=this.on(e,t);return{remove(){i.remove()}}}add(e,t){if(bi(this._observable),this._emitBeforeChanges(yr.ADD))return this;const i=this.getNextIndex(t!=null?t:null);return this._splice(i,0,[e]),this._emitAfterChanges(yr.ADD),this}addMany(e,t=this._items.length){if(bi(this._observable),!e||!e.length)return this;if(this._emitBeforeChanges(yr.ADD))return this;const i=this.getNextIndex(t);return this._splice(i,0,RG(e)),this._emitAfterChanges(yr.ADD),this}at(e){if(bi(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(bi(this._observable),!this.length||this._emitBeforeChanges(yr.REMOVE))return[];const e=this._splice(0,this.length)||[];return this._emitAfterChanges(yr.REMOVE),e}clone(){return bi(this._observable),this._createNewInstance({items:this._items.map(ue)})}concat(...e){bi(this._observable);const t=e.map(RG);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(bi(this._observable),!this.length||this._emitBeforeChanges(yr.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)e.call(t,i[s],s,i);this._emitAfterChanges(yr.REMOVE)}every(e,t){return bi(this._observable),this._items.every(e,t)}filter(e,t){let i;return bi(this._observable),i=arguments.length===2?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:i})}find(e,t){return bi(this._observable),this._items.find(e,t)}findIndex(e,t){return bi(this._observable),this._items.findIndex(e,t)}flatten(e,t){bi(this._observable);const i=[];return T_e(i,this,e,t),new M0(i)}forEach(e,t){return bi(this._observable),this._items.forEach(e,t)}getItemAt(e){return bi(this._observable),this._items[e]}getNextIndex(e){bi(this._observable);const t=this.length;return(e=e==null?t:e)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return bi(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return bi(this._observable),this._items.indexOf(e,t)}join(e=","){return bi(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return bi(this._observable),this._items.lastIndexOf(e,t)}map(e,t){bi(this._observable);const i=this._items.map(e,t);return new M0({items:i})}reorder(e,t=this.length-1){bi(this._observable);const i=this.indexOf(e);if(i!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),i!==t){if(this._emitBeforeChanges(yr.MOVE))return e;this._splice(i,1),this._splice(t,0,[e]),this._emitAfterChanges(yr.MOVE)}return e}}pop(){if(bi(this._observable),!this.length||this._emitBeforeChanges(yr.REMOVE))return;const e=PG(this._splice(this.length-1,1));return this._emitAfterChanges(yr.REMOVE),e}push(...e){return bi(this._observable),this._emitBeforeChanges(yr.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(yr.ADD)),this.length}reduce(e,t){bi(this._observable);const i=this._items;return arguments.length===2?i.reduce(e,t):i.reduce(e)}reduceRight(e,t){bi(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(e,t):i.reduceRight(e)}remove(e){return bi(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(bi(this._observable),e<0||e>=this.length||this._emitBeforeChanges(yr.REMOVE))return;const t=PG(this._splice(e,1));return this._emitAfterChanges(yr.REMOVE),t}removeMany(e){if(bi(this._observable),!e||!e.length||this._emitBeforeChanges(yr.REMOVE))return[];const t=e instanceof M0?e.toArray():e,i=this._items,r=[],s=t.length;for(let n=0;n<s;n++){const o=t[n],a=i.indexOf(o);if(a>-1){const l=1+FUe(t,i,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),n+=l-1}}return this._emitAfterChanges(yr.REMOVE),r}reverse(){if(bi(this._observable),this._emitBeforeChanges(yr.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(yr.MOVE),this}shift(){if(bi(this._observable),!this.length||this._emitBeforeChanges(yr.REMOVE))return;const e=PG(this._splice(0,1));return this._emitAfterChanges(yr.REMOVE),e}slice(e=0,t=this.length){return bi(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return bi(this._observable),this._items.some(e,t)}sort(e){if(bi(this._observable),!this.length||this._emitBeforeChanges(yr.MOVE))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(yr.MOVE),this}splice(e,t,...i){bi(this._observable);const r=(t?yr.REMOVE:0)|(i.length?yr.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(e,t,i)||[];return this._emitAfterChanges(r),s}toArray(){return bi(this._observable),this._items.slice()}toJSON(){return bi(this._observable),this.toArray()}toLocaleString(){return bi(this._observable),this._items.toLocaleString()}toString(){return bi(this._observable),this._items.toString()}unshift(...e){return bi(this._observable),!e.length||this._emitBeforeChanges(yr.ADD)||(this._splice(0,0,e),this._emitAfterChanges(yr.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=Zb(()=>this._dispatchChange())),t){if(o=r.splice(e,t),this.hasEventListener("before-remove")){const a=pd.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(e,0,n),e+=1,l-=1,c-=1);pd.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=pd.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);pd.release(a)}}if(i&&i.length){if(s){const h=[];for(const p of i){const f=s.ensureType(p);f==null&&p!=null||h.push(f)}i=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=e===this.length;if(a||l){const h=pd.acquire();h.target=this,h.cancellable=!0;const p=pd.acquire();p.target=this,p.cancellable=!1;for(const f of i)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?r.push(f):r.splice(e++,0,f),this._set("length",r.length),l&&(p.reset(f),this.emit("after-add",p)))):(c?r.push(f):r.splice(e++,0,f),this._set("length",r.length),p.reset(f),this.emit("after-add",p));pd.release(p),pd.release(h)}else{if(c)for(const h of i)r.push(h);else r.splice(e,0,...i);this._set("length",r.length)}}return(i&&i.length||o&&o.length)&&this._notifyChangeEvent(i,o),o}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const i=pd.acquire();i.target=this,i.cancellable=!0,i.type=e,this.emit("before-changes",i),t=i.defaultPrevented,pd.release(i)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=pd.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),pd.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const i=t.changes;Jv.clear(),Qv.clear(),Kv.clear();for(const{added:l,removed:c}of i){if(l)if(Kv.size===0&&Qv.size===0)for(const h of l)Jv.add(h);else for(const h of l)Qv.has(h)?(Kv.add(h),Qv.delete(h)):Kv.has(h)||Jv.add(h);if(c)if(Kv.size===0&&Jv.size===0)for(const h of c)Qv.add(h);else for(const h of c)Jv.has(h)?Jv.delete(h):(Kv.delete(h),Qv.add(h))}const r=Eu.acquire();Jv.forEach(l=>{r.push(l)});const s=Eu.acquire();Qv.forEach(l=>{s.push(l)});const n=this._items,o=t.items,a=Eu.acquire();if(Kv.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),t.listeners&&(r.length||s.length||a.length)){const l={target:this,added:r,removed:s,moved:a},c=t.listeners.length;for(let h=0;h<c;h++){const p=t.listeners[h];p.removed||p.callback.call(this,l)}}Eu.release(r),Eu.release(s),Eu.release(a)}Jv.clear(),Qv.clear(),Kv.clear()}};Qx.ofType=e=>{if(!e)return M0;if(IG.has(e))return IG.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const r in e.typeMap){const s=e.typeMap[r].prototype.declaredClass;t?t+=` | ${s}`:t=s}let i=class extends M0{};return u([iK({Type:e,ensureType:typeof e=="function"?dn(e):im(e)})],i.prototype,"itemType",void 0),i=u([L(`esri.core.Collection<${t}>`)],i),IG.set(e,i),i},u([d()],Qx.prototype,"length",void 0),u([d()],Qx.prototype,"items",null),Qx=M0=u([L("esri.core.Collection")],Qx);const nt=Qx;var HA;function UUe(e,t){switch(e.type){case"range":{const i="range"in e?e.range[0]:e.minValue,r="range"in e?e.range[1]:e.maxValue;if(+t<i||+t>r)return HA.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(e.codedValues==null||e.codedValues.every(i=>i==null||i.code!==t))return HA.INVALID_CODED_VALUE}return null}(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(HA||(HA={}));let $G;function sm(){return $G||($G=(async()=>{const e=await import("./arcadeUtils.2b1023a3.js").then(function(t){return t.t});return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),$G}const zUe=(e,t,i)=>cL.create(e,t,i,null,["$feature"]),VUe=(e,t,i)=>cL.create(e,t,i,null,["$feature","$view"]),BUe=(e,t,i,r)=>cL.create(e,t,i,r,["$feature","$view"]);class cL{constructor(t,i,r,s,n,o,a,l){this.script=t,this.evaluate=n;const c=Array.isArray(a)?a:a.fields;this.fields=c,this._syntaxTree=s,this._arcade=i,this._arcadeDictionary=r,this._arcadeFeature=o,this._spatialReference=l,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(t,i,r,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await sm(),h=at.fromJSON(i),p=a.parseScript(t,o),f=n.reduce((A,O)=>me(F({},A),{[O]:null}),{});let m=null;_(s)&&(m=new c(s),m.immutable=!0,f.$config=null);const g=a.scriptUsesGeometryEngine(p)&&a.enableGeometrySupport(),y=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),x=a.scriptIsAsync(p)&&a.enableAsyncSupport(),b={vars:f,spatialReference:h,useAsync:!!x},S=new c;S.immutable=!1,S.setField("scale",0);const T=a.compileScript(p,b),C=A=>("$view"in A&&A.$view&&(S.setField("scale",A.$view.scale),A.$view=S),m&&(A.$config=m),T({vars:A,spatialReference:h}));return await Promise.all([g,y,x]),new cL(t,a,c,p,C,new l,r,h)}repurposeFeature(t){return t.geometry&&!t.geometry.spatialReference&&(t.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(t){return this._arcade.referencesMember(this._syntaxTree,t)}referencesFunction(t){return this._arcade.referencesFunction(this._syntaxTree,t)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)}}const GUe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],jUe=["field","normalizationField"];function fU(e,t){if(e!=null&&t!=null){for(const i of Array.isArray(e)?e:[e])if(yoe(GUe,i,t),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)yoe(jUe,r,t)}}function yoe(e,t,i){if(e)for(const r of e){const s=QM(r,t),n=s&&typeof s!="function"&&i.get(s);n&&Bu(r,n.name,t)}}function S_e(e,t){if(e!=null&&(t==null?void 0:t.fields.length))if("startField"in e){const i=t.get(e.startField),r=t.get(e.endField);e.startField=i&&i.name||null,e.endField=r&&r.name||null}else{const i=t.get(e.startTimeField),r=t.get(e.endTimeField);e.startTimeField=i&&i.name||null,e.endTimeField=r&&r.name||null}}const LG=new Set;function E_e(e,t){return e&&t?(LG.clear(),I3(LG,e,t),Array.from(LG).sort()):[]}function I3(e,t,i){var r;if(i)if((r=t==null?void 0:t.fields)==null?void 0:r.length)if(i.includes("*"))for(const{name:s}of t.fields)e.add(s);else for(const s of i)mp(e,t,s);else{if(i.includes("*"))return e.clear(),void e.add("*");for(const s of i)e.add(s)}}function mp(e,t,i){if(typeof i=="string")if(t){const r=t.get(i);r&&e.add(r.name)}else e.add(i)}function XNt(e,t){return M(t)||M(e)?[]:t.includes("*")?e.fields.map(i=>i.name):t}async function zc(e,t,i){var n;if(!i)return;const{arcadeUtils:r}=await sm(),s=r.extractFieldNames(i,(n=t==null?void 0:t.fields)==null?void 0:n.map(o=>o.name));for(const o of s)mp(e,t,o)}async function C_e(e,t,i){if(i&&i!=="1=1"){const r=(await Promise.resolve().then(function(){return Ese})).WhereClause.create(i,t);if(!r.isStandardized)throw new W("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});I3(e,t,r.fieldNames)}}function HUe({displayField:e,fields:t}){return e||(t&&t.length?DG(t,"name-or-title")||DG(t,"unique-identifier")||DG(t,"type-or-category")||qUe(t):null)}function qUe(e){for(const t of e){if(!t||!t.name)continue;const i=t.name.toLowerCase();if(i.includes("name")||i.includes("title"))return t.name}return null}function DG(e,t){for(const i of e)if(i&&i.valueType&&i.valueType===t)return i.name;return null}async function YNt(e,t){if(!t)return;const i=QM("elevationInfo.featureExpressionInfo",t);return i?i.collectRequiredFields(e,t.fieldsIndex):void 0}async function WUe(e,t,i){i.outStatistic.onStatisticValueExpression?zc(e,t,i.outStatistic.onStatisticValueExpression):e.add(i.outStatistic.onStatisticField)}async function JNt(e,t,i){var s,n;if(!t||!i||!("fields"in i))return;const r=[];if(((s=i.popupTemplate)==null?void 0:s.expressionInfos)&&r.push(...i.popupTemplate.expressionInfos.map(o=>zc(e,t.fieldsIndex,o.expression))),Array.isArray((n=i.popupTemplate)==null?void 0:n.content)){const o=i.popupTemplate.content;for(const a of o)a.type==="expression"&&a.expressionInfo&&r.push(zc(e,t.fieldsIndex,a.expressionInfo.expression))}i.fields&&r.push(...i.fields.map(o=>WUe(e,t.fieldsIndex,o))),await Promise.all(r)}async function QNt(e,t,i){t&&(t.timeInfo&&_(i)&&i.timeExtent&&I3(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&I3(e,t.fieldsIndex,[t.floorInfo.floorField]),_(i)&&_(i.where)&&await C_e(e,t.fieldsIndex,i.where))}async function KNt(e,t,i){t&&i&&await Promise.all(i.map(r=>ZUe(e,t,r)))}async function ZUe(e,t,i){t&&i&&(i.valueExpression?await zc(e,t.fieldsIndex,i.valueExpression):i.field&&mp(e,t.fieldsIndex,i.field))}function eFt(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;return t?E_e(e.fieldsIndex,[t&&t.creatorField,t&&t.creationDateField,t&&t.editorField,t&&t.editDateField]):[]}async function tFt(e,t){const{labelingInfo:i,fieldsIndex:r}=t;i&&i.length&&await Promise.all(i.map(s=>XUe(e,r,s)))}async function XUe(e,t,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await zc(e,t,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{mp(e,t,o.slice(1,-1))})}await C_e(e,t,s)}function YUe(e){const t=e.defaultValue;return t!==void 0&&O_e(e,t)?t:e.nullable?null:void 0}function A_e(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function JUe(e){return e===null||A_e(e)}const rK="isInteger"in Number?Number.isInteger:e=>typeof e=="number"&&isFinite(e)&&Math.floor(e)===e;function QUe(e){return e===null||rK(e)}function M_e(e){return e!=null&&typeof e=="string"}function KUe(e){return e===null||M_e(e)}function eze(){return!0}function O_e(e,t){let i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=e.nullable?QUe:rK;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?JUe:A_e;break;case"string":case"esriFieldTypeString":i=e.nullable?KUe:M_e;break;default:i=eze}return arguments.length===1?i:i(t)}const tze=["integer","small-integer","single","double"],ize=new Set([...tze,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function jV(e){return e!=null&&ize.has(e.type)}function voe(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}function rze(e){return e!=null&&(e.type==="date"||e.type==="esriFieldTypeDate")}var mU,gU;function iFt(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function rFt(e,t){return e.nullable&&t===null?null:jV(e)&&!sze(e.type,Number(t))?mU.OUT_OF_RANGE:O_e(e,t)?e.domain?UUe(e.domain,t):null:gU.INVALID_TYPE}function sze(e,t){const i=typeof e=="string"?R_e(e):e;return!!i&&(i.isInteger?rK(t)&&t>=i.min&&t<=i.max:t>=i.min&&t<=i.max)}function R_e(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return nze;case"esriFieldTypeInteger":case"integer":return oze;case"esriFieldTypeSingle":case"single":return aze;case"esriFieldTypeDouble":case"double":return lze}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(mU||(mU={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(gU||(gU={}));const nze={min:-32768,max:32767,isInteger:!0},oze={min:-2147483648,max:2147483647,isInteger:!0},aze={min:-34e37,max:12e37,isInteger:!1},lze={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function sFt(e,t,i){switch(e){case HA.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case HA.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case gU.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case mU.OUT_OF_RANGE:{const{min:r,max:s}=R_e(t.type);return`Value ${i} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${r} to ${s}`}}}function cze(e,t){return!uze(e,t,null)}function uze(e,t,i){if(!t||!t.attributes||!e){if(_(i))for(const n of e)i.add(n);return!0}const r=t.attributes;let s=!1;for(const n of e)if(!(n in r)){if(s=!0,!_(i))break;i.add(n)}return s}function P_e(e){return["raster.itempixelvalue","raster.servicepixelvalue"].some(t=>e.toLowerCase().startsWith(t))}let j4=class extends Ce{constructor(e){super(e),this.type=null}};u([d({type:["attachments","custom","fields","media","text","expression"],readOnly:!0,json:{read:!1,write:!0}})],j4.prototype,"type",void 0),j4=u([L("esri.popup.content.Content")],j4);const WS=j4;var gq;let Yw=gq=class extends WS{constructor(e){super(e),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new gq({description:this.description,displayType:this.displayType,title:this.title})}};u([d({type:String,json:{write:!0}})],Yw.prototype,"description",void 0),u([d({type:["auto","preview","list"],json:{write:!0}})],Yw.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],Yw.prototype,"title",void 0),u([d({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],Yw.prototype,"type",void 0),Yw=gq=u([L("esri.popup.content.AttachmentsContent")],Yw);const $3=Yw;var yq;let Jw=yq=class extends WS{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new yq({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ue(this.outFields):null})}};u([d()],Jw.prototype,"creator",void 0),u([d()],Jw.prototype,"destroyer",void 0),u([d()],Jw.prototype,"outFields",void 0),u([d({type:["custom"],readOnly:!0})],Jw.prototype,"type",void 0),Jw=yq=u([L("esri.popup.content.CustomContent")],Jw);const hze=Jw;var vq;let LE=vq=class extends Ce{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new vq({title:this.title,expression:this.expression})}};u([d({type:String,json:{write:!0}})],LE.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],LE.prototype,"expression",void 0),u([d({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],LE.prototype,"returnType",void 0),LE=vq=u([L("esri.popup.ElementExpressionInfo")],LE);const I_e=LE;var _q;let cP=_q=class extends WS{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){var e;return new _q({expressionInfo:(e=this.expressionInfo)==null?void 0:e.clone()})}};u([d({type:I_e,json:{write:!0}})],cP.prototype,"expressionInfo",void 0),u([d({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],cP.prototype,"type",void 0),cP=_q=u([L("esri.popup.content.ExpressionContent")],cP);const sK=cP;function bt(e,t={}){var s;const i=e instanceof Ti?e:new Ti(e,t),r={type:((s=t==null?void 0:t.ignoreUnknown)!=null?s:1)?i.apiValues:String,json:{type:i.jsonValues,read:!(t==null?void 0:t.readOnly)&&{reader:i.read},write:{writer:i.write}}};return(t==null?void 0:t.readOnly)!==void 0&&(r.readOnly=!!t.readOnly),(t==null?void 0:t.default)!==void 0&&(r.json.default=t.default),(t==null?void 0:t.name)!==void 0&&(r.json.name=t.name),d(r)}const L3=ml()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});L3.toJSON.bind(L3);L3.fromJSON.bind(L3);let PI;var _0e,b0e,w0e;const NG=(w0e=(_0e=globalThis.esriConfig)==null?void 0:_0e.locale)!=null?w0e:(b0e=globalThis.dojoConfig)==null?void 0:b0e.locale;function $_e(){var e,t;return(t=NG!=null?NG:(e=globalThis.navigator)==null?void 0:e.language)!=null?t:"en"}function ul(){return PI===void 0&&(PI=$_e()),PI}function dze(e=ul()){var t;return(t=/^([a-zA-Z]{2,3})(?:[_\-]\w+)*$/.exec(e))==null?void 0:t[1].toLowerCase()}const II=[];function L_e(e){return II.push(e),{remove(){II.splice(II.indexOf(e),1)}}}const bq=[];function nK(e){return bq.push(e),{remove(){II.splice(bq.indexOf(e),1)}}}function pze(){const e=$_e();PI!==e&&(PI=e,[...bq].forEach(t=>{t.call(null,e)}),[...II].forEach(t=>{t.call(null,e)}))}var x0e;(x0e=globalThis.addEventListener)==null||x0e.call(globalThis,"languagechange",pze);const ym={year:"numeric",month:"numeric",day:"numeric"},BO={year:"numeric",month:"long",day:"numeric"},GO={year:"numeric",month:"short",day:"numeric"},jO={year:"numeric",month:"long",weekday:"long",day:"numeric"},Od={hour:"numeric",minute:"numeric"},Np=me(F({},Od),{second:"numeric"}),oK={"short-date":ym,"short-date-short-time":F(F({},ym),Od),"short-date-short-time-24":me(F(F({},ym),Od),{hour12:!1}),"short-date-long-time":F(F({},ym),Np),"short-date-long-time-24":me(F(F({},ym),Np),{hour12:!1}),"short-date-le":ym,"short-date-le-short-time":F(F({},ym),Od),"short-date-le-short-time-24":me(F(F({},ym),Od),{hour12:!1}),"short-date-le-long-time":F(F({},ym),Np),"short-date-le-long-time-24":me(F(F({},ym),Np),{hour12:!1}),"long-month-day-year":BO,"long-month-day-year-short-time":F(F({},BO),Od),"long-month-day-year-short-time-24":me(F(F({},BO),Od),{hour12:!1}),"long-month-day-year-long-time":F(F({},BO),Np),"long-month-day-year-long-time-24":me(F(F({},BO),Np),{hour12:!1}),"day-short-month-year":GO,"day-short-month-year-short-time":F(F({},GO),Od),"day-short-month-year-short-time-24":me(F(F({},GO),Od),{hour12:!1}),"day-short-month-year-long-time":F(F({},GO),Np),"day-short-month-year-long-time-24":me(F(F({},GO),Np),{hour12:!1}),"long-date":jO,"long-date-short-time":F(F({},jO),Od),"long-date-short-time-24":me(F(F({},jO),Od),{hour12:!1}),"long-date-long-time":F(F({},jO),Np),"long-date-long-time-24":me(F(F({},jO),Np),{hour12:!1}),"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Od,"long-time":Np},D3=ml()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});D3.apiValues;D3.toJSON.bind(D3);D3.fromJSON.bind(D3);const fze={ar:"ar-u-nu-latn-ca-gregory"};let H4=new WeakMap,D_e=oK["short-date-short-time"];function N_e(e){const t=e||D_e;if(!H4.has(t)){const i=ul(),r=fze[ul()]||i;H4.set(t,new Intl.DateTimeFormat(r,t))}return H4.get(t)}function HV(e){return oK[e]||null}function Sn(e,t){return N_e(t).format(e)}nK(()=>{H4=new WeakMap,D_e=oK["short-date-short-time"]});const mze={ar:"ar-u-nu-latn"};let q4=new WeakMap,F_e={};function gze(e){const t=e||F_e;if(!q4.has(t)){const i=ul(),r=mze[ul()]||i;q4.set(t,new Intl.NumberFormat(r,e))}return q4.get(t)}function k_e(e={}){const t={};return e.digitSeparator!=null&&(t.useGrouping=e.digitSeparator),e.places!=null&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function Wl(e,t){return e===-0&&(e=0),gze(t).format(e)}nK(()=>{q4=new WeakMap,F_e={}});var wq;let Qw=wq=class extends Ce{constructor(e){super(e),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new wq({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(e){return this.dateFormat?Sn(e,F(F({},HV(this.dateFormat)),this.dateTimeFormatOptions)):Wl(e,k_e(this))}formatRasterPixelValue(e){let t,i;return e.trim().includes(",")?(t=",",i=t+" ",this._formatDelimitedString(e,t,i,this)):e.trim().includes(";")?(t=";",i=t+" ",this._formatDelimitedString(e,t,i,this)):e.trim().includes(" ")?(t=i=" ",this._formatDelimitedString(e,t,i,this)):this.format(Number(e))}_formatDelimitedString(e,t,i,r){return e&&t&&i&&r?e.trim().split(t).map(s=>this.format(Number(s))).join(i):e}};u([bt(L3)],Qw.prototype,"dateFormat",void 0),u([d({type:Object,json:{read:!1}})],Qw.prototype,"dateTimeFormatOptions",void 0),u([d({type:Boolean,json:{write:!0}})],Qw.prototype,"digitSeparator",void 0),u([d({type:Zr,json:{write:!0}})],Qw.prototype,"places",void 0),Qw=wq=u([L("esri.popup.support.FieldInfoFormat")],Qw);const PC=Qw;var xq;let Wp=xq=class extends Ce{constructor(e){super(e),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new xq({fieldName:this.fieldName,format:this.format?ue(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([d({type:String,json:{write:!0}})],Wp.prototype,"fieldName",void 0),u([d({type:PC,json:{write:!0}})],Wp.prototype,"format",void 0),u([d({type:Boolean,json:{write:!0,default:!1}})],Wp.prototype,"isEditable",void 0),u([d({type:String,json:{write:!0}})],Wp.prototype,"label",void 0),u([bt(new Ti({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Wp.prototype,"stringFieldOption",void 0),u([d({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Wp.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],Wp.prototype,"tooltip",void 0),u([d({type:Boolean,json:{write:!0}})],Wp.prototype,"visible",void 0),Wp=xq=u([L("esri.popup.FieldInfo")],Wp);const uL=Wp;var Tq;let Hy=Tq=class extends WS{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map(i=>i.toJSON())}clone(){return new Tq(ue({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([d({type:Object,json:{write:!0}})],Hy.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],Hy.prototype,"description",void 0),u([d({type:[uL]})],Hy.prototype,"fieldInfos",void 0),u([it("fieldInfos")],Hy.prototype,"writeFieldInfos",null),u([d({type:String,json:{write:!0}})],Hy.prototype,"title",void 0),u([d({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Hy.prototype,"type",void 0),Hy=Tq=u([L("esri.popup.content.FieldsContent")],Hy);const qA=Hy;let Kw=class extends Ce{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([d({type:String,json:{write:!0}})],Kw.prototype,"altText",void 0),u([d({type:String,json:{write:!0}})],Kw.prototype,"caption",void 0),u([d({type:String,json:{write:!0}})],Kw.prototype,"title",void 0),u([d({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],Kw.prototype,"type",void 0),Kw=u([L("esri.popup.content.mixins.MediaInfo")],Kw);const aK=Kw;var Sq;let DE=Sq=class extends Ee{constructor(e){super(e),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new Sq({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([d()],DE.prototype,"fieldName",void 0),u([d()],DE.prototype,"tooltip",void 0),u([d()],DE.prototype,"value",void 0),DE=Sq=u([L("esri.popup.content.support.ChartMediaInfoValueSeries")],DE);const U_e=DE;var Eq;let ex=Eq=class extends Ce{constructor(e){super(e),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new Eq({fields:ue(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([d({type:[String],json:{write:!0}})],ex.prototype,"fields",void 0),u([d({type:String,json:{write:!0}})],ex.prototype,"normalizeField",void 0),u([d({type:[U_e],json:{read:!1}})],ex.prototype,"series",void 0),u([d({type:String,json:{write:!0}})],ex.prototype,"tooltipField",void 0),ex=Eq=u([L("esri.popup.content.support.ChartMediaInfoValue")],ex);const yze=ex;let uP=class extends aK{constructor(e){super(e),this.type=null,this.value=null}};u([d({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],uP.prototype,"type",void 0),u([d({type:yze,json:{write:!0}})],uP.prototype,"value",void 0),uP=u([L("esri.popup.content.mixins.ChartMediaInfo")],uP);const qV=uP,WV=ml()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var Cq;let W4=Cq=class extends qV{constructor(e){super(e),this.type="bar-chart"}clone(){return new Cq({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:WV.write}})],W4.prototype,"type",void 0),W4=Cq=u([L("esri.popup.content.BarChartMediaInfo")],W4);const z_e=W4;var Aq;let Z4=Aq=class extends qV{constructor(e){super(e),this.type="column-chart"}clone(){return new Aq({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:WV.write}})],Z4.prototype,"type",void 0),Z4=Aq=u([L("esri.popup.content.ColumnChartMediaInfo")],Z4);const V_e=Z4;var Mq;let hP=Mq=class extends Ce{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new Mq({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([d({type:String,json:{write:!0}})],hP.prototype,"linkURL",void 0),u([d({type:String,json:{write:!0}})],hP.prototype,"sourceURL",void 0),hP=Mq=u([L("esri.popup.content.support.ImageMediaInfoValue")],hP);const vze=hP;var Oq;let NE=Oq=class extends aK{constructor(e){super(e),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new Oq({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([d({type:Number,json:{write:!0}})],NE.prototype,"refreshInterval",void 0),u([d({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],NE.prototype,"type",void 0),u([d({type:vze,json:{write:!0}})],NE.prototype,"value",void 0),NE=Oq=u([L("esri.popup.content.ImageMediaInfo")],NE);const B_e=NE;var Rq;let X4=Rq=class extends qV{constructor(e){super(e),this.type="line-chart"}clone(){return new Rq({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:WV.write}})],X4.prototype,"type",void 0),X4=Rq=u([L("esri.popup.content.LineChartMediaInfo")],X4);const G_e=X4;var Pq;let Y4=Pq=class extends qV{constructor(e){super(e),this.type="pie-chart"}clone(){return new Pq({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:WV.write}})],Y4.prototype,"type",void 0),Y4=Pq=u([L("esri.popup.content.PieChartMediaInfo")],Y4);const j_e=Y4,H_e={base:aK,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":z_e,"column-chart":V_e,"line-chart":G_e,"pie-chart":j_e,image:B_e}};var Iq;let Zp=Iq=class extends WS{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(t=>t.type==="image"?B_e.fromJSON(t):t.type==="barchart"?z_e.fromJSON(t):t.type==="columnchart"?V_e.fromJSON(t):t.type==="linechart"?G_e.fromJSON(t):t.type==="piechart"?j_e.fromJSON(t):void 0).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map(i=>i.toJSON())}clone(){return new Iq(ue({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([d()],Zp.prototype,"activeMediaInfoIndex",void 0),u([d({type:Object,json:{write:!0}})],Zp.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],Zp.prototype,"description",void 0),u([d({types:[H_e]})],Zp.prototype,"mediaInfos",void 0),u([De("mediaInfos")],Zp.prototype,"readMediaInfos",null),u([it("mediaInfos")],Zp.prototype,"writeMediaInfos",null),u([d({type:String,json:{write:!0}})],Zp.prototype,"title",void 0),u([d({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Zp.prototype,"type",void 0),Zp=Iq=u([L("esri.popup.content.MediaContent")],Zp);const N3=Zp;var $q;let dP=$q=class extends WS{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new $q({text:this.text})}};u([d({type:String,json:{write:!0}})],dP.prototype,"text",void 0),u([d({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],dP.prototype,"type",void 0),dP=$q=u([L("esri.popup.content.TextContent")],dP);const WA=dP,_ze={base:null,key:"type",typeMap:{attachment:$3,media:N3,text:WA,expression:sK,field:qA}};var Lq;let tx=Lq=class extends Ce{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new Lq({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],tx.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],tx.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],tx.prototype,"expression",void 0),u([d({type:["string","number"],json:{write:!0}})],tx.prototype,"returnType",void 0),tx=Lq=u([L("esri.popup.ExpressionInfo")],tx);const q_e=tx;var Dq;let pP=Dq=class extends Ce{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new Dq({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([d({type:Boolean,json:{write:!0}})],pP.prototype,"returnTopmostRaster",void 0),u([d({type:Boolean,json:{write:!0}})],pP.prototype,"showNoDataRecords",void 0),pP=Dq=u([L("esri.popup.LayerOptions")],pP);const bze=pP;var Nq;let fP=Nq=class extends Ce{constructor(e){super(e),this.field=null,this.order=null}clone(){return new Nq({field:this.field,order:this.order})}};u([d({type:String,json:{write:!0}})],fP.prototype,"field",void 0),u([d({type:["asc","desc"],json:{write:!0}})],fP.prototype,"order",void 0),fP=Nq=u([L("esri.popup.support.RelatedRecordsInfoFieldOrder")],fP);const W_e=fP;var Fq;let mP=Fq=class extends Ce{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new Fq({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ue(this.orderByFields):null})}};u([d({type:Boolean,json:{write:!0}})],mP.prototype,"showRelatedRecords",void 0),u([d({type:[W_e],json:{write:!0}})],mP.prototype,"orderByFields",void 0),mP=Fq=u([L("esri.popup.RelatedRecordsInfo")],mP);const wze=mP;let xze=0;const ZV=e=>{let t=class extends e{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+xze++})}};return t=u([L("esri.core.Identifiable")],t),t};let _oe=class extends ZV(class{}){};_oe=u([L("esri.core.Identifiable")],_oe);var kq;let Xp=kq=class extends ZV(Ee){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new kq({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([d()],Xp.prototype,"active",void 0),u([d()],Xp.prototype,"className",void 0),u([d()],Xp.prototype,"disabled",void 0),u([d()],Xp.prototype,"id",void 0),u([d()],Xp.prototype,"indicator",void 0),u([d()],Xp.prototype,"title",void 0),u([d()],Xp.prototype,"type",void 0),u([d()],Xp.prototype,"visible",void 0),Xp=kq=u([L("esri.support.actions.ActionBase")],Xp);const XV=Xp;var Uq;let J4=Uq=class extends XV{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new Uq({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([d()],J4.prototype,"image",void 0),J4=Uq=u([L("esri.support.Action.ActionButton")],J4);const iO=J4;var zq;let gP=zq=class extends XV{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new zq({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([d()],gP.prototype,"image",void 0),u([d()],gP.prototype,"value",void 0),gP=zq=u([L("esri.support.Action.ActionToggle")],gP);const Z_e=gP;var Vq;const Tze=nt.ofType({key:"type",defaultKeyValue:"button",base:XV,typeMap:{button:iO,toggle:Z_e}}),Sze={base:WS,key:"type",typeMap:{media:N3,custom:hze,text:WA,attachments:$3,fields:qA,expression:sK}},X_e="esri.PopupTemplate",Eze=ve.getLogger(X_e),Cze=["attachments","fields","media","text","expression"];let bo=Vq=class extends Ce{constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title="",this.relatedRecordsInfo=null}castContent(e){return Array.isArray(e)?e.map(t=>im(Sze,t)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||qu(e)?e:(Eze.error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:i}=t;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(t):this._readPopupInfo(t)}writeContent(e,t,i,r){typeof e!="string"?Array.isArray(e)&&(t.popupElements=e.filter(s=>Cze.includes(s.type)).map(s=>s&&s.toJSON(r)),t.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(t):s.type==="media"?this._writeMediaContent(s,t):s.type==="text"&&this._writeTextContent(s,t)})):t.description=e}writeFieldInfos(e,t,i,r){const{content:s}=this,n=Array.isArray(s)?s:null;if(e){const o=n?n.filter(l=>l.type==="fields"):[],a=o.length&&o.every(l=>{var c;return(c=l.fieldInfos)==null?void 0:c.length});t.fieldInfos=e.filter(Boolean).map(l=>{const c=l.toJSON(r);return a&&(c.visible=!1),c})}if(n)for(const o of n)o.type==="fields"&&this._writeFieldsContent(o,t)}writeLayerOptions(e,t,i,r){t[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(r)}writeTitle(e,t){t.title=e||""}clone(){const{actions:e}=this,t=e?ue(e.toArray()):[];return new Vq({actions:t,content:Array.isArray(this.content)?ue(this.content):this.content,expressionInfos:Array.isArray(this.expressionInfos)?ue(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?ue(this.fieldInfos):null,layerOptions:this.layerOptions?ue(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?ue(this.outFields):null,overwriteActions:this.overwriteActions,returnGeometry:this.returnGeometry,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?ue(this.relatedRecordsInfo):null})}async collectRequiredFields(e,t){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...i,...this._getContentExpressionInfos(this.content,i)]),I3(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=ue(e.fieldInfos);Array.isArray(t.fieldInfos)?i.forEach(r=>{const s=t.fieldInfos.find(n=>n.fieldName.toLowerCase()===r.fieldName.toLowerCase());s?s.visible=!0:t.fieldInfos.push(r)}):t.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=ue(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...i]:t.mediaInfos=i}_readPopupInfoElements({description:e,mediaInfos:t,popupElements:i}){const r={description:!1,mediaInfos:!1};return i.map(s=>s.type==="media"?(s.mediaInfos||!t||r.mediaInfos||(s.mediaInfos=t,r.mediaInfos=!0),N3.fromJSON(s)):s.type==="text"?(s.text||!e||r.description||(s.text=e,r.description=!0),WA.fromJSON(s)):s.type==="attachments"?$3.fromJSON(s):s.type==="fields"?qA.fromJSON(s):s.type==="expression"?sK.fromJSON(s):void 0).filter(Boolean)}_readPopupInfo({description:e,mediaInfos:t,showAttachments:i}){const r=[];return e?r.push(new WA({text:e})):r.push(new qA),Array.isArray(t)&&t.length&&r.push(N3.fromJSON({mediaInfos:t})),i&&r.push($3.fromJSON({displayType:"auto"})),r.length?r:e}_getContentElementFields(e){const t=e==null?void 0:e.type;if(t==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(t==="custom")return e.outFields||[];if(t==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos||this.fieldInfos)];if(t==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((r,s)=>[...r,...this._getMediaInfoFields(s)],[])]}return t==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:t,title:i,value:r}=e,s=r||{},{fields:n=[],normalizeField:o,tooltipField:a,sourceURL:l,linkURL:c}=s,h=[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...n];return o&&h.push(o),a&&h.push(a),h}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce((i,r)=>[...i,...r.type==="expression"&&r.expressionInfo?[r.expressionInfo]:[]],t):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((t,i)=>[...t,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,t,i){i&&await Promise.all(i.map(r=>zc(e,t,r.expression)))}_getFieldInfoFields(e){return e?e.filter(t=>t.visible===void 0||!!t.visible).map(t=>t.fieldName).filter(t=>!t.includes("relationships/")&&!t.includes("expression/")):[]}_getActionsFields(e){return e?e.toArray().reduce((t,i)=>[...t,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:t,title:i,type:r}=e,s=r==="button"||r==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const t=/{[^}]*}/g,i=e.match(t);if(!i)return[];const r=/\{(\w+):.+\}/,s=i.filter(n=>!(n.indexOf("{relationships/")===0||n.indexOf("{expression/")===0)).map(n=>n.replace(r,"{$1}"));return s?s.map(n=>n.slice(1,-1)):[]}};u([d({type:Tze})],bo.prototype,"actions",void 0),u([d()],bo.prototype,"content",void 0),u([Jt("content")],bo.prototype,"castContent",null),u([De("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments"])],bo.prototype,"readContent",null),u([it("content",{popupElements:{type:nt.ofType(_ze)},showAttachments:{type:Boolean},mediaInfos:{type:nt.ofType(H_e)},description:{type:String}})],bo.prototype,"writeContent",null),u([d({type:[q_e],json:{write:!0}})],bo.prototype,"expressionInfos",void 0),u([d({type:[uL]})],bo.prototype,"fieldInfos",void 0),u([it("fieldInfos")],bo.prototype,"writeFieldInfos",null),u([d({type:bze})],bo.prototype,"layerOptions",void 0),u([it("layerOptions")],bo.prototype,"writeLayerOptions",null),u([d({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],bo.prototype,"lastEditInfoEnabled",void 0),u([d()],bo.prototype,"outFields",void 0),u([d()],bo.prototype,"overwriteActions",void 0),u([d()],bo.prototype,"returnGeometry",void 0),u([d({json:{type:String}})],bo.prototype,"title",void 0),u([it("title")],bo.prototype,"writeTitle",null),u([d({type:wze,json:{write:!0}})],bo.prototype,"relatedRecordsInfo",void 0),bo=Vq=u([L(X_e)],bo);const ZS=bo,boe=new Ti({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let Aze=0,FE=class extends Ce{constructor(e){super(e),this.id="sym"+Aze++,this.type=null,this.color=new Le([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([d({type:boe.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:boe.write}}})],FE.prototype,"type",void 0),u([d({type:Le,json:{write:{allowNull:!0}}})],FE.prototype,"color",void 0),u([De("color")],FE.prototype,"readColor",null),FE=u([L("esri.symbols.Symbol")],FE);const qc=FE;var Bq;let k_=Bq=class extends qc{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){if(e)for(const i in e)t[i]=e[i]}async collectRequiredFields(e,t){if(this.data.type==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const r=i.map(s=>{const n=s.valueExpressionInfo;return zc(e,t,n.expression)});await Promise.all(r)}}}clone(){return new Bq({data:ue(this.data)})}hash(){return IQ(JSON.stringify(this.data)).toString()}};u([d({json:{write:!1}})],k_.prototype,"color",void 0),u([d({json:{write:!0}})],k_.prototype,"data",void 0),u([De("data",["symbol"])],k_.prototype,"readData",null),u([it("data",{})],k_.prototype,"writeData",null),u([bt({CIMSymbolReference:"cim"},{readOnly:!0})],k_.prototype,"type",void 0),k_=Bq=u([L("esri.symbols.CIMSymbol")],k_);const XS=k_;let kE=class extends Ce{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,t,i){e||(t[i]=e)}};u([d({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],kE.prototype,"enabled",void 0),u([it("enabled")],kE.prototype,"writeEnabled",null),u([d({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],kE.prototype,"type",void 0),kE=u([L("esri.symbols.Symbol3DLayer")],kE);const cy=kE,Mze=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,Oze="screenUtils.toPt: input not recognized!",Y_e=96;function $i(e){return e?e/72*Y_e:0}function Vc(e){return e?72*e/Y_e:0}function Tr(e){if(typeof e=="string"){const t=e.match(Mze);if(t){const i=Number(t[1]),r=t[3]&&t[3].toLowerCase(),s=e.charAt(0)==="-",n=r==="px"?Vc(i):i;return s?-n:n}return console.warn(Oze),null}return e}function bp(e=0,t=0){return{x:e,y:t}}function Ts(e=0,t=0){return[e,t]}function Rze(e=0,t=0){return[e,t]}function ko(e=0,t=0,i=0){return[e,t,i]}function nFt(e){return e}function oFt(e){return e}function aFt(e){return e}function L0(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}function YV(e){const t=IV(100*(1-e));return Math.max(0,Math.min(t,100))}function ZA(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}function Pze(e,t){const i=t.transparency!=null?ZA(t.transparency):1,r=t.color;return r&&Array.isArray(r)?new Le([r[0]||0,r[1]||0,r[2]||0,i]):null}function Ize(e,t){t.color=e.toJSON().slice(0,3);const i=YV(e.a);i!==0&&(t.transparency=i)}const Iv={type:Le,json:{type:[Zr],default:null,read:{source:["color","transparency"],reader:Pze},write:{target:{color:{type:[Zr]},transparency:{type:Zr}},writer:Ize}}},Hg={type:Number,cast:Tr,json:{write:!0}};let ix=class extends Ce{constructor(e){super(e),this.color=new Le([0,0,0,1]),this.extensionLength=0,this.size=Vc(1)}clone(){}cloneProperties(){return{color:ue(this.color),size:this.size,extensionLength:this.extensionLength}}};u([d({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],ix.prototype,"type",void 0),u([d(Iv)],ix.prototype,"color",void 0),u([d(me(F({},Hg),{json:{write:{overridePolicy:e=>({enabled:!!e})}}}))],ix.prototype,"extensionLength",void 0),u([d(Hg)],ix.prototype,"size",void 0),ix=u([L("esri.symbols.edges.Edges3D")],ix);const lK=ix;var Gq;let Q4=Gq=class extends lK{constructor(e){super(e),this.type="sketch"}clone(){return new Gq(this.cloneProperties())}};u([bt({sketch:"sketch"},{readOnly:!0})],Q4.prototype,"type",void 0),Q4=Gq=u([L("esri.symbols.edges.SketchEdges3D")],Q4);const $ze=Q4;var jq;let K4=jq=class extends lK{constructor(e){super(e),this.type="solid"}clone(){return new jq(this.cloneProperties())}};u([bt({solid:"solid"},{readOnly:!0})],K4.prototype,"type",void 0),K4=jq=u([L("esri.symbols.support.SolidEdges3D")],K4);const Lze=K4,J_e={types:{key:"type",base:lK,typeMap:{solid:Lze,sketch:$ze}},json:{write:!0}};var Hq;let Yh=Hq=class extends Ce{constructor(e){super(e),this.color=null}clone(){const e={color:_(this.color)?this.color.clone():null};return new Hq(e)}};u([d(Iv)],Yh.prototype,"color",void 0),Yh=Hq=u([L("esri.symbols.support.Symbol3DMaterial")],Yh);var qq;let U_=qq=class extends cy{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new qq({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([bt({Extrude:"extrude"},{readOnly:!0})],U_.prototype,"type",void 0),u([d({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],U_.prototype,"size",void 0),u([d({type:Yh,json:{write:!0}})],U_.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],U_.prototype,"castShadows",void 0),u([d(J_e)],U_.prototype,"edges",void 0),U_=qq=u([L("esri.symbols.ExtrudeSymbol3DLayer")],U_);const Q_e=U_;let yP=class extends qc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([bt({esriSLS:"simple-line"},{readOnly:!0})],yP.prototype,"type",void 0),u([d({type:Number,cast:Tr,json:{write:!0}})],yP.prototype,"width",void 0),yP=u([L("esri.symbols.LineSymbol")],yP);const Dze=yP,Nze=["begin","end","begin-end"],K_e=["arrow","circle","square","diamond","cross","x"];var Wq;let Vm=Wq=class extends Ce{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,i,r){t[i]=(r==null?void 0:r.origin)==="web-map"?"arrow":e}set color(e){this._set("color",e)}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,i,r){(r==null?void 0:r.origin)==="web-map"||(t[i]=e)}clone(){return new Wq({color:ue(this.color),placement:this.placement,style:this.style})}hash(){var e;return`${this.placement}.${(e=this.color)==null?void 0:e.hash()}.${this.style}`}};u([d({type:["begin","end","begin-end"],json:{write:!0}})],Vm.prototype,"placement",void 0),u([bt({"line-marker":"line-marker"},{readOnly:!0}),d({json:{origins:{"web-map":{write:!1}}}})],Vm.prototype,"type",void 0),u([d({type:K_e})],Vm.prototype,"style",void 0),u([it("style")],Vm.prototype,"writeStyle",null),u([d({type:Le,value:null,json:{write:{allowNull:!0}}})],Vm.prototype,"color",null),u([De("color")],Vm.prototype,"readColor",null),u([it("color")],Vm.prototype,"writeColor",null),Vm=Wq=u([L("esri.symbols.LineSymbolMarker")],Vm);const Fze=Vm;var Zq;const FG=new Ti({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let qy=Zq=class extends Dze{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,i,r,s,n){if(e&&typeof e!="string")return e;const o={};return e!=null&&(o.style=e),t!=null&&(o.color=t),i!=null&&(o.width=Tr(i)),r!=null&&(o.cap=r),s!=null&&(o.join=s),n!=null&&(o.miterLimit=Tr(n)),o}clone(){var e;return new Zq({color:ue(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(e=this.marker)==null?void 0:e.clone()})}hash(){var e,t;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(t=this.marker)==null?void 0:t.hash()}`}};u([bt({esriSLS:"simple-line"},{readOnly:!0})],qy.prototype,"type",void 0),u([d({type:FG.apiValues,json:{read:FG.read,write:FG.write}})],qy.prototype,"style",void 0),u([d({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null||i.origin==null)})}}})],qy.prototype,"cap",void 0),u([d({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null||i.origin==null)})}}})],qy.prototype,"join",void 0),u([d({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":Fze}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],qy.prototype,"marker",void 0),u([d({type:Number,json:{read:!1,write:!1}})],qy.prototype,"miterLimit",void 0),qy=Zq=u([L("esri.symbols.SimpleLineSymbol")],qy);const dl=qy;let vP=class extends qc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":dl}},json:{default:null,write:!0}})],vP.prototype,"outline",void 0),u([d({type:["simple-fill","picture-fill"],readOnly:!0})],vP.prototype,"type",void 0),vP=u([L("esri.symbols.FillSymbol")],vP);const e1e=vP;let e5=class extends Ce{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],e5.prototype,"type",void 0),e5=u([L("esri.symbols.patterns.LinePattern3D")],e5);const t1e=e5,kze=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var Xq;const Uze=ml()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let _P=Xq=class extends t1e{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new Xq(e)}};u([d({type:["style"]})],_P.prototype,"type",void 0),u([bt(Uze),d({type:kze})],_P.prototype,"style",void 0),_P=Xq=u([L("esri.symbols.patterns.LineStylePattern3D")],_P);const cK=_P;let t5=class extends Ce{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],t5.prototype,"type",void 0),t5=u([L("esri.symbols.patterns.Pattern3D")],t5);const i1e=t5,zze=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var Yq;let bP=Yq=class extends i1e{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new Yq(e)}};u([d({type:["style"]})],bP.prototype,"type",void 0),u([d({type:zze,json:{read:!0,write:!0}})],bP.prototype,"style",void 0),bP=Yq=u([L("esri.symbols.patterns.StylePattern3D")],bP);const r1e=bP,Vze={types:{key:"type",base:i1e,typeMap:{style:r1e}},json:{write:!0}},s1e={types:{key:"type",base:t1e,typeMap:{style:cK}},json:{write:!0}},$I=new Le("white");new Le("black");const Bze=new Le([255,255,255,0]);function Gze(e){return e.r===0&&e.g===0&&e.b===0}var Jq;let LI=Jq=class extends Yh{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:_(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new Jq(e)}};u([bt({multiply:"multiply",replace:"replace",tint:"tint"})],LI.prototype,"colorMixMode",void 0),LI=Jq=u([L("esri.symbols.support.Symbol3DFillMaterial")],LI);function Qt(e=Wze){return[e[0],e[1],e[2],e[3]]}function lFt(e){return[e[0],e[1],e[2],e[3]]}function pv(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function uK(e,t,i,r,s=Qt()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function hK(e,t=Qt()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function JV(e,t){return new yi({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function lA(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function GT(e,t,i){if(M(t))pv(i,e);else if("length"in t)Kq(t)?(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i[3]=Math.max(e[3],t[3])):t.length!==2&&t.length!==3||(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[0]),i[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":i[0]=Math.min(e[0],t.xmin),i[1]=Math.min(e[1],t.ymin),i[2]=Math.max(e[2],t.xmax),i[3]=Math.max(e[3],t.ymax);break;case"point":i[0]=Math.min(e[0],t.x),i[1]=Math.min(e[1],t.y),i[2]=Math.max(e[2],t.x),i[3]=Math.max(e[3],t.y)}}function kG(e,t,i=e){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3];for(let l=0;l<r;l++){const c=t[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function Qq(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function zh(e){return M(e)||e[0]>=e[2]?0:e[2]-e[0]}function nm(e){return e[1]>=e[3]?0:e[3]-e[1]}function n1e(e){return zh(e)*nm(e)}function dK(e,t=[0,0]){return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function o1e(e,t){return pK(e,t[0],t[1])}function woe(e,t){const i=t[3],r=.5*(e[0]+e[2]),s=Math.abs(t[0]-r),n=.5*(e[2]-e[0]);if(s>i+n)return!1;const o=.5*(e[1]+e[3]),a=.5*(e[3]-e[1]),l=Math.abs(t[1]-o);if(l>i+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=i*i}function cFt(e,t,i){const r=e[0],s=e[1],n=e[2],o=e[3],{x:a,y:l}=t,{x:c,y:h}=i,p=(x,b)=>(h-l)*x+(a-c)*b+(c*l-a*h)<0,f=p(r,o),m=p(n,o),g=p(n,s),y=p(r,s);return!(f===m&&m===g&&g===y&&y===f||a<r&&c<r||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function uFt(e,t){return pK(e,t.x,t.y)}function pK(e,t,i){return t>=e[0]&&i>=e[1]&&t<=e[2]&&i<=e[3]}function wP(e,t,i,r){return t>=e[0]-r&&i>=e[1]-r&&t<=e[2]+r&&i<=e[3]+r}function jze(e,t,i){return t[0]>=e[0]-i&&t[1]>=e[1]-i&&t[0]<=e[2]+i&&t[1]<=e[3]+i}function hL(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function yU(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function i5(e,t,i){if(M(t))return pv(i,e);const r=t[0],s=t[1],n=t[2],o=t[3];return i[0]=He(e[0],r,n),i[1]=He(e[1],s,o),i[2]=He(e[2],r,n),i[3]=He(e[3],s,o),i}function Hze(e,t){const i=(e[0]+e[2])/2,r=(e[1]+e[3])/2,s=Math.max(Math.abs(t[0]-i)-zh(e)/2,0),n=Math.max(Math.abs(t[1]-r)-nm(e)/2,0);return Math.sqrt(s*s+n*n)}function vU(e,t,i,r=e){return r[0]=e[0]+t,r[1]=e[1]+i,r[2]=e[2]+t,r[3]=e[3]+i,r}function id(e){return e?pv(e,eW):Qt(eW)}function Kq(e){return e!=null&&e.length===4}function qze(e){return!(zh(e)!==0&&isFinite(e[0])||nm(e)!==0&&isFinite(e[1]))}function jT(e,t){return Kq(e)&&Kq(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const hFt=[-1/0,-1/0,1/0,1/0],eW=[1/0,1/0,-1/0,-1/0],Wze=[0,0,0,0];function In(e=h1e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function dS(e,t,i,r,s,n,o=In()){return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function dFt(e,t){const i=isFinite(e[2])||isFinite(e[5]);return new yi(i?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function XA(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function Zze(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function qg(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function qh(e,t,i=0,r=t.length/3){let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];for(let h=0;h<r;h++)s=Math.min(s,t[i+3*h]),n=Math.min(n,t[i+3*h+1]),o=Math.min(o,t[i+3*h+2]),a=Math.max(a,t[i+3*h]),l=Math.max(l,t[i+3*h+1]),c=Math.max(c,t[i+3*h+2]);e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function UG(e,t,i){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];if(i)for(let h=0;h<r;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let h=0;h<r;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function Xze(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function YS(e){return e[0]>=e[3]?0:e[3]-e[0]}function JS(e){return e[1]>=e[4]?0:e[4]-e[1]}function Xb(e){return e[2]>=e[5]?0:e[5]-e[2]}function a1e(e){const t=YS(e),i=Xb(e),r=JS(e);return Math.sqrt(t*t+i*i+r*r)}function Df(e,t=[0,0,0]){return t[0]=e[0]+YS(e)/2,t[1]=e[1]+JS(e)/2,t[2]=e[2]+Xb(e)/2,t}function LD(e,t=[0,0,0]){return t[0]=YS(e),t[1]=JS(e),t[2]=Xb(e),t}function Yze(e){return Math.max(YS(e),Xb(e),JS(e))}function fK(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function pFt(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function Jze(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function Nf(e,t){return!!M(t)||Jze(e,t)}function l1e(e,t,i,r,s=e){return s[0]=e[0]+t,s[1]=e[1]+i,s[2]=e[2]+r,s[3]=e[3]+t,s[4]=e[4]+i,s[5]=e[5]+r,s}function fFt(e,t,i=e){const r=e[0]+YS(e)/2,s=e[1]+JS(e)/2,n=e[2]+Xb(e)/2;return i[0]=r+(e[0]-r)*t,i[1]=s+(e[1]-s)*t,i[2]=n+(e[2]-n)*t,i[3]=r+(e[3]-r)*t,i[4]=s+(e[4]-s)*t,i[5]=n+(e[5]-n)*t,i}function mFt(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function c1e(e,t,i=e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function u1e(e,t,i=e){return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function QV(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Nr(e){return e?QV(e,Toe):In(Toe)}function mK(e,t){return t||(t=Qt()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function gFt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function xoe(e){return e.length===6}function KV(e){return YS(e)===0&&JS(e)===0&&Xb(e)===0}function yFt(e,t,i){if(M(e)||M(t))return e===t;if(!xoe(e)||!xoe(t))return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function Qze(e,t,i,r,s,n){return dS(e,t,i,r,s,n,Kze)}const vFt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],Toe=[1/0,1/0,1/0,-1/0,-1/0,-1/0],h1e=[0,0,0,0,0,0],Kze=In();function zG(e,{isPrimitive:t,width:i,depth:r,height:s}){const n=t?10:1;if(i==null&&s==null&&r==null)return[n*e[0],n*e[1],n*e[2]];const o=Ze(i,r,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/e[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=e[l]*a);return o}const eVe=dS(-.5,-.5,-.5,.5,.5,.5),tVe=dS(-.5,-.5,0,.5,.5,1),iVe=dS(-.5,-.5,0,.5,.5,.5);function rVe(e){switch(e){case"sphere":case"cube":case"diamond":return eVe;case"cylinder":case"cone":case"inverted-cone":return tVe;case"tetrahedron":return iVe;default:return}}const gK=["butt","square","round"],sVe=[...gK,"none"],d1e=["miter","bevel","round"];var tW;let rx=tW=class extends Ce{constructor(e){super(e),this.color=new Le([0,0,0,1]),this.size=Vc(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:_(this.color)?this.color.clone():null,size:this.size,pattern:_(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new tW(e)}};u([d(Iv)],rx.prototype,"color",void 0),u([d(Hg)],rx.prototype,"size",void 0),u([d(s1e)],rx.prototype,"pattern",void 0),u([d({type:gK,json:{default:"butt",write:{overridePolicy(){return{enabled:_(this.pattern)}}}}})],rx.prototype,"patternCap",void 0),rx=tW=u([L("esri.symbols.support.Symbol3DOutline")],rx);var r5;let Wy=r5=class extends cy{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:_(this.edges)?this.edges.clone():null,enabled:this.enabled,material:_(this.material)?this.material.clone():null,pattern:_(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:_(this.outline)?this.outline.clone():null};return new r5(e)}static fromSimpleFillSymbol(e){var r,s,n,o,a,l;const t=e.outline&&e.outline.style&&e.outline.style!=="inside-frame"&&e.outline.style!=="solid"?new cK({style:e.outline.style}):null,i={size:(s=(r=e.outline)==null?void 0:r.width)!=null?s:0,color:((o=(n=e.outline)==null?void 0:n.color)!=null?o:$I).clone(),pattern:t};return t&&((a=e.outline)==null?void 0:a.cap)&&(i.patternCap=e.outline.cap),new r5({material:new LI({color:((l=e.color)!=null?l:Bze).clone()}),pattern:e.style&&e.style!=="solid"?new r1e({style:e.style}):null,outline:i})}};u([bt({Fill:"fill"},{readOnly:!0})],Wy.prototype,"type",void 0),u([d({type:LI,json:{write:!0}})],Wy.prototype,"material",void 0),u([d(Vze)],Wy.prototype,"pattern",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Wy.prototype,"castShadows",void 0),u([d({type:rx,json:{write:!0}})],Wy.prototype,"outline",void 0),u([d(J_e)],Wy.prototype,"edges",void 0),Wy=r5=u([L("esri.symbols.FillSymbol3DLayer")],Wy);const eB=Wy,nVe=["none","underline","line-through"],oVe=["normal","italic","oblique"],aVe=["normal","lighter","bold","bolder"],p1e={type:Number,cast:e=>{const t=tp(e);return t===0?1:He(t,.1,4)},nonNullable:!0},lVe=["left","right","center"],cVe=["baseline","top","middle","bottom"],f1e={type:lVe,nonNullable:!0},m1e={type:cVe,nonNullable:!0};var iW;let Zy=iW=class extends Ce{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return Tr(e)}clone(){return new iW({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([d({type:nVe,json:{default:"none",write:!0}})],Zy.prototype,"decoration",void 0),u([d({type:String,json:{write:!0}})],Zy.prototype,"family",void 0),u([d({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.textSymbol3D})}}})],Zy.prototype,"size",void 0),u([Jt("size")],Zy.prototype,"castSize",null),u([d({type:oVe,json:{default:"normal",write:!0}})],Zy.prototype,"style",void 0),u([d({type:aVe,json:{default:"normal",write:!0}})],Zy.prototype,"weight",void 0),Zy=iW=u([L("esri.symbols.Font")],Zy);const tB=Zy,uVe=ve.getLogger("esri.core.urlUtils"),rO=or.request,Soe="esri/config: esriConfig.request.proxyUrl is not set.",g1e=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,y1e=/^\s*http:/i,hVe=/^\s*https:/i,dVe=/^\s*file:/i,pVe=/:\d+$/,fVe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,mVe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),gVe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class cA{constructor(t=""){this.uri=t,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(mVe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(gVe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}}const DD={},yVe=new cA(or.applicationUrl);let Bl=yVe;const vVe=_Ve();let yK=vVe;const vK=()=>Bl,_Ft=()=>yK;function _Ve(){const e=Bl.path,t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${`${Bl.scheme}://${Bl.host}${Bl.port!=null?`:${Bl.port}`:""}`}${t}`}function pn(e){const t={path:null,query:null},i=new cA(e),r=e.indexOf("?");return i.query===null?t.path=e:(t.path=e.substring(0,r),t.query=v1e(i.query)),i.fragment&&(t.hash=i.fragment,i.query===null&&(t.path=t.path.substring(0,t.path.length-(i.fragment.length+1)))),t}function v1e(e){const t=e.split("&"),i={};for(const r of t){if(!r)continue;const s=r.indexOf("=");let n,o;s<0?(n=decodeURIComponent(r),o=""):(n=decodeURIComponent(r.slice(0,s)),o=decodeURIComponent(r.slice(s+1)));let a=i[n];typeof a=="string"&&(a=i[n]=[a]),Array.isArray(a)?a.push(o):i[n]=o}return i}function Eoe(e){return e&&typeof e=="object"&&"toJSON"in e&&typeof e.toJSON=="function"}function Eb(e,t){return e?t&&typeof t=="function"?Object.keys(e).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(t(i,e[i]))).join("&"):Object.keys(e).map(i=>{const r=e[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=t&&t[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(o=>Eoe(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):Eoe(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function bVe(e=!1){let t,i=rO.proxyUrl;if(typeof e=="string"){t=CVe(e);const r=iB(e);r&&(i=r.proxyUrl)}else t=!!e;if(!i)throw uVe.warn(Soe),new W("urlutils:proxy-not-set",Soe);return t&&rW()&&(i=TK(i)),pn(i)}function bFt(e){const t=iB(e);let i,r;if(t){const s=_K(t.proxyUrl);i=s.path,r=s.query?v1e(s.query):null}if(i){const s=pn(e);e=i+"?"+s.path;const n=Eb(F(F({},r),s.query));n&&(e=`${e}?${n}`)}return e}const HO={path:"",query:""};function _K(e){const t=e.indexOf("?");return t!==-1?(HO.path=e.slice(0,t),HO.query=e.slice(t+1)):(HO.path=e,HO.query=null),HO}function _1e(e){return e=(e=_U(e=PVe(e=_K(e).path),!0)).toLowerCase()}function wVe(e){const t={proxyUrl:e.proxyUrl,urlPrefix:_1e(e.urlPrefix)},i=rO.proxyRules,r=t.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const o=i[n].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;s=n;break}o.indexOf(r)===0&&(s=n+1)}return i.splice(s,0,t),s}function iB(e){const t=rO.proxyRules,i=_1e(e);for(let r=0;r<t.length;r++)if(i.indexOf(t[r].urlPrefix)===0)return t[r]}function b1e(e,t){return e=Coe(e),t=Coe(t),_U(e)===_U(t)}function Coe(e){const t=(e=Zf(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function w1e(e){const t=r=>r==null||r instanceof RegExp&&r.test(e)||typeof r=="string"&&e.startsWith(r),i=rO.interceptors;if(i){for(const r of i)if(Array.isArray(r.urls)){if(r.urls.some(t))return r}else if(t(r.urls))return r}return null}function F3(e,t,i=!1){const r=nW(e),s=nW(t);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function bK(e){if(typeof e=="string"){if(!Nu(e))return!0;e=nW(e)}if(F3(e,Bl))return!0;const t=rO.trustedServers||[];for(let i=0;i<t.length;i++){const r=xVe(t[i]);for(let s=0;s<r.length;s++)if(F3(e,r[s]))return!0}return!1}function xVe(e){return DD[e]||(xK(e)||Wg(e)?DD[e]=[new cA(Wh(e))]:DD[e]=[new cA(`http://${e}`),new cA(`https://${e}`)]),DD[e]}function Wh(e,t=yK,i){return Wg(e)?i&&i.preserveProtocolRelative?e:Bl.scheme==="http"&&Bl.authority===Xf(e).slice(2)?`http:${e}`:`https:${e}`:xK(e)?e:Bc(e[0]==="/"?RVe(t):t,e)}function wK(e,t=yK,i){if(!Nu(e))return e;const r=Zf(e),s=r.toLowerCase(),n=Zf(t).toLowerCase().replace(/\/+$/,""),o=i?Zf(i).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return e;const a=(p,f,m)=>(m=p.indexOf(f,m))===-1?p.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return e;e=r.slice(c);const h=n.slice(c-1).replace(/[^/]+/g,"").length;if(h>0)for(let p=0;p<h;p++)e=`../${e}`;else e=`./${e}`;return e}function Zf(e){return e=LVe(e=$Ve(e=IVe(e=Wh(e=e.trim()))))}function Bc(...e){const t=e.filter(_);if(!t||!t.length)return;const i=[];if(Nu(t[0])){const s=t[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),MVe(t[0])&&(i[0]+="/"),t[0]=s.slice(n+2))}else t[0][0]==="/"&&i.push("");const r=t.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function Xf(e,t=!1){if(Cb(e)||uy(e))return null;let i=e.indexOf("://");if(i===-1&&Wg(e))i=2;else{if(i===-1)return null;i+=3}const r=e.indexOf("/",i);return r!==-1&&(e=e.slice(0,r)),t&&(e=_U(e,!0)),e}function Nu(e){return Wg(e)||xK(e)}function Cb(e){return e!=null&&e.slice(0,5)==="blob:"}function uy(e){return e.slice(0,5)==="data:"}function x1e(e){const t=rB(e);if(!t||!t.isBase64)return null;const i=atob(t.data),r=new Uint8Array(i.length);for(let s=0;s<i.length;s++)r[s]=i.charCodeAt(s);return r.buffer}function wFt(e){return btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const TVe=/^data:(.*?)(;base64)?,(.*)$/;function rB(e){const t=e.match(TVe);if(!t)return null;const[,i,r,s]=t;return{mediaType:i,isBase64:!!r,data:s}}function T1e(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}function xFt(e,t){SVe(e,t)||EVe(e,t)}function SVe(e,t){if(!e)return!1;const i=document.createElement("a");if(!("download"in i))return!1;const r=URL.createObjectURL(e);return i.download=t,i.href=r,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),!0}function EVe(e,t){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(e,t)}function Wg(e){return e!=null&&e!==void 0&&e[0]==="/"&&e[1]==="/"}function xK(e){return g1e.test(e)}function CVe(e){return hVe.test(e)||Bl.scheme==="https"&&Wg(e)}function AVe(e){return y1e.test(e)||Bl.scheme==="http"&&Wg(e)}function MVe(e){return dVe.test(e)}function TK(e){return Wg(e)?`https:${e}`:e.replace(y1e,"https:")}function OVe(){return Bl.scheme==="http"}function rW(){return Bl.scheme==="https"}function _U(e,t=!1){return Wg(e)?e.slice(2):(e=e.replace(g1e,""),t&&e.length>1&&e[0]==="/"&&e[1]==="/"&&(e=e.slice(2)),e)}function RVe(e){const t=e.indexOf("//"),i=e.indexOf("/",t+2);return i===-1?e:e.slice(0,i)}function SK(e){let t=0;if(Nu(e)){const r=e.indexOf("//");r!==-1&&(t=r+2)}const i=e.lastIndexOf("/");return i<t?e:e.slice(0,i+1)}function TFt(e,t){if(!e)return"";const i=pn(e).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!(t==null?void 0:t.length))return r;const s=new RegExp(`.(${t.join("|")})$`,"ig");return r.replace(s,"")}function PVe(e){return e&&e[e.length-1]==="/"?e:`${e}/`}function S1e(e){return e.replace(/\/+$/,"")}function IVe(e){if(/^https?:\/\//i.test(e)){const t=_K(e);e=(e=t.path.replace(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}function $Ve(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function LVe(e){const t=rO.httpsDomains;if(!AVe(e))return e;const i=e.indexOf("/",7);let r;if(r=i===-1?e:e.slice(0,i),r=r.toLowerCase().slice(7),pVe.test(r)){if(!r.endsWith(":80"))return e;r=r.slice(0,-3),e=e.replace(":80","")}return OVe()&&r===Bl.authority&&!fVe.test(e)||(rW()&&r===Bl.authority||t&&t.some(s=>r===s||r.endsWith(`.${s}`))||rW()&&!iB(e))&&(e=TK(e)),e}function sW(e,t,i){if(!(t&&i&&e&&Nu(e)))return e;const r=e.indexOf("//"),s=e.indexOf("/",r+2),n=e.indexOf(":",r+2),o=Math.min(s<0?e.length:s,n<0?e.length:n);return e.slice(r+2,o).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,r+2)}${i}${e.slice(o)}`}function nW(e){return typeof e=="string"?new cA(Wh(e)):(e.scheme||(e.scheme=Bl.scheme),e)}function EK(e){return NVe.test(e)}function E1e(e,t){const i=pn(e),r=Object.keys(i.query||{});return r.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function C1e(e,t,i){const r=pn(e),s=r.query||{};return s[t]=String(i),`${r.path}?${Eb(s)}`}function s5(e,t){const i=pn(e),r=i.query||{};for(const n in t)r[n]=t[n];const s=Eb(r);return s?`${i.path}?${s}`:i.path}function CK(e){if(M(e))return null;const t=e.match(DVe);return t?t[1]:null}const DVe=/.*?\.([^\/]*)$/,NVe=/(^data:image\/svg|\.svg$)/i;function fv(e,t){const i=t&&t.url&&t.url.path;if(e&&i&&(e=Wh(e,i,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const r=wK(e,t.portalItem.itemUrl);kVe.test(r)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(r).path)}return oW(e,t&&t.portal)}function mv(e,t,i=YA.YES){if(!e)return e;!Nu(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let r=Wh(e);if(t){const s=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(s){const n=oW(s,t.portal);r=wK(oW(r,t.portal),n,n),r!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=M1e(r,t&&t.portal),Nu(r)&&(r=Zf(r)),(t==null?void 0:t.resources)&&(t==null?void 0:t.portalItem)&&!Nu(r)&&!uy(r)&&i===YA.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r)}),r}function sB(e,t,i){return fv(e,i)}function Ab(e,t,i,r){const s=mv(e,r);s!==void 0&&(t[i]=s)}const FVe=/\/items\/([^\/]+)\/resources\//,kVe=/^\.\/resources\//;function A1e(e){const t=_(e)?e.match(FVe):null;return _(t)?t[1]:null}function M1e(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?sW(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function oW(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const i=`${t.urlKey}.${t.customBaseUrl}`,r=vK();return F3(r,`${r.scheme}://${i}`)?sW(e,t.portalHostname,i):sW(e,i,t.portalHostname)}var YA;(function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"})(YA||(YA={}));const UVe=Object.freeze(Object.defineProperty({__proto__:null,fromJSON:fv,toJSON:mv,read:sB,write:Ab,itemIdFromResourceUrl:A1e,ensureMainOnlineDomain:M1e,get MarkKeep(){return YA}},Symbol.toStringTag,{value:"Module"}));var aW;const zVe=ml()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let sx=aW=class extends Ce{constructor(e){super(e)}readHref(e,t,i){return e?fv(e,i):t.dataURI}writeHref(e,t,i,r){e&&(uy(e)?t.dataURI=e:(t.href=mv(e,r),Nu(t.href)&&(t.href=Zf(t.href))))}clone(){return new aW({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],sx.prototype,"href",void 0),u([De("href")],sx.prototype,"readHref",null),u([it("href",{href:{type:String},dataURI:{type:String}})],sx.prototype,"writeHref",null),u([bt(zVe)],sx.prototype,"primitive",void 0),sx=aW=u([L("esri.symbols.support.IconSymbol3DLayerResource")],sx);const O1e="circle";var lW;let IC=lW=class extends Ee{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new lW({x:this.x,y:this.y})}};u([d({type:Number})],IC.prototype,"x",void 0),u([d({type:Number})],IC.prototype,"y",void 0),IC=lW=u([L("esri.symbols.support.Symbol3DAnchorPosition2D")],IC);var cW;let xP=cW=class extends Ce{constructor(e){super(e),this.color=new Le([0,0,0,1]),this.size=Vc(1)}clone(){const e={color:_(this.color)?this.color.clone():null,size:this.size};return new cW(e)}};u([d(Iv)],xP.prototype,"color",void 0),u([d(Hg)],xP.prototype,"size",void 0),xP=cW=u([L("esri.symbols.support.Symbol3DIconOutline")],xP);var UE;const VVe=ve.getLogger("esri.symbols.IconSymbol3DLayer");let Bm=UE=class extends cy{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=void 0,this.outline=void 0}clone(){return new UE({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:_(this.material)?this.material.clone():null,outline:_(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||$I,i=Aoe(e),r=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||$I).clone()}:null;return new UE({size:e.size,resource:{primitive:GVe(e.style)},material:{color:t},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(e){const t=!e.color||Gze(e.color)?$I:e.color,i=Aoe(e);return new UE({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(e){return new UE({resource:{href:T1e({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};function Aoe(e){const t="width"in e?e.width:e.size,i="height"in e?e.height:e.size,r=Moe(e.xoffset),s=Moe(e.yoffset);return(r||s)&&t&&i?{x:-r/t,y:s/i}:null}function Moe(e){return isFinite(e)?e:0}u([d({type:Yh,json:{write:!0}})],Bm.prototype,"material",void 0),u([d({type:sx,json:{write:!0}})],Bm.prototype,"resource",void 0),u([bt({Icon:"icon"},{readOnly:!0})],Bm.prototype,"type",void 0),u([d(Hg)],Bm.prototype,"size",void 0),u([bt({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),d({json:{default:"center"}})],Bm.prototype,"anchor",void 0),u([d({type:IC,json:{type:[Number],read:{reader:e=>new IC({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Bm.prototype,"anchorPosition",void 0),u([d({type:xP,json:{write:!0}})],Bm.prototype,"outline",void 0),Bm=UE=u([L("esri.symbols.IconSymbol3DLayer")],Bm);const BVe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function GVe(e){return BVe[e]||(VVe.warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const q1=Bm;function Mb(e,t,i=nt){return t||(t=new i),t===e||(t.removeAll(),jVe(e)?t.addMany(e):e&&t.add(e)),t}function R1e(e){return e}function jVe(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}const P1e="20220630",I1e="5a46844c5ac1b721521da79fb0304de9e8457e2c",$1e="4.24",HVe={async request(e,t){var a;const{default:i}=await Promise.resolve().then(function(){return k1e}),r=e.options,s=r.responseType;r.signal=t==null?void 0:t.signal,r.responseType=s==="native"||s==="native-request-init"?"native-request-init":["blob","json","text"].includes(s)&&((a=w1e(e.url))==null?void 0:a.after)?s:"array-buffer";const n=await i(e.url,r),o={data:n.data,ssl:n.ssl};switch(n.requestOptions.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let Es;function SFt(e){Es=e}function qVe(e){const t=Es&&Es.findCredential(e);return t&&t.token?C1e(e,"token",t.token):e}ye("host-webworker")||(ye("edge")||ye("trident"))&&console.warn("Deprecated browser - see http://esriurl.com/oldbrowser");const WVe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function L1e(e){const t=Xf(e,!0);return t&&t.endsWith(".arcgis.com")&&!WVe.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}function D1e(e,t,i=!1,r){return new Promise((s,n)=>{if(an(r))return void n(Ooe());let o=()=>{c(),n(new Error(`Unable to load ${t}`))},a=()=>{const h=e;c(),s(h)},l=()=>{if(!e)return;const h=e;c(),h.src="",n(Ooe())};const c=()=>{ye("esri-image-decode")||(e.removeEventListener("error",o),e.removeEventListener("load",a)),o=null,a=null,e=null,_(r)&&r.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(t)};_(r)&&r.addEventListener("abort",l),ye("esri-image-decode")?e.decode().then(a,o):(e.addEventListener("error",o),e.addEventListener("load",a))})}function Ooe(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}function ZVe(e){or.request.crossOriginNoCorsDomains||(or.request.crossOriginNoCorsDomains={});const t=or.request.crossOriginNoCorsDomains;for(let i of e)i=i.toLowerCase(),/^https?:\/\//.test(i)?t[Xf(i)]=0:(t[Xf("http://"+i)]=0,t[Xf("https://"+i)]=0)}function XVe(e){const t=or.request.crossOriginNoCorsDomains;if(t){let i=Xf(e);if(i)return i=i.toLowerCase(),!F3(i,vK())&&t[i]<Date.now()-36e5}return!1}async function YVe(e){var r;const t=or.request.crossOriginNoCorsDomains;t&&(t[Xf(e).toLowerCase()]=Date.now());const i=pn(e);e=i.path,((r=i.query)==null?void 0:r.f)==="json"&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}}async function Zt(e,t){var c;const i=uy(e),r=Cb(e);r||i||(e=Zf(e));const s={url:e,requestOptions:F({},t)};let n=w1e(e);if(n){const h=await sBe(n,s);if(h!=null)return{data:h,getHeader:AK,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(e=s.url,(t=s.requestOptions).responseType==="image"){if(ye("host-webworker")||ye("host-node"))throw Ff("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s)}else if(i)throw Ff("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),s);if(t.method==="head"){if(t.body)throw Ff("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw Ff("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await tBe(),bU)return bU.execute(e,t);const o=new AbortController;va(t,()=>o.abort());const a={controller:o,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:xf.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await oBe(a);return(c=n==null?void 0:n.after)==null||c.call(n,l),l}let bU;const xf=or.request,N1e="FormData"in globalThis,JVe=[499,498,403,401],QVe=["COM_0056","COM_0057","SB_0008"],KVe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],AK=()=>null,uW=Symbol();function eBe(e){const t=Xf(e);t&&!Zt._corsServers.includes(t)&&Zt._corsServers.push(t)}function Roe(e){const t=Xf(e);return!t||t.endsWith(".arcgis.com")||Zt._corsServers.includes(t)||bK(t)}function Ff(e,t,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getHeader:AK,ssl:!1};if(t instanceof W)return t.details?(t.details=ue(t.details),t.details.url=i.url,t.details.requestOptions=i.requestOptions):t.details=n,t;if(t){const o=r&&(c=>r.headers.get(c)),a=r&&r.status,l=t.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(t.httpCode!=null?t.httpCode:t.code)||a||0,n.subCode=t.subcode,n.messageCode=t.messageCode,typeof t.details=="string"?n.messages=[t.details]:n.messages=t.details,n.raw=uW in t?t[uW]:t}return as(t)?mi():new W(e,s,n)}async function tBe(){ye("host-webworker")?bU||(bU=await import("./request.a0620ac8.js")):Zt._abortableFetch||(Zt._abortableFetch=globalThis.fetch.bind(globalThis))}async function hW(){Es||await import("./IdentityManager.3b3372e9.js")}async function iBe(e){var a;const t=e.params.url,i=e.params.requestOptions,r=e.controller.signal,s=i.body;let n=null,o=null;if(N1e&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),e.fetchOptions={cache:i.cacheBust&&!Zt._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:xf.priority,redirect:"follow",signal:r},(n||o)&&(e.fetchOptions.body=n||o),i.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||((a=i.query)==null?void 0:a.token)||(n==null?void 0:n.get("token"))),!e.hasToken&&or.apiKey&&L1e(t)&&(i.query||(i.query={}),i.query.token=or.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!F1e(t)&&!an(r)){let l;i.authMode==="immediate"?(await hW(),l=await Es.getCredential(t,{signal:r}),e.credential=l):i.authMode==="no-prompt"?(await hW(),l=await Es.getCredential(t,{prompt:!1,signal:r}).catch(()=>{}),e.credential=l):Es&&(l=Es.findCredential(t)),l&&(e.credentialToken=l.token,e.useSSL=!!l.ssl)}}function F1e(e){return KVe.some(t=>t.test(e))}async function rBe(e){let t=e.params.url;const i=e.params.requestOptions,r=e.fetchOptions,s=Cb(t)||uy(t),n=i.responseType||"json",o=s?0:i.timeout!=null?i.timeout:xf.timeout;let a=!1;if(!s){e.useSSL&&(t=TK(t)),i.cacheBust&&r.cache==="default"&&(t=C1e(t,"request.preventCache",Date.now()));let f=F({},i.query);e.credentialToken&&(f.token=e.credentialToken);let m=Eb(f);ye("esri-url-encodes-apostrophe")&&(m=m.replace(/'/g,"%27"));const g=t.length+1+m.length;let y;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||g>xf.maxUrlLength;const x=i.useProxy||!!iB(t);if(x){const b=bVe(t);y=b.path,!a&&y.length+1+g>xf.maxUrlLength&&(a=!0),b.query&&(f=F(F({},b.query),f))}if(r.method==="HEAD"&&(a||x)){if(a)throw g>xf.maxUrlLength?Ff("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):Ff("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(x)throw Ff("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?t=s5(t,f):(r.body=Eb(f),r.headers["Content-Type"]="application/x-www-form-urlencoded")):t=s5(t,f),x&&(e.useProxy=!0,t=`${y}?${t}`),f.token&&N1e&&r.body instanceof FormData&&!/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)&&r.body.set("token",f.token),i.hasOwnProperty("withCredentials"))e.withCredentials=i.withCredentials;else if(!F3(t,vK())){if(bK(t))e.withCredentials=!0;else if(Es){const b=Es.findServerInfo(t);b&&b.webTierAuth&&(e.withCredentials=!0)}}e.withCredentials&&(r.credentials="include",XVe(t)&&await YVe(a?s5(t,f):t))}let l,c,h=0,p=!1;o>0&&(h=setTimeout(()=>{p=!0,e.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=t;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||nBe(i.headers)||!s&&!e.useProxy&&xf.proxyUrl&&!Roe(t)){if(l=await Zt._abortableFetch(t,r),e.useProxy||eBe(t),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=Poe(c,"application/xml");break;case"document":c=Poe(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const f=l.headers.get("Content-Type");if(/application\/json|text\/plain/i.test(f)&&c[n==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}n==="image"&&c instanceof Blob&&(c=await Ioe(URL.createObjectURL(c),e,!0))}}else c=await l.text()}else c=await Ioe(t,e)}catch(f){if(f.name==="AbortError")throw p?new Error("Timeout exceeded"):mi("Request canceled");if(!(!l&&f instanceof TypeError&&xf.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||e.useProxy||Roe(t))throw f;e.redoRequest=!0,wVe({proxyUrl:xf.proxyUrl,urlPrefix:Xf(t)})}finally{h&&clearTimeout(h)}return[l,c]}async function sBe(e,t){if(e.responseData!=null)return e.responseData;if(e.headers&&(t.requestOptions.headers=F(F({},t.requestOptions.headers),e.headers)),e.query&&(t.requestOptions.query=F(F({},t.requestOptions.query),e.query)),e.before){let i,r;try{r=await e.before(t)}catch(s){i=Ff("request:interceptor",s,t)}if((r instanceof Error||r instanceof W)&&(i=Ff("request:interceptor",r,t)),i)throw e.error&&e.error(i),i;return r}}function nBe(e){if(e){for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0}return!1}function Poe(e,t){let i;try{i=new DOMParser().parseFromString(e,t)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function oBe(e){var n;let t,i;await iBe(e);try{do[t,i]=await rBe(e);while(!await aBe(e,t,i))}catch(o){const a=Ff("request:server",o,e.params,t);throw a.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(a),a}const r=e.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!e.hasToken&&!e.credentialToken&&((n=i.user)==null?void 0:n.username)&&!bK(r)){const o=Xf(r,!0);o&&xf.trustedServers.push(o)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&ZVe(i.authorizedCrossOriginNoCorsDomains)}const s=e.credential;if(s&&Es){const o=Es.findServerInfo(s.server);let a=o&&o.owningSystemUrl;if(a){a=a.replace(/\/?$/,"/sharing");const l=Es.findCredential(a,s.userId);l&&Es._getIdenticalSvcIdx(a,l)===-1&&l.resources.unshift(a)}}return{data:i,getHeader:t?o=>t.headers.get(o):AK,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function aBe(e,t,i){if(e.redoRequest)return e.redoRequest=!1,!1;const r=e.params.requestOptions;if(!t||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n,o,a;if(!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[uW]=i,s;(i==null?void 0:i.error)&&(s=i.error),s&&(n=Number(s.code),o=s.hasOwnProperty("subcode")?Number(s.subcode):null,a=s.messageCode,a=a&&a.toUpperCase());const l=r.authMode;if(n===403&&(o===4||s.message&&s.message.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(l!=="no-prompt"||n===498)&&JVe.includes(n)&&!F1e(e.params.url)&&(n!==403||!QVe.includes(a)&&(o==null||o===2&&e.credentialToken))){await hW();try{const c=await Es.getCredential(e.params.url,{error:Ff("request:server",s,e.params),prompt:l!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=c,e.credentialToken=c.token,e.useSSL=e.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return e.credential=null,e.credentialToken=null,!1;s=c}}if(s)throw s;return!0}function Ioe(e,t,i=!1){const r=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=xf.priority,s.src=e,D1e(s,e,i,r)}Zt._abortableFetch=null,Zt._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];var k1e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Zt}),T1;(function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"})(T1||(T1={}));class lBe{constructor(t){this.instance=t,this._resolver=hv(),this._status=T1.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=T1.RESOLVED,this._cleanUp()},()=>{this._status=T1.REJECTED,this._cleanUp()})}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return this._status===T1.RESOLVED}isRejected(){return this._status===T1.REJECTED}isFulfilled(){return this._status!==T1.PENDING}abort(){this._resolver.reject(mi())}when(t,i){return this._resolver.promise.then(t,i)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const t=hv(),i=[...this._resolvingPromises,t.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve(this.instance)},s=>{this.isFulfilled()||this._allPromise!==r||as(s)||this._resolver.reject(s)}),t.resolve()}}const nB=e=>{let t=class extends e{constructor(...i){super(...i),this._promiseProps=new lBe(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return new Promise((s,n)=>{this._promiseProps.when(s,n)}).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return t=u([L("esri.core.Promise")],t),t};let wU=class extends nB(Ee){};wU=u([L("esri.core.Promise")],wU);const cBe="not-loaded",uBe="loading",hBe="failed",$oe="loaded",U1e=e=>{let t=class extends e{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=kV(n,l);this.destroyed&&l(new W("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===cBe){this._set("loadStatus",uBe);const a=this._loadController=new AbortController;s({signal:a.signal}),va(a.signal,()=>{this._promiseProps.abort()})}return r(),o}})),this.when(()=>{this._set("loadStatus",$oe),this._loadController=null},r=>{this._set("loadStatus",hBe),this._set("loadError",r),this._loadController=null})}get loaded(){return this.loadStatus===$oe}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new W("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort()),this}};return u([d({readOnly:!0})],t.prototype,"loaded",null),u([d({readOnly:!0})],t.prototype,"loadError",void 0),u([d({clonable:!1})],t.prototype,"loadStatus",void 0),u([d({type:[Uc],readOnly:!0})],t.prototype,"loadWarnings",null),t=u([L("esri.core.Loadable")],t),t};let TP=class extends U1e(wU){};TP=u([L("esri.core.Loadable")],TP),function(e){function t(i){return!(!i||!i.load)}e.LoadableMixin=U1e,e.isLoadable=t}(TP||(TP={}));const Zg=TP;var dW;const dBe=new Ti({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Rd=dW=class extends Ee{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){e!=="asc"&&e!=="desc"||this._set("sortOrder",e)}clone(){return new dW({categories:this.categories?ue(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let i,r;if(this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o)),this.extent){const o=HS(this.extent,at.WGS84);_(o)&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&e.extraQuery&&(s="("+s+")"+e.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>dBe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:F(F({},t),n)}}};u([d()],Rd.prototype,"categories",void 0),u([d()],Rd.prototype,"disableExtraQuery",void 0),u([d({type:yi})],Rd.prototype,"extent",void 0),u([d()],Rd.prototype,"filter",void 0),u([d()],Rd.prototype,"num",void 0),u([d()],Rd.prototype,"query",void 0),u([d()],Rd.prototype,"sortField",void 0),u([d()],Rd.prototype,"sortOrder",null),u([d()],Rd.prototype,"start",void 0),Rd=dW=u([L("esri.portal.PortalQueryParams")],Rd);const D0=Rd;let nx=class extends Ee{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([d()],nx.prototype,"nextQueryParams",void 0),u([d()],nx.prototype,"queryParams",void 0),u([d()],nx.prototype,"results",void 0),u([d()],nx.prototype,"total",void 0),nx=u([L("esri.portal.PortalQueryResult")],nx);const pBe=nx;let Xy=class extends Ce{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new W("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([d({type:Date})],Xy.prototype,"created",void 0),u([d()],Xy.prototype,"id",void 0),u([d()],Xy.prototype,"portal",void 0),u([d()],Xy.prototype,"title",void 0),u([d({readOnly:!0})],Xy.prototype,"url",null),u([d()],Xy.prototype,"username",void 0),Xy=u([L("esri.portal.PortalFolder")],Xy);const fBe=Xy;let Qo=class extends Ce{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return this.portal._request(this.url+"/categorySchema",e).then(t=>{const i=t.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return this.portal._request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new W("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,t){let i=dn(D0,e);return parseFloat(this.portal.currentVersion)>5?(i=i||new D0,this.portal._queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",t)):(i=i?i.clone():new D0,i.query="group:"+this.id+(i.query?" "+i.query:""),this.portal.queryItems(i,t))}_fetchCategorySchemaSet(e,t){return this.portal._fetchSelf(this.portal.authMode,!0,t).then(i=>{const r=i.contentCategorySetsGroupQuery;if(r){const s=new D0;return s.disableExtraQuery=!0,s.num=1,s.query=r,this.portal.queryGroups(s,t)}throw new W("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(i=>{if(i.total){const r=i.results[0],s=new D0;return s.num=1,s.query=`typekeywords:"${e}"`,r.queryItems(s,t)}throw new W("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(i=>i.total?i.results[0].fetchData("json",t).then(r=>{const s=r&&r.categorySchema;return s&&s.length?s:[]}):[])}};u([d()],Qo.prototype,"access",void 0),u([d({type:Date})],Qo.prototype,"created",void 0),u([d()],Qo.prototype,"description",void 0),u([d()],Qo.prototype,"id",void 0),u([d()],Qo.prototype,"isInvitationOnly",void 0),u([d({type:Date})],Qo.prototype,"modified",void 0),u([d()],Qo.prototype,"owner",void 0),u([d()],Qo.prototype,"portal",void 0),u([d()],Qo.prototype,"snippet",void 0),u([d()],Qo.prototype,"sortField",void 0),u([d()],Qo.prototype,"sortOrder",void 0),u([d()],Qo.prototype,"tags",void 0),u([d()],Qo.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Qo.prototype,"thumbnailUrl",null),u([d()],Qo.prototype,"title",void 0),u([d({readOnly:!0})],Qo.prototype,"url",null),Qo=u([L("esri.portal.PortalGroup")],Qo);const pW=Qo;var mBe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:pW}),fW;let Ds=fW=class extends Ce{constructor(...e){super(...e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.get("portal.restUrl");return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,i=e&&e.data,r=e&&e.folder,s={method:"post"};t&&(s.query=t.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal._request(n+"/addItem",s).then(o=>(t.id=o.id,t.portal=this.portal,t.loaded?t.reload():t.load()))}deleteItem(e){let t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal._request(t+`/items/${e.id}/delete`,{method:"post"}).then(()=>{e.id=null,e.portal=null})}deleteItems(e){const t=this.userContentUrl+"/deleteItems",i=e.map(r=>r.id);if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal._request(t,r).then(()=>{e.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const e={query:{num:1}};return this.portal._request(this.userContentUrl,e).then(t=>{let i;return i=t&&t.folders?t.folders.map(r=>{const s=fBe.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal._request(this.url).then(e=>{let t;return t=e&&e.groups?e.groups.map(i=>{const r=pW.fromJSON(i);return r.portal=this.portal,r}):[],t})}fetchItems(e){e||(e={});let t,i=this.userContentUrl;return e.folder&&(i+="/"+e.folder.id),Promise.resolve().then(function(){return iEe}).then(({default:r})=>{t=r;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal._request(i,{query:s})}).then(r=>{let s;return r&&r.items?(s=r.items.map(n=>{const o=t.fromJSON(n);return o.portal=this.portal,o}),Promise.all(s.map(n=>n.load())).catch(n=>n).then(()=>({items:s,nextStart:r.nextStart,total:r.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal._request(this.url+"/tags").then(e=>e.tags)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new pW({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new W("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new W("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new fW;return t.sourceJSON=e,t.read(e),t}};u([d()],Ds.prototype,"access",void 0),u([d({type:Date})],Ds.prototype,"created",void 0),u([d()],Ds.prototype,"culture",void 0),u([d()],Ds.prototype,"description",void 0),u([d()],Ds.prototype,"email",void 0),u([d()],Ds.prototype,"favGroupId",void 0),u([d()],Ds.prototype,"fullName",void 0),u([d({type:Date})],Ds.prototype,"modified",void 0),u([d()],Ds.prototype,"orgId",void 0),u([d()],Ds.prototype,"portal",void 0),u([d()],Ds.prototype,"preferredView",void 0),u([d()],Ds.prototype,"privileges",void 0),u([d()],Ds.prototype,"region",void 0),u([d()],Ds.prototype,"role",void 0),u([d()],Ds.prototype,"roleId",void 0),u([d()],Ds.prototype,"sourceJSON",void 0),u([d()],Ds.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Ds.prototype,"thumbnailUrl",null),u([d()],Ds.prototype,"units",void 0),u([d({readOnly:!0})],Ds.prototype,"userContentUrl",null),u([d({readOnly:!0})],Ds.prototype,"url",null),u([d()],Ds.prototype,"username",void 0),u([d()],Ds.prototype,"userType",void 0),Ds=fW=u([L("esri.portal.PortalUser")],Ds);const MK=Ds;var gBe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:MK}),lh;let VG;const Loe={PortalGroup:()=>Promise.resolve().then(function(){return mBe}),PortalItem:()=>Promise.resolve().then(function(){return iEe}),PortalUser:()=>Promise.resolve().then(function(){return gBe})};let et=lh=class extends eO(Zg){constructor(e){super(e),this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=or.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return typeof e=="string"?{url:e}:e}destroy(){this._esriId_credentialCreateHandle&&(this._esriId_credentialCreateHandle.remove(),this._esriId_credentialCreateHandle=null)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)or.request.trustedServers.includes(t)||or.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e&&e.toLowerCase()}readUser(e){let t=null;return e&&(t=MK.fromJSON(e),t.portal=this),t}load(e){const t=Promise.resolve().then(function(){return Yit}).then(({default:i})=>{qt(e),VG=i}).then(()=>this.sourceJSON?this.sourceJSON:this._fetchSelf(this.authMode,!1,e)).then(i=>{if(Es){const r=Es;this.credential=r.findCredential(this.restUrl),this.credential||this.authMode!==lh.AUTH_MODE_AUTO||(this._esriId_credentialCreateHandle=r.on("credential-create",()=>{r.findCredential(this.restUrl)&&this._signIn()}))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(t),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await import("./ElevationLayer.58c86daf.js")).default;return e?e.map(i=>new t({id:i.id,url:i.url})):[]}fetchBasemaps(e,t){const i=new D0;return i.query=e||(or.apiKey&&L1e(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0,this.queryGroups(i,t).then(r=>{if(i.num=100,i.query='type:"Web Map" -type:"Web Application"',r.total){const s=r.results[0];return i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc",s.queryItems(i,t)}return null}).then(r=>{let s;return s=r&&r.total?r.results.filter(n=>n.type==="Web Map").map(n=>new VG({portalItem:n})):[],s})}fetchCategorySchema(e){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema",e).then(t=>t.categorySchema):an(e)?Promise.reject(mi()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,i=new D0;if(i.num=100,i.sortField="title",t&&t.length){const r=[];for(const s of t)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,e).then(s=>s.results)}return an(e)?Promise.reject(mi()):Promise.resolve([])}fetchRegions(e){var i;const t=((i=this.user)==null?void 0:i.culture)||this.culture||ul();return this._request(this.restUrl+"/portals/regions",me(F({},e),{query:{culture:t}}))}fetchSettings(e){var i;const t=((i=this.user)==null?void 0:i.culture)||this.culture||ul();return this._request(this.restUrl+"/portals/self/settings",me(F({},e),{query:{culture:t}}))}static getDefault(){return lh._default&&!lh._default.destroyed||(lh._default=new lh),lh._default}queryGroups(e,t){return this._queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this._queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this._queryPortal("/community/users",e,"PortalUser",t)}toJSON(){throw new W("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new lh({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new W("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}_getHelperServiceUrl(e){const t=this._getHelperService(e);if(!t.url)throw new W("portal:service-url-not-found",`The \`helperServices\` entry "${e}" does not include a \`url\` value`);return t.url}_fetchSelf(e=this.authMode,t=!1,i){const r=this.restUrl+"/portals/self",s=F({authMode:e,query:{culture:ul().toLowerCase()}},i);return s.authMode==="auto"&&(s.authMode="no-prompt"),t&&(s.query.default=!0),this._request(r,s)}_queryPortal(e,t,i,r){const s=dn(D0,t),n=o=>this._request(this.restUrl+e,F(F({},s.toRequestOptions(this)),r)).then(a=>{const l=s.clone();return l.start=a.nextStart,new pBe({nextQueryParams:l,queryParams:s,total:a.total,results:lh._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(cl(l),a)));return i&&Loe[i]?Loe[i]().then(({default:o})=>(qt(r),n(o))):n()}_signIn(){if(this.authMode===lh.AUTH_MODE_ANONYMOUS)return Promise.reject(new W("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const e=t=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(t||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=t,this._fetchSelf("immediate"))):this.user&&this.credential===t?null:(this.credential=t,this._fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return Es?Es.getCredential(this.restUrl).then(t=>e(t)):e(this.credential)}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_normalizeUrl(e){const t=this.credential&&this.credential.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}_requestToTypedArray(e,t,i){return this._request(e,t).then(r=>{const s=lh._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():r)).then(()=>s,()=>s)})}_readBasemap(e){if(e){const t=VG.fromJSON(e);return t.portalItem={portal:this},t}return null}_request(e,t={}){const i=F({f:"json"},t.query),{authMode:r=this.authMode===lh.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=t,c={authMode:r,body:s,cacheBust:n,method:o,query:i,responseType:a,timeout:0,signal:l};return Zt(this._normalizeSSL(e),c).then(h=>h.data)}static _resultsToTypedArray(e,t,i,r){let s;if(i){const n=_(r)?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(e||t)&&(s=s.map(o=>{const a=Object.assign(e?e.fromJSON(o):o,t);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};et.AUTH_MODE_ANONYMOUS="anonymous",et.AUTH_MODE_AUTO="auto",et.AUTH_MODE_IMMEDIATE="immediate",u([d()],et.prototype,"access",void 0),u([d()],et.prototype,"allSSL",void 0),u([d()],et.prototype,"authMode",void 0),u([d()],et.prototype,"authorizedCrossOriginDomains",void 0),u([De("authorizedCrossOriginDomains")],et.prototype,"readAuthorizedCrossOriginDomains",null),u([d()],et.prototype,"basemapGalleryGroupQuery",void 0),u([d()],et.prototype,"bingKey",void 0),u([d()],et.prototype,"canListApps",void 0),u([d()],et.prototype,"canListData",void 0),u([d()],et.prototype,"canListPreProvisionedItems",void 0),u([d()],et.prototype,"canProvisionDirectPurchase",void 0),u([d()],et.prototype,"canSearchPublic",void 0),u([d()],et.prototype,"canShareBingPublic",void 0),u([d()],et.prototype,"canSharePublic",void 0),u([d()],et.prototype,"canSignInArcGIS",void 0),u([d()],et.prototype,"canSignInIDP",void 0),u([d()],et.prototype,"colorSetsGroupQuery",void 0),u([d()],et.prototype,"commentsEnabled",void 0),u([d({type:Date})],et.prototype,"created",void 0),u([d()],et.prototype,"credential",void 0),u([d()],et.prototype,"culture",void 0),u([d()],et.prototype,"currentVersion",void 0),u([d()],et.prototype,"customBaseUrl",void 0),u([d()],et.prototype,"defaultBasemap",void 0),u([De("defaultBasemap")],et.prototype,"readDefaultBasemap",null),u([d()],et.prototype,"defaultDevBasemap",void 0),u([De("defaultDevBasemap")],et.prototype,"readDefaultDevBasemap",null),u([d({type:yi})],et.prototype,"defaultExtent",void 0),u([d()],et.prototype,"defaultVectorBasemap",void 0),u([De("defaultVectorBasemap")],et.prototype,"readDefaultVectorBasemap",null),u([d()],et.prototype,"description",void 0),u([d()],et.prototype,"devBasemapGalleryGroupQuery",void 0),u([d()],et.prototype,"eueiEnabled",void 0),u([d({readOnly:!0})],et.prototype,"extraQuery",null),u([d()],et.prototype,"featuredGroups",void 0),u([d()],et.prototype,"featuredItemsGroupQuery",void 0),u([d()],et.prototype,"galleryTemplatesGroupQuery",void 0),u([d()],et.prototype,"livingAtlasGroupQuery",void 0),u([d()],et.prototype,"hasCategorySchema",void 0),u([d()],et.prototype,"helpBase",void 0),u([d()],et.prototype,"helperServices",void 0),u([d()],et.prototype,"helpMap",void 0),u([d()],et.prototype,"homePageFeaturedContent",void 0),u([d()],et.prototype,"homePageFeaturedContentCount",void 0),u([d()],et.prototype,"httpPort",void 0),u([d()],et.prototype,"httpsPort",void 0),u([d()],et.prototype,"id",void 0),u([d()],et.prototype,"ipCntryCode",void 0),u([d({readOnly:!0})],et.prototype,"isOrganization",null),u([d()],et.prototype,"isPortal",void 0),u([d()],et.prototype,"isReadOnly",void 0),u([d()],et.prototype,"layerTemplatesGroupQuery",void 0),u([d()],et.prototype,"maxTokenExpirationMinutes",void 0),u([d({type:Date})],et.prototype,"modified",void 0),u([d()],et.prototype,"name",void 0),u([d()],et.prototype,"portalHostname",void 0),u([d()],et.prototype,"portalMode",void 0),u([d()],et.prototype,"portalProperties",void 0),u([d()],et.prototype,"region",void 0),u([d({readOnly:!0})],et.prototype,"restUrl",null),u([d()],et.prototype,"rotatorPanels",void 0),u([d()],et.prototype,"showHomePageDescription",void 0),u([d()],et.prototype,"sourceJSON",void 0),u([d()],et.prototype,"staticImagesUrl",void 0),u([d({json:{name:"2DStylesGroupQuery"}})],et.prototype,"stylesGroupQuery2d",void 0),u([d({json:{name:"stylesGroupQuery"}})],et.prototype,"stylesGroupQuery3d",void 0),u([d()],et.prototype,"supportsHostedServices",void 0),u([d()],et.prototype,"symbolSetsGroupQuery",void 0),u([d()],et.prototype,"templatesGroupQuery",void 0),u([d()],et.prototype,"thumbnail",void 0),u([d({readOnly:!0})],et.prototype,"thumbnailUrl",null),u([d()],et.prototype,"units",void 0),u([d()],et.prototype,"url",void 0),u([d()],et.prototype,"urlKey",void 0),u([De("urlKey")],et.prototype,"readUrlKey",null),u([d()],et.prototype,"user",void 0),u([De("user")],et.prototype,"readUser",null),u([d()],et.prototype,"useStandardizedQuery",void 0),u([d()],et.prototype,"useVectorBasemaps",void 0),u([d()],et.prototype,"vectorBasemapGalleryGroupQuery",void 0),et=lh=u([L("esri.portal.Portal")],et);const Bo=et;let ox=class extends Wu(Ce){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return _(e)&&e.placement===this.placement&&e.style===this.style&&(M(this.color)&&M(e.color)||_(this.color)&&_(e.color)&&this.color.toJSON()===e.color.toJSON())}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],ox.prototype,"type",void 0),u([d({type:Nze,json:{default:"begin-end",write:!0}})],ox.prototype,"placement",void 0),u([d({type:K_e,json:{default:"arrow",write:!0}})],ox.prototype,"style",void 0),u([d({type:Le,json:{type:[Zr],default:null,write:!0}})],ox.prototype,"color",void 0),ox=u([L("esri.symbols.LineStyleMarker3D")],ox);const mW=ox;var n5;let Gm=n5=class extends cy{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Vc(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:_(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:_(this.pattern)?this.pattern.clone():null,marker:_(this.marker)?this.marker.clone():null};return new n5(e)}static fromSimpleLineSymbol(e){var i,r,s;const t={enabled:!0,size:(i=e.width)!=null?i:Vc(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style&&e.style!=="inside-frame"?new cK({style:e.style}):null,material:new Yh({color:(e.color||$I).clone()}),marker:e.marker?new mW({placement:e.marker.placement,style:e.marker.style,color:(s=(r=e.marker.color)==null?void 0:r.clone())!=null?s:null}):null};return new n5(t)}};u([d({type:Yh,json:{write:!0}})],Gm.prototype,"material",void 0),u([bt({Line:"line"},{readOnly:!0})],Gm.prototype,"type",void 0),u([d({type:d1e,json:{write:!0,default:"miter"}})],Gm.prototype,"join",void 0),u([d({type:gK,json:{write:!0,default:"butt"}})],Gm.prototype,"cap",void 0),u([d(Hg)],Gm.prototype,"size",void 0),u([d(s1e)],Gm.prototype,"pattern",void 0),u([d({types:{key:"type",base:mW,typeMap:{style:mW}},json:{write:!0}})],Gm.prototype,"marker",void 0),Gm=n5=u([L("esri.symbols.LineSymbol3DLayer")],Gm);const dL=Gm;var gW;const yBe=ml()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let SP=gW=class extends Ce{clone(){return new gW({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{read:sB,write:Ab}})],SP.prototype,"href",void 0),u([bt(yBe)],SP.prototype,"primitive",void 0),SP=gW=u([L("esri.symbols.support.ObjectSymbol3DLayerResource")],SP);const OK="sphere";var yW;let Kx=yW=class extends Ee{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new yW({x:this.x,y:this.y,z:this.z})}};u([d({type:Number})],Kx.prototype,"x",void 0),u([d({type:Number})],Kx.prototype,"y",void 0),u([d({type:Number})],Kx.prototype,"z",void 0),Kx=yW=u([L("esri.symbols.support.Symbol3DAnchorPosition3D")],Kx);var vW;let Sl=vW=class extends cy{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new vW({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([d({type:Yh,json:{write:!0}})],Sl.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Sl.prototype,"castShadows",void 0),u([d({type:SP,json:{write:!0}})],Sl.prototype,"resource",void 0),u([bt({Object:"object"},{readOnly:!0})],Sl.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],Sl.prototype,"width",void 0),u([d({type:Number,json:{write:!0}})],Sl.prototype,"height",void 0),u([d({type:Number,json:{write:!0}})],Sl.prototype,"depth",void 0),u([bt({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),d({json:{default:"origin"}})],Sl.prototype,"anchor",void 0),u([d({type:Kx,json:{type:[Number],read:{reader:e=>new Kx({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Sl.prototype,"anchorPosition",void 0),u([d({type:Number,json:{write:!0}})],Sl.prototype,"heading",void 0),u([d({type:Number,json:{write:!0}})],Sl.prototype,"tilt",void 0),u([d({type:Number,json:{write:!0}})],Sl.prototype,"roll",void 0),u([d({readOnly:!0})],Sl.prototype,"isPrimitive",null),Sl=vW=u([L("esri.symbols.ObjectSymbol3DLayer")],Sl);const RK=Sl;var _W;let uc=_W=class extends cy{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return e!=null?e:t.height==null&&t.size!=null?t.size:void 0}readHeight(e,t){return e!=null?e:t.width==null&&t.size!=null?t.size:void 0}clone(){return new _W({enabled:this.enabled,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([d({type:Yh,json:{write:!0}})],uc.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],uc.prototype,"castShadows",void 0),u([bt({Path:"path"},{readOnly:!0})],uc.prototype,"type",void 0),u([d({type:["circle","quad"],json:{write:!0,default:"circle"}})],uc.prototype,"profile",void 0),u([d({type:d1e,json:{write:!0,default:"miter"}})],uc.prototype,"join",void 0),u([d({type:sVe,json:{write:!0,default:"butt"}})],uc.prototype,"cap",void 0),u([d({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],uc.prototype,"width",void 0),u([De("width",["width","size","height"])],uc.prototype,"readWidth",null),u([d({type:Number,json:{write:!0}})],uc.prototype,"height",void 0),u([De("height",["height","size","width"])],uc.prototype,"readHeight",null),u([d({type:["center","bottom","top"],json:{write:!0,default:"center"}})],uc.prototype,"anchor",void 0),u([d({type:["heading","all"],json:{write:!0,default:"all"}})],uc.prototype,"profileRotation",void 0),uc=_W=u([L("esri.symbols.PathSymbol3DLayer")],uc);const PK=uc;var bW;let $C=bW=class extends Ce{constructor(){super(...arguments),this.color=new Le([0,0,0,1]),this.size=0}clone(){const e={color:ue(this.color),size:this.size};return new bW(e)}};u([d(Iv)],$C.prototype,"color",void 0),u([d(Hg)],$C.prototype,"size",void 0),$C=bW=u([L("esri.symbols.support.Symbol3DHalo")],$C);let DI=class extends Wu(Ce){constructor(e){super(e),this.color=null}};u([d(Iv)],DI.prototype,"color",void 0),DI=u([L("esri.symbols.support.Symbol3DTextBackground")],DI);var o5;let ru=o5=class extends cy{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){_(e)&&_(this._userSize)&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,i,r){const s=me(F({},r),{textSymbol3D:!0});t.font=e.write({},s),delete t.font.size}get size(){return _(this._userSize)?this._userSize:_(this.font)&&this.font.size!=null?this.font.size:9}set size(e){this._userSize=e,_(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new o5({enabled:this.enabled,font:this.font&&ue(this.font),halo:this.halo&&ue(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:_(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ue(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new o5({font:_(e.font)?e.font.clone():new tB,halo:vBe(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new Yh({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new DI({color:e.backgroundColor.clone()}):null})}};function vBe(e,t){return e&&t>0?new $C({color:ue(e),size:t}):null}u([d({type:tB,json:{write:!0}})],ru.prototype,"font",null),u([it("font")],ru.prototype,"writeFont",null),u([d({type:$C,json:{write:!0}})],ru.prototype,"halo",void 0),u([d(me(F({},f1e),{json:{default:"center",write:!0}}))],ru.prototype,"horizontalAlignment",void 0),u([d(me(F({},p1e),{json:{default:1,write:!0}}))],ru.prototype,"lineHeight",void 0),u([d({type:Yh,json:{write:!0}})],ru.prototype,"material",void 0),u([d({type:DI,json:{write:!0}})],ru.prototype,"background",void 0),u([d(Hg)],ru.prototype,"size",null),u([d({type:String,json:{write:!0}})],ru.prototype,"text",void 0),u([bt({Text:"text"},{readOnly:!0})],ru.prototype,"type",void 0),u([d(me(F({},m1e),{json:{default:"baseline",write:!0}}))],ru.prototype,"verticalAlignment",void 0),ru=o5=u([L("esri.symbols.TextSymbol3DLayer")],ru);const QS=ru;var wW;let z_=wW=class extends cy{constructor(e){super(e),this.color=xW.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new wW({color:ue(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([d({type:Le,nonNullable:!0,json:{type:[Zr],write:(e,t,i)=>t[i]=e.toArray(Le.AlphaMode.UNLESS_OPAQUE),default:()=>xW.clone(),defaultEquals:e=>e.toCss(!0)===xW.toCss(!0)}})],z_.prototype,"color",void 0),u([bt({Water:"water"},{readOnly:!0})],z_.prototype,"type",void 0),u([d({type:["small","medium","large"],json:{write:!0,default:"medium"}})],z_.prototype,"waterbodySize",void 0),u([d({type:Number,json:{write:!0,default:null}})],z_.prototype,"waveDirection",void 0),u([d({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],z_.prototype,"waveStrength",void 0),z_=wW=u([L("esri.symbols.WaterSymbol3DLayer")],z_);const xW=new Le([0,119,190]),z1e=z_;var TW;let ax=TW=class extends Ee{constructor(){super(...arguments),this.portal=null}clone(){return new TW({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([d({type:String})],ax.prototype,"name",void 0),u([d({type:String})],ax.prototype,"styleUrl",void 0),u([d({type:String})],ax.prototype,"styleName",void 0),u([d({type:Bo})],ax.prototype,"portal",void 0),ax=TW=u([L("esri.symbols.support.StyleOrigin")],ax);const k3=ax;var SW;let HT=SW=class extends Ee{clone(){return new SW({url:this.url})}};u([d({type:String})],HT.prototype,"url",void 0),HT=SW=u([L("esri.symbols.support.Thumbnail")],HT);const V1e={icon:q1,object:RK,line:dL,path:PK,fill:eB,extrude:Q_e,text:QS,water:z1e},_Be=nt.ofType({base:cy,key:"type",typeMap:V1e,errorContext:"symbol-layer"}),bBe=ve.getLogger("esri.symbols.Symbol3D");let jm=class extends qc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=t&&t.type||nt;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.initialized&&bBe.error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){Mb(e,this._get("symbolLayers"))}readStyleOrigin(e,t,i){if(e.styleUrl&&e.name){const r=fv(e.styleUrl,i);return new k3({styleUrl:r,name:e.name})}if(e.styleName&&e.name)return new k3({portal:i&&i.portal||Bo.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new Uc("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,t,i,r){if(e.styleUrl&&e.name){let s=mv(e.styleUrl,r);Nu(s)&&(s=Zf(s)),t.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&r&&r.portal&&!b1e(e.portal.restUrl,r.portal.restUrl)?r&&r.messages&&r.messages.push(new Uc("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof cy||e&&V1e[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([d({json:{read:!1,write:!1}})],jm.prototype,"color",null),u([d({type:_Be,nonNullable:!0,json:{write:!0}}),Jt(R1e)],jm.prototype,"symbolLayers",null),u([d({type:k3})],jm.prototype,"styleOrigin",void 0),u([De("styleOrigin")],jm.prototype,"readStyleOrigin",null),u([it("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],jm.prototype,"writeStyleOrigin",null),u([d({type:HT,json:{read:!1}})],jm.prototype,"thumbnail",void 0),u([d({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],jm.prototype,"type",void 0),jm=u([L("esri.symbols.Symbol3D")],jm);const sO=jm;let EP=class extends Ce{constructor(e){super(e),this.visible=!0}clone(){}};u([d({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],EP.prototype,"type",void 0),u([d({readOnly:!0})],EP.prototype,"visible",void 0),EP=u([L("esri.symbols.callouts.Callout3D")],EP);const B1e=EP;var EW;let a5=EW=class extends Ce{constructor(){super(...arguments),this.color=new Le("white")}clone(){return new EW({color:ue(this.color)})}};u([d(Iv)],a5.prototype,"color",void 0),a5=EW=u([L("esri.symbols.callouts.LineCallout3DBorder")],a5);const G1e=a5;Object.freeze(Object.defineProperty({__proto__:null,default:G1e},Symbol.toStringTag,{value:"Module"}));var CW;let V_=CW=class extends B1e{constructor(e){super(e),this.type="line",this.color=new Le([0,0,0,1]),this.size=Vc(1),this.border=null}get visible(){return this.size>0&&_(this.color)&&this.color.a>0}clone(){return new CW({color:ue(this.color),size:this.size,border:ue(this.border)})}};u([bt({line:"line"},{readOnly:!0})],V_.prototype,"type",void 0),u([d(Iv)],V_.prototype,"color",void 0),u([d(Hg)],V_.prototype,"size",void 0),u([d({type:G1e,json:{write:!0}})],V_.prototype,"border",void 0),u([d({readOnly:!0})],V_.prototype,"visible",null),V_=CW=u([L("esri.symbols.callouts.LineCallout3D")],V_);const wBe=V_;function IK(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||t.maxWorldLength<=0)}function j1e(e){if(!e||!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!IK(e)}function $K(e){return e.type==="point-3d"||e.type==="label-3d"}function H1e(e){return e.horizontalAlignment==="center"}const q1e={types:{key:"type",base:B1e,typeMap:{line:wBe}},json:{write:!0}};var AW;let eT=AW=class extends Ce{constructor(){super(...arguments),this.screenLength=0,this.minWorldLength=0}clone(){return new AW({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([d(Hg)],eT.prototype,"screenLength",void 0),u([d({type:Number,json:{write:!0,default:0}})],eT.prototype,"minWorldLength",void 0),u([d({type:Number,json:{write:!0}})],eT.prototype,"maxWorldLength",void 0),eT=AW=u([L("esri.symbols.support.Symbol3DVerticalOffset")],eT);var l5;const W1e=nt.ofType({base:null,key:"type",typeMap:{text:QS}});let B_=l5=class extends sO{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new W1e,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return j1e(this)}hasVisibleVerticalOffset(){return IK(this)}clone(){return new l5({styleOrigin:ue(this.styleOrigin),symbolLayers:ue(this.symbolLayers),thumbnail:ue(this.thumbnail),callout:ue(this.callout),verticalOffset:ue(this.verticalOffset)})}static fromTextSymbol(e){return new l5({symbolLayers:[QS.fromTextSymbol(e)]})}};u([d({type:eT,json:{write:!0}})],B_.prototype,"verticalOffset",void 0),u([d(q1e)],B_.prototype,"callout",void 0),u([d({json:{read:!1,write:!1}})],B_.prototype,"styleOrigin",void 0),u([d({type:W1e})],B_.prototype,"symbolLayers",void 0),u([bt({LabelSymbol3D:"label-3d"},{readOnly:!0})],B_.prototype,"type",void 0),B_=l5=u([L("esri.symbols.LabelSymbol3D")],B_);const oB=B_;var c5;const Z1e=nt.ofType({base:null,key:"type",typeMap:{line:dL,path:PK}}),xBe=nt.ofType({base:null,key:"type",typeMap:{line:dL,path:PK}});let CP=c5=class extends sO{constructor(e){super(e),this.symbolLayers=new Z1e,this.type="line-3d"}clone(){return new c5({styleOrigin:ue(this.styleOrigin),symbolLayers:ue(this.symbolLayers),thumbnail:ue(this.thumbnail)})}static fromSimpleLineSymbol(e){return new c5({symbolLayers:[dL.fromSimpleLineSymbol(e)]})}};u([d({type:Z1e,json:{type:xBe}})],CP.prototype,"symbolLayers",void 0),u([bt({LineSymbol3D:"line-3d"},{readOnly:!0})],CP.prototype,"type",void 0),CP=c5=u([L("esri.symbols.LineSymbol3D")],CP);const aB=CP;let G_=class extends qc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([d({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],G_.prototype,"angle",void 0),u([d({type:["simple-marker","picture-marker"],readOnly:!0})],G_.prototype,"type",void 0),u([d({type:Number,cast:Tr,json:{write:!0}})],G_.prototype,"xoffset",void 0),u([d({type:Number,cast:Tr,json:{write:!0}})],G_.prototype,"yoffset",void 0),u([d({type:Number,cast:e=>e==="auto"?e:Tr(e),json:{write:!0}})],G_.prototype,"size",void 0),G_=u([L("esri.symbols.MarkerSymbol")],G_);const X1e=G_;var MW;const Y1e=nt.ofType({base:null,key:"type",typeMap:{fill:eB}});let AP=MW=class extends sO{constructor(e){super(e),this.symbolLayers=new Y1e,this.type="mesh-3d"}clone(){return new MW({styleOrigin:ue(this.styleOrigin),symbolLayers:ue(this.symbolLayers),thumbnail:ue(this.thumbnail)})}};u([d({type:Y1e})],AP.prototype,"symbolLayers",void 0),u([bt({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],AP.prototype,"type",void 0),AP=MW=u([L("esri.symbols.MeshSymbol3D")],AP);const LK=AP;function TBe(e,t,i){return t.imageData?T1e({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):J1e(t.url,i)}function J1e(e,t){return EBe(t)&&!Nu(e)&&t.layer.parsedUrl?Bc(t.layer.parsedUrl.path,"images",e):fv(e,t)}function SBe(e,t,i,r){if(uy(e)){const s=rB(e);t.contentType=s.mediaType,t.imageData=s.data,i&&i.imageData===t.imageData&&i.url&&Ab(i.url,t,"url",r)}else Ab(e,t,"url",r)}const Q1e={json:{read:{source:["imageData","url"],reader:TBe},write:{writer(e,t,i,r){SBe(e,t,this.source,r)}}}},K1e={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,i){const r={};return t.imageData&&(r.imageData=t.imageData),t.contentType&&(r.contentType=t.contentType),t.url&&(r.url=J1e(t.url,i)),r}}}};function EBe(e){return e&&(e.origin==="service"||e.origin==="portal-item")&&e.layer&&(e.layer.type==="feature"||e.layer.type==="stream")}var OW;let Pd=OW=class extends e1e{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string"&&e.imageData==null)return e;const s={};return e&&(s.url=e),t&&(s.outline=t),i!=null&&(s.width=Tr(i)),r!=null&&(s.height=Tr(r)),s}clone(){const e=new OW({color:ue(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",ue(this.source)),e}hash(){var e;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([bt({esriPFS:"picture-fill"},{readOnly:!0})],Pd.prototype,"type",void 0),u([d(Q1e)],Pd.prototype,"url",void 0),u([d({type:Number,json:{write:!0}})],Pd.prototype,"xscale",void 0),u([d({type:Number,json:{write:!0}})],Pd.prototype,"yscale",void 0),u([d({type:Number,cast:Tr,json:{write:!0}})],Pd.prototype,"width",void 0),u([d({type:Number,cast:Tr,json:{write:!0}})],Pd.prototype,"height",void 0),u([d({type:Number,cast:Tr,json:{write:!0}})],Pd.prototype,"xoffset",void 0),u([d({type:Number,cast:Tr,json:{write:!0}})],Pd.prototype,"yoffset",void 0),u([d(K1e)],Pd.prototype,"source",void 0),Pd=OW=u([L("esri.symbols.PictureFillSymbol")],Pd);const ebe=Pd;var RW;let Yp=RW=class extends X1e{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string"&&e.imageData==null)return e;const r={};return e&&(r.url=e),t!=null&&(r.width=Tr(t)),i!=null&&(r.height=Tr(i)),r}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new RW({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",ue(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([d({json:{write:!1}})],Yp.prototype,"color",void 0),u([bt({esriPMS:"picture-marker"},{readOnly:!0})],Yp.prototype,"type",void 0),u([d(Q1e)],Yp.prototype,"url",void 0),u([d(K1e)],Yp.prototype,"source",void 0),u([d({type:Number,cast:Tr,json:{write:!0}})],Yp.prototype,"height",void 0),u([De("height",["height","size"])],Yp.prototype,"readHeight",null),u([d({type:Number,cast:Tr,json:{write:!0}})],Yp.prototype,"width",void 0),u([d({json:{write:!1}})],Yp.prototype,"size",void 0),Yp=RW=u([L("esri.symbols.PictureMarkerSymbol")],Yp);const lB=Yp;var j_;const tbe=nt.ofType({base:null,key:"type",typeMap:{icon:q1,object:RK,text:QS}});let lx=j_=class extends sO{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new tbe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return j1e(this)}hasVisibleVerticalOffset(){return IK(this)}clone(){return new j_({verticalOffset:ue(this.verticalOffset),callout:ue(this.callout),styleOrigin:ue(this.styleOrigin),symbolLayers:ue(this.symbolLayers),thumbnail:ue(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new j_({symbolLayers:[q1.fromSimpleMarkerSymbol(e)]})}static fromPictureMarkerSymbol(e){return new j_({symbolLayers:[q1.fromPictureMarkerSymbol(e)]})}static fromCIMSymbol(e){var i,r;return((r=(i=e.data)==null?void 0:i.symbol)==null?void 0:r.type)!=="CIMPointSymbol"?null:e.data.symbol.callout?new j_({symbolLayers:[q1.fromCIMSymbol(e)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}):new j_({symbolLayers:[q1.fromCIMSymbol(e)]})}static fromTextSymbol(e){return new j_({symbolLayers:[QS.fromTextSymbol(e)]})}};u([d({type:eT,json:{write:!0}})],lx.prototype,"verticalOffset",void 0),u([d(q1e)],lx.prototype,"callout",void 0),u([d({type:tbe,json:{origins:{"web-scene":{write:!0}}}})],lx.prototype,"symbolLayers",void 0),u([bt({PointSymbol3D:"point-3d"},{readOnly:!0})],lx.prototype,"type",void 0),lx=j_=u([L("esri.symbols.PointSymbol3D")],lx);const W1=lx;var MP;const ibe=nt.ofType({base:null,key:"type",typeMap:{extrude:Q_e,fill:eB,icon:q1,line:dL,object:RK,text:QS,water:z1e}});let OP=MP=class extends sO{constructor(e){super(e),this.symbolLayers=new ibe,this.type="polygon-3d"}clone(){return new MP({styleOrigin:ue(this.styleOrigin),symbolLayers:ue(this.symbolLayers),thumbnail:ue(this.thumbnail)})}static fromJSON(e){const t=new MP;if(t.read(e),t.symbolLayers.length===2&&t.symbolLayers.getItemAt(0).type==="fill"&&t.symbolLayers.getItemAt(1).type==="line"){const i=t.symbolLayers.getItemAt(0),r=t.symbolLayers.getItemAt(1);!r.enabled||e.symbolLayers&&e.symbolLayers[1]&&e.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:_(r.material)?r.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new MP({symbolLayers:[eB.fromSimpleFillSymbol(e)]})}};u([d({type:ibe,json:{write:!0}})],OP.prototype,"symbolLayers",void 0),u([bt({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],OP.prototype,"type",void 0),OP=MP=u([L("esri.symbols.PolygonSymbol3D")],OP);const pL=OP;var PW;const BG=new Ti({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let cx=PW=class extends e1e{constructor(...e){super(...e),this.color=new Le([0,0,0,.25]),this.outline=new dl,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.style=e),t&&(r.outline=t),i&&(r.color=i),r}clone(){return new PW({color:ue(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([d()],cx.prototype,"color",void 0),u([d()],cx.prototype,"outline",void 0),u([bt({esriSFS:"simple-fill"},{readOnly:!0})],cx.prototype,"type",void 0),u([d({type:BG.apiValues,json:{read:BG.read,write:BG.write}})],cx.prototype,"style",void 0),cx=PW=u([L("esri.symbols.SimpleFillSymbol")],cx);const wp=cx;var IW;const GG=new Ti({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let Hm=IW=class extends X1e{constructor(...e){super(...e),this.color=new Le([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new dl}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string")return e;const s={};return e&&(s.style=e),t!=null&&(s.size=Tr(t)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(e,t){e&&this.style!=="x"&&this.style!=="cross"&&(t.color=e.toJSON()),e===null&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new IW({angle:this.angle,color:ue(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(e=this.outline)==null?void 0:e.hash()}`}};u([d()],Hm.prototype,"color",void 0),u([it("color")],Hm.prototype,"writeColor",null),u([bt({esriSMS:"simple-marker"},{readOnly:!0})],Hm.prototype,"type",void 0),u([d()],Hm.prototype,"size",void 0),u([d({type:GG.apiValues,json:{read:GG.read,write:GG.write}})],Hm.prototype,"style",void 0),u([d({type:String,json:{write:!0}})],Hm.prototype,"path",null),u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":dl}},json:{default:null,write:!0}})],Hm.prototype,"outline",void 0),Hm=IW=u([L("esri.symbols.SimpleMarkerSymbol")],Hm);const hl=Hm;var $W;let Hs=$W=class extends qc{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new tB,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.text=e),t&&(r.font=t),i&&(r.color=i),r}writeLineWidth(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}castLineWidth(e){return Tr(e)}writeLineHeight(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}clone(){return new $W({angle:this.angle,backgroundColor:ue(this.backgroundColor),borderLineColor:ue(this.borderLineColor),borderLineSize:this.borderLineSize,color:ue(this.color),font:this.font&&this.font.clone(),haloColor:ue(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([d({type:Le,json:{write:!0}})],Hs.prototype,"backgroundColor",void 0),u([d({type:Le,json:{write:!0}})],Hs.prototype,"borderLineColor",void 0),u([d({type:Number,json:{write:!0}})],Hs.prototype,"borderLineSize",void 0),u([d({type:tB,json:{write:!0}})],Hs.prototype,"font",void 0),u([d(me(F({},f1e),{json:{write:!0}}))],Hs.prototype,"horizontalAlignment",void 0),u([d({type:Boolean,json:{write:!0}})],Hs.prototype,"kerning",void 0),u([d({type:Le,json:{write:!0}})],Hs.prototype,"haloColor",void 0),u([d({type:Number,cast:Tr,json:{write:!0}})],Hs.prototype,"haloSize",void 0),u([d({type:Boolean,json:{write:!0}})],Hs.prototype,"rightToLeft",void 0),u([d({type:Boolean,json:{write:!0}})],Hs.prototype,"rotated",void 0),u([d({type:String,json:{write:!0}})],Hs.prototype,"text",void 0),u([bt({esriTS:"text"},{readOnly:!0})],Hs.prototype,"type",void 0),u([d(me(F({},m1e),{json:{write:!0}}))],Hs.prototype,"verticalAlignment",void 0),u([d({type:Number,cast:Tr,json:{write:!0}})],Hs.prototype,"xoffset",void 0),u([d({type:Number,cast:Tr,json:{write:!0}})],Hs.prototype,"yoffset",void 0),u([d({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],Hs.prototype,"angle",void 0),u([d({type:Number,json:{write:!0}})],Hs.prototype,"width",void 0),u([d({type:Number})],Hs.prototype,"lineWidth",void 0),u([it("lineWidth")],Hs.prototype,"writeLineWidth",null),u([Jt("lineWidth")],Hs.prototype,"castLineWidth",null),u([d(p1e)],Hs.prototype,"lineHeight",void 0),u([it("lineHeight")],Hs.prototype,"writeLineHeight",null),Hs=$W=u([L("esri.symbols.TextSymbol")],Hs);const nO=Hs;var LW;const CBe=ve.getLogger("esri.symbols.WebStyleSymbol");let Jp=LW=class extends qc{constructor(e){super(e),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get fetchCacheKey(){const e=_(this.portal)?this.portal:Bo.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t?t.portal:void 0,super.read(e,t)}clone(){return new LW({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const i=_(t)?t.cache:null,r=i?this.fetchCacheKey:null;if(_(i)){const a=i.get(r);if(a)return a.clone()}const s=await ABe();qt(t);const n=s.resolveWebStyleSymbol(this,{portal:this.portal},e,t);n.catch(a=>{CBe.error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return e==="webRef"&&o.type==="point-3d"||e==="cimRef"&&o.type==="cim"?(_(i)&&i.set(r,o.clone()),o):null}};function ABe(){return Promise.resolve().then(function(){return aDt})}u([d({json:{write:!1}})],Jp.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Jp.prototype,"styleName",void 0),u([d({type:Bo,json:{write:!1}})],Jp.prototype,"portal",void 0),u([d({type:String,json:{read:sB,write:Ab}})],Jp.prototype,"styleUrl",void 0),u([d({type:HT,json:{read:!1}})],Jp.prototype,"thumbnail",void 0),u([d({type:String,json:{write:!0}})],Jp.prototype,"name",void 0),u([bt({styleSymbolReference:"web-style"},{readOnly:!0})],Jp.prototype,"type",void 0),u([d()],Jp.prototype,"fetchCacheKey",null),Jp=LW=u([L("esri.symbols.WebStyleSymbol")],Jp);const KS=Jp;function cB(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function om(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const bu={base:qc,key:"type",typeMap:{"simple-fill":wp,"picture-fill":ebe,"picture-marker":lB,"simple-line":dl,"simple-marker":hl,text:nO,"label-3d":oB,"line-3d":aB,"mesh-3d":LK,"point-3d":W1,"polygon-3d":pL,"web-style":KS,cim:XS},errorContext:"symbol"},MBe={base:qc,key:"type",typeMap:{"picture-marker":lB,"simple-marker":hl,text:nO,"web-style":KS,cim:XS},errorContext:"symbol"},OBe=KM({types:bu}),rbe={base:qc,key:"type",typeMap:{"simple-fill":wp,"picture-fill":ebe,"picture-marker":lB,"simple-line":dl,"simple-marker":hl,text:nO,"line-3d":aB,"mesh-3d":LK,"point-3d":W1,"polygon-3d":pL,"web-style":KS,cim:XS},errorContext:"symbol"},RBe={base:qc,key:"type",typeMap:{text:nO,"label-3d":oB},errorContext:"symbol"},Doe={base:qc,key:"type",typeMap:{"line-3d":aB,"mesh-3d":LK,"point-3d":W1,"polygon-3d":pL,"web-style":KS,cim:XS},errorContext:"symbol"},PBe={base:qc,key:"type",typeMap:{"label-3d":oB},errorContext:"symbol"},sbe=im(bu);function IBe(e){if(!e)return null;const t={};for(const i in e){const r=jg(e[i]);r&&(t[i]=r)}return Object.keys(t).length!==0?t:null}function $Be(e){if(!_(e))return null;const t={};for(const i in e){const r=e[i];r&&(t[i]=r.toJSON())}return Object.keys(t).length!==0?t:null}let su=class extends Wu(Ce){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Dc(),configurable:!0})}normalizeCtorArgs(e,t,i,r){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:i,popupTemplate:r}}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const t of[this.sourceLayer,this.layer])if(t){if("popupTemplate"in t&&t.popupTemplate)return t.popupTemplate;if(e&&"defaultPopupTemplate"in t&&_(t.defaultPopupTemplate))return t.defaultPopupTemplate}return null}getAttribute(e){return this.attributes&&this.attributes[e]}setAttribute(e,t){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",i,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:$Be(this.aggregateGeometries),geometry:_(this.geometry)?this.geometry.toJSON():null,symbol:_(this.symbol)?this.symbol.toJSON():null,attributes:F({},this.attributes),popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){_(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,t,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:t,newValue:i};e==="attributes"&&(s.attributeName=r),this.layer.graphicChanged(s)}};u([d({value:null,json:{read:IBe}})],su.prototype,"aggregateGeometries",null),u([d({value:null})],su.prototype,"attributes",null),u([d({value:null,types:qS,json:{read:jg}})],su.prototype,"geometry",null),u([d({type:Boolean})],su.prototype,"isAggregate",void 0),u([d({clonable:"reference"})],su.prototype,"layer",void 0),u([d({type:ZS})],su.prototype,"popupTemplate",void 0),u([d({clonable:"reference"})],su.prototype,"sourceLayer",void 0),u([d({value:null,types:bu})],su.prototype,"symbol",null),u([d({type:Boolean,value:!0})],su.prototype,"visible",null),su=u([L("esri.Graphic")],su),function(e){e.generateUID=Dc}(su||(su={}));const Ha=su;var DW;let H_=DW=class extends Ce{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new DW({rotation:this.rotation,scale:this.scale,targetGeometry:_(this.targetGeometry)?this.targetGeometry.clone():null,camera:_(this.camera)?this.camera.clone():null})}};function jG(){return{enabled:!this.camera}}u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:jG}}}}})],H_.prototype,"rotation",void 0),u([Jt("rotation")],H_.prototype,"castRotation",null),u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:jG}}}}})],H_.prototype,"scale",void 0),u([d({types:qS,json:{read:jg,write:!0,origins:{"web-scene":{read:jg,write:{overridePolicy:jG}}}}})],H_.prototype,"targetGeometry",void 0),u([d({type:ju,json:{write:!0}})],H_.prototype,"camera",void 0),H_=DW=u([L("esri.Viewpoint")],H_);const xp=H_;function fL(e){return typeof e=="string"?document.getElementById(e):e}function nbe(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function Noe(e,t){const i=t.parentNode;i&&i.insertBefore(e,t)}function Foe(e,t){for(;;){const i=e.firstChild;if(!i)break;t.appendChild(i)}}function LBe(e){e.parentNode&&e.parentNode.removeChild(e)}function re(e,t,i={}){return DK(e,t,i,obe)}function Jn(e,t,i={}){return DK(e,t,i,abe)}function DK(e,t,i={},r){let s=null;const n=i.once?(o,a)=>{r(o)&&(hn(s),t(o,a))}:(o,a)=>{r(o)&&t(o,a)};if(s=dke(e,n,i.sync,i.equals),i.initial){const o=e();n(o,o)}return s}function os(e,t,i,r={}){let s=null,n=null,o=null;function a(){var h;s&&n&&(n.remove(),(h=r.onListenerRemove)==null||h.call(r,s),s=null,n=null)}function l(h){r.once&&r.once&&hn(o),i(h)}const c=re(e,(h,p)=>{var f;a(),NV(h)&&(s=h,n=jS(h,t,l),(f=r.onListenerAdd)==null||f.call(r,h))},{sync:r.sync,initial:!0});return o=Fo(()=>{c.remove(),a()}),o}function gv(e,t){return DBe(e,abe,t)}function DBe(e,t,i){if(an(i))return Promise.reject(mi());const r=e();if(t==null?void 0:t(r))return Promise.resolve(r);let s=null;function n(){s=hn(s)}return new Promise((o,a)=>{s=td([va(i,()=>{n(),a(mi())}),DK(e,l=>{n(),o(l)},{sync:!1,once:!0},t!=null?t:obe)])})}function obe(e){return!0}function abe(e){return!!e}function NBe(e,t,i={}){let r=!1;const s=re(e,(n,o)=>{r||t(n,o)},i);return{remove(){s.remove()},pause(){r=!0},resume(){r=!1}}}const Ui={sync:!0},Et={initial:!0},fi={sync:!0,initial:!0};class xU{constructor(t=i=>i.values().next().value){this._peeker=t,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let t;for(t of this._items);return t}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(t){this.contains(t)||this._items.add(t)}contains(t){return this._items.has(t)}pop(){if(this.length===0)return;const t=this.peek();return this._items.delete(t),t}popLast(){if(this.length===0)return;const t=this.last();return this._items.delete(t),t}remove(t){this._items.delete(t)}filter(t){return this._items.forEach(i=>{t(i)||this._items.delete(i)}),this}}var Nc;(function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"})(Nc||(Nc={}));let FBe=0;function lbe(){return FBe++}function kBe(e){return e&&typeof e=="object"&&("result"in e||"transferList"in e)}function TU(e){return e?typeof e=="string"?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function cbe(e,t,i,r){if(t.type===Nc.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==Nc.INVOKE&&t.type!==Nc.RESPONSE)return void e.postMessage(t);let s;kBe(i)?(s=koe(i.transferList),t.data=i.result):(s=koe(r),t.data=i),s?e.postMessage(t,s):e.postMessage(t)}function U3(e){if(!e)return null;const t=e.data;return t?typeof t=="string"?JSON.parse(t):t:null}function koe(e){if(!e||!e.length)return null;if(ye("esri-workers-arraybuffer-transfer"))return e;const t=e.filter(i=>!UBe(i));return t.length?t:null}function UBe(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}const zBe={statsWorker:()=>import("./statsWorker.05a50e90.js"),geometryEngineWorker:()=>import("./geometryEngineWorker.dcbc4ca5.js"),CSVSourceWorker:()=>import("./CSVSourceWorker.f334f9cc.js"),EdgeProcessingWorker:()=>Promise.resolve().then(function(){return yCt}),ElevationSamplerWorker:()=>import("./ElevationSamplerWorker.2724b627.js"),FeatureServiceSnappingSourceWorker:()=>import("./FeatureServiceSnappingSourceWorker.67d96a20.js"),GeoJSONSourceWorker:()=>import("./GeoJSONSourceWorker.0b6c06ea.js"),LercWorker:()=>import("./LercWorker.cfdd4b3f.js"),MemorySourceWorker:()=>import("./MemorySourceWorker.44f4241c.js"),PBFDecoderWorker:()=>import("./PBFDecoderWorker.f146f483.js"),Pipeline:()=>import("./Pipeline.443f758c.js").then(function(e){return e.P}),PointCloudWorker:()=>import("./PointCloudWorker.4ebb9828.js"),RasterWorker:()=>import("./RasterWorker.7e3c604b.js"),SceneLayerSnappingSourceWorker:()=>import("./SceneLayerSnappingSourceWorker.8d906d84.js"),SceneLayerWorker:()=>import("./SceneLayerWorker.a9a79010.js").then(function(e){return e.S}),WFSSourceWorker:()=>import("./WFSSourceWorker.ed44eda6.js"),WorkerTileHandler:()=>import("./WorkerTileHandler.359540d2.js")},{CLOSE:Uoe,ABORT:zoe,INVOKE:Voe,RESPONSE:qO,OPEN_PORT:Boe,ON:VBe}=Nc,BBe=2;class GBe{constructor(t){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=t,this._timer=null,this._process=this._process.bind(this)}push(t){t.type===Nc.ABORT?this._cancelledJobIds.add(t.jobId):(this._invokeMessages.push(t),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const t of this._invokeMessages)this._cancelledJobIds.has(t.jobId)||this._invoke(t);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class Mu{constructor(t,i,r){this._port=t,this._getNextJob=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new GBe(s=>this._onInvokeMessage(s)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(t){const i=new MessageChannel;let r;r=typeof t=="function"?new t:"default"in t&&typeof t.default=="function"?new t.default:t;const s=new Mu(i.port1,{channel:i,client:r},()=>null);return typeof r=="object"&&"remoteClient"in r&&(r.remoteClient=s),Mu.clients.set(s,r),i.port2}static loadWorker(t){const i=zBe[t];return i?i():Promise.resolve(null)}close(){this._post({type:Uoe}),this._close()}isBusy(){return this._outJobs.size>0}invoke(t,i,r){const s=r&&r.signal,n=r&&r.transferList;if(!this._port)return Promise.reject(new W("worker:port-closed",`Cannot call invoke('${t}'), port is closed`,{methodName:t,data:i}));const o=lbe();return new Promise((a,l)=>{if(an(s))return this._processWork(),void l(mi());const c=va(s,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),hn(p.abortHandle),this._post({type:zoe,jobId:o}),l(mi()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:t};this._outJobs.set(o,h),this._post({type:Voe,jobId:o,methodName:t,abortable:s!=null},i,n)})}on(t,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:Nc.ON,eventType:t,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),{remove(){r.port1.postMessage({type:Nc.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const t=new MessageChannel;return this._post({type:Boe,port:t.port2}),t.port1}_processWork(){if(this._outJobs.size>=BBe)return;const t=this._getNextJob();if(!t)return;const{methodName:i,data:r,invokeOptions:s,deferred:n}=t;this.invoke(i,r,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(t=>{hn(t.abortHandle),t.reject(mi(`Worker closing, aborting job calling '${t.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(t){_(this._schedule)?this._schedule(()=>this._processMessage(t)):this._processMessage(t)}_processMessage(t){const i=U3(t);if(i)switch(i.type){case qO:this._onResponseMessage(i);break;case Voe:this._invokeQueue.push(i);break;case zoe:this._onAbortMessage(i);break;case Uoe:this._onCloseMessage();break;case Boe:this._onOpenPortMessage(i);break;case VBe:this._onOnMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);this._invokeQueue.push(t),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const t=this._client;this._close(),t&&"destroy"in t&&Mu.clients.get(this)===t&&t.destroy(),Mu.clients.delete(this),t&&t.remoteClient&&(t.remoteClient=null)}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[i];try{if(!h&&i&&i.includes(".")){const p=i.split(".");for(let f=0;f<p.length-1;f++)c=c[p[f]],h=c[p[f+1]]}if(typeof h!="function")throw new TypeError(`${i} is not a function`);l=h.call(c,s,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:qO,jobId:r,error:TU(p)})}qu(l)?(a.set(r,{controller:o,promise:l}),l.then(p=>{a.has(r)&&(a.delete(r),this._post({type:qO,jobId:r},p))},p=>{a.has(r)&&(a.delete(r),as(p)||this._post({type:qO,jobId:r,error:TU(p||{message:`Error encountered at method ${i}`})}))})):this._post({type:qO,jobId:r},l)}_onOpenPortMessage(t){new Mu(t.port,{client:this._client},()=>null)}_onOnMessage(t){const{port:i}=t,r=this._client.on(t.eventType,n=>{i.postMessage(n)}),s=jS(t.port,"message",n=>{U3(n).type===Nc.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(t){const{jobId:i,error:r,data:s}=t,n=this._outJobs;if(!n.has(i))return;const o=n.get(i);this._processWork(),n.delete(i),hn(o.abortHandle),r?o.reject(W.fromJSON(JSON.parse(r))):o.resolve(s)}_post(t,i,r){return cbe(this._port,t,i,r)}}Mu.kernelInfo={revision:I1e,version:$1e,buildDate:P1e},Mu.clients=new Map;const jBe=ve.getLogger("esri.core.workers.Connection");class HBe{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new xU}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(t,i){return new Promise((r,s)=>{let n=!0;const o=a=>{qt(i.signal),n&&(n=!1,a())};this._clients.length=t.length,this._clientPromises.length=t.length,this._inUseClients.length=t.length;for(let a=0;a<t.length;++a){const l=t[a];qu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new Mu(c,i,()=>this._ongoingJobsQueue.pop()),o(r),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new Mu(l,i,()=>this._ongoingJobsQueue.pop()),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(t,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a.invoke(t,i,r))}return s}close(){let t;for(;t=this._ongoingJobsQueue.pop();)t.deferred.reject(mi(`Worker closing, aborting job calling '${t.methodName}'`));for(const i of this._clientPromises)i.then(r=>r.close());this._clients.length=0,this._clientPromises.length=0}invoke(t,i,r){let s=null;Array.isArray(r)?(jBe.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:r}):s=r;const n=hv();this._ongoingJobsQueue.push({methodName:t,data:i,invokeOptions:s,deferred:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l.jobAdded())}return n.promise}on(t,i){return Promise.all(this._clientPromises).then(()=>td(this._clients.map(r=>r.on(t,i))))}openPorts(){return new Promise(t=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{i[s]=n.openPort(),--r==0&&t(i)})})}get test(){return{numClients:this._clients.length}}}const qBe=ve.getLogger("esri.assets");function WBe(e,t){return Zt(ji(e),t)}function ji(e){if(!or.assetsPath)throw qBe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new W("assets:path-not-set","config.assetsPath is not set");return Bc(or.assetsPath,e)}const ube=ve.getLogger("esri.intl");function xc(e,t,i={}){const{format:r={}}=i;return Bg(e,s=>ZBe(s,t,r))}function ZBe(e,t,i){let r,s;const n=e.indexOf(":");if(n===-1?r=e.trim():(r=e.slice(0,n).trim(),s=e.slice(n+1).trim()),!r)return"";const o=QM(r,t);if(o==null)return"";const a=i[s]||i[r];return a?XBe(o,a):s?YBe(o,s):NK(o)}function XBe(e,t){switch(t.type){case"date":return Sn(e,t.intlOptions);case"number":return Wl(e,t.intlOptions);default:return ube.warn("missing format descriptor for key {key}"),NK(e)}}function YBe(e,t){switch(t.toLowerCase()){case"dateformat":return Sn(e);case"numberformat":return Wl(e);default:return ube.warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?Sn(e):/^numberformat/i.test(t)?Wl(e):NK(e)}}function NK(e){switch(typeof e){case"string":return e;case"number":return Wl(e);case"boolean":return""+e;default:return e instanceof Date?Sn(e):""}}const Goe=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,JBe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function joe(e){var t;return(t=JBe[e])!=null?t:!1}const RP=[],uA=new Map;function Hoe(e){for(const t of uA.keys())dbe(e.pattern,t)&&uA.delete(t)}function QBe(e){return RP.includes(e)||(Hoe(e),RP.unshift(e)),{remove(){const t=RP.indexOf(e);t>-1&&(RP.splice(t,1),Hoe(e))}}}async function hbe(e){const t=ul();uA.has(e)||uA.set(e,e6e(e,t));const i=uA.get(e);return await t6e.add(i),i}function KBe(e){if(!Goe.test(e))return null;const[,t,i]=Goe.exec(e),r=t+(i?"-"+i.toUpperCase():"");return joe(r)?r:joe(t)?t:null}async function e6e(e,t){const i=[];for(const r of RP)if(dbe(r.pattern,e))try{return await r.fetchMessageBundle(e,t)}catch(s){i.push(s)}throw i.length?new W("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:i}):new W("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}function dbe(e,t){return typeof e=="string"?t.startsWith(e):e.test(t)}nK(()=>{uA.clear()});const t6e=new class{constructor(){this._numLoading=0}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=hv())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function i6e(e,t,i,r){const s=t.exec(i);if(!s)throw new W("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${t}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=KBe(r),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await qoe(e(c))}catch(p){if(c===l)throw new W("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:p});try{h=await qoe(e(l))}catch(f){throw new W("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:f})}}return h}async function qoe(e){if(_(Woe.fetchBundleAsset))return Woe.fetchBundleAsset(e);const t=await Zt(e,{responseType:"text"});return JSON.parse(t.data)}class r6e{constructor({base:t="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,t=t?t.endsWith("/")?t:t+"/":"",this.matcher=new RegExp(`^${t}(?:(.*)/)?(.*)$`)}fetchMessageBundle(t,i){return i6e(this.getAssetUrl,this.matcher,t,i)}}function s6e(e){return new r6e(e)}const Woe={};QBe(s6e({pattern:"esri/",location:ji}));const Zoe={};function n6e(e,t){for(const i of e)if(i.name===t.name)return;e.push(t)}function o6e(e){var i;const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:F({},e.has),map:F({},e.map),packages:e.packages&&e.packages.concat()||[],paths:F({},e.paths)};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=Zoe.baseUrl),(i=Zoe.packages)==null||i.forEach(r=>{n6e(t.packages,r)}),t}class a6e{constructor(){const t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>t[i](...r)})}}class u5{constructor(){this._dispatcher=new a6e,this._workerPostMessage({type:Nc.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(t){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=t,t&&this.addEventListener("message",t)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(t){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=t,t&&this.addEventListener("messageerror",t)}get onerror(){return this._onerrorHandler}set onerror(t){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=t,t&&this.addEventListener("error",t)}postMessage(t){zA(()=>{this._workerMessageHandler(new MessageEvent("message",{data:t}))})}dispatchEvent(t){return this._dispatcher.dispatchEvent(t)}addEventListener(t,i,r){this._dispatcher.addEventListener(t,i,r)}removeEventListener(t,i,r){this._dispatcher.removeEventListener(t,i,r)}_workerPostMessage(t){zA(()=>{this.dispatchEvent(new MessageEvent("message",{data:t}))})}async _workerMessageHandler(t){const i=U3(t);if(i&&i.type===Nc.OPEN){const{modulePath:r,jobId:s}=i;let n=await Mu.loadWorker(r);n||(n=await import(r));const o=Mu.connect(n);this._workerPostMessage({type:Nc.OPENED,jobId:s,data:o})}}}const NW=ve.getLogger("esri.core.workers"),{HANDSHAKE:l6e}=Nc,c6e='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,buildDate:r,version:t}=configuration.kernelInfo,{revision:n,buildDate:i,version:s}=e.kernelInfo;o!==n&&console.warn(`[esri.core.workers] Version mismatch detected between ArcGIS API for JavaScript and assets:\\nAPI version: ${t} [Date: ${r}, Revision: ${o.slice(0,8)}]\nAssets version: ${s} [Date: ${i}, Revision: ${n.slice(0,8)}]`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let e;function t(o){const t=e.connect(o);self.postMessage({type:2,jobId:r,data:t},[t])}"function"==typeof define&&define.amd?require([workerPath],(r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((r=>(e=r.default,checkWorkerRevision(e),e.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),e=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(e),e.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const e=outgoing.get(r);outgoing.delete(r),o.error?e.reject(JSON.parse(o.error)):e.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let ND,FD;const Xoe="Failed to create Worker. Fallback to execute module in main thread";async function u6e(){if(!ye("esri-workers")||(ye("mozilla"),0))return Yoe(new u5);if(!ND&&!FD)try{const t=c6e.replace('"{CONFIGURATION}"',`'${h6e()}'`);ND=URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}catch(t){FD=t||{}}let e;if(ND)try{e=new Worker(ND,{name:"esri-worker-"+d6e++})}catch{NW.warn(Xoe,FD),e=new u5}else NW.warn(Xoe,FD),e=new u5;return Yoe(e)}async function Yoe(e){return new Promise(t=>{function i(s){const n=U3(s);n&&n.type===l6e&&(e.removeEventListener("message",i),e.removeEventListener("error",r),t(e))}function r(s){s.preventDefault(),e.removeEventListener("message",i),e.removeEventListener("error",r),NW.warn("Failed to create Worker. Fallback to execute module in main thread",s),(e=new u5).addEventListener("message",i),e.addEventListener("error",r)}e.addEventListener("message",i),e.addEventListener("error",r)})}function h6e(){let e;if(or.default!=null){const s=F({},or);delete s.default,e=JSON.parse(JSON.stringify(s))}else e=JSON.parse(JSON.stringify(or));e.assetsPath=Wh(e.assetsPath),e.request.interceptors=[],e.log.interceptors=[],e.locale=ul(),e.has={"esri-csp-restrictions":ye("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":ye("esri-2d-update-debug"),"esri-2d-query-centroid-enabled":ye("esri-2d-query-centroid-enabled"),"featurelayer-pbf":ye("featurelayer-pbf"),"featurelayer-simplify-thresholds":ye("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":ye("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":ye("featurelayer-simplify-mobile-factor"),"esri-atomics":ye("esri-atomics"),"esri-shared-array-buffer":ye("esri-shared-array-buffer"),"esri-tiles-debug":ye("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":ye("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":ye("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=Wh(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=Wh(e.workers.workerPath):e.workers.workerPath=Wh(ji("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=or.workers.loaderConfig,i=o6e({baseUrl:t==null?void 0:t.baseUrl,locale:ul(),has:F({"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1},t==null?void 0:t.has),map:F({},t==null?void 0:t.map),paths:F({},t==null?void 0:t.paths),packages:(t==null?void 0:t.packages)||[]}),r={version:$1e,buildDate:P1e,revision:I1e};return JSON.stringify({esriConfig:e,loaderConfig:i,kernelInfo:r})}let d6e=0;const p6e=ve.getLogger("esri.core.workers"),{ABORT:Joe,INVOKE:f6e,OPEN:m6e,OPENED:g6e,RESPONSE:WO}=Nc;class FK{constructor(t,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=t,this.id=i,t.addEventListener("message",this._onMessage.bind(this)),t.addEventListener("error",r=>{r.preventDefault(),p6e.error(r)})}static async create(t){const i=await u6e();return new FK(i,t)}terminate(){this.worker.terminate()}async open(t,i={}){const{signal:r}=i,s=lbe();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:kV(r,()=>{this._outJobs.delete(s),this._post({type:Joe,jobId:s})})};this._outJobs.set(s,a),this._post({type:m6e,jobId:s,modulePath:t})})}_onMessage(t){const i=U3(t);if(i)switch(i.type){case g6e:this._onOpenedMessage(i);break;case WO:this._onResponseMessage(i);break;case Joe:this._onAbortMessage(i);break;case f6e:this._onInvokeMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs,l=HVe[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:WO,jobId:r,error:TU(h)})}qu(c)?(a.set(r,{controller:o,promise:c}),c.then(h=>{a.has(r)&&(a.delete(r),this._post({type:WO,jobId:r},h))},h=>{a.has(r)&&(a.delete(r),h||(h={message:"Error encountered at method"+i}),as(h)||this._post({type:WO,jobId:r,error:TU(h||{message:`Error encountered at method ${i}`})}))})):this._post({type:WO,jobId:r},c)}_onOpenedMessage(t){const{jobId:i,data:r}=t,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),hn(s.abortHandle),s.resolve(r))}_onResponseMessage(t){const{jobId:i,error:r,data:s}=t,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),hn(n.abortHandle),r?n.reject(W.fromJSON(JSON.parse(r))):n.resolve(s))}_post(t,i,r){return cbe(this.worker,t,i,r)}}let wT=ye("esri-workers-debug")?1:ye("host-browser")?navigator.hardwareConcurrency-1:0;wT||(wT=ye("safari")&&ye("mac")||ye("trident")?7:2);let Qoe=0;const h5=[];function y6e(){fbe()}async function kD(e,t){const i=new HBe;return await i.open(e,t),i}async function pbe(e,t={}){if(typeof e!="string")throw new W("workers:undefined-module","modulePath is missing");let i=t.strategy||"distributed";if(ye("host-webworker")&&!ye("esri-workers")&&(i="local"),i==="local"){let r=await Mu.loadWorker(e);r||(r=await import(e)),qt(t.signal);const s=t.client||r;return kD([Mu.connect(r)],me(F({},t),{client:s}))}if(await fbe(),qt(t.signal),i==="dedicated"){const r=Qoe++%wT;return kD([await h5[r].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const r=Math.min(t.maxNumWorkers,wT);if(r<wT){const s=new Array(r);for(let n=0;n<r;++n){const o=Qoe++%wT;s[n]=h5[o].open(e,t)}return kD(s,t)}}return kD(h5.map(r=>r.open(e,t)),t)}let UD=null;async function fbe(){if(UD)return UD;new AbortController;const e=[];for(let t=0;t<wT;t++){const i=FK.create(t).then(r=>(h5[t]=r,r));e.push(i)}return UD=Promise.all(e),UD}let d5=class extends Ee{constructor(e){super(e),this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(t=>{e+=t.length}),e}add(e,t){if(!this._isHandle(e)&&!Array.isArray(e)&&!nt.isCollection(e))return this;const i=this._getOrCreateGroup(t);return Array.isArray(e)||nt.isCollection(e)?e.forEach(r=>this._isHandle(r)&&i.push(r)):i.push(e),this.notifyChange("size"),this}forEach(e,t){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&t&&i.forEach(t)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(Array.isArray(e)||nt.isCollection(e))return e.forEach(this.remove,this),this;if(!this.has(e))return this;const t=this._getGroup(e);for(let i=0;i<t.length;i++)t[i].remove();return this._deleteGroup(e),this.notifyChange("size"),this}removeAll(){return this._groups.forEach(e=>{for(let t=0;t<e.length;t++)e[t].remove()}),this._groups.clear(),this.notifyChange("size"),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const t=[];return this._groups.set(this._ensureGroupKey(e),t),t}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_deleteGroup(e){return this._groups.delete(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}};u([d({readOnly:!0})],d5.prototype,"size",null),d5=u([L("esri.core.Handles")],d5);const Nt=d5;let Lg=class extends Ee{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new Nt,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,t,i={}){return this._installWatch(e,t,i,re)}addWhen(e,t,i={}){return this._installWatch(e,t,i,Jn)}addOnCollectionChange(e,t,{initial:i=!1,final:r=!1}={}){const s=++this.handleId;return this.handles.add([os(e,"after-changes",this._createSyncUpdatingCallback(),Ui),os(e,"change",t,{onListenerAdd:i?n=>t({added:n.toArray(),removed:[]}):void 0,onListenerRemove:r?n=>t({added:[],removed:n.toArray()}):void 0})],s),{remove:()=>this.handles.remove(s)}}addPromise(e){if(M(e))return e;const t=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(this.pendingPromises.size!==0||this.handles.has(zD)||this._set("updating",!1))}},t),this.pendingPromises.add(e),this._set("updating",!0);const i=()=>this.handles.remove(t);return e.then(i,i),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}_installWatch(e,t,i={},r){const s=++this.handleId;i.sync||this._installSyncUpdatingWatch(e,s);const n=r(e,t,i);return this.handles.add(n,s),{remove:()=>this.handles.remove(s)}}_installSyncUpdatingWatch(e,t){const i=this._createSyncUpdatingCallback(),r=re(e,i,{sync:!0,equals:()=>!1});return this.handles.add(r,t),r}_createSyncUpdatingCallback(){return()=>{this.handles.remove(zD),++this.scheduleHandleId;const e=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add(Zb(()=>{e===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(zD))}),zD)}}};u([d({readOnly:!0})],Lg.prototype,"updating",void 0),Lg=u([L("esri.core.support.WatchUpdatingTracking")],Lg);const zD=-42;var Koe;(function(e){e[e.NONE=0]="NONE",e[e.SYNC=1]="SYNC",e[e.INIT=2]="INIT"})(Koe||(Koe={}));const pm=e=>{let t=class extends e{destroy(){var i,r;this.destroyed||((i=this._get("handles"))==null||i.destroy(),(r=this._get("updatingHandles"))==null||r.destroy())}get handles(){return this._get("handles")||new Nt}get updatingHandles(){return this._get("updatingHandles")||new Lg}};return u([d({readOnly:!0})],t.prototype,"handles",null),u([d({readOnly:!0})],t.prototype,"updatingHandles",null),t=u([L("esri.core.HandleOwner")],t),t};let yv=class extends pm(Ee){};yv=u([L("esri.core.HandleOwner")],yv);ve.getLogger("esri.core.support.OwningCollection");let NI=class extends pm(nt){constructor(e){super(e),this.handles.add([this.on("before-add",t=>{M(t.item)&&t.preventDefault()}),this.on("after-add",t=>this._own(t.item)),this.on("after-remove",t=>this._release(t.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(nt.ofType(this.itemType.Type))(e):new nt(e)}};function SU(e,t){return{type:e,cast:R1e,set(i){const r=Mb(i,this._get(t),e);r.owner=this,this._set(t,r)}}}u([d()],NI.prototype,"owner",null),NI=u([L("esri.core.support.OwningCollection")],NI);function kK(e){return new at({wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${e.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`})}const mbe=kK(Qi),EU=kK(Pg),CU=kK(dv),v6e=new at({wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Qi.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`});function Xg(e){return e&&(ay(e)||e===EU)?EU:e&&(ly(e)||e===CU)?CU:mbe}function Ri(e){return e&&(ay(e)||e===EU)?Pg:e&&(ly(e)||e===CU)?dv:Qi}function EFt(e){return jQ(e)?Pg:HQ(e)?dv:Qi}const gbe=39.37,_6e=Qi.radius*Math.PI/200,ybe=/UNIT\[([^\]]+)\]\]$/i,qT=G,vbe=/UNIT\[([^\]]+)\]/i,b6e=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),w6e=ml()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),vm=e=>e*e,e_=e=>e*e*e,z3={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:vm(.001)},"square-centimeters":{inBaseUnits:vm(.01)},"square-decimeters":{inBaseUnits:vm(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:vm(1e3)},"square-inches":{inBaseUnits:vm(.0254)},"square-feet":{inBaseUnits:vm(.3048)},"square-yards":{inBaseUnits:vm(.9144)},"square-miles":{inBaseUnits:vm(1609.344)},"square-us-feet":{inBaseUnits:vm(1200/3937)},acres:{inBaseUnits:.0015625*vm(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*e_(.001)},"cubic-centimeters":{inBaseUnits:1e3*e_(.01)},"cubic-decimeters":{inBaseUnits:1e3*e_(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*e_(1e3)},"cubic-inches":{inBaseUnits:1e3*e_(.0254)},"cubic-feet":{inBaseUnits:1e3*e_(.3048)},"cubic-yards":{inBaseUnits:1e3*e_(.9144)},"cubic-miles":{inBaseUnits:1e3*e_(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},x6e=(()=>{const e={};for(const t in z3)for(const i in z3[t].units)e[i]=t;return e})();function T6e(e,t,i){return e*z3[i].units[t].inBaseUnits}function S6e(e,t,i){return e/z3[i].units[t].inBaseUnits}const AU=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],E6e=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function C6e(e){return e==="imperial"||e==="metric"}function FW(e){const t=x6e[e];if(!t)throw new Error("unknown type");return t}function eae(e,t=null){return t=t||FW(e),z3[t].baseUnit===e}function tr(e,t,i){if(t===i)return e;const r=FW(t);if(r!==FW(i))throw new Error("incompatible units");const s=eae(t,r)?e:T6e(e,t,r);return eae(i,r)?s:S6e(s,i,r)}function A6e(e,t,i){switch(i){case"metric":return UK(e,t);case"imperial":return VK(e,t);default:return i}}function M6e(e,t,i){switch(i){case"metric":return zK(e,t);case"imperial":return BK(e,t);default:return i}}function UK(e,t){const i=tr(e,t,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function zK(e,t){const i=tr(e,t,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function VK(e,t){const i=tr(e,t,"feet");return Math.abs(i)<1e3?"feet":"miles"}function BK(e,t){const i=tr(e,t,"feet");return Math.abs(i)<1e5?"feet":"miles"}function O6e(e,t){const i=tr(e,t,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function R6e(e,t){const i=tr(e,t,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function _be(e,t,i){return tr(e,t,"meters")/(i*Math.PI/180)}function bbe(e){return w6e.fromJSON(e.toLowerCase())||null}function rd(e){if(e&&typeof e=="object"&&!O3(e))return 1;const t=$n(e);return t>1e5?1:t}function wbe(e){return $n(e)>=(e instanceof at?Ri(e).metersPerDegree:1e5)?"meters":mL(e)}function $n(e,t=Qi.metersPerDegree){return Ye(P6e(e,!0),t)}function P6e(e,t=!1){let i,r,s=null;if(e!=null&&(typeof e=="object"?(i=e.wkid,r=e.wkt):typeof e=="number"?i=e:typeof e=="string"&&(r=e)),i){if(jQ(i))return Pg.metersPerDegree;if(HQ(i))return dv.metersPerDegree;s=qT.values[qT[i]],!s&&t&&b6e.has(i)&&(s=_6e)}else r&&(Sbe(r)?s=tae(ybe.exec(r),s):Tbe(r)&&(s=tae(vbe.exec(r),s)));return s}function tae(e,t){return e&&e[1]?xbe(e[1]):t}function xbe(e){return parseFloat(e.split(",")[1])}function mL(e){let t,i,r=null;if(e!=null&&(typeof e=="object"?(t=e.wkid,i=e.wkt):typeof e=="number"?t=e:typeof e=="string"&&(i=e)),t)r=qT.units[qT[t]];else if(i){const s=Sbe(i)?ybe:Tbe(i)?vbe:null;if(s){const n=s.exec(i);n&&n[1]&&(r=$6e(n[1]))}}return _(r)?bbe(r):null}function CFt(e){const t=mL(e);return M(t)||!AU.includes(t)?null:t}function AFt(e){const t=wbe(e);return M(t)||!AU.includes(t)?null:t}function MFt(e){const t=mL(e);return M(t)?null:E6e.get(t)}function Tbe(e){return/^GEOCCS/i.test(e)}function Sbe(e){return/^PROJCS/i.test(e)}const I6e=1e-7;function $6e(e){const t=/[\\"\\']{1}([^\\"\\']+)/.exec(e);let i=t&&t[1];if(!i||!qT.units.includes(i)){const r=xbe(e);i=null;const s=qT.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<I6e){i=qT.units[n];break}}return i}function L6e(e){const t=mL(e);if(M(t))return null;switch(t){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}function D6e(e){var s,n,o;const t="metric";if(M(e))return t;const i=e.map,r=i&&"portalItem"in i?(s=i.portalItem)==null?void 0:s.portal:null;if(r)switch((o=(n=r==null?void 0:r.user)==null?void 0:n.units)!=null?o:r.units){case t:return t;case"english":return"imperial"}return Ye(L6e(e.spatialReference),t)}const Ebe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},Cbe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},N6e=ml()(Ebe),F6e=ml()(Cbe);ml()(F(F({},Ebe),Cbe));var PP;const MU=ml()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),Abe=MU.jsonValues.slice();PV(Abe,"orthometric");const FI=ml()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Qp=PP=class extends Ce{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,i){return MU.write(e,t,i)}readHeightModel(e,t,i){return MU.read(e)||(i&&i.messages&&i.messages.push(k6e(e,{context:i})),null)}readHeightUnit(e,t,i){return FI.read(e)||(i&&i.messages&&i.messages.push(iae(e,{context:i})),null)}readHeightUnitService(e,t,i){return bbe(e)||FI.read(e)||(i&&i.messages&&i.messages.push(iae(e,{context:i})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new PP({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const i=wbe(t);return new PP({heightModel:e.heightModel,heightUnit:i,vertCRS:e.vertCRS})}write(e,t){return t=F({origin:"web-scene"},t),super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new PP;return t.read(e,{origin:"web-scene"}),t}};function iae(e,t){return new Uc("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}function k6e(e,t){return new Uc("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}u([d({type:MU.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:Abe,default:"ellipsoidal"}}}})],Qp.prototype,"heightModel",void 0),u([it("web-scene","heightModel")],Qp.prototype,"writeHeightModel",null),u([De(["web-scene","service"],"heightModel")],Qp.prototype,"readHeightModel",null),u([d({type:FI.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:FI.jsonValues,write:FI.write}}}})],Qp.prototype,"heightUnit",void 0),u([De("web-scene","heightUnit")],Qp.prototype,"readHeightUnit",null),u([De("service","heightUnit")],Qp.prototype,"readHeightUnitService",null),u([d({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Qp.prototype,"vertCRS",void 0),u([De("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Qp.prototype,"readVertCRS",null),Qp=PP=u([L("esri.geometry.HeightModelInfo")],Qp);const e2=Qp;function ln(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function hy(e,t,i,r,s,n,o,a,l,c,h,p,f,m,g,y,x){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=h,e[10]=p,e[11]=f,e[12]=m,e[13]=g,e[14]=y,e[15]=x,e}function Yg(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Gc(e,t){if(e===t){const i=t[1],r=t[2],s=t[3],n=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=n,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Ks(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],g=t[12],y=t[13],x=t[14],b=t[15],S=i*a-r*o,T=i*l-s*o,C=i*c-n*o,A=r*l-s*a,O=r*c-n*a,D=s*c-n*l,U=h*y-p*g,k=h*x-f*g,B=h*b-m*g,j=p*x-f*y,H=p*b-m*y,K=f*b-m*x;let ee=S*K-T*H+C*j+A*B-O*k+D*U;return ee?(ee=1/ee,e[0]=(a*K-l*H+c*j)*ee,e[1]=(s*H-r*K-n*j)*ee,e[2]=(y*D-x*O+b*A)*ee,e[3]=(f*O-p*D-m*A)*ee,e[4]=(l*B-o*K-c*k)*ee,e[5]=(i*K-s*B+n*k)*ee,e[6]=(x*C-g*D-b*T)*ee,e[7]=(h*D-f*C+m*T)*ee,e[8]=(o*H-a*B+c*U)*ee,e[9]=(r*B-i*H-n*U)*ee,e[10]=(g*O-y*C+b*S)*ee,e[11]=(p*C-h*O-m*S)*ee,e[12]=(a*k-o*j-l*U)*ee,e[13]=(i*j-r*k+s*U)*ee,e[14]=(y*T-g*A-x*S)*ee,e[15]=(h*A-p*T+f*S)*ee,e):null}function U6e(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],g=t[12],y=t[13],x=t[14],b=t[15];return e[0]=a*(f*b-m*x)-p*(l*b-c*x)+y*(l*m-c*f),e[1]=-(r*(f*b-m*x)-p*(s*b-n*x)+y*(s*m-n*f)),e[2]=r*(l*b-c*x)-a*(s*b-n*x)+y*(s*c-n*l),e[3]=-(r*(l*m-c*f)-a*(s*m-n*f)+p*(s*c-n*l)),e[4]=-(o*(f*b-m*x)-h*(l*b-c*x)+g*(l*m-c*f)),e[5]=i*(f*b-m*x)-h*(s*b-n*x)+g*(s*m-n*f),e[6]=-(i*(l*b-c*x)-o*(s*b-n*x)+g*(s*c-n*l)),e[7]=i*(l*m-c*f)-o*(s*m-n*f)+h*(s*c-n*l),e[8]=o*(p*b-m*y)-h*(a*b-c*y)+g*(a*m-c*p),e[9]=-(i*(p*b-m*y)-h*(r*b-n*y)+g*(r*m-n*p)),e[10]=i*(a*b-c*y)-o*(r*b-n*y)+g*(r*c-n*a),e[11]=-(i*(a*m-c*p)-o*(r*m-n*p)+h*(r*c-n*a)),e[12]=-(o*(p*x-f*y)-h*(a*x-l*y)+g*(a*f-l*p)),e[13]=i*(p*x-f*y)-h*(r*x-s*y)+g*(r*f-s*p),e[14]=-(i*(a*x-l*y)-o*(r*x-s*y)+g*(r*l-s*a)),e[15]=i*(a*f-l*p)-o*(r*f-s*p)+h*(r*l-s*a),e}function z6e(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],m=e[12],g=e[13],y=e[14],x=e[15];return(t*o-i*n)*(p*x-f*y)-(t*a-r*n)*(h*x-f*g)+(t*l-s*n)*(h*y-p*g)+(i*a-r*o)*(c*x-f*m)-(i*l-s*o)*(c*y-p*m)+(r*l-s*a)*(c*g-h*m)}function As(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=t[9],m=t[10],g=t[11],y=t[12],x=t[13],b=t[14],S=t[15];let T=i[0],C=i[1],A=i[2],O=i[3];return e[0]=T*r+C*a+A*p+O*y,e[1]=T*s+C*l+A*f+O*x,e[2]=T*n+C*c+A*m+O*b,e[3]=T*o+C*h+A*g+O*S,T=i[4],C=i[5],A=i[6],O=i[7],e[4]=T*r+C*a+A*p+O*y,e[5]=T*s+C*l+A*f+O*x,e[6]=T*n+C*c+A*m+O*b,e[7]=T*o+C*h+A*g+O*S,T=i[8],C=i[9],A=i[10],O=i[11],e[8]=T*r+C*a+A*p+O*y,e[9]=T*s+C*l+A*f+O*x,e[10]=T*n+C*c+A*m+O*b,e[11]=T*o+C*h+A*g+O*S,T=i[12],C=i[13],A=i[14],O=i[15],e[12]=T*r+C*a+A*p+O*y,e[13]=T*s+C*l+A*f+O*x,e[14]=T*n+C*c+A*m+O*b,e[15]=T*o+C*h+A*g+O*S,e}function Zl(e,t,i){const r=i[0],s=i[1],n=i[2];if(t===e)e[12]=t[0]*r+t[4]*s+t[8]*n+t[12],e[13]=t[1]*r+t[5]*s+t[9]*n+t[13],e[14]=t[2]*r+t[6]*s+t[10]*n+t[14],e[15]=t[3]*r+t[7]*s+t[11]*n+t[15];else{const o=t[0],a=t[1],l=t[2],c=t[3],h=t[4],p=t[5],f=t[6],m=t[7],g=t[8],y=t[9],x=t[10],b=t[11];e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=h,e[5]=p,e[6]=f,e[7]=m,e[8]=g,e[9]=y,e[10]=x,e[11]=b,e[12]=o*r+h*s+g*n+t[12],e[13]=a*r+p*s+y*n+t[13],e[14]=l*r+f*s+x*n+t[14],e[15]=c*r+m*s+b*n+t[15]}return e}function uB(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Iu(e,t,i,r){let s,n,o,a,l,c,h,p,f,m,g,y,x,b,S,T,C,A,O,D,U,k,B,j,H=r[0],K=r[1],ee=r[2],ce=Math.sqrt(H*H+K*K+ee*ee);return ce<Ut?null:(ce=1/ce,H*=ce,K*=ce,ee*=ce,s=Math.sin(i),n=Math.cos(i),o=1-n,a=t[0],l=t[1],c=t[2],h=t[3],p=t[4],f=t[5],m=t[6],g=t[7],y=t[8],x=t[9],b=t[10],S=t[11],T=H*H*o+n,C=K*H*o+ee*s,A=ee*H*o-K*s,O=H*K*o-ee*s,D=K*K*o+n,U=ee*K*o+H*s,k=H*ee*o+K*s,B=K*ee*o-H*s,j=ee*ee*o+n,e[0]=a*T+p*C+y*A,e[1]=l*T+f*C+x*A,e[2]=c*T+m*C+b*A,e[3]=h*T+g*C+S*A,e[4]=a*O+p*D+y*U,e[5]=l*O+f*D+x*U,e[6]=c*O+m*D+b*U,e[7]=h*O+g*D+S*U,e[8]=a*k+p*B+y*j,e[9]=l*k+f*B+x*j,e[10]=c*k+m*B+b*j,e[11]=h*k+g*B+S*j,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function JA(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*s+c*r,e[5]=o*s+h*r,e[6]=a*s+p*r,e[7]=l*s+f*r,e[8]=c*s-n*r,e[9]=h*s-o*r,e[10]=p*s-a*r,e[11]=f*s-l*r,e}function hB(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],c=t[8],h=t[9],p=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s-c*r,e[1]=o*s-h*r,e[2]=a*s-p*r,e[3]=l*s-f*r,e[8]=n*r+c*s,e[9]=o*r+h*s,e[10]=a*r+p*s,e[11]=l*r+f*s,e}function QA(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],c=t[4],h=t[5],p=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s+c*r,e[1]=o*s+h*r,e[2]=a*s+p*r,e[3]=l*s+f*r,e[4]=c*s-n*r,e[5]=h*s-o*r,e[6]=p*s-a*r,e[7]=f*s-l*r,e}function dB(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function V6e(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function sd(e,t,i){let r,s,n,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<Ut?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(t),s=Math.cos(t),n=1-s,e[0]=o*o*n+s,e[1]=a*o*n+l*r,e[2]=l*o*n-a*r,e[3]=0,e[4]=o*a*n-l*r,e[5]=a*a*n+s,e[6]=l*a*n+o*r,e[7]=0,e[8]=o*l*n+a*r,e[9]=a*l*n-o*r,e[10]=l*l*n+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Mbe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function B6e(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Obe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Rbe(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=r+r,l=s+s,c=n+n,h=r*a,p=r*l,f=r*c,m=s*l,g=s*c,y=n*c,x=o*a,b=o*l,S=o*c;return e[0]=1-(m+y),e[1]=p+S,e[2]=f-b,e[3]=0,e[4]=p-S,e[5]=1-(h+y),e[6]=g+x,e[7]=0,e[8]=f+b,e[9]=g-x,e[10]=1-(h+m),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function G6e(e,t){const i=j6e,r=-t[0],s=-t[1],n=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=r*r+s*s+n*n+o*o;return p>0?(i[0]=2*(a*o+h*r+l*n-c*s)/p,i[1]=2*(l*o+h*s+c*r-a*n)/p,i[2]=2*(c*o+h*n+a*s-l*r)/p):(i[0]=2*(a*o+h*r+l*n-c*s),i[1]=2*(l*o+h*s+c*r-a*n),i[2]=2*(c*o+h*n+a*s-l*r)),Rbe(e,t,i),e}const j6e=$();function H6e(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Pbe(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return e[0]=Math.sqrt(i*i+r*r+s*s),e[1]=Math.sqrt(n*n+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+h*h),e}function q6e(e,t){const i=t[0]+t[5]+t[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function W6e(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3],l=s+s,c=n+n,h=o+o,p=s*l,f=s*c,m=s*h,g=n*c,y=n*h,x=o*h,b=a*l,S=a*c,T=a*h,C=r[0],A=r[1],O=r[2];return e[0]=(1-(g+x))*C,e[1]=(f+T)*C,e[2]=(m-S)*C,e[3]=0,e[4]=(f-T)*A,e[5]=(1-(p+x))*A,e[6]=(y+b)*A,e[7]=0,e[8]=(m+S)*O,e[9]=(y-b)*O,e[10]=(1-(p+g))*O,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Z6e(e,t,i,r,s){const n=t[0],o=t[1],a=t[2],l=t[3],c=n+n,h=o+o,p=a+a,f=n*c,m=n*h,g=n*p,y=o*h,x=o*p,b=a*p,S=l*c,T=l*h,C=l*p,A=r[0],O=r[1],D=r[2],U=s[0],k=s[1],B=s[2],j=(1-(y+b))*A,H=(m+C)*A,K=(g-T)*A,ee=(m-C)*O,ce=(1-(f+b))*O,le=(x+S)*O,z=(g+T)*D,q=(x-S)*D,Z=(1-(f+y))*D;return e[0]=j,e[1]=H,e[2]=K,e[3]=0,e[4]=ee,e[5]=ce,e[6]=le,e[7]=0,e[8]=z,e[9]=q,e[10]=Z,e[11]=0,e[12]=i[0]+U-(j*U+ee*k+z*B),e[13]=i[1]+k-(H*U+ce*k+q*B),e[14]=i[2]+B-(K*U+le*k+Z*B),e[15]=1,e}function X6e(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,p=r*a,f=s*o,m=s*a,g=s*l,y=n*o,x=n*a,b=n*l;return e[0]=1-p-g,e[1]=h+b,e[2]=f-x,e[3]=0,e[4]=h-b,e[5]=1-c-g,e[6]=m+y,e[7]=0,e[8]=f+x,e[9]=m-y,e[10]=1-c-p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ibe(e,t,i,r,s,n,o){const a=1/(i-t),l=1/(s-r),c=1/(n-o);return e[0]=2*n*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(i+t)*a,e[9]=(s+r)*l,e[10]=(o+n)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*c,e[15]=0,e}function Y6e(e,t,i,r,s){const n=1/Math.tan(t/2);let o;return e[0]=n/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(o=1/(r-s),e[10]=(s+r)*o,e[14]=2*s*r*o):(e[10]=-1,e[14]=-2*r),e}function J6e(e,t,i,r){const s=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(s-n)*c*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e}function GK(e,t,i,r,s,n,o){const a=1/(t-i),l=1/(r-s),c=1/(n-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*a,e[13]=(s+r)*l,e[14]=(o+n)*c,e[15]=1,e}function pB(e,t,i,r){let s,n,o,a,l,c,h,p,f,m;const g=t[0],y=t[1],x=t[2],b=r[0],S=r[1],T=r[2],C=i[0],A=i[1],O=i[2];return Math.abs(g-C)<Ut&&Math.abs(y-A)<Ut&&Math.abs(x-O)<Ut?Yg(e):(h=g-C,p=y-A,f=x-O,m=1/Math.sqrt(h*h+p*p+f*f),h*=m,p*=m,f*=m,s=S*f-T*p,n=T*h-b*f,o=b*p-S*h,m=Math.sqrt(s*s+n*n+o*o),m?(m=1/m,s*=m,n*=m,o*=m):(s=0,n=0,o=0),a=p*o-f*n,l=f*s-h*o,c=h*n-p*s,m=Math.sqrt(a*a+l*l+c*c),m?(m=1/m,a*=m,l*=m,c*=m):(a=0,l=0,c=0),e[0]=s,e[1]=a,e[2]=h,e[3]=0,e[4]=n,e[5]=l,e[6]=p,e[7]=0,e[8]=o,e[9]=c,e[10]=f,e[11]=0,e[12]=-(s*g+n*y+o*x),e[13]=-(a*g+l*y+c*x),e[14]=-(h*g+p*y+f*x),e[15]=1,e)}function $be(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=r[0],l=r[1],c=r[2];let h=s-i[0],p=n-i[1],f=o-i[2],m=h*h+p*p+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,p*=m,f*=m);let g=l*f-c*p,y=c*h-a*f,x=a*p-l*h;return m=g*g+y*y+x*x,m>0&&(m=1/Math.sqrt(m),g*=m,y*=m,x*=m),e[0]=g,e[1]=y,e[2]=x,e[3]=0,e[4]=p*x-f*y,e[5]=f*g-h*x,e[6]=h*y-p*g,e[7]=0,e[8]=h,e[9]=p,e[10]=f,e[11]=0,e[12]=s,e[13]=n,e[14]=o,e[15]=1,e}function Q6e(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function K6e(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function e8e(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e}function Lbe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}function t8e(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e}function i8e(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e}function r8e(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Dbe(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],g=e[12],y=e[13],x=e[14],b=e[15],S=t[0],T=t[1],C=t[2],A=t[3],O=t[4],D=t[5],U=t[6],k=t[7],B=t[8],j=t[9],H=t[10],K=t[11],ee=t[12],ce=t[13],le=t[14],z=t[15];return Math.abs(i-S)<=Ut*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(r-T)<=Ut*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(s-C)<=Ut*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(n-A)<=Ut*Math.max(1,Math.abs(n),Math.abs(A))&&Math.abs(o-O)<=Ut*Math.max(1,Math.abs(o),Math.abs(O))&&Math.abs(a-D)<=Ut*Math.max(1,Math.abs(a),Math.abs(D))&&Math.abs(l-U)<=Ut*Math.max(1,Math.abs(l),Math.abs(U))&&Math.abs(c-k)<=Ut*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(h-B)<=Ut*Math.max(1,Math.abs(h),Math.abs(B))&&Math.abs(p-j)<=Ut*Math.max(1,Math.abs(p),Math.abs(j))&&Math.abs(f-H)<=Ut*Math.max(1,Math.abs(f),Math.abs(H))&&Math.abs(m-K)<=Ut*Math.max(1,Math.abs(m),Math.abs(K))&&Math.abs(g-ee)<=Ut*Math.max(1,Math.abs(g),Math.abs(ee))&&Math.abs(y-ce)<=Ut*Math.max(1,Math.abs(y),Math.abs(ce))&&Math.abs(x-le)<=Ut*Math.max(1,Math.abs(x),Math.abs(le))&&Math.abs(b-z)<=Ut*Math.max(1,Math.abs(b),Math.abs(z))}function jK(e){const t=Ut,i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return Math.abs(1-(i*i+n*n+l*l))<=t&&Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}const s8e=As,n8e=Lbe;Object.freeze(Object.defineProperty({__proto__:null,copy:ln,set:hy,identity:Yg,transpose:Gc,invert:Ks,adjoint:U6e,determinant:z6e,multiply:As,translate:Zl,scale:uB,rotate:Iu,rotateX:JA,rotateY:hB,rotateZ:QA,fromTranslation:dB,fromScaling:V6e,fromRotation:sd,fromXRotation:Mbe,fromYRotation:B6e,fromZRotation:Obe,fromRotationTranslation:Rbe,fromQuat2:G6e,getTranslation:H6e,getScaling:Pbe,getRotation:q6e,fromRotationTranslationScale:W6e,fromRotationTranslationScaleOrigin:Z6e,fromQuat:X6e,frustum:Ibe,perspective:Y6e,perspectiveFromFieldOfView:J6e,ortho:GK,lookAt:pB,targetTo:$be,str:Q6e,frob:K6e,add:e8e,subtract:Lbe,multiplyScalar:t8e,multiplyScalarAndAdd:i8e,exactEquals:r8e,equals:Dbe,isOrthoNormal:jK,mul:s8e,sub:n8e},Symbol.toStringTag,{value:"Module"}));let HG,de=null;function Nbe(){return!!de}function o8e(){return!!ye("esri-wasm")}function Fbe(){return HG||(HG=import("./pe-wasm.41ba155b.js").then(e=>e.p).then(({default:e})=>e({locateFile:t=>ji(`esri/geometry/support/${t}`)})).then(e=>{Ube(e)}),HG)}var kW,Ws,UW;(function(e){function t(n,o,a){de.ensureCache.prepare();const l=tT(a),c=a===l,h=de.ensureFloat64(l),p=de._pe_geog_to_proj(de.getPointer(n),o,h);return p&&D1(a,o,h,c),p}function i(n,o,a,l){switch(l){case Ws.PE_TRANSFORM_P_TO_G:return r(n,o,a);case Ws.PE_TRANSFORM_G_TO_P:return t(n,o,a)}return 0}function r(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){de.ensureCache.prepare();const c=tT(a),h=a===c,p=de.ensureFloat64(c),f=de._pe_proj_to_geog_center(de.getPointer(n),o,p,l);return f&&D1(a,o,p,h),f}e.geogToProj=t,e.projGeog=i,e.projToGeog=r,e.projToGeogCenter=s})(kW||(kW={})),function(e){function t(){e.PE_BUFFER_MAX=de.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=de.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=de.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=de.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=de.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=de.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=de.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=de.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=de.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=de.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=de.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=de.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=de.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=de.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=de.PeDefs.prototype.PE_TYPE_UNIT,e.PE_TYPE_LINUNIT=de.PeDefs.prototype.PE_TYPE_LINUNIT,e.PE_STR_OPTS_NONE=de.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=de.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=de.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=de.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=de.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=de.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=de.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=de.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=de.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=de.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=de.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=de.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=de.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=de.PeDefs.prototype.PE_HORIZON_DELTA}e.init=t}(Ws||(Ws={})),function(e){const t={},i={},r=m=>{if(m){const g=m.getType();switch(g){case Ws.PE_TYPE_GEOGCS:m=de.castObject(m,de.PeGeogcs);break;case Ws.PE_TYPE_PROJCS:m=de.castObject(m,de.PeProjcs);break;case Ws.PE_TYPE_GEOGTRAN:m=de.castObject(m,de.PeGeogtran);break;default:g&Ws.PE_TYPE_UNIT&&(m=de.castObject(m,de.PeUnit))}}return m};function s(){de.PeFactory.prototype.initialize(null)}function n(m){return o(Ws.PE_TYPE_COORDSYS,m)}function o(m,g){let y=null,x=t[m];if(x||(x={},t[m]=x),x.hasOwnProperty(String(g)))y=x[g];else{const b=de.PeFactory.prototype.factoryByType(m,g);de.compare(b,de.NULL)||(y=b,x[g]=y)}return y=r(y),y}function a(m,g){let y=null,x=i[m];if(x||(x={},i[m]=x),x.hasOwnProperty(g))y=x[g];else{const b=de.PeFactory.prototype.fromString(m,g);de.compare(b,de.NULL)||(y=b,x[g]=y)}return y=r(y),y}function l(m){return o(Ws.PE_TYPE_GEOGCS,m)}function c(m){return o(Ws.PE_TYPE_GEOGTRAN,m)}function h(m){return de.PeFactory.prototype.getCode(m)}function p(m){return o(Ws.PE_TYPE_PROJCS,m)}function f(m){return o(Ws.PE_TYPE_UNIT,m)}e.initialize=s,e.coordsys=n,e.factoryByType=o,e.fromString=a,e.geogcs=l,e.geogtran=c,e.getCode=h,e.projcs=p,e.unit=f}(UW||(UW={}));let kbe=null;var OU,zW,VW,BW,RU,GW,PU,IU,jW;function Ube(e){function t(n,o,a){n[o]=a(n[o])}de=e,Ws.init(),OU.init(),RU.init(),PU.init(),IU.init(),kbe=class extends de.PeGCSExtent{destroy(){de.destroy(this)}};const i=[de.PeDatum,de.PeGeogcs,de.PeGeogtran,de.PeObject,de.PeParameter,de.PePrimem,de.PeProjcs,de.PeSpheroid,de.PeUnit];for(const n of i)t(n.prototype,"getName",o=>function(){return o.call(this,new Array(Ws.PE_NAME_MAX))});for(const n of[de.PeGeogtran,de.PeProjcs])t(n.prototype,"getParameters",o=>function(){const a=new Array(Ws.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=de.getValue(l,"*");a[c]=h?de.wrapPointer(h,de.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});t(de.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return D1(a,o,n.call(this)),a}),t(de.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=de._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!de.compare(l,de.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=de.getPointer(l);for(let p=1;p<c;p++)a.push(de.wrapPointer(h+o*p,de.PeGTlistExtendedGTs))}}return a}});const r=de._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!de.compare(l,de.NULL)){a=[l];const c=l.getNump();if(c>1){const h=de.getPointer(l);for(let p=1;p<c;p++)a.push(de.wrapPointer(h+r*p,de.PeHorizon))}}return o.set(n,a),a};t(de.PeProjcs.prototype,"horizonGcsGenerate",s),t(de.PeProjcs.prototype,"horizonPcsGenerate",s),de.PeObject.prototype.toString=function(n=Ws.PE_STR_OPTS_NONE){de.ensureCache.prepare();const o=de.getPointer(this),a=de.ensureInt8(new Array(Ws.PE_BUFFER_MAX));return de.UTF8ToString(de._pe_object_to_string_ext(o,n,a))}}function Cy(e){if(!e)return;const t=de.getClass(e);if(!t)return;const i=de.getCache(t);if(!i)return;const r=de.getPointer(e);r&&delete i[r]}function VD(e,t){const i=[],r=new Array(t);for(let s=0;s<e;s++)i.push(de.ensureInt8(r));return i}function tT(e){let t;return Array.isArray(e[0])?(t=[],e.forEach(i=>{t.push(i[0],i[1])})):t=e,t}function D1(e,t,i,r=!1){if(r)for(let s=0;s<2*t;s++)e[s]=de.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=e.length===0;for(let n=0;n<t;n++)s&&(e[n]=new Array(2)),e[n][0]=de.getValue(i,"double"),e[n][1]=de.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(e){let t;function i(){e.PE_GTLIST_OPTS_COMMON=de.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=de._pe_getPeGTlistExtendedEntrySize()}function r(s,n,o,a,l,c){let h=null;const p=new de.PeInteger(c);try{const f=de.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,p);if((c=p.val)&&(h=[f],c>1)){const m=de.getPointer(f);for(let g=1;g<c;g++)h.push(de.wrapPointer(m+t*g,de.PeGTlistExtendedEntry))}}finally{de.destroy(p)}return h}e.init=i,e.getGTlist=r})(OU||(OU={})),function(e){function t(i){if(i&&i.length){for(const r of i)Cy(r),r.getEntries().forEach(s=>{Cy(s);const n=s.getGeogtran();Cy(n),n.getParameters().forEach(Cy),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{Cy(o);const a=o.getDatum();Cy(a),Cy(a.getSpheroid()),Cy(o.getPrimem()),Cy(o.getUnit())})});de.PeGTlistExtendedEntry.prototype.Delete(i[0])}}e.destroy=t}(zW||(zW={})),function(e){function t(i,r,s,n,o){de.ensureCache.prepare();const a=tT(s),l=s===a,c=de.ensureFloat64(a);let h=0;n&&(h=de.ensureFloat64(n));const p=de._pe_geog_to_geog(de.getPointer(i),r,c,h,o);return p&&D1(s,r,c,l),p}e.geogToGeog=t}(VW||(VW={})),function(e){const t=(c,h,p,f,m,g)=>{let y,x;switch(de.ensureCache.prepare(),c){case"dd":y=de._pe_geog_to_dd,x=Ws.PE_DD_MAX;break;case"ddm":y=de._pe_geog_to_ddm,x=Ws.PE_DDM_MAX;break;case"dms":y=de._pe_geog_to_dms,x=Ws.PE_DMS_MAX}let b=0;h&&(b=de.getPointer(h));const S=tT(f),T=de.ensureFloat64(S),C=VD(p,x),A=y(b,p,T,m,de.ensureInt32(C));if(A)for(let O=0;O<p;O++)g[O]=de.UTF8ToString(C[O]);return A},i=(c,h,p,f,m)=>{let g;switch(de.ensureCache.prepare(),c){case"dd":g=de._pe_dd_to_geog;break;case"ddm":g=de._pe_ddm_to_geog;break;case"dms":g=de._pe_dms_to_geog}let y=0;h&&(y=de.getPointer(h));const x=f.map(C=>de.ensureString(C)),b=de.ensureInt32(x),S=de.ensureFloat64(new Array(2*p)),T=g(y,p,b,S);return T&&D1(m,p,S),T};function r(c,h,p,f,m){return t("dms",c,h,p,f,m)}function s(c,h,p,f){return i("dms",c,h,p,f)}function n(c,h,p,f,m){return t("ddm",c,h,p,f,m)}function o(c,h,p,f){return i("ddm",c,h,p,f)}function a(c,h,p,f,m){return t("dd",c,h,p,f,m)}function l(c,h,p,f){return i("dd",c,h,p,f)}e.geogToDms=r,e.dmsToGeog=s,e.geogToDdm=n,e.ddmToGeog=o,e.geogToDd=a,e.ddToGeog=l}(BW||(BW={})),function(e){function t(){e.PE_MGRS_STYLE_NEW=de.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=de.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=de.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=de.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=de.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,n,o,a,l,c,h){de.ensureCache.prepare();let p=0;s&&(p=de.getPointer(s));const f=tT(o),m=de.ensureFloat64(f),g=VD(n,Ws.PE_MGRS_MAX),y=de.ensureInt32(g),x=de._pe_geog_to_mgrs_extended(p,n,m,a,l,c,y);if(x)for(let b=0;b<n;b++)h[b]=de.UTF8ToString(g[b]);return x}function r(s,n,o,a,l){de.ensureCache.prepare();let c=0;s&&(c=de.getPointer(s));const h=o.map(g=>de.ensureString(g)),p=de.ensureInt32(h),f=de.ensureFloat64(new Array(2*n)),m=de._pe_mgrs_to_geog_extended(c,n,p,a,f);return m&&D1(l,n,f),m}e.init=t,e.geogToMgrsExtended=i,e.mgrsToGeogExtended=r}(RU||(RU={})),function(e){function t(r,s,n,o,a,l,c){de.ensureCache.prepare();let h=0;r&&(h=de.getPointer(r));const p=tT(n),f=de.ensureFloat64(p),m=VD(s,Ws.PE_MGRS_MAX),g=de.ensureInt32(m),y=de._pe_geog_to_usng(h,s,f,o,a,l,g);if(y)for(let x=0;x<s;x++)c[x]=de.UTF8ToString(m[x]);return y}function i(r,s,n,o){de.ensureCache.prepare();let a=0;r&&(a=de.getPointer(r));const l=n.map(f=>de.ensureString(f)),c=de.ensureInt32(l),h=de.ensureFloat64(new Array(2*s)),p=de._pe_usng_to_geog(a,s,c,h);return p&&D1(o,s,h),p}e.geogToUsng=t,e.usngToGeog=i}(GW||(GW={})),function(e){function t(){e.PE_UTM_OPTS_NONE=de.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=de.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=de.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,n,o,a,l){de.ensureCache.prepare();let c=0;s&&(c=de.getPointer(s));const h=tT(o),p=de.ensureFloat64(h),f=VD(n,Ws.PE_UTM_MAX),m=de.ensureInt32(f),g=de._pe_geog_to_utm(c,n,p,a,m);if(g)for(let y=0;y<n;y++)l[y]=de.UTF8ToString(f[y]);return g}function r(s,n,o,a,l){de.ensureCache.prepare();let c=0;s&&(c=de.getPointer(s));const h=o.map(g=>de.ensureString(g)),p=de.ensureInt32(h),f=de.ensureFloat64(new Array(2*n)),m=de._pe_utm_to_geog(c,n,p,a,f);return m&&D1(l,n,f),m}e.init=t,e.geogToUtm=i,e.utmToGeog=r}(PU||(PU={})),function(e){const t=new Map;function i(){e.PE_PCSINFO_OPTION_NONE=de.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=de.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=de.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=de.PePCSInfo.prototype.PE_POLE_POINT}function r(s,n=e.PE_PCSINFO_OPTION_DOMAIN){let o,a;return t.has(s)&&(a=t.get(s),a[n]&&(o=a[n])),o||(o=de.PePCSInfo.prototype.generate(s,n),a||(a=[],t.set(s,a)),a[n]=o),o}e.init=i,e.generate=r}(IU||(IU={})),function(e){function t(){return de.PeVersion.prototype.version_string()}e.versionString=t}(jW||(jW={}));const a8e=Object.freeze(Object.defineProperty({__proto__:null,get _pe(){return de},isLoaded:Nbe,isSupported:o8e,load:Fbe,get PeCSTransformations(){return kW},get PeDefs(){return Ws},get PeFactory(){return UW},get PeGCSExtent(){return kbe},get PeGTlistExtended(){return OU},get PeGTlistExtendedEntry(){return zW},get PeGTTransformations(){return VW},get PeNotationDms(){return BW},get PeNotationMgrs(){return RU},get PeNotationUsng(){return GW},get PeNotationUtm(){return PU},get PePCSInfo(){return IU},get PeVersion(){return jW},_init:Ube},Symbol.toStringTag,{value:"Module"})),wu=Math.PI/180,l8e=/SPHEROID\[([^\]]+)]/i,t_=Qi.radius,Fp=Qi.eccentricitySquared,c8e={a1:t_*Fp,a2:t_*Fp*t_*Fp,a3:t_*Fp*Fp/2,a4:t_*Fp*t_*Fp*2.5,a5:t_*Fp+t_*Fp*Fp/2,a6:1-Fp},u8e={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Qi.radius,f:Qi.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:dv.radius,f:dv.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Pg.radius,f:Pg.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Pg.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let BD=0;class hA{constructor(t=null){this.uid=BD++,t?(this._wkt=t.wkt!==void 0?t.wkt:null,this._wkid=t.wkid!==void 0?t.wkid:-1,this._isInverse=t.isInverse!==void 0&&t.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}static fromGE(t){const i=new hA;return i._wkt=t.wkt,i._wkid=t.wkid,i._isInverse=t.isInverse,i}get wkt(){return this._wkt}set wkt(t){this._wkt=t,this.uid=BD++}get wkid(){return this._wkid}set wkid(t){this._wkid=t,this.uid=BD++}get isInverse(){return this._isInverse}set isInverse(t){this._isInverse=t,this.uid=BD++}getInverse(){const t=new hA;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t}}class Z1{constructor(t){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,t&&t.steps)for(const i of t.steps)i instanceof hA?this.steps.push(i):this.steps.push(new hA({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}static cacheKey(t,i){return[t.wkid!==void 0&&t.wkid!==null?t.wkid.toString():"-1",t.wkt!==void 0&&t.wkt!==null?t.wkt.toString():"",i.wkid!==void 0&&i.wkid!==null?i.wkid.toString():"-1",i.wkt!==void 0&&i.wkt!==null?i.wkt.toString():""].join(",")}static fromGE(t){const i=new Z1;let r="";for(const s of t.steps){const n=hA.fromGE(s);i.steps.push(n),r+=n.uid.toString()+","}return i._cached_projection={},i._gtlistentry=null,i._chain=r,i}getInverse(){const t=new Z1;t.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];t.steps.push(r.getInverse())}return t}getGTListEntry(){let t="";for(const i of this.steps)t+=i.uid.toString()+",";return t!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=t),this._gtlistentry}assignCachedGe(t,i,r){this._cached_projection[Z1.cacheKey(t,i)]=r}getCachedGeTransformation(t,i){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=r);const s=this._cached_projection[Z1.cacheKey(t,i)];return s===void 0?null:s}}function zbe(e,t,i){if(M(t)||M(i)||i.vcsWkid||_a(t,i))return null;const r=rd(t)/rd(i);if(r===1)return null;switch(e){case"point":case"esriGeometryPoint":return s=>h8e(s,r);case"polyline":case"esriGeometryPolyline":return s=>p8e(s,r);case"polygon":case"esriGeometryPolygon":return s=>d8e(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>f8e(s,r);case"extent":case"esriGeometryExtent":return s=>m8e(s,r);default:return null}}function h8e(e,t){e&&e.z!=null&&(e.z*=t)}function d8e(e,t){if(e)for(const i of e.rings)for(const r of i)r.length>2&&(r[2]*=t)}function p8e(e,t){if(e)for(const i of e.paths)for(const r of i)r.length>2&&(r[2]*=t)}function f8e(e,t){if(e)for(const i of e.points)i.length>2&&(i[2]*=t)}function m8e(e,t){e&&e.zmin!=null&&e.zmax!=null&&(e.zmin*=t,e.zmax*=t)}let ub=null,$U=null,qG=null,WG={};const Vbe=new x_e;function fB(){return!!ub&&Nbe()}function V3(e){return M(qG)&&(qG=Promise.all([Fbe(),import("./geometryEngineBase.f43341a0.js").then(t=>t.g),import("./hydrated.256778ed.js")])),qG.then(([,t,{hydratedAdapter:i}])=>{qt(e),$U=i,ub=t.default,ub._enableProjection(a8e),Vbe.notify()})}function Tp(e,t,i=null,r=null){return Array.isArray(e)?e.length===0?[]:LU($U,e,e[0].spatialReference,t,i,r):LU($U,[e],e.spatialReference,t,i,r)[0]}function LU(e,t,i,r,s=null,n=null){if(M(i)||M(r))return t;if(Jg(i,r,s))return t.map(o=>Bbe(o,i,r));if(M(s)){const o=Z1.cacheKey(i,r);WG[o]!==void 0?s=WG[o]:(s=g8e(i,r,null),M(s)&&(s=new Z1),WG[o]=s)}if(M(ub))throw new HK;return _(n)?ub._project(e,t,i,r,s,n):ub._project(e,t,i,r,s)}function OFt(e,t){return M(e)?{pending:null,geometry:null}:_a(e.spatialReference,t)?{pending:null,geometry:e}:ja(e.spatialReference)&&ja(t)?Jg(e.spatialReference,t)||fB()?{pending:null,geometry:y8e(e,t)}:(bi(Vbe),{pending:V3(),geometry:null}):{pending:null,geometry:null}}function g8e(e,t,i=null){if(M(ub))throw new HK;if(M(e)||M(t))return null;const r=ub._getTransformation($U,e,t,i,i==null?void 0:i.spatialReference);return r!==null?Z1.fromGE(r):null}class HK extends W{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var ne;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",e[e.WGS84=2]="WGS84",e[e.WEB_MERCATOR=3]="WEB_MERCATOR",e[e.WGS84_ECEF=4]="WGS84_ECEF",e[e.CGCS2000=5]="CGCS2000",e[e.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",e[e.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",e[e.GCSMARS2000=8]="GCSMARS2000",e[e.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",e[e.GCSMOON2000=10]="GCSMOON2000",e[e.LON_LAT=11]="LON_LAT",e[e.PLATE_CARREE=12]="PLATE_CARREE"})(ne||(ne={}));function y8e(e,t){try{const i=Tp(e,t);if(i==null)return null;"xmin"in e&&"xmin"in i&&(i.zmin=e.zmin,i.zmax=e.zmax);const r=zbe(i.type,e.spatialReference,t);return _(r)&&r(i),i}catch(i){if(!(i instanceof HK))throw i;return null}}function Jg(e,t,i){return!i&&(!!_a(e,t)||ja(e)&&ja(t)&&!!XK(e,t,JK))}async function KA(e,t,i,r){if(fB())return Qne(r);if(Array.isArray(e)){for(const{source:s,dest:n,geographicTransformation:o}of e)if(!Jg(s,n,o))return V3(r)}else if(!Jg(e,t,i))return V3(r);return Qne(r)}function RFt(e,t){switch(XK(e,t,JK)){case Br:return"copy3";case Y1:return"wgs84ToSphericalECEF";case pS:return"wgs84ToWebMercator";case X1:return"wgs84ToPlateCarree";case Q1:return"wgs84ToWGS84ECEF";case WT:return"webMercatorToWGS84";case Zbe:return"webMercatorToSphericalECEF";case Xbe:return"webMercatorToWGS84ECEF";case Ybe:return"webMercatorToPlateCarree";case K1:return"wgs84ECEFToWGS84";case Kbe:return"wgs84ECEFToSphericalECEF";case ewe:return"wgs84ECEFToWebMercator";case J1:return"sphericalECEFToWGS84";case Jbe:return"sphericalECEFToWebMercator";case ZW:return"sphericalMarsPCPFToMars2000";case WW:return"sphericalMoonPCPFToMoon2000";case Qbe:return"sphericalECEFToWGS84ECEF";case qW:return"mars2000ToSphericalPCPF";case HW:return"moon2000ToSphericalPCPF";default:return null}}function Bbe(e,t,i){return e?"x"in e?Gbe(e,t,new dt,i,0):"xmin"in e?x8e(e,t,new yi,i,0):"rings"in e?jbe(e,t,new Uo,i,0):"paths"in e?b8e(e,t,new Fa,i,0):"points"in e?_8e(e,t,new Wf,i,0):null:null}function v8e(e,t,i=t.spatialReference,r=0){return!M(i)&&_(Gbe(e,e.spatialReference,t,i,r))}function Gbe(e,t,i,r,s){ir[0]=e.x,ir[1]=e.y;const n=e.z;return ir[2]=n!==void 0?n:s,$r(ir,t,0,ir,r,0,1)?(i.x=ir[0],i.y=ir[1],i.spatialReference=r,n===void 0?(i.z=void 0,i.hasZ=!1):(i.z=ir[2],i.hasZ=!0),e.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=e.m,i.hasM=!0),i):null}function _8e(e,t,i,r,s){const{points:n,hasZ:o,hasM:a}=e,l=[],c=n.length,h=[];for(const p of n)h.push(p[0],p[1],o?p[2]:s);if(!$r(h,t,0,h,r,0,c))return null;for(let p=0;p<c;++p){const f=3*p,m=h[f],g=h[f+1];o&&a?l.push([m,g,h[f+2],n[p][3]]):o?l.push([m,g,h[f+2]]):a?l.push([m,g,n[p][2]]):l.push([m,g])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function b8e(e,t,i,r,s){const{paths:n,hasZ:o,hasM:a}=e,l=[];return qbe(n,o,a,t,l,r,s)?(i.paths=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function PFt({hasZ:e,spatialReference:t,paths:i},r,s=0){const n=Qg(t,oO),o=hp[n][ne.WGS84_COMPARABLE_LON_LAT];if(M(o))return!1;const a=e?l=>l:l=>he(ir,l[0],l[1],s);for(const l of i){const c=[];for(const h of l){const p=[0,0,s];o(a(h),0,p,0),c.push(p)}r.push(c)}return!0}function IFt({hasZ:e,spatialReference:t,rings:i},r,s=0){const n=Qg(t,oO),o=hp[n][ne.WGS84_COMPARABLE_LON_LAT];if(M(o))return!1;const a=e?l=>l:l=>he(ir,l[0],l[1],s);for(const l of i){const c=[];for(const h of l){const p=[0,0,s];o(a(h),0,p,0),c.push(p)}r.push(c)}return!0}function w8e(e,t,i=t.spatialReference,r=0){return _(i)&&_(jbe(e,e.spatialReference,t,i,r))}function jbe(e,t,i,r,s){const{rings:n,hasZ:o,hasM:a}=e,l=[];return qbe(n,o,a,t,l,r,s)?(i.rings=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function x8e(e,t,i,r,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=e;return rae(n,o,c?e.zmin:s,t,ir,r)?(i.xmin=ir[0],i.ymin=ir[1],c&&(i.zmin=ir[2]),rae(a,l,c?e.zmax:s,t,ir,r)?(i.xmax=ir[0],i.ymax=ir[1],c&&(i.zmax=ir[2]),h&&(i.mmin=e.mmin,i.mmax=e.mmax),i.spatialReference=r,i):null):null}function Ob(e,t,i){if(M(t)||M(i))return null;const r=new dt({spatialReference:i});return $r(e,t,0,ir,i,0,1)?(r.x=ir[0],r.y=ir[1],r.z=ir[2],r):null}function Hbe(e,t,i){return $r(e,t,0,ir,i.spatialReference,0,1)?(i.x=ir[0],i.y=ir[1],i.z=ir[2],i):null}function Go(e,t,i,r=0){ir[0]=e.x,ir[1]=e.y;const s=e.z;return ir[2]=s!==void 0?s:r,$r(ir,e.spatialReference,0,t,i,0,1)}function rae(e,t,i,r,s,n){return Ps[0]=e,Ps[1]=t,Ps[2]=i,$r(Ps,r,0,s,n,0,1)}function Zn(e,t,i,r){return!(M(t)||M(r)||e.length<2)&&(e.length===2&&(Ps[0]=e[0],Ps[1]=e[1],Ps[2]=0,e=Ps),$r(e,t,0,i,r,0,1))}function T8e(e,t){ir[0]=e.x,ir[1]=e.y;const i=e.z;return ir[2]=i!==void 0?i:0,S8e(ir,e.spatialReference,t)}function S8e(e,t,i){return E8e(e,t,i)}function E8e(e,t,i){if(M(t))return!1;const r=Qg(t,oO),s=hp[r][ne.WGS84_COMPARABLE_LON_LAT];return!M(s)&&(s(e,0,Ps,0),i!==Ps&&(i[0]=Ps[0],i[1]=Ps[1],i.length>2&&(i[2]=Ps[2])),!0)}function $r(e,t,i,r,s,n,o=1){const a=XK(t,s,JK);if(M(a))return!1;if(a===Br){if(e===r&&i===n)return!0;const c=i+3*o;for(let h=i,p=n;h<c;h++,p++)r[p]=e[h];return!0}const l=i+3*o;for(let c=i,h=n;c<l;c+=3,h+=3)a(e,c,r,h);return!0}function $Ft(e,t,i,r,s){pe(ir,e),we(GD,e,t),Zn(ir,i,ir,s),Zn(GD,i,GD,s),xe(r,GD,ir),Re(r,r)}function qbe(e,t,i,r,s,n,o=0){const a=new Array;for(const c of e)for(const h of c)a.push(h[0],h[1],t?h[2]:o);if(!$r(a,r,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of e){const h=new Array;for(const p of c)t&&i?h.push([a[l++],a[l++],a[l++],p[3]]):t?h.push([a[l++],a[l++],a[l++]]):i?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function C8e(e,t,i,r){if(M(t)||M(r))return!1;const s=twe(t,r,L8e);if(s.projector===Br)return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],!0;if(M(s.projector))return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===ne.WEB_MERCATOR){const a=hp[n.spatialReferenceId][ne.WGS84];return!M(a)&&(a(e,0,bf,0),pS(bf,0,i,0),i[3]=sae(bf[1],e[2],e[3],Qi.radius),!0)}if(n.spatialReferenceId!==ne.WGS84&&n.spatialReferenceId!==ne.CGCS2000||o.spatialReferenceId!==ne.PLATE_CARREE)s.projector(e,0,i,0),i[3]=e[3]*n.metersPerUnit/o.metersPerUnit;else{const a=hp[n.spatialReferenceId][ne.SPHERICAL_ECEF],l=hp[ne.SPHERICAL_ECEF][ne.PLATE_CARREE];let c=e[3];_(a)&&_(l)&&(c=sae(e[1],e[2],e[3],Qi.radius)),s.projector(e,0,i,0),i[3]=c}return!0}function sae(e,t,i,r){const s=r+t;if(s<r/2||i>s)return Number.MAX_VALUE;const n=Math.abs(kf*e)+Math.asin(i/s);return n>=Math.PI/2?Number.MAX_VALUE:i/Math.cos(n)}function mB(e,t,i,r){return e!=null&&(_a(t,r)?(pv(i,e),!0):(Ps[0]=e[0],Ps[1]=e[1],Ps[2]=0,!!$r(Ps,t,0,Ps,r,0,1)&&(i[0]=Ps[0],i[1]=Ps[1],Ps[0]=e[2],Ps[1]=e[3],Ps[2]=0,!!$r(Ps,t,0,Ps,r,0,1)&&(i[2]=Ps[0],i[3]=Ps[1],!0))))}function LFt(e,t,i,r){if(M(t)||M(r))return!1;const s=Qg(t,oO),n=Qg(r,iwe);if(s===n&&s!==ne.UNKNOWN||_a(t,r))return i[0]=1,i[1]=1,i[2]=1,!0;if(s===ne.SPHERICAL_ECEF){const o=Ue(e),a=o/Math.sqrt(e[0]*e[0]+e[1]*e[1]),l=o/Qi.radius;if(n===ne.WEB_MERCATOR)return i[0]=a*l,i[1]=a*l,i[2]=1,!0;if(n===ne.WGS84||n===ne.CGCS2000){const c=kI;return i[0]=c*a*l,i[1]=c*l,i[2]=1,!0}}else if(s===ne.PLATE_CARREE){if(n===ne.WGS84||n===ne.CGCS2000)return i[0]=kI,i[1]=kI,i[2]=1,!0;if(n===ne.WEB_MERCATOR){const o=e[1]/Qi.radius;return i[0]=1,i[1]=1/Math.cos(o),i[2]=1,!0}}return!1}function nd(e,t,i,r){if(M(e)||M(r))return!1;const s=Qg(e,oO),n=Qg(r,iwe);if(s===n&&!nae(n)&&(s!==ne.UNKNOWN||_a(e,r)))return dB(i,t),!0;if(nae(n)){const o=hp[s][ne.LON_LAT],a=hp[ne.LON_LAT][n];return!M(o)&&!M(a)&&(o(t,0,bf,0),a(bf,0,i_,0),Wbe(kf*bf[0],kf*bf[1],i),i[12]=i_[0],i[13]=i_[1],i[14]=i_[2],!0)}if((n===ne.WEB_MERCATOR||n===ne.PLATE_CARREE)&&(s===ne.WGS84||s===ne.CGCS2000&&n===ne.PLATE_CARREE||s===ne.SPHERICAL_ECEF||s===ne.WEB_MERCATOR)){const o=hp[s][ne.LON_LAT],a=hp[ne.LON_LAT][n];return!M(o)&&!M(a)&&(o(t,0,bf,0),a(bf,0,i_,0),s===ne.SPHERICAL_ECEF?A8e(kf*bf[0],kf*bf[1],i):Yg(i),i[12]=i_[0],i[13]=i_[1],i[14]=i_[2],!0)}return!1}function nae(e){return e===ne.SPHERICAL_ECEF||e===ne.SPHERICAL_MARS_PCPF||e===ne.SPHERICAL_MOON_PCPF}function Wbe(e,t,i){const r=Math.sin(e),s=Math.cos(e),n=Math.sin(t),o=Math.cos(t),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function A8e(e,t,i){return Wbe(e,t,i),Gc(i,i),i}function Qg(e,t){return t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=$n(e,1)),e.wkt===mbe.wkt?t.spatialReferenceId=ne.SPHERICAL_ECEF:R3(e)?t.spatialReferenceId=ne.WGS84:Gg(e)?t.spatialReferenceId=ne.WEB_MERCATOR:P3(e)?t.spatialReferenceId=ne.PLATE_CARREE:e.wkt===v6e.wkt?t.spatialReferenceId=ne.WGS84_ECEF:e.wkid===ap.CGCS2000?t.spatialReferenceId=ne.CGCS2000:e.wkt===EU.wkt?t.spatialReferenceId=ne.SPHERICAL_MARS_PCPF:e.wkt===CU.wkt?t.spatialReferenceId=ne.SPHERICAL_MOON_PCPF:ay(e)?t.spatialReferenceId=ne.GCSMARS2000:ly(e)?t.spatialReferenceId=ne.GCSMOON2000:t.spatialReferenceId=ne.UNKNOWN)}function Br(e,t,i,r){e!==i&&(i[r++]=e[t++],i[r++]=e[t++],i[r]=e[t])}function WT(e,t,i,r){i[r++]=eM*(e[t++]/Qi.radius),i[r++]=eM*(Math.PI/2-2*Math.atan(Math.exp(-e[t++]/Qi.radius))),i[r]=e[t]}function Zbe(e,t,i,r){WT(e,t,i,r),Y1(i,r,i,r)}function Xbe(e,t,i,r){WT(e,t,i,r),Q1(i,r,i,r)}function qK(e,t,i,r,s){const n=.4999999*Math.PI,o=He(kf*e[t+1],-n,n),a=Math.sin(o);i[r++]=kf*e[t]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=e[t+2]}function pS(e,t,i,r){qK(e,t,i,r,Qi)}const oae=Qi.radius*Math.PI/180,kI=180/(Qi.radius*Math.PI);function X1(e,t,i,r){i[r]=e[t]*oae,i[r+1]=e[t+1]*oae,i[r+2]=e[t+2]}function xT(e,t,i,r){i[r]=e[t]*kI,i[r+1]=e[t+1]*kI,i[r+2]=e[t+2]}function Ybe(e,t,i,r){WT(e,t,i,r),X1(i,r,i,r)}function M8e(e,t,i,r){K1(e,t,i,r),X1(i,r,i,r)}function O8e(e,t,i,r){J1(e,t,i,r),X1(i,r,i,r)}function R8e(e,t,i,r){xT(e,t,i,r),Y1(i,r,i,r)}function P8e(e,t,i,r){xT(e,t,i,r),pS(i,r,i,r)}function I8e(e,t,i,r){xT(e,t,i,r),Q1(i,r,i,r)}function fS(e){if(M(e))return!1;const t=Qg(e,oO);return!!hp[t][ne.WGS84_COMPARABLE_LON_LAT]}function ZO(e,t,i,r){const s=Math.cos(i);e[0]=Math.cos(t)*s*r,e[1]=Math.sin(t)*s*r,e[2]=Math.sin(i)*r}function WK(e,t,i,r,s){const n=s+e[t+2],o=kf*e[t+1],a=kf*e[t],l=Math.cos(o);i[r++]=Math.cos(a)*l*n,i[r++]=Math.sin(a)*l*n,i[r]=Math.sin(o)*n}function HW(e,t,i,r){WK(e,t,i,r,dv.radius)}function qW(e,t,i,r){WK(e,t,i,r,Pg.radius)}function Y1(e,t,i,r){WK(e,t,i,r,Qi.radius)}function ZK(e,t,i,r,s){const n=e[t],o=e[t+1],a=e[t+2],l=Math.sqrt(n*n+o*o+a*a),c=tm(a/(l===0?1:l)),h=Math.atan2(o,n);i[r++]=eM*h,i[r++]=eM*c,i[r]=l-s}function WW(e,t,i,r){ZK(e,t,i,r,dv.radius)}function ZW(e,t,i,r){ZK(e,t,i,r,Pg.radius)}function J1(e,t,i,r){ZK(e,t,i,r,Qi.radius)}function Jbe(e,t,i,r){J1(e,t,i,r),pS(i,r,i,r)}function Qbe(e,t,i,r){J1(e,t,i,r),Q1(i,r,i,r)}function $8e(e,t,i,r,s){const n=kf*e[t],o=kf*e[t+1],a=e[t+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(h+a)*c*Math.cos(n),i[r++]=(h+a)*c*Math.sin(n),i[r++]=(h*(1-s.eccentricitySquared)+a)*l}function Q1(e,t,i,r){$8e(e,t,i,r,Qi)}function K1(e,t,i,r){const s=c8e,n=e[t],o=e[t+1],a=e[t+2];let l,c,h,p,f,m,g,y,x,b,S,T,C,A,O,D,U,k,B,j,H;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),p=c+a*a,f=Math.sqrt(p),j=Math.atan2(o,n),m=a*a/p,g=c/p,A=s.a2/f,O=s.a3-s.a4/f,g>.3?(y=l/f*(1+g*(s.a1+A+m*O)/f),B=Math.asin(y),b=y*y,x=Math.sqrt(1-b)):(x=h/f*(1-m*(s.a5-A-g*O)/f),B=Math.acos(x),b=1-x*x,y=Math.sqrt(b)),S=1-Qi.eccentricitySquared*b,T=Qi.radius/Math.sqrt(S),C=s.a6*T,A=h-T*x,O=l-C*y,U=x*A+y*O,D=x*O-y*A,k=D/(C/S+U),B+=k,H=U+D*k/2,a<0&&(B=-B),i[r++]=eM*j,i[r++]=eM*B,i[r]=H}function Kbe(e,t,i,r){K1(e,t,i,r),Y1(i,r,i,r)}function ewe(e,t,i,r){K1(e,t,i,r),pS(i,r,i,r)}const hp={[ne.WGS84]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:Br,[ne.WGS84_COMPARABLE_LON_LAT]:Br,[ne.SPHERICAL_ECEF]:Y1,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:pS,[ne.PLATE_CARREE]:X1,[ne.WGS84]:Br,[ne.WGS84_ECEF]:Q1},[ne.CGCS2000]:{[ne.CGCS2000]:Br,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:Br,[ne.WGS84_COMPARABLE_LON_LAT]:Br,[ne.SPHERICAL_ECEF]:Y1,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:X1,[ne.WGS84]:null,[ne.WGS84_ECEF]:Q1},[ne.GCSMARS2000]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:Br,[ne.GCSMOON2000]:null,[ne.LON_LAT]:Br,[ne.WGS84_COMPARABLE_LON_LAT]:null,[ne.SPHERICAL_ECEF]:null,[ne.SPHERICAL_MARS_PCPF]:qW,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:null,[ne.WGS84]:null,[ne.WGS84_ECEF]:null},[ne.GCSMOON2000]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:Br,[ne.LON_LAT]:Br,[ne.WGS84_COMPARABLE_LON_LAT]:null,[ne.SPHERICAL_ECEF]:null,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:HW,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:null,[ne.WGS84]:null,[ne.WGS84_ECEF]:null},[ne.WEB_MERCATOR]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:WT,[ne.WGS84_COMPARABLE_LON_LAT]:WT,[ne.SPHERICAL_ECEF]:Zbe,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:Br,[ne.PLATE_CARREE]:Ybe,[ne.WGS84]:WT,[ne.WGS84_ECEF]:Xbe},[ne.WGS84_ECEF]:{[ne.CGCS2000]:K1,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:K1,[ne.WGS84_COMPARABLE_LON_LAT]:K1,[ne.SPHERICAL_ECEF]:Kbe,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:ewe,[ne.PLATE_CARREE]:M8e,[ne.WGS84]:K1,[ne.WGS84_ECEF]:Br},[ne.SPHERICAL_ECEF]:{[ne.CGCS2000]:J1,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:J1,[ne.WGS84_COMPARABLE_LON_LAT]:J1,[ne.SPHERICAL_ECEF]:Br,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:Jbe,[ne.PLATE_CARREE]:O8e,[ne.WGS84]:J1,[ne.WGS84_ECEF]:Qbe},[ne.SPHERICAL_MARS_PCPF]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:ZW,[ne.GCSMOON2000]:null,[ne.LON_LAT]:ZW,[ne.WGS84_COMPARABLE_LON_LAT]:null,[ne.SPHERICAL_ECEF]:null,[ne.SPHERICAL_MARS_PCPF]:Br,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:null,[ne.WGS84]:null,[ne.WGS84_ECEF]:null},[ne.SPHERICAL_MOON_PCPF]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:WW,[ne.LON_LAT]:WW,[ne.WGS84_COMPARABLE_LON_LAT]:null,[ne.SPHERICAL_ECEF]:null,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:Br,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:null,[ne.WGS84]:null,[ne.WGS84_ECEF]:null},[ne.UNKNOWN]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:null,[ne.WGS84_COMPARABLE_LON_LAT]:null,[ne.SPHERICAL_ECEF]:null,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:Br,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:null,[ne.WGS84]:null,[ne.WGS84_ECEF]:null},[ne.LON_LAT]:{[ne.CGCS2000]:Br,[ne.GCSMARS2000]:Br,[ne.GCSMOON2000]:Br,[ne.LON_LAT]:Br,[ne.WGS84_COMPARABLE_LON_LAT]:Br,[ne.SPHERICAL_ECEF]:Y1,[ne.SPHERICAL_MARS_PCPF]:qW,[ne.SPHERICAL_MOON_PCPF]:HW,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:pS,[ne.PLATE_CARREE]:X1,[ne.WGS84]:Br,[ne.WGS84_ECEF]:Q1},[ne.WGS84_COMPARABLE_LON_LAT]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:Br,[ne.WGS84_COMPARABLE_LON_LAT]:Br,[ne.SPHERICAL_ECEF]:Y1,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:X1,[ne.WGS84]:Br,[ne.WGS84_ECEF]:Q1},[ne.PLATE_CARREE]:{[ne.CGCS2000]:xT,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:xT,[ne.WGS84_COMPARABLE_LON_LAT]:xT,[ne.SPHERICAL_ECEF]:R8e,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:P8e,[ne.PLATE_CARREE]:Br,[ne.WGS84]:xT,[ne.WGS84_ECEF]:I8e}};function XK(e,t,i=YK()){return M(e)||M(t)?null:twe(e,t,i).projector}function twe(e,t,i){if(M(e)||M(t)||i.source.spatialReference===e&&i.dest.spatialReference===t)return i;const r=Qg(e,i.source),s=Qg(t,i.dest);return r===ne.UNKNOWN&&s===ne.UNKNOWN?_a(e,t)?i.projector=Br:i.projector=null:i.projector=hp[r][s],i}function YK(){return{source:{spatialReference:null,spatialReferenceId:ne.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:ne.UNKNOWN,metersPerUnit:1},projector:Br}}const oO={spatialReference:null,spatialReferenceId:ne.UNKNOWN},iwe={spatialReference:null,spatialReferenceId:ne.UNKNOWN},JK=YK(),L8e=YK(),kf=Yt(1),eM=Vu(1),Ps=$(),bf=$(),i_=$(),ir=$(),GD=$();class $v{constructor(t){this.allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&zA(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*aae);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,aae));t++)this._items.push(this.allocator())}}const aae=1024;function Ne(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ZT(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function QK(e,t,i,r,s,n,o,a,l,c,h,p,f,m,g,y){return[e,t,i,r,s,n,o,a,l,c,h,p,f,m,g,y]}function rwe(e,t){return new Float64Array(e,t,16)}const Xn=Ne();Object.freeze(Object.defineProperty({__proto__:null,create:Ne,clone:ZT,fromValues:QK,createView:rwe,IDENTITY:Xn},Symbol.toStringTag,{value:"Module"}));var Jh;(function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"})(Jh||(Jh={}));function D8e(e){return 32+e.length}function N8e(){return 16}function swe(e){if(!e)return 0;let t=32;for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];switch(typeof r){case"string":t+=D8e(r);break;case"number":t+=N8e();break;case"boolean":t+=4}}return t}function DFt(e,t){return 32+e.length*t}var Rb;(function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"})(Rb||(Rb={}));function ls(){return[1,0,0,0,1,0,0,0,1]}function F8e(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function k8e(e,t,i,r,s,n,o,a,l){return[e,t,i,r,s,n,o,a,l]}function nwe(e,t){return new Float64Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:ls,clone:F8e,fromValues:k8e,createView:nwe},Symbol.toStringTag,{value:"Module"}));function Lv(){return[0,0,0,1]}function U8e(e){return[e[0],e[1],e[2],e[3]]}function z8e(e,t,i,r){return[e,t,i,r]}function owe(e,t){return new Float64Array(e,t,4)}const V8e=Lv();Object.freeze(Object.defineProperty({__proto__:null,create:Lv,clone:U8e,fromValues:z8e,createView:owe,IDENTITY:V8e},Symbol.toStringTag,{value:"Module"}));function Ke(){return[0,0]}function TT(e){return[e[0],e[1]]}function er(e,t){return[e,t]}function awe(e){const t=Ke(),i=Math.min(2,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function lwe(e,t){return new Float64Array(e,t,2)}function cwe(){return Ke()}function uwe(){return er(1,1)}function hwe(){return er(1,0)}function dwe(){return er(0,1)}const Sp=cwe(),pwe=uwe(),B8e=hwe(),G8e=dwe();Object.freeze(Object.defineProperty({__proto__:null,create:Ke,clone:TT,fromValues:er,fromArray:awe,createView:lwe,zeros:cwe,ones:uwe,unitX:hwe,unitY:dwe,ZEROS:Sp,ONES:pwe,UNIT_X:B8e,UNIT_Y:G8e},Symbol.toStringTag,{value:"Module"}));function si(){return[0,0,0,0]}function gB(e){return[e[0],e[1],e[2],e[3]]}function zi(e,t,i,r){return[e,t,i,r]}function yB(e){const t=si(),i=Math.min(4,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function fwe(e,t){return new Float64Array(e,t,4)}function mwe(){return si()}function gwe(){return zi(1,1,1,1)}function ywe(){return zi(1,0,0,0)}function vwe(){return zi(0,1,0,0)}function _we(){return zi(0,0,1,0)}function bwe(){return zi(0,0,0,1)}const Dg=mwe(),lp=gwe(),j8e=ywe(),H8e=vwe(),q8e=_we(),W8e=bwe();Object.freeze(Object.defineProperty({__proto__:null,create:si,clone:gB,fromValues:zi,fromArray:yB,createView:fwe,zeros:mwe,ones:gwe,unitX:ywe,unitY:vwe,unitZ:_we,unitW:bwe,ZEROS:Dg,ONES:lp,UNIT_X:j8e,UNIT_Y:H8e,UNIT_Z:q8e,UNIT_W:W8e},Symbol.toStringTag,{value:"Module"}));class Fh{constructor(t,i,r){this.itemByteSize=t,this.itemCreate=i,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(r/this.itemByteSize)}get(){this._itemsPtr===0&&zA(()=>this._reset());const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const i=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let r=0;r<this._itemsPerBuffer;++r)this._items.push(this.itemCreate(i,r*this.itemByteSize));this._buffers.push(i)}return this._items[this._itemsPtr++]}_reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=S2){return new Fh(16,lwe,t)}static createVec3f64(t=S2){return new Fh(24,_Q,t)}static createVec4f64(t=S2){return new Fh(32,fwe,t)}static createMat3f64(t=S2){return new Fh(72,nwe,t)}static createMat4f64(t=S2){return new Fh(128,rwe,t)}static createQuatf64(t=S2){return new Fh(32,owe,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}const S2=4*Rb.KILOBYTES,NFt=Fh.createVec2f64(),Je=Fh.createVec3f64(),KK=Fh.createVec4f64();Fh.createMat3f64();const eee=Fh.createMat4f64(),FFt=Fh.createQuatf64();function dy(e){return e?{origin:Rn(e.origin),vector:Rn(e.vector)}:{origin:$(),vector:$()}}function Z8e(e,t){const i=Y8e.get();return i.origin=e,i.vector=t,i}function kFt(e,t=dy()){return X8e(e.origin,e.vector,t)}function X8e(e,t,i=dy()){return pe(i.origin,e),pe(i.vector,t),i}function XT(e,t,i=dy()){return pe(i.origin,e),xe(i.vector,t,e),i}function tee(e,t){const i=xe(Je.get(),t,e.origin),r=Pe(e.vector,i),s=Pe(e.vector,e.vector),n=He(r/s,0,1),o=xe(Je.get(),fe(Je.get(),e.vector,n),i);return Pe(o,o)}function UFt(e,t,i){return XW(e,t,0,1,i)}function zFt(e,t,i){return we(i,e.origin,fe(i,e.vector,t))}function XW(e,t,i,r,s){const{vector:n,origin:o}=e,a=xe(Je.get(),t,o),l=Pe(n,a)/Vl(n);return fe(s,n,He(l,i,r)),we(s,s,e.origin)}function VFt(e,t){if(xwe(e,Z8e(t.origin,t.direction),!1,DU)){const{tA:i,pB:r,distance2:s}=DU;if(i>=0&&i<=1)return s;if(i<0)return uo(e.origin,r);if(i>1)return uo(we(Je.get(),e.origin,e.vector),r)}return null}function wwe(e,t,i){return!!xwe(e,t,!0,DU)&&(pe(i,DU.pA),!0)}function xwe(e,t,i,r){const n=e.origin,o=we(Je.get(),n,e.vector),a=t.origin,l=we(Je.get(),a,t.vector),c=Je.get(),h=Je.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=Je.get();if(p[0]=o[0]-n[0],p[1]=o[1]-n[1],p[2]=o[2]-n[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],g=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],y=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],x=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*y-m*m;if(Math.abs(x)<1e-6)return!1;let b=(f*m-g*y)/x,S=(f+m*b)/y;i&&(b=He(b,0,1),S=He(S,0,1));const T=Je.get(),C=Je.get();return T[0]=n[0]+b*p[0],T[1]=n[1]+b*p[1],T[2]=n[2]+b*p[2],C[0]=a[0]+S*h[0],C[1]=a[1]+S*h[1],C[2]=a[2]+S*h[2],r.tA=b,r.tB=S,r.pA=T,r.pB=C,r.distance2=uo(T,C),!0}const DU={tA:0,tB:0,pA:$(),pB:$(),distance2:0},Y8e=new $v(()=>({origin:null,vector:null}));function Do(e){return e?{origin:Rn(e.origin),direction:Rn(e.direction)}:{origin:$(),direction:$()}}function BFt(e,t){return wb(e.origin,t.origin)&&wb(e.direction,t.direction)}function od(e,t){const i=eGe.get();return i.origin=e,i.direction=t,i}function NU(e,t=Do()){return Swe(e.origin,e.direction,t)}function Twe(e,t,i=Do()){return pe(i.origin,e),xe(i.direction,t,e),i}function Swe(e,t,i=Do()){return pe(i.origin,e),pe(i.direction,t),i}function J8e(e,t){const i=Tt(Je.get(),Re(Je.get(),e.direction),xe(Je.get(),t,e.origin));return Pe(i,i)}function Q8e(e,t,i){const r=Pe(e.direction,xe(i,t,e.origin));return we(i,e.origin,fe(i,e.direction,r)),i}function K8e(){return{origin:null,direction:null}}const eGe=new $v(K8e);function GFt(e,t,i){const r=Pe(e,t)/Pe(e,e);return fe(i,e,r)}function hb(e,t){return Pe(e,t)/Ue(e)}function iee(e,t){const i=Pe(e,t)/(Ue(e)*Ue(t));return-Yn(i)}function tGe(e,t,i){Re(jD,e),Re(ZG,t);const r=Pe(jD,ZG),s=Yn(r),n=Tt(jD,jD,ZG);return Pe(n,i)<0?2*Math.PI-s:s}const jD=$(),ZG=$(),iGe=ve.getLogger("esri.geometry.support.sphere");function fo(){return si()}function tM(e,t=fo()){return Lf(t,e)}function Ewe(e,t){return zi(e[0],e[1],e[2],t)}function rGe(e){return e}function Cwe(e){e[0]=e[1]=e[2]=e[3]=0}function vB(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function Y0(e){return e[3]}function sGe(e){return e}function Awe(e,t,i,r){return zi(e,t,i,r)}function nGe(e,t,i){return e!==i&&pe(i,e),i[3]=e[3]+t,i}function oGe(e,t,i){return iGe.error("sphere.setExtent is not yet supported"),e===i?i:tM(e,i)}function Yb(e,t,i){if(M(t))return!1;const{origin:r,direction:s}=t,n=aGe;n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2],a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(h<0||p<h&&p>0)&&(h=p),!(h<0)&&(i&&(i[0]=r[0]+s[0]*h,i[1]=r[1]+s[1]*h,i[2]=r[2]+s[2]*h),!0)}const aGe=$();function YW(e,t){return Yb(e,t,null)}function lGe(e,t,i){if(Yb(e,t,i))return i;const r=aO(e,t,Je.get());return we(i,t.origin,fe(Je.get(),t.direction,Pr(t.origin,r)/Ue(t.direction))),i}function aO(e,t,i){const r=Je.get(),s=eee.get();Tt(r,t.origin,t.direction);const n=Y0(e);Tt(i,r,t.origin),fe(i,i,1/Ue(i)*n);const o=Rwe(e,t.origin),a=iee(t.origin,i);return sd(s,a+o,r),Xe(i,i,s),i}function cGe(e,t,i){return Yb(e,t,i)?i:(Q8e(t,e,i),Mwe(e,i,i))}function Mwe(e,t,i){const r=xe(Je.get(),t,e),s=fe(Je.get(),r,e[3]/Ue(r));return we(i,s,e)}function Owe(e,t){const i=xe(Je.get(),t,e),r=Vl(i),s=e[3]*e[3];return Math.sqrt(Math.abs(r-s))}function Rwe(e,t){const i=xe(Je.get(),t,e),r=Ue(i),s=Y0(e),n=s+Math.abs(s-r);return Yn(s/n)}const XG=$();function Pwe(e,t,i,r){const s=xe(XG,t,e);switch(i){case Jh.X:{const n=Fne(s,XG)[2];return he(r,-Math.sin(n),Math.cos(n),0)}case Jh.Y:{const n=Fne(s,XG),o=n[1],a=n[2],l=Math.sin(o);return he(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Jh.Z:return Re(r,s);default:return}}function Iwe(e,t){const i=xe(JW,t,e);return Ue(i)-e[3]}function uGe(e,t,i,r){const s=Iwe(e,t),n=Pwe(e,t,Jh.Z,JW),o=fe(JW,n,i-s);return we(r,t,o)}function hGe(e,t){const i=uo(e,t),r=Y0(e);return i<=r*r}const JW=$(),_B=fo(),dGe=Object.freeze(Object.defineProperty({__proto__:null,create:fo,copy:tM,fromCenterAndRadius:Ewe,wrap:rGe,clear:Cwe,fromRadius:vB,getRadius:Y0,getCenter:sGe,fromValues:Awe,elevate:nGe,setExtent:oGe,intersectRay:Yb,intersectsRay:YW,intersectRayClosestSilhouette:lGe,closestPointOnSilhouette:aO,closestPoint:cGe,projectPoint:Mwe,distanceToSilhouette:Owe,angleToSilhouette:Rwe,axisAt:Pwe,altitudeAt:Iwe,setAltitudeAt:uGe,containsPoint:hGe,tmpSphere:_B},Symbol.toStringTag,{value:"Module"}));function mS(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],i=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],r=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}function pGe(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),r=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return he(e,i,r,s),e}function jFt(e,t,i){i=i||e;const r=Pe(e,t);he(i,e[0]-r*t[0],e[1]-r*t[1],e[2]-r*t[2]),Re(i,i)}function fGe(e,t,i){Math.abs(e[0])>Math.abs(e[1])?he(t,0,1,0):he(t,1,0,0),Tt(i,e,t),Re(t,t),Tt(t,i,e),Re(i,i)}function HD(e,t,i,r,s,n){const o=e+(t-e)*s;return o+(i+(r-i)*s-o)*n}function mGe(e,t,i,r=$()){const s=Ue(e),n=Ue(t),o=Pe(e,t)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*s+i*n)/Math.sin(a),c=l/s*Math.sin((1-i)*a),h=l/n*Math.sin(i*a);return fe(ST,e,c),fe(ET,t,h),we(r,ST,ET)}return Pn(r,e,t,i)}function HFt(e,t,i,r=$(),s=$()){const n=Ue(e),o=Ue(t),a=Pe(e,t)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(i*l),p=Math.sin((1-i)*l),f=(1-i)*n+i*o;{const m=f/c,g=m/o*h;fe(ST,e,m/n*p),fe(ET,t,g),we(r,ST,ET)}{const m=1/n*(-Math.cos((1-i)*l)*l*f+p*(-n+o));fe(ST,e,m);const g=1/o*(Math.cos(i*l)*l*f+h*(-n+o));fe(ET,t,g),we(s,ST,ET),fe(s,s,1/c)}return s}return Pn(r,e,t,i),xe(s,t,e),Re(s,s),s}function p5(e,t,i){e=Re(ST,e),t=Re(ET,t);const r=Yn(Pe(e,t));if(i){const s=Tt(gGe,e,t);if(Pe(s,i)<0)return-r}return r}function f5(e){const t=e.length;return i=>{if(i<=e[0][0])return e[0][1];if(i>=e[t-1][0])return e[t-1][1];let r=1;for(;i>e[r][0];)r++;const s=e[r-1][0],n=e[r][0],o=(n-i)/(n-s);return o*e[r-1][1]+(1-o)*e[r][1]}}function qFt(e,t,i,r){xe(lae,t,e),xe(cae,i,e),Tt(r,lae,cae),Re(r,r),r[3]=-Pe(e,r)}const lae=$(),cae=$(),gGe=$(),ST=$(),ET=$();function qi(e=IP){return[e[0],e[1],e[2],e[3]]}function yGe(e=IP[0],t=IP[1],i=IP[2],r=IP[3]){return ree(e,t,i,r,KK.get())}function bB(e,t){return ree(t[0],t[1],t[2],t[3],e)}function ree(e,t,i,r,s=qi()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function $we(e,t,i){return pe(i,e),i[3]=t,i}function iM(e,t,i){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function sl(e,t,i,r=qi()){const s=i[0]-t[0],n=i[1]-t[1],o=i[2]-t[2],a=e[0]-t[0],l=e[1]-t[1],c=e[2]-t[2],h=n*c-o*l,p=o*a-s*c,f=s*l-n*a,m=h*h+p*p+f*f,g=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return r[0]=h*g,r[1]=p*g,r[2]=f*g,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function Lwe(e,t,i,r,s){if(e.count<3)return!1;e.getVec(i,XO);let n=r,o=!1;for(;n<e.count-1&&!o;)e.getVec(n,E2),n++,o=!Ic(XO,E2);if(!o)return!1;for(n=Math.max(n,s),o=!1;n<e.count&&!o;)e.getVec(n,iT),n++,xe(qD,XO,E2),Re(qD,qD),xe(WD,E2,iT),Re(WD,WD),o=!Ic(XO,iT)&&!Ic(E2,iT)&&Math.abs(Pe(qD,WD))<vGe;return o?(sl(XO,E2,iT,t),!0):(i!==0||r!==1||s!==2)&&Lwe(e,t,0,1,2)}const vGe=.99619469809,XO=$(),E2=$(),iT=$(),qD=$(),WD=$();function QW(e,t,i){return t!==e&&bB(e,t),e[3]=-Pe(e,i),e}function KW(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function B3(e,t,i,r){return Tt(iT,t,e),iM(i,iT,r)}function WFt(e,t,i,r){return wB(e,t,xe(Je.get(),i,t),EGe,r)}function t2(e,t,i){return!!_(t)&&wB(e,t.origin,t.direction,CGe,i)}function _Ge(e,t,i){return wB(e,t.origin,t.vector,Ng.NONE,i)}function bGe(e,t,i){return wB(e,t.origin,t.vector,Ng.CLAMP,i)}function Dwe(e,t){return Or(e,t)>=0}function wGe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];return e[0]*(e[0]>0?i:n)+e[1]*(e[1]>0?r:o)+e[2]*(e[2]>0?s:a)+e[3]>=0}function xGe(e,t){const i=Pe(e,t.ray.direction),r=-Or(e,t.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function TGe(e,t){const i=Pe(e,t.ray.direction),r=-Or(e,t.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function SGe(e,t,i){const r=fe(Je.get(),e,-e[3]),s=eZ(e,xe(Je.get(),t,r),Je.get());return we(i,s,r),i}function ZFt(e,t,i,r){const s=e,n=Je.get(),o=Je.get();fGe(s,n,o);const a=xe(Je.get(),i,t),l=hb(n,a),c=hb(o,a),h=hb(s,a);return he(r,l,c,h)}function eZ(e,t,i){const r=fe(Je.get(),e,Pe(e,t));return xe(i,t,r),i}function Or(e,t){return Pe(e,t)+e[3]}function wB(e,t,i,r,s){const n=Pe(e,i);if(n===0)return!1;let o=-(Pe(e,t)+e[3])/n;return r&Ng.CLAMP&&(o=He(o,0,1)),!(!(r&Ng.INFINITE_MIN)&&o<0||!(r&Ng.INFINITE_MAX)&&o>1)&&(we(s,t,fe(s,i,o)),!0)}function XFt(e){return e}const IP=[0,0,1,0];var Ng;(function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"})(Ng||(Ng={}));const EGe=Ng.INFINITE_MIN|Ng.INFINITE_MAX,CGe=Ng.INFINITE_MAX,YG=ve.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class Nwe{constructor(){this.plane=qi(),this.origin=$(),this.basis1=$(),this.basis2=$()}}function Jb(e=Wwe){return{plane:qi(e.plane),origin:Rn(e.origin),basis1:Rn(e.basis1),basis2:Rn(e.basis2)}}function AGe(e,t,i){const r=UGe.get();return r.origin=e,r.basis1=t,r.basis2=i,r.plane=yGe(0,0,0,0),xB(r),r}function i2(e,t=Jb()){return see(e.origin,e.basis1,e.basis2,t)}function MGe(e,t){pe(t.origin,e.origin),pe(t.basis1,e.basis1),pe(t.basis2,e.basis2),bB(t.plane,e.plane)}function see(e,t,i,r=Jb()){return pe(r.origin,e),pe(r.basis1,t),pe(r.basis2,i),xB(r),FGe(r,"fromValues()"),r}function xB(e){B3(e.basis2,e.basis1,e.origin,e.plane)}function Fwe(e,t,i){e!==i&&i2(e,i);const r=fe(Je.get(),vv(e),t);return we(i.origin,i.origin,r),i.plane[3]-=t,i}function OGe(e,t,i){return kwe(t,i),Fwe(i,lee(e,e.origin),i),i}function kwe(e,t=Jb()){const i=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return he(t.origin,e[0]+i,e[1]+r,0),he(t.basis1,i,0,0),he(t.basis2,0,r,0),ree(0,0,1,0,t.plane),t}function nee(e,t,i){return!!t2(e.plane,t,i)&&Hwe(e,i)}function RGe(e,t,i){if(nee(e,t,i))return i;const r=Uwe(e,t,Je.get());return we(i,t.origin,fe(Je.get(),t.direction,Pr(t.origin,r)/Ue(t.direction))),i}function Uwe(e,t,i){const r=FU.get();qwe(e,t,r,FU.get());let s=Number.POSITIVE_INFINITY;for(const n of uee){const o=cee(e,n,TB.get()),a=Je.get();if(_Ge(r,o,a)){const l=Rv(Je.get(),t.origin,a),c=Math.abs(Yn(Pe(t.direction,l)));c<s&&(s=c,pe(i,a))}}return s===Number.POSITIVE_INFINITY?zwe(e,t,i):i}function zwe(e,t,i){if(nee(e,t,i))return i;const r=FU.get(),s=FU.get();qwe(e,t,r,s);let n=Number.POSITIVE_INFINITY;for(const o of uee){const a=cee(e,o,TB.get()),l=Je.get();if(bGe(r,a,l)){const c=J8e(t,l);if(!Dwe(s,l))continue;c<n&&(n=c,pe(i,l))}}return oee(e,t.origin)<n&&Vwe(e,t.origin,i),i}function Vwe(e,t,i){const r=SGe(e.plane,t,Je.get()),s=XW(uae(e,e.basis1),r,-1,1,Je.get()),n=XW(uae(e,e.basis2),r,-1,1,Je.get());return xe(i,we(Je.get(),s,n),e.origin),i}function Bwe(e,t,i){const{origin:r,basis1:s,basis2:n}=e,o=xe(Je.get(),t,r),a=hb(s,o),l=hb(n,o),c=hb(vv(e),o);return he(i,a,l,c)}function oee(e,t){const i=Bwe(e,t,Je.get()),{basis1:r,basis2:s}=e,n=Ue(r),o=Ue(s),a=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function PGe(e,t){return Math.sqrt(oee(e,t))}function IGe(e,t){let i=Number.NEGATIVE_INFINITY;for(const r of uee){const s=cee(e,r,TB.get()),n=tee(s,t);n>i&&(i=n)}return Math.sqrt(i)}function aee(e,t){return Dwe(e.plane,t)&&Hwe(e,t)}function $Ge(e,t,i,r){return NGe(e,i,r)}function lee(e,t){const i=-e.plane[3];return hb(vv(e),t)-i}function LGe(e,t,i,r){const s=lee(e,t),n=fe(kGe,vv(e),i-s);return we(r,t,n),r}function Gwe(e,t){return Ic(e.basis1,t.basis1)&&Ic(e.basis2,t.basis2)&&Ic(e.origin,t.origin)}function jwe(e,t,i){return e!==i&&i2(e,i),Ks(C2,t),Gc(C2,C2),Xe(i.basis1,e.basis1,C2),Xe(i.basis2,e.basis2,C2),Xe(i.plane,e.plane,C2),Xe(i.origin,e.origin,t),QW(i.plane,i.plane,i.origin),i}function DGe(e,t,i,r){return e!==r&&i2(e,r),sd(JG,t,i),Xe(r.basis1,e.basis1,JG),Xe(r.basis2,e.basis2,JG),xB(r),r}function vv(e){return e.plane}function NGe(e,t,i){switch(t){case Jh.X:pe(i,e.basis1),Re(i,i);break;case Jh.Y:pe(i,e.basis2),Re(i,i);break;case Jh.Z:pe(i,vv(e))}return i}function Hwe(e,t){const i=xe(Je.get(),t,e.origin),r=Vl(e.basis1),s=Vl(e.basis2),n=Pe(e.basis1,i),o=Pe(e.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function uae(e,t){const i=TB.get();return pe(i.origin,e.origin),pe(i.vector,t),i}function cee(e,t,i){const{basis1:r,basis2:s,origin:n}=e,o=fe(Je.get(),r,t.origin[0]),a=fe(Je.get(),s,t.origin[1]);we(i.origin,o,a),we(i.origin,i.origin,n);const l=fe(Je.get(),r,t.direction[0]),c=fe(Je.get(),s,t.direction[1]);return fe(i.vector,we(l,l,c),2),i}function FGe(e,t){Math.abs(Pe(e.basis1,e.basis2)/(Ue(e.basis1)*Ue(e.basis2)))>1e-6&&YG.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Pe(e.basis1,vv(e)))>1e-6&&YG.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Pe(vv(e),e.origin)-e.plane[3])>1e-6&&YG.warn(t,"Plane offset is not consistent with plane origin")}function qwe(e,t,i,r){const s=vv(e);B3(s,t.direction,t.origin,i),B3(i,s,t.origin,r)}const Wwe={plane:qi(),origin:Ze(0,0,0),basis1:Ze(1,0,0),basis2:Ze(0,1,0)},FU=new $v(qi),TB=new $v(dy),kGe=$(),UGe=new $v(()=>({origin:null,basis1:null,basis2:null,plane:null})),uee=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],C2=Ne(),JG=Ne(),zGe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:Nwe,create:Jb,wrap:AGe,copy:i2,copyWithoutVerify:MGe,fromValues:see,updateUnboundedPlane:xB,elevate:Fwe,setExtent:OGe,fromAABoundingRect:kwe,intersectRay:nee,intersectRayClosestSilhouette:RGe,closestPointOnSilhouette:Uwe,closestPoint:zwe,projectPoint:Vwe,projectPointLocal:Bwe,distance2:oee,distance:PGe,distanceToSilhouette:IGe,extrusionContainsPoint:aee,axisAt:$Ge,altitudeAt:lee,setAltitudeAt:LGe,equals:Gwe,transform:jwe,rotate:DGe,normal:vv,UP:Wwe},Symbol.toStringTag,{value:"Module"}));function VGe(e){const{value:t,operations:i}=e;return{operations:i,value:i.create(t)}}function BGe(e,t,i){return e.operations.setExtent(e.value,t,i.value),i}function GGe(e){return{operations:e,value:e.create()}}function Zwe(e,t,i=GGe(e)){return i.operations=e,e.copy(t,i.value),i}function jGe(e){return Zwe(dGe,Awe(0,0,0,Ri(e).radius))}const hae=2**50;function HGe(){return Zwe(zGe,see([0,0,0],[hae,0,0],[0,hae,0]))}function qGe(e,t,i){return e.operations.axisAt(e.value,t,Jh.Z,i)}function WGe(e,t,i,r){return e.operations.axisAt(e.value,t,i,r)}function ZGe(e,t,i){return e.operations.intersectRay(e.value,t,i)}function XGe(e,t,i){return e.operations.intersectRayClosestSilhouette(e.value,t,i)}function YGe(e,t){return e.operations.altitudeAt(e.value,t)}function Xwe(e,t,i,r){return e.operations.setAltitudeAt(e.value,t,i,r)}function JGe(e,t,i,r){return t!==r&&ln(r,t),he(A2,r[12],r[13],r[14]),Xwe(e,A2,i,A2),r[12]=A2[0],r[13]=A2[1],r[14]=A2[2],r}function QG(e,t,i){return e.operations.elevate(e.value,t,i.value)}const A2=$();function dae(e,t,i,r,s){return s[0]=Pe(e,t),s[1]=Pe(e,i),s[2]=Pe(e,r),s}function tZ(e,t,i,r,s){pe(i,e),pe(ZD,t),Re(ZD,ZD),Tt(r,ZD,i),Tt(s,r,i)}function Ywe(e,t){return e?Xg(t):t.isGeographic?at.PlateCarree:t}const ZD=$(),Jwe=96;function YFt(e,t){const i=t||e.extent,r=e.width,s=$n(i&&i.spatialReference);return i&&r?i.width/r*s*gbe*Jwe:0}function Qwe(e,t){return e/($n(t)*gbe*Jwe)}function UI(e){const t=e==null?void 0:e.type;return t==="base-tile"||t==="tile"||t==="elevation"||t==="imagery-tile"||t==="base-elevation"||t==="open-street-map"||t==="wcs"||t==="web-tile"||t==="wmts"||t==="vector-tile"}function pae(e){return(e==null?void 0:e.type)==="voxel"}function fae(e){return(e==null?void 0:e.type)==="imagery-tile"}function Kwe(e){var t;return((t=e.parent)==null?void 0:t.declaredClass)==="esri.Basemap"&&e.parent.baseLayers.includes(e)}function hee(e){var t;return(e==null?void 0:e.type)==="feature"&&!e.url&&((t=e.source)==null?void 0:t.type)==="memory"}function JFt(e){var t;return(e==null?void 0:e.type)==="feature"&&((t=e.source)==null?void 0:t.type)==="feature-layer"}function iZ(e){return e.labelsVisible===!0&&e.labelingInfo!=null&&e.labelingInfo.length>0}function QGe(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const i=e.activeLayer.tileMatrixSets;if(i)return i}return null}const KGe=ve.getLogger("esri.support.AnalysesCollection");let rM=class extends NI{constructor(e){super(e),this.handles.add(this.on("before-add",t=>{M(t.item)||t.item.parent===this.owner&&(KGe.warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};rM=u([L("esri.support.AnalysesCollection")],rM);const m5={widthBreakpoint:{getValue(e){const t=e.viewSize[0],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,i=t[0],r=t[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},KG={xsmall:544,small:768,medium:992,large:1200};function e9e(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function e9(e,t){return t?m5[e].valueToClassName[t].split(" "):[]}const t9e=e=>{let t=class extends e{constructor(...i){super(...i),this._breakpointsHandles=new Nt,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=KG}initialize(){this._breakpointsHandles.add(re(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Et))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=We(this._breakpointsHandles))}set breakpoints(i){if(i===this._get("breakpoints"))return;const r=e9e(i);if(!r){const s=JSON.stringify(KG,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}i=r?i:KG,this._set("breakpoints",F({},i))}_updateClassNames(){if(!this.container)return;const i=Eu.acquire(),r=Eu.acquire();let s,n=!1;for(s in m5){const o=this[s],a=m5[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,e9(s,o).forEach(l=>r.push(l)),e9(s,a).forEach(l=>i.push(l)))}n&&(this._applyClassNameChanges(i,r),Eu.release(i),Eu.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in m5)e9(r,this[r]).forEach(s=>i.classList.remove(s))}};return u([d()],t.prototype,"breakpoints",null),u([d()],t.prototype,"orientation",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),u([d()],t.prototype,"heightBreakpoint",void 0),t=u([L("esri.views.BreakpointsOwner")],t),t};/*!
 * @esri/arcgis-html-sanitizer - v2.10.0 - Tue Mar 15 2022 16:38:25 GMT-0400 (Eastern Daylight Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2017 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 * 
 * Lodash/isPlainObject
 * Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 * MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
 */var i9e="[object Object]";function r9e(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function s9e(e,t){return function(i){return e(t(i))}}var n9e=Function.prototype,exe=Object.prototype,txe=n9e.toString,o9e=exe.hasOwnProperty,a9e=txe.call(Object),l9e=exe.toString,c9e=s9e(Object.getPrototypeOf,Object);function u9e(e){return!!e&&typeof e=="object"}function h9e(e){if(!u9e(e)||l9e.call(e)!=i9e||r9e(e))return!1;var t=c9e(e);if(t===null)return!0;var i=o9e.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&txe.call(i)==a9e}var d9e=h9e,rT={exports:{}},Dn={},G3={exports:{}},r2={};function ixe(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function p9e(e,t,i){}function f9e(e,t,i){}var m9e=/javascript\s*\:/img;function g9e(e,t){return m9e.test(t)?"":t}r2.whiteList=ixe();r2.getDefaultWhiteList=ixe;r2.onAttr=p9e;r2.onIgnoreAttr=f9e;r2.safeAttrValue=g9e;var y9e={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},YO=y9e;function v9e(e,t){e=YO.trimRight(e),e[e.length-1]!==";"&&(e+=";");var i=e.length,r=!1,s=0,n=0,o="";function a(){if(!r){var h=YO.trim(e.slice(s,n)),p=h.indexOf(":");if(p!==-1){var f=YO.trim(h.slice(0,p)),m=YO.trim(h.slice(p+1));if(f){var g=t(s,o.length,f,m,h);g&&(o+=g+"; ")}}}s=n+1}for(;n<i;n++){var l=e[n];if(l==="/"&&e[n+1]==="*"){var c=e.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return YO.trim(o)}var _9e=v9e,XD=r2,b9e=_9e;function mae(e){return e==null}function w9e(e){var t={};for(var i in e)t[i]=e[i];return t}function rxe(e){e=w9e(e||{}),e.whiteList=e.whiteList||XD.whiteList,e.onAttr=e.onAttr||XD.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||XD.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||XD.safeAttrValue,this.options=e}rxe.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,o=i.safeAttrValue,a=b9e(e,function(l,c,h,p,f){var m=r[h],g=!1;if(m===!0?g=m:typeof m=="function"?g=m(p):m instanceof RegExp&&(g=m.test(p)),g!==!0&&(g=!1),p=o(h,p),!!p){var y={position:c,sourcePosition:l,source:f,isWhite:g};if(g){var x=s(h,p,y);return mae(x)?h+":"+p:x}else{var x=n(h,p,y);if(!mae(x))return x}}});return a};var x9e=rxe;(function(e,t){var i=r2,r=x9e;function s(o,a){var l=new r(a);return l.process(o)}t=e.exports=s,t.FilterCSS=r;for(var n in i)t[n]=i[n]})(G3,G3.exports);var dee={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,i=t.exec(e);return i?i.index:-1}},T9e=G3.exports.FilterCSS,S9e=G3.exports.getDefaultWhiteList,kU=dee;function sxe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var nxe=new T9e;function E9e(e,t,i){}function C9e(e,t,i){}function A9e(e,t,i){}function M9e(e,t,i){}function oxe(e){return e.replace(R9e,"&lt;").replace(P9e,"&gt;")}function O9e(e,t,i,r){if(i=dxe(i),t==="href"||t==="src"){if(i=kU.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(t==="background"){if(YD.lastIndex=0,YD.test(i))return""}else if(t==="style"){if(gae.lastIndex=0,gae.test(i)||(yae.lastIndex=0,yae.test(i)&&(YD.lastIndex=0,YD.test(i))))return"";r!==!1&&(r=r||nxe,i=r.process(i))}return i=pxe(i),i}var R9e=/</g,P9e=/>/g,I9e=/"/g,$9e=/&quot;/g,L9e=/&#([a-zA-Z0-9]*);?/gim,D9e=/&colon;?/gim,N9e=/&newline;?/gim,YD=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,gae=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,yae=/u\s*r\s*l\s*\(.*/gi;function axe(e){return e.replace(I9e,"&quot;")}function lxe(e){return e.replace($9e,'"')}function cxe(e){return e.replace(L9e,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function uxe(e){return e.replace(D9e,":").replace(N9e," ")}function hxe(e){for(var t="",i=0,r=e.length;i<r;i++)t+=e.charCodeAt(i)<32?" ":e.charAt(i);return kU.trim(t)}function dxe(e){return e=lxe(e),e=cxe(e),e=uxe(e),e=hxe(e),e}function pxe(e){return e=axe(e),e=oxe(e),e}function F9e(){return""}function k9e(e,t){typeof t!="function"&&(t=function(){});var i=!Array.isArray(e);function r(o){return i?!0:kU.indexOf(e,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return t(o,a,l)},remove:function(o){var a="",l=0;return kU.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function U9e(e){for(var t="",i=0;i<e.length;){var r=e.indexOf("<!--",i);if(r===-1){t+=e.slice(i);break}t+=e.slice(i,r);var s=e.indexOf("-->",r);if(s===-1)break;i=s+3}return t}function z9e(e){var t=e.split("");return t=t.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),t.join("")}Dn.whiteList=sxe();Dn.getDefaultWhiteList=sxe;Dn.onTag=E9e;Dn.onIgnoreTag=C9e;Dn.onTagAttr=A9e;Dn.onIgnoreTagAttr=M9e;Dn.safeAttrValue=O9e;Dn.escapeHtml=oxe;Dn.escapeQuote=axe;Dn.unescapeQuote=lxe;Dn.escapeHtmlEntities=cxe;Dn.escapeDangerHtml5Entities=uxe;Dn.clearNonPrintableCharacter=hxe;Dn.friendlyAttrValue=dxe;Dn.escapeAttrValue=pxe;Dn.onIgnoreTagStripAll=F9e;Dn.StripTagBody=k9e;Dn.stripCommentTag=U9e;Dn.stripBlankChar=z9e;Dn.cssFilter=nxe;Dn.getDefaultCSSWhiteList=S9e;var SB={},S1=dee;function V9e(e){var t=S1.spaceIndex(e);if(t===-1)var i=e.slice(1,-1);else var i=e.slice(1,t+1);return i=S1.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function B9e(e){return e.slice(0,2)==="</"}function G9e(e,t,i){var r="",s=0,n=!1,o=!1,a=0,l=e.length,c="",h="";e:for(a=0;a<l;a++){var p=e.charAt(a);if(n===!1){if(p==="<"){n=a;continue}}else if(o===!1){if(p==="<"){r+=i(e.slice(s,a)),n=a,s=a;continue}if(p===">"){r+=i(e.slice(s,n)),h=e.slice(n,a+1),c=V9e(h),r+=t(n,r.length,c,h,B9e(h)),s=a+1,n=!1;continue}if(p==='"'||p==="'")for(var f=1,m=e.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=p;continue e}m=e.charAt(a-++f)}}else if(p===o){o=!1;continue}}return s<e.length&&(r+=i(e.substr(s))),r}var j9e=/[^a-zA-Z0-9_:\.\-]/gim;function H9e(e,t){var i=0,r=[],s=!1,n=e.length;function o(p,f){if(p=S1.trim(p),p=p.replace(j9e,"").toLowerCase(),!(p.length<1)){var m=t(p,f||"");m&&r.push(m)}}for(var a=0;a<n;a++){var l=e.charAt(a),c,h;if(s===!1&&l==="="){s=e.slice(i,a),i=a+1;continue}if(s!==!1&&a===i&&(l==='"'||l==="'")&&e.charAt(a-1)==="="){if(h=e.indexOf(l,a+1),h===-1)break;c=S1.trim(e.slice(i+1,h)),o(s,c),s=!1,a=h,i=a+1;continue}if(/\s|\n|\t/.test(l))if(e=e.replace(/\s|\n|\t/g," "),s===!1)if(h=q9e(e,a),h===-1){c=S1.trim(e.slice(i,a)),o(c),s=!1,i=a+1;continue}else{a=h-1;continue}else if(h=W9e(e,a-1),h===-1){c=S1.trim(e.slice(i,a)),c=vae(c),o(s,c),s=!1,i=a+1;continue}else continue}return i<e.length&&(s===!1?o(e.slice(i)):o(s,vae(S1.trim(e.slice(i))))),S1.trim(r.join(" "))}function q9e(e,t){for(;t<e.length;t++){var i=e[t];if(i!==" ")return i==="="?t:-1}}function W9e(e,t){for(;t>0;t--){var i=e[t];if(i!==" ")return i==="="?t:-1}}function Z9e(e){return e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'"}function vae(e){return Z9e(e)?e.substr(1,e.length-2):e}SB.parseTag=G9e;SB.parseAttr=H9e;var X9e=G3.exports.FilterCSS,wf=Dn,fxe=SB,Y9e=fxe.parseTag,J9e=fxe.parseAttr,g5=dee;function JD(e){return e==null}function Q9e(e){var t=g5.spaceIndex(e);if(t===-1)return{html:"",closing:e[e.length-2]==="/"};e=g5.trim(e.slice(t+1,-1));var i=e[e.length-1]==="/";return i&&(e=g5.trim(e.slice(0,-1))),{html:e,closing:i}}function K9e(e){var t={};for(var i in e)t[i]=e[i];return t}function mxe(e){e=K9e(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=wf.onIgnoreTagStripAll),e.whiteList=e.whiteList||e.allowList||wf.whiteList,e.onTag=e.onTag||wf.onTag,e.onTagAttr=e.onTagAttr||wf.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||wf.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||wf.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||wf.safeAttrValue,e.escapeHtml=e.escapeHtml||wf.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new X9e(e.css))}mxe.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,h=t.cssFilter;i.stripBlankChar&&(e=wf.stripBlankChar(e)),i.allowCommentTag||(e=wf.stripCommentTag(e));var p=!1;if(i.stripIgnoreTagBody){var p=wf.StripTagBody(i.stripIgnoreTagBody,n);n=p.onIgnoreTag}var f=Y9e(e,function(m,g,y,x,b){var S={sourcePosition:m,position:g,isClosing:b,isWhite:r.hasOwnProperty(y)},T=s(y,x,S);if(!JD(T))return T;if(S.isWhite){if(S.isClosing)return"</"+y+">";var C=Q9e(x),A=r[y],O=J9e(C.html,function(U,k){var B=g5.indexOf(A,U)!==-1,j=o(y,U,k,B);if(!JD(j))return j;if(B)return k=l(y,U,k,h),k?U+'="'+k+'"':U;var j=a(y,U,k,B);return JD(j)?void 0:j}),x="<"+y;return O&&(x+=" "+O),C.closing&&(x+=" /"),x+=">",x}else{var T=n(y,x,S);return JD(T)?c(x):T}},c);return p&&(f=p.remove(f)),f};var eje=mxe;(function(e,t){var i=Dn,r=SB,s=eje;function n(l,c){var h=new s(c);return h.process(l)}t=e.exports=n,t.filterXSS=n,t.FilterXSS=s;for(var o in i)t[o]=i[o];for(var o in r)t[o]=r[o];function a(){return typeof self!="undefined"&&typeof DedicatedWorkerGlobalScope!="undefined"&&self instanceof DedicatedWorkerGlobalScope}a()&&(self.filterXSS=e.exports)})(rT,rT.exports);var tje=function(){function e(t,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?r.sanitizeUrl(a):rT.exports.safeAttrValue(n,o,a,l)}};var s;t&&!i?s=t:t&&i?(s=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach(function(n){n==="whiteList"?s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,t.whiteList||{}]):s[n]=t[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new rT.exports.FilterXSS(s)}return e.prototype.sanitize=function(t,i){switch(i===void 0&&(i={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,i);default:return i.allowUndefined&&typeof t=="undefined"?void 0:null}},e.prototype.sanitizeUrl=function(t,i){var r=(i!=null?i:{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(t.substring(0,t.indexOf(":"))),o=t==="/",a=/^#/.test(t),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?rT.exports.escapeAttrValue(t):!n&&!s?rT.exports.escapeAttrValue("https://".concat(t)):""},e.prototype.sanitizeHTMLAttribute=function(t,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(t,i,r,s):rT.exports.safeAttrValue(t,i,r,s)},e.prototype.validate=function(t,i){i===void 0&&(i={});var r=this.sanitize(t,i);return{isValid:t===r,sanitized:r}},e.prototype._extendObjectOfArrays=function(t){var i={};return t.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},e.prototype._iterateOverObject=function(t,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(t))n=t.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(d9e(t)){var o=Object.keys(t);n=o.reduce(function(a,l){var c=t[l],h=r.validate(c,i);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return i.allowUndefined&&typeof t=="undefined"?void 0:null;return s?n:t}catch{return null}},e.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},e}();const EB=new Map;function gxe(){EB.clear()}function ije(e){return EB.get(e)}function rje(e,t){EB.set(e,t)}function t9(e){EB.delete(e)}var gS,sM,sje=function(e){if("WebkitTransition"in e.style)gS="webkitTransitionEnd",sM="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");gS="transitionend",sM="animationend"}},yxe=function(e){gS||sje(e)},nje=function(e,t){return t===void 0&&(t=e+"-active"),function(i){yxe(i);var r=!1,s=function(n){r||(r=!0,i.removeEventListener(gS,s),i.removeEventListener(sM,s),i.classList.remove(e),i.classList.remove(t))};i.classList.add(e),i.addEventListener(gS,s),i.addEventListener(sM,s),requestAnimationFrame(function(){i.classList.add(t)})}},oje=function(e,t){return t===void 0&&(t=e+"-active"),function(i,r){yxe(i);var s=!1,n=function(o){s||(s=!0,i.removeEventListener(gS,n),i.removeEventListener(sM,n),r())};i.classList.add(e),i.addEventListener(gS,n),i.addEventListener(sM,n),requestAnimationFrame(function(){i.classList.add(t)})}};const aje=ve.getLogger("esri.widgets.support.widgetUtils");function CT(e){const t=Eu.acquire();for(let r=0;r<arguments.length;r++){const s=arguments[r],n=typeof s;if(n==="string")t.push(s);else if(Array.isArray(s))t.push.apply(t,s);else if(n==="object")for(const o in s)s[o]&&t.push(o)}const i=t.join(" ");return Eu.release(t),i}const vxe=(()=>{const e=new Map,t=new ResizeObserver(i=>{gxe();for(const r of i)e.get(r.target)(r)});return(i,r,s)=>(e.has(i)&&aje.error("Already observing element",i),e.set(i,r),t.observe(i,s),Fo(()=>{t.unobserve(i),e.delete(i)}))})();function jl(e){const t=e==null?void 0:e.closest("[dir]");return t!==null&&t instanceof HTMLElement&&t.dir==="rtl"||document.dir==="rtl"}function _xe(e){return jl(e)?"rtl":"ltr"}function _ae(e){const t="data-node-ref";this[e.getAttribute(t)]=null}function AT(e){const t="data-node-ref";this[e.getAttribute(t)]=e}function lje(e,t){return(e==="enter"?nje:oje)(t)}const cje=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],uje=cje.reduce((e,t)=>(e[t]=[],e),{}),hje=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],bxe=new tje({whiteList:uje,onTagAttr:(e,t,i)=>{const r=`${t}="${i}"`;if(hje.includes(t))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function $P(e){return e==="Enter"||e===" "}const wxe="http://www.w3.org/",CB=`${wxe}2000/svg`,xxe=`${wxe}1999/xlink`;let UU,bae=[],pee=(e,t)=>{let i={};return Object.keys(e).forEach(r=>{i[r]=e[r]}),t&&Object.keys(t).forEach(r=>{i[r]=t[r]}),i},fee=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),Txe=e=>{if(typeof e!="string")throw new Error("Style values must be strings")},dje=(e,t,i)=>{if(t.vnodeSelector!==""){for(let r=i;r<e.length;r++)if(fee(e[r],t))return r}return-1},i9=(e,t,i,r)=>{let s=e[t];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n?n.key===void 0?n.bind:n.key:void 0)){for(let o=0;o<e.length;o++)if(o!==t){let a=e[o];if(fee(a,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},pje=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},rZ=[],sZ=!1,Sxe=e=>{(e.children||[]).forEach(Sxe),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},wae=()=>{sZ=!1,rZ.forEach(Sxe),rZ.length=0},xae=e=>{rZ.push(e),sZ||(sZ=!0,typeof window!="undefined"&&"requestIdleCallback"in window?window.requestIdleCallback(wae,{timeout:16}):setTimeout(wae,16))},Tae=e=>{let t=e.domNode;if(e.properties){let i=e.properties.exitAnimation;if(i)return t.style.pointerEvents="none",void i(t,()=>{t.parentNode&&(t.parentNode.removeChild(t),xae(e))},e.properties)}t.parentNode&&(t.parentNode.removeChild(t),xae(e))},fje=(e,t,i)=>{if(!t)return;let r=i.eventHandlerInterceptor,s=Object.keys(t),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=t[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")nZ(e,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p];l[f]&&e.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p],m=l[f];m&&(Txe(m),i.styleApplyer(e,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,e,t)),a==="oninput"&&function(){let h=l;l=function(p){h.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),e[a]=l):i.namespace===CB?a==="href"?e.setAttributeNS(xxe,a,l):e.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?e[a]=bxe.sanitize(l):e.setAttribute(a,l):e[a]=l}}},mje=(e,t,i)=>{if(t)for(let r of t)LC(r,e,void 0,i)},Exe=(e,t,i)=>{mje(e,t.children,i),t.text&&(e.textContent=t.text),fje(e,t.properties,i),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,i,t.vnodeSelector,t.properties,t.children])},LC=(e,t,i,r)=>{let s,n=0,o=e.vnodeSelector,a=t.ownerDocument;if(o==="")s=e.domNode=a.createTextNode(e.text),i!==void 0?t.insertBefore(s,i):t.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),p=o.slice(n,l);h==="."?s.classList.add(p):h==="#"?s.id=p:(p==="svg"&&(r=pee(r,{namespace:CB})),r.namespace!==void 0?s=e.domNode=a.createElementNS(r.namespace,p):(s=e.domNode=e.domNode||a.createElement(p),p==="input"&&e.properties&&e.properties.type!==void 0&&s.setAttribute("type",e.properties.type)),i!==void 0?t.insertBefore(s,i):s.parentNode!==t&&t.appendChild(s)),n=l+1}}Exe(s,e,r)}},nZ=(e,t,i)=>{t&&t.split(" ").forEach(r=>{r&&e.classList.toggle(r,i)})},gje=(e,t,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=i[l],h=t[l];if(l==="class")h!==c&&(nZ(e,h,!1),nZ(e,c,!0));else if(l==="classes"){let p=e.classList,f=Object.keys(c),m=f.length;for(let g=0;g<m;g++){let y=f[g],x=!!c[y];x!==!!h[y]&&(s=!0,x?p.add(y):p.remove(y))}}else if(l==="styles"){let p=Object.keys(c),f=p.length;for(let m=0;m<f;m++){let g=p[m],y=c[g];y!==h[g]&&(s=!0,y?(Txe(y),r.styleApplyer(e,g,y)):r.styleApplyer(e,g,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let p=e[l];p!==c&&(e["oninput-value"]?p===e["oninput-value"]:c!==h)&&(e[l]=c,e["oninput-value"]=void 0),c!==h&&(s=!0)}else if(c!==h){let p=typeof c;p==="function"&&r.eventHandlerInterceptor||(r.namespace===CB?l==="href"?e.setAttributeNS(xxe,l,c):e.setAttribute(l,c):p==="string"?l==="innerHTML"?e[l]=bxe.sanitize(c):l==="role"&&c===""?e.removeAttribute(l):e.setAttribute(l,c):e[l]!==c&&(e[l]=c),s=!0)}}return s},yje=(e,t,i,r,s)=>{if(i===r)return!1;r=r||bae;let n,o=(i=i||bae).length,a=r.length,l=0,c=0,h=!1;for(;c<a;){let p=l<o?i[l]:void 0,f=r[c];if(p!==void 0&&fee(p,f))h=UU(p,f,s)||h,l++;else{let m=dje(i,f,l+1);if(m>=0){for(n=l;n<m;n++)Tae(i[n]),i9(i,n,e,"removed");h=UU(i[m],f,s)||h,l=m+1}else LC(f,t,l<o?i[l].domNode:void 0,s),pje(f),i9(r,c,e,"added")}c++}if(o>l)for(n=l;n<o;n++)Tae(i[n]),i9(i,n,e,"removed");return h};UU=(e,t,i)=>{let r=e.domNode,s=!1;if(e===t)return!1;let n=!1;if(t.vnodeSelector===""){if(t.text!==e.text){let o=r.ownerDocument.createTextNode(t.text);return r.parentNode.replaceChild(o,r),t.domNode=o,s=!0,s}t.domNode=r}else t.vnodeSelector.lastIndexOf("svg",0)===0&&(i=pee(i,{namespace:CB})),e.text!==t.text&&(n=!0,t.text===void 0?r.removeChild(r.firstChild):r.textContent=t.text),t.domNode=r,n=yje(t,r,e.children,t.children,i)||n,n=gje(r,e.properties,t.properties,i)||n,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[r,i,t.vnodeSelector,t.properties,t.children]);return n&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(r,t.properties,e.properties),s};let JO=(e,t)=>({getLastRender:()=>e,update:i=>{if(e.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=e;e=i,UU(r,i,t)},domNode:e.domNode});const vje={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{t.charAt(0)==="-"?e.style.setProperty(t,i):e.style[t]=i}};let zE=e=>pee(vje,e),eb={create:(e,t)=>(t=zE(t),LC(e,document.createElement("div"),void 0,t),JO(e,t)),append:(e,t,i)=>(i=zE(i),LC(t,e,void 0,i),JO(t,i)),insertBefore:(e,t,i)=>(i=zE(i),LC(t,e.parentNode,e,i),JO(t,i)),merge:(e,t,i)=>(i=zE(i),t.domNode=e,Exe(e,t,i),JO(t,i)),replace:(e,t,i)=>(i=zE(i),LC(t,e.parentNode,e,i),e.parentNode.removeChild(e),JO(t,i))},Cxe,_je=(e,t)=>{let i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i};Cxe=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let bje=(e,t)=>{let i=e;return t.forEach(r=>{i=i&&i.children?Cxe(i.children,s=>s.domNode===r):void 0}),i},wje=(e,t,i)=>{let r=function(s){i("domEvent",s);let n=t(),o=_je(s.currentTarget,n.domNode);o.reverse();let a,l=bje(n.getLastRender(),o);return e.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),a};return(s,n,o,a)=>r},zU=e=>{let t,i,r=zE(e),s=r.performanceLogger,n=!0,o=!1,a=[],l=[],c=(p,f,m)=>{let g,y=()=>g;r.eventHandlerInterceptor=wje(t,y,s),g=p(f,m(),r),a.push(g),l.push(m)},h=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let p=0;p<a.length;p++){let f=l[p]();s("rendered",void 0),a[p].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return t={renderNow:h,scheduleRender:()=>{i||o||(i=requestAnimationFrame(h))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,n=!0,t.scheduleRender()},append:(p,f)=>{c(eb.append,p,f)},insertBefore:(p,f)=>{c(eb.insertBefore,p,f)},merge:(p,f)=>{c(eb.merge,p,f)},replace:(p,f)=>{c(eb.replace,p,f)},detach:p=>{for(let f=0;f<l.length;f++)if(l[f]===p)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},t},q_=class extends Ee{constructor(){super(...arguments),this.items=new nt,this._watchUpdatingTracking=new Lg,this._callbacks=new Map,this._projector=zU(),this._hiddenProjector=zU()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const i of t.added){const r=()=>i.render();this._callbacks.set(i,r),this._projector.append(this.surface,r)}for(const i of t.removed){const r=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(r.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let r=null;const s=()=>(r=e.render(),r);i.append(t,s),i.renderNow();const n={left:0,top:0,right:0,bottom:0};if(r&&r.domNode){const o=r.domNode.getBoundingClientRect();n.left=o.left,n.top=o.top,n.right=o.right,n.bottom=o.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return n}overlaps(e,t){const i=this.computeBoundingRect(e),r=this.computeBoundingRect(t);return Math.max(i.left,r.left)<=Math.min(i.right,r.right)&&Math.max(i.top,r.top)<=Math.min(i.bottom,r.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const t=e.getContext("2d");t.save(),t.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach(i=>{t.save(),i.renderCanvas(t),t.restore()}),t.restore()}};u([d({readOnly:!0})],q_.prototype,"surface",void 0),u([d({readOnly:!0})],q_.prototype,"items",void 0),u([d({readOnly:!0})],q_.prototype,"needsRender",null),u([d({readOnly:!0})],q_.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],q_.prototype,"updating",void 0),q_=u([L("esri.views.overlay.ViewOverlay")],q_);const Sae=q_;function gL(e,t,i,r){let s=null,n=1e3;typeof t=="number"?(n=t,r=i):(s=t!=null?t:null,n=i);let o,a=0;const l=()=>{a=0,e.apply(r,o)},c=(...h)=>{s&&s.apply(r,h),o=h,n?a||(a=setTimeout(l,n)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}function ze(e,t){const i=t?me(F({},t),{source:e}):e;return d({aliasOf:i})}const xje="randomUUID"in crypto;function AB(){if(xje)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=i=>e[i].toString(16);return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}const Tje={handleInterceptedEvent:(e,t,i,r)=>(e.scheduleRender(),t.properties[`on${r.type}`].apply(t.properties.bind||i,[r]))},Sje={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{e.style[t]=i}},Eje=e=>F(F({},Sje),e),Cje=(e,t)=>{const i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i},Aje=(e,t)=>e.find(t),Eae=(e,t,i=!1)=>{let r=e;return t.forEach((s,n)=>{const o=(r==null?void 0:r.children)?Aje(r.children,a=>a.domNode===s):void 0;i&&!o&&n!==t.length-1||(r=o)}),r},Mje=e=>{let t;const i=F(F({},Tje),e),r=Eje(i),s=r.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(f,m,g)=>{var b;let y;r.eventHandlerInterceptor=(S,T,C,A)=>function(O){let D;s("domEvent",O);const U=Cje(O.currentTarget,y.domNode),k=U.some(j=>{var H;return customElements.get((H=j==null?void 0:j.tagName)==null?void 0:H.toLowerCase())});if(O.eventPhase===Event.CAPTURING_PHASE||!k)U.reverse(),D=Eae(y.getLastRender(),U);else{const j=O.composedPath(),H=j.slice(j.indexOf(O.currentTarget),j.indexOf(y.domNode)).filter(K=>K.getRootNode()===K.ownerDocument).reverse();D=Eae(y.getLastRender(),H,!0)}let B;return D&&(B=i.handleInterceptedEvent(t,D,this,O)),s("domEventProcessed",O),B},(b=i.postProcessProjectionOptions)==null||b.call(i,r);const x=g();y=f(m,x,r),l.push(y),c.push(g),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(y,x)};let p=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0),l[f].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(p=i.modifyDoRenderImplementation(p,l,c)),t={renderNow:p,scheduleRender:()=>{n||a||(n=requestAnimationFrame(p))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,t.scheduleRender()},append:(f,m)=>{h(eb.append,f,m)},insertBefore:(f,m)=>{h(eb.insertBefore,f,m)},merge:(f,m)=>{h(eb.merge,f,m)},replace:(f,m)=>{h(eb.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},t},Ji={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let VE,Axe,MB,Mxe=!1,VU=!1,mee=!1,Ch=!1,Cae=null,oZ=!1;const lO=typeof window!="undefined"?window:{};Ji.cssVarShim&&lO.CSS;const Yf=lO.document||{head:{}},Oje=lO.HTMLElement||class{},pl={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,i,r)=>e.addEventListener(t,i,r),rel:(e,t,i,r)=>e.removeEventListener(t,i,r),ce:(e,t)=>new CustomEvent(e,t)},BU=Ji.shadowDomShim&&Ji.shadowDom?(()=>(Yf.head.attachShadow+"").indexOf("[native")>-1)():!0,Rje=(()=>{let e=!1;try{Yf.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),Pje=e=>Promise.resolve(e),Ije=Ji.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replace=="function"}catch{}return!1})():!1,Oxe=(e,t,i,r)=>{i&&i.map(([s,n,o])=>{const a=Lje(e,s),l=$je(t,o),c=Dje(s);pl.ael(a,n,l,c),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>pl.rel(a,n,l,c))})},$je=(e,t)=>i=>{try{Ji.lazyLoad||e.$hostElement$[t](i)}catch(r){yL(r)}},Lje=(e,t)=>t&4?Yf:t&8?lO:t&16?Yf.body:e,Dje=e=>Rje?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,Aae="http://www.w3.org/1999/xlink",yS=(e,t="")=>()=>{},Mae=new WeakMap,Nje=(e,t,i)=>{let r=HU.get(e);Ije&&i?(r=r||new CSSStyleSheet,r.replace(t)):r=t,HU.set(e,r)},Fje=(e,t,i,r)=>{let s=Rxe(t,i),n=HU.get(s);if(e=e.nodeType===11?e:Yf,n)if(typeof n=="string"){e=e.head||e;let o=Mae.get(e),a;o||Mae.set(e,o=new Set),o.has(s)||(a=Yf.createElement("style"),a.innerHTML=n,e.insertBefore(a,e.querySelector("link")),o&&o.add(s))}else e.adoptedStyleSheets.includes(n)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n]);return s},kje=e=>{const t=e.$cmpMeta$,i=e.$hostElement$,r=t.$flags$,s=yS("attachStyles",t.$tagName$),n=Fje(BU&&i.shadowRoot?i.shadowRoot:i.getRootNode(),t,e.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},Rxe=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),Uje=e=>m7e.map(t=>t(e)).find(t=>!!t),Oae={},zje="http://www.w3.org/2000/svg",Vje="http://www.w3.org/1999/xhtml",Bje=e=>e!=null,gee=e=>(e=typeof e,e==="object"||e==="function"),Bd=(e,t,...i)=>{let r=null,s=null,n=null,o=!1,a=!1,l=[];const c=p=>{for(let f=0;f<p.length;f++)r=p[f],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof e!="function"&&!gee(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?GU(null,r):r),a=o)};if(c(i),t&&(Ji.isDev&&e==="input"&&Hje(t),Ji.vdomKey&&t.key&&(s=t.key),Ji.slotRelocation&&t.name&&(n=t.name),Ji.vdomClass)){const p=t.className||t.class;p&&(t.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}if(Ji.isDev&&l.some(Ixe)&&f7e(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),Ji.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,l,Gje);const h=GU(e,null);return h.$attrs$=t,l.length>0&&(h.$children$=l),Ji.vdomKey&&(h.$key$=s),Ji.slotRelocation&&(h.$name$=n),h},GU=(e,t)=>{const i={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return Ji.vdomAttribute&&(i.$attrs$=null),Ji.vdomKey&&(i.$key$=null),Ji.slotRelocation&&(i.$name$=null),i},Pxe={},Ixe=e=>e&&e.$tag$===Pxe,Gje={forEach:(e,t)=>e.map(Rae).forEach(t),map:(e,t)=>e.map(Rae).map(t).map(jje)},Rae=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),jje=e=>{if(typeof e.vtag=="function"){const i=Object.assign({},e.vattrs);return e.vkey&&(i.key=e.vkey),e.vname&&(i.name=e.vname),Bd(e.vtag,i,...e.vchildren||[])}const t=GU(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},Hje=e=>{const t=Object.keys(e),i=t.indexOf("value");if(i===-1)return;const r=t.indexOf("type"),s=t.indexOf("min"),n=t.indexOf("max"),o=t.indexOf("step");(i<r||i<s||i<n||i<o)&&Bxe('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},Pae=(e,t,i,r,s,n)=>{if(i!==r){let o=Dae(e,t),a=t.toLowerCase();if(t==="class"){const l=e.classList,c=Iae(i),h=Iae(r);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(t==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?e.style.removeProperty(l):e.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?e.style.setProperty(l,r[l]):e.style[l]=r[l])}else if(t!=="key")if(t==="ref")r&&r(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):Dae(lO,a)?t=a.slice(2):t=a[2]+t.slice(3),i&&pl.rel(e,t,i,!1),r&&pl.ael(e,t,r,!1);else{const l=gee(r);if((o||l&&r!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=r;else{let h=r==null?"":r;t==="list"?o=!1:(i==null||e[t]!=h)&&(e[t]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(t=a,c=!0),r==null||r===!1?(r!==!1||e.getAttribute(t)==="")&&(c?e.removeAttributeNS(Aae,t):e.removeAttribute(t)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?e.setAttributeNS(Aae,t,r):e.setAttribute(t,r))}}},qje=/\s/,Iae=e=>e?e.split(qje):[],$xe=(e,t,i,r)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||Oae,o=t.$attrs$||Oae;for(r in n)r in o||Pae(s,r,n[r],void 0,i,t.$flags$);for(r in o)Pae(s,r,n[r],o[r],i,t.$flags$)},jU=(e,t,i,r)=>{let s=t.$children$[i],n=0,o,a,l;if(Mxe||(mee=!0,s.$tag$==="slot"&&(VE&&r.classList.add(VE+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=Yf.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=Yf.createTextNode("");else{if(Ch||(Ch=s.$tag$==="svg"),o=s.$elm$=Yf.createElementNS(Ch?zje:Vje,s.$flags$&2?"slot-fb":s.$tag$),Ch&&s.$tag$==="foreignObject"&&(Ch=!1),$xe(null,s,Ch),Bje(VE)&&o["s-si"]!==VE&&o.classList.add(o["s-si"]=VE),s.$children$)for(n=0;n<s.$children$.length;++n)a=jU(e,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?Ch=!1:o.tagName==="foreignObject"&&(Ch=!0)}return o["s-hn"]=MB,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=Axe,o["s-sn"]=s.$name$||"",l=e&&e.$children$&&e.$children$[i],l&&l.$tag$===s.$tag$&&e.$elm$&&j3(e.$elm$,!1)),o},j3=(e,t)=>{pl.$flags$|=1;const i=e.childNodes;for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==MB&&s["s-ol"]&&(Nxe(s).insertBefore(s,yee(s)),s["s-ol"].remove(),s["s-ol"]=void 0,mee=!0),t&&j3(s,t)}pl.$flags$&=-2},Lxe=(e,t,i,r,s,n)=>{let o=e["s-cr"]&&e["s-cr"].parentNode||e,a;for(o.shadowRoot&&o.tagName===MB&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=jU(null,i,s,e),a&&(r[s].$elm$=a,o.insertBefore(a,yee(t))))},Dxe=(e,t,i,r,s)=>{for(;t<=i;++t)(r=e[t])&&(s=r.$elm$,Uxe(r),VU=!0,s["s-ol"]?s["s-ol"].remove():j3(s,!0),s.remove())},Wje=(e,t,i,r)=>{let s=0,n=0,o=0,a=0,l=t.length-1,c=t[0],h=t[l],p=r.length-1,f=r[0],m=r[p],g,y;for(;s<=l&&n<=p;)if(c==null)c=t[++s];else if(h==null)h=t[--l];else if(f==null)f=r[++n];else if(m==null)m=r[--p];else if(QD(c,f))BE(c,f),c=t[++s],f=r[++n];else if(QD(h,m))BE(h,m),h=t[--l],m=r[--p];else if(QD(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&j3(c.$elm$.parentNode,!1),BE(c,m),e.insertBefore(c.$elm$,h.$elm$.nextSibling),c=t[++s],m=r[--p];else if(QD(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&j3(h.$elm$.parentNode,!1),BE(h,f),e.insertBefore(h.$elm$,c.$elm$),h=t[--l],f=r[++n];else{for(o=-1,a=s;a<=l;++a)if(t[a]&&t[a].$key$!==null&&t[a].$key$===f.$key$){o=a;break}o>=0?(y=t[o],y.$tag$!==f.$tag$?g=jU(t&&t[n],i,o,e):(BE(y,f),t[o]=void 0,g=y.$elm$),f=r[++n]):(g=jU(t&&t[n],i,n,e),f=r[++n]),g&&Nxe(c.$elm$).insertBefore(g,yee(c.$elm$))}s>l?Lxe(e,r[p+1]==null?null:r[p+1].$elm$,i,r,n,p):n>p&&Dxe(t,s,l)},QD=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,yee=e=>e&&e["s-ol"]||e,Nxe=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,BE=(e,t)=>{const i=t.$elm$=e.$elm$,r=e.$children$,s=t.$children$,n=t.$tag$,o=t.$text$;let a;o===null?(Ch=n==="svg"?!0:n==="foreignObject"?!1:Ch,n==="slot"||$xe(e,t,Ch),r!==null&&s!==null?Wje(i,r,t,s):s!==null?(e.$text$!==null&&(i.textContent=""),Lxe(i,null,t,s,0,s.length-1)):r!==null&&Dxe(r,0,r.length-1),Ch&&n==="svg"&&(Ch=!1)):(a=i["s-cr"])?a.parentNode.textContent=o:e.$text$!==o&&(i.data=o)},Fxe=e=>{let t=e.childNodes,i,r,s,n,o,a;for(r=0,s=t.length;r<s;r++)if(i=t[r],i.nodeType===1){if(i["s-sr"]){for(o=i["s-sn"],i.hidden=!1,n=0;n<s;n++)if(a=t[n].nodeType,t[n]["s-hn"]!==i["s-hn"]||o!==""){if(a===1&&o===t[n].getAttribute("slot")){i.hidden=!0;break}}else if(a===1||a===3&&t[n].textContent.trim()!==""){i.hidden=!0;break}}Fxe(i)}},Ef=[],kxe=e=>{let t,i,r,s,n,o,a=0,l=e.childNodes,c=l.length;for(;a<c;a++){if(t=l[a],t["s-sr"]&&(i=t["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,s=t["s-sn"],o=r.length-1;o>=0;o--)i=r[o],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==t["s-hn"]&&($ae(i,s)?(n=Ef.find(h=>h.$nodeToRelocate$===i),VU=!0,i["s-sn"]=i["s-sn"]||s,n?n.$slotRefNode$=t:Ef.push({$slotRefNode$:t,$nodeToRelocate$:i}),i["s-sr"]&&Ef.map(h=>{$ae(h.$nodeToRelocate$,i["s-sn"])&&(n=Ef.find(p=>p.$nodeToRelocate$===i),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):Ef.some(h=>h.$nodeToRelocate$===i)||Ef.push({$nodeToRelocate$:i}));t.nodeType===1&&kxe(t)}},$ae=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",Uxe=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(Uxe)},Zje=(e,t)=>{const i=e.$hostElement$,r=e.$cmpMeta$,s=e.$vnode$||GU(null,null),n=Ixe(t)?t:Bd(null,null,t);MB=i.tagName,r.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},r.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=i[o])),n.$tag$=null,n.$flags$|=4,e.$vnode$=n,n.$elm$=s.$elm$=i.shadowRoot||i,VE=i["s-sc"],Axe=i["s-cr"],Mxe=BU&&(r.$flags$&1)!==0,VU=!1,BE(s,n);{if(pl.$flags$|=1,mee){kxe(n.$elm$);let o,a,l,c,h,p,f=0;for(;f<Ef.length;f++)o=Ef[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=Yf.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<Ef.length;f++)if(o=Ef[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}VU&&Fxe(n.$elm$),pl.$flags$&=-2,Ef.length=0}},Xje=e=>Ji.lazyLoad?cO(e).$hostElement$:e,QFt=(e,t,i)=>{const r=Xje(e);return{emit:s=>(Ji.isDev&&!r.isConnected&&Bxe(`The "${t}" event was emitted, but the dispatcher node is no longer connected to the dom.`),Yje(r,t,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:s}))}},Yje=(e,t,i)=>{const r=pl.ce(t,i);return e.dispatchEvent(r),r},Jje=(e,t)=>{},vee=(e,t)=>(e.$flags$|=16,Jje(e,e.$ancestorComponent$),v7e(()=>Qje(e,t))),Qje=(e,t)=>{const i=e.$hostElement$,r=yS("scheduleUpdate",e.$cmpMeta$.$tagName$),s=i;let n;return t?n=dA(s,"componentWillLoad"):n=dA(s,"componentWillUpdate"),n=Lae(n,()=>dA(s,"componentWillRender")),r(),Lae(n,()=>Kje(e,s,t))},Kje=async(e,t,i)=>{const r=e.$hostElement$,s=yS("update",e.$cmpMeta$.$tagName$);r["s-rc"],i&&kje(e);const n=yS("render",e.$cmpMeta$.$tagName$);e7e(e,t,r),n(),s(),t7e(e)},e7e=(e,t,i)=>{try{Cae=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(Ji.hasRenderFn||Ji.reflect)&&(Ji.vdomRender||Ji.reflect)&&(Ji.hydrateServerSide||Zje(e,t))}catch(a){yL(a,e.$hostElement$)}return Cae=null,null},t7e=e=>{const t=e.$cmpMeta$.$tagName$,i=e.$hostElement$,r=yS("postUpdate",t),s=i;e.$ancestorComponent$,dA(s,"componentDidRender"),e.$flags$&64?(dA(s,"componentDidUpdate"),r()):(e.$flags$|=64,dA(s,"componentDidLoad"),r())},KFt=e=>{if(Ji.updatable){const t=cO(e),i=t.$hostElement$.isConnected;return i&&(t.$flags$&18)===2&&vee(t,!1),i}return!1},dA=(e,t,i)=>{if(e&&e[t])try{return e[t](i)}catch(r){yL(r)}},Lae=(e,t)=>e&&e.then?e.then(t):t(),i7e=(e,t)=>e!=null&&!gee(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,r7e=(e,t)=>cO(e).$instanceValues$.get(t),s7e=(e,t,i,r)=>{const s=cO(e),n=e,o=s.$instanceValues$.get(t),a=s.$flags$,l=n;i=i7e(i,r.$members$[t][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){s.$instanceValues$.set(t,i);{if(r.$watchers$&&a&128){const p=r.$watchers$[t];p&&p.map(f=>{try{l[f](i,o,t)}catch(m){yL(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,t)===!1)return;vee(s,!1)}}}},n7e=(e,t,i)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const r=Object.entries(t.$members$),s=e.prototype;r.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return r7e(this,n)},set(a){s7e(this,n,a,t)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){pl.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},e.observedAttributes=r.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&t.$attrsToReflect$.push([o,l]),l})}}return e},o7e=async(e,t,i,r,s)=>{if((t.$flags$&32)===0&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>t.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[t.$modeName$=Uje(e)]);const a=Rxe(i,t.$modeName$);if(!HU.has(a)){const l=yS("registerStyles",i.$tagName$);Nje(a,o,!!(i.$flags$&1)),l()}}t.$ancestorComponent$,(()=>vee(t,!0))()},a7e=e=>{},l7e=e=>{if((pl.$flags$&1)===0){const t=cO(e),i=t.$cmpMeta$,r=yS("connectedCallback",i.$tagName$);t.$flags$&1?(Oxe(e,t,i.$listeners$),a7e(t.$lazyInstance$)):(t.$flags$|=1,i.$flags$&12&&c7e(e),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&e.hasOwnProperty(s)){const o=e[s];delete e[s],e[s]=o}}),o7e(e,t,i)),r()}},c7e=e=>{const t=e["s-cr"]=Yf.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},u7e=e=>{if((pl.$flags$&1)===0){const t=cO(e);t.$rmListeners$&&(t.$rmListeners$.map(i=>i()),t.$rmListeners$=void 0)}},h7e=(e,t)=>{const i={$flags$:t[0],$tagName$:t[1]};Ji.member&&(i.$members$=t[2]),Ji.hostListener&&(i.$listeners$=t[3]),Ji.watchCallback&&(i.$watchers$=e.$watchers$),Ji.reflect&&(i.$attrsToReflect$=[]),Ji.shadowDom&&!BU&&i.$flags$&1&&(i.$flags$|=8);const r=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){p7e(this,i)},connectedCallback(){l7e(this),Ji.connectedCallback&&r&&r.call(this)},disconnectedCallback(){u7e(this),Ji.disconnectedCallback&&s&&s.call(this)},__attachShadow(){BU?Ji.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)}):this.attachShadow({mode:"open"}):this.shadowRoot=this}}),e.is=i.$tagName$,n7e(e,i)},e4t=e=>{const t=new URL(e,pl.$resourcesUrl$);return t.origin!==lO.location.origin?t.href:t.pathname},d7e=e=>pl.$resourcesUrl$=e,zxe=new WeakMap,cO=e=>zxe.get(e),p7e=(e,t)=>{const i={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return Ji.isDev&&(i.$renderCount$=0),Ji.method&&Ji.lazyLoad&&(i.$onInstancePromise$=new Promise(r=>i.$onInstanceResolve$=r)),Ji.asyncLoading&&(i.$onReadyPromise$=new Promise(r=>i.$onReadyResolve$=r),e["s-p"]=[],e["s-rc"]=[]),Oxe(e,i,t.$listeners$),zxe.set(e,i)},Dae=(e,t)=>t in e,yL=(e,t)=>(0,console.error)(e,t),Vxe=Ji.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],f7e=(...e)=>console.error(...Vxe,...e),Bxe=(...e)=>console.warn(...Vxe,...e),HU=new Map,m7e=[],Nae=[],Gxe=[],g7e=(e,t)=>i=>{e.push(i),oZ||(oZ=!0,t&&pl.$flags$&4?y7e(aZ):pl.raf(aZ))},Fae=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(i){yL(i)}e.length=0},aZ=()=>{Fae(Nae),Fae(Gxe),(oZ=Nae.length>0)&&pl.raf(aZ)},y7e=e=>Pje().then(e),v7e=g7e(Gxe,!0),t4t={isDev:!!Ji.isDev,isBrowser:!0,isServer:!1,isTesting:!!Ji.isTesting};let jxe;function _7e(){d7e(Wh(ji(jxe)))}jxe="components/assets";const Hxe=Symbol("widget"),b7e=[],w7e={},qU=new WeakMap;function qxe(e,t){let i=t.children;if(i&&i.length)for(let s=0;s<i.length;++s)i[s]=qxe(e,i[s]);else i=b7e;const r=t.vnodeSelector;if(_ee(r)){const s=t.properties||w7e,n=s.key||r;return{vnodeSelector:"div",properties:{key:n,afterCreate:x7e,afterUpdate:T7e,afterRemoved:Wxe,parentWidget:e,widgetConstructor:r,widgetProperties:me(F({},s),{key:n,children:i})},children:void 0,text:void 0,domNode:null}}return t}function x7e(e,t,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=e,qU.set(e,o),(a=o.afterCreate)==null||a.call(o,o,e),r._internalHandles.add(Fo(()=>Wxe(e)))}function T7e(e,t,i,{widgetProperties:r}){var n;const s=qU.get(e);s&&(s.set(r),(n=s.afterUpdate)==null||n.call(s,s,e))}function Wxe(e){const t=qU.get(e);t&&(t.destroy(),qU.delete(e))}function _ee(e){return typeof e=="function"&&e[Hxe]}const kae=new Set;function S7e(e){kae.add(e),e.finally(()=>kae.delete(e))}const Zxe="esri.widgets.Widget",E7e=ve.getLogger(Zxe);let C7e=0;const A7e={widgetIcon:"esri-icon-checkbox-unchecked"};function Xxe(e,t){for(const i in t)e[i]!=null&&(typeof e[i]=="object"&&typeof t[i]=="object"?Xxe(e[i],t[i]):e[i]=t[i]);return e}const M7e=Mje({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,i=/capture$/i;e.eventHandlerInterceptor=(r,s,n,o)=>{const a=t(r,s,n,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const c=r[2].toLowerCase()+r.slice(3),h=m=>a.call(n,m);n.addEventListener(c,h,l);const p=()=>n.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),p()}}return a}},handleInterceptedEvent(e,t,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=t.properties;(a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,a in l))&&(gxe(),e.scheduleRender(),l[a].call(l.bind||i,r))}});let r9=!1,wo=class extends nB(cs.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new Nt,this._projector=M7e,this._readyForTrueRender=!1,this.domNode=null,this.iconClass=A7e.widgetIcon,this.label=this.declaredClass.split(".").pop(),this.visible=!0,this.key=this,this._loadLocale=UV(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const n=await Us(this._messageBundleProps.map(async({bundlePath:o,propertyName:a})=>{let l=await hbe(o);this.uiStrings&&Object.keys(this.uiStrings)&&(l=Xxe(ue(l),this.uiStrings)),this[a]=l}));for(const o of n)o.error&&E7e.error("widget-intl:locale-error",this.declaredClass,o.error)}await this.loadLocale()}),_7e();const i="esri-widget-uid-"+AB(),r=this.render.bind(this);this._trackingTarget=new zV(()=>this.scheduleRender());const s=()=>{var h;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:i,class:"",styles:{display:"none"}},domNode:void 0,children:void 0,text:void 0};const n=r();let{properties:o}=n;o||(n.properties=o={});let{key:a,styles:l}=o;a||(o.key=i),l||(o.styles=l={}),l.display||(l.display="");let c=0;return(h=n.children)==null||h.forEach(p=>{if(_ee(p.vnodeSelector))return;let{properties:f}=p;f||(p.properties=f={}),f.key||(f.key=`${this.id}--${c++}`)}),qxe(this,n)};this.render=()=>{if(r9)return s();let n=ije(this);if(n)return n;this._trackingTarget.clear(),r9=!0;try{n=uv(this._trackingTarget,s)}catch(o){throw console.error(o),o}finally{r9=!1}return rje(this,n),n},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),S7e(this._resourcesFetch)}normalizeCtorArgs(e,t){const i=F({},e);return t&&(i.container=t),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(sU)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(We(this._trackingTarget),We(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,t9(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return fL(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+C7e++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}get test(){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(t9(this),this._projector.scheduleRender())}classes(...e){return CT.apply(this,e)}renderNow(){t9(this),this._projector.renderNow()}_postInitialize(){var t;if(this.destroyed)return;this.scheduleRender(),((t=this._delegatedEventNames)==null?void 0:t.length)&&this._internalHandles.add(re(()=>this.viewModel,(i,r)=>{r&&this._internalHandles.remove("delegated-events"),i&&NV(i)&&this._internalHandles.add(this._delegatedEventNames.map(s=>jS(i,s,n=>{this.emit(s,n)})),"delegated-events")},Et)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(sU),this.scheduleRender()};this._internalHandles.add([L_e(e),re(()=>this.uiStrings,e),Jn(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};wo[Hxe]=!0,u([d()],wo.prototype,"_readyForTrueRender",void 0),u([d({value:null})],wo.prototype,"container",null),u([Jt("container")],wo.prototype,"castContainer",null),u([d({aliasOf:"container"})],wo.prototype,"domNode",void 0),u([d()],wo.prototype,"iconClass",void 0),u([d()],wo.prototype,"id",null),u([d()],wo.prototype,"label",void 0),u([d()],wo.prototype,"renderable",null),u([d()],wo.prototype,"uiStrings",void 0),u([d()],wo.prototype,"viewModel",void 0),u([d()],wo.prototype,"visible",void 0),u([d()],wo.prototype,"key",void 0),u([d()],wo.prototype,"children",void 0),u([d()],wo.prototype,"afterCreate",void 0),u([d()],wo.prototype,"afterUpdate",void 0),u([d()],wo.prototype,"afterRemoved",void 0),wo=u([L(Zxe)],wo);const Yr=wo;function bee(e,t,i){return e.units[t][i]}function Kg(e,t,i,r=2,s="abbr"){return`${Wl(t,{minimumFractionDigits:r,maximumFractionDigits:r})} ${bee(e,i,s)}`}function OB(e,t,i,r=2,s="abbr"){return`${Wl(t,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:"exceptZero"})} ${bee(e,i,s)}`}function i4t(e,t,i,r=2,s="abbr"){const n=UK(t,i);return Kg(e,tr(t,i,n),n,r,s)}function r4t(e,t,i,r=2,s="abbr"){const n=UK(t,i);return OB(e,tr(t,i,n),n,r,s)}function s4t(e,t,i,r=2,s="abbr"){const n=zK(t,i);return Kg(e,tr(t,i,n),n,r,s)}function n4t(e,t,i,r=2,s="abbr"){const n=zK(t,i);return OB(e,tr(t,i,n),n,r,s)}function o4t(e,t,i,r=2,s="abbr"){const n=VK(t,i);return Kg(e,tr(t,i,n),n,r,s)}function a4t(e,t,i,r=2,s="abbr"){const n=VK(t,i);return OB(e,tr(t,i,n),n,r,s)}function l4t(e,t,i,r=2,s="abbr"){const n=BK(t,i);return Kg(e,tr(t,i,n),n,r,s)}function c4t(e,t,i,r=2,s="abbr"){const n=BK(t,i);return OB(e,tr(t,i,n),n,r,s)}function u4t(e,t,i,r=2,s="abbr"){const n=O6e(t,i);return Kg(e,tr(t,i,n),n,r,s)}function h4t(e,t,i,r=2,s="abbr"){const n=R6e(t,i);return Kg(e,tr(t,i,n),n,r,s)}function Uae(e,t,i,r,s){const n=VV.normalize(O7e(tr(e,t,"degrees"),i,r),0,!0);return s=Ye(s,2),Wl(n,{style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:s,minimumFractionDigits:s})}function O7e(e,t,i){if(t===i)return e;switch(i){case"arithmetic":return R7e(e);case"geographic":return P7e(e)}}function R7e(e){return 90-e}function P7e(e){return-e-90}function d4t(e,t,i,r,s){i!==r&&(e=-e);const n=tr(e,t,"degrees")%360;return s=Ye(s,2),Wl(n,{style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:s,minimumFractionDigits:s,signDisplay:"exceptZero"})}const zae=["B","kB","MB","GB","TB"];function I7e(e,t){let i=t===0?0:Math.floor(Math.log(t)/Math.log(Rb.KILOBYTES));i=He(i,0,zae.length-1);const r=Wl(t/Rb.KILOBYTES**i,{maximumFractionDigits:2});return Bg(e.units.bytes[zae[i]],{fileSize:r})}function $7e(e){const{exifInfo:t,exifName:i,tagName:r}=e;if(!t||!i||!r)return null;const s=t.find(n=>n.name===i);return s?L7e({tagName:r,tags:s.tags}):null}function L7e(e){const{tagName:t,tags:i}=e;if(!i||!t)return null;const r=i.find(s=>s.name===t);return r&&r.value||null}var lZ;const D7e={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let nu=lZ=class extends Ce{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=$7e({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return D7e[t]||null}clone(){return new lZ({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};u([d({type:String})],nu.prototype,"contentType",void 0),u([d()],nu.prototype,"exifInfo",void 0),u([d({readOnly:!0})],nu.prototype,"orientationInfo",null),u([d({type:Zr})],nu.prototype,"id",void 0),u([d({type:String})],nu.prototype,"globalId",void 0),u([d({type:String})],nu.prototype,"keywords",void 0),u([d({type:String})],nu.prototype,"name",void 0),u([d({json:{read:!1}})],nu.prototype,"parentGlobalId",void 0),u([d({json:{read:!1}})],nu.prototype,"parentObjectId",void 0),u([d({type:Zr})],nu.prototype,"size",void 0),u([d({json:{read:!1}})],nu.prototype,"url",void 0),nu=lZ=u([L("esri.layers.support.AttachmentInfo")],nu);const N7e=nu;var cZ;let Ca=cZ=class extends Ce{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new cZ(ue({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([d({type:[String],json:{write:!0}})],Ca.prototype,"attachmentTypes",void 0),u([d({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Ca.prototype,"attachmentsWhere",void 0),u([d({type:Boolean,json:{write:!0}})],Ca.prototype,"cacheHint",void 0),u([d({type:[String],json:{write:!0}})],Ca.prototype,"keywords",void 0),u([d({type:[Number],json:{write:!0}})],Ca.prototype,"globalIds",void 0),u([d({json:{write:!0}})],Ca.prototype,"name",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Ca.prototype,"num",void 0),u([d({type:[Number],json:{write:!0}})],Ca.prototype,"objectIds",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Ca.prototype,"returnMetadata",void 0),u([d({type:[Number],json:{write:!0}})],Ca.prototype,"size",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Ca.prototype,"start",void 0),u([it("start"),it("num")],Ca.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Ca.prototype,"where",void 0),Ca=cZ=u([L("esri.rest.support.AttachmentQuery")],Ca),Ca.from=dn(Ca);const uZ=Ca,F7e="esri.widgets.Feature.support.featureUtils",Vae=ve.getLogger(F7e),k7e=/href=(""|'')/gi,U7e=/(\{([^\{\r\n]+)\})/g,z7e=/\'/g,Yxe=/^\s*expression\//i,V7e=/(\n)/gi,B7e=/[\u00A0-\u9999<>\&]/gim,G7e=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,j7e=/^(?:mailto:|tel:)/,Jxe="relationships/",hZ=HV("short-date-short-time");function Qxe(e){if(!M(e))return e.get("sourceLayer")||e.get("layer")}async function WU(e,t){return typeof e=="function"?e.call(null,t):e}function Kxe(e=""){if(e)return!j7e.test(e.trim().toLowerCase())}function eTe(e){return!!e&&Yxe.test(e)}function H7e(e,t){if(!eTe(t)||!e)return null;const i=t.replace(Yxe,"").toLowerCase();let r;return e.some(s=>s.name.toLowerCase()===i&&(r=s,!0)),r}function tTe(e,t){const i=H7e(t,e==null?void 0:e.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function q7e(e,t){const i=t.get(e.toLowerCase());return`{${i&&i.fieldName||e}}`}function W7e(e){return e.replace(k7e,"")}function ZU(e,t){const i=wee(t,e);return i?i.name:e}function Z7e(e,t){return e&&e.map(i=>ZU(i,t))}function wee(e,t){return e&&typeof e.getField=="function"?e.getField(t):null}function iTe(e){return`${e}`.trim()}function MT({attributes:e,globalAttributes:t,layer:i,text:r,expressionAttributes:s,fieldInfoMap:n}){return r?dZ({formattedAttributes:t,template:Q7e(r,F(F(F({},t),s),e),i),fieldInfoMap:n}):""}function dZ({formattedAttributes:e,template:t,fieldInfoMap:i}){return iTe(W7e(Bg(Bg(t,r=>q7e(r,i)),e)))}function X7e(e,t,i=!1){const r=t[e];if(typeof r=="string"){const s="%27",n=(i?encodeURIComponent(r):r).replace(z7e,s);t[e]=n}}function Y7e(e,t=!1){const i=F({},e);return Object.keys(i).forEach(r=>X7e(r,i,t)),i}function J7e(e,t,i){const r=(t=iTe(t))&&t[0]!=="{";return Bg(e,Y7e(i,r))}function pZ(e,t){return e.replace(U7e,(i,r,s)=>{const n=wee(t,s);return n?`{${n.name}}`:r})}function Q7e(e,t,i){const r=pZ(e,i);return r&&r.replace(G7e,(s,n,o)=>J7e(s,n||o,t))}function K7e(e,t){if(typeof e=="string"&&t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)){const i=Number(e);if(!isNaN(i))return i}return e}function eHe(e){return(e==null?void 0:e.type)==="feature"}function Bae(e){return!!(e==null?void 0:e.layer)}function tHe(e){return(e==null?void 0:e.type)==="map-image"}function iHe(e,t){var c;const i=t.fieldInfos,r=t.fieldName,s=(c=rTe(i,r))==null?void 0:c.clone(),n=t.preventPlacesFormatting,o=t.layer,a=wee(o,r);if(s&&(a==null?void 0:a.type)==="date"){const h=s.format||new PC;h.dateFormat=h.dateFormat||"short-date-short-time",h.dateTimeFormatOptions=!Bae(o)&&eHe(o)&&o.datesInUnknownTimezone||Bae(o)&&tHe(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,s.format=h}const l=s&&s.format;return typeof e=="string"&&P_e(r)&&l?l.formatRasterPixelValue(e):typeof(e=K7e(e,l))=="string"||e==null||l==null?vL(e):n?Wl(e,me(F({},k_e(l)),{minimumFractionDigits:0,maximumFractionDigits:20})):l.format(e)}function rTe(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let r;return e.some(s=>!(!s.fieldName||s.fieldName.toLowerCase()!==i)&&(r=s,!0)),r}function rHe({fieldName:e,graphic:t,layer:i}){if(z0(e)||!i||typeof i.getFeatureType!="function")return null;const{typeIdField:r}=i;if(!r||e!==r)return null;const s=i.getFeatureType(t);return s?s.name:null}function sHe({fieldName:e,value:t,graphic:i,layer:r}){if(z0(e)||!r||typeof r.getFieldDomain!="function")return null;const s=r.getFieldDomain(e,{feature:i});return s&&s.type==="coded-value"?s.getName(t):null}function nHe(e,t){const{creatorField:i,creationDateField:r,editorField:s,editDateField:n}=e;if(!t)return;const o=t[n];if(typeof o=="number"){const l=t[s];return{type:"edit",date:Sn(o,hZ),user:l}}const a=t[r];if(typeof a=="number"){const l=t[i];return{type:"create",date:Sn(a,hZ),user:l}}return null}function oHe(e,t){const i=new Map;return e&&e.forEach(r=>{const s=ZU(r.fieldName,t);r.fieldName=s,i.set(s.toLowerCase(),r)}),i}function Gae(e){const t=[];if(!e)return t;const{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)&&r.forEach(s=>{if(s.type==="fields"){const n=s&&s.fieldInfos;n&&t.push(...n)}}),t}function xee(e){return e.replace(B7e,t=>`&#${t.charCodeAt(0)};`)}function vL(e){return typeof e=="string"?e.replace(V7e,'<br class="esri-text-new-line" />'):e}function sTe(e){const{value:t,fieldName:i,fieldInfos:r,fieldInfoMap:s,layer:n,graphic:o}=e;if(t==null)return"";const a=sHe({fieldName:i,value:t,graphic:o,layer:n});if(a)return a;const l=rHe({fieldName:i,graphic:o,layer:n});if(l)return l;if(s.get(i.toLowerCase()))return iHe(t,{fieldInfos:r||Array.from(s.values()),fieldName:i,layer:n});const c=n&&n.fieldsIndex;return c&&c.isDateField(i)?Sn(t,hZ):vL(t)}function s9({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:s,relatedInfos:n}){const o={};return n==null||n.forEach(a=>hHe({attributes:o,relatedInfo:a,fieldInfoMap:s,fieldInfos:e,layer:i})),Object.keys(t).forEach(a=>{const l=t[a];o[a]=sTe({fieldName:a,fieldInfos:e,fieldInfoMap:s,layer:i,value:l,graphic:r})}),o}async function aHe(e,t){var h,p;const{layer:i,graphic:r,outFields:s,objectIds:n,returnGeometry:o,spatialReference:a}=e,l=n[0];if(typeof l!="number"&&typeof l!="string"){const f="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:i,graphic:r,objectId:l,requiredFields:s};return Vae.warn(f,m),null}if(!((p=(h=i.capabilities)==null?void 0:h.operations)==null?void 0:p.supportsQuery)){const f="The specified layer cannot be queried. The following fields will not be available.",m={layer:i,graphic:r,requiredFields:s,returnGeometry:o};return Vae.warn(f,m),null}const c=i.createQuery();return c.objectIds=n,c.outFields=(s==null?void 0:s.length)?s:[i.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await i.queryFeatures(c,t)).features[0]}async function lHe(e){var r;if(!((r=e.expressionInfos)==null?void 0:r.length))return!1;const t=await sm(),{arcadeUtils:{hasGeometryFunctions:i}}=t;return i(e)}async function cHe({graphic:e,popupTemplate:t,layer:i,spatialReference:r},s){if(!i||!t||(typeof i.load=="function"&&await i.load(s),!e.attributes))return;const n=e.attributes[i.objectIdField];if(n==null)return;const o=[n],a=await t.getRequiredFields(i.fieldsIndex),l=cze(a,e),c=l?[]:a,h=t.returnGeometry||await lHe(t);if(l&&!h)return;const p=await aHe({layer:i,graphic:e,outFields:c,objectIds:o,returnGeometry:h,spatialReference:r},s);p&&(p.geometry&&(e.geometry=p.geometry),p.attributes&&(e.attributes=F(F({},e.attributes),p.attributes)))}function z0(e=""){return!!e&&e.includes(Jxe)}function uHe(e){return e?`${Jxe}${e.layerId}/${e.fieldName}`:""}function jae({attributes:e,graphic:t,relatedInfo:i,fieldInfos:r,fieldInfoMap:s,layer:n}){e&&t&&i&&Object.keys(t.attributes).forEach(o=>{const a=uHe({layerId:i.relation.id.toString(),fieldName:o}),l=t.attributes[o];e[a]=sTe({fieldName:a,fieldInfos:r,fieldInfoMap:s,layer:n,value:l,graphic:t})})}function hHe({attributes:e,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s}){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach(n=>jae({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s})),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach(n=>jae({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s})))}const Hae=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},nTe=({layer:e,method:t,query:i,definitionExpression:r})=>{var o,a;if(!((a=(o=e.capabilities)==null?void 0:o.query)==null?void 0:a.supportsCacheHint)||t==="attachments")return;const s=_(i.where)&&i.where,n=_(i.geometry)&&i.geometry;Hae(r)||Hae(s)||(n==null?void 0:n.type)==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},dHe=({query:e,layer:t,method:i})=>{nTe({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},pHe=({queryPayload:e,layer:t,method:i})=>{nTe({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},qae={editing:!1,operations:{add:!0,update:!0,delete:!0}},oTe=nt.ofType(N7e),fHe="graphic.layer.capabilities.operations.supportsResizeAttachments";let Kp=class extends Ee{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities=F({},qae),this.activeAttachmentInfo=null,this.attachmentInfos=new oTe,this.graphic=null,this.mode="view",this.own(re(()=>this.graphic,()=>this._graphicChanged(),Et))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return F(F({},qae),e)}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get(fHe)||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new W("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getFeatureId(),r=new uZ({objectIds:[i],returnMetadata:!0}),s=[],n=e.queryAttachments(r).then(a=>a[i]||s).catch(()=>s);this._getAttachmentsPromise=n,this.notifyChange("state");const o=await n;return t.removeAll(),o.length&&t.addMany(o),this._getAttachmentsPromise=null,this.notifyChange("state"),o}async addAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new W("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!s.operations.add)throw new W("invalid-abilities","addAttachment(): add abilities are required.");if(!t||typeof t.addAttachment!="function")throw new W("invalid-layer","addAttachment(): A valid layer is required.");const n=t.addAttachment(r,e).then(a=>this._queryAttachment(a.objectId)),o=await n;return i.add(o),o}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new W("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations.delete)throw new W("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new W("invalid-layer","deleteAttachment(): A valid layer is required.");const n=t.deleteAttachments(r,[e.id]).then(()=>e),o=await n;return i.remove(o),o}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:i,attachmentInfos:r,graphic:s,abilities:n}=this;if(!e)throw new W("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new W("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!n.operations.update)throw new W("invalid-abilities","updateAttachment(): Update abilities are required.");const o=r.findIndex(c=>c===t);if(!i||typeof i.updateAttachment!="function")throw new W("invalid-layer","updateAttachment(): A valid layer is required.");const a=i.updateAttachment(s,t.id,e).then(c=>this._queryAttachment(c.objectId)),l=await a;return r.splice(o,1,l),l}async _queryAttachment(e){if(!e)throw new W("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:t}=this,i=this._getFeatureId(),r=new uZ({objectIds:[i],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return t.queryAttachments(r).then(s=>s[i][0])}_getFeatureId(){const{_attachmentLayer:e,graphic:t}=this;if(!e||!t)return null;const{objectIdField:i}=e,{attributes:r}=t;return r&&r[i]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,t=Qxe(e);this._attachmentLayer=t?t.type==="scene"&&_(t.associatedLayer)?t.associatedLayer:t:null}};u([d()],Kp.prototype,"abilities",void 0),u([Jt("abilities")],Kp.prototype,"castAbilities",null),u([d()],Kp.prototype,"activeAttachmentInfo",void 0),u([d({readOnly:!0,type:oTe})],Kp.prototype,"attachmentInfos",void 0),u([d({type:Ha})],Kp.prototype,"graphic",void 0),u([d()],Kp.prototype,"mode",void 0),u([d({readOnly:!0})],Kp.prototype,"state",null),u([d({readOnly:!0})],Kp.prototype,"supportsResizeAttachments",null),Kp=u([L("esri.widgets.Attachments.AttachmentsViewModel")],Kp);const Tee=Kp;function mHe(e){const t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function gHe(e){const t=ji("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}function pr(e){return(t,i)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:i})}}var yHe=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},aTe=function(e,t){for(var i=0,r=e.length;i<r;i++){var s=e[i];Array.isArray(s)?aTe(s,t):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=yHe(s)),t.push(s))}},vHe=function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:e,properties:t||void 0,children:void 0,text:i[0],domNode:null};var s=[];return aTe(i,s),{vnodeSelector:e,properties:t||void 0,children:s,text:void 0,domNode:null}};function N(e,t,...i){return typeof e!="function"||_ee(e)?vHe(e,t,...i):e(t,...i)}function y5(...e){return e}const Wae={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},yt={base:"esri-attachments",loaderContainer:"esri-attachments__loader-container",loader:"esri-attachments__loader",fadeIn:"esri-attachments--fade-in",container:"esri-attachments__container",containerList:"esri-attachments__container--list",containerPreview:"esri-attachments__container--preview",actions:"esri-attachments__actions",deleteButton:"esri-attachments__delete-button",addAttachmentButton:"esri-attachments__add-attachment-button",errorMessage:"esri-attachments__error-message",items:"esri-attachments__items",item:"esri-attachments__item",itemButton:"esri-attachments__item-button",itemMask:"esri-attachments__item-mask",itemMaskIcon:"esri-attachments__item-mask--icon",itemImage:"esri-attachments__image",itemImageResizable:"esri-attachments__image--resizable",itemLabel:"esri-attachments__label",itemFilename:"esri-attachments__filename",itemChevronIcon:"esri-attachments__item-chevron-icon",itemLink:"esri-attachments__item-link",itemLinkOverlay:"esri-attachments__item-link-overlay",itemLinkOverlayIcon:"esri-attachments__item-link-overlay-icon",itemEditIcon:"esri-attachments__item-edit-icon",itemAddIcon:"esri-attachments__item-add-icon",itemAddButton:"esri-attachments__item-add-button",formNode:"esri-attachments__form-node",fileFieldset:"esri-attachments__file-fieldset",fileLabel:"esri-attachments__file-label",fileName:"esri-attachments__file-name",fileInput:"esri-attachments__file-input",metadata:"esri-attachments__metadata",metadataFieldset:"esri-attachments__metadata-fieldset",progressBar:"esri-attachments__progress-bar",esriWidget:"esri-widget",esriButton:"esri-button",buttonDisabled:"esri-button--disabled",esriButtonSecondary:"esri-button--secondary",esriButtonTertiary:"esri-button--tertiary",esriButtonThird:"esri-button--third",esriButtonSmall:"esri-button--small",esriButtonHalf:"esri-button--half",empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},n9=window.CSS;let El=class extends Yr{constructor(e,t){super(e,t),this.abilities=null,this.displayType="auto",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new Tee,this.visibleElements=F({},Wae),this._supportsImageOrientation=n9&&n9.supports&&n9.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own([os(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),re(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),Et)])}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}castVisibleElements(e){return F(F({},Wae),e)}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new W("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new W("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new W("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}render(){const{submitting:e,viewModel:t}=this,{state:i}=t;return N("div",{class:this.classes(yt.base,yt.esriWidget)},e?this.renderProgressBar():null,i==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?N("div",{key:"error-message",class:yt.errorMessage},e.message):null}renderAttachments(){const{mode:e,activeAttachmentInfo:t}=this.viewModel;return e==="add"?this.renderAddForm():e==="edit"?this.renderDetailsForm(t):this.renderAttachmentContainer()}renderLoading(){return N("div",{class:yt.loaderContainer,key:"loader"},N("div",{class:yt.loader}))}renderProgressBar(){return this.visibleElements.progressBar?N("div",{class:yt.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,i=e||!t,r=this.visibleElements.cancelAddButton?N("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(yt.esriButton,yt.esriButtonTertiary,yt.esriButtonSmall,yt.esriButtonHalf,e&&yt.buttonDisabled)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?N("button",{type:"submit",disabled:i,class:this.classes(yt.esriButton,yt.esriButtonSecondary,yt.esriButtonSmall,yt.esriButtonHalf,{[yt.buttonDisabled]:i})},this.messages.add):null,n=t?N("span",{key:"file-name",class:yt.fileName},t.name):null,o=N("form",{bind:this,afterCreate:AT,afterRemoved:_ae,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},N("fieldset",{class:yt.fileFieldset},n,N("label",{class:this.classes(yt.fileLabel,yt.esriButton,yt.esriButtonSecondary)},t?this.messages.changeFile:this.messages.selectFile,N("input",{class:yt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,r);return N("div",{key:"add-form-container",class:yt.formNode},o)}renderDetailsForm(e){const{visibleElements:t,viewModel:i,selectedFile:r,submitting:s}=this,{contentType:n,size:o,url:a}=e,{abilities:l}=i,c=s||!r,h=l.editing&&l.operations.delete&&t.deleteButton?N("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:S=>this._submitDeleteAttachment(S,e),class:this.classes(yt.esriButton,yt.esriButtonSmall,yt.esriButtonTertiary,yt.deleteButton,{[yt.buttonDisabled]:s})},this.messages.delete):null,p=l.editing&&l.operations.update&&t.updateButton?N("button",{disabled:c,key:"update-button",type:"submit",class:this.classes(yt.esriButton,yt.esriButtonSmall,yt.esriButtonThird,{[yt.buttonDisabled]:c})},this.messages.update):null,f=this.visibleElements.cancelUpdateButton?N("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(yt.esriButton,yt.esriButtonSmall,yt.esriButtonTertiary,yt.esriButtonThird,{[yt.buttonDisabled]:s})},this.messages.cancel):null,m=r?N("span",{key:"file-name",class:yt.fileName},r.name):null,g=l.editing&&l.operations.update?N("fieldset",{key:"file",class:yt.fileFieldset},m,N("label",{class:this.classes(yt.fileLabel,yt.esriButton,yt.esriButtonSecondary)},this.messages.changeFile,N("input",{class:yt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,y=N("fieldset",{key:"size",class:yt.metadataFieldset},N("label",null,I7e(this.messagesUnits,o))),x=N("fieldset",{key:"content-type",class:yt.metadataFieldset},N("label",null,n)),b=N("form",{bind:this,afterCreate:AT,afterRemoved:_ae,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},N("div",{class:yt.metadata},y,x),g,N("div",{class:yt.actions},h,f,p));return N("div",{key:"edit-form-container",class:yt.formNode},N("a",{class:yt.itemLink,href:a,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:e,size:400}),N("div",{class:yt.itemLinkOverlay},N("span",{class:yt.itemLinkOverlayIcon},N("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},N("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),N("path",{fill:"none",d:"M0 0h32v32H0z"}))))),b)}renderImageMask({attachmentInfo:e,size:t}){const{supportsResizeAttachments:i}=this.viewModel,{contentType:r,name:s,url:n}=e,o=i&&mHe(r),a=this._getCSSTransform(e,o),l=a?{transform:a,"image-orientation":"none"}:{},c=n.includes("?")?"&":"?",h=o?`${n}${c}w=${t}`:gHe(r),p={[yt.itemMaskIcon]:!o},f={[yt.itemImageResizable]:i};return N("div",{class:this.classes(p,yt.itemMask)},N("img",{styles:l,alt:s,src:h,class:this.classes(f,yt.itemImage)}))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:i}=this,{abilities:r}=i,{name:s,url:n}=e,o=this.renderImageMask({attachmentInfo:e,size:t==="list"?48:400}),a=r.editing?N("span",{"aria-hidden":"true",class:this.classes(yt.itemChevronIcon,jl(this.container)?yt.iconLeft:yt.iconRight)}):null,l=[o,N("label",{class:yt.itemLabel},N("span",{class:yt.itemFilename},s||this.messages.noTitle),a)],c=r.editing?N("button",{key:"details-button",bind:this,class:yt.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},l):N("a",{key:"details-link",class:yt.itemButton,href:n,target:"_blank"},l);return N("li",{class:yt.item,key:e},c)}renderAttachmentContainer(){const{effectiveDisplayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:r,abilities:s}=t,n=r&&r.length,o={[yt.containerList]:e!=="preview",[yt.containerPreview]:e==="preview"},a=s.editing&&s.operations.add&&i.addButton?N("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(yt.esriButton,yt.esriButtonTertiary,yt.addAttachmentButton),type:"button"},N("span",{"aria-hidden":"true",class:this.classes(yt.itemAddIcon,yt.iconPlus)}),this.messages.add):null,l=n?N("ul",{class:yt.items},r.toArray().map(c=>this.renderAttachmentInfo({attachmentInfo:c,displayType:e}))):N("div",{class:yt.empty},this.messages.noAttachments);return N("div",{key:"attachments-container",class:this.classes(yt.container,o)},l,a)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,i=t&&t.files&&t.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.addAttachment()}_submitUpdateAttachment(e){e.preventDefault(),this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeAttachmentInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e,t){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&t&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};u([ze("viewModel.abilities")],El.prototype,"abilities",void 0),u([d()],El.prototype,"displayType",void 0),u([d({readOnly:!0})],El.prototype,"effectiveDisplayType",null),u([ze("viewModel.graphic")],El.prototype,"graphic",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],El.prototype,"label",void 0),u([d(),pr("esri/widgets/Attachments/t9n/Attachments")],El.prototype,"messages",void 0),u([d(),pr("esri/core/t9n/Units")],El.prototype,"messagesUnits",void 0),u([d({readOnly:!0})],El.prototype,"selectedFile",void 0),u([d({readOnly:!0})],El.prototype,"submitting",void 0),u([d({readOnly:!0})],El.prototype,"error",void 0),u([d({type:Tee})],El.prototype,"viewModel",void 0),u([d()],El.prototype,"visibleElements",void 0),u([Jt("visibleElements")],El.prototype,"castVisibleElements",null),El=u([L("esri.widgets.Attachments")],El);const _He=El;let LP=class extends Tee{constructor(e){super(e),this.description=null,this.title=null}};u([d()],LP.prototype,"description",void 0),u([d()],LP.prototype,"title",void 0),LP=u([L("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],LP);const See=LP,bHe={heading:"esri-widget__heading"};function J0(e,t){const i=lTe(e.level),r=`h${i}`;return delete e.level,N(r,me(F({},e),{class:CT(bHe.heading,e.class),role:"heading","aria-level":String(i)}),t)}function lTe(e){return He(Math.ceil(e),1,6)}function wHe(e,t=1){return lTe(e+t)}const o9={base:"esri-feature-element-info",title:"esri-feature-element-info__title",description:"esri-feature-element-info__description"};let GE=class extends Yr{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return N("div",{class:o9.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?N(J0,{level:this.headingLevel,class:o9.title},e):null}renderDescription(){const{description:e}=this;return e?N("div",{key:"description",class:o9.description},e):null}};u([d()],GE.prototype,"description",void 0),u([d()],GE.prototype,"headingLevel",void 0),u([d()],GE.prototype,"title",void 0),GE=u([L("esri.widgets.Feature.support.FeatureElementInfo")],GE);const Eee=GE,xHe={base:"esri-feature-attachments"};let qm=class extends Yr{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new _He,this.description=null,this.displayType=null,this.graphic=null,this.headingLevel=2,this.title=null,this.viewModel=new See}initialize(){this._featureElementInfo=new Eee,this.own([re(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),Et),re(()=>{var e;return(e=this.viewModel)==null?void 0:e.graphic},e=>this.attachmentsWidget.graphic=e,Et)])}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var t;const{attachmentsWidget:e}=this;return N("div",{class:xHe.base},(t=this._featureElementInfo)==null?void 0:t.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){const{description:e,title:t,headingLevel:i}=this;this._featureElementInfo.set({description:e,title:t,headingLevel:i})}};u([d({readOnly:!0})],qm.prototype,"attachmentsWidget",void 0),u([ze("viewModel.description")],qm.prototype,"description",void 0),u([ze("attachmentsWidget.displayType")],qm.prototype,"displayType",void 0),u([ze("viewModel.graphic")],qm.prototype,"graphic",void 0),u([d()],qm.prototype,"headingLevel",void 0),u([ze("viewModel.title")],qm.prototype,"title",void 0),u([d({type:See})],qm.prototype,"viewModel",void 0),qm=u([L("esri.widgets.Feature.FeatureAttachments")],qm);const THe=qm;let W_=class extends pm(Ee){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(re(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},Et))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&(WU(i,{graphic:t}).catch(()=>null),this._set("created",null))}async _createContent(e){const{graphic:t}=this,i=WU(e,{graphic:t}).catch(()=>null);this._loadingPromise=i,this.notifyChange("state");const r=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};u([d({readOnly:!0})],W_.prototype,"created",void 0),u([d()],W_.prototype,"creator",void 0),u([d()],W_.prototype,"destroyer",void 0),u([d({type:Ha})],W_.prototype,"graphic",void 0),u([d({readOnly:!0})],W_.prototype,"state",null),W_=u([L("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],W_);const XU=W_;function Da(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:EHe(e[t])}}}function SHe(e){const{type:t}=e;return e instanceof KeyboardEvent||t==="keyup"||t==="keydown"||t==="keypress"}function EHe(e){return function(t,...i){SHe(t)?$P(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call(this,t,...i)}}function CHe(e){return e.split(",").map(t=>t.trim())}function cTe(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const i=t._delegatedEventNames,r=Array.isArray(e)?e:CHe(e);i.push(...r)}}const uTe="calcite-theme-";function AHe(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"")}function RB(){return AHe().startsWith("dark")}function MHe(){return`${uTe}${RB()?"dark":"light"}`}function OHe(e){RHe(e),e.classList.add(MHe())}function RHe(e){Array.from(e.classList).forEach(t=>{t.startsWith(uTe)&&e.classList.remove(t)})}function YU(e){return e&&typeof e.render=="function"}function hTe(e){return e&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}const a9={base:"esri-feature-content",loaderContainer:"esri-feature-content__loader-container",loader:"esri-feature-content__loader"};let jE=class extends Yr{constructor(e,t){super(e,t),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(r=>{Kxe(r.href)&&!r.hasAttribute("target")&&r.setAttribute("target","_blank")})}}renderLoading(){return N("div",{class:a9.loaderContainer,key:"loader"},N("div",{class:a9.loader}))}renderCreated(){var t;const e=(t=this.viewModel)==null?void 0:t.created;return e?e instanceof HTMLElement?N("div",{key:e,bind:e,afterCreate:this._attachToNode}):YU(e)?N("div",{key:e},!e.destroyed&&e.render()):N("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var t;const e=(t=this.viewModel)==null?void 0:t.state;return N("div",{class:a9.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const t=this;e.appendChild(t)}};u([ze("viewModel.creator")],jE.prototype,"creator",void 0),u([ze("viewModel.graphic")],jE.prototype,"graphic",void 0),u([d({type:XU})],jE.prototype,"viewModel",void 0),jE=u([L("esri.widgets.Feature.FeatureContent")],jE);const v5=jE;let Yy=class extends Ee{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return t==null||t.forEach(r=>{if(!(!r.hasOwnProperty("visible")||r.visible))return;const s=r.clone();s.label=tTe(s,e),i.push(s)}),i}};u([d()],Yy.prototype,"attributes",void 0),u([d({type:[q_e]})],Yy.prototype,"expressionInfos",void 0),u([d()],Yy.prototype,"description",void 0),u([d({type:[uL]})],Yy.prototype,"fieldInfos",void 0),u([d({readOnly:!0})],Yy.prototype,"formattedFieldInfos",null),u([d()],Yy.prototype,"title",void 0),Yy=u([L("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Yy);const PB=Yy,PHe=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function IHe(e){let t=null;return PHe.some(i=>(i.pattern.test(e)&&(t=i),!!t)),t}function $He(e,t){if(typeof t!="string"||!t)return t;const i=IHe(t);if(!i)return t;const r=t.match(i.pattern),s=r&&r[2],n=Bg(Bg(i.label,{messages:e,hierPart:s}),{appName:i.appName}),o=i.target?` target="${i.target}"`:"",a=i.target==="_blank"?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${o} href="$1"${a}>${n}</a>`)}const QO={base:"esri-feature-fields",fieldHeader:"esri-feature-fields__field-header",fieldData:"esri-feature-fields__field-data",fieldDataDate:"esri-feature-fields__field-data--date",esriTable:"esri-widget__table"};let ef=class extends Yr{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new PB,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new Eee,this.own(re(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),Et))}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(e,t){const{attributes:i}=this.viewModel,r=e.fieldName,s=e.label||r,n=i?i[r]==null?"":i[r]:"",o=!(!e.format||!e.format.dateFormat),a=typeof n=="number"&&!o?this._forceLTR(n):$He(this.messagesURIUtils,n),l={[QO.fieldDataDate]:o};return N("tr",{key:`fields-element-info-row-${r}-${t}`},N("th",{key:`fields-element-info-row-header-${r}-${t}`,class:QO.fieldHeader,innerHTML:s}),N("td",{key:`fields-element-info-row-data-${r}-${t}`,class:this.classes(QO.fieldData,l),innerHTML:a}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return(e==null?void 0:e.length)?N("table",{class:QO.esriTable,summary:this.messages.fieldsSummary},N("tbody",null,e.map((t,i)=>this.renderFieldInfo(t,i)))):null}render(){var e;return N("div",{class:QO.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};u([ze("viewModel.attributes")],ef.prototype,"attributes",void 0),u([ze("viewModel.description")],ef.prototype,"description",void 0),u([ze("viewModel.expressionInfos")],ef.prototype,"expressionInfos",void 0),u([ze("viewModel.fieldInfos")],ef.prototype,"fieldInfos",void 0),u([ze("viewModel.title")],ef.prototype,"title",void 0),u([d({type:PB})],ef.prototype,"viewModel",void 0),u([d(),pr("esri/widgets/Feature/t9n/Feature")],ef.prototype,"messages",void 0),u([d(),pr("esri/widgets/support/t9n/uriUtils")],ef.prototype,"messagesURIUtils",void 0),ef=u([L("esri.widgets.Feature.FeatureFields")],ef);const dTe=ef,LHe=/^-?(\d+)(\.(\d+))?$/i;function DHe(e,t){return e-t}function NHe(e,t){let i,r;return i=Number(e.toFixed(t)),i<e?r=i+1/10**t:(r=i,i-=1/10**t),i=Number(i.toFixed(t)),r=Number(r.toFixed(t)),[i,r]}function FHe(e,t,i,r,s){const n=_5(e,t,i,r),o=n.previous==null||n.previous<=s,a=n.next==null||n.next<=s;return o&&a||n.previous+n.next<=2*s}function JU(e){const t=String(e),i=t.match(LHe);if(i&&i[1])return{integer:i[1].split("").length,fractional:i[3]?i[3].split("").length:0};if(t.toLowerCase().includes("e")){const r=t.split("e"),s=r[0],n=r[1];if(s&&n){const o=Number(s);let a=Number(n);const l=a>0;l||(a=Math.abs(a));const c=JU(o);return l?(c.integer+=a,a>c.fractional?c.fractional=0:c.fractional-=a):(c.fractional+=a,a>c.integer?c.integer=1:c.integer-=a),c}}return{integer:0,fractional:0}}function _5(e,t,i,r){const s={previous:null,next:null};if(i!=null){const n=e-i,o=t-i-n;s.previous=Math.floor(Math.abs(100*o/n))}if(r!=null){const n=r-e,o=r-t-n;s.next=Math.floor(Math.abs(100*o/n))}return s}function QU(e,t={}){const i=e.slice(0),{tolerance:r=2,strictBounds:s=!1,indexes:n=i.map((o,a)=>a)}=t;n.sort(DHe);for(let o=0;o<n.length;o++){const a=n[o],l=i[a],c=a===0?null:i[a-1],h=a===i.length-1?null:i[a+1],p=JU(l).fractional;if(p){let f,m=0,g=!1;for(;m<=p&&!g;){const y=NHe(l,m);f=s&&o===0?y[1]:y[0],g=FHe(l,f,c,h,r),m++}g&&(i[a]=f)}}return i}const kHe={maximumFractionDigits:20};function UHe(e){return Wl(e,kHe)}var fZ;let ux=fZ=class extends Ce{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,i){t[i]=e==null?0:e}clone(){return new fZ({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([d({type:Le,json:{type:[Zr],write:!0}})],ux.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],ux.prototype,"label",void 0),u([d({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],ux.prototype,"value",void 0),u([it("value")],ux.prototype,"writeValue",null),ux=fZ=u([L("esri.renderers.visualVariables.support.ColorStop")],ux);const zHe=ux;function IB(e,t,i){return Us(e.map((r,s)=>t.apply(i,[r,s])))}async function VHe(e,t,i){return(await Us(e.map((r,s)=>t.apply(i,[r,s])))).map(r=>r.value)}async function Hu(e){if(M(e))return{ok:!1,error:new Error("no promise provided")};try{return{ok:!0,value:await e}}catch(t){return{ok:!1,error:t}}}async function p4t(e){try{return{ok:!0,value:await e}}catch(t){return cl(t),{ok:!1,error:t}}}function f4t(e){if(e.ok===!0)return e.value;throw e.error}function _L(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function BHe(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function GHe(e,t,i,r,s,n,o,a,l,c,h,p,f,m,g,y){const x=new Float32Array(16);return x[0]=e,x[1]=t,x[2]=i,x[3]=r,x[4]=s,x[5]=n,x[6]=o,x[7]=a,x[8]=l,x[9]=c,x[10]=h,x[11]=p,x[12]=f,x[13]=m,x[14]=g,x[15]=y,x}function jHe(e,t){return new Float32Array(e,t,16)}const HHe=_L();Object.freeze(Object.defineProperty({__proto__:null,create:_L,clone:BHe,fromValues:GHe,createView:jHe,IDENTITY:HHe},Symbol.toStringTag,{value:"Module"}));const qHe=(e,t)=>{const i=hy(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return Gc(i,i)},WHe=(e,t)=>{const i=hy(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return Gc(i,i)},ZHe=(e,t)=>{const i=1-t,r=hy(e,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return Gc(r,r)},XHe=(e,t)=>{const i=Math.sin(t*Math.PI/180),r=Math.cos(t*Math.PI/180),s=hy(e,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return Gc(s,s)},YHe=(e,t)=>{const i=1-2*t,r=hy(e,i,0,0,t,0,i,0,t,0,0,i,t,0,0,0,1);return Gc(r,r)},JHe=(e,t)=>{const i=hy(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return Gc(i,i)},QHe=(e,t)=>{const i=1-t,r=hy(e,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return Gc(r,r)};class $B{constructor(t,i,r){this.strength=t,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(t,i,r){this.strength=xu(t.strength,i.strength,r),this.radius=xu(t.radius,i.radius,r),this.threshold=xu(t.threshold,i.threshold,r)}clone(){return new $B(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:zI(this.radius),strength:this.strength,threshold:this.threshold}}}class LB{constructor(t){this.radius=t,this.type="blur"}interpolate(t,i,r){this.radius=Math.round(xu(t.radius,i.radius,r))}clone(){return new LB(this.radius)}toJSON(){return{type:"blur",radius:zI(this.radius)}}}class H3{constructor(t,i){this.type=t,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,i,r){this.amount=xu(t.amount,i.amount,r),this._updateMatrix()}clone(){return new H3(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const t=this._colorMatrix||_L();switch(this.type){case"brightness":this._colorMatrix=qHe(t,this.amount);break;case"contrast":this._colorMatrix=WHe(t,this.amount);break;case"grayscale":this._colorMatrix=ZHe(t,this.amount);break;case"invert":this._colorMatrix=YHe(t,this.amount);break;case"saturate":this._colorMatrix=JHe(t,this.amount);break;case"sepia":this._colorMatrix=QHe(t,this.amount)}}}class DB{constructor(t,i,r,s){this.offsetX=t,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(t,i,r){this.offsetX=xu(t.offsetX,i.offsetX,r),this.offsetY=xu(t.offsetY,i.offsetY,r),this.blurRadius=xu(t.blurRadius,i.blurRadius,r),this.color[0]=Math.round(xu(t.color[0],i.color[0],r)),this.color[1]=Math.round(xu(t.color[1],i.color[1],r)),this.color[2]=Math.round(xu(t.color[2],i.color[2],r)),this.color[3]=xu(t.color[3],i.color[3],r)}clone(){return new DB(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const t=[...this.color];return t[3]*=255,{type:"drop-shadow",xoffset:zI(this.offsetX),yoffset:zI(this.offsetY),blurRadius:zI(this.blurRadius),color:t}}}class NB{constructor(t){this.angle=t,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,i,r){this.angle=xu(t.angle,i.angle,r),this._updateMatrix()}clone(){return new NB(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const t=this._colorMatrix||_L();this._colorMatrix=XHe(t,this.angle)}}class FB{constructor(t){this.amount=t,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(t,i,r){this.amount=xu(t.amount,i.amount,r)}clone(){return new FB(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function xu(e,t,i){return e+(t-e)*i}function zI(e){return Math.round(1e3*Vc(e))/1e3}function KHe(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new H3(e.type,0);case"saturate":case"brightness":case"contrast":return new H3(e.type,1);case"opacity":return new FB(1);case"hue-rotate":return new NB(0);case"blur":return new LB(0);case"drop-shadow":return new DB(0,0,0,[...vQ("transparent")]);case"bloom":return new $B(0,0,1)}}var m4t=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function g4t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function y4t(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}function pTe(e,t){const i=e.length>t.length?e:t;return(e.length>t.length?t:e).every((r,s)=>r.type===i[s].type)}function fTe(e,t){const i=e.length>t.length?e:t,r=e.length>t.length?t:e;for(let s=r.length;s<i.length;s++)r.push(KHe(i[s]))}function eqe(e){const t=e[0];return!!t&&"type"in t}var Zae,Xae,mTe={exports:{}};function Cee(e){if(!e||e.length===0)return null;if(typeof e=="string"){const i=Yae(e);return i&&i.length!==0?i:null}const t=e.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new W("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:Yae(i.value)}});t.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<t.length-1;i++){if(!pTe(t[i].effects,t[i+1].effects))throw new W("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[i].effects,b:t[i+1].effects});fTe(t[i].effects,t[i+1].effects)}return t.sort((i,r)=>r.scale-i.scale),t}function Yae(e){let t;if(!e)return[];try{t=mTe.exports.parse(e)}catch(i){throw new W("effect:invalid-syntax","Invalid effect syntax",{value:e,error:i})}return t.map(i=>tqe(i))}function tqe(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return iqe(e);case"opacity":return rqe(e);case"hue-rotate":return sqe(e);case"blur":return nqe(e);case"drop-shadow":return oqe(e);case"bloom":return aqe(e)}}catch(t){throw t.details.filter=e,t}throw new W("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function iqe(e){let t=1;return uO(e.parameters,1),e.parameters.length===1&&(t=Tf(e.parameters[0])),new H3(e.name,t)}function rqe(e){let t=1;return uO(e.parameters,1),e.parameters.length===1&&(t=Tf(e.parameters[0])),new FB(t)}function sqe(e){let t=0;return uO(e.parameters,1),e.parameters.length===1&&(t=pqe(e.parameters[0])),new NB(t)}function nqe(e){let t=0;return uO(e.parameters,1),e.parameters.length===1&&(t=Oee(e.parameters[0]),bL(t,e.parameters[0])),new LB(t)}function oqe(e){const t=[];let i=null;for(const r of e.parameters)if(r.type==="color"){if(t.length&&Object.freeze(t),i)throw new W("effect:type-error","Accepts only one color",{});i=fqe(r)}else{const s=Oee(r);if(Object.isFrozen(t))throw new W("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(s),t.length===3&&bL(s,r)}if(t.length<2||t.length>3)throw new W("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new DB(t[0],t[1],t[2]||0,i||gTe("black"))}function aqe(e){let t=1,i=0,r=0;return uO(e.parameters,3),e.parameters[0]&&(t=Tf(e.parameters[0])),e.parameters[1]&&(i=Oee(e.parameters[1]),bL(i,e.parameters[1])),e.parameters[2]&&(r=Tf(e.parameters[2])),new $B(t,i,r)}function uO(e,t){if(e.length>t)throw new W("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function kB(e){if(e.type==="color")return"<color>";if(e.unit){if(Mee[e.unit])return"<length>";if(Aee[e.unit])return"<angle>";if(e.unit==="%")return"<percentage>"}return"<double>"}function bL(e,t){if(e<0)throw new W("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}function lqe(e){if(e.type!=="quantity"||e.unit!==null)throw new W("effect:type-error",`Expected <double>, Actual: ${kB(e)}`,{term:e})}function cqe(e){if(e.type!=="quantity"||e.unit!==null&&e.unit!=="%")throw new W("effect:type-error",`Expected <double> or <percentage>, Actual: ${kB(e)}`,{term:e})}Xae=function(){function e(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function t(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,t.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function i(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function r(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:lD},h=lD,p="none",f=")",m=",",g="(",y="%",x="px",b="cm",S="mm",T="in",C="pt",A="pc",O="deg",D="rad",U="grad",k="turn",B="#",j=".",H="e",K=/^[ \t\n\r]/,ee=/^[a-z\-]/,ce=/^[0-9a-fA-F]/,le=/^[+\-]/,z=/^[0-9]/,q=Yu("none"),Z=kn("none",!1),Y=kn(")",!1),te=kn(",",!1),se=Yu("whitespace"),J=Ty([" ","	",`
`,"\r"],!1,!1),ae=Yu("function"),_e=kn("(",!1),Oe=Yu("identifier"),Be=Ty([["a","z"],"-"],!1,!1),Se=Yu("percentage"),Te=kn("%",!1),Ie=Yu("length"),Ve=kn("px",!1),Ni=kn("cm",!1),Fi=kn("mm",!1),hi=kn("in",!1),Vi=kn("pt",!1),di=kn("pc",!1),ki=Yu("angle"),kr=kn("deg",!1),us=kn("rad",!1),ot=kn("grad",!1),cr=kn("turn",!1),en=Yu("number"),mo=Yu("color"),Fn=kn("#",!1),gl=Ty([["0","9"],["a","f"],["A","F"]],!1,!1),yl=Ty(["+","-"],!1,!1),Qn=Ty([["0","9"]],!1,!1),hd=kn(".",!1),RO=kn("e",!1),h2=function(){return[]},d2=function(ie,Me){return{type:"function",name:ie,parameters:Me||[]}},p2=function(ie,Me){return Me.length>0?uG(ie,Me,3):[ie]},f2=function(ie){return{type:"quantity",value:ie.value,unit:ie.unit}},sw=function(ie){return{type:"color",colorType:ie.type,value:ie.value}},PO=function(ie){return ie},IO=function(){return mm()},$O=function(ie){return{value:ie,unit:"%"}},LO=function(ie){return{value:ie,unit:"px"}},qv=function(ie){return{value:ie,unit:"cm"}},m2=function(ie){return{value:ie,unit:"mm"}},nw=function(ie){return{value:ie,unit:"in"}},g2=function(ie){return{value:ie,unit:"pt"}},Bi=function(ie){return{value:ie,unit:"pc"}},qo=function(ie){return{value:ie,unit:"deg"}},go=function(ie){return{value:ie,unit:"rad"}},vl=function(ie){return{value:ie,unit:"grad"}},wy=function(ie){return{value:ie,unit:"turn"}},Wv=function(ie){return{value:ie,unit:null}},Zv=function(){return{type:"hex",value:mm()}},y2=function(ie){return{type:"function",value:ie}},v2=function(){return{type:"named",value:mm()}},dd=function(){return parseFloat(mm())},ge=0,Ur=0,Xv=[{line:1,column:1}],Jl=0,xy=[],xt=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function mm(){return s.substring(Ur,ge)}function kn(ie,Me){return{type:"literal",text:ie,ignoreCase:Me}}function Ty(ie,Me,Fe){return{type:"class",parts:ie,inverted:Me,ignoreCase:Fe}}function _2(){return{type:"end"}}function Yu(ie){return{type:"other",description:ie}}function ow(ie){var Me,Fe=Xv[ie];if(Fe)return Fe;for(Me=ie-1;!Xv[Me];)Me--;for(Fe={line:(Fe=Xv[Me]).line,column:Fe.column};Me<ie;)s.charCodeAt(Me)===10?(Fe.line++,Fe.column=1):Fe.column++,Me++;return Xv[ie]=Fe,Fe}function b2(ie,Me){var Fe=ow(ie),Ai=ow(Me);return{source:l,start:{offset:ie,line:Fe.line,column:Fe.column},end:{offset:Me,line:Ai.line,column:Ai.column}}}function pi(ie){ge<Jl||(ge>Jl&&(Jl=ge,xy=[]),xy.push(ie))}function K8(ie,Me,Fe){return new t(t.buildMessage(ie,Me),ie,Me,Fe)}function lD(){var ie;return(ie=eG())===a&&(ie=tG()),ie}function eG(){var ie,Me;return xt++,ie=ge,yo(),s.substr(ge,4)===p?(Me=p,ge+=4):(Me=a,xt===0&&pi(Z)),Me!==a?(yo(),Ur=ie,ie=h2()):(ge=ie,ie=a),xt--,ie===a&&xt===0&&pi(q),ie}function tG(){var ie,Me;if(ie=[],(Me=DO())!==a)for(;Me!==a;)ie.push(Me),Me=DO();else ie=a;return ie}function DO(){var ie,Me,Fe,Ai;return ie=ge,yo(),(Me=rG())!==a?(yo(),(Fe=iG())===a&&(Fe=null),yo(),s.charCodeAt(ge)===41?(Ai=f,ge++):(Ai=a,xt===0&&pi(Y)),Ai!==a?(yo(),Ur=ie,ie=d2(Me,Fe)):(ge=ie,ie=a)):(ge=ie,ie=a),ie}function iG(){var ie,Me,Fe,Ai,Wo,Gs,Zc,w2;if(ie=ge,(Me=NO())!==a){for(Fe=[],Ai=ge,Wo=yo(),s.charCodeAt(ge)===44?(Gs=m,ge++):(Gs=a,xt===0&&pi(te)),Gs===a&&(Gs=null),Zc=yo(),(w2=NO())!==a?Ai=Wo=[Wo,Gs,Zc,w2]:(ge=Ai,Ai=a);Ai!==a;)Fe.push(Ai),Ai=ge,Wo=yo(),s.charCodeAt(ge)===44?(Gs=m,ge++):(Gs=a,xt===0&&pi(te)),Gs===a&&(Gs=null),Zc=yo(),(w2=NO())!==a?Ai=Wo=[Wo,Gs,Zc,w2]:(ge=Ai,Ai=a);Ur=ie,ie=p2(Me,Fe)}else ge=ie,ie=a;return ie}function NO(){var ie,Me;return ie=ge,(Me=sG())===a&&(Me=nG())===a&&(Me=oG())===a&&(Me=aG()),Me!==a&&(Ur=ie,Me=f2(Me)),(ie=Me)===a&&(ie=ge,(Me=lG())!==a&&(Ur=ie,Me=sw(Me)),ie=Me),ie}function yo(){var ie,Me;for(xt++,ie=[],K.test(s.charAt(ge))?(Me=s.charAt(ge),ge++):(Me=a,xt===0&&pi(J));Me!==a;)ie.push(Me),K.test(s.charAt(ge))?(Me=s.charAt(ge),ge++):(Me=a,xt===0&&pi(J));return xt--,Me=a,xt===0&&pi(se),ie}function rG(){var ie,Me,Fe;return xt++,ie=ge,(Me=cD())!==a?(s.charCodeAt(ge)===40?(Fe=g,ge++):(Fe=a,xt===0&&pi(_e)),Fe!==a?(Ur=ie,ie=PO(Me)):(ge=ie,ie=a)):(ge=ie,ie=a),xt--,ie===a&&(Me=a,xt===0&&pi(ae)),ie}function cD(){var ie,Me,Fe;if(xt++,ie=ge,Me=[],ee.test(s.charAt(ge))?(Fe=s.charAt(ge),ge++):(Fe=a,xt===0&&pi(Be)),Fe!==a)for(;Fe!==a;)Me.push(Fe),ee.test(s.charAt(ge))?(Fe=s.charAt(ge),ge++):(Fe=a,xt===0&&pi(Be));else Me=a;return Me!==a&&(Ur=ie,Me=IO()),xt--,(ie=Me)===a&&(Me=a,xt===0&&pi(Oe)),ie}function sG(){var ie,Me,Fe;return xt++,ie=ge,yo(),(Me=Wc())!==a?(s.charCodeAt(ge)===37?(Fe=y,ge++):(Fe=a,xt===0&&pi(Te)),Fe!==a?(Ur=ie,ie=$O(Me)):(ge=ie,ie=a)):(ge=ie,ie=a),xt--,ie===a&&xt===0&&pi(Se),ie}function nG(){var ie,Me,Fe;return xt++,ie=ge,yo(),(Me=Wc())!==a?(s.substr(ge,2)===x?(Fe=x,ge+=2):(Fe=a,xt===0&&pi(Ve)),Fe!==a?(Ur=ie,ie=LO(Me)):(ge=ie,ie=a)):(ge=ie,ie=a),ie===a&&(ie=ge,yo(),(Me=Wc())!==a?(s.substr(ge,2)===b?(Fe=b,ge+=2):(Fe=a,xt===0&&pi(Ni)),Fe!==a?(Ur=ie,ie=qv(Me)):(ge=ie,ie=a)):(ge=ie,ie=a),ie===a&&(ie=ge,yo(),(Me=Wc())!==a?(s.substr(ge,2)===S?(Fe=S,ge+=2):(Fe=a,xt===0&&pi(Fi)),Fe!==a?(Ur=ie,ie=m2(Me)):(ge=ie,ie=a)):(ge=ie,ie=a),ie===a&&(ie=ge,yo(),(Me=Wc())!==a?(s.substr(ge,2)===T?(Fe=T,ge+=2):(Fe=a,xt===0&&pi(hi)),Fe!==a?(Ur=ie,ie=nw(Me)):(ge=ie,ie=a)):(ge=ie,ie=a),ie===a&&(ie=ge,yo(),(Me=Wc())!==a?(s.substr(ge,2)===C?(Fe=C,ge+=2):(Fe=a,xt===0&&pi(Vi)),Fe!==a?(Ur=ie,ie=g2(Me)):(ge=ie,ie=a)):(ge=ie,ie=a),ie===a&&(ie=ge,yo(),(Me=Wc())!==a?(s.substr(ge,2)===A?(Fe=A,ge+=2):(Fe=a,xt===0&&pi(di)),Fe!==a?(Ur=ie,ie=Bi(Me)):(ge=ie,ie=a)):(ge=ie,ie=a)))))),xt--,ie===a&&xt===0&&pi(Ie),ie}function oG(){var ie,Me,Fe;return xt++,ie=ge,(Me=Wc())!==a?(s.substr(ge,3)===O?(Fe=O,ge+=3):(Fe=a,xt===0&&pi(kr)),Fe!==a?(Ur=ie,ie=qo(Me)):(ge=ie,ie=a)):(ge=ie,ie=a),ie===a&&(ie=ge,(Me=Wc())!==a?(s.substr(ge,3)===D?(Fe=D,ge+=3):(Fe=a,xt===0&&pi(us)),Fe!==a?(Ur=ie,ie=go(Me)):(ge=ie,ie=a)):(ge=ie,ie=a),ie===a&&(ie=ge,(Me=Wc())!==a?(s.substr(ge,4)===U?(Fe=U,ge+=4):(Fe=a,xt===0&&pi(ot)),Fe!==a?(Ur=ie,ie=vl(Me)):(ge=ie,ie=a)):(ge=ie,ie=a),ie===a&&(ie=ge,(Me=Wc())!==a?(s.substr(ge,4)===k?(Fe=k,ge+=4):(Fe=a,xt===0&&pi(cr)),Fe!==a?(Ur=ie,ie=wy(Me)):(ge=ie,ie=a)):(ge=ie,ie=a)))),xt--,ie===a&&(Me=a,xt===0&&pi(ki)),ie}function aG(){var ie,Me;return xt++,ie=ge,yo(),(Me=Wc())!==a?(Ur=ie,ie=Wv(Me)):(ge=ie,ie=a),xt--,ie===a&&xt===0&&pi(en),ie}function lG(){var ie,Me,Fe,Ai;if(xt++,ie=ge,s.charCodeAt(ge)===35?(Me=B,ge++):(Me=a,xt===0&&pi(Fn)),Me!==a){if(Fe=[],ce.test(s.charAt(ge))?(Ai=s.charAt(ge),ge++):(Ai=a,xt===0&&pi(gl)),Ai!==a)for(;Ai!==a;)Fe.push(Ai),ce.test(s.charAt(ge))?(Ai=s.charAt(ge),ge++):(Ai=a,xt===0&&pi(gl));else Fe=a;Fe!==a?(Ur=ie,ie=Zv()):(ge=ie,ie=a)}else ge=ie,ie=a;return ie===a&&(ie=ge,(Me=DO())!==a&&(Ur=ie,Me=y2(Me)),(ie=Me)===a&&(ie=ge,(Me=cD())!==a&&(Ur=ie,Me=v2()),ie=Me)),xt--,ie===a&&(Me=a,xt===0&&pi(mo)),ie}function Wc(){var ie,Me,Fe,Ai,Wo,Gs,Zc;for(ie=ge,le.test(s.charAt(ge))?(s.charAt(ge),ge++):xt===0&&pi(yl),Me=ge,Fe=[],z.test(s.charAt(ge))?(Ai=s.charAt(ge),ge++):(Ai=a,xt===0&&pi(Qn));Ai!==a;)Fe.push(Ai),z.test(s.charAt(ge))?(Ai=s.charAt(ge),ge++):(Ai=a,xt===0&&pi(Qn));if(s.charCodeAt(ge)===46?(Ai=j,ge++):(Ai=a,xt===0&&pi(hd)),Ai!==a){if(Wo=[],z.test(s.charAt(ge))?(Gs=s.charAt(ge),ge++):(Gs=a,xt===0&&pi(Qn)),Gs!==a)for(;Gs!==a;)Wo.push(Gs),z.test(s.charAt(ge))?(Gs=s.charAt(ge),ge++):(Gs=a,xt===0&&pi(Qn));else Wo=a;Wo!==a?Me=Fe=[Fe,Ai,Wo]:(ge=Me,Me=a)}else ge=Me,Me=a;if(Me===a)if(Me=[],z.test(s.charAt(ge))?(Fe=s.charAt(ge),ge++):(Fe=a,xt===0&&pi(Qn)),Fe!==a)for(;Fe!==a;)Me.push(Fe),z.test(s.charAt(ge))?(Fe=s.charAt(ge),ge++):(Fe=a,xt===0&&pi(Qn));else Me=a;if(Me!==a){if(Fe=ge,s.charCodeAt(ge)===101?(Ai=H,ge++):(Ai=a,xt===0&&pi(RO)),Ai!==a){if(le.test(s.charAt(ge))?(Wo=s.charAt(ge),ge++):(Wo=a,xt===0&&pi(yl)),Wo===a&&(Wo=null),Gs=[],z.test(s.charAt(ge))?(Zc=s.charAt(ge),ge++):(Zc=a,xt===0&&pi(Qn)),Zc!==a)for(;Zc!==a;)Gs.push(Zc),z.test(s.charAt(ge))?(Zc=s.charAt(ge),ge++):(Zc=a,xt===0&&pi(Qn));else Gs=a;Gs!==a?Fe=Ai=[Ai,Wo,Gs]:(ge=Fe,Fe=a)}else ge=Fe,Fe=a;Fe===a&&(Fe=null),Ur=ie,ie=dd()}else ge=ie,ie=a;return ie}function cG(ie,Me){return ie.map(function(Fe){return Fe[Me]})}function uG(ie,Me,Fe){return[ie].concat(cG(Me,Fe))}if((o=h())!==a&&ge===s.length)return o;throw o!==a&&ge<s.length&&pi(_2()),K8(xy,Jl<s.length?s.charAt(Jl):null,Jl<s.length?b2(Jl,Jl+1):b2(Jl,Jl))}return e(t,Error),t.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var h=this.location.end,p=i("",l.line.toString().length),f=a[l.line-1],m=l.line===h.line?h.column:f.length+1;n+=`
 --> `+c+`
`+p+` |
`+l.line+" | "+f+`
`+p+" | "+i("",l.column-1)+i("",m-l.column,"^")}else n+=`
 at `+c}return n},t.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var g=m.parts.map(function(y){return Array.isArray(y)?c(y[0])+"-"+c(y[1]):c(y)});return"["+(m.inverted?"^":"")+g+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function h(m){return o[m.type](m)}function p(m){var g,y,x=m.map(h);if(x.sort(),x.length>0){for(g=1,y=1;g<x.length;g++)x[g-1]!==x[g]&&(x[y]=x[g],y++);x.length=y}switch(x.length){case 1:return x[0];case 2:return x[0]+" or "+x[1];default:return x.slice(0,-1).join(", ")+", or "+x[x.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+p(s)+" but "+f(n)+" found."},{SyntaxError:t,parse:r}},(Zae=mTe).exports&&(Zae.exports=Xae());const Aee={deg:1,grad:.9,rad:180/Math.PI,turn:360};function uqe(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&Aee[e.unit]!=null))throw new W("effect:type-error",`Expected <angle>, Actual: ${kB(e)}`,{term:e})}const Mee={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function hqe(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&Mee[e.unit]!=null))throw new W("effect:type-error",`Expected <length>, Actual: ${kB(e)}`,{term:e})}function Tf(e){cqe(e);const t=e.value;return bL(t,e),e.unit==="%"?.01*t:t}function dqe(e){return lqe(e),bL(e.value,e),e.value}function pqe(e){return uqe(e),e.value*Aee[e.unit]||0}function Oee(e){return hqe(e),e.value*Mee[e.unit]||0}function fqe(e){switch(e.colorType){case"hex":return JFe(e.value);case"named":return gTe(e.value);case"function":return yqe(e.value)}}function gTe(e){if(!T0e(e))throw new W("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return YFe(e)}const mqe=/^rgba?/i,gqe=/^hsla?/i;function yqe(e){if(uO(e.parameters,4),mqe.test(e.name))return[Tf(e.parameters[0]),Tf(e.parameters[1]),Tf(e.parameters[2]),e.parameters[3]?Tf(e.parameters[3]):1];if(gqe.test(e.name))return S0e(dqe(e.parameters[0]),Tf(e.parameters[1]),Tf(e.parameters[2]),e.parameters[3]?Tf(e.parameters[3]):1);throw new W("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}function Ree(e,t,i){var r;try{return _qe(e)}catch(s){(r=i==null?void 0:i.messages)==null||r.push(s)}return null}function Pee(e,t,i,r){try{const s=vqe(e);Bu(i,s,t)}catch(s){r.messages&&r.messages.push(s)}}function vqe(e){const t=Cee(e);return t?eqe(t)?t.map(i=>i.toJSON()):t.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function _qe(e){if(!e||e.length===0)return null;if(bqe(e)){const t=[];for(const i of e)t.push({scale:i.scale,value:KU(i.value)});return t}return KU(e)}function bqe(e){const t=e[0];return!!t&&"scale"in t}function KU(e){if(!e||!e.length)return"";const t=[];for(const i of e){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[Ay(i,"amount")];break;case"blur":r=[Ay(i,"radius","pt")];break;case"hue-rotate":r=[Ay(i,"angle","deg")];break;case"drop-shadow":r=[Ay(i,"xoffset","pt"),Ay(i,"yoffset","pt"),Ay(i,"blurRadius","pt"),wqe(i,"color")];break;case"bloom":r=[Ay(i,"strength"),Ay(i,"radius","pt"),Ay(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;Cee(s),t.push(s)}return t.join(" ")}function Ay(e,t,i){if(e[t]==null)throw new W("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return i?e[t]+i:""+e[t]}function wqe(e,t){if(e[t]==null)throw new W("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const i=e[t];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}const b5=-3;var O0;(function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"})(O0||(O0={}));class xqe{constructor(t,i,r){this._namespace=t,this._storage=i,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(t,i,r,s=0){this._storage.put(this._namespace+t,i,r,s)}get(t){const i=this._storage.get(this._namespace+t);return i===void 0?++this._miss:++this._hit,i}pop(t){const i=this._storage.pop(this._namespace+t);return i===void 0?++this._miss:++this._hit,i}updateSize(t,i,r){this._storage.updateSize(this._namespace+t,i,r)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class Iee{constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new ai,this._users=new ai}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,i){this._removeFuncs.push([t,i])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace(i=>i[0]!==t)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,0),this._checkSizeLimit()}put(t,i,r,s){const n=this._db.get(t);if(n&&(this._size-=n.size,this._db.delete(t),n.entry!==i&&this._notifyRemove(t,n.entry,O0.ALL)),r>this._maxSize)return void this._notifyRemove(t,i,O0.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!r||r<0)return void console.warn("Refusing to cache entry with invalid size "+r);const o=1+Math.max(s,b5)-b5;this._db.set(t,{entry:i,size:r,lifetime:o,lives:o}),this._size+=r,this._checkSizeLimit()}updateSize(t,i,r){const s=this._db.get(t);if(s&&s.entry===i){for(this._size-=s.size;r>this._maxSize;){const n=this._notifyRemove(t,i,O0.SOME);if(!(_(n)&&n>0))return void this._db.delete(t);r=n}s.size=r,this._size+=r,this._checkSizeLimit()}}pop(t){const i=this._db.get(t);if(i)return this._size-=i.size,this._db.delete(t),++this._hit,i.entry;++this._miss}get(t){const i=this._db.get(t);if(i!==void 0)return this._db.delete(t),i.lives=i.lifetime,this._db.set(t,i),++this._hit,i.entry;++this._miss}getStats(){const t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const h=c.namespace;if(a.startsWith(h)){const p=i[h]||0;i[h]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.namespace;if(!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(i);n.sort((o,a)=>i[a]-i[o]),n.forEach(o=>t[o]=Math.round(i[o]/2**20)+"MB / "+s[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(t["Priority "+(o+b5-1)]=Math.round(a/this.size*100)+"%")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll(t=>t.resetHitRate())}clear(t){this._db.forEach((i,r)=>{r.startsWith(t)&&(this._size-=i.size,this._db.delete(r),this._notifyRemove(r,i.entry,O0.ALL))})}clearAll(){this._db.forEach((t,i)=>this._notifyRemove(i,t.entry,O0.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,i,r){let s;return this._removeFuncs.some(n=>{if(t.startsWith(n[0])){const o=n[1](i,r);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[t,i]of this._db){if(this._db.delete(t),i.lives<=1){this._size-=i.size;const r=this._notifyRemove(t,i.entry,O0.SOME);_(r)&&r>0&&(this._size+=r,i.lives=i.lifetime,i.size=r,this._db.set(t,i))}else--i.lives,this._db.set(t,i);if(this._size<=.9*this.maxSize)return}}}class mZ{constructor(t,i){this._storage=new Iee,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}put(t,i){this._storage.put(t,i,1,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}function Tqe(e){return typeof e=="function"}function v4t(e,t,i,r){return Tqe(e)?e(t,i,r):e}function _4t(e){return[e.r,e.g,e.b,e.a]}function b4t(e,t,i){const r=` /-,
`,s=l=>{let c=l.length;for(;c--;)if(!r.includes(l.charAt(c)))return!1;return!0},n=[];let o=0,a=-1;do if(a=t.indexOf("[",o),a>=o){if(a>o){const l=t.substr(o,a-o);n.push([l,null,s(l)])}if(o=a+1,a=t.indexOf("]",o),a>=o){if(a>o){const l=e[t.substr(o,a-o)];l&&n.push([null,l,!1])}o=a+1}}while(a!==-1);if(o<t.length-1){const l=t.substr(o);n.push([l,null,s(l)])}return l=>{let c="",h=null;for(const p of n){const[f,m,g]=p;if(f)g?h=f:(h&&(c+=h,h=null),c+=f);else{const y=l.attributes[m];y&&(h&&(c+=h,h=null),c+=y)}}return Sqe(c,i)}}function Sqe(e,t){switch(typeof e!="string"&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function w4t(e,t,i,r,s,n,o=!0){const a=t/s,l=i/n,c=Math.ceil(a/2),h=Math.ceil(l/2);for(let p=0;p<n;p++)for(let f=0;f<s;f++){const m=4*(f+(o?n-p-1:p)*s);let g=0,y=0,x=0,b=0,S=0,T=0,C=0;const A=(p+.5)*l;for(let O=Math.floor(p*l);O<(p+1)*l;O++){const D=Math.abs(A-(O+.5))/h,U=(f+.5)*a,k=D*D;for(let B=Math.floor(f*a);B<(f+1)*a;B++){let j=Math.abs(U-(B+.5))/c;const H=Math.sqrt(k+j*j);H>=-1&&H<=1&&(g=2*H*H*H-3*H*H+1,g>0&&(j=4*(B+O*t),C+=g*e[j+3],x+=g,e[j+3]<255&&(g=g*e[j+3]/250),b+=g*e[j],S+=g*e[j+1],T+=g*e[j+2],y+=g))}}r[m]=b/y,r[m+1]=S/y,r[m+2]=T/y,r[m+3]=C/x}}function Eqe(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}function UB(e){var t;return(t=e.data)==null?void 0:t.symbol}function ez(e){return e.type==="CIMVectorMarker"||e.type==="CIMPictureMarker"||e.type==="CIMBarChartMarker"||e.type==="CIMCharacterMarker"||e.type==="CIMPieChartMarker"||e.type==="CIMStackedBarChartMarker"}function tz(e){return e.type==="CIMGradientStroke"||e.type==="CIMPictureStroke"||e.type==="CIMSolidStroke"}function yTe(e){return e.type==="CIMGradientFill"||e.type==="CIMHatchFill"||e.type==="CIMPictureFill"||e.type==="CIMSolidFill"||e.type==="CIMWaterFill"}function iz(e){return e.type==="CIMMarkerPlacementAlongLineRandomSize"||e.type==="CIMMarkerPlacementAlongLineSameSize"||e.type==="CIMMarkerPlacementAlongLineVariableSize"||e.type==="CIMMarkerPlacementAtExtremities"||e.type==="CIMMarkerPlacementAtMeasuredUnits"||e.type==="CIMMarkerPlacementAtRatioPositions"||e.type==="CIMMarkerPlacementOnLine"||e.type==="CIMMarkerPlacementOnVertices"}const x4t=e=>isNaN(e)||!e?0:e,T4t=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":return!0}return!1};function S4t(){return import("./geometryEngineJSON.843ccea9.js")}function Cqe(e){const t=UB(e);if(t.type==="CIMTextSymbol")return t.height;let i=0;if(t.symbolLayers)for(const r of t.symbolLayers)ez(r)&&r.size>i?i=r.size:tz(r)&&r.width>i?i=r.width:yTe(r);return i}function E4t(e,t,i){const r=UB(e),s=Cqe(e);if(s===0)return void Aqe(r,t);$ee(r,t/s,!1,i)}function Aqe(e,t){if(e.type!=="CIMTextSymbol"){if(e.symbolLayers)for(const i of e.symbolLayers)switch(i.type){case"CIMPictureMarker":case"CIMVectorMarker":i.size=t;break;case"CIMPictureStroke":case"CIMSolidStroke":i.width=t}}else e.height=t}function $ee(e,t,i,r){if(e.type!=="CIMTextSymbol"){if(i&&e.effects)for(const s of e.effects)Rqe(s,t);if(e.symbolLayers)for(const s of e.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":Mqe(s,t,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!(r==null?void 0:r.preserveOutlineWidth)&&s.width&&(s.width*=t);break;case"CIMPictureFill":s.height&&(s.height*=t),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t);break;case"CIMHatchFill":$ee(s.lineSymbol,t,!0,me(F({},r),{preserveOutlineWidth:!1})),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t),s.separation&&(s.separation*=t)}}else e.height*=t}function Mqe(e,t,i){if(e.markerPlacement&&Oqe(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&e.anchorPointUnits==="Absolute"&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size*=t,e.type==="CIMVectorMarker"&&e.markerGraphics)for(const r of e.markerGraphics)e.scaleSymbolsProportionally||$ee(r.symbol,t,!0,i)}function Oqe(e,t){switch(iz(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map(r=>r*t);e.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map(r=>r*t);e.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}function Rqe(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const i=e.dashTemplate.map(r=>r*t);e.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function Pqe(e){const t=[];return gZ(UB(e),t),t.length?new Le(Eqe(t[0])):null}function gZ(e,t){let i;i=e.type==="CIMTextSymbol"?e.symbol:e;const r=e.type==="CIMPolygonSymbol";if(i.symbolLayers){for(const s of i.symbolLayers)if(!(s.colorLocked||r&&(tz(s)||ez(s)&&s.markerPlacement&&iz(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor&&Jae(t,s.tintColor);break;case"CIMVectorMarker":s.markerGraphics.forEach(n=>{gZ(n.symbol,t)});break;case"CIMSolidStroke":case"CIMSolidFill":Jae(t,s.color);break;case"CIMHatchFill":gZ(s.lineSymbol,t)}}}function Jae(e,t){for(const i of e)if(i.join(".")===t.join("."))return;e.push(t)}function vTe(e,t,i){t instanceof Le||(t=new Le(t));const r=UB(e);r&&yZ(r,t,i)}function yZ(e,t,i){let r;r=e.type==="CIMTextSymbol"?e.symbol:e;const s=r.type==="CIMPolygonSymbol";if(r.symbolLayers)for(const n of r.symbolLayers){if(n.colorLocked)continue;if(s){if(i){const{layersToColor:a}=i;if((tz(n)||ez(n)&&n.markerPlacement&&iz(n.markerPlacement))&&a==="fill"||yTe(n)&&a==="outline")continue}else if(tz(n)||ez(n)&&n.markerPlacement&&iz(n.markerPlacement))continue}const o=t.toArray();switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor=o;break;case"CIMVectorMarker":n.markerGraphics.forEach(a=>{yZ(a.symbol,t,i)});break;case"CIMSolidStroke":case"CIMSolidFill":n.color=o;break;case"CIMHatchFill":yZ(n.lineSymbol,t,i)}}}const _Te="picture-fill",bTe="simple-fill",Iqe="simple-line",wTe="simple-marker",$qe="text",Lqe="cim",l9=new mZ(1e3);function Dqe(e){const t=e.style;let i=null;if(e)switch(e.type){case wTe:t!=="cross"&&t!=="x"&&(i=e.color);break;case bTe:t==="solid"?i=e.color:t!=="none"&&(i={type:"pattern",x:0,y:0,src:ji(`esri/symbols/patterns/${t}.png`),width:5,height:5});break;case _Te:i={type:"pattern",src:e.url,width:$i(e.width)*e.xscale,height:$i(e.height)*e.yscale,x:$i(e.xoffset),y:$i(e.yoffset)};break;case $qe:i=e.color;break;case Lqe:i=Pqe(e)}return i}function Nqe(e,t){const i=e+"-"+t;return l9.get(i)!==void 0?Promise.resolve(l9.get(i)):Zt(e,{responseType:"image"}).then(r=>{const s=r.data,n=s.naturalWidth,o=s.naturalHeight,a=document.createElement("canvas");a.width=n,a.height=o;const l=a.getContext("2d");l.fillStyle=t,l.fillRect(0,0,n,o),l.globalCompositeOperation="destination-in",l.drawImage(s,0,0);const c=a.toDataURL();return l9.put(i,c),c})}function q3(e){if(!e)return null;let t;switch(e.type){case bTe:case _Te:case wTe:t=q3(e.outline);break;case Iqe:{const i=$i(e.width);e.style!=="none"&&i!==0&&(t={color:e.color,style:Lee(e.style),width:i,cap:e.cap,join:e.join==="miter"?$i(e.miterLimit):e.join});break}default:t=null}return t}const Lee=(()=>{const e={};return t=>{if(e[t])return e[t];const i=t.replace(/-/g,"");return e[t]=i,i}})(),Fqe=new Le([128,128,128]),Qae=/\/resource\/(.*?)\.svg$/,kqe=new Le("white");function Uqe(e){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const i=e.symbolLayers.getItemAt(t-1);return"outline"in i?Wr(i,"outline","size"):void 0}function zqe(e){if(!e)return 0;if(om(e)){const i=Uqe(e);return _(i)?i:0}const t=q3(e);return t&&Vc(t.width)||0}function zB(e){if(M(e)||!("symbolLayers"in e)||M(e.symbolLayers))return!1;switch(e.type){case"point-3d":return e.symbolLayers.some(t=>t.type==="object");case"line-3d":return e.symbolLayers.some(t=>t.type==="path");case"polygon-3d":return e.symbolLayers.some(t=>t.type==="object"||t.type==="extrude");default:return!1}}function xTe(e,t){const i=t.resource.href;return!ye("esri-canvas-svg-support")&&e.styleOrigin&&Qae.test(i)?i.replace(Qae,"/resource/png/$1.png"):i}function M2(e,t){if(!e)return null;let i=null;return om(e)?i=Vqe(e):cB(e)&&(i=e.color?new Le(e.color):null),i?W3(i,t):null}function Vqe(e){const t=e.symbolLayers;if(!t)return null;let i=null;return t.forEach(r=>{r.type==="object"&&r.resource.href!=null||(i=r.type==="water"?r.color:_(r.material)?r.material.color:null)}),i?new Le(i):null}function W3(e,t){if(t==null)return e;const i=e.toRgba();return i[3]=i[3]*t,new Le(i)}function Bqe(e,t,i){const r=e.symbolLayers;if(!r)return;const s=n=>{const o=_(n)?n:null;return W3(t=t||o||i!=null&&kqe,i)};r.forEach(n=>{if(n.type!=="object"||n.resource.href==null||t)if(n.type==="water")n.color=s(n.color);else{const o=_(n.material)?n.material.color:null,a=s(o);M(n.material)?n.material=new Yh({color:a}):n.material.color=a,i!=null&&"outline"in n&&_(n.outline)&&_(n.outline.color)&&(n.outline.color=W3(n.outline.color,i))}})}function Gqe(e,t,i){(t=t||e.color)&&(e.color=W3(t,i)),i!=null&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=W3(e.outline.color,i))}function c9(e,t,i){e&&(t||i!=null)&&(t&&(t=new Le(t)),om(e)?Bqe(e,t,i):cB(e)&&Gqe(e,t,i))}async function jqe(e,t){const i=e.symbolLayers;i&&await IB(i,async r=>Hqe(r,t))}async function Hqe(e,t){switch(e.type){case"extrude":Wqe(e,t);break;case"icon":case"line":case"text":qqe(e,t);break;case"path":Xqe(e,t);break;case"object":await Zqe(e,t)}}function qqe(e,t){const i=TTe(t);_(i)&&(e.size=i)}function TTe(e){for(const t of e)if(typeof t=="number")return t;return null}function Wqe(e,t){e.size=typeof t[2]=="number"?t[2]:0}async function Zqe(e,t){const{resourceSize:i,symbolSize:r}=await Yqe(e),s=STe(t,i,r);e.width=VI(t[0],r[0],i[0],s),e.depth=VI(t[1],r[1],i[1],s),e.height=VI(t[2],r[2],i[2],s)}function Xqe(e,t){const i=STe(t,Cg,[e.width,void 0,e.height]);e.width=VI(t[0],e.width,1,i),e.height=VI(t[2],e.height,1,i)}function STe(e,t,i){for(let r=0;r<3;r++){const s=e[r];switch(s){case"symbol-value":return i[r]!=null?i[r]/t[r]:1;case"proportional":break;default:if(s&&t[r])return s/t[r]}}return 1}async function Yqe(e){const t=await import("./symbolLayerUtils.a92a45df.js"),i=await t.computeObjectLayerResourceSize(e,10),{width:r,height:s,depth:n}=e,o=[r,n,s];let a=1;for(let l=0;l<3;l++)if(o[l]!=null){a=o[l]/i[l];break}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function VI(e,t,i,r){switch(e){case"proportional":return i*r;case"symbol-value":return t!=null?t:i;default:return e}}function Jqe(e,t){const i=TTe(t);if(!M(i))switch(e.type){case"simple-marker":e.size=i;break;case"picture-marker":{const r=e.width/e.height;r>1?(e.width=i,e.height=i*r):(e.width=i*r,e.height=i);break}case"simple-line":e.width=i;break;case"text":e.font.size=i}}async function Qqe(e,t){if(e&&t)return om(e)?jqe(e,t):void(cB(e)&&Jqe(e,t))}function Kqe(e,t,i){if(e&&t!=null)if(om(e)){const r=e.symbolLayers;r&&r.forEach(s=>{if(s&&s.type==="object")switch(i){case"tilt":s.tilt=t;break;case"roll":s.roll=t;break;default:s.heading=t}})}else cB(e)&&(e.type!=="simple-marker"&&e.type!=="picture-marker"&&e.type!=="text"||(e.angle=t))}function Z3(e){if(!e)return null;const t=e.effects.filter(i=>i.type!=="bloom").map(i=>i.toJSON());return KU(t)}const ETe="<",CTe=">",eWe=HV("short-date");function ATe(e,t,i,r){let s="";t===0?s=`${ETe} `:t===i&&(s=`${CTe} `);let n=null;return n=r?Sn(e,eWe):UHe(e),s+n}const tWe=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function vZ(e){if(!("visualVariables"in e)||!e.visualVariables)return null;const t=e.visualVariables.find(o=>o.type==="color");if(!t)return null;let i=null,r=null;if(t.stops){if(t.stops.length===1)return t.stops[0].color;i=t.stops[0].value,r=t.stops[t.stops.length-1].value}const s=i+(r-i)/2,{getColor:n}=await Promise.resolve().then(function(){return o2});return n(t,s)}async function MTe(e,t){const i=e.trailCap,r=e.trailWidth||1,s=t||await vZ(e)||e.color;return new dl({cap:i,color:s,width:r})}const iWe=new Le([64,64,64]);function OTe(e,t){const i=[],r=e.length-1;return e.length===5?i.push(0,2,4):i.push(0,r),e.map((s,n)=>i.includes(n)?ATe(s,n,r,t):null)}async function _Z(e,t,i){let r=!1,s=[],n=[];if(e.stops){const c=e.stops;s=c.map(h=>h.value),r=c.some(h=>!!h.label),r&&(n=c.map(h=>h.label))}const o=s[0],a=s[s.length-1];if(o==null&&a==null)return null;const l=r?null:OTe(s,i);return(await Promise.all(s.map(async(c,h)=>({value:c,color:e.type==="opacity"?await rWe(c,e,t):(await Promise.resolve().then(function(){return o2})).getColor(e,c),label:r?n[h]:l[h]})))).reverse()}async function rWe(e,t,i=iWe){const r=new Le(i),s=(await Promise.resolve().then(function(){return o2})).getOpacity(t,e);return s!=null&&(r.a=s),r}function sWe(e){let t=!1,i=[],r=[];i=e.map(a=>a.value),t=e.some(a=>!!a.label),t&&(r=e.map(a=>a.label));const s=i[0],n=i[i.length-1];if(s==null&&n==null)return null;const o=t?null:OTe(i,!1);return i.map((a,l)=>({value:a,color:RTe(a,e),label:t?r[l]:o[l]})).reverse()}function RTe(e,t){const{startIndex:i,endIndex:r,weight:s}=nWe(e,t);if(i===r)return t[i].color;const n=Le.blendColors(t[i].color,t[r].color,s);return new Le(n)}function nWe(e,t){let i=0,r=t.length-1;return t.some((s,n)=>e<s.value?(r=n,!0):(i=n,!1)),{startIndex:i,endIndex:r,weight:(e-t[i].value)/(t[r].value-t[i].value)}}function oWe(e,t){let i=[];if(e&&e.type==="multipart")e.colorRamps.reverse().forEach((r,s)=>{s===0?i.push({value:t.max,color:new Le(r.toColor),label:"high"}):i.push({value:null,color:new Le(r.toColor),label:""}),s===e.colorRamps.length-1?i.push({value:t.min,color:new Le(r.fromColor),label:"low"}):i.push({value:null,color:new Le(r.fromColor),label:""})});else{let r,s;e&&e.type==="algorithmic"?(r=e.fromColor,s=e.toColor):(r=[0,0,0,1],s=[255,255,255,1]),i=[{value:t.max,color:new Le(s),label:"high"},{value:t.min,color:new Le(r),label:"low"}]}return i}var bZ;let DP=bZ=class extends Ce{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new bZ({color:this.color,ratio:this.ratio})}};u([d({type:Le,json:{type:[Zr],default:null,write:!0}})],DP.prototype,"color",void 0),u([d({type:Number,json:{write:!0}})],DP.prototype,"ratio",void 0),DP=bZ=u([L("esri.renderers.support.HeatmapColorStop")],DP);const BI=DP;function PTe(e){if(!e.colorStops)return[];const t=[...e.colorStops].filter(r=>{var s;return((s=r.color)==null?void 0:s.a)>0});let i=t.length-1;if(t&&t[0]){const r=t[i];r&&r.ratio!==1&&(t.push(new BI({ratio:1,color:r.color})),i++)}return t.map((r,s)=>{var o,a;let n="";return s===0?n=((o=e.legendOptions)==null?void 0:o.minLabel)||"low":s===i&&(n=((a=e.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:r.color,label:n,ratio:r.ratio}}).reverse()}ve.getLogger("esri.renderers.support.utils");function Ju(e,t,i){$Q(e,t,()=>[]).push(...i)}async function aWe(e){var i,r;const t=new Map;if("visualVariables"in e&&e.visualVariables){const s=e.visualVariables.filter(n=>n.type==="color");for(const n of s){const o=n.field||n.valueExpression,a=(await _Z(n)).map(l=>l.color);Ju(t,o,a)}}if(e.type==="heatmap"){const s=PTe(e).map(n=>n.color);Ju(t,e.field,s)}else if(e.type==="pie-chart"){for(const s of e.attributes)Ju(t,s.field,[s.color]);Ju(t,null,[(i=e==null?void 0:e.othersCategory)==null?void 0:i.color,M2(e.backgroundFillSymbol,null)])}else if(e.type==="dot-density"){for(const s of e.attributes)Ju(t,s.field,[s.color]);Ju(t,null,[e.backgroundColor])}else if(e.type==="unique-value")if(((r=e.authoringInfo)==null?void 0:r.type)==="predominance")for(const s of e.uniqueValueInfos)Ju(t,s.value.toString(),[M2(s.symbol,null)]);else{const s=e.uniqueValueInfos.map(c=>M2(c.symbol,null)),{field:n,field2:o,field3:a,valueExpression:l}=e;(n||l)&&Ju(t,n||l,s),o&&Ju(t,o,s),a&&Ju(t,a,s)}else if(e.type==="class-breaks"){const s=e.classBreakInfos.map(n=>M2(n.symbol,null));Ju(t,e.field||e.valueExpression,s)}else e.type==="simple"&&Ju(t,null,[M2(e.symbol,null)]);return"defaultSymbol"in e&&e.defaultSymbol&&Ju(t,null,[M2(e.defaultSymbol,null)]),t.forEach((s,n)=>{const o=sL(s.filter(Boolean),(a,l)=>JSON.stringify(a)===JSON.stringify(l));t.set(n,o)}),t}var wZ;let NP=wZ=class extends Ce{constructor(e){super(e),this.name=null,this.code=null}clone(){return new wZ({name:this.name,code:this.code})}};u([d({type:String,json:{write:!0}})],NP.prototype,"name",void 0),u([d({type:[String,Number],json:{write:!0}})],NP.prototype,"code",void 0),NP=wZ=u([L("esri.layers.support.CodedValue")],NP);const lWe=new Ti({inherited:"inherited",codedValue:"coded-value",range:"range"});let FP=class extends Ce{constructor(e){super(e),this.name=null,this.type=null}};u([d({type:String,json:{write:!0}})],FP.prototype,"name",void 0),u([bt(lWe)],FP.prototype,"type",void 0),FP=u([L("esri.layers.support.Domain")],FP);const VB=FP;var xZ;let kP=xZ=class extends VB{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const i=String(e);this.codedValues.some(r=>(String(r.code)===i&&(t=r.name),!!t))}return t}clone(){return new xZ({codedValues:ue(this.codedValues),name:this.name})}};u([d({type:[NP],json:{write:!0}})],kP.prototype,"codedValues",void 0),u([bt({codedValue:"coded-value"})],kP.prototype,"type",void 0),kP=xZ=u([L("esri.layers.support.CodedValueDomain")],kP);const ITe=kP;var TZ;let w5=TZ=class extends VB{constructor(e){super(e),this.type="inherited"}clone(){return new TZ}};u([bt({inherited:"inherited"})],w5.prototype,"type",void 0),w5=TZ=u([L("esri.layers.support.InheritedDomain")],w5);const $Te=w5;var SZ;let HE=SZ=class extends VB{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new SZ({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(e,t,i){t[i]=[this.minValue||0,e]}}}})],HE.prototype,"maxValue",void 0),u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,i){t[i]=[e,this.maxValue||0]}}}})],HE.prototype,"minValue",void 0),u([bt({range:"range"})],HE.prototype,"type",void 0),HE=SZ=u([L("esri.layers.support.RangeDomain")],HE);const LTe=HE,DTe={key:"type",base:VB,typeMap:{range:LTe,"coded-value":ITe,inherited:$Te}};function Dee(e){if(!e||!e.type)return null;switch(e.type){case"range":return LTe.fromJSON(e);case"codedValue":return ITe.fromJSON(e);case"inherited":return $Te.fromJSON(e)}return null}const cWe=new Ti({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var EZ;const uWe=new Ti({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let hc=EZ=class extends Ce{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null}readDescription(e,{description:t}){let i;try{i=JSON.parse(t)}catch{}return i?i.value:null}readValueType(e,{description:t}){let i;try{i=JSON.parse(t)}catch{}return i?uWe.fromJSON(i.fieldValueType):null}clone(){return new EZ({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}};u([d({type:String,json:{write:!0}})],hc.prototype,"alias",void 0),u([d({type:[String,Number],json:{write:{allowNull:!0}}})],hc.prototype,"defaultValue",void 0),u([d()],hc.prototype,"description",void 0),u([De("description")],hc.prototype,"readDescription",null),u([d({types:DTe,json:{read:{reader:Dee},write:!0}})],hc.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],hc.prototype,"editable",void 0),u([d({type:Zr,json:{write:!0}})],hc.prototype,"length",void 0),u([d({type:String,json:{write:!0}})],hc.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0}})],hc.prototype,"nullable",void 0),u([bt(cWe)],hc.prototype,"type",void 0),u([d()],hc.prototype,"valueType",void 0),u([De("valueType",["description"])],hc.prototype,"readValueType",null),hc=EZ=u([L("esri.layers.support.Field")],hc);const hO=hc;var CZ;let N0=CZ=class extends Ce{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new CZ({mapLayerId:e,gdbVersion:t})}};u([bt({mapLayer:"map-layer"})],N0.prototype,"type",void 0),u([d({type:Zr,json:{write:!0}})],N0.prototype,"mapLayerId",void 0),u([d({type:String,json:{write:!0}})],N0.prototype,"gdbVersion",void 0),N0=CZ=u([L("esri.layers.support.source.MapLayerSource")],N0);var AZ;let Jy=AZ=class extends Ce{constructor(e){super(e),this.type="query-table"}clone(){var o;const{workspaceId:e,query:t,oidFields:i,spatialReference:r,geometryType:s}=this,n={workspaceId:e,query:t,oidFields:i,spatialReference:(o=r==null?void 0:r.clone())!=null?o:void 0,geometryType:s};return new AZ(n)}};u([bt({queryTable:"query-table"})],Jy.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Jy.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],Jy.prototype,"query",void 0),u([d({type:String,json:{write:!0}})],Jy.prototype,"oidFields",void 0),u([d({type:at,json:{write:!0}})],Jy.prototype,"spatialReference",void 0),u([bt(__e)],Jy.prototype,"geometryType",void 0),Jy=AZ=u([L("esri.layers.support.source.QueryTableDataSource")],Jy);var MZ;let qE=MZ=class extends Ce{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new MZ({workspaceId:e,dataSourceName:t})}};u([bt({raster:"raster"})],qE.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],qE.prototype,"dataSourceName",void 0),u([d({type:String,json:{write:!0}})],qE.prototype,"workspaceId",void 0),qE=MZ=u([L("esri.layers.support.source.RasterDataSource")],qE);var OZ;let hx=OZ=class extends Ce{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:i}=this;return new OZ({workspaceId:e,gdbVersion:t,dataSourceName:i})}};u([bt({table:"table"})],hx.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],hx.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],hx.prototype,"gdbVersion",void 0),u([d({type:String,json:{write:!0}})],hx.prototype,"dataSourceName",void 0),hx=OZ=u([L("esri.layers.support.source.TableDataSource")],hx);var RZ,PZ;const hWe=ml()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let ch=RZ=class extends Ce{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,i){return Kae()(e,t,i)}castLeftTableSource(e){return im(IZ(),e)}readRightTableSource(e,t,i){return Kae()(e,t,i)}castRightTableSource(e){return im(IZ(),e)}clone(){var o,a;const{leftTableKey:e,rightTableKey:t,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:e,rightTableKey:t,leftTableSource:(o=i==null?void 0:i.clone())!=null?o:void 0,rightTableSource:(a=r==null?void 0:r.clone())!=null?a:void 0,joinType:s};return new RZ(n)}};u([bt({joinTable:"join-table"})],ch.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],ch.prototype,"leftTableKey",void 0),u([d({type:String,json:{write:!0}})],ch.prototype,"rightTableKey",void 0),u([d({json:{write:!0}})],ch.prototype,"leftTableSource",void 0),u([De("leftTableSource")],ch.prototype,"readLeftTableSource",null),u([Jt("leftTableSource")],ch.prototype,"castLeftTableSource",null),u([d({json:{write:!0}})],ch.prototype,"rightTableSource",void 0),u([De("rightTableSource")],ch.prototype,"readRightTableSource",null),u([Jt("rightTableSource")],ch.prototype,"castRightTableSource",null),u([bt(hWe)],ch.prototype,"joinType",void 0),ch=RZ=u([L("esri.layers.support.source.JoinTableDataSource")],ch);let u9=null;function Kae(){return u9||(u9=KM({types:IZ()})),u9}let h9=null;function IZ(){return h9||(h9={key:"type",base:null,typeMap:{"data-layer":Ph,"map-layer":N0}}),h9}const dWe={key:"type",base:null,typeMap:{"join-table":ch,"query-table":Jy,raster:qE,table:hx}};let Ph=PZ=class extends Ce{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new PZ({fields:e,dataSource:t})}};u([bt({dataLayer:"data-layer"})],Ph.prototype,"type",void 0),u([d({type:[hO],json:{write:!0}})],Ph.prototype,"fields",void 0),u([d({types:dWe,json:{write:!0}})],Ph.prototype,"dataSource",void 0),Ph=PZ=u([L("esri.layers.support.source.DataLayerSource")],Ph),Ph.from=dn(Ph);function pWe(e,t){return t?me(F({},t),{query:F(F({},e),t.query)}):{query:e}}function NTe(e){return typeof e=="string"?pn(e):ue(e)}function fWe(e,t,i){const r={};for(const s in e){if(s==="declaredClass")continue;const n=e[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){r[s]=[];for(let o=0;o<n.length;o++)r[s][o]=fWe(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(i&&i[s]);r[s]=t?o:JSON.stringify(o)}else r[s]=t?n:JSON.stringify(n);else r[s]=n}return r}const KD={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new Fa({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:at.WebMercator}),minus180Line:new Fa({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:at.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new Fa({paths:[[[180,-180],[180,180]]],spatialReference:at.WGS84}),minus180Line:new Fa({paths:[[[-180,-180],[-180,180]]],spatialReference:at.WGS84})}};function OT(e,t){return Math.ceil((e-t)/(2*t))}function FTe(e,t){const i=GI(e);for(const r of i)for(const s of r)s[0]+=t;return e}function GI(e){return BT(e)?e.rings:e.paths}async function mWe(e,t,i,r){const s=typeof e=="string"?pn(e):e,n=t[0].spatialReference,o=me(F({},r),{query:me(F({},s.query),{f:"json",sr:JSON.stringify(n),target:JSON.stringify({geometryType:tO(t[0]),geometries:t}),cutter:JSON.stringify(i)})}),a=await Zt(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(h=>{const p=jg(h);return p.spatialReference=n,p})}}async function gWe(e,t,i){const r=typeof e=="string"?pn(e):e,s=t[0].spatialReference,n=tO(t[0]),o=me(F({},i),{query:me(F({},r.query),{f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(yWe(t))})});return vWe((await Zt(r.path+"/simplify",o)).data,n,s)}function yWe(e){return{geometryType:tO(e[0]),geometries:e.map(t=>t.toJSON())}}function vWe(e,t,i){const r=w_e(t);return e.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}const kTe=ve.getLogger("esri.geometry.support.normalizeUtils");function _We(e){return e.type==="polygon"}function bWe(e){return e[0].type==="polygon"}function wWe(e){return e[0].type==="polyline"}function xWe(e,t){if(!(e instanceof Fa||e instanceof Uo)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw kTe.error(s),new W(s)}const i=GI(e),r=[];for(const s of i){const n=[];r.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],h=s[o+1][1],p=Math.sqrt((c-a)*(c-a)+(h-l)*(h-l)),f=(h-l)/p,m=(c-a)/p,g=p/t;if(g>1){for(let S=1;S<=g-1;S++){const T=S*t,C=m*T+a,A=f*T+l;n.push([C,A])}const y=(p+Math.floor(g-1)*t)/2,x=m*y+a,b=f*y+l;n.push([x,b])}n.push([c,h])}}return _We(e)?new Uo({rings:r,spatialReference:e.spatialReference}):new Fa({paths:r,spatialReference:e.spatialReference})}function ele(e,t,i){if(t){const r=xWe(e,1e6);e=RC(r,!0)}return i&&(e=FTe(e,i)),e}function tle(e,t,i){if(Array.isArray(e)){const r=e[0];if(r>t){const s=OT(r,t);e[0]=r+s*(-2*t)}else if(r<i){const s=OT(r,i);e[0]=r+s*(-2*i)}}else{const r=e.x;if(r>t){const s=OT(r,t);e=e.clone().offset(s*(-2*t),0)}else if(r<i){const s=OT(r,i);e=e.clone().offset(s*(-2*i),0)}}return e}function TWe(e,t){let i=-1;for(let r=0;r<t.cutIndexes.length;r++){const s=t.cutIndexes[r],n=t.geometries[r],o=GI(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let f=0;f<l.length;f++){const m=l[f][0];h=m>h?m:h}h=Number(h.toFixed(9));const p=-360*OT(h,180);for(let f=0;f<l.length;f++){const m=n.getPoint(a,f);n.setPoint(a,f,m.clone().offset(p,0))}return!0}})}if(s===i){if(bWe(e))for(const a of GI(n))e[s]=e[s].addRing(a);else if(wWe(e))for(const a of GI(n))e[s]=e[s].addPath(a)}else i=s,e[s]=n}return e}async function Nee(e,t,i){var C;if(!Array.isArray(e))return Nee([e],t);t&&typeof t!="string"&&kTe.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof t=="string"?t:(C=t==null?void 0:t.url)!=null?C:or.geometryServiceUrl;let s,n,o,a,l,c,h,p,f=0;const m=[],g=[];for(const A of e)if(M(A))g.push(A);else if(s||(s=A.spatialReference,n=X0(s),o=s.isWebMercator,c=o?102100:4326,a=KD[c].maxX,l=KD[c].minX,h=KD[c].plus180Line,p=KD[c].minus180Line),n)if(A.type==="mesh")g.push(A);else if(A.type==="point")g.push(tle(A.clone(),a,l));else if(A.type==="multipoint"){const O=A.clone();O.points=O.points.map(D=>tle(D,a,l)),g.push(O)}else if(A.type==="extent"){const O=A.clone()._normalize(!1,!1,n);g.push(O.rings?new Uo(O):O)}else if(A.extent){const O=A.extent,D=OT(O.xmin,l)*(2*a);let U=D===0?A.clone():FTe(A.clone(),D);O.offset(D,0),O.intersects(h)&&O.xmax!==a?(f=O.xmax>f?O.xmax:f,U=ele(U,o),m.push(U),g.push("cut")):O.intersects(p)&&O.xmin!==l?(f=O.xmax*(2*a)>f?O.xmax*(2*a):f,U=ele(U,o,360),m.push(U),g.push("cut")):g.push(U)}else g.push(A.clone());else g.push(A);let y=OT(f,a),x=-90;const b=y,S=new Fa;for(;y>0;){const A=360*y-180;S.addPath([[A,x],[A,-1*x]]),x*=-1,y--}if(m.length>0&&b>0){const A=TWe(m,await mWe(r,m,S,i)),O=[],D=[];for(let B=0;B<g.length;B++){const j=g[B];if(j!=="cut")D.push(j);else{const H=A.shift(),K=e[B];_(K)&&K.type==="polygon"&&K.rings&&K.rings.length>1&&H.rings.length>=K.rings.length?(O.push(H),D.push("simplify")):D.push(o?$g(H):H)}}if(!O.length)return D;const U=await gWe(r,O,i),k=[];for(let B=0;B<D.length;B++){const j=D[B];j!=="simplify"?k.push(j):k.push(o?$g(U.shift()):U.shift())}return k}const T=[];for(let A=0;A<g.length;A++){const O=g[A];if(O!=="cut")T.push(O);else{const D=m.shift();T.push(o===!0?$g(D):D)}}return T}function UTe(e){const t={};for(const i in e){if(i==="declaredClass")continue;const r=e[i];if(r!=null&&typeof r!="function")if(Array.isArray(r)){t[i]=[];for(let s=0;s<r.length;s++)t[i][s]=UTe(r[s])}else typeof r=="object"?r.toJSON&&(t[i]=JSON.stringify(r)):t[i]=r}return t}var E1;(function(e){e[e.varint=0]="varint",e[e.fixed64=1]="fixed64",e[e.delimited=2]="delimited",e[e.fixed32=5]="fixed32",e[e.unknown=99]="unknown"})(E1||(E1={}));const ile=4294967296,SWe=new TextDecoder("utf-8"),EWe=ye("safari")||ye("ios")?6:ye("ff")?12:32;class YT{constructor(t,i,r=0,s=t?t.byteLength:0){this._tag=0,this._dataType=E1.unknown,this._init(t,i,r,s)}_init(t,i,r,s){this._data=t,this._dataView=i,this._pos=r,this._end=s}clone(){return new YT(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const i=this._decodeVarint();if(this._tag=i>>3,this._dataType=7&i,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;return t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?t:(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?t:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();return t>>>1^-(1&t)|0}getSInt64(){return this._decodeSVarint()}getBool(){const t=this._data[this._pos]!==0;return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,i=this._pos,r=t.getUint32(i,!0)+t.getUint32(i+4,!0)*ile;return this._skip(8),r}getSFixed64(){const t=this._dataView,i=this._pos,r=t.getUint32(i,!0)+t.getInt32(i+4,!0)*ile;return this._skip(8),r}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),i=this._pos,r=this._toString(this._data,i,i+t);return this._skip(t),r}getBytes(){const t=this._getLength(),i=this._pos,r=this._toBytes(this._data,i,i+t);return this._skip(t),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,i,r,s){const n=this.getMessage(),o=t(n,i,r,s);return n.release(),o}processMessage(t){const i=this.getMessage(),r=t(i);return i.release(),r}getMessage(){const t=this._getLength(),i=YT.pool.acquire();return i._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),i}release(){YT.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case E1.varint:this._decodeVarint();break;case E1.fixed64:this._skip(8);break;case E1.delimited:this._skip(this._getLength());break;case E1.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let i,r=this._pos,s=0;if(this._end-r>=10)do{if(i=t[r++],s|=127&i,(128&i)==0||(i=t[r++],s|=(127&i)<<7,(128&i)==0)||(i=t[r++],s|=(127&i)<<14,(128&i)==0)||(i=t[r++],s|=(127&i)<<21,(128&i)==0)||(i=t[r++],s+=268435456*(127&i),(128&i)==0)||(i=t[r++],s+=34359738368*(127&i),(128&i)==0)||(i=t[r++],s+=4398046511104*(127&i),(128&i)==0)||(i=t[r++],s+=562949953421312*(127&i),(128&i)==0)||(i=t[r++],s+=72057594037927940*(127&i),(128&i)==0)||(i=t[r++],s+=9223372036854776e3*(127&i),(128&i)==0))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;r!==this._end&&(i=t[r],(128&i)!=0);)++r,s+=(127&i)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,s+=i*n}return this._pos=r,s}_decodeSVarint(){const t=this._decodeVarint();return t%2?-(t+1)/2:t/2}_getLength(){if(this._dataType!==E1.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,i,r){if((r=Math.min(this._end,r))-i>EWe){const o=t.subarray(i,r);return SWe.decode(o)}let s="",n="";for(let o=i;o<r;++o){const a=t[o];128&a?n+="%"+a.toString(16):(s+=decodeURIComponent(n)+String.fromCharCode(a),n="")}return n.length&&(s+=decodeURIComponent(n)),s}_toBytes(t,i,r){return r=Math.min(this._end,r),new Uint8Array(t.buffer,i,r-i)}}YT.pool=new un(YT,null,e=>{e._data=null,e._dataView=null});class Ga{constructor(t=[],i=[],r=!1){this.lengths=t!=null?t:[],this.coords=i!=null?i:[],this.hasIndeterminateRingOrder=r}static fromRect(t){const[i,r,s,n]=t,o=s-i,a=n-r;return new Ga([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((t,i)=>t+i)}forEachVertex(t){let i=0;this.lengths.length||t(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)t(this.coords[2*(n+i)],this.coords[2*(n+i)+1]);i+=s}}clone(t){return t?(t.set(this.coords),new Ga(this.lengths.slice(),t,this.hasIndeterminateRingOrder)):new Ga(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}class ey{constructor(t=null,i={},r,s){this.geometry=t,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const t=new ey(this.geometry,this.attributes,this.centroid,this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function CWe(e){return!(M(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)}class C4t extends ey{}class BB{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new BB;return t.objectIdFieldName=this.objectIdFieldName,t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}const zTe=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class A4t{constructor(t){this.options=t,this.geometryTypes=zTe,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new BB}prepareFeatures(t){this._vertexDimension=2,t.hasZ&&this._vertexDimension++,t.hasM&&this._vertexDimension++}finishFeatureResult(t){if(!t||!t.features||!t.hasZ||!this.options.sourceSpatialReference||!t.spatialReference||_a(t.spatialReference,this.options.sourceSpatialReference)||t.spatialReference.vcsWkid)return;const i=rd(this.options.sourceSpatialReference)/rd(t.spatialReference);if(i!==1)for(const r of t.features){if(!CWe(r))continue;const s=r.geometry.coords;for(let n=2;n<s.length;n+=3)s[n]*=i}}addFeature(t,i){t.features.push(i)}createFeature(){return new ey}createSpatialReference(){return{wkid:0}}createGeometry(){return new Ga}addField(t,i){t.fields.push(i)}allocateCoordinates(t){t.coords.length=t.lengths.reduce((i,r)=>i+r,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(t,i){t.coords[this._coordinatePtr++]=i}addCoordinatePoint(t,i){t.coords.push(i)}addLength(t,i){t.lengths.push(i)}addQueryGeometry(t,i){t.queryGeometry=i.queryGeometry,t.queryGeometryType=i.queryGeometryType}createPointGeometry(){return new Ga}}const rle=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],sle=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],nle=["upperLeft","lowerLeft"];function ole(e){return e>=rle.length?null:rle[e]}function AWe(e){return e>=sle.length?null:sle[e]}function ale(e){return e>=nle.length?null:nle[e]}function lle(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function MWe(e,t,i){const s=t.createPointGeometry(i);for(;e.next();)switch(e.tag()){case 3:{const n=e.getUInt32(),o=e.pos()+n;let a=0;for(;e.pos()<o;)t.addCoordinatePoint(s,e.getSInt64(),a++);break}default:e.skip()}return s}function OWe(e,t,i){const n=t.createGeometry(i),o=2+(i.hasZ?1:0)+(i.hasM?1:0);for(;e.next();)switch(e.tag()){case 2:{const a=e.getUInt32(),l=e.pos()+a;let c=0;for(;e.pos()<l;)t.addLength(n,e.getUInt32(),c++);break}case 3:{const a=e.getUInt32(),l=e.pos()+a;let c=0;for(t.allocateCoordinates(n);e.pos()<l;)t.addCoordinate(n,e.getSInt64(),c),c++,c===o&&(c=0);break}default:e.skip()}return n}function RWe(e){const s=new Ga;let n="esriGeometryPoint";for(;e.next();)switch(e.tag()){case 2:{const o=e.getUInt32(),a=e.pos()+o;for(;e.pos()<a;)s.lengths.push(e.getUInt32());break}case 3:{const o=e.getUInt32(),a=e.pos()+o;for(;e.pos()<a;)s.coords.push(e.getSInt64());break}case 1:n=zTe[e.getEnum()];break;default:e.skip()}return{queryGeometry:s,queryGeometryType:n}}function PWe(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function IWe(e){const a={type:ole(0)};for(;e.next();)switch(e.tag()){case 1:a.name=e.getString();break;case 2:a.type=ole(e.getEnum());break;case 3:a.alias=e.getString();break;case 4:a.sqlType=AWe(e.getEnum());break;case 5:e.skip();break;case 6:a.defaultValue=e.getString();break;default:e.skip()}return a}function $We(e){const r={};for(;e.next();)switch(e.tag()){case 1:r.name=e.getString();break;case 2:r.isSystemMaintained=e.getBool();break;default:e.skip()}return r}function LWe(e,t,i,r){const a=t.createFeature(i);let l=0;for(;e.next();)switch(e.tag()){case 1:{const c=r[l++].name;a.attributes[c]=e.processMessage(PWe);break}case 2:a.geometry=e.processMessageWithArgs(OWe,t,i);break;case 4:a.centroid=e.processMessageWithArgs(MWe,t,i);break;default:e.skip()}return a}function DWe(e){const n=[1,1,1,1];for(;e.next();)switch(e.tag()){case 1:n[0]=e.getDouble();break;case 2:n[1]=e.getDouble();break;case 4:n[2]=e.getDouble();break;case 3:n[3]=e.getDouble();break;default:e.skip()}return n}function NWe(e){const n=[0,0,0,0];for(;e.next();)switch(e.tag()){case 1:n[0]=e.getDouble();break;case 2:n[1]=e.getDouble();break;case 4:n[2]=e.getDouble();break;case 3:n[3]=e.getDouble();break;default:e.skip()}return n}function FWe(e){const s={originPosition:ale(0)};for(;e.next();)switch(e.tag()){case 1:s.originPosition=ale(e.getEnum());break;case 2:s.scale=e.processMessage(DWe);break;case 3:s.translate=e.processMessage(NWe);break;default:e.skip()}return s}function kWe(e){const s={};for(;e.next();)switch(e.tag()){case 1:s.shapeAreaFieldName=e.getString();break;case 2:s.shapeLengthFieldName=e.getString();break;case 3:s.units=e.getString();break;default:e.skip()}return s}function UWe(e,t){const a=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:a.wkid=e.getUInt32();break;case 5:a.wkt=e.getString();break;case 2:a.latestWkid=e.getUInt32();break;case 3:a.vcsWkid=e.getUInt32();break;case 4:a.latestVcsWkid=e.getUInt32();break;default:e.skip()}return a}function zWe(e,t){const y=t.createFeatureResult();y.geometryType=lle(t,0);let x=!1;for(;e.next();)switch(e.tag()){case 1:y.objectIdFieldName=e.getString();break;case 3:y.globalIdFieldName=e.getString();break;case 4:y.geohashFieldName=e.getString();break;case 5:y.geometryProperties=e.processMessage(kWe);break;case 7:y.geometryType=lle(t,e.getEnum());break;case 8:y.spatialReference=e.processMessageWithArgs(UWe,t);break;case 10:y.hasZ=e.getBool();break;case 11:y.hasM=e.getBool();break;case 12:y.transform=e.processMessage(FWe);break;case 9:{const b=e.getBool();y.exceededTransferLimit=b;break}case 13:t.addField(y,e.processMessage(IWe));break;case 15:x||(t.prepareFeatures(y),x=!0),t.addFeature(y,e.processMessageWithArgs(LWe,t,y,y.fields));break;case 2:y.uniqueIdField=e.processMessage($We);break;default:e.skip()}return t.finishFeatureResult(y),y}function VWe(e,t){const s={};let n=null;for(;e.next();)switch(e.tag()){case 4:n=e.processMessageWithArgs(RWe);break;case 1:s.featureResult=e.processMessageWithArgs(zWe,t);break;default:e.skip()}return _(n)&&s.featureResult&&t.addQueryGeometry(s,n),s}function BWe(e,t){try{const r=new YT(new Uint8Array(e),new DataView(e)),s={};for(;r.next();)r.tag()===2?s.queryResult=r.processMessageWithArgs(VWe,t):r.skip();return s}catch(i){throw new W("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:i})}}function GWe(e,t){const i=BWe(e,t),r=i.queryResult.featureResult,s=i.queryResult.queryGeometry,n=i.queryResult.queryGeometryType;if(r&&r.features&&r.features.length&&r.objectIdFieldName){const o=r.objectIdFieldName;for(const a of r.features)a.attributes&&(a.objectId=a.attributes[o])}return r&&(r.queryGeometry=s,r.queryGeometryType=n),r}function $Z(e,t,i){if(!i||!i.features||!i.hasZ)return;const r=zbe(i.geometryType,t,e.outSpatialReference);if(!M(r))for(const s of i.features)r(s.geometry)}const cle="Layer does not support extent calculation.";function VTe(e,t){if(t&&e.type==="extent")return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&e.type==="point")return`${e.x},${e.y}`;const i=e.toJSON();return delete i.spatialReference,JSON.stringify(i)}function BTe(e,t){const i=e.geometry,r=e.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;const s=r;let n,o,a;if(_(i)&&(o=i.spatialReference,a=i.spatialReference.wkid||JSON.stringify(i.spatialReference),s.geometryType=tO(i),s.geometry=VTe(i,e.compactGeometryEnabled),s.inSR=a),r.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(s.objectIds=r.objectIds.join(",")),r.orderByFields&&(s.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&((t==null?void 0:t.returnCountOnly)||(t==null?void 0:t.returnExtentOnly)||(t==null?void 0:t.returnIdsOnly))?delete s.outFields:r.outFields.includes("*")?s.outFields="*":s.outFields=r.outFields.join(","),r.outSR?(s.outSR=r.outSR.wkid||JSON.stringify(r.outSR),n=e.outSpatialReference):i&&(r.returnGeometry||r.returnCentroid)&&(s.outSR=s.inSR,n=o),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(s.outStatistics=JSON.stringify(r.outStatistics)),r.pixelSize&&(s.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&_(o)&&_(e.quantizationParameters)&&_(e.quantizationParameters.extent)&&o.equals(e.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(s.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(s.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(s.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const l=r.timeExtent,{start:c,end:h}=l;c==null&&h==null||(s.time=c===h?c:`${c==null?"null":c},${h==null?"null":h}`),delete r.timeExtent}return e.defaultSpatialReferenceEnabled&&_(o)&&_(n)&&o.equals(n)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function GTe(e,t,i,r){const s=_(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:await dO(e,t,"json",r);return $Z(t,i,s.data),s}async function jWe(e,t,i,r){if(_(t.timeExtent)&&t.timeExtent.isEmpty)return{data:i.createFeatureResult()};const s=await jTe(e,t,r),n=s;return n.data=GWe(s.data,i),n}function jTe(e,t,i){return dO(e,t,"pbf",i)}function HWe(e,t,i){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):dO(e,t,"json",i,{returnIdsOnly:!0})}function qWe(e,t,i){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):dO(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}function WWe(e,t,i){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):dO(e,t,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}).then(r=>{const s=r.data;if(s.hasOwnProperty("extent"))return r;if(s.features)throw new Error(cle);if(s.hasOwnProperty("count"))throw new Error(cle);return r})}function dO(e,t,i,r={},s={}){const n=typeof e=="string"?pn(e):e,o=t.geometry?[t.geometry]:[];return r.responseType=i==="pbf"?"array-buffer":"json",Nee(o,null,r).then(a=>{const l=a&&a[0];_(l)&&((t=t.clone()).geometry=l);const c=UTe(F(F(me(F({},n.query),{f:i}),s),BTe(t,s)));return Zt(Bc(n.path,"query"),me(F({},r),{query:F(F({},c),r.query)}))})}var ZWe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",encodeGeometry:VTe,executeQuery:GTe,executeQueryForCount:qWe,executeQueryForExtent:WWe,executeQueryForIds:HWe,executeQueryPBF:jWe,executeQueryPBFBuffer:jTe,queryToQueryStringParameters:BTe,runQuery:dO}),LZ;const DZ=new Ti({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Aa=LZ=class extends Ce{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){var s;const i=at.fromJSON(t.spatialReference),r=[];for(let n=0;n<e.length;n++){const o=e[n],a=Ha.fromJSON(o),l=o.geometry&&o.geometry.spatialReference;_(a.geometry)&&!l&&(a.geometry.spatialReference=i);const c=o.aggregateGeometries,h=a.aggregateGeometries;if(c&&_(h))for(const p in h){const f=h[p],m=(s=c[p])==null?void 0:s.spatialReference;_(f)&&!m&&(f.spatialReference=i)}r.push(a)}return r}writeGeometryType(e,t,i,r){if(e)return void DZ.write(e,t,i,r);const{features:s}=this;if(s){for(const n of s)if(n&&_(n.geometry))return void DZ.write(n.geometry.type,t,i,r)}}readQueryGeometry(e,t){if(!e)return null;const i=!!e.spatialReference,r=jg(e);return!i&&t.spatialReference&&(r.spatialReference=at.fromJSON(t.spatialReference)),r}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&_(r.geometry)&&r.geometry.spatialReference)return void(t.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new LZ(this.cloneProperties())}cloneProperties(){return ue({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let i=0;i<t.features.length;i++){const r=t.features[i];if(r.geometry){const s=e&&e[i];r.geometry=s&&s.toJSON()||r.geometry}}return t}quantize(e){const{scale:[t,i],translate:[r,s]}=e,n=c=>Math.round((c-r)/t),o=c=>Math.round((s-c)/i),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,o]}=i,a=h=>h*n+r,l=h=>s-h*o,c=this._getHydrationFunction(e,a,l);for(const{geometry:h}of t)_(h)&&c(h);return this.transform=null,this}_quantizePoints(e,t,i){let r,s;const n=[];for(let o=0,a=e.length;o<a;o++){const l=e[o];if(o>0){const c=t(l[0]),h=i(l[1]);c===r&&h===s||(n.push([c-r,h-s]),r=c,s=h)}else r=t(l[0]),s=i(l[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(e,t,i){return e==="point"?r=>(r.x=t(r.x),r.y=i(r.y),r):e==="polyline"||e==="polygon"?r=>{const s=BT(r)?r.rings:r.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,t,i);c&&n.push(c)}return n.length>0?(BT(r)?r.rings=n:r.paths=n,r):null}:e==="multipoint"?r=>{const s=this._quantizePoints(r.points,t,i);return s.length>0?(r.points=s,r):null}:e==="extent"?r=>r:null}_getHydrationFunction(e,t,i){return e==="point"?r=>{r.x=t(r.x),r.y=i(r.y)}:e==="polyline"||e==="polygon"?r=>{const s=BT(r)?r.rings:r.paths;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];for(let h=0,p=c.length;h<p;h++){const f=c[h];h>0?(n+=f[0],o+=f[1]):(n=f[0],o=f[1]),f[0]=t(n),f[1]=i(o)}}}:e==="extent"?r=>{r.xmin=t(r.xmin),r.ymin=i(r.ymin),r.xmax=t(r.xmax),r.ymax=i(r.ymax)}:e==="multipoint"?r=>{const s=r.points;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];a>0?(n+=c[0],o+=c[1]):(n=c[0],o=c[1]),c[0]=t(n),c[1]=i(o)}}:void 0}};u([d({type:String,json:{write:!0}})],Aa.prototype,"displayFieldName",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Aa.prototype,"exceededTransferLimit",void 0),u([d({type:[Ha],json:{write:!0}})],Aa.prototype,"features",void 0),u([De("features")],Aa.prototype,"readFeatures",null),u([d({type:[hO],json:{write:!0}})],Aa.prototype,"fields",void 0),u([d({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:DZ.read}}})],Aa.prototype,"geometryType",void 0),u([it("geometryType")],Aa.prototype,"writeGeometryType",null),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Aa.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Aa.prototype,"hasZ",void 0),u([d({types:qS,json:{write:!0}})],Aa.prototype,"queryGeometry",void 0),u([De("queryGeometry")],Aa.prototype,"readQueryGeometry",null),u([d({type:at,json:{write:!0}})],Aa.prototype,"spatialReference",void 0),u([it("spatialReference")],Aa.prototype,"writeSpatialReference",null),u([d({json:{write:!0}})],Aa.prototype,"transform",void 0),Aa=LZ=u([L("esri.rest.support.FeatureSet")],Aa),Aa.prototype.toJSON.isDefaultToJSON=!0;const GB=Aa;var XWe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:GB});const ule={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},YWe={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function JWe(e,t){const i=new Date(e,t+1,1);return i.setDate(0),i.getDate()}function gp(e,t,i){const r=new Date(e.getTime());if(t&&i){const s=YWe[i],{getter:n,setter:o,multiplier:a}=s;if(i==="months"){const l=JWe(r.getFullYear(),r.getMonth()+t);r.getDate()>l&&r.setDate(l)}r[o](r[n]()+t*a)}return r}function hle(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function QWe(e,t,i="milliseconds"){const r=new Date(tb(t,i,"milliseconds"));return r.setUTCFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),r}function KWe(e,t="milliseconds"){const i=tb(e.getUTCHours(),"hours","milliseconds"),r=tb(e.getUTCMinutes(),"minutes","milliseconds"),s=tb(e.getUTCSeconds(),"seconds","milliseconds");return tb(i+r+s+e.getUTCMilliseconds(),"milliseconds",t)}function eZe(e,t){const i=new Date(e.getTime());return i.setUTCFullYear(t.getFullYear(),t.getMonth(),t.getDate()),i}function tZe(e){const t=new Date(0);return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),t}function tb(e,t,i){return e===0?0:e*ule[t]/ule[i]}var tf;let Sh=tf=class extends Ce{constructor(e){super(e),this.end=null,this.start=null}static get allTime(){return dle}static get empty(){return iZe}readEnd(e,t){return t.end!=null?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals(tf.allTime)}get isEmpty(){return this.equals(tf.empty)}readStart(e,t){return t.start!=null?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new tf({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=_(this.start)?this.start.getTime():this.start,i=_(this.end)?this.end.getTime():this.end,r=_(e.start)?e.start.getTime():e.start,s=_(e.end)?e.end.getTime():e.end;return t===r&&i===s}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();const t=wt(this.start,r=>hle(r,e)),i=wt(this.end,r=>gp(hle(r,e),1,e));return new tf({start:t,end:i})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return tf.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=Nh(this.start,-1/0,a=>a.getTime()),i=Nh(this.end,1/0,a=>a.getTime()),r=Nh(e.start,-1/0,a=>a.getTime()),s=Nh(e.end,1/0,a=>a.getTime());let n,o;if(r>=t&&r<=i?n=r:t>=r&&t<=s&&(n=t),i>=r&&i<=s?o=i:s>=t&&s<=i&&(o=s),!isNaN(n)&&!isNaN(o)){const a=new tf;return a.start=n===-1/0?null:new Date(n),a.end=o===1/0?null:new Date(o),a}return tf.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();const i=new tf,{start:r,end:s}=this;return _(r)&&(i.start=gp(r,e,t)),_(s)&&(i.end=gp(s,e,t)),i}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return dle.clone();const t=_(this.start)&&_(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,i=_(this.end)&&_(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new tf({start:t,end:i})}};u([d({type:Date,json:{write:{allowNull:!0}}})],Sh.prototype,"end",void 0),u([De("end")],Sh.prototype,"readEnd",null),u([it("end")],Sh.prototype,"writeEnd",null),u([d({readOnly:!0,json:{read:!1}})],Sh.prototype,"isAllTime",null),u([d({readOnly:!0,json:{read:!1}})],Sh.prototype,"isEmpty",null),u([d({type:Date,json:{write:{allowNull:!0}}})],Sh.prototype,"start",void 0),u([De("start")],Sh.prototype,"readStart",null),u([it("start")],Sh.prototype,"writeStart",null),Sh=tf=u([L("esri.TimeExtent")],Sh);const dle=new Sh,iZe=new Sh({start:void 0,end:void 0}),py=Sh;var NZ;const ple=new Ti({upperLeft:"upper-left",lowerLeft:"lower-left"});let dx=NZ=class extends Ce{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new NZ(ue({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([d({type:yi,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],dx.prototype,"extent",void 0),u([d({type:["view","edit"],json:{write:!0}})],dx.prototype,"mode",void 0),u([d({type:String,json:{read:ple.read,write:ple.write}})],dx.prototype,"originPosition",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],dx.prototype,"tolerance",void 0),dx=NZ=u([L("esri.rest.support.QuantizationParameters")],dx);const rZe=dx;var FZ;const fle=new Ti({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let rf=FZ=class extends Ce{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(t.statisticParameters=ue(e))}clone(){return new FZ({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:ue(this.statisticParameters)})}};u([d({type:Number,json:{write:!0}})],rf.prototype,"maxPointCount",void 0),u([d({type:Number,json:{write:!0}})],rf.prototype,"maxRecordCount",void 0),u([d({type:Number,json:{write:!0}})],rf.prototype,"maxVertexCount",void 0),u([d({type:String,json:{write:!0}})],rf.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],rf.prototype,"outStatisticFieldName",void 0),u([d({type:String,json:{read:{source:"statisticType",reader:fle.read},write:{target:"statisticType",writer:fle.write}}})],rf.prototype,"statisticType",void 0),u([d({type:Object})],rf.prototype,"statisticParameters",void 0),u([it("statisticParameters")],rf.prototype,"writeStatisticParameters",null),rf=FZ=u([L("esri.rest.support.StatisticDefinition")],rf);const HTe=rf;var pA;const sZe=new Ti({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),nZe=new Ti({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Bt=pA=class extends Ce{constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}static from(e){return xb(pA,e)}castDatumTransformation(e){return typeof e=="number"||typeof e=="object"?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const i={};for(const r in e){const s=e[r];Array.isArray(s)?i[r]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?i[r]=s.getTime():i[r]=s}t.parameterValues=i}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new pA(ue({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:_(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};Bt.MAX_MAX_RECORD_COUNT_FACTOR=5,u([d({json:{write:!0}})],Bt.prototype,"aggregateIds",void 0),u([d({type:Boolean,json:{write:!0}})],Bt.prototype,"cacheHint",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"compactGeometryEnabled",void 0),u([d({json:{write:!0}})],Bt.prototype,"datumTransformation",void 0),u([Jt("datumTransformation")],Bt.prototype,"castDatumTransformation",null),u([d({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"defaultSpatialReferenceEnabled",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],Bt.prototype,"distance",void 0),u([d({type:Ph,json:{write:!0}})],Bt.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],Bt.prototype,"formatOf3DObjects",void 0),u([d({type:String,json:{write:!0}})],Bt.prototype,"gdbVersion",void 0),u([d({types:qS,json:{read:jg,write:!0}})],Bt.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],Bt.prototype,"geometryPrecision",void 0),u([d({type:[String],json:{write:!0}})],Bt.prototype,"groupByFieldsForStatistics",void 0),u([d({type:String,json:{write:!0}})],Bt.prototype,"having",void 0),u([d({type:Date})],Bt.prototype,"historicMoment",void 0),u([it("historicMoment")],Bt.prototype,"writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],Bt.prototype,"maxAllowableOffset",void 0),u([d({type:Number,cast:e=>e<1?1:e>pA.MAX_MAX_RECORD_COUNT_FACTOR?pA.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],Bt.prototype,"maxRecordCountFactor",void 0),u([d({type:["xyFootprint"],json:{write:!0}})],Bt.prototype,"multipatchOption",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Bt.prototype,"num",void 0),u([d({json:{write:!0}})],Bt.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],Bt.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],Bt.prototype,"outFields",void 0),u([d({type:at,json:{name:"outSR",write:!0}})],Bt.prototype,"outSpatialReference",void 0),u([d({type:[HTe],json:{write:{enabled:!0,overridePolicy(){return{enabled:_(this.outStatistics)&&this.outStatistics.length>0}}}}})],Bt.prototype,"outStatistics",void 0),u([d({json:{write:!0}})],Bt.prototype,"parameterValues",void 0),u([it("parameterValues")],Bt.prototype,"writeParameterValues",null),u([d({type:dt,json:{write:!0}})],Bt.prototype,"pixelSize",void 0),u([d({type:rZe,json:{write:!0}})],Bt.prototype,"quantizationParameters",void 0),u([d({type:[Object],json:{write:!0}})],Bt.prototype,"rangeValues",void 0),u([d({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Bt.prototype,"relationParameter",void 0),u([d({type:String,json:{write:!0}})],Bt.prototype,"resultType",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"returnCentroid",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"returnDistinctValues",void 0),u([d({type:Boolean,json:{default:!0,write:!0}})],Bt.prototype,"returnExceededLimitFeatures",void 0),u([d({type:Boolean,json:{write:!0}})],Bt.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"returnQueryGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Bt.prototype,"returnZ",void 0),u([d({type:at,json:{write:!0}})],Bt.prototype,"sourceSpatialReference",void 0),u([bt(sZe,{ignoreUnknown:!1,name:"spatialRel"})],Bt.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Bt.prototype,"start",void 0),u([it("start"),it("num")],Bt.prototype,"writeStart",null),u([d({type:String,json:{write:!0}})],Bt.prototype,"sqlFormat",void 0),u([d({type:String,json:{write:!0}})],Bt.prototype,"text",void 0),u([d({type:py,json:{write:!0}})],Bt.prototype,"timeExtent",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"timeReferenceUnknownClient",void 0),u([bt(nZe,{ignoreUnknown:!1}),d({json:{write:{overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],Bt.prototype,"units",void 0),u([d({type:String,json:{write:{overridePolicy(e){return{enabled:e!=null||this.start>0}}}}})],Bt.prototype,"where",void 0),u([it("where")],Bt.prototype,"writeWhere",null),Bt=pA=u([L("esri.rest.support.Query")],Bt);const Ou=Bt;async function d9(e,t,i){const r=await oZe(e,t,i);return GB.fromJSON(r)}async function oZe(e,t,i){const r=NTe(e),s=F({},i),n=Ou.from(t),{data:o}=await GTe(r,n,n.sourceSpatialReference,s);return o}function fl(e,t){return e?t?4:3:t?3:2}const wL=ve.getLogger("esri.layers.graphics.featureConversionUtils"),qTe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},WTe=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n},rz=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2]},aZe=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+3]},ZTe=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2],e[i+3]=t[r+3]};function Fee(e,t,i,r){if(e){if(i)return t&&r?ZTe:rz;if(t&&r)return aZe}else if(t&&r)return rz;return WTe}function p9({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function f9({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function mle({scale:e,translate:t},i){return i*e[0]+t[0]}function gle({scale:e,translate:t},i){return t[1]-i*e[1]}function kZ(e,t,i){return e?t?i?zee(e):kee(e):i?Uee(e):jB(e):null}function jB(e){const t=e.coords;return{x:t[0],y:t[1]}}function XTe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function kee(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function lZe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function Uee(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function cZe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function zee(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function uZe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function hZe(e,t,i,r){let s=jB;i&&r?s=zee:i?s=kee:r&&(s=Uee);for(const n of t){const{geometry:o,attributes:a}=n,l=_(o)?s(o):null;e.push({attributes:a,geometry:l})}return e}function Vee(e,t){return e&&t?uZe:e?lZe:t?cZe:XTe}function dZe(e,t,i,r,s){const n=Vee(i,r);for(const o of t){const{geometry:a,attributes:l}=o;let c;a&&(c=n(new Ga,a)),e.push(new ey(c,l,null,l[s]))}return e}function M4t(e,t,i=Vee(t.z!=null,t.m!=null)){return i(e,t)}function pZe(e,t,i,r){for(const s of t){const{geometry:n,attributes:o}=s;let a;n&&(a=Bee(n,i,r)),e.push({attributes:o,geometry:a})}return e}function Bee(e,t,i){if(M(e))return null;const r=fl(t,i),s=[];for(let n=0;n<e.coords.length;n+=r){const o=[];for(let a=0;a<r;a++)o.push(e.coords[n+a]);s.push(o)}return t?i?{points:s,hasZ:t,hasM:i}:{points:s,hasZ:t}:i?{points:s,hasM:i}:{points:s}}function fZe(e,t,i,r,s){const n=fl(i,r);for(const o of t){const a=o.geometry,l=o.attributes;let c;a&&(c=YTe(new Ga,a,n)),e.push(new ey(c,l,null,l[s]))}return e}function YTe(e,t,i=fl(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const r=e.coords;let s=0;for(const n of t.points)for(let o=0;o<i;o++)r[s++]=n[o];return e}function mZe(e,t,i,r){for(const s of t){const{geometry:n,attributes:o}=s;let a;_(n)&&(a=Gee(n,i,r)),e.push({attributes:o,geometry:a})}return e}function Gee(e,t,i){if(!e)return null;const r=fl(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<r;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?i?{paths:o,hasZ:t,hasM:i}:{paths:o,hasZ:t}:i?{paths:o,hasM:i}:{paths:o}}function gZe(e,t,i,r,s){const n=fl(i,r);for(const o of t){const a=o.geometry,l=o.attributes;let c;a&&(c=JTe(new Ga,a,n)),e.push(new ey(c,l,null,l[s]))}return e}function JTe(e,t,i=fl(t.hasZ,t.hasM)){const{lengths:r,coords:s}=e;let n=0;for(const o of t.paths){for(const a of o)for(let l=0;l<i;l++)s[n++]=a[l];r.push(o.length)}return e}function yZe(e,t,i,r){for(const s of t){const{geometry:n,attributes:o,centroid:a}=s;let l;if(_(n)&&(l=jee(n,i,r)),_(a)){const c=jB(a);e.push({attributes:o,centroid:c,geometry:l})}else e.push({attributes:o,geometry:l})}return e}function jee(e,t,i){if(!e)return null;const r=fl(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<r;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?i?{rings:o,hasZ:t,hasM:i}:{rings:o,hasZ:t}:i?{rings:o,hasM:i}:{rings:o}}function vZe(e,t,i,r,s){for(const n of t){const o=n.geometry,a=n.centroid,l=n.attributes;let c;o&&(c=QTe(new Ga,o,i,r)),_(a)?e.push(new ey(c,l,XTe(new Ga,a),l[s])):e.push(new ey(c,l,null,l[s]))}return e}function QTe(e,t,i=t.hasZ,r=t.hasM){return _Ze(e,t.rings,i,r),e}function _Ze(e,t,i,r){const s=fl(i,r),{lengths:n,coords:o}=e;let a=0;n.length=o.length=0;for(const l of t){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return e}const fA=[],jI=[];function O4t(e,t,i,r,s){fA[0]=e;const[n]=KTe(jI,fA,t,i,r,s);return fA.length=jI.length=0,n}function KTe(e,t,i,r,s,n){if(e.length=0,!i){for(const o of t){const a=o.attributes[n];e.push(new ey(null,o.attributes,null,a))}return e}switch(i){case"esriGeometryPoint":return dZe(e,t,r,s,n);case"esriGeometryMultipoint":return fZe(e,t,r,s,n);case"esriGeometryPolyline":return gZe(e,t,r,s,n);case"esriGeometryPolygon":return vZe(e,t,r,s,n);default:wL.error("convertToFeatureSet:unknown-geometry",new W(`Unable to parse unknown geometry type '${i}'`)),e.length=0}return e}function R4t(e,t,i,r){jI[0]=e,eSe(fA,jI,t,i,r);const s=fA[0];return fA.length=jI.length=0,s}function bZe(e,t,i){if(M(e))return null;const r=new Ga;return"hasZ"in e&&t==null&&(t=e.hasZ),"hasM"in e&&i==null&&(i=e.hasM),eK(e)?Vee(t!=null?t:e.z!=null,i!=null?i:e.m!=null)(r,e):BT(e)?QTe(r,e,t,i):tK(e)?JTe(r,e,fl(t,i)):KQ(e)?YTe(r,e,fl(t,i)):void wL.error("convertFromGeometry:unknown-geometry",new W(`Unable to parse unknown geometry type '${e}'`))}function wZe(e,t,i,r){const s=e&&("coords"in e?e:e.geometry);if(M(s))return null;switch(t){case"esriGeometryPoint":{let n=jB;return i&&r?n=zee:i?n=kee:r&&(n=Uee),n(s)}case"esriGeometryMultipoint":return Bee(s,i,r);case"esriGeometryPolyline":return Gee(s,i,r);case"esriGeometryPolygon":return jee(s,i,r);default:return void wL.error("convertToGeometry:unknown-geometry",new W(`Unable to parse unknown geometry type '${t}'`))}}function xZe(e,t){for(const i of t)e.push({attributes:i.attributes});return e}function eSe(e,t,i,r,s){if(e.length=0,M(i))return xZe(e,t);switch(i){case"esriGeometryPoint":return hZe(e,t,r,s);case"esriGeometryMultipoint":return pZe(e,t,r,s);case"esriGeometryPolyline":return mZe(e,t,r,s);case"esriGeometryPolygon":return yZe(e,t,r,s);default:wL.error("convertToFeatureSet:unknown-geometry",new W(`Unable to parse unknown geometry type '${i}'`))}return e}function P4t(e){const{objectIdFieldName:t,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:p,queryGeometryType:f}=e,m={features:eSe([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:t,spatialReference:i,uniqueIdField:h,queryGeometry:wZe(p,f,!1,!1)};return r&&(m.transform=r),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function I4t(e,t){const i=new BB,{hasM:r,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:p}=e;return p&&(i.fields=p),i.geometryType=l,i.objectIdFieldName=o||t,i.spatialReference=a,i.objectIdFieldName?(n&&KTe(i.features,n,l,s,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),s&&(i.hasZ=s),h&&(i.transform=h),i):(wL.error(new W("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function $4t(e){const{transform:t,features:i,hasM:r,hasZ:s}=e;if(!t)return e;for(const n of i)_(n.geometry)&&yle(n.geometry,n.geometry,r,s,t),_(n.centroid)&&yle(n.centroid,n.centroid,r,s,t);return e.transform=null,e}function L4t(e,t){const{geometryType:i,features:r,hasM:s,hasZ:n}=t;if(!e)return t;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new Ga,X3(l.geometry,a.geometry,s,n,i,e),a.centroid&&(l.centroid=new Ga,X3(l.centroid,a.centroid,s,n,"esriGeometryPoint",e)),r[o]=l}return t.transform=e,t}function X3(e,t,i,r,s,n,o=i,a=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),M(t)||!t.coords.length)return null;const l=qTe[s],{coords:c,lengths:h}=t,p=fl(i,r),f=fl(i&&o,r&&a),m=Fee(i,r,o,a);if(!h.length)return m(e.coords,c,0,0,p9(n,c[0]),f9(n,c[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let g,y,x,b,S=0,T=0,C=T;for(const A of h){if(A<l)continue;let O=0;T=C,x=g=p9(n,c[S]),b=y=f9(n,c[S+1]),m(e.coords,c,T,S,x,b),O++,S+=p,T+=f;for(let D=1;D<A;D++,S+=p)x=p9(n,c[S]),b=f9(n,c[S+1]),x===g&&b===y||(m(e.coords,c,T,S,x-g,b-y),T+=f,O++,g=x,y=b);O>=l&&(e.lengths.push(O),C=T)}return e.coords.length=C,e.coords.length?e:null}function TZe(e,t,i,r,s,n,o=i,a=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=qTe[s],{coords:c,lengths:h}=t,p=fl(i,r),f=fl(i&&o,r&&a),m=Fee(i,r,o,a);if(!h.length)return m(e.coords,c,0,0,c[0],c[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let g=0;const y=n*n;for(const x of h){if(x<l){g+=x*p;continue}const b=e.coords.length/f,S=g,T=g+(x-1)*p;m(e.coords,c,e.coords.length,S,c[S],c[S+1]),UZ(e.coords,c,p,y,m,S,T),m(e.coords,c,e.coords.length,T,c[T],c[T+1]);const C=e.coords.length/f-b;C>=l?e.lengths.push(C):e.coords.length=b*f,g+=x*p}return e.coords.length?e:null}function SZe(e,t,i,r){const s=e[t],n=e[t+1],o=e[i],a=e[i+1],l=e[r],c=e[r+1];let h=o,p=a,f=l-h,m=c-p;if(f!==0||m!==0){const g=((s-h)*f+(n-p)*m)/(f*f+m*m);g>1?(h=l,p=c):g>0&&(h+=f*g,p+=m*g)}return f=s-h,m=n-p,f*f+m*m}function UZ(e,t,i,r,s,n,o){let a,l=r,c=0;for(let h=n+i;h<o;h+=i)a=SZe(t,h,n,o),a>l&&(c=h,l=a);l>r&&(c-n>i&&UZ(e,t,i,r,s,n,c),s(e,t,e.length,c,t[c],t[c+1]),o-c>i&&UZ(e,t,i,r,s,c,o))}function D4t(e,t,i,r){if(M(t)||!t.coords||!t.coords.length)return null;const s=fl(i,r);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const c=t.coords;for(let h=0;h<c.length;h+=s){const p=c[h],f=c[h+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return e[0]=n,e[1]=o,e[2]=a,e[3]=l,e}function yle(e,t,i,r,s){const{coords:n,lengths:o}=t,a=i?r?ZTe:rz:r?rz:WTe,l=fl(i,r);if(!n.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!o.length)return a(e.coords,n,0,0,mle(s,n[0]),gle(s,n[1])),e!==t&&(e.lengths.length=0,e.coords.length=l),e;const[c,h]=s.scale;let p=0;for(let f=0;f<o.length;f++){const m=o[f];e.lengths[f]=m;let g=mle(s,n[p]),y=gle(s,n[p+1]);a(e.coords,n,p,p,g,y),p+=l;for(let x=1;x<m;x++,p+=l)g+=n[p]*c,y-=n[p+1]*h,a(e.coords,n,p,p,g,y)}return e!==t&&(e.lengths.length=o.length,e.coords.length=n.length),e}function EZe(e,t,i,r,s,n){const o=fl(i,r),a=Fee(i,r,s,n),l=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(let c=0;c<l.length;c+=o)a(e.coords,l,e.coords.length,c,l[c],l[c+1]);return e}function CZe(e,t,i,r){let s=0,n=e[r*t],o=e[r*(t+1)];for(let a=1;a<i;a++){const l=n+e[r*(t+a)],c=o+e[r*(t+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function N4t(e,t){const{coords:i,lengths:r}=e;let s=0,n=0;for(let o=0;o<r.length;o++)n+=CZe(i,s,r[o],t),s+=o;return Math.abs(n)}function F4t(e,t){if(M(e))return null;const i=e.clone(),r=e.coords,s=e.lengths;let n=0;for(let o=0;o<s.length;o++){const a=s[o];let l=r[t*n],c=r[t*n+1];for(let h=1;h<a;h++){const p=l+r[t*(n+h)],f=c+r[t*(n+h)+1];i.coords[t*(n+h)]=p,i.coords[t*(n+h)+1]=f,l=p,c=f}n+=a}return i}var zZ;let rn=zZ=class extends Ce{constructor(e){super(e),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(t.definitionExpression="1=1")}clone(){return new zZ(ue({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([d({type:Boolean,json:{write:!0}})],rn.prototype,"cacheHint",void 0),u([d({type:Ph,json:{write:!0}})],rn.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],rn.prototype,"gdbVersion",void 0),u([d({type:Number,json:{write:!0}})],rn.prototype,"geometryPrecision",void 0),u([d({type:Date})],rn.prototype,"historicMoment",void 0),u([it("historicMoment")],rn.prototype,"_writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],rn.prototype,"maxAllowableOffset",void 0),u([d({type:[Number],json:{write:!0}})],rn.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],rn.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],rn.prototype,"outFields",void 0),u([d({type:at,json:{read:{source:"outSR"},write:{target:"outSR"}}})],rn.prototype,"outSpatialReference",void 0),u([d({json:{write:!0}})],rn.prototype,"relationshipId",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],rn.prototype,"start",void 0),u([it("start"),it("num")],rn.prototype,"writeStart",null),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],rn.prototype,"num",void 0),u([d({json:{write:!0}})],rn.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],rn.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],rn.prototype,"returnZ",void 0),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],rn.prototype,"where",void 0),rn=zZ=u([L("esri.rest.support.RelationshipQuery")],rn),rn.from=dn(rn);const VZ=rn;var BZ;let WE=BZ=class extends Ce{constructor(e){super(e),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new BZ({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([d({type:[String],json:{write:!0}})],WE.prototype,"groupByFields",void 0),u([d({type:Number,json:{write:!0}})],WE.prototype,"topCount",void 0),u([d({type:[String],json:{write:!0}})],WE.prototype,"orderByFields",void 0),WE=BZ=u([L("esri.rest.support.TopFilter")],WE);const AZe=WE;var GZ;const vle=new Ti({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),_le=new Ti({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Ns=GZ=class extends Ce{constructor(e){super(e),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new GZ(ue({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([d({type:Boolean,json:{write:!0}})],Ns.prototype,"cacheHint",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],Ns.prototype,"distance",void 0),u([d({types:qS,json:{read:jg,write:!0}})],Ns.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],Ns.prototype,"geometryPrecision",void 0),u([d({type:Number,json:{write:!0}})],Ns.prototype,"maxAllowableOffset",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Ns.prototype,"num",void 0),u([d({json:{write:!0}})],Ns.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],Ns.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],Ns.prototype,"outFields",void 0),u([d({type:at,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Ns.prototype,"outSpatialReference",void 0),u([d({type:String,json:{write:!0}})],Ns.prototype,"resultType",void 0),u([d({json:{write:!0}})],Ns.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Ns.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Ns.prototype,"returnZ",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Ns.prototype,"start",void 0),u([it("start"),it("num")],Ns.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"spatialRel",reader:vle.read},write:{target:"spatialRel",writer:vle.write}}})],Ns.prototype,"spatialRelationship",void 0),u([d({type:py,json:{write:!0}})],Ns.prototype,"timeExtent",void 0),u([d({type:AZe,json:{write:!0}})],Ns.prototype,"topFilter",void 0),u([d({type:String,json:{read:_le.read,write:{writer:_le.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],Ns.prototype,"units",void 0),u([d({type:String,json:{write:!0}})],Ns.prototype,"where",void 0),Ns=GZ=u([L("esri.rest.support.TopFeaturesQuery")],Ns),Ns.from=dn(Ns);const eN=Ns,MZe="esri.widgets.Feature.support.relatedFeatureUtils",ble=ve.getLogger(MZe),wle=new Map;function jZ(e){if(!z0(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function OZe(e,t){if(!t.relationships)return null;let i=null;const{relationships:r}=t;return r.some(s=>s.id===parseInt(e,10)&&(i=s,!0)),i}function RZe({originRelationship:e,relationships:t,layerId:i}){let r;return t&&t.some(s=>(`${s.relatedTableId}`===i&&s.id===e.id&&(r=s),!!r)),r}function PZe(e,t){const i=t.toLowerCase();for(const r in e)if(r.toLowerCase()===i)return e[r];return null}function IZe(e,t){const i=OZe(e,t);if(!!i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function $Ze(e,t){if(!t||!e)return;const{features:i,statsFeatures:r}=e,s=i&&i.value;t.relatedFeatures=s?s.features:[];const n=r&&r.value;t.relatedStatsFeatures=n?n.features:[]}function LZe(e,t,i,r){const s=new VZ;return s.outFields=["*"],s.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[i.objectIdField]],i.queryRelatedFeatures(s,r)}function DZe(e,t,i){let r=0;const s=[];for(;r<t.length;)s.push(`${e} IN (${t.slice(r,i+r)})`),r+=i;return s.join(" OR ")}async function NZe(e,t,i,r){const s=i.layerId.toString(),{layerInfo:n,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:h}=t,p=RZe({originRelationship:o,relationships:n.relationships,layerId:s});if(p.relationshipTableId&&p.keyFieldInRelationshipTable){const m=(await LZe(e,p,i,r))[e.attributes[i.objectIdField]];if(!m)return null;const g=m.features.map(y=>y.attributes[n.objectIdField]);if((l==null?void 0:l.length)>0&&n.supportsStatistics){const y=new Ou;y.where=DZe(n.objectIdField,g,1e3),y.outFields=a,y.outStatistics=l,y.sourceSpatialReference=h;const x={features:Promise.resolve(m),statsFeatures:d9(c,y)};return Us(x)}}const f=p==null?void 0:p.keyField;if(f){const m=jV(VZe(n.fields,f)),g=PZe(e.attributes,o.keyField),y=m?`${f}=${g}`:`${f}='${g}'`,x=d9(c,new Ou({where:y,outFields:t.relatedFields,sourceSpatialReference:h}),r),b=t.outStatistics&&t.outStatistics.length>0&&n.supportsStatistics?d9(c,new Ou({where:y,outFields:t.relatedFields,outStatistics:t.outStatistics,sourceSpatialReference:h}),r):null,S={features:x};return b&&(S.statsFeatures=b),Us(S)}return null}function FZe(e,t){return Zt(e,{query:{f:"json"},signal:t&&t.signal})}function kZe({relatedInfos:e,layer:t},i){const r={};return e.forEach((s,n)=>{const{relation:o}=s;if(!o){const p=new W("relation-required","A relation is required on a layer to retrieve related records.");throw ble.error(p),p}const{relatedTableId:a}=o;if(typeof a!="number"){const p=new W("A related table ID is required on a layer to retrieve related records.");throw ble.error(p),p}const l=`${t.url}/${a}`,c=wle.get(l),h=c||FZe(l,i);c||wle.set(l,h),r[n]=h}),Us(r)}function UZe({graphic:e,relatedInfos:t,layer:i},r){const s={};return t.forEach((n,o)=>{n.layerInfo&&(s[o]=NZe(e,n,i,r))}),Us(s)}function zZe({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields.push(t),i.statisticType){const r=new HTe({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(r)}}function VZe(e,t){if(e!=null){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}const xle={chartAnimation:!0};let Ko=class extends Ee{constructor(e){super(e),this.abilities=F({},xle),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return F(F({},xle),e)}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:i,expressionAttributes:r,fieldInfoMap:s,layer:n}=this;return t==null?void 0:t.map(o=>{const a=o==null?void 0:o.clone();if(!a)return null;if(a.title=MT({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.title}),a.caption=MT({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.caption}),a.altText=MT({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.altText}),a.type==="image"){const{value:l}=a;return this._setImageValue({value:l,formattedAttributes:i,layer:n}),a.value.sourceURL?a:void 0}if(a.type==="pie-chart"||a.type==="line-chart"||a.type==="column-chart"||a.type==="bar-chart"){const{value:l}=a;return this._setChartValue({value:l,chartType:a.type,attributes:e,formattedAttributes:i,layer:n}),a}return null}).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:i,formattedAttributes:r,layer:s}=e,{linkURL:n,sourceURL:o}=i;if(o){const a=pZ(o,s);i.sourceURL=dZ({formattedAttributes:r,template:a,fieldInfoMap:t})}if(n){const a=pZ(n,s);i.linkURL=dZ({formattedAttributes:r,template:a,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:i,formattedAttributes:r,chartType:s,layer:n}=e,{popupTemplate:o,relatedInfos:a}=this,{fields:l,normalizeField:c}=t;if(t.fields=Z7e(l,n),c&&(t.normalizeField=ZU(c,n)),!l.some(p=>!!(r[p]!=null||z0(p)&&a.size)))return;const h=o==null?void 0:o.fieldInfos;l.forEach(p=>{if(z0(p))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:h,fieldName:p,formattedAttributes:r,chartType:s,value:t})]);const f=this._getChartOption({value:t,attributes:i,chartType:s,formattedAttributes:r,fieldName:p,fieldInfos:h});t.series.push(f)})}_getRelatedChartInfos(e){var g;const{fieldInfos:t,fieldName:i,formattedAttributes:r,chartType:s,value:n}=e,o=[],a=jZ(i),{layerId:l,fieldName:c}=a,h=(g=this.relatedInfos)==null?void 0:g.get(l.toString());if(!h)return o;const{relatedFeatures:p,relation:f}=h;if(!f||!p)return o;const{cardinality:m}=f;return p.forEach(y=>{const{attributes:x}=y;x&&Object.keys(x).forEach(b=>{b===c&&o.push(this._getChartOption({value:n,attributes:x,formattedAttributes:r,fieldName:i,chartType:s,relatedFieldName:b,fieldInfos:t}))})}),m==="one-to-many"||m==="many-to-many"?o:[o[0]]}_getTooltip({label:e,value:t,chartType:i}){return i==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){var T,C,A,O,D,U;const{value:t,attributes:i,formattedAttributes:r,fieldName:s,relatedFieldName:n,fieldInfos:o,chartType:a}=e,{layer:l,fieldInfoMap:c}=this,{normalizeField:h,tooltipField:p}=t,f=h?z0(h)?i[jZ(h).fieldName]:i[h]:null,m=n&&i[n]!==void 0?i[n]:i[s]!==void 0?i[s]:r[s],g=new U_e({fieldName:s,value:m===void 0?null:m&&f?m/f:m});if(z0(s)){const k=c.get(s.toLowerCase()),B=c.get(p.toLowerCase()),j=(T=k==null?void 0:k.fieldName)!=null?T:s,H=(D=(O=(A=r[(C=B==null?void 0:B.fieldName)!=null?C:p])!=null?A:k==null?void 0:k.label)!=null?O:k==null?void 0:k.fieldName)!=null?D:n,K=r[j];return g.tooltip=this._getTooltip({label:H,value:K,chartType:a}),g}const y=rTe(o,s),x=ZU(s,l),b=p&&r[p]!==void 0?r[p]:tTe(y||new uL({fieldName:x}),(U=this.popupTemplate)==null?void 0:U.expressionInfos),S=r[x];return g.tooltip=this._getTooltip({label:b,value:S,chartType:a}),g}};u([d()],Ko.prototype,"abilities",void 0),u([Jt("abilities")],Ko.prototype,"castAbilities",null),u([d()],Ko.prototype,"activeMediaInfoIndex",void 0),u([d({readOnly:!0})],Ko.prototype,"activeMediaInfo",null),u([d()],Ko.prototype,"attributes",void 0),u([d()],Ko.prototype,"description",void 0),u([d()],Ko.prototype,"fieldInfoMap",void 0),u([d()],Ko.prototype,"formattedAttributes",void 0),u([d()],Ko.prototype,"expressionAttributes",void 0),u([d({readOnly:!0})],Ko.prototype,"formattedMediaInfos",null),u([d()],Ko.prototype,"layer",void 0),u([d({readOnly:!0})],Ko.prototype,"formattedMediaInfoCount",null),u([d()],Ko.prototype,"mediaInfos",void 0),u([d()],Ko.prototype,"popupTemplate",void 0),u([d()],Ko.prototype,"relatedInfos",void 0),u([d()],Ko.prototype,"title",void 0),Ko=u([L("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Ko);const RT=Ko;var Tle=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],BZe=[].concat(Tle.slice(30,39),Tle.slice(28,30).reverse()),GZe=[{name:"default",colors:BZe},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const Sle="en-us",Hee=new Map([["ar",()=>import("./ar.0cfd1ad5.js").then(e=>e.a)],["bg-bg",()=>import("./bg_BG.a4c4346d.js").then(e=>e.b)],["bs-ba",()=>import("./bs_BA.1fdc96de.js").then(e=>e.b)],["ca-es",()=>import("./ca_ES.162819f9.js").then(e=>e.c)],["cs-cz",()=>import("./cs_CZ.0a973e7a.js").then(e=>e.c)],["da-dk",()=>import("./da_DK.582e6a97.js").then(e=>e.d)],["de-de",()=>import("./de_DE.2d05c736.js").then(e=>e.d)],["de-ch",()=>import("./de_CH.405f7ecb.js").then(e=>e.d)],["el-gr",()=>import("./el_GR.786b55e7.js").then(e=>e.e)],["en-us",()=>import("./en_US.3b2746a1.js").then(e=>e.e)],["en-ca",()=>import("./en_CA.c1328458.js").then(e=>e.e)],["es-es",()=>import("./es_ES.aa0fa20b.js").then(e=>e.e)],["et-ee",()=>import("./et_EE.cdc9b900.js").then(e=>e.e)],["fi-fi",()=>import("./fi_FI.5de42a61.js").then(e=>e.f)],["fr-fr",()=>import("./fr_FR.46e375fe.js").then(e=>e.f)],["he-il",()=>import("./he_IL.3d8c0e9d.js").then(e=>e.h)],["hr-hr",()=>import("./hr_HR.e9d1b789.js").then(e=>e.h)],["hu-hu",()=>import("./hu_HU.b2070c88.js").then(e=>e.h)],["id-id",()=>import("./id_ID.400c753c.js").then(e=>e.i)],["it-it",()=>import("./it_IT.8b876fc7.js").then(e=>e.i)],["ja-jp",()=>import("./ja_JP.53c9b2f9.js").then(e=>e.j)],["ko-kr",()=>import("./ko_KR.693e444c.js").then(e=>e.k)],["lt-lt",()=>import("./lt_LT.1989c790.js").then(e=>e.l)],["lv-lv",()=>import("./lv_LV.46436eaf.js").then(e=>e.l)],["nb-no",()=>import("./nb_NO.b837c13d.js").then(e=>e.n)],["nl-nl",()=>import("./nl_NL.3d78b864.js").then(e=>e.n)],["pl-pl",()=>import("./pl_PL.07719441.js").then(e=>e.p)],["pt-br",()=>import("./pt_BR.2ff72df4.js").then(e=>e.p)],["pt-pt",()=>import("./pt_PT.ea078852.js").then(e=>e.p)],["ro-ro",()=>import("./ro_RO.a174b6bc.js").then(e=>e.r)],["ru-ru",()=>import("./ru_RU.dc31ffdc.js").then(e=>e.r)],["sk-sk",()=>import("./sk_SK.b1dd09d8.js").then(e=>e.s)],["sl-sl",()=>import("./sl_SL.c92ffcb1.js").then(e=>e.s)],["sr-rs",()=>import("./sr_RS.e8d9e90f.js").then(e=>e.s)],["sv-se",()=>import("./sv_SE.0fd24324.js").then(e=>e.s)],["th-th",()=>import("./th_TH.1a87c955.js").then(e=>e.t)],["tr-tr",()=>import("./tr_TR.1b79533a.js").then(e=>e.t)],["uk-ua",()=>import("./uk_UA.d5312738.js").then(e=>e.u)],["vi-vn",()=>import("./vi_VN.d21dd0ec.js").then(e=>e.v)],["zh-cn",()=>import("./zh_Hans.4246a79d.js").then(e=>e.z)],["zh-hk",()=>import("./zh_Hant.75442820.js").then(e=>e.z)],["zh-tw",()=>import("./zh_Hant.75442820.js").then(e=>e.z)]]);function jZe(e){const t=e.split("-")[0].toLowerCase();let i=null;for(const r of Hee.keys())if(r.startsWith(t)){i=r;break}return i}function HZe(e){return e?Hee.has(e.toLowerCase())?e.toLowerCase():jZe(e)||Sle:Sle}let O2,KO;async function tSe(e=ul()){if(e=HZe(e),O2&&e===KO)return O2;O2=import("./index.671184cf.js").then(t=>t.i),KO=e;try{const[t,i]=await Promise.all([O2,Hee.get(KO)()]);KO===e&&(t.am4core.options.defaultLocale=i.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return O2=null,KO=null,null}return O2}function qZe(e,t="default"){const i=GZe.find(r=>r.name===t);return i?i.colors.map(r=>e.color(r)):null}const mn={base:"esri-feature-media",mediaContainer:"esri-feature-media__container",mediaItemContainer:"esri-feature-media__item-container",mediaItem:"esri-feature-media__item",mediaItemTitle:"esri-feature-media__item-title",mediaItemCaption:"esri-feature-media__item-caption",mediaPrevious:"esri-feature-media__previous",mediaPreviousIconLTR:"esri-feature-media__previous-icon",mediaPreviousIconRTL:"esri-feature-media__previous-icon--rtl",mediaNext:"esri-feature-media__next",mediaNextIconLTR:"esri-feature-media__next-icon",mediaNextIconRTL:"esri-feature-media__next-icon--rtl",mediaChart:"esri-feature-media__chart",mediaButton:"esri-feature-media__button",mediaIcon:"esri-feature-media__icon",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},m9=.05,g9=.95,y9=15,My="color",r_="tooltip",eR="value",Ele="default-line-value";let ou=class extends Yr{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new RT,this.messages=null,this._getChartDependencies=async i=>{const r=await tSe(),{destroyed:s,viewModel:n}=this;if(s||!n||!i)return;const{activeMediaInfo:o}=n,a=await this._getRendererColors(r);this._renderChart({chartDiv:i,mediaInfo:o,chartsModule:r,colorMap:a})}}initialize(){this._featureElementInfo=new Eee,this.own([re(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(t=this.viewModel)==null?void 0:t.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),Et),re(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),Et)])}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var e;return N("div",{bind:this,class:mn.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?N("div",{key:"media-element-container",class:mn.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel,{value:s,refreshInterval:n,altText:o,title:a,type:l}=e,{sourceURL:c,linkURL:h}=s,p=Kxe(h)?"_blank":"_self",f=p==="_blank"?"noreferrer":"",m=n?t:null,g=m?m.timestamp:0,y=m?m.sourceURL:c,x=N("img",{alt:o||a,key:`media-${l}-${i}-${r}-${g}`,src:y});return(h?N("a",{title:a,href:h,rel:f,target:p},x):null)||x}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return N("div",{key:`media-${e.type}-${t}-${i}`,bind:this,class:mn.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e.title?N("div",{key:"media-title",class:mn.mediaItemTitle,innerHTML:e.title}):null,i=e.caption?N("div",{key:"media-caption",class:mn.mediaItemCaption,innerHTML:e.caption}):null;return N("div",{key:"media-container",class:mn.mediaItemContainer},N("div",{key:"media-item-container",class:mn.mediaItem},this.renderMediaInfoType()),t,i)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t=e==="previous",i=t?this.messages.previous:this.messages.next,r=t?this.classes(mn.mediaButton,mn.mediaPrevious):this.classes(mn.mediaButton,mn.mediaNext),s=t?this.classes(mn.mediaIcon,mn.mediaPreviousIconLTR,mn.iconLeftTriangleArrow):this.classes(mn.mediaIcon,mn.mediaNextIconLTR,mn.iconRightTriangleArrow),n=t?this.classes(mn.mediaIcon,mn.mediaPreviousIconRTL,mn.iconRightTriangleArrow):this.classes(mn.mediaIcon,mn.mediaNextIconRTL,mn.iconLeftTriangleArrow),o=t?"media-previous":"media-next",a=t?this._previous:this._next;return N("button",{type:"button",key:o,title:i,"aria-label":i,tabIndex:0,class:r,bind:this,onclick:a},N("span",{"aria-hidden":"true",class:s}),N("span",{"aria-hidden":"true",class:n}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getRendererColors(e){var n;const{am4core:t}=e,i=(n=this.viewModel)==null?void 0:n.layer,r=new Map;if(!i)return r;const s=await aWe(i.renderer);return s.delete(null),Array.from(s.values()).every(o=>(o==null?void 0:o.length)===1)&&(r.set(Ele,t.color({r:50,g:50,b:50,a:1})),Array.from(s.keys()).forEach(o=>{o&&r.set(o,t.color(s.get(o)[0].toCss(!0)))})),r}_handleMediaKeyup(e){const t=Mc(e);t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:t}=this.viewModel,{chartsModule:i,chartDiv:r,mediaInfo:s,colorMap:n}=e,{value:o,type:a}=s,{am4core:l}=i,c=qZe(l);function h(m){m instanceof l.ColorSet&&c&&(m.list=c)}RB()&&l.useTheme(i.am4themes_dark);const p=window.matchMedia("(prefers-reduced-motion: reduce)");t.chartAnimation&&!p.matches?l.useTheme(i.am4themes_animated):l.unuseTheme(i.am4themes_animated),l.useTheme(h);const f=a==="pie-chart"?this._createPieChart(e):this._createXYChart(e);r.setAttribute("aria-label",s.altText||s.title),f.data=o.series.map(m=>({[r_]:m.tooltip,[eR]:m.value,[My]:n.get(m.fieldName)})).filter(m=>a!=="pie-chart"||m.value>0)}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:i}=e,{am4core:r,am4charts:s}=i,n=r.create(t,s.PieChart);n.rtl=jl(this.container);const o=n.series.push(new s.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value=eR,o.dataFields.category=r_,this._customizeChartTooltip(o.tooltip,r),o.slices.template.tooltipText=n.rtl?"{category}: %{value.percent.formatNumber('#.0')}":"{category}: {value.percent.formatNumber('#.0')}%",o.slices.template.propertyFields.fill=My,o.slices.template.propertyFields.stroke=My,n}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}_createColumnChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category=r_,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dy=-a.tooltip.contentHeight});const l=e.yAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=m9,l.renderer.maxLabelPosition=g9,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const h=e.series.push(new o.ColumnSeries);h.dataFields.valueY=eR,h.dataFields.categoryX=r_,h.columns.template.propertyFields.fill=My,h.columns.template.propertyFields.stroke=My,e.cursor=new o.XYCursor,s.series.length>y9&&(e.scrollbarX=new n.Scrollbar)}_createBarChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.yAxes.push(new o.CategoryAxis);a.dataFields.category=r_,a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dx=a.tooltip.contentWidth});const l=e.xAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=m9,l.renderer.maxLabelPosition=g9,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const h=e.series.push(new o.ColumnSeries);h.dataFields.valueX=eR,h.dataFields.categoryY=r_,h.columns.template.propertyFields.fill=My,h.columns.template.propertyFields.stroke=My,e.cursor=new o.XYCursor,s.series.length>y9&&(e.scrollbarY=new n.Scrollbar)}_createLineChart(e,t){const{chartsModule:i,mediaInfo:r,colorMap:s}=t,{value:n}=r,{am4core:o,am4charts:a}=i,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category=r_,l.renderer.labels.template.disabled=!0,this._customizeChartTooltip(l.tooltip,o),l.tooltip.events.on("sizechanged",()=>{l.tooltip.dy=-l.tooltip.contentHeight});const c=e.yAxes.push(new a.ValueAxis),h=c.renderer.labels.template;c.renderer.minLabelPosition=m9,c.renderer.maxLabelPosition=g9,c.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(c.tooltip,o),h.wrap=!0;const p=e.series.push(new a.LineSeries);p.dataFields.categoryX=r_,p.dataFields.valueY=eR,p.strokeWidth=1;const f=s.get(Ele);f&&(p.stroke=f);const m=p.bullets.push(new a.CircleBullet);m.propertyFields.fill=My,m.propertyFields.stroke=My,e.cursor=new a.XYCursor,n.series.length>y9&&(e.scrollbarX=new o.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:i,mediaInfo:r}=e,{type:s}=r,{am4core:n,am4charts:o}=i,a=n.create(t,o.XYChart);return a.rtl=jl(this.container),s==="column-chart"&&this._createColumnChart(a,e),s==="bar-chart"&&this._createBarChart(a,e),s==="line-chart"&&this._createLineChart(a,e),a}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e;if(!t)return;const r=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const s=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},r);this._refreshTimer=s}_getImageSource(e,t){const i=e.includes("?")?"&":"?",[r,s=""]=e.split("#");return`${r}${i}timestamp=${t}${s?"#":""}${s}`}};u([ze("viewModel.attributes")],ou.prototype,"attributes",void 0),u([ze("viewModel.activeMediaInfoIndex")],ou.prototype,"activeMediaInfoIndex",void 0),u([ze("viewModel.description")],ou.prototype,"description",void 0),u([ze("viewModel.fieldInfoMap")],ou.prototype,"fieldInfoMap",void 0),u([ze("viewModel.layer")],ou.prototype,"layer",void 0),u([ze("viewModel.mediaInfos")],ou.prototype,"mediaInfos",void 0),u([ze("viewModel.popupTemplate")],ou.prototype,"popupTemplate",void 0),u([ze("viewModel.relatedInfos")],ou.prototype,"relatedInfos",void 0),u([ze("viewModel.title")],ou.prototype,"title",void 0),u([d({type:RT})],ou.prototype,"viewModel",void 0),u([d(),pr("esri/widgets/Feature/t9n/Feature")],ou.prototype,"messages",void 0),ou=u([L("esri.widgets.Feature.FeatureMedia")],ou);const iSe=ou;class WZe{constructor(t,i){this.definition=null,this.context=null,this.definition=t,this.context=i}}class fy{constructor(t=[]){this._elements=t}length(){return this._elements.length}get(t){return this._elements[t]}toArray(){const t=[];for(let i=0;i<this.length();i++)t.push(this.get(i));return t}}class s2 extends fy{constructor(t,i,r,s,n,o){super(t),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=i,this._hasZ=r,this._hasM=s,this._cacheId=n,this._partId=o}get(t){if(this._lazyPt[t]===void 0){const i=this._elements[t];if(i===void 0)return;const r=this._hasZ,s=this._hasM;let n=null;n=r&&!s?new dt(i[0],i[1],i[2],void 0,this._spRef):s&&!r?new dt(i[0],i[1],void 0,i[2],this._spRef):r&&s?new dt(i[0],i[1],i[2],i[3],this._spRef):new dt(i[0],i[1],this._spRef),n.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+t.toString(),this._lazyPt[t]=n}return this._lazyPt[t]}equalityTest(t){return t===this||t!==null&&t instanceof s2&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}class qee extends fy{constructor(t,i,r,s,n){super(t),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=r,this._hasM=s,this._spRef=i,this._cacheId=n}get(t){if(this._lazyPath[t]===void 0){const i=this._elements[t];if(i===void 0)return;this._lazyPath[t]=new s2(i,this._spRef,this._hasZ,this._hasM,this._cacheId,t)}return this._lazyPath[t]}equalityTest(t){return t===this||t!==null&&t instanceof qee&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}class n2 extends Error{}class ZZe extends n2{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class XZe extends n2{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class YZe extends n2{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class UP extends n2{}class rSe extends n2{constructor(t){super(`Invalid unit ${t}`)}}class ip extends n2{}class s_ extends n2{constructor(){super("Zone is an abstract class")}}const pt="numeric",am="short",Qh="long",HZ={year:pt,month:pt,day:pt},sSe={year:pt,month:am,day:pt},JZe={year:pt,month:am,day:pt,weekday:am},nSe={year:pt,month:Qh,day:pt},oSe={year:pt,month:Qh,day:pt,weekday:Qh},aSe={hour:pt,minute:pt},lSe={hour:pt,minute:pt,second:pt},cSe={hour:pt,minute:pt,second:pt,timeZoneName:am},uSe={hour:pt,minute:pt,second:pt,timeZoneName:Qh},hSe={hour:pt,minute:pt,hourCycle:"h23"},dSe={hour:pt,minute:pt,second:pt,hourCycle:"h23"},pSe={hour:pt,minute:pt,second:pt,hourCycle:"h23",timeZoneName:am},fSe={hour:pt,minute:pt,second:pt,hourCycle:"h23",timeZoneName:Qh},mSe={year:pt,month:pt,day:pt,hour:pt,minute:pt},gSe={year:pt,month:pt,day:pt,hour:pt,minute:pt,second:pt},ySe={year:pt,month:am,day:pt,hour:pt,minute:pt},vSe={year:pt,month:am,day:pt,hour:pt,minute:pt,second:pt},QZe={year:pt,month:am,day:pt,weekday:am,hour:pt,minute:pt},_Se={year:pt,month:Qh,day:pt,hour:pt,minute:pt,timeZoneName:am},bSe={year:pt,month:Qh,day:pt,hour:pt,minute:pt,second:pt,timeZoneName:am},wSe={year:pt,month:Qh,day:pt,weekday:Qh,hour:pt,minute:pt,timeZoneName:Qh},xSe={year:pt,month:Qh,day:pt,weekday:Qh,hour:pt,minute:pt,second:pt,timeZoneName:Qh};function vr(e){return typeof e=="undefined"}function JT(e){return typeof e=="number"}function HB(e){return typeof e=="number"&&e%1===0}function KZe(e){return typeof e=="string"}function eXe(e){return Object.prototype.toString.call(e)==="[object Date]"}function TSe(){try{return typeof Intl!="undefined"&&!!Intl.RelativeTimeFormat}catch{return!1}}function tXe(e){return Array.isArray(e)?e:[e]}function Cle(e,t,i){if(e.length!==0)return e.reduce((r,s)=>{const n=[t(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function iXe(e,t){return t.reduce((i,r)=>(i[r]=e[r],i),{})}function nM(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function V0(e,t,i){return HB(e)&&e>=t&&e<=i}function rXe(e,t){return e-t*Math.floor(e/t)}function Po(e,t=2){const i=e<0;let r;return i?r="-"+(""+-e).padStart(t,"0"):r=(""+e).padStart(t,"0"),r}function C1(e){if(!(vr(e)||e===null||e===""))return parseInt(e,10)}function lw(e){if(!(vr(e)||e===null||e===""))return parseFloat(e)}function Wee(e){if(!(vr(e)||e===null||e==="")){const t=parseFloat("0."+e)*1e3;return Math.floor(t)}}function Zee(e,t,i=!1){const r=10**t;return(i?Math.trunc:Math.round)(e*r)/r}function xL(e){return e%4===0&&(e%100!==0||e%400===0)}function HI(e){return xL(e)?366:365}function sz(e,t){const i=rXe(t-1,12)+1,r=e+(t-i)/12;return i===2?xL(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function Xee(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(t.getUTCFullYear()-1900)),+t}function nz(e){const t=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,i=e-1,r=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7;return t===4||r===3?53:52}function qZ(e){return e>99?e:e>60?1900+e:2e3+e}function SSe(e,t,i,r=null){const s=new Date(e),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const o=F({timeZoneName:t},n),a=new Intl.DateTimeFormat(i,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function qB(e,t){let i=parseInt(e,10);Number.isNaN(i)&&(i=0);const r=parseInt(t,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function ESe(e){const t=Number(e);if(typeof e=="boolean"||e===""||Number.isNaN(t))throw new ip(`Invalid unit value ${e}`);return t}function oz(e,t){const i={};for(const r in e)if(nM(e,r)){const s=e[r];if(s==null)continue;i[t(r)]=ESe(s)}return i}function qI(e,t){const i=Math.trunc(Math.abs(e/60)),r=Math.trunc(Math.abs(e%60)),s=e>=0?"+":"-";switch(t){case"short":return`${s}${Po(i,2)}:${Po(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${Po(i,2)}${Po(r,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function WB(e){return iXe(e,["hour","minute","second","millisecond"])}const CSe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/,sXe=["January","February","March","April","May","June","July","August","September","October","November","December"],ASe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],nXe=["J","F","M","A","M","J","J","A","S","O","N","D"];function MSe(e){switch(e){case"narrow":return[...nXe];case"short":return[...ASe];case"long":return[...sXe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const OSe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],RSe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],oXe=["M","T","W","T","F","S","S"];function PSe(e){switch(e){case"narrow":return[...oXe];case"short":return[...RSe];case"long":return[...OSe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const ISe=["AM","PM"],aXe=["Before Christ","Anno Domini"],lXe=["BC","AD"],cXe=["B","A"];function $Se(e){switch(e){case"narrow":return[...cXe];case"short":return[...lXe];case"long":return[...aXe];default:return null}}function uXe(e){return ISe[e.hour<12?0:1]}function hXe(e,t){return PSe(t)[e.weekday-1]}function dXe(e,t){return MSe(t)[e.month-1]}function pXe(e,t){return $Se(t)[e.year<0?0:1]}function fXe(e,t,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(e)===-1;if(i==="auto"&&n){const p=e==="days";switch(t){case 1:return p?"tomorrow":`next ${s[e][0]}`;case-1:return p?"yesterday":`last ${s[e][0]}`;case 0:return p?"today":`this ${s[e][0]}`}}const o=Object.is(t,-0)||t<0,a=Math.abs(t),l=a===1,c=s[e],h=r?l?c[1]:c[2]||c[1]:l?s[e][0]:e;return o?`${a} ${h} ago`:`in ${a} ${h}`}function Ale(e,t){let i="";for(const r of e)r.literal?i+=r.val:i+=t(r.val);return i}const mXe={D:HZ,DD:sSe,DDD:nSe,DDDD:oSe,t:aSe,tt:lSe,ttt:cSe,tttt:uSe,T:hSe,TT:dSe,TTT:pSe,TTTT:fSe,f:mSe,ff:ySe,fff:_Se,ffff:wSe,F:gSe,FF:vSe,FFF:bSe,FFFF:xSe};class $u{static create(t,i={}){return new $u(t,i)}static parseFormat(t){let i=null,r="",s=!1;const n=[];for(let o=0;o<t.length;o++){const a=t.charAt(o);a==="'"?(r.length>0&&n.push({literal:s,val:r}),i=null,r="",s=!s):s||a===i?r+=a:(r.length>0&&n.push({literal:!1,val:r}),r=a,i=a)}return r.length>0&&n.push({literal:s,val:r}),n}static macroTokenToFormatOpts(t){return mXe[t]}constructor(t,i){this.opts=i,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(t,F(F({},this.opts),i)).format()}formatDateTime(t,i={}){return this.loc.dtFormatter(t,F(F({},this.opts),i)).format()}formatDateTimeParts(t,i={}){return this.loc.dtFormatter(t,F(F({},this.opts),i)).formatToParts()}resolvedOptions(t,i={}){return this.loc.dtFormatter(t,F(F({},this.opts),i)).resolvedOptions()}num(t,i=0){if(this.opts.forceSimple)return Po(t,i);const r=F({},this.opts);return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(t)}formatDateTimeFromString(t,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,g)=>this.loc.extract(t,m,g),o=m=>t.isOffsetFixed&&t.offset===0&&m.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,m.format):"",a=()=>r?uXe(t):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,g)=>r?dXe(t,m):n(g?{month:m}:{month:m,day:"numeric"},"month"),c=(m,g)=>r?hXe(t,m):n(g?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const g=$u.macroTokenToFormatOpts(m);return g?this.formatWithSystemDefault(t,g):m},p=m=>r?pXe(t,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12===0?12:t.hour%12);case"hh":return this.num(t.hour%12===0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(t.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(t.day,2);case"c":return this.num(t.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(t.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(t.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(t.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(t.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return h(m)}};return Ale($u.parseFormat(i),f)}formatDurationFromString(t,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=r(c);return h?this.num(l.get(h),c.length):c},n=$u.parseFormat(i),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=t.shiftTo(...o.map(r).filter(l=>l));return Ale(n,s(a))}}class Uf{constructor(t,i){this.reason=t,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}class TL{get type(){throw new s_}get name(){throw new s_}get ianaName(){return this.name}get isUniversal(){throw new s_}offsetName(t,i){throw new s_}formatOffset(t,i){throw new s_}offset(t){throw new s_}equals(t){throw new s_}get isValid(){throw new s_}}let v9=null;class Yee extends TL{static get instance(){return v9===null&&(v9=new Yee),v9}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return SSe(t,i,r)}formatOffset(t,i){return qI(this.offset(t),i)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return t.type==="system"}get isValid(){return!0}}let x5={};function gXe(e){return x5[e]||(x5[e]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),x5[e]}const yXe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function vXe(e,t){const i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,o,a,l,c,h]=r;return[o,s,n,a,l,c,h]}function _Xe(e,t){const i=e.formatToParts(t),r=[];for(let s=0;s<i.length;s++){const{type:n,value:o}=i[s],a=yXe[n];n==="era"?r[a]=o:vr(a)||(r[a]=parseInt(o,10))}return r}let tN={};class _v extends TL{static create(t){return tN[t]||(tN[t]=new _v(t)),tN[t]}static resetCache(){tN={},x5={}}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch{return!1}}constructor(t){super();this.zoneName=t,this.valid=_v.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return SSe(t,i,r,this.name)}formatOffset(t,i){return qI(this.offset(t),i)}offset(t){const i=new Date(t);if(isNaN(i))return NaN;const r=gXe(this.name);let[s,n,o,a,l,c,h]=r.formatToParts?_Xe(r,i):vXe(r,i);a==="BC"&&(s=-Math.abs(s)+1);const f=Xee({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+i;const g=m%1e3;return m-=g>=0?g:1e3+g,(f-m)/(60*1e3)}equals(t){return t.type==="iana"&&t.name===this.name}get isValid(){return this.valid}}let _9=null;class $c extends TL{static get utcInstance(){return _9===null&&(_9=new $c(0)),_9}static instance(t){return t===0?$c.utcInstance:new $c(t)}static parseSpecifier(t){if(t){const i=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new $c(qB(i[1],i[2]))}return null}constructor(t){super();this.fixed=t}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${qI(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${qI(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,i){return qI(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return t.type==="fixed"&&t.fixed===this.fixed}get isValid(){return!0}}class bXe extends TL{constructor(t){super();this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function N1(e,t){if(vr(e)||e===null)return t;if(e instanceof TL)return e;if(KZe(e)){const i=e.toLowerCase();return i==="local"||i==="system"?t:i==="utc"||i==="gmt"?$c.utcInstance:$c.parseSpecifier(i)||_v.create(e)}else return JT(e)?$c.instance(e):typeof e=="object"&&e.offset&&typeof e.offset=="number"?e:new bXe(e)}let Mle=()=>Date.now(),Ole="system",Rle=null,Ple=null,Ile=null,$le;class ca{static get now(){return Mle}static set now(t){Mle=t}static set defaultZone(t){Ole=t}static get defaultZone(){return N1(Ole,Yee.instance)}static get defaultLocale(){return Rle}static set defaultLocale(t){Rle=t}static get defaultNumberingSystem(){return Ple}static set defaultNumberingSystem(t){Ple=t}static get defaultOutputCalendar(){return Ile}static set defaultOutputCalendar(t){Ile=t}static get throwOnInvalid(){return $le}static set throwOnInvalid(t){$le=t}static resetCaches(){Cn.resetCache(),_v.resetCache()}}let Lle={};function wXe(e,t={}){const i=JSON.stringify([e,t]);let r=Lle[i];return r||(r=new Intl.ListFormat(e,t),Lle[i]=r),r}let WZ={};function ZZ(e,t={}){const i=JSON.stringify([e,t]);let r=WZ[i];return r||(r=new Intl.DateTimeFormat(e,t),WZ[i]=r),r}let XZ={};function xXe(e,t={}){const i=JSON.stringify([e,t]);let r=XZ[i];return r||(r=new Intl.NumberFormat(e,t),XZ[i]=r),r}let YZ={};function TXe(e,t={}){const o=t,{base:i}=o,r=xD(o,["base"]),s=JSON.stringify([e,r]);let n=YZ[s];return n||(n=new Intl.RelativeTimeFormat(e,t),YZ[s]=n),n}let zP=null;function SXe(){return zP||(zP=new Intl.DateTimeFormat().resolvedOptions().locale,zP)}function EXe(e){const t=e.indexOf("-u-");if(t===-1)return[e];{let i;const r=e.substring(0,t);try{i=ZZ(e).resolvedOptions()}catch{i=ZZ(r).resolvedOptions()}const{numberingSystem:s,calendar:n}=i;return[r,s,n]}}function CXe(e,t,i){return(i||t)&&(e+="-u",i&&(e+=`-ca-${i}`),t&&(e+=`-nu-${t}`)),e}function AXe(e){const t=[];for(let i=1;i<=12;i++){const r=ei.utc(2016,i,1);t.push(e(r))}return t}function MXe(e){const t=[];for(let i=1;i<=7;i++){const r=ei.utc(2016,11,13+i);t.push(e(r))}return t}function iN(e,t,i,r,s){const n=e.listingMode(i);return n==="error"?null:n==="en"?r(t):s(t)}function OXe(e){return e.numberingSystem&&e.numberingSystem!=="latn"?!1:e.numberingSystem==="latn"||!e.locale||e.locale.startsWith("en")||new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem==="latn"}class RXe{constructor(t,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const a=r,{padTo:s,floor:n}=a,o=xD(a,["padTo","floor"]);if(!i||Object.keys(o).length>0){const l=F({useGrouping:!1},r);r.padTo>0&&(l.minimumIntegerDigits=r.padTo),this.inf=xXe(t,l)}}format(t){if(this.inf){const i=this.floor?Math.floor(t):t;return this.inf.format(i)}else{const i=this.floor?Math.floor(t):Zee(t,3);return Po(i,this.padTo)}}}class PXe{constructor(t,i,r){this.opts=r;let s;if(t.zone.isUniversal){const o=-1*(t.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;t.offset!==0&&_v.create(a).valid?(s=a,this.dt=t):(s="UTC",r.timeZoneName?this.dt=t:this.dt=t.offset===0?t:ei.fromMillis(t.ts+t.offset*60*1e3))}else t.zone.type==="system"?this.dt=t:(this.dt=t,s=t.zone.name);const n=F({},this.opts);s&&(n.timeZone=s),this.dtf=ZZ(i,n)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class IXe{constructor(t,i,r){this.opts=F({style:"long"},r),!i&&TSe()&&(this.rtf=TXe(t,r))}format(t,i){return this.rtf?this.rtf.format(t,i):fXe(i,t,this.opts.numeric,this.opts.style!=="long")}formatToParts(t,i){return this.rtf?this.rtf.formatToParts(t,i):[]}}class Cn{static fromOpts(t){return Cn.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,i,r,s=!1){const n=t||ca.defaultLocale,o=n||(s?"en-US":SXe()),a=i||ca.defaultNumberingSystem,l=r||ca.defaultOutputCalendar;return new Cn(o,a,l,n)}static resetCache(){zP=null,WZ={},XZ={},YZ={}}static fromObject({locale:t,numberingSystem:i,outputCalendar:r}={}){return Cn.create(t,i,r)}constructor(t,i,r,s){const[n,o,a]=EXe(t);this.locale=n,this.numberingSystem=i||o||null,this.outputCalendar=r||a||null,this.intl=CXe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=OXe(this)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return t&&i?"en":"intl"}clone(t){return!t||Object.getOwnPropertyNames(t).length===0?this:Cn.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1)}redefaultToEN(t={}){return this.clone(me(F({},t),{defaultToEN:!0}))}redefaultToSystem(t={}){return this.clone(me(F({},t),{defaultToEN:!1}))}months(t,i=!1,r=!0){return iN(this,t,r,MSe,()=>{const s=i?{month:t,day:"numeric"}:{month:t},n=i?"format":"standalone";return this.monthsCache[n][t]||(this.monthsCache[n][t]=AXe(o=>this.extract(o,s,"month"))),this.monthsCache[n][t]})}weekdays(t,i=!1,r=!0){return iN(this,t,r,PSe,()=>{const s=i?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},n=i?"format":"standalone";return this.weekdaysCache[n][t]||(this.weekdaysCache[n][t]=MXe(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][t]})}meridiems(t=!0){return iN(this,void 0,t,()=>ISe,()=>{if(!this.meridiemCache){const i={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[ei.utc(2016,11,13,9),ei.utc(2016,11,13,19)].map(r=>this.extract(r,i,"dayperiod"))}return this.meridiemCache})}eras(t,i=!0){return iN(this,t,i,$Se,()=>{const r={era:t};return this.eraCache[t]||(this.eraCache[t]=[ei.utc(-40,1,1),ei.utc(2017,1,1)].map(s=>this.extract(s,r,"era"))),this.eraCache[t]})}extract(t,i,r){const s=this.dtFormatter(t,i),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(t={}){return new RXe(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,i={}){return new PXe(t,this.intl,i)}relFormatter(t={}){return new IXe(this.intl,this.isEnglish(),t)}listFormatter(t={}){return wXe(this.intl,t)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}function pO(...e){const t=e.reduce((i,r)=>i+r.source,"");return RegExp(`^${t}$`)}function fO(...e){return t=>e.reduce(([i,r,s],n)=>{const[o,a,l]=n(t,s);return[F(F({},i),o),a||r,l]},[{},null,1]).slice(0,2)}function mO(e,...t){if(e==null)return[null,null];for(const[i,r]of t){const s=i.exec(e);if(s)return r(s)}return[null,null]}function LSe(...e){return(t,i)=>{const r={};let s;for(s=0;s<e.length;s++)r[e[s]]=C1(t[i+s]);return[r,null,i+s]}}const DSe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,$Xe=`(?:${DSe.source}?(?:\\[(${CSe.source})\\])?)?`,Jee=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,NSe=RegExp(`${Jee.source}${$Xe}`),Qee=RegExp(`(?:T${NSe.source})?`),LXe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,DXe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,NXe=/(\d{4})-?(\d{3})/,FXe=LSe("weekYear","weekNumber","weekDay"),kXe=LSe("year","ordinal"),UXe=/(\d{4})-(\d\d)-(\d\d)/,FSe=RegExp(`${Jee.source} ?(?:${DSe.source}|(${CSe.source}))?`),zXe=RegExp(`(?: ${FSe.source})?`);function mA(e,t,i){const r=e[t];return vr(r)?i:C1(r)}function VXe(e,t){return[{year:mA(e,t),month:mA(e,t+1,1),day:mA(e,t+2,1)},null,t+3]}function gO(e,t){return[{hours:mA(e,t,0),minutes:mA(e,t+1,0),seconds:mA(e,t+2,0),milliseconds:Wee(e[t+3])},null,t+4]}function SL(e,t){const i=!e[t]&&!e[t+1],r=qB(e[t+1],e[t+2]),s=i?null:$c.instance(r);return[{},s,t+3]}function EL(e,t){const i=e[t]?_v.create(e[t]):null;return[{},i,t+1]}const BXe=RegExp(`^T?${Jee.source}$`),GXe=/^-?P(?:(?:(-?\d{1,9}(?:\.\d{1,9})?)Y)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,9}(?:\.\d{1,9})?)W)?(?:(-?\d{1,9}(?:\.\d{1,9})?)D)?(?:T(?:(-?\d{1,9}(?:\.\d{1,9})?)H)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/;function jXe(e){const[t,i,r,s,n,o,a,l,c]=e,h=t[0]==="-",p=l&&l[0]==="-",f=(m,g=!1)=>m!==void 0&&(g||m&&h)?-m:m;return[{years:f(lw(i)),months:f(lw(r)),weeks:f(lw(s)),days:f(lw(n)),hours:f(lw(o)),minutes:f(lw(a)),seconds:f(lw(l),l==="-0"),milliseconds:f(Wee(c),p)}]}const HXe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Kee(e,t,i,r,s,n,o){const a={year:t.length===2?qZ(C1(t)):C1(t),month:ASe.indexOf(i)+1,day:C1(r),hour:C1(s),minute:C1(n)};return o&&(a.second=C1(o)),e&&(a.weekday=e.length>3?OSe.indexOf(e)+1:RSe.indexOf(e)+1),a}const qXe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function WXe(e){const[,t,i,r,s,n,o,a,l,c,h,p]=e,f=Kee(t,s,r,i,n,o,a);let m;return l?m=HXe[l]:c?m=0:m=qB(h,p),[f,new $c(m)]}function ZXe(e){return e.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const XXe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,YXe=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,JXe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Dle(e){const[,t,i,r,s,n,o,a]=e;return[Kee(t,s,r,i,n,o,a),$c.utcInstance]}function QXe(e){const[,t,i,r,s,n,o,a]=e;return[Kee(t,a,i,r,s,n,o),$c.utcInstance]}const KXe=pO(LXe,Qee),eYe=pO(DXe,Qee),tYe=pO(NXe,Qee),iYe=pO(NSe),kSe=fO(VXe,gO,SL,EL),rYe=fO(FXe,gO,SL,EL),sYe=fO(kXe,gO,SL,EL),nYe=fO(gO,SL,EL);function oYe(e){return mO(e,[KXe,kSe],[eYe,rYe],[tYe,sYe],[iYe,nYe])}function aYe(e){return mO(ZXe(e),[qXe,WXe])}function lYe(e){return mO(e,[XXe,Dle],[YXe,Dle],[JXe,QXe])}function cYe(e){return mO(e,[GXe,jXe])}const uYe=fO(gO);function hYe(e){return mO(e,[BXe,uYe])}const dYe=pO(UXe,zXe),pYe=pO(FSe),fYe=fO(gO,SL,EL);function mYe(e){return mO(e,[dYe,kSe],[pYe,fYe])}const gYe="Invalid Duration",USe={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},yYe=F({years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3}},USe),fd=146097/400,R2=146097/4800,vYe=F({years:{quarters:4,months:12,weeks:fd/7,days:fd,hours:fd*24,minutes:fd*24*60,seconds:fd*24*60*60,milliseconds:fd*24*60*60*1e3},quarters:{months:3,weeks:fd/28,days:fd/4,hours:fd*24/4,minutes:fd*24*60/4,seconds:fd*24*60*60/4,milliseconds:fd*24*60*60*1e3/4},months:{weeks:R2/7,days:R2,hours:R2*24,minutes:R2*24*60,seconds:R2*24*60*60,milliseconds:R2*24*60*60*1e3}},USe),px=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],_Ye=px.slice(0).reverse();function cw(e,t,i=!1){const r={values:i?t.values:F(F({},e.values),t.values||{}),loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy};return new Ar(r)}function bYe(e){return e<0?Math.floor(e):Math.ceil(e)}function zSe(e,t,i,r,s){const n=e[s][i],o=t[i]/n,a=Math.sign(o)===Math.sign(r[s]),l=!a&&r[s]!==0&&Math.abs(o)<=1?bYe(o):Math.trunc(o);r[s]+=l,t[i]-=l*n}function wYe(e,t){_Ye.reduce((i,r)=>vr(t[r])?i:(i&&zSe(e,t,i,t,r),r),null)}class Ar{constructor(t){const i=t.conversionAccuracy==="longterm"||!1;this.values=t.values,this.loc=t.loc||Cn.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=i?vYe:yYe,this.isLuxonDuration=!0}static fromMillis(t,i){return Ar.fromObject({milliseconds:t},i)}static fromObject(t,i={}){if(t==null||typeof t!="object")throw new ip(`Duration.fromObject: argument expected to be an object, got ${t===null?"null":typeof t}`);return new Ar({values:oz(t,Ar.normalizeUnit),loc:Cn.fromObject(i),conversionAccuracy:i.conversionAccuracy})}static fromDurationLike(t){if(JT(t))return Ar.fromMillis(t);if(Ar.isDuration(t))return t;if(typeof t=="object")return Ar.fromObject(t);throw new ip(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,i){const[r]=cYe(t);return r?Ar.fromObject(r,i):Ar.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,i){const[r]=hYe(t);return r?Ar.fromObject(r,i):Ar.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,i=null){if(!t)throw new ip("need to specify a reason the Duration is invalid");const r=t instanceof Uf?t:new Uf(t,i);if(ca.throwOnInvalid)throw new YZe(r);return new Ar({invalid:r})}static normalizeUnit(t){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t&&t.toLowerCase()];if(!i)throw new rSe(t);return i}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,i={}){const r=me(F({},i),{floor:i.round!==!1&&i.floor!==!1});return this.isValid?$u.create(this.loc,r).formatDurationFromString(this,t):gYe}toHuman(t={}){const i=px.map(r=>{const s=this.values[r];return vr(s)?null:this.loc.numberFormatter(me(F({style:"unit",unitDisplay:"long"},t),{unit:r.slice(0,-1)})).format(s)}).filter(r=>r);return this.loc.listFormatter(F({type:"conjunction",style:t.listStyle||"narrow"},t)).format(i)}toObject(){return this.isValid?F({},this.values):{}}toISO(){if(!this.isValid)return null;let t="P";return this.years!==0&&(t+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(t+=this.months+this.quarters*3+"M"),this.weeks!==0&&(t+=this.weeks+"W"),this.days!==0&&(t+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(t+="T"),this.hours!==0&&(t+=this.hours+"H"),this.minutes!==0&&(t+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(t+=Zee(this.seconds+this.milliseconds/1e3,3)+"S"),t==="P"&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const i=this.toMillis();if(i<0||i>=864e5)return null;t=F({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},t);const r=this.shiftTo("hours","minutes","seconds","milliseconds");let s=t.format==="basic"?"hhmm":"hh:mm";(!t.suppressSeconds||r.seconds!==0||r.milliseconds!==0)&&(s+=t.format==="basic"?"ss":":ss",(!t.suppressMilliseconds||r.milliseconds!==0)&&(s+=".SSS"));let n=r.toFormat(s);return t.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const i=Ar.fromDurationLike(t),r={};for(const s of px)(nM(i.values,s)||nM(this.values,s))&&(r[s]=i.get(s)+this.get(s));return cw(this,{values:r},!0)}minus(t){if(!this.isValid)return this;const i=Ar.fromDurationLike(t);return this.plus(i.negate())}mapUnits(t){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=ESe(t(this.values[r],r));return cw(this,{values:i},!0)}get(t){return this[Ar.normalizeUnit(t)]}set(t){if(!this.isValid)return this;const i=F(F({},this.values),oz(t,Ar.normalizeUnit));return cw(this,{values:i})}reconfigure({locale:t,numberingSystem:i,conversionAccuracy:r}={}){const s=this.loc.clone({locale:t,numberingSystem:i}),n={loc:s};return r&&(n.conversionAccuracy=r),cw(this,n)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return wYe(this.matrix,t),cw(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(t.length===0)return this;t=t.map(o=>Ar.normalizeUnit(o));const i={},r={},s=this.toObject();let n;for(const o of px)if(t.indexOf(o)>=0){n=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;JT(s[o])&&(a+=s[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3;for(const c in s)px.indexOf(c)>px.indexOf(o)&&zSe(this.matrix,s,c,i,o)}else JT(s[o])&&(r[o]=s[o]);for(const o in r)r[o]!==0&&(i[n]+=o===n?r[o]:r[o]/this.matrix[n][o]);return cw(this,{values:i},!0).normalize()}negate(){if(!this.isValid)return this;const t={};for(const i of Object.keys(this.values))t[i]=this.values[i]===0?0:-this.values[i];return cw(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid||!this.loc.equals(t.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of px)if(!i(this.values[r],t.values[r]))return!1;return!0}}const tR="Invalid Interval";function xYe(e,t){return!e||!e.isValid?Tn.invalid("missing or invalid start"):!t||!t.isValid?Tn.invalid("missing or invalid end"):t<e?Tn.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null}class Tn{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,i=null){if(!t)throw new ip("need to specify a reason the Interval is invalid");const r=t instanceof Uf?t:new Uf(t,i);if(ca.throwOnInvalid)throw new XZe(r);return new Tn({invalid:r})}static fromDateTimes(t,i){const r=sR(t),s=sR(i),n=xYe(r,s);return n==null?new Tn({start:r,end:s}):n}static after(t,i){const r=Ar.fromDurationLike(i),s=sR(t);return Tn.fromDateTimes(s,s.plus(r))}static before(t,i){const r=Ar.fromDurationLike(i),s=sR(t);return Tn.fromDateTimes(s.minus(r),s)}static fromISO(t,i){const[r,s]=(t||"").split("/",2);if(r&&s){let n,o;try{n=ei.fromISO(r,i),o=n.isValid}catch{o=!1}let a,l;try{a=ei.fromISO(s,i),l=a.isValid}catch{l=!1}if(o&&l)return Tn.fromDateTimes(n,a);if(o){const c=Ar.fromISO(s,i);if(c.isValid)return Tn.after(n,c)}else if(l){const c=Ar.fromISO(r,i);if(c.isValid)return Tn.before(a,c)}}return Tn.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds"){if(!this.isValid)return NaN;const i=this.start.startOf(t),r=this.end.startOf(t);return Math.floor(r.diff(i,t).get(t))+1}hasSame(t){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,t):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return this.isValid?this.s>t:!1}isBefore(t){return this.isValid?this.e<=t:!1}contains(t){return this.isValid?this.s<=t&&this.e>t:!1}set({start:t,end:i}={}){return this.isValid?Tn.fromDateTimes(t||this.s,i||this.e):this}splitAt(...t){if(!this.isValid)return[];const i=t.map(sR).filter(o=>this.contains(o)).sort(),r=[];let{s}=this,n=0;for(;s<this.e;){const o=i[n]||this.e,a=+o>+this.e?this.e:o;r.push(Tn.fromDateTimes(s,a)),s=a,n+=1}return r}splitBy(t){const i=Ar.fromDurationLike(t);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(Tn.fromDateTimes(r,n)),r=n,s+=1}return o}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return this.isValid?+this.e==+t.s:!1}abutsEnd(t){return this.isValid?+t.e==+this.s:!1}engulfs(t){return this.isValid?this.s<=t.s&&this.e>=t.e:!1}equals(t){return!this.isValid||!t.isValid?!1:this.s.equals(t.s)&&this.e.equals(t.e)}intersection(t){if(!this.isValid)return this;const i=this.s>t.s?this.s:t.s,r=this.e<t.e?this.e:t.e;return i>=r?null:Tn.fromDateTimes(i,r)}union(t){if(!this.isValid)return this;const i=this.s<t.s?this.s:t.s,r=this.e>t.e?this.e:t.e;return Tn.fromDateTimes(i,r)}static merge(t){const[i,r]=t.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return r&&i.push(r),i}static xor(t){let i=null,r=0;const s=[],n=t.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push(Tn.fromDateTimes(i,l.time)),i=null);return Tn.merge(s)}difference(...t){return Tn.xor([this].concat(t)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:tR}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:tR}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:tR}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:tR}toFormat(t,{separator:i=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(t)}${i}${this.e.toFormat(t)}`:tR}toDuration(t,i){return this.isValid?this.e.diff(this.s,t,i):Ar.invalid(this.invalidReason)}mapEndpoints(t){return Tn.fromDateTimes(t(this.s),t(this.e))}}class VP{static hasDST(t=ca.defaultZone){const i=ei.now().setZone(t).set({month:12});return!t.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(t){return _v.isValidZone(t)}static normalizeZone(t){return N1(t,ca.defaultZone)}static months(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Cn.create(i,r,n)).months(t)}static monthsFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Cn.create(i,r,n)).months(t,!0)}static weekdays(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Cn.create(i,r,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Cn.create(i,r,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return Cn.create(t).meridiems()}static eras(t="short",{locale:i=null}={}){return Cn.create(i,null,"gregory").eras(t)}static features(){return{relative:TSe()}}}function Nle(e,t){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(t)-i(e);return Math.floor(Ar.fromMillis(r).as("days"))}function TYe(e,t,i){const r=[["years",(a,l)=>l.year-a.year],["quarters",(a,l)=>l.quarter-a.quarter],["months",(a,l)=>l.month-a.month+(l.year-a.year)*12],["weeks",(a,l)=>{const c=Nle(a,l);return(c-c%7)/7}],["days",Nle]],s={};let n,o;for(const[a,l]of r)if(i.indexOf(a)>=0){n=a;let c=l(e,t);o=e.plus({[a]:c}),o>t?(e=e.plus({[a]:c-1}),c-=1):e=o,s[a]=c}return[e,s,o,n]}function SYe(e,t,i,r){let[s,n,o,a]=TYe(e,t,i);const l=t-s,c=i.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<t&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=Ar.fromObject(n,r);return c.length>0?Ar.fromMillis(l,r).shiftTo(...c).plus(h):h}const ete={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},Fle={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},EYe=ete.hanidec.replace(/[\[|\]]/g,"").split("");function CYe(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i);if(e[i].search(ete.hanidec)!==-1)t+=EYe.indexOf(e[i]);else for(const s in Fle){const[n,o]=Fle[s];r>=n&&r<=o&&(t+=r-n)}}return parseInt(t,10)}else return t}function kp({numberingSystem:e},t=""){return new RegExp(`${ete[e||"latn"]}${t}`)}const AYe="missing Intl.DateTimeFormat.formatToParts support";function zr(e,t=i=>i){return{regex:e,deser:([i])=>t(CYe(i))}}const MYe=String.fromCharCode(160),VSe=`[ ${MYe}]`,BSe=new RegExp(VSe,"g");function OYe(e){return e.replace(/\./g,"\\.?").replace(BSe,VSe)}function kle(e){return e.replace(/\./g,"").replace(BSe," ").toLowerCase()}function Up(e,t){return e===null?null:{regex:RegExp(e.map(OYe).join("|")),deser:([i])=>e.findIndex(r=>kle(i)===kle(r))+t}}function Ule(e,t){return{regex:e,deser:([,i,r])=>qB(i,r),groups:t}}function b9(e){return{regex:e,deser:([t])=>t}}function RYe(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function PYe(e,t){const i=kp(t),r=kp(t,"{2}"),s=kp(t,"{3}"),n=kp(t,"{4}"),o=kp(t,"{6}"),a=kp(t,"{1,2}"),l=kp(t,"{1,3}"),c=kp(t,"{1,6}"),h=kp(t,"{1,9}"),p=kp(t,"{2,4}"),f=kp(t,"{4,6}"),m=x=>({regex:RegExp(RYe(x.val)),deser:([b])=>b,literal:!0}),y=(x=>{if(e.literal)return m(x);switch(x.val){case"G":return Up(t.eras("short",!1),0);case"GG":return Up(t.eras("long",!1),0);case"y":return zr(c);case"yy":return zr(p,qZ);case"yyyy":return zr(n);case"yyyyy":return zr(f);case"yyyyyy":return zr(o);case"M":return zr(a);case"MM":return zr(r);case"MMM":return Up(t.months("short",!0,!1),1);case"MMMM":return Up(t.months("long",!0,!1),1);case"L":return zr(a);case"LL":return zr(r);case"LLL":return Up(t.months("short",!1,!1),1);case"LLLL":return Up(t.months("long",!1,!1),1);case"d":return zr(a);case"dd":return zr(r);case"o":return zr(l);case"ooo":return zr(s);case"HH":return zr(r);case"H":return zr(a);case"hh":return zr(r);case"h":return zr(a);case"mm":return zr(r);case"m":return zr(a);case"q":return zr(a);case"qq":return zr(r);case"s":return zr(a);case"ss":return zr(r);case"S":return zr(l);case"SSS":return zr(s);case"u":return b9(h);case"uu":return b9(a);case"uuu":return zr(i);case"a":return Up(t.meridiems(),0);case"kkkk":return zr(n);case"kk":return zr(p,qZ);case"W":return zr(a);case"WW":return zr(r);case"E":case"c":return zr(i);case"EEE":return Up(t.weekdays("short",!1,!1),1);case"EEEE":return Up(t.weekdays("long",!1,!1),1);case"ccc":return Up(t.weekdays("short",!0,!1),1);case"cccc":return Up(t.weekdays("long",!0,!1),1);case"Z":case"ZZ":return Ule(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return Ule(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return b9(/[a-z_+-/]{1,256}?/i);default:return m(x)}})(e)||{invalidReason:AYe};return y.token=e,y}const IYe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};function $Ye(e,t,i){const{type:r,value:s}=e;if(r==="literal")return{literal:!0,val:s};const n=i[r];let o=IYe[r];if(typeof o=="object"&&(o=o[n]),o)return{literal:!1,val:o}}function LYe(e){return[`^${e.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,e]}function DYe(e,t,i){const r=e.match(t);if(r){const s={};let n=1;for(const o in i)if(nM(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function NYe(e){const t=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return vr(e.z)||(i=_v.create(e.z)),vr(e.Z)||(i||(i=new $c(e.Z)),r=e.Z),vr(e.q)||(e.M=(e.q-1)*3+1),vr(e.h)||(e.h<12&&e.a===1?e.h+=12:e.h===12&&e.a===0&&(e.h=0)),e.G===0&&e.y&&(e.y=-e.y),vr(e.u)||(e.S=Wee(e.u)),[Object.keys(e).reduce((n,o)=>{const a=t(o);return a&&(n[a]=e[o]),n},{}),i,r]}let w9=null;function FYe(){return w9||(w9=ei.fromMillis(1555555555555)),w9}function kYe(e,t){if(e.literal)return e;const i=$u.macroTokenToFormatOpts(e.val);if(!i)return e;const n=$u.create(t,i).formatDateTimeParts(FYe()).map(o=>$Ye(o,t,i));return n.includes(void 0)?e:n}function UYe(e,t){return Array.prototype.concat(...e.map(i=>kYe(i,t)))}function GSe(e,t,i){const r=UYe($u.parseFormat(i),e),s=r.map(o=>PYe(o,e)),n=s.find(o=>o.invalidReason);if(n)return{input:t,tokens:r,invalidReason:n.invalidReason};{const[o,a]=LYe(s),l=RegExp(o,"i"),[c,h]=DYe(t,l,a),[p,f,m]=h?NYe(h):[null,null,void 0];if(nM(h,"a")&&nM(h,"H"))throw new UP("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:r,regex:l,rawMatches:c,matches:h,result:p,zone:f,specificOffset:m}}}function zYe(e,t,i){const{result:r,zone:s,specificOffset:n,invalidReason:o}=GSe(e,t,i);return[r,s,n,o]}const jSe=[0,31,59,90,120,151,181,212,243,273,304,334],HSe=[0,31,60,91,121,152,182,213,244,274,305,335];function dp(e,t){return new Uf("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function qSe(e,t,i){const r=new Date(Date.UTC(e,t-1,i));e<100&&e>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function WSe(e,t,i){return i+(xL(e)?HSe:jSe)[t-1]}function ZSe(e,t){const i=xL(e)?HSe:jSe,r=i.findIndex(n=>n<t),s=t-i[r];return{month:r+1,day:s}}function JZ(e){const{year:t,month:i,day:r}=e,s=WSe(t,i,r),n=qSe(t,i,r);let o=Math.floor((s-n+10)/7),a;return o<1?(a=t-1,o=nz(a)):o>nz(t)?(a=t+1,o=1):a=t,F({weekYear:a,weekNumber:o,weekday:n},WB(e))}function zle(e){const{weekYear:t,weekNumber:i,weekday:r}=e,s=qSe(t,1,4),n=HI(t);let o=i*7+r-s-3,a;o<1?(a=t-1,o+=HI(a)):o>n?(a=t+1,o-=HI(t)):a=t;const{month:l,day:c}=ZSe(a,o);return F({year:a,month:l,day:c},WB(e))}function x9(e){const{year:t,month:i,day:r}=e,s=WSe(t,i,r);return F({year:t,ordinal:s},WB(e))}function Vle(e){const{year:t,ordinal:i}=e,{month:r,day:s}=ZSe(t,i);return F({year:t,month:r,day:s},WB(e))}function VYe(e){const t=HB(e.weekYear),i=V0(e.weekNumber,1,nz(e.weekYear)),r=V0(e.weekday,1,7);return t?i?r?!1:dp("weekday",e.weekday):dp("week",e.week):dp("weekYear",e.weekYear)}function BYe(e){const t=HB(e.year),i=V0(e.ordinal,1,HI(e.year));return t?i?!1:dp("ordinal",e.ordinal):dp("year",e.year)}function XSe(e){const t=HB(e.year),i=V0(e.month,1,12),r=V0(e.day,1,sz(e.year,e.month));return t?i?r?!1:dp("day",e.day):dp("month",e.month):dp("year",e.year)}function YSe(e){const{hour:t,minute:i,second:r,millisecond:s}=e,n=V0(t,0,23)||t===24&&i===0&&r===0&&s===0,o=V0(i,0,59),a=V0(r,0,59),l=V0(s,0,999);return n?o?a?l?!1:dp("millisecond",s):dp("second",r):dp("minute",i):dp("hour",t)}const T9="Invalid DateTime",Ble=864e13;function rN(e){return new Uf("unsupported zone",`the zone "${e.name}" is not supported`)}function S9(e){return e.weekData===null&&(e.weekData=JZ(e.c)),e.weekData}function iR(e,t){const i={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new ei(me(F(F({},i),t),{old:i}))}function JSe(e,t,i){let r=e-t*60*1e3;const s=i.offset(r);if(t===s)return[r,t];r-=(s-t)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[e-Math.min(s,n)*60*1e3,Math.max(s,n)]}function Gle(e,t){e+=t*60*1e3;const i=new Date(e);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function T5(e,t,i){return JSe(Xee(e),t,i)}function jle(e,t){const i=e.o,r=e.c.year+Math.trunc(t.years),s=e.c.month+Math.trunc(t.months)+Math.trunc(t.quarters)*3,n=me(F({},e.c),{year:r,month:s,day:Math.min(e.c.day,sz(r,s))+Math.trunc(t.days)+Math.trunc(t.weeks)*7}),o=Ar.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=Xee(n);let[l,c]=JSe(a,i,e.zone);return o!==0&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function rR(e,t,i,r,s,n){const{setZone:o,zone:a}=i;if(e&&Object.keys(e).length!==0){const l=t||a,c=ei.fromObject(e,me(F({},i),{zone:l,specificOffset:n}));return o?c:c.setZone(a)}else return ei.invalid(new Uf("unparsable",`the input "${s}" can't be parsed as ${r}`))}function sN(e,t,i=!0){return e.isValid?$u.create(Cn.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(e,t):null}function E9(e,t){const i=e.c.year>9999||e.c.year<0;let r="";return i&&e.c.year>=0&&(r+="+"),r+=Po(e.c.year,i?6:4),t?(r+="-",r+=Po(e.c.month),r+="-",r+=Po(e.c.day)):(r+=Po(e.c.month),r+=Po(e.c.day)),r}function Hle(e,t,i,r,s,n){let o=Po(e.c.hour);return t?(o+=":",o+=Po(e.c.minute),(e.c.second!==0||!i)&&(o+=":")):o+=Po(e.c.minute),(e.c.second!==0||!i)&&(o+=Po(e.c.second),(e.c.millisecond!==0||!r)&&(o+=".",o+=Po(e.c.millisecond,3))),s&&(e.isOffsetFixed&&e.offset===0&&!n?o+="Z":e.o<0?(o+="-",o+=Po(Math.trunc(-e.o/60)),o+=":",o+=Po(Math.trunc(-e.o%60))):(o+="+",o+=Po(Math.trunc(e.o/60)),o+=":",o+=Po(Math.trunc(e.o%60)))),n&&(o+="["+e.zone.ianaName+"]"),o}const QSe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},GYe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},jYe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},KSe=["year","month","day","hour","minute","second","millisecond"],HYe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],qYe=["year","ordinal","hour","minute","second","millisecond"];function qle(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new rSe(e);return t}function Wle(e,t){const i=N1(t.zone,ca.defaultZone),r=Cn.fromObject(t),s=ca.now();let n,o;if(vr(e.year))n=s;else{for(const c of KSe)vr(e[c])&&(e[c]=QSe[c]);const a=XSe(e)||YSe(e);if(a)return ei.invalid(a);const l=i.offset(s);[n,o]=T5(e,l,i)}return new ei({ts:n,zone:i,loc:r,o})}function Zle(e,t,i){const r=vr(i.round)?!0:i.round,s=(o,a)=>(o=Zee(o,r||i.calendary?0:2,!0),t.loc.clone(i).relFormatter(i).format(o,a)),n=o=>i.calendary?t.hasSame(e,o)?0:t.startOf(o).diff(e.startOf(o),o).get(o):t.diff(e,o).get(o);if(i.unit)return s(n(i.unit),i.unit);for(const o of i.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(e>t?-0:0,i.units[i.units.length-1])}function Xle(e){let t={},i;return e.length>0&&typeof e[e.length-1]=="object"?(t=e[e.length-1],i=Array.from(e).slice(0,e.length-1)):i=Array.from(e),[t,i]}class ei{constructor(t){const i=t.zone||ca.defaultZone;let r=t.invalid||(Number.isNaN(t.ts)?new Uf("invalid input"):null)||(i.isValid?null:rN(i));this.ts=vr(t.ts)?ca.now():t.ts;let s=null,n=null;if(!r)if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(i))[s,n]=[t.old.c,t.old.o];else{const a=i.offset(this.ts);s=Gle(this.ts,a),r=Number.isNaN(s.year)?new Uf("invalid input"):null,s=r?null:s,n=r?null:a}this._zone=i,this.loc=t.loc||Cn.create(),this.invalid=r,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new ei({})}static local(){const[t,i]=Xle(arguments),[r,s,n,o,a,l,c]=i;return Wle({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static utc(){const[t,i]=Xle(arguments),[r,s,n,o,a,l,c]=i;return t.zone=$c.utcInstance,Wle({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static fromJSDate(t,i={}){const r=eXe(t)?t.valueOf():NaN;if(Number.isNaN(r))return ei.invalid("invalid input");const s=N1(i.zone,ca.defaultZone);return s.isValid?new ei({ts:r,zone:s,loc:Cn.fromObject(i)}):ei.invalid(rN(s))}static fromMillis(t,i={}){if(JT(t))return t<-Ble||t>Ble?ei.invalid("Timestamp out of range"):new ei({ts:t,zone:N1(i.zone,ca.defaultZone),loc:Cn.fromObject(i)});throw new ip(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,i={}){if(JT(t))return new ei({ts:t*1e3,zone:N1(i.zone,ca.defaultZone),loc:Cn.fromObject(i)});throw new ip("fromSeconds requires a numerical input")}static fromObject(t,i={}){t=t||{};const r=N1(i.zone,ca.defaultZone);if(!r.isValid)return ei.invalid(rN(r));const s=ca.now(),n=vr(i.specificOffset)?r.offset(s):i.specificOffset,o=oz(t,qle),a=!vr(o.ordinal),l=!vr(o.year),c=!vr(o.month)||!vr(o.day),h=l||c,p=o.weekYear||o.weekNumber,f=Cn.fromObject(i);if((h||a)&&p)throw new UP("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new UP("Can't mix ordinal dates with month/day");const m=p||o.weekday&&!h;let g,y,x=Gle(s,n);m?(g=HYe,y=GYe,x=JZ(x)):a?(g=qYe,y=jYe,x=x9(x)):(g=KSe,y=QSe);let b=!1;for(const U of g){const k=o[U];vr(k)?b?o[U]=y[U]:o[U]=x[U]:b=!0}const S=m?VYe(o):a?BYe(o):XSe(o),T=S||YSe(o);if(T)return ei.invalid(T);const C=m?zle(o):a?Vle(o):o,[A,O]=T5(C,n,r),D=new ei({ts:A,zone:r,o:O,loc:f});return o.weekday&&h&&t.weekday!==D.weekday?ei.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${D.toISO()}`):D}static fromISO(t,i={}){const[r,s]=oYe(t);return rR(r,s,i,"ISO 8601",t)}static fromRFC2822(t,i={}){const[r,s]=aYe(t);return rR(r,s,i,"RFC 2822",t)}static fromHTTP(t,i={}){const[r,s]=lYe(t);return rR(r,s,i,"HTTP",i)}static fromFormat(t,i,r={}){if(vr(t)||vr(i))throw new ip("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,o=Cn.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=zYe(o,t,i);return h?ei.invalid(h):rR(a,l,r,`format ${i}`,t,c)}static fromString(t,i,r={}){return ei.fromFormat(t,i,r)}static fromSQL(t,i={}){const[r,s]=mYe(t);return rR(r,s,i,"SQL",t)}static invalid(t,i=null){if(!t)throw new ip("need to specify a reason the DateTime is invalid");const r=t instanceof Uf?t:new Uf(t,i);if(ca.throwOnInvalid)throw new ZZe(r);return new ei({invalid:r})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}get(t){return this[t]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?S9(this).weekYear:NaN}get weekNumber(){return this.isValid?S9(this).weekNumber:NaN}get weekday(){return this.isValid?S9(this).weekday:NaN}get ordinal(){return this.isValid?x9(this.c).ordinal:NaN}get monthShort(){return this.isValid?VP.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?VP.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?VP.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?VP.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return xL(this.year)}get daysInMonth(){return sz(this.year,this.month)}get daysInYear(){return this.isValid?HI(this.year):NaN}get weeksInWeekYear(){return this.isValid?nz(this.weekYear):NaN}resolvedLocaleOptions(t={}){const{locale:i,numberingSystem:r,calendar:s}=$u.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(t=0,i={}){return this.setZone($c.instance(t),i)}toLocal(){return this.setZone(ca.defaultZone)}setZone(t,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(t=N1(t,ca.defaultZone),t.equals(this.zone))return this;if(t.isValid){let s=this.ts;if(i||r){const n=t.offset(this.ts),o=this.toObject();[s]=T5(o,n,t)}return iR(this,{ts:s,zone:t})}else return ei.invalid(rN(t))}reconfigure({locale:t,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:t,numberingSystem:i,outputCalendar:r});return iR(this,{loc:s})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const i=oz(t,qle),r=!vr(i.weekYear)||!vr(i.weekNumber)||!vr(i.weekday),s=!vr(i.ordinal),n=!vr(i.year),o=!vr(i.month)||!vr(i.day),a=n||o,l=i.weekYear||i.weekNumber;if((a||s)&&l)throw new UP("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new UP("Can't mix ordinal dates with month/day");let c;r?c=zle(F(F({},JZ(this.c)),i)):vr(i.ordinal)?(c=F(F({},this.toObject()),i),vr(i.day)&&(c.day=Math.min(sz(c.year,c.month),c.day))):c=Vle(F(F({},x9(this.c)),i));const[h,p]=T5(c,this.o,this.zone);return iR(this,{ts:h,o:p})}plus(t){if(!this.isValid)return this;const i=Ar.fromDurationLike(t);return iR(this,jle(this,i))}minus(t){if(!this.isValid)return this;const i=Ar.fromDurationLike(t).negate();return iR(this,jle(this,i))}startOf(t){if(!this.isValid)return this;const i={},r=Ar.normalizeUnit(t);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(r==="weeks"&&(i.weekday=1),r==="quarters"){const s=Math.ceil(this.month/3);i.month=(s-1)*3+1}return this.set(i)}endOf(t){return this.isValid?this.plus({[t]:1}).startOf(t).minus(1):this}toFormat(t,i={}){return this.isValid?$u.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,t):T9}toLocaleString(t=HZ,i={}){return this.isValid?$u.create(this.loc.clone(i),t).formatDateTime(this):T9}toLocaleParts(t={}){return this.isValid?$u.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=t==="extended";let a=E9(this,o);return a+="T",a+=Hle(this,o,i,r,s,n),a}toISODate({format:t="extended"}={}){return this.isValid?E9(this,t==="extended"):null}toISOWeekDate(){return sN(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+Hle(this,o==="extended",i,t,r,n):null}toRFC2822(){return sN(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return sN(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?E9(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||t)&&(r&&(s+=" "),i?s+="z":t&&(s+="ZZ")),sN(this,s,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():T9}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const i=F({},this.c);return t.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,i="milliseconds",r={}){if(!this.isValid||!t.isValid)return Ar.invalid("created by diffing an invalid DateTime");const s=F({locale:this.locale,numberingSystem:this.numberingSystem},r),n=tXe(i).map(Ar.normalizeUnit),o=t.valueOf()>this.valueOf(),a=o?this:t,l=o?t:this,c=SYe(a,l,n,s);return o?c.negate():c}diffNow(t="milliseconds",i={}){return this.diff(ei.now(),t,i)}until(t){return this.isValid?Tn.fromDateTimes(this,t):this}hasSame(t,i){if(!this.isValid)return!1;const r=t.valueOf(),s=this.setZone(t.zone,{keepLocalTime:!0});return s.startOf(i)<=r&&r<=s.endOf(i)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const i=t.base||ei.fromObject({},{zone:this.zone}),r=t.padding?this<i?-t.padding:t.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=t.unit;return Array.isArray(t.unit)&&(s=t.unit,n=void 0),Zle(i,this.plus(r),me(F({},t),{numeric:"always",units:s,unit:n}))}toRelativeCalendar(t={}){return this.isValid?Zle(t.base||ei.fromObject({},{zone:this.zone}),this,me(F({},t),{numeric:"auto",units:["years","months","days"],calendary:!0})):null}static min(...t){if(!t.every(ei.isDateTime))throw new ip("min requires all arguments be DateTimes");return Cle(t,i=>i.valueOf(),Math.min)}static max(...t){if(!t.every(ei.isDateTime))throw new ip("max requires all arguments be DateTimes");return Cle(t,i=>i.valueOf(),Math.max)}static fromFormatExplain(t,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,o=Cn.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return GSe(o,t,i)}static fromStringExplain(t,i,r={}){return ei.fromFormatExplain(t,i,r)}static get DATE_SHORT(){return HZ}static get DATE_MED(){return sSe}static get DATE_MED_WITH_WEEKDAY(){return JZe}static get DATE_FULL(){return nSe}static get DATE_HUGE(){return oSe}static get TIME_SIMPLE(){return aSe}static get TIME_WITH_SECONDS(){return lSe}static get TIME_WITH_SHORT_OFFSET(){return cSe}static get TIME_WITH_LONG_OFFSET(){return uSe}static get TIME_24_SIMPLE(){return hSe}static get TIME_24_WITH_SECONDS(){return dSe}static get TIME_24_WITH_SHORT_OFFSET(){return pSe}static get TIME_24_WITH_LONG_OFFSET(){return fSe}static get DATETIME_SHORT(){return mSe}static get DATETIME_SHORT_WITH_SECONDS(){return gSe}static get DATETIME_MED(){return ySe}static get DATETIME_MED_WITH_SECONDS(){return vSe}static get DATETIME_MED_WITH_WEEKDAY(){return QZe}static get DATETIME_FULL(){return _Se}static get DATETIME_FULL_WITH_SECONDS(){return bSe}static get DATETIME_HUGE(){return wSe}static get DATETIME_HUGE_WITH_SECONDS(){return xSe}}function sR(e){if(ei.isDateTime(e))return e;if(e&&e.valueOf&&JT(e.valueOf()))return ei.fromJSDate(e);if(e&&typeof e=="object")return ei.fromObject(e);throw new ip(`Unknown datetime argument: ${e}, of type ${typeof e}`)}const C9={ar:[".",","],bg:[",","\xA0"],bs:[",","."],ca:[",","."],cs:[",","\xA0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\xA0"],fi:[",","\xA0"],fr:[",","\u202F"],"fr-ch":[",","\u202F"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",","\xA0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\xA0"],lv:[",","\xA0"],mk:[",","."],nb:[",","\xA0"],nl:[",","."],pl:[",","\xA0"],pt:[",","."],"pt-pt":[",","\xA0"],ro:[",","."],ru:[",","\xA0"],sk:[",","\xA0"],sl:[",","."],sr:[",","."],sv:[",","\xA0"],th:[".",","],tr:[",","."],uk:[",","\xA0"],vi:[",","."],zh:[".",","]};function e2e(e){e||(e=ul());let t=e in C9;if(!t){const n=e.split("-");n.length>1&&n[0]in C9&&(e=n[0],t=!0),t||(e="en")}const[i,r,s="#,##0.###"]=C9[e];return{decimal:i,group:r,pattern:s}}function WYe(e,t){const i=e2e((t=F({},t)).locale);t.customs=i;const r=t.pattern||i.pattern;return isNaN(e)||Math.abs(e)===1/0?null:ZYe(e,r,t)}const t2e=/[#0,]*[#0](?:\.0*#*)?/;function ZYe(e,t,i){const r=(i=i||{}).customs.group,s=i.customs.decimal,n=t.split(";"),o=n[0];if((t=n[e<0?1:0]||"-"+o).includes("%"))e*=100;else if(t.includes("\u2030"))e*=1e3;else{if(t.includes("\xA4"))throw new Error("currency notation not supported");if(t.includes("E"))throw new Error("exponential notation not supported")}const a=t2e,l=o.match(a);if(!l)throw new Error("unable to find a number expression in pattern: "+t);return i.fractional===!1&&(i.places=0),t.replace(a,XYe(e,l[0],{decimal:s,group:r,places:i.places,round:i.round}))}function XYe(e,t,i){(i=i||{}).places===!0&&(i.places=0),i.places===1/0&&(i.places=6);const r=t.split("."),s=typeof i.places=="string"&&i.places.indexOf(",");let n=i.places;s?n=i.places.substring(s+1):n>=0||(n=(r[1]||[]).length),i.round<0||(e=Number(e.toFixed(Number(n))));const o=String(Math.abs(e)).split("."),a=o[1]||"";if(r[1]||i.places){s&&(i.places=i.places.substring(0,s));const g=i.places!==void 0?i.places:r[1]&&r[1].lastIndexOf("0")+1;g>a.length&&(o[1]=a.padEnd(Number(g),"0")),n<a.length&&(o[1]=a.substr(0,Number(n)))}else o[1]&&o.pop();const l=r[0].replace(",","");let c=l.indexOf("0");c!==-1&&(c=l.length-c,c>o[0].length&&(o[0]=o[0].padStart(c,"0")),l.includes("#")||(o[0]=o[0].substr(o[0].length-c)));let h,p,f=r[0].lastIndexOf(",");if(f!==-1){h=r[0].length-f-1;const g=r[0].substr(0,f);f=g.lastIndexOf(","),f!==-1&&(p=g.length-f-1)}const m=[];for(let g=o[0];g;){const y=g.length-h;m.push(y>0?g.substr(y):g),g=y>0?g.slice(0,y):"",p&&(h=p,p=void 0)}return o[0]=m.reverse().join(i.group||","),o.join(i.decimal||".")}function YYe(e){const t=e2e((e=e||{}).locale),i=e.pattern||t.pattern,r=t.group,s=t.decimal;let n=1;if(i.includes("%"))n/=100;else if(i.includes("\u2030"))n/=1e3;else if(i.includes("\xA4"))throw new Error("currency notation not supported");const o=i.split(";");return o.length===1&&o.push("-"+o[0]),{regexp:Y3(o,l=>(l="(?:"+PQ(l,".")+")").replace(t2e,c=>{const h={signed:!1,separator:e.strict?r:[r,""],fractional:e.fractional,decimal:s,exponent:!1},p=c.split(".");let f=e.places;p.length===1&&n!==1&&(p[1]="###"),p.length===1||f===0?h.fractional=!1:(f===void 0&&(f=e.pattern?p[1].lastIndexOf("0")+1:1/0),f&&e.fractional==null&&(h.fractional=!0),!e.places&&f<p[1].length&&(f+=","+p[1].length),h.places=f);const m=p[0].split(",");return m.length>1&&(h.groupSize=m.pop().length,m.length>1&&(h.groupSize2=m.pop().length)),"("+QYe(h)+")"}),!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:r,decimal:s,factor:n}}function JYe(e,t){const i=YYe(t),r=new RegExp("^"+i.regexp+"$").exec(e);if(!r)return NaN;let s=r[1];if(!r[1]){if(!r[2])return NaN;s=r[2],i.factor*=-1}return s=s.replace(new RegExp("["+i.group+"\\s\\xa0]","g"),"").replace(i.decimal,"."),Number(s)*i.factor}function QYe(e){"places"in(e=e||{})||(e.places=1/0),typeof e.decimal!="string"&&(e.decimal="."),"fractional"in e&&!/^0/.test(String(e.places))||(e.fractional=[!0,!1]),"exponent"in e||(e.exponent=[!0,!1]),"eSigned"in e||(e.eSigned=[!0,!1]);const t=Yle(e),i=Y3(e.fractional,s=>{let n="";return s&&e.places!==0&&(n="\\"+e.decimal,e.places===1/0?n="(?:"+n+"\\d+)?":n+="\\d{"+e.places+"}"),n},!0);let r=t+i;return i&&(r="(?:(?:"+r+")|(?:"+i+"))"),r+Y3(e.exponent,s=>s?"([eE]"+Yle({signed:e.eSigned})+")":"")}function Yle(e){return"signed"in(e=e||{})||(e.signed=[!0,!1]),"separator"in e?"groupSize"in e||(e.groupSize=3):e.separator="",Y3(e.signed,t=>t?"[-+]":"",!0)+Y3(e.separator,t=>{if(!t)return"(?:\\d+)";(t=PQ(t))===" "?t="\\s":t==="\xA0"&&(t="\\s\\xa0");const i=e.groupSize,r=e.groupSize2;if(r){const s="(?:0|[1-9]\\d{0,"+(r-1)+"}(?:["+t+"]\\d{"+r+"})*["+t+"]\\d{"+i+"})";return i-r>0?"(?:"+s+"|(?:0|[1-9]\\d{0,"+(i-1)+"}))":s}return"(?:0|[1-9]\\d{0,"+(i-1)+"}(?:["+t+"]\\d{"+i+"})*)"},!0)}const Y3=(e,t,i)=>{if(!(e instanceof Array))return t(e);const r=[];for(let s=0;s<e.length;s++)r.push(t(e[s]));return KYe(r.join("|"),i)},KYe=(e,t)=>"("+(t?"?:":"")+e+")";var Jle,Qle;function k4t(e){return hO.fromJSON(e.toJSON())}function eJe(e){return e.toJSON?e.toJSON():e}function U4t(e){return typeof e=="string"||e instanceof String}function z4t(e){return typeof e=="number"}function Kle(e){return e instanceof Date}function V4t(e,t){return e===t||!(!Kle(e)||!Kle(t))&&e.getTime()===t.getTime()}function B4t(e){if(e===void 0)return null;if(typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 109404;case"miles":case"mile":return 109413;case"kilometers":case"kilometer":case"km":return 109414}return null}function G4t(e){if(e===null)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new yi({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function j4t(e){if(e===void 0)return null;if(typeof e=="number"||typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 9001;case"miles":case"mile":return 9035;case"kilometers":case"kilometer":case"km":return 9036}return null}(function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"})(Jle||(Jle={})),function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(Qle||(Qle={}));const H4t=1e3,q4t={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},ece={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},W4t={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"eesriFieldTypeXML",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"eesriFieldTypeXML"};function Z4t(e){return e===void 0?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function X4t(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const i=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(o){return function(a,l){const c={key:a,value:o[a]},h={key:l,value:o[l]};return s(c,h)}});var s;const n=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let l,c;if(Array.isArray(a)){for(c="[",l=0;l<a.length;l++)l&&(c+=","),c+=o(a[l])||"null";return c+"]"}if(a===null)return"null";if(n.includes(a)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const h=n.push(a)-1,p=Object.keys(a).sort(r&&r(a));for(c="",l=0;l<p.length;l++){const f=p[l],m=o(a[f]);m&&(c&&(c+=","),c+=JSON.stringify(f)+":"+m)}return n.splice(h,1),"{"+c+"}"}(e)}class i2e{constructor(t){this.value=t}}class r2e{constructor(t){this.value=t}}class tte{constructor(t){this.fn=t}}class ite{constructor(t,i){this.paramCount=i,this.fn=t}}const tJe=tte,iJe=r2e,rJe=i2e,sJe=ite,Ih={type:"VOID"},nJe={type:"BREAK"},oJe={type:"CONTINUE"};function J3(e,t,i){return t===""||t==null||t===i||t===i?e:e=e.split(t).join(i)}function rte(e){return e instanceof tte||e instanceof WZe||e instanceof ite}function az(e){return!!rl(e)||!!Ec(e)||!!kl(e)||!!Sc(e)||e===null||e===Ih||typeof e=="number"}function aJe(e,t){return e===void 0?t:e}function rl(e){return typeof e=="string"||e instanceof String}function Sc(e){return typeof e=="boolean"}function Ec(e){return typeof e=="number"}function lJe(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e}function Ep(e){return e instanceof Array}function cJe(e){return(e==null?void 0:e.arcadeDeclaredClass)==="esri.arcade.Feature"}function uJe(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureset.support.FeatureSet")===!0}function hJe(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureSetCollection")===!0}function vS(e){return e instanceof fy}function kl(e){return e instanceof Date}function dJe(e,t,i){if(e.length<t||e.length>i)throw new Error("Function called with wrong number of Parameters")}function pJe(e){return e<0?-Math.round(-e):Math.round(e)}function fJe(){let e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),(t==="x"?i:3&i|8).toString(16)})}function ste(e,t){return isNaN(e)===!1?t==null||t===""?e.toString():(t=J3(t,"\u2030",""),t=J3(t,"\xA4",""),WYe(e,{pattern:t})):e.toString()}function ZB(e,t){const i=ei.fromJSDate(e);return t==null||t===""?i.toISO({suppressMilliseconds:!0}):i.toFormat(s2e(t),{locale:ul(),numberingSystem:"latn"})}function s2e(e){e=e.replace(/LTS|LT|LL?L?L?|l{1,4}/g,"[$&]");let t="";const i=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const r of e.match(i))switch(r){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"Z":t+="ZZ";break;case"ZZ":t+="ZZZ";break;case"S":t+="'S'";break;case"SS":t+="'SS'";break;case"SSS":t+="u";break;case"A":case"a":t+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":t+=r;break;default:r.length>=2&&r.slice(0,1)==="["&&r.slice(-1)==="]"?t+=`'${r.slice(1,-1)}'`:t+=`'${r}'`}return t}function Jr(e,t,i){switch(i){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function mJe(e,t,i){if(e===null){if(t===null||t===Ih)return Jr(null,null,i);if(Ec(t))return Jr(0,t,i);if(rl(t)||Sc(t))return Jr(0,xn(t),i);if(kl(t))return Jr(0,t.getTime(),i)}if(e===Ih){if(t===null||t===Ih)return Jr(null,null,i);if(Ec(t))return Jr(0,t,i);if(rl(t)||Sc(t))return Jr(0,xn(t),i);if(kl(t))return Jr(0,t.getTime(),i)}else if(Ec(e)){if(Ec(t))return Jr(e,t,i);if(Sc(t))return Jr(e,xn(t),i);if(t===null||t===Ih)return Jr(e,0,i);if(rl(t))return Jr(e,xn(t),i);if(kl(t))return Jr(e,t.getTime(),i)}else if(rl(e)){if(rl(t))return Jr(db(e),db(t),i);if(kl(t))return Jr(xn(e),t.getTime(),i);if(Ec(t))return Jr(xn(e),t,i);if(t===null||t===Ih)return Jr(xn(e),0,i);if(Sc(t))return Jr(xn(e),xn(t),i)}else if(kl(e)){if(kl(t))return Jr(e,t,i);if(t===null||t===Ih)return Jr(e.getTime(),0,i);if(Ec(t))return Jr(e.getTime(),t,i);if(Sc(t)||rl(t))return Jr(e.getTime(),xn(t),i)}else if(Sc(e)){if(Sc(t))return Jr(e,t,i);if(Ec(t))return Jr(xn(e),xn(t),i);if(kl(t))return Jr(xn(e),t.getTime(),i);if(t===null||t===Ih)return Jr(xn(e),0,i);if(rl(t))return Jr(xn(e),xn(t),i)}return!!n2e(e,t)&&(i==="<="||i===">=")}function n2e(e,t){if(e===t||e===null&&t===Ih||t===null&&e===Ih)return!0;if(kl(e)&&kl(t))return e.getTime()===t.getTime();if(e instanceof qee||e instanceof s2)return e.equalityTest(t);if(e instanceof dt&&t instanceof dt){const i=e.cache._arcadeCacheId,r=t.cache._arcadeCacheId;if(i!=null)return i===r}return e!==void 0&&t!==void 0&&e!==null&&t!==null&&typeof e=="object"&&typeof t=="object"&&(e._arcadeCacheId===t._arcadeCacheId&&e._arcadeCacheId!==void 0&&e._arcadeCacheId!==null||e._underlyingGraphic===t._underlyingGraphic&&e._underlyingGraphic!==void 0&&e._underlyingGraphic!==null)}function db(e,t){if(rl(e))return e;if(e===null)return"";if(Ec(e))return ste(e,t);if(Sc(e))return e.toString();if(kl(e))return ZB(e,t);if(e instanceof Gu)return JSON.stringify(e.toJSON());if(Ep(e)){const i=[];for(let r=0;r<e.length;r++)i[r]=lz(e[r]);return"["+i.join(",")+"]"}if(e instanceof fy){const i=[];for(let r=0;r<e.length();r++)i[r]=lz(e.get(r));return"["+i.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():rte(e)?"object, Function":""}function gJe(e){const t=[];if(Ep(e)===!1)return null;if(e instanceof fy){for(let i=0;i<e.length();i++)t[i]=xn(e.get(i));return t}for(let i=0;i<e.length;i++)t[i]=xn(e[i]);return t}function S5(e,t){if(rl(e))return e;if(e===null)return"";if(Ec(e))return ste(e,t);if(Sc(e))return e.toString();if(kl(e))return ZB(e,t);if(e instanceof Gu)return e instanceof yi?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+QZ(e.spatialReference)+"}":QZ(e.toJSON(),(i,r)=>i.key===r.key?0:i.key==="spatialReference"?1:r.key==="spatialReference"||i.key<r.key?-1:i.key>r.key?1:0);if(Ep(e)){const i=[];for(let r=0;r<e.length;r++)i[r]=lz(e[r]);return"["+i.join(",")+"]"}if(e instanceof fy){const i=[];for(let r=0;r<e.length();r++)i[r]=lz(e.get(r));return"["+i.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():rte(e)?"object, Function":""}function lz(e){if(e===null)return"null";if(Sc(e)||Ec(e)||rl(e))return JSON.stringify(e);if(e instanceof Gu||e instanceof fy||e instanceof Array)return S5(e);if(e instanceof Date)return JSON.stringify(ZB(e,""));if(e!==null&&typeof e=="object"){if(e.castToText!==void 0)return e.castToText()}else if(e===Ih)return"null";return"null"}function xn(e,t){return Ec(e)?e:e===null||e===""?0:kl(e)?NaN:Sc(e)?e?1:0:Ep(e)||e===""||e===void 0?NaN:t!==void 0&&rl(e)?(t=J3(t,"\u2030",""),t=J3(t,"\xA4",""),JYe(e,{pattern:t})):e===Ih?0:Number(e)}function yJe(e){if(kl(e))return e;if(rl(e)){const t=o2e(e);if(t)return t.toJSDate()}return null}function vJe(e){return kl(e)?ei.fromJSDate(e):rl(e)?o2e(e):null}function o2e(e){const t=/ (\d\d)/;let i=ei.fromISO(e);return i.isValid||t.test(e)&&(e=e.replace(t,"T$1"),i=ei.fromISO(e),i.isValid)?i:null}function _Je(e){return Sc(e)?e:rl(e)?(e=e.toLowerCase())==="true":!!Ec(e)&&e!==0&&!isNaN(e)}function bJe(e,t){return M(e)?null:(e.spatialReference!==null&&e.spatialReference!==void 0||(e.spatialReference=t),e)}function wJe(e){if(e===null)return null;if(e instanceof dt)return e.x==="NaN"||e.x===null||isNaN(e.x)?null:e;if(e instanceof Uo){if(e.rings.length===0)return null;for(const t of e.rings)if(t.length>0)return e;return null}if(e instanceof Fa){if(e.paths.length===0)return null;for(const t of e.paths)if(t.length>0)return e;return null}return e instanceof Wf?e.points.length===0?null:e:e instanceof yi?e.xmin==="NaN"||e.xmin===null||isNaN(e.xmin)?null:e:null}function a2e(e,t){if(!e||!e.domain)return t;let i=null;if(e.field.type==="string"||e.field.type==="esriFieldTypeString")t=db(t);else{if(t==null)return null;if(t==="")return t;t=xn(t)}for(let r=0;r<e.domain.codedValues.length;r++){const s=e.domain.codedValues[r];s.code===t&&(i=s)}return i===null?t:i.name}function l2e(e,t){if(!e||!e.domain)return t;let i=null;t=db(t);for(let r=0;r<e.domain.codedValues.length;r++){const s=e.domain.codedValues[r];s.name===t&&(i=s)}return i===null?t:i.code}function XB(e,t,i=null,r=null){if(!t||!t.fields)return null;let s,n,o=null;for(let a=0;a<t.fields.length;a++){const l=t.fields[a];l.name.toLowerCase()===e.toString().toLowerCase()&&(o=l)}if(o===null)throw new Error("Field not found");return r===null&&i&&t.typeIdField&&(r=i.hasField(t.typeIdField)?i.field(t.typeIdField):null),r!=null&&t.types.some(function(a){return a.id===r&&(s=a.domains&&a.domains[o.name],s&&s.type==="inherited"&&(s=tce(o.name,t),n=!0),!0)}),n||s||(s=tce(e,t)),{field:o,domain:s}}function tce(e,t){let i;return t.fields.some(function(r){return r.name.toLowerCase()===e.toLowerCase()&&(i=r.domain),!!i}),i}function QZ(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const i=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(o){return function(a,l){const c={key:a,value:o[a]},h={key:l,value:o[l]};return s(c,h)}});var s;const n=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let l,c;if(Array.isArray(a)){for(c="[",l=0;l<a.length;l++)l&&(c+=","),c+=o(a[l])||"null";return c+"]"}if(a===null)return"null";if(n.includes(a)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const h=n.push(a)-1,p=Object.keys(a).sort(r&&r(a));for(c="",l=0;l<p.length;l++){const f=p[l],m=o(a[f]);m&&(c&&(c+=","),c+=JSON.stringify(f)+":"+m)}return n.splice(h,1),"{"+c+"}"}(e)}function xJe(e){if(e===null)return null;const t=[];for(const i of e)i&&i.arcadeDeclaredClass&&i.arcadeDeclaredClass==="esri.arcade.Feature"?t.push(i.geometry()):t.push(i);return t}function oM(e,t){if(!(t instanceof dt))throw new Error("Invalid Argument");e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function TJe(e,t){if(Ep(e)||vS(e)){let i=!1,r=!1,s=[],n=t;if(Ep(e)){for(const o of e)oM(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ,r=e[0].hasM)}else if(e instanceof s2)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else{if(!vS(e))throw new Error("Invalid Argument");for(const o of e.toArray())oM(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:(GV(s,r,i)===!1&&(s=s.slice(0).reverse()),new Uo({rings:[s],spatialReference:n,hasZ:i,hasM:r}))}return e}function SJe(e,t){if(Ep(e)||vS(e)){let i=!1,r=!1,s=[],n=t;if(Ep(e)){for(const o of e)oM(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof s2)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else if(vS(e)){for(const o of e.toArray())oM(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new Fa({paths:[s],spatialReference:n,hasZ:i,hasM:r})}return e}function EJe(e,t){if(Ep(e)||vS(e)){let i=!1,r=!1,s=[],n=t;if(Ep(e)){for(const o of e)oM(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof s2)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else if(vS(e)){for(const o of e.toArray())oM(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new Wf({points:s,spatialReference:n,hasZ:i,hasM:r})}return e}function CJe(e,t=!1){const i=[];if(e===null)return i;if(Ep(e)===!0){for(let r=0;r<e.length;r++){const s=db(e[r]);s===""&&t!==!0||i.push(s)}return i}if(e instanceof fy){for(let r=0;r<e.length();r++){const s=db(e.get(r));s===""&&t!==!0||i.push(s)}return i}if(az(e)){const r=db(e);return r===""&&t!==!0||i.push(r),i}return[]}let A9=0;function AJe(e){return A9++,A9%100==0?(A9=0,new Promise(t=>{setTimeout(()=>{t(e)},0)})):e}function MJe(e,t,i){switch(i){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function Q3(e,t=null){return e==null?null:Sc(e)||Ec(e)||rl(e)?e:e instanceof Gu?(t==null?void 0:t.keepGeometryType)===!0?e:e.toJSON():e instanceof fy?e.toArray().map(i=>Q3(i,t)):e instanceof Array?e.map(i=>Q3(i,t)):e instanceof Date?e:e!==null&&typeof e=="object"&&e.castAsJson!==void 0?e.castAsJson(t):null}async function OJe(e,t,i,r,s){const n=await nte(e,t,i);s[r]=n}async function nte(e,t=null,i=null){if(e instanceof fy&&(e=e.toArray()),e==null)return null;if(az(e)||e instanceof Gu||e instanceof Date)return Q3(e,i);if(e instanceof Array){const r=[],s=[];for(const n of e)n===null||az(n)||n instanceof Gu||n instanceof Date?s.push(Q3(n,i)):(s.push(null),r.push(OJe(n,t,i,s.length-1,s)));return r.length>0&&await Promise.all(r),s}return e!==null&&typeof e=="object"&&e.castAsJsonAsync!==void 0?e.castAsJsonAsync(t,i):null}function RJe(e,t,i){const r=e.fullSchema();return r===null||!r.fields?null:XB(t,r,e,i)}function PJe(e){const t=e.fullSchema();return t===null?null:t.fields&&t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map(i=>({name:i.name,code:i.id})):[]}:null}function IJe(e,t,i,r){const s=e.fullSchema();if(s===null||!s.fields)return null;const n=XB(t,s,e,r);if(i===void 0)try{i=e.field(t)}catch{return null}return a2e(n,i)}function $Je(e,t,i,r){const s=e.fullSchema();if(s===null||!s.fields)return null;if(i===void 0){try{i=e.field(t)}catch{return null}return i}return l2e(XB(t,s,e,r),i)}function LJe(e){const t=e.fullSchema();if(t===null||!t.fields)return null;const i=[];for(const r of t.fields)i.push(eJe(r));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField,geometryType:ece[t.geometryType]===void 0?"":ece[t.geometryType],fields:i}}const Y4t=Object.freeze(Object.defineProperty({__proto__:null,ReturnResultE:i2e,ImplicitResultE:r2e,NativeFunctionE:tte,SizzleFunctionE:ite,NativeFunction:tJe,ImplicitResult:iJe,ReturnResult:rJe,SizzleFunction:sJe,voidOperation:Ih,breakResult:nJe,continueResult:oJe,multiReplace:J3,isFunctionParameter:rte,isSimpleType:az,defaultUndefined:aJe,isString:rl,isBoolean:Sc,isNumber:Ec,isInteger:lJe,isArray:Ep,isFeature:cJe,isFeatureSet:uJe,isFeatureSetCollection:hJe,isImmutableArray:vS,isDate:kl,pcCheck:dJe,absRound:pJe,generateUUID:fJe,formatNumber:ste,formatDate:ZB,standardiseDateFormat:s2e,greaterThanLessThan:mJe,equalityTest:n2e,toString:db,toNumberArray:gJe,toStringExplicit:S5,toNumber:xn,toDate:yJe,toDateTime:vJe,toBoolean:_Je,fixSpatialReference:bJe,fixNullGeometry:wJe,getDomainValue:a2e,getDomainCode:l2e,getDomain:XB,stableStringify:QZ,autoCastFeatureToGeometry:xJe,autoCastArrayOfPointsToPolygon:TJe,autoCastArrayOfPointsToPolyline:SJe,autoCastArrayOfPointsToMultiPoint:EJe,toStringArray:CJe,tick:AJe,binaryOperator:MJe,castAsJson:Q3,castAsJsonAsync:nte,featureFullDomain:RJe,featureSubtypes:PJe,featureDomainValueLookup:IJe,featureDomainCodeLookup:$Je,featureSchema:LJe},Symbol.toStringTag,{value:"Module"}));var KZ;let BP=KZ=class extends Ce{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new KZ({minValue:this.minValue,maxValue:this.maxValue})}};u([d({type:Number,json:{write:!0}})],BP.prototype,"minValue",void 0),u([d({type:Number,json:{write:!0}})],BP.prototype,"maxValue",void 0),BP=KZ=u([L("esri.renderer.support.AuthoringInfoClassBreakInfo")],BP);var eX;let A1=eX=class extends Ce{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new eX({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:ue(this.classBreakInfos)})}};u([d({type:String,json:{write:!0}})],A1.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],A1.prototype,"normalizationField",void 0),u([d({type:String,json:{write:!0}})],A1.prototype,"label",void 0),u([d({type:[BP],json:{write:!0}})],A1.prototype,"classBreakInfos",void 0),A1=eX=u([L("esri.renderers.support.AuthoringInfoFieldInfo")],A1);var tX;const nN=new Ti({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),oN=new Ti({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),ice={key:e=>typeof e=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},rce=["high-to-low","above-and-below","centered-on","extremes"],sce=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],nce=["seconds","minutes","hours","days","months","years"];let au=tX=class extends Ce{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return typeof e=="string"||typeof e=="number"?e:null}castStartTime(e){return typeof e=="string"||typeof e=="number"?e:null}get style(){return this.type==="color"?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new tX({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([d({types:ice,json:{write:!0}})],au.prototype,"endTime",void 0),u([Jt("endTime")],au.prototype,"castEndTime",null),u([d({type:String,json:{write:!0}})],au.prototype,"field",void 0),u([d({type:Number,json:{write:!0}})],au.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0}})],au.prototype,"minSliderValue",void 0),u([d({types:ice,json:{write:!0}})],au.prototype,"startTime",void 0),u([Jt("startTime")],au.prototype,"castStartTime",null),u([d({type:nN.apiValues,value:null,json:{type:nN.jsonValues,read:nN.read,write:nN.write}})],au.prototype,"style",null),u([d({type:sce,value:null,json:{type:sce,origins:{"web-scene":{type:rce,write:{writer:(e,t)=>{rce.includes(e)&&(t.theme=e)}}}},write:!0}})],au.prototype,"theme",null),u([d({type:oN.apiValues,json:{type:oN.jsonValues,read:oN.read,write:oN.write}})],au.prototype,"type",void 0),u([d({type:nce,json:{type:nce,write:!0}})],au.prototype,"units",void 0),au=tX=u([L("esri.renderers.support.AuthoringInfoVisualVariable")],au);const DJe=au;let E5=class extends Ce{constructor(e){super(e),this.type=null}};u([d({readOnly:!0,json:{read:!1,write:!0}})],E5.prototype,"type",void 0),E5=u([L("esri.rest.support.ColorRamp")],E5);const ote=E5;var iX;let fx=iX=class extends ote{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new iX({fromColor:ue(this.fromColor),toColor:ue(this.toColor),algorithm:this.algorithm})}};u([bt({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],fx.prototype,"algorithm",void 0),u([d({type:Le,json:{type:[Zr],write:!0}})],fx.prototype,"fromColor",void 0),u([d({type:Le,json:{type:[Zr],write:!0}})],fx.prototype,"toColor",void 0),u([d({type:["algorithmic"]})],fx.prototype,"type",void 0),fx=iX=u([L("esri.rest.support.AlgorithmicColorRamp")],fx);const ate=fx;var rX;let GP=rX=class extends ote{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new rX({colorRamps:ue(this.colorRamps)})}};u([d({type:[ate],json:{write:!0}})],GP.prototype,"colorRamps",void 0),u([d({type:["multipart"]})],GP.prototype,"type",void 0),GP=rX=u([L("esri.rest.support.MultipartColorRamp")],GP);const c2e=GP,u2e={key:"type",base:ote,typeMap:{algorithmic:ate,multipart:c2e}};function h2e(e){return e&&e.type?e.type==="algorithmic"?ate.fromJSON(e):e.type==="multipart"?c2e.fromJSON(e):null:null}var sX;const uw=new Ti({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),aN=new Ti({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),oce=new Ti({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),ace=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],NJe=["high-to-low","above-and-below","above","below","90-10"],FJe=["flow-line","wave-front"],kJe=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let io=sX=class extends Ce{constructor(e){super(e),this.colorRamp=null,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&t!=="relationship"?t==="class-breaks-size"||t==="class-breaks-color"?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){if(e)return h2e(e)}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&e!=="relationship"&&e!=="class-breaks-size"&&e!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;e==="classed-size"?t="class-breaks-size":e==="classed-color"&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new sX({classificationMethod:this.classificationMethod,colorRamp:ue(this.colorRamp),fields:this.fields&&this.fields.slice(0),field1:ue(this.field1),field2:ue(this.field2),focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([d({type:uw.apiValues,value:null,json:{type:uw.jsonValues,read:uw.read,write:uw.write,origins:{"web-document":{default:"manual",type:uw.jsonValues,read:uw.read,write:uw.write}}}})],io.prototype,"classificationMethod",null),u([d({types:u2e,json:{write:!0}})],io.prototype,"colorRamp",void 0),u([De("colorRamp")],io.prototype,"readColorRamp",null),u([d({type:[String],value:null,json:{write:!0}})],io.prototype,"fields",null),u([d({type:A1,value:null,json:{write:!0}})],io.prototype,"field1",null),u([d({type:A1,value:null,json:{write:!0}})],io.prototype,"field2",null),u([d({type:FJe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],io.prototype,"flowTheme",null),u([d({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],io.prototype,"focus",null),u([d({type:Number,value:null,json:{type:Zr,write:!0}})],io.prototype,"numClasses",null),u([d({type:ace,json:{type:ace,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],io.prototype,"lengthUnit",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],io.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],io.prototype,"minSliderValue",void 0),u([d({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],io.prototype,"statistics",null),u([d({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],io.prototype,"standardDeviationInterval",null),u([d({type:aN.apiValues,value:null,json:{type:aN.jsonValues,read:aN.read,write:aN.write,origins:{"web-scene":{type:oce.jsonValues,write:{writer:oce.write,overridePolicy:e=>({enabled:e!=="flow"})}}}}})],io.prototype,"type",null),u([d({type:[DJe],json:{write:!0}})],io.prototype,"visualVariables",void 0),u([d({type:kJe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],io.prototype,"univariateSymbolStyle",null),u([d({type:NJe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],io.prototype,"univariateTheme",null),io=sX=u([L("esri.renderers.support.AuthoringInfo")],io);const d2e=io,M9=new Ti({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let jP=class extends Ce{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([d({type:d2e,json:{write:!0}})],jP.prototype,"authoringInfo",void 0),u([d({type:M9.apiValues,readOnly:!0,json:{type:M9.jsonValues,read:!1,write:{writer:M9.write,ignoreOrigin:!0}}})],jP.prototype,"type",void 0),jP=u([L("esri.renderers.Renderer")],jP);const Dv=jP;var nX;let gA=nX=class extends Ce{constructor(){super(...arguments),this.title=null}clone(){return new nX({title:this.title})}};u([d({type:String,json:{write:!0}})],gA.prototype,"title",void 0),gA=nX=u([L("esri.renderers.support.LegendOptions")],gA);var oX;let C5=oX=class extends gA{constructor(){super(...arguments),this.showLegend=null}clone(){return new oX({title:this.title,showLegend:this.showLegend})}};u([d({type:Boolean,json:{write:!0}})],C5.prototype,"showLegend",void 0),C5=oX=u([L("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],C5);const p2e=C5,UJe=ve.getLogger("esri.renderers.visualVariables.VisualVariable"),O9=new Ti({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let sf=class extends Ce{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(UJe.error(".field: field must be a string value"),null):nL(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([d()],sf.prototype,"index",void 0),u([d({type:O9.apiValues,readOnly:!0,json:{read:O9.read,write:O9.write}})],sf.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],sf.prototype,"field",void 0),u([Jt("field")],sf.prototype,"castField",null),u([d({type:String,json:{write:!0}})],sf.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],sf.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],sf.prototype,"arcadeRequired",null),u([d({type:p2e,json:{write:!0}})],sf.prototype,"legendOptions",void 0),sf=u([L("esri.renderers.visualVariables.VisualVariable")],sf);const CL=sf;var aX;let mx=aX=class extends CL{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new aX({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],mx.prototype,"cache",null),u([d({type:["color"],json:{type:["colorInfo"]}})],mx.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],mx.prototype,"normalizationField",void 0),u([d({type:[zHe],json:{write:!0}})],mx.prototype,"stops",null),mx=aX=u([L("esri.renderers.visualVariables.ColorVariable")],mx);const f2e=mx;var lX;let Z_=lX=class extends Ce{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return ZA(t.transparency)}writeOpacity(e,t,i){t[i]=YV(e)}clone(){return new lX({label:this.label,opacity:this.opacity,value:this.value})}};u([d({type:String,json:{write:!0}})],Z_.prototype,"label",void 0),u([d({type:Number,json:{type:Zr,write:{target:"transparency"}}})],Z_.prototype,"opacity",void 0),u([De("opacity",["transparency"])],Z_.prototype,"readOpacity",null),u([it("opacity")],Z_.prototype,"writeOpacity",null),u([d({type:Number,json:{write:!0}})],Z_.prototype,"value",void 0),Z_=lX=u([L("esri.renderers.visualVariables.support.OpacityStop")],Z_);const zJe=Z_;var cX;let gx=cX=class extends CL{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new cX({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],gx.prototype,"cache",null),u([d({type:["opacity"],json:{type:["transparencyInfo"]}})],gx.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],gx.prototype,"normalizationField",void 0),u([d({type:[zJe],json:{write:!0}})],gx.prototype,"stops",null),gx=cX=u([L("esri.renderers.visualVariables.OpacityVariable")],gx);const m2e=gx;var uX;let Qy=uX=class extends CL{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,i,r){if(r&&r.messages){const s=`visualVariables[${this.index}]`;r.messages.push(new W("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:r}))}}clone(){return new uX({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([d({readOnly:!0})],Qy.prototype,"cache",null),u([d({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],Qy.prototype,"axis",void 0),u([d({type:["rotation"],json:{type:["rotationInfo"]}})],Qy.prototype,"type",void 0),u([d({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],Qy.prototype,"rotationType",void 0),u([d({type:String,json:{write:!0}})],Qy.prototype,"valueExpressionTitle",void 0),u([it("web-scene","valueExpressionTitle")],Qy.prototype,"writeValueExpressionTitleWebScene",null),Qy=uX=u([L("esri.renderers.visualVariables.RotationVariable")],Qy);const g2e=Qy;var hX;let ZE=hX=class extends Ce{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new hX({label:this.label,size:this.size,value:this.value})}};u([d({type:String,json:{write:!0}})],ZE.prototype,"label",void 0),u([d({type:Number,cast:Tr,json:{write:!0}})],ZE.prototype,"size",void 0),u([d({type:Number,json:{write:!0}})],ZE.prototype,"value",void 0),ZE=hX=u([L("esri.renderers.visualVariables.support.SizeStop")],ZE);const VJe=ZE;var dX;let A5=dX=class extends p2e{constructor(){super(...arguments),this.customValues=null}clone(){return new dX({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([d({type:[Number],json:{write:!0}})],A5.prototype,"customValues",void 0),A5=dX=u([L("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],A5);const y2e=A5;var Q0,ha;function DC(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function K3(e){return e!=null&&!isNaN(e)&&isFinite(e)}function v2e(e){return e.valueExpression?Q0.Expression:e.field&&typeof e.field=="string"?Q0.Field:Q0.Unknown}function BJe(e,t){const i=t||v2e(e),r=e.valueUnit||"unknown";return i===Q0.Unknown?ha.Constant:e.stops?ha.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?ha.ClampedLinear:r==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?ha.Proportional:ha.Additive:ha.Identity:ha.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(Q0||(Q0={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(ha||(ha={}));function J4t(e){}function GJe(e){return()=>e}const aM={inches:tr(1,"meters","inches"),feet:tr(1,"meters","feet"),"us-feet":tr(1,"meters","us-feet"),yards:tr(1,"meters","yards"),miles:tr(1,"meters","miles"),"nautical-miles":tr(1,"meters","nautical-miles"),millimeters:tr(1,"meters","millimeters"),centimeters:tr(1,"meters","centimeters"),decimeters:tr(1,"meters","decimeters"),meters:tr(1,"meters","meters"),kilometers:tr(1,"meters","kilometers"),"decimal-degrees":1/_be(1,"meters",Qi.radius)},Pb=ve.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),lce=new Ha,M5=Math.PI,_2e=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function b2e(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(g=>g.type==="color"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void Pb.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const g=r.stops;return g&&g[0]&&g[0].color}if(typeof a!="number")if(h){if(M(i)||M(i.arcade))return void Pb.error("Use of arcade expressions requires an arcade context");const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,x=y.getViewInfo(g),b=y.createExecContext(n,x);if(!p){const S=y.createSyntaxTree(r.valueExpression);p=y.createFunction(S),r.cache.compiledFunc=p}a=y.executeFunction(p,b)}else o&&(a=o[l]);const f=r.normalizationField,m=o?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const g=cte(a,c);if(g){const y=g[0],x=g[1],b=y===x?r.stops[y].color:Le.blendColors(r.stops[y].color,r.stops[x].color,g[2],_(i)?i.color:void 0);return new Le(b)}}}function w2e(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(g=>g.type==="opacity"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void Pb.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const g=r.stops;return g&&g[0]&&g[0].opacity}if(typeof a!="number")if(h){if(M(i)||M(i.arcade))return void Pb.error("Use of arcade expressions requires an arcade context");const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,x=y.getViewInfo(g),b=y.createExecContext(n,x);if(!p){const S=y.createSyntaxTree(r.valueExpression);p=y.createFunction(S),r.cache.compiledFunc=p}a=y.executeFunction(p,b)}else o&&(a=o[l]);const f=r.normalizationField,m=o?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const g=cte(a,c);if(g){const y=g[0],x=g[1];if(y===x)return r.stops[y].opacity;{const b=r.stops[y].opacity;return b+(r.stops[x].opacity-b)*g[2]}}}}function x2e(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(m=>m.type==="rotation"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void Pb.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,o=s==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof t=="number"?null:t,l=a&&a.attributes,c=r.field,{hasExpression:h}=r.cache;let p=r.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(M(i)||M(i.arcade))return void Pb.error("Use of arcade expressions requires an arcade context");const m={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},g=i.arcade.arcadeUtils,y=g.getViewInfo(m),x=g.createExecContext(a,y);if(!p){const b=g.createSyntaxTree(r.valueExpression);p=g.createFunction(b),r.cache.compiledFunc=p}f=g.executeFunction(p,x)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function jJe(e,t,i){const r=typeof t=="number",s=r?null:t,n=s&&s.attributes;let o=r?t:null;const{isScaleDriven:a}=e.cache;let l=e.cache.compiledFunc;if(a){const h=_(i)?i.scale:void 0,p=_(i)?i.view:void 0;o=h==null||p==="3d"?HJe(e):h}else if(!r)switch(e.inputValueType){case Q0.Expression:{if(M(i)||M(i.arcade))return void Pb.error("Use of arcade expressions requires an arcade context");const h={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},p=i.arcade.arcadeUtils,f=p.getViewInfo(h),m=p.createExecContext(s,f);if(!l){const g=p.createSyntaxTree(e.valueExpression);l=p.createFunction(g),e.cache.compiledFunc=l}o=p.executeFunction(l,m);break}case Q0.Field:n&&(o=n[e.field]);break;case Q0.Unknown:o=null}if(!K3(o))return null;if(r||!e.normalizationField)return o;const c=n?parseFloat(n[e.normalizationField]):null;return K3(c)&&c!==0?o/c:null}function HJe(e){let t=null,i=null;const r=e.stops;return r?(t=r[0].value,i=r[r.length-1].value):(t=e.minDataValue||0,i=e.maxDataValue||0),(t+i)/2}function YB(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(n=>n.type==="size"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void Pb.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=S2e(jJe(r,t,i),r,t,i,r.cache.ipData);return s==null||isNaN(s)?0:s}function Fu(e,t,i){return e==null?null:DC(e)?YB(e,t,i):K3(e)?e:null}function T2e(e,t,i){return K3(i)&&e>i?i:K3(t)&&e<t?t:e}function qJe(e,t,i,r){return e+(Fu(t.minSize,i,r)||t.minDataValue)}function WJe(e,t,i){const r=e.stops;let s=r&&r.length&&r[0].size;return s==null&&(s=e.minSize),Fu(s,t,i)}function ZJe(e,t,i,r){const s=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),n=Fu(t.minSize,i,r),o=Fu(t.maxSize,i,r),a=_(r)?r.shape:void 0;if(e<=t.minDataValue)return n;if(e>=t.maxDataValue)return o;if(t.scaleBy==="area"&&a){const l=a==="circle",c=l?M5*(n/2)**2:n*n,h=c+s*((l?M5*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/M5):Math.sqrt(h)}return n+s*(o-n)}function XJe(e,t,i,r){const s=_(r)?r.shape:void 0,n=e/t.minDataValue,o=Fu(t.minSize,i,r),a=Fu(t.maxSize,i,r);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,T2e(l,o,a)}function YJe(e,t,i,r,s){const[n,o,a]=cte(e,s);if(n===o)return Fu(t.stops[n].size,i,r);{const l=Fu(t.stops[n].size,i,r);return l+(Fu(t.stops[o].size,i,r)-l)*a}}function JJe(e,t,i,r){const s=(_(r)&&r.resolution?r.resolution:1)*aM[t.valueUnit],n=Fu(t.minSize,i,r),o=Fu(t.maxSize,i,r),{valueRepresentation:a}=t;let l=null;return l=a==="area"?2*Math.sqrt(e/M5)/s:a==="radius"||a==="distance"?2*e/s:e/s,T2e(l,n,o)}function S2e(e,t,i,r,s){switch(t.transformationType){case ha.Additive:return qJe(e,t,i,r);case ha.Constant:return WJe(t,i,r);case ha.ClampedLinear:return ZJe(e,t,i,r);case ha.Proportional:return XJe(e,t,i,r);case ha.Stops:return YJe(e,t,i,r,s);case ha.RealWorldSize:return JJe(e,t,i,r);case ha.Identity:return e;case ha.Unknown:return null}}function QJe(e,t,i){const{isScaleDriven:r}=e.cache;if(!(r&&i==="3d"||t))return null;const s={scale:t,view:i};let n=Fu(e.minSize,lce,s),o=Fu(e.maxSize,lce,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function lte(e,t,i){if(!e.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const l of e.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=b2e(l,t,i);r.push({variable:l,value:c})}),n.forEach(l=>{const c=w2e(l,t,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=x2e(l,t,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=YB(l,t,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function cte(e,t){if(!t)return;let i=0,r=t.length-1;return t.some((s,n)=>e<s?(r=n,!0):(i=n,!1)),[i,r,(e-t[i])/(t[r]-t[i])]}function KJe(e,t,i){const r=["proportional","proportional","proportional"];for(const s of e){const n=s.useSymbolValue?"symbol-value":YB(s,t,i);switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}var o2=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getAllSizes:KJe,getColor:b2e,getOpacity:w2e,getRotationAngle:x2e,getSize:YB,getSizeForValue:S2e,getSizeFromNumberOrVariable:Fu,getSizeRangeAtScale:QJe,getVisualVariableValues:lte,viewScaleRE:_2e}),pX;const P2=ve.getLogger("esri.renderers.visualVariables.SizeVariable"),lN=new Ti({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),fX=new Ti({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function cce(e){if(e!=null)return typeof e=="string"||typeof e=="number"?Tr(e):e.type==="size"?DC(e)?e:(delete(e=F({},e)).type,new Cr(e)):void 0}function uce(e,t,i){if(typeof e!="object")return e;const r=new Cr;return r.read(e,i),r}let Cr=pX=class extends CL{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:_2e.test(this.valueExpression)}}set expression(e){P2.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),e==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}set index(e){DC(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),DC(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return v2e(this)}set maxDataValue(e){e&&this.stops&&(P2.warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(P2.warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return cce(e)}readMaxSize(e,t,i){return uce(e,t,i)}set minDataValue(e){e&&this.stops&&(P2.warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(P2.warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return cce(e)}readMinSize(e,t,i){return uce(e,t,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(e){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value):e&&(P2.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return BJe(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,i,r){if(e==="$view.scale"){if(r&&r.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;r.messages.push(new W("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:r}))}}else t[i]=e}readValueUnit(e){return e?fX.read(e):null}clone(){return new pX({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:DC(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:DC(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===ha.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===ha.Stops){const e=this.stops,t=e.map(r=>r.size).reverse(),i=e.length;for(let r=0;r<i;r++)e[r].size=t[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],Cr.prototype,"cache",null),u([d({type:lN.apiValues,json:{type:lN.jsonValues,origins:{"web-map":{read:!1}},read:lN.read,write:lN.write}})],Cr.prototype,"axis",void 0),u([d({type:String,value:null,json:{read:!1}})],Cr.prototype,"expression",null),u([d()],Cr.prototype,"index",null),u([d({type:String,readOnly:!0})],Cr.prototype,"inputValueType",null),u([d({type:y2e,json:{write:!0}})],Cr.prototype,"legendOptions",void 0),u([d({type:Number,value:null,json:{write:!0}})],Cr.prototype,"maxDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],Cr.prototype,"maxSize",null),u([Jt("maxSize")],Cr.prototype,"castMaxSize",null),u([De("maxSize")],Cr.prototype,"readMaxSize",null),u([d({type:Number,value:null,json:{write:!0}})],Cr.prototype,"minDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],Cr.prototype,"minSize",null),u([Jt("minSize")],Cr.prototype,"castMinSize",null),u([De("minSize")],Cr.prototype,"readMinSize",null),u([d({type:String,json:{write:!0}})],Cr.prototype,"normalizationField",void 0),u([d({readOnly:!0})],Cr.prototype,"arcadeRequired",null),u([d({type:String})],Cr.prototype,"scaleBy",void 0),u([d({type:[VJe],value:null,json:{write:!0}})],Cr.prototype,"stops",null),u([d({type:["outline"],json:{write:!0}})],Cr.prototype,"target",void 0),u([d({type:String,readOnly:!0})],Cr.prototype,"transformationType",null),u([d({type:["size"],json:{type:["sizeInfo"]}})],Cr.prototype,"type",void 0),u([d({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Cr.prototype,"useSymbolValue",void 0),u([d({type:String,json:{write:!0}})],Cr.prototype,"valueExpression",void 0),u([De("valueExpression",["valueExpression","expression"])],Cr.prototype,"readValueExpression",null),u([it("web-scene","valueExpression")],Cr.prototype,"writeValueExpressionWebScene",null),u([d({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Cr.prototype,"valueRepresentation",void 0),u([d({type:fX.apiValues,json:{write:fX.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],Cr.prototype,"valueUnit",void 0),u([De("valueUnit")],Cr.prototype,"readValueUnit",null),Cr=pX=u([L("esri.renderers.visualVariables.SizeVariable")],Cr);const ute=Cr,eQe=ve.getLogger("esri.renderers.visualVariables.VisualVariableFactory"),tQe={color:f2e,size:ute,opacity:m2e,rotation:g2e},iQe=new Ti({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),rQe=/^\[([^\]]+)\]$/i;let O5=class extends Ee{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(t=>!!t))&&e.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some(t=>!!t.target)&&e.sort((t,i)=>{let r=null;return r=t.target===i.target?0:t.target?1:-1,r});for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,i){const{rotationExpression:r,rotationType:s}=t,n=r&&r.match(rQe),o=n&&n[1];if(o&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:o})),e)return e.map(a=>{const l=iQe.read(a.type),c=tQe[l];c||(eQe.warn(`Unknown variable type: ${l}`),i&&i.messages&&i.messages.push(new Uc("visual-variable:unsupported",`visualVariable of type '${l}' is not supported`,{definition:a,context:i})));const h=new c;return h.read(a,i),h})}writeVariables(e,t){const i=[];for(const r of e){const s=r.toJSON(t);s&&i.push(s)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([d()],O5.prototype,"visualVariables",null),O5=u([L("esri.renderers.visualVariables.VisualVariableFactory")],O5);const sQe=O5,nQe={base:CL,key:"type",typeMap:{opacity:m2e,color:f2e,rotation:g2e,size:ute}},yO=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new sQe}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,s){return this._vvFactory.readVariables(i,r,s)}writeVisualVariables(i,r,s,n){r[s]=this._vvFactory.writeVariables(i,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const s=this.visualVariables;return s?s.filter(n=>n.type===i&&(typeof r=="string"?n.target===r:r!==!1||!n.target)):[]}async collectVVRequiredFields(i,r){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&mp(i,r,n.field),n.normalizationField&&mp(i,r,n.normalizationField),n.valueExpression&&await zc(i,r,n.valueExpression))}};return u([d({types:[nQe],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),u([De("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),u([it("visualVariables")],t.prototype,"writeVisualVariables",null),t=u([L("esri.renderers.mixins.VisualVariablesMixin")],t),t},nR={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function lM(e,t=nR){var a,l;if(!e)return{symbol:null};const{retainId:i=nR.retainId,ignoreDrivers:r=nR.ignoreDrivers,hasLabelingContext:s=nR.hasLabelingContext,retainCIM:n=nR.retainCIM}=t;let o;if(om(e)||e instanceof KS)o=e.clone();else if(e.type==="cim"){const c=(l=(a=e.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new W("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:e})};o=n?e.clone():W1.fromCIMSymbol(e)}else if(e instanceof dl)o=aB.fromSimpleLineSymbol(e);else if(e instanceof hl)o=W1.fromSimpleMarkerSymbol(e);else if(e instanceof lB)o=W1.fromPictureMarkerSymbol(e);else if(e instanceof wp)o=pL.fromSimpleFillSymbol(e);else{if(!(e instanceof nO))return{error:new W("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};o=s?oB.fromTextSymbol(e):W1.fromTextSymbol(e)}if(i&&o.type!=="cim"&&(o.id=e.id),r&&om(o))for(let c=0;c<o.symbolLayers.length;++c)o.symbolLayers.getItemAt(c)._ignoreDrivers=!0;return{symbol:o}}const oQe=["building-scene","integrated-mesh","point-cloud","scene"];function cz(e,t,i,r){const s=E2e(e,{},{context:r,isLabelSymbol:!1});_(s)&&(t[i]=s)}function hce(e,t,i,r){const s=E2e(e,{},{context:r,isLabelSymbol:!0});_(s)&&(t[i]=s)}function dce(e){return e instanceof sO||e instanceof KS}function E2e(e,t,i){var a;if(M(e))return null;const{context:r,isLabelSymbol:s}=i,n=r==null?void 0:r.origin,o=r==null?void 0:r.messages;if(n==="web-scene"&&!dce(e)){const l=lM(e,{retainCIM:!0,hasLabelingContext:s});return _(l.symbol)?l.symbol.write(t,r):(o==null||o.push(new W("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:r,error:l.error})),null)}return(n==="web-map"||n==="portal-item"&&!oQe.includes((a=r==null?void 0:r.layer)==null?void 0:a.type))&&dce(e)?(o==null||o.push(new W("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:r})),null):e.write(t,r)}function C2e(e,t){return OBe(e,null,t)}const AL={types:rbe,json:{write:{writer:cz},origins:{"web-scene":{types:Doe,write:{writer:cz},read:{reader:KM({types:Doe})}}}}},A2e={types:{base:qc,key:"type",typeMap:{"simple-fill":bu.typeMap["simple-fill"],"picture-fill":bu.typeMap["picture-fill"],"polygon-3d":bu.typeMap["polygon-3d"]}},json:{write:{writer:cz},origins:{"web-scene":{type:pL,write:{writer:cz}}}}};var mX;let X_=mX=class extends Ce{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new mX({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};u([d({type:String,json:{write:!0}})],X_.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],X_.prototype,"label",void 0),u([d({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],X_.prototype,"minValue",void 0),u([d({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],X_.prototype,"maxValue",void 0),u([d(AL)],X_.prototype,"symbol",void 0),X_=mX=u([L("esri.renderers.support.ClassBreakInfo")],X_);const uz=X_;var gX;const cN=ve.getLogger("esri.renderers.ClassBreaksRenderer"),M2e="log",R5="percent-of-total",P5="field",uN=new Ti({esriNormalizeByLog:M2e,esriNormalizeByPercentOfTotal:R5,esriNormalizeByField:P5}),aQe=dn(uz);let xo=gX=class extends yO(Dv){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,i){if(!Array.isArray(e))return;let r=t.minValue;return e.map(s=>{const n=new uz;return n.read(s,i),n.minValue==null&&(n.minValue=r),n.maxValue==null&&(n.maxValue=n.minValue),r=n.maxValue,n})}writeClassBreakInfos(e,t,i,r){const s=e.map(n=>n.write({},r));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),t[i]=s}castField(e){return e==null?e:typeof e=="function"?(cN.error(".field: field must be a string value"),null):nL(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,i=this.normalizationTotal!=null;return t||i?(e=t&&P5||i&&R5||null,t&&i&&cN.warn("warning: both normalizationField and normalizationTotal are set!")):e!==P5&&e!==R5||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,i){let r=null;r=typeof e=="number"?new uz({minValue:e,maxValue:t,symbol:sbe(i)}):aQe(ue(e)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const s=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(s[0]===e&&s[1]===t){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(e,t){return this.valueExpression&&(M(t)||M(t.arcade))&&cN.warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let i=t;this.valueExpression&&(M(t)||M(t.arcade))&&(i=me(F({},i),{arcade:await sm()}));const r=this.getBreakIndex(e,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(e,t){if(this.valueExpression&&(M(t)||M(t.arcade)))return void cN.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(e,t);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(M(t)||M(t.arcade))){const s=await sm(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i=me(F({},i),{arcade:s})}const r=this.getBreakIndex(e,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach(t=>{t.symbol&&e.push(t.symbol)}),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce((r,s)=>r+s.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new gX({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:ue(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:ue(this.visualVariables),legendOptions:ue(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(e,t)),zc(e,t,this.valueExpression)];mp(e,t,this.field),mp(e,t,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=Ye(t,{});let o=this._compiledValueExpression.valueExpression===this.valueExpression?this._compiledValueExpression.compiledFunction:null;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._compiledValueExpression.compiledFunction=o}this._compiledValueExpression.valueExpression=this.valueExpression;const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._getBreakIndexfromInfos(l)}_getBreakIndexForField(e){const t=this.field,i=e.attributes,r=this.normalizationType;let s=parseFloat(i[t]);if(r){const n=this.normalizationTotal,o=parseFloat(i[this.normalizationField]);if(r===M2e)s=Math.log(s)*Math.LOG10E;else if(r!==R5||isNaN(n)){if(r===P5&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(e!=null&&typeof e=="number"&&!isNaN(e))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=e&&(t?e<=r[1]:e<r[1]))return i}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let i=1;i<t;i++)if(e[i-1].maxValue!==e[i].minValue)return!1;return!0}};u([d(A2e)],xo.prototype,"backgroundFillSymbol",void 0),u([d({type:[uz]})],xo.prototype,"classBreakInfos",void 0),u([De("classBreakInfos")],xo.prototype,"readClassBreakInfos",null),u([it("classBreakInfos")],xo.prototype,"writeClassBreakInfos",null),u([d({type:String,json:{write:!0}})],xo.prototype,"defaultLabel",void 0),u([d(AL)],xo.prototype,"defaultSymbol",void 0),u([d({type:String,json:{write:!0}})],xo.prototype,"field",void 0),u([Jt("field")],xo.prototype,"castField",null),u([d({type:Boolean})],xo.prototype,"isMaxInclusive",void 0),u([d({type:gA,json:{write:!0}})],xo.prototype,"legendOptions",void 0),u([d({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],xo.prototype,"minValue",null),u([d({type:String,json:{write:!0}})],xo.prototype,"normalizationField",void 0),u([d({type:Number,cast:e=>tp(e),json:{write:!0}})],xo.prototype,"normalizationTotal",void 0),u([d({type:uN.apiValues,value:null,json:{type:uN.jsonValues,read:uN.read,write:uN.write}})],xo.prototype,"normalizationType",null),u([bt({classBreaks:"class-breaks"})],xo.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],xo.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],xo.prototype,"valueExpressionTitle",void 0),xo=gX=u([L("esri.renderers.ClassBreaksRenderer")],xo);const O2e=xo;class hte{constructor(t,i){this._storage=new Iee,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}put(t,i,r){this._storage.put(t,i,r,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(t){this._storage.maxSize=t}}const pce=ve.getLogger("esri.renderers.support.DictionaryLoader"),lQe={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class dte{constructor(t,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new hte(100),this.url=t,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(t,i){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(m){if(as(m))return this._dictionaryPromise=null,null}const s={};if(this.fieldMap)for(const m of this._symbolFields){const g=this.fieldMap[m];if(g&&t.attributes[g]!=null){const y=""+t.attributes[g];s[m]=y}else s[m]=""}const n=r(s,i);if(!n||typeof n!="string")return null;const o=IQ(n).toString(),a=this._symbolCache.get(o);if(a)return a.catch(()=>{this._symbolCache.pop(o)}),a;const l=n.split(";"),c=[],h=[];for(const m of l)if(m)if(m.includes("po:")){const g=m.substr(3).split("|");if(g.length===3){const y=g[0],x=g[1];let b=g[2];if(x==="DashTemplate")b=b.split(" ").map(S=>Number(S));else if(x==="Color"){const S=new Le(b).toRgba();b=[S[0],S[1],S[2],255*S[3]]}else b=Number(b);h.push({primitiveName:y,propertyName:x,value:b})}}else if(m.includes("|")){for(const g of m.split("|"))if(this._itemNames.has(g)){c.push(g);break}}else this._itemNames.has(m)&&c.push(m);const p=!_(t.geometry)||!t.geometry.hasZ&&t.geometry.type==="point",f=this._cimPartsToCIMSymbol(c,h,p,i);return this._symbolCache.put(o,f,1),f}async fetchResources(t){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void pce.error("no valid URL!");const i=Zt(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:_(t)?t.signal:null}),[{data:r}]=await Promise.all([i,sm()]);if(!r)throw this._dictionaryPromise=null,new W("esri.renderers.DictionaryRenderer","Bad dictionary data!");const s=r.expression,n=r.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(r.itemsNames),this._symbolFields=n.symbol;const o={};if(this.config){const l=this.config;for(const c in l)o[c]=l[c]}if(n.configuration)for(const l of n.configuration)o.hasOwnProperty(l.name)||(o[l.name]=l.value);const a=[];if(_(t)&&t.fields&&this.fieldMap)for(const l of this._symbolFields){const c=this.fieldMap[l],h=t.fields.filter(p=>p.name===c);h.length>0&&a.push(me(F({},h[0]),{name:l}))}return this._dictionaryPromise=BUe(s,_(t)?t.spatialReference:null,a,o).then(l=>{const c={scale:0};return(h,p)=>{const f=l.repurposeFeature({geometry:null,attributes:h});return c.scale=_(p)?p.scale:void 0,l.evaluate({$feature:f,$view:c})}}).catch(l=>(pce.error("Creating dictinoary expression failed:",l),null)),this._dictionaryPromise}async _cimPartsToCIMSymbol(t,i,r,s){const n=new Array(t.length);for(let l=0;l<t.length;l++)n[l]=this._getSymbolPart(t[l],s);const o=await Promise.all(n),a=this.fieldMap;for(const l of o)R2e(l,a);return new XS({data:this._combineSymbolParts(o,i,r)})}async _getSymbolPart(t,i){if(this._ongoingRequests.has(t))return this._ongoingRequests.get(t).then(n=>n.data);const r=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,t),s=Zt(r,F({responseType:"json",query:{f:"json"}},i));this._ongoingRequests.set(t,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(t),n}}_combineSymbolParts(t,i,r){if(!t||t.length===0)return null;const s=F({},t[0]);if(t.length>1){s.symbolLayers=[];for(const n of t){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return r&&(s.callout=lQe),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:i}}}function R2e(e,t){if(!e)return;const i=e.symbolLayers;if(!i)return;let r=i.length;for(;r--;){const s=i[r];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&cQe(s,t)}}function cQe(e,t){const i=e.markerGraphics;if(i)for(const r of i){if(!r)continue;const s=r.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":R2e(s,t);break;case"CIMTextSymbol":s.fieldMap=t}}}var Q4t=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",DictionaryLoader:dte}),yX;let nf=yX=class extends yO(Dv){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new dte(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,i,r){(r==null?void 0:r.origin)||super.writeVisualVariables(e,t,i,r)}clone(){return new yX({config:ue(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:ue(this.fieldMap),url:ue(this.url),visualVariables:ue(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await zc(e,t,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];t.has(r)&&e.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([d({type:dte})],nf.prototype,"_loader",null),u([d({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],nf.prototype,"config",void 0),u([d({type:Object,json:{write:!0}})],nf.prototype,"fieldMap",void 0),u([d({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],nf.prototype,"scaleExpression",void 0),u([it("scaleExpression")],nf.prototype,"writeData",null),u([d({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],nf.prototype,"scaleExpressionTitle",void 0),u([d({type:String,json:{write:!0}})],nf.prototype,"url",void 0),u([it("visualVariables")],nf.prototype,"writeVisualVariables",null),nf=yX=u([L("esri.renderers.DictionaryRenderer")],nf);const uQe=nf;var vX;const hQe=ve.getLogger("esri.renderers.support.AttributeColorInfo");let Ky=vX=class extends Ce{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(hQe.error(".field: field must be a string value"),null):nL(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new vX({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:Le,json:{type:[Number],write:!0}})],Ky.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Ky.prototype,"field",void 0),u([Jt("field")],Ky.prototype,"castField",null),u([d({type:String,json:{write:!0}})],Ky.prototype,"label",void 0),u([d({type:String,json:{write:!0}})],Ky.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],Ky.prototype,"valueExpressionTitle",void 0),Ky=vX=u([L("esri.renderers.support.AttributeColorInfo")],Ky);const P2e=Ky;var _X;let I5=_X=class extends Ce{constructor(){super(...arguments),this.unit=null}clone(){return new _X({unit:this.unit})}};u([d({type:String,json:{write:!0}})],I5.prototype,"unit",void 0),I5=_X=u([L("esri.renderers.support.DotDensityLegendOptions")],I5);const dQe=I5;var bX;let Cl=bX=class extends yO(Dv){constructor(e){super(e),this.attributes=null,this.backgroundColor=new Le([0,0,0,0]),this.blendDots=!0,this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new dl,this.dotValue=null,this.referenceDotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new wp({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes&&this.attributes.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new bX({attributes:ue(this.attributes),backgroundColor:ue(this.backgroundColor),dotBlendingEnabled:ue(this.dotBlendingEnabled),dotShape:ue(this.dotShape),dotSize:ue(this.dotSize),dotValue:ue(this.dotValue),legendOptions:ue(this.legendOptions),outline:ue(this.outline),referenceScale:ue(this.referenceScale),visualVariables:ue(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await zc(e,t,i.valueExpression),i.field&&e.add(i.field)}};u([d({type:[P2e],json:{write:!0}})],Cl.prototype,"attributes",void 0),u([d({type:Le,json:{write:!0}})],Cl.prototype,"backgroundColor",void 0),u([d({type:Boolean}),ze("dotBlendingEnabled")],Cl.prototype,"blendDots",void 0),u([d({type:Boolean,json:{write:!0}})],Cl.prototype,"dotBlendingEnabled",void 0),u([d({type:String,json:{write:!1}})],Cl.prototype,"dotShape",void 0),u([d({type:Number,json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1}}}})],Cl.prototype,"dotSize",void 0),u([d({type:dQe,json:{write:!0}})],Cl.prototype,"legendOptions",void 0),u([d({type:dl,json:{default:null,write:!0}})],Cl.prototype,"outline",void 0),u([d({type:Number,json:{write:!0}})],Cl.prototype,"dotValue",void 0),u([d({type:Number}),ze("dotValue")],Cl.prototype,"referenceDotValue",void 0),u([d({type:Number,json:{write:!0}})],Cl.prototype,"referenceScale",void 0),u([d({type:Number,json:{write:!0}})],Cl.prototype,"seed",void 0),u([bt({dotDensity:"dot-density"})],Cl.prototype,"type",void 0),Cl=bX=u([L("esri.renderers.DotDensityRenderer")],Cl);const pQe=Cl;let XE=class extends Wu(Ce){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([d({type:String,json:{write:!0}})],XE.prototype,"minLabel",void 0),u([d({type:String,json:{write:!0}})],XE.prototype,"maxLabel",void 0),u([d({type:String,json:{write:!0}})],XE.prototype,"title",void 0),XE=u([L("esri.renderers.support.HeatmapLegendOptions")],XE);const pte=2.4;function fQe(e){return Vc(e*pte)}function mQe(e){return $i(e)/pte}function gQe(e,t,i,r){let{color:s,ratio:n}=t,{color:o,ratio:a}=i;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=He((r-n)/(a-n),0,1);RV(e,s.toArray(),o.toArray(),l)}function K4t(e){const i=new Uint8ClampedArray(2048);if(e=e.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),e.length<1)return i;let r=e[0],s=e[0],n=1;const o=si();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<e.length;)r=s,s=e[n++];gQe(o,r,s,l),i.set(o,4*a)}return i}function e5t(e,t,i,r){const{radius:s,fieldOffset:n,field:o}=t,a=Math.round($i(s)),l=new Float64Array(i*r);let c,h=Number.NEGATIVE_INFINITY;const p=vQe(o,n),f=new Set;for(const m of e){const g=m.getCursor();for(;g.next();){const y=g.getObjectId();if(f.has(y))continue;f.add(y);const x=g.readLegacyPointGeometry(),b=128;if(x.x<-b||x.x>=i+b||x.y<-b||x.y>r+b)continue;const S=+p(g),T=Math.max(0,Math.round(x.x)-a),C=Math.max(0,Math.round(x.y)-a),A=Math.min(r,Math.round(x.y)+a),O=Math.min(i,Math.round(x.x)+a);for(let D=C;D<A;D++)for(let U=T;U<O;U++){const k=D*i+U,B=yQe(x.x-U,x.y-D,a);c=l[k]+=B*S,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function yQe(e,t,i){const r=Math.sqrt(e**2+t**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function t5t(e,t){return typeof e=="function"?e:e?typeof t=="string"?i=>-1*+i[e]:i=>+i[e]+t:()=>1}function vQe(e,t){return e!=null?typeof t=="string"?i=>-1*+i.readAttribute(e):i=>+i.readAttribute(e)+t:i=>1}var wX;const _Qe=ve.getLogger("esri.renderers.HeatmapRenderer");function fce(e){if(e!=null){const{maxDensity:i,minDensity:r,radius:s}=e;if(i!=null||r!=null||s!=null){const t=e,{blurRadius:n,maxPixelIntensity:o,minPixelIntensity:a}=t;return xD(t,["blurRadius","maxPixelIntensity","minPixelIntensity"])}}return e}let ea=wX=class extends Dv{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new BI({ratio:0,color:new Le("rgba(255, 140, 0, 0)")}),new BI({ratio:.75,color:new Le("rgba(255, 140, 0, 1)")}),new BI({ratio:.9,color:new Le("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(e){return fce(e)}get blurRadius(){return mQe(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",fQe(e)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(pte**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(e,t){this._warnedProps[e]||ho(this).getDefaultOrigin()==="user"&&(this._warnedProps[e]=!0,Zb(()=>{B5e(_Qe,e,{replacement:`${String(t)} (suggested value: ${this._get(t)})`,version:"4.24"})}))}read(e,t){e=fce(e),super.read(e,t)}getSymbol(){const e=this.referenceScale!==0?5:1,t=Math.min(this.radius*e,Vc(256));return new hl({size:t})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&await mp(e,t,i),r&&typeof r=="string"&&await zc(e,t,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new wX({colorStops:ue(this.colorStops),field:this.field,legendOptions:ue(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:d2e,json:{write:!1}})],ea.prototype,"authoringInfo",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ea.prototype,"blurRadius",null),u([d({type:[BI],json:{write:!0}})],ea.prototype,"colorStops",void 0),u([d({type:String,json:{write:!0}})],ea.prototype,"field",void 0),u([d({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:i==null})},origins:{"web-scene":{write:!1}}}})],ea.prototype,"fieldOffset",void 0),u([d({type:XE,json:{write:!0}})],ea.prototype,"legendOptions",void 0),u([d({type:Number,json:{write:!0}})],ea.prototype,"maxDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ea.prototype,"maxPixelIntensity",null),u([d({type:Number,json:{write:!0}})],ea.prototype,"minDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ea.prototype,"minPixelIntensity",null),u([d({type:Number,cast:Tr,json:{write:!0}})],ea.prototype,"radius",void 0),u([d({type:Number,range:{min:0},json:{default:0,write:!0}})],ea.prototype,"referenceScale",void 0),u([bt({heatmap:"heatmap"})],ea.prototype,"type",void 0),u([d({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],ea.prototype,"valueExpression",void 0),u([d({type:String})],ea.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],ea.prototype,"_pixelIntensityToDensity",null),ea=wX=u([L("esri.renderers.HeatmapRenderer")],ea);const I2e=ea;let sT=class extends Wu(Ce){constructor(){super(...arguments),this.color=new Le([0,0,0,0]),this.label=null,this.threshold=0}};u([d({type:Le,json:{write:!0}})],sT.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],sT.prototype,"label",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],sT.prototype,"threshold",void 0),sT=u([L("esri.renderers.support.OthersCategory")],sT);let $5=class extends Wu(Ce){constructor(){super(...arguments),this.title=null}};u([d({type:String,json:{write:!0}})],$5.prototype,"title",void 0),$5=u([L("esri.renderers.support.PieChartLegendOptions")],$5);let uh=class extends yO(Wu(Dv)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new Le([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new sT,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new hl({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await zc(e,t,i.valueExpression),i.field&&e.add(i.field)}};u([d({type:[P2e],json:{write:!0}})],uh.prototype,"attributes",void 0),u([d({type:wp,json:{default:null,write:!0}})],uh.prototype,"backgroundFillSymbol",void 0),u([d({type:Le,json:{write:!0}})],uh.prototype,"defaultColor",void 0),u([d({type:String,json:{write:!0}})],uh.prototype,"defaultLabel",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],uh.prototype,"holePercentage",void 0),u([d({type:sT,json:{write:!0}})],uh.prototype,"othersCategory",void 0),u([d({type:$5,json:{write:!0}})],uh.prototype,"legendOptions",void 0),u([d({type:dl,json:{default:null,write:!0}})],uh.prototype,"outline",void 0),u([d({type:Number,cast:Tr,json:{write:!0}})],uh.prototype,"size",void 0),u([bt({pieChart:"pie-chart"})],uh.prototype,"type",void 0),uh=u([L("esri.renderers.PieChartRenderer")],uh);const bQe=uh;var xX;let yx=xX=class extends yO(Dv){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(e,t)))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new xX({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:ue(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([d({type:String,json:{write:!0}})],yx.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],yx.prototype,"label",void 0),u([d(AL)],yx.prototype,"symbol",void 0),u([bt({simple:"simple"})],yx.prototype,"type",void 0),yx=xX=u([L("esri.renderers.SimpleRenderer")],yx);const fte=yx,wQe=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function TX(e){return e instanceof Ee}function mce(e){return e instanceof nt?Object.keys(e.items):TX(e)?ho(e).keys():e?Object.keys(e):[]}function hN(e,t){return e instanceof nt?e.items[t]:e[t]}function xQe(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}function WI(e){return e?e.declaredClass:null}function $2e(e,t){const i=e.diff;if(i&&typeof i=="function")return i(e,t);const r=mce(e),s=mce(t);if(r.length===0&&s.length===0)return;if(!r.length||!s.length||xQe(e,t))return{type:"complete",oldValue:e,newValue:t};const n=s.filter(p=>!r.includes(p)),o=r.filter(p=>!s.includes(p)),a=r.filter(p=>s.includes(p)&&hN(e,p)!==hN(t,p)).concat(n,o).sort(),l=WI(e);if(l&&wQe.includes(l)&&a.length)return{type:"complete",oldValue:e,newValue:t};let c;const h=TX(e)&&TX(t);for(const p of a){const f=hN(e,p),m=hN(t,p);let g;if((h||typeof f!="function"&&typeof m!="function")&&f!==m&&(f!=null||m!=null)){if(i&&i[p]&&typeof i[p]=="function")g=i[p](f,m);else if(f instanceof Date&&m instanceof Date){if(f.getTime()===m.getTime())continue;g={type:"complete",oldValue:f,newValue:m}}else g=typeof f=="object"&&typeof m=="object"&&WI(f)===WI(m)?$2e(f,m):{type:"complete",oldValue:f,newValue:m};_(g)&&(_(c)?c.diff[p]=g:c={type:"partial",diff:{[p]:g}})}}return c}function TQe(e,t){if(M(e))return!1;const i=t.split(".");let r=e;for(const s of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const n=r.diff[s];if(!n)return!1;r=n}}return!0}function i5t(e,t){for(const i of t)if(TQe(e,i))return!0;return!1}function SQe(e,t){if(!(typeof e=="function"||typeof t=="function"||M(e)&&M(t)))return M(e)||M(t)||typeof e=="object"&&typeof t=="object"&&WI(e)!==WI(t)?{type:"complete",oldValue:e,newValue:t}:$2e(e,t)}function dN(e){if(M(e))return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const i of t.added)if(!dN(i))return!1;for(const i of t.removed)if(!dN(i))return!1;for(const i of t.changed)if(!dN(i))return!1;return!0}case"partial":for(const t in e.diff)if(!dN(e.diff[t]))return!1;return!0}}var SX;let Y_=SX=class extends Ce{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}castValue(e){return e==null||typeof e=="string"||typeof e=="number"?e:`${e}`}clone(){return new SX({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};u([d({type:String,json:{write:!0}})],Y_.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],Y_.prototype,"label",void 0),u([d(AL)],Y_.prototype,"symbol",void 0),u([d({json:{type:String,write:{writer:(e,t)=>{t.value=e==null?void 0:e.toString()}}}})],Y_.prototype,"value",void 0),u([Jt("value")],Y_.prototype,"castValue",null),Y_=SX=u([L("esri.renderers.support.UniqueValueInfo")],Y_);const hz=Y_,EQe=()=>!!ye("enable-feature:force-wosr"),r5t=()=>!!ye("enable-feature:direct-3d-object-feature-layer-display"),R9={};async function CQe(e,t){try{return{data:(await mte(e,t)).data,baseUrl:SK(e),styleUrl:e}}catch(i){return cl(i),null}}function AQe(e,t,i){const r=_(t.portal)?t.portal:Bo.getDefault();let s;const n=`${r.url} - ${r.user&&r.user.username} - ${e}`;return R9[n]||(R9[n]=MQe(e,r,i).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl,styleName:e}))),R9[n]}function MQe(e,t,i){return t.load(i).then(()=>{const r=new D0({disableExtraQuery:!0,query:`owner:${gce} AND type:${yce} AND typekeywords:"${e}"`});return t.queryItems(r,i)}).then(({results:r})=>{let s=null;const n=e.toLowerCase();if(r&&Array.isArray(r)){for(const o of r)if(o.typeKeywords.some(a=>a.toLowerCase()===n)&&o.type===yce&&o.owner===gce){s=o;break}}if(!s)throw new W("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return s.load(i)})}function L2e(e,t,i){return e.styleUrl?CQe(e.styleUrl,i):e.styleName?AQe(e.styleName,t,i):Promise.reject(new W("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function D2e(e){return e===null||e.type==="CIMSymbolReference"?e:{type:"CIMSymbolReference",symbol:e}}function OQe(e,t){if(t==="cimRef")return e.cimRef;if(e.formatInfos&&!EQe()){for(const i of e.formatInfos)if(i.type==="gltf")return i.href}return e.webRef}function mte(e,t){const i=F({responseType:"json",query:{f:"json"}},t);return Zt(Zf(e),i)}const gce="esri_en",yce="Style",RQe="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var HP;const hw=ve.getLogger("esri.renderers.UniqueValueRenderer"),PQe=dn(hz);let gn=HP=class extends yO(Dv){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this.type="unique-value",this.backgroundFillSymbol=null,this.field=null,this.field2=null,this.field3=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.fieldDelimiter=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(t,i){if(!t&&!i)return;if(!t||!i)return{type:"complete",oldValue:t,newValue:i};let r=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const o=t.find(a=>a.value===i[n].value);o?SQe(o,i[n])?(s.changed.push({type:"complete",oldValue:o,newValue:i[n]}),r=!0):s.unchanged.push({oldValue:o,newValue:i[n]}):(s.added.push(i[n]),r=!0)}for(let n=0;n<t.length;n++)i.find(o=>o.value===t[n].value)||(s.removed.push(t[n]),r=!0);return r?s:void 0}},this._set("uniqueValueInfos",[])}get _cache(){return{compiledFunc:null}}castField(e){return e==null||typeof e=="function"?e:nL(e)}writeField(e,t,i,r){typeof e=="string"?t[i]=e:r&&r.messages?r.messages.push(new W("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):hw.error(".field: cannot write field to JSON since it's not a string value")}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}readPortal(e,t,i){return i.portal||Bo.getDefault()}readStyleOrigin(e,t,i){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const r=fv(t.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(e,t,i,r){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=mv(e.styleUrl,r))}set uniqueValueInfos(e){this.styleOrigin?hw.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void hw.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof e=="object"?PQe(e):new hz({value:e,symbol:sbe(t)}),this.uniqueValueInfos.push(i),this._valueInfoMap[i.value]=i}removeUniqueValueInfo(e){if(this.styleOrigin)hw.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(let t=0;t<this.uniqueValueInfos.length;t++)if(this.uniqueValueInfos[t].value===e+""){delete this._valueInfoMap[e],this.uniqueValueInfos.splice(t,1);break}}async getUniqueValueInfo(e,t){let i=t;return this.valueExpression&&(M(t)||M(t.arcade))&&(i=me(F({},i),{arcade:await sm()})),this._getUniqueValueInfo(e,i)}getSymbol(e,t){if(this.valueExpression&&(M(t)||M(t.arcade)))return void hw.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(e,t);return i&&i.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(M(i)||M(i.arcade))){const s=await sm(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i=me(F({},i),{arcade:s})}const r=this._getUniqueValueInfo(e,i);return r&&r.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos)t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${JSON.stringify(this.backgroundFillSymbol)}.${JSON.stringify(this.defaultSymbol)}.${this.uniqueValueInfos.reduce((e,t)=>e+t.getMeshHash(),"")}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const e=new HP({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:ue(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:ue(this.visualVariables),legendOptions:ue(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:ue(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=ue(this.uniqueValueInfos);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(ue(this.styleOrigin))),Object.freeze(t)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(e,t)),zc(e,t,this.valueExpression)];mp(e,t,this.field),mp(e,t,this.field2),mp(e,t,this.field3),await Promise.all(i)}populateFromStyle(){return L2e(this.styleOrigin,{portal:this.portal}).then(e=>{const t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach(i=>{const r=new KS({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==e.data.defaultItem||(this.defaultSymbol=r,this._isDefaultSymbolDerived=!0);const s=new hz({value:i.name,symbol:r});t.push(s),this._valueInfoMap[i.name]=s}),this._set("uniqueValueInfos",Object.freeze(t)),!this.defaultSymbol&&this.uniqueValueInfos.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateValueInfoMap(){this._valueInfoMap={},this.uniqueValueInfos.forEach(e=>this._valueInfoMap[e.value+""]=e)}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=Ye(t,{});let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(e){const t=this.field,i=e.attributes;let r;if(typeof t!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];t&&o.push(i[t]),s&&o.push(i[s]),n&&o.push(i[n]),r=o.join(this.fieldDelimiter||"")}else typeof t=="function"?r=t(e):t&&(r=i[t]);return this._valueInfoMap[r+""]}static fromPortalStyle(e,t){const i=new HP(t&&t.properties);i._set("styleOrigin",Object.freeze({styleName:e})),i._set("portal",t&&t.portal||Bo.getDefault());const r=i.populateFromStyle();return r.catch(s=>{hw.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",s)}),r}static fromStyleUrl(e,t){const i=new HP(t&&t.properties);i._set("styleOrigin",Object.freeze({styleUrl:e}));const r=i.populateFromStyle();return r.catch(s=>{hw.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),r}};u([d({readOnly:!0})],gn.prototype,"_cache",null),u([bt({uniqueValue:"unique-value"})],gn.prototype,"type",void 0),u([d(A2e)],gn.prototype,"backgroundFillSymbol",void 0),u([d({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],gn.prototype,"field",void 0),u([Jt("field")],gn.prototype,"castField",null),u([it("field")],gn.prototype,"writeField",null),u([d({type:String,json:{write:!0}})],gn.prototype,"field2",void 0),u([d({type:String,json:{write:!0}})],gn.prototype,"field3",void 0),u([d({type:String,json:{write:!0}})],gn.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],gn.prototype,"valueExpressionTitle",void 0),u([d({type:gA,json:{write:!0}})],gn.prototype,"legendOptions",void 0),u([d({type:String,json:{write:!0}})],gn.prototype,"defaultLabel",void 0),u([d(nve(F({},AL),{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],gn.prototype,"defaultSymbol",null),u([d({type:String,json:{write:!0}})],gn.prototype,"fieldDelimiter",void 0),u([d({type:Bo,readOnly:!0})],gn.prototype,"portal",void 0),u([De("portal",["styleName"])],gn.prototype,"readPortal",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],gn.prototype,"styleOrigin",void 0),u([De("styleOrigin",["styleName","styleUrl"])],gn.prototype,"readStyleOrigin",null),u([it("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],gn.prototype,"writeStyleOrigin",null),u([d({type:[hz],json:{write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],gn.prototype,"uniqueValueInfos",null),gn=HP=u([L("esri.renderers.UniqueValueRenderer")],gn);const gte=gn,ML={key:"type",base:Dv,typeMap:{heatmap:I2e,simple:fte,"unique-value":gte,"class-breaks":O2e,"dot-density":pQe,dictionary:uQe,"pie-chart":bQe},errorContext:"renderer"},yte={key:"type",base:Dv,typeMap:{simple:fte,"unique-value":gte,"class-breaks":O2e,heatmap:I2e},errorContext:"renderer"};function IQe(e,t){return N2e(e,null,t)}const $Qe=KM({types:ML});function N2e(e,t,i){return e?e&&(e.styleName||e.styleUrl)&&e.type!=="uniqueValue"?(i&&i.messages&&i.messages.push(new Uc("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:i})),null):$Qe(e,t,i):null}class vte{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(KH),this._values=new Map,this.multipleOriginsSupported=!0}clone(t){const i=new vte,r=this._originStores[st.DEFAULTS];r&&r.forEach((s,n)=>{i.set(n,ue(s),st.DEFAULTS)});for(let s=st.SERVICE;s<KH;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{t&&t.has(a)||i.set(a,ue(o),s)})}return i}get(t,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(t):void 0}keys(t){const i=t==null?this._values:this._originStores[t];return i?[...i.keys()]:[]}set(t,i,r=st.USER){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(t,i),!this._values.has(t)||this._propertyOriginMap.get(t)<=r){const n=this._values.get(t);return this._values.set(t,i),this._propertyOriginMap.set(t,r),n!==i}return!1}delete(t,i=st.USER){const r=this._originStores[i];if(!r)return;const s=r.get(t);if(r.delete(t),this._values.has(t)&&this._propertyOriginMap.get(t)===i){this._values.delete(t);for(let n=i-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(t)){this._values.set(t,o.get(t)),this._propertyOriginMap.set(t,n);break}}}return s}has(t,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(t)}revert(t,i){for(;i>0&&!this.has(t,i);)--i;const r=this._originStores[i],s=r&&r.get(t),n=this._values.get(t);return this._values.set(t,s),this._propertyOriginMap.set(t,i),n!==s}originOf(t){return this._propertyOriginMap.get(t)||st.DEFAULTS}forEach(t){this._values.forEach(t)}}const F2e=e=>{let t=class extends e{constructor(...i){super(...i);const r=ho(this),s=r.store,n=new vte;r.store=n,qve(r,s,n)}read(i,r){Zve(this,i,r)}getAtOrigin(i,r){const s=P9(this),n=Hh(r);if(typeof i=="string")return s.get(i,n);const o={};return i.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(i){return C3(this.originIdOf(i))}originIdOf(i){return P9(this).originOf(i)}revert(i,r){const s=P9(this),n=Hh(r),o=ho(this);let a;a=typeof i=="string"?i==="*"?s.keys(n):[i]:i,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return t=u([L("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function P9(e){return ho(e).store}let vce=class extends F2e(Ee){};vce=u([L("esri.core.ReadOnlyMultiOriginJSONSupport")],vce);const LQe=e=>{let t=class extends e{constructor(...i){super(...i)}clear(i,r="user"){return I9(this).delete(i,Hh(r))}write(i={},r){return Yve(this,i=i||{},r),i}setAtOrigin(i,r,s){ho(this).setAtOrigin(i,r,Hh(s))}removeOrigin(i){const r=I9(this),s=Hh(i),n=r.keys(s);for(const o of n)r.originOf(o)===s&&r.set(o,r.get(o,s),st.USER)}updateOrigin(i,r){const s=I9(this),n=Hh(r),o=this.get(i);for(let a=n+1;a<KH;++a)s.delete(i,a);s.set(i,o,n)}toJSON(i){return this.write({},i)}};return t=u([L("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function I9(e){return ho(e).store}const OL=e=>{let t=class extends LQe(F2e(e)){constructor(...i){super(...i)}};return t=u([L("esri.core.MultiOriginJSONSupport")],t),t};let _ce=class extends OL(Ee){};_ce=u([L("esri.core.MultiOriginJSONSupport")],_ce);async function DQe(e,t){const{WhereClause:i}=await Promise.resolve().then(function(){return Ese});return i.create(e,t)}function _te(e,t){return _(e)?_(t)?`(${e}) AND (${t})`:e:t}var EX;let vx=EX=class extends Ce{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new EX({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],vx.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],vx.prototype,"name",void 0),u([d({type:["boolean","date","number","string"],json:{write:!0}})],vx.prototype,"returnType",void 0),u([d({type:String,json:{write:!0}})],vx.prototype,"title",void 0),vx=EX=u([L("esri.form.ExpressionInfo")],vx);const NQe=vx;let _x=class extends Ce{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([d({type:String,json:{write:!0}})],_x.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],_x.prototype,"label",void 0),u([d()],_x.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],_x.prototype,"visibilityExpression",void 0),_x=u([L("esri.form.elements.Element")],_x);const cM=_x;var CX;let L5=CX=class extends Ce{constructor(e){super(e),this.type=null}clone(){return new CX({type:this.type})}};u([d({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],L5.prototype,"type",void 0),L5=CX=u([L("esri.form.elements.inputs.AttachmentInput")],L5);const FQe=L5;var AX;let bx=AX=class extends cM{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new AX({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({type:String,json:{write:!0}})],bx.prototype,"attachmentKeyword",void 0),u([d({type:Boolean,json:{write:!0}})],bx.prototype,"editable",void 0),u([d({type:FQe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],bx.prototype,"input",void 0),u([d({type:["attachment"],json:{read:!1,write:!0}})],bx.prototype,"type",void 0),bx=AX=u([L("esri.form.elements.AttachmentElement")],bx);const bce=bx;let D5=class extends Ce{constructor(e){super(e),this.type=null}};u([d()],D5.prototype,"type",void 0),D5=u([L("esri.form.elements.inputs.Input")],D5);const vO=D5;let qP=class extends vO{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([d({type:Number,json:{write:!0}})],qP.prototype,"maxLength",void 0),u([d({type:Number,json:{write:!0}})],qP.prototype,"minLength",void 0),qP=u([L("esri.form.elements.inputs.TextInput")],qP);const bte=qP;var MX;let N5=MX=class extends bte{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new MX({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["barcode-scanner"],json:{read:!1,write:!0}})],N5.prototype,"type",void 0),N5=MX=u([L("esri.form.elements.inputs.BarcodeScannerInput")],N5);const kQe=N5;var OX;let YE=OX=class extends vO{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="combo-box"}clone(){return new OX({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([d({type:String,json:{write:!0}})],YE.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],YE.prototype,"showNoValueOption",void 0),u([d({type:["combo-box"],json:{read:!1,write:!0}})],YE.prototype,"type",void 0),YE=OX=u([L("esri.form.elements.inputs.ComboBoxInput")],YE);const UQe=YE;var RX;function wce(e){return e!=null?new Date(e):null}function xce(e){return e?e.getTime():null}let of=RX=class extends vO{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return wce(t.max)}writeMax(e,t){t.max=xce(e)}readMin(e,t){return wce(t.min)}writeMin(e,t){t.min=xce(e)}clone(){return new RX({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};u([d({type:Boolean,json:{write:!0}})],of.prototype,"includeTime",void 0),u([d({type:Date,json:{type:Number,write:!0}})],of.prototype,"max",void 0),u([De("max")],of.prototype,"readMax",null),u([it("max")],of.prototype,"writeMax",null),u([d({type:Date,json:{type:Number,write:!0}})],of.prototype,"min",void 0),u([De("min")],of.prototype,"readMin",null),u([it("min")],of.prototype,"writeMin",null),u([d({type:["datetime-picker"],json:{read:!1,write:!0}})],of.prototype,"type",void 0),of=RX=u([L("esri.form.elements.inputs.DateTimePickerInput")],of);const zQe=of;var PX;let JE=PX=class extends vO{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="radio-buttons"}clone(){return new PX({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([d({type:String,json:{write:!0}})],JE.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],JE.prototype,"showNoValueOption",void 0),u([d({type:["radio-buttons"],json:{read:!1,write:!0}})],JE.prototype,"type",void 0),JE=PX=u([L("esri.form.elements.inputs.RadioButtonsInput")],JE);const VQe=JE;var IX;let QE=IX=class extends vO{constructor(e){super(e),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new IX({offValue:this.offValue,onValue:this.onValue})}};u([d({type:[String,Number],json:{write:!0}})],QE.prototype,"offValue",void 0),u([d({type:[String,Number],json:{write:!0}})],QE.prototype,"onValue",void 0),u([d({type:["switch"],json:{read:!1,write:!0}})],QE.prototype,"type",void 0),QE=IX=u([L("esri.form.elements.inputs.SwitchInput")],QE);const BQe=QE;var $X;let F5=$X=class extends bte{constructor(e){super(e),this.type="text-area"}clone(){return new $X({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-area"],json:{read:!1,write:!0}})],F5.prototype,"type",void 0),F5=$X=u([L("esri.form.elements.inputs.TextAreaInput")],F5);const GQe=F5;var LX;let k5=LX=class extends bte{constructor(e){super(e),this.type="text-box"}clone(){return new LX({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-box"],json:{read:!1,write:!0}})],k5.prototype,"type",void 0),k5=LX=u([L("esri.form.elements.inputs.TextBoxInput")],k5);const jQe=k5,HQe={base:vO,key:"type",typeMap:{"barcode-scanner":kQe,"combo-box":UQe,"datetime-picker":zQe,"radio-buttons":VQe,switch:BQe,"text-area":GQe,"text-box":jQe}};var DX;let Id=DX=class extends cM{constructor(e){super(e),this.domain=null,this.editable=!0,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new DX({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([d({types:DTe,json:{read:{reader:Dee},write:!0}})],Id.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],Id.prototype,"editable",void 0),u([d({type:String,json:{write:!0}})],Id.prototype,"editableExpression",void 0),u([d({type:String,json:{write:!0}})],Id.prototype,"fieldName",void 0),u([d({type:String,json:{write:!0}})],Id.prototype,"hint",void 0),u([d({types:HQe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Id.prototype,"input",void 0),u([d({type:String,json:{write:!0}})],Id.prototype,"requiredExpression",void 0),u([d({type:String,json:{read:!1,write:!0}})],Id.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Id.prototype,"valueExpression",void 0),Id=DX=u([L("esri.form.elements.FieldElement")],Id);const Tce=Id;var NX;let e0=NX=class extends cM{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new NX({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:ue(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([d({type:Number,json:{write:!0}})],e0.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],e0.prototype,"displayType",void 0),u([d({type:Boolean,json:{write:!0}})],e0.prototype,"editable",void 0),u([d({type:[W_e],json:{write:!0}})],e0.prototype,"orderByFields",void 0),u([d({type:Number,json:{write:!0}})],e0.prototype,"relationshipId",void 0),u([d({type:["relationship"],json:{read:!1,write:!0}})],e0.prototype,"type",void 0),e0=NX=u([L("esri.form.elements.RelationshipElement")],e0);const Sce=e0;function k2e(e){return{typesWithGroup:{base:cM,key:"type",typeMap:{attachment:bce,field:Tce,group:e,relationship:Sce}},typesWithoutGroup:{base:cM,key:"type",typeMap:{attachment:bce,field:Tce,relationship:Sce}}}}function U2e(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function z2e(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>r[s.type]).map(s=>s.toJSON())}function V2e(e,t,i=!0){return e?e.map(r=>im(i?t.typesWithGroup:t.typesWithoutGroup,r)):null}var FX;let dg=FX=class extends cM{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return V2e(e,$9,!1)}readElements(e,t){return U2e(t.formElements,$9,!1)}writeElements(e,t){t.formElements=z2e(e,$9,!1)}clone(){return new FX({description:this.description,elements:ue(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({json:{write:!0}})],dg.prototype,"elements",void 0),u([Jt("elements")],dg.prototype,"castElements",null),u([De("elements",["formElements"])],dg.prototype,"readElements",null),u([it("elements")],dg.prototype,"writeElements",null),u([d({type:["collapsed","expanded"],json:{write:!0}})],dg.prototype,"initialState",void 0),u([d({type:String,json:{read:!1,write:!0}})],dg.prototype,"type",void 0),dg=FX=u([L("esri.form.elements.GroupElement")],dg);const $9=k2e(dg),qQe=dg;var kX;const L9=k2e(qQe);let Wm=kX=class extends Ce{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.title=null}castElements(e){return V2e(e,L9)}readElements(e,t){return U2e(t.formElements,L9)}writeElements(e,t){t.formElements=z2e(e,L9)}clone(){return new kX({description:this.description,expressionInfos:ue(this.expressionInfos),elements:ue(this.elements),title:this.title})}};u([d({type:String,json:{write:!0}})],Wm.prototype,"description",void 0),u([d({json:{write:!0}})],Wm.prototype,"elements",void 0),u([Jt("elements")],Wm.prototype,"castElements",null),u([De("elements",["formElements"])],Wm.prototype,"readElements",null),u([it("elements")],Wm.prototype,"writeElements",null),u([d({type:[NQe],json:{write:!0}})],Wm.prototype,"expressionInfos",void 0),u([d({type:String,json:{write:!0}})],Wm.prototype,"title",void 0),Wm=kX=u([L("esri.form.FormTemplate")],Wm);const WQe=Wm,ZQe=ve.getLogger("esri.layers.support.fromPortalItem");async function XQe(e){const t="portalItem"in e?e:{portalItem:e},i=await import("./portalLayers.a897ae4e.js");try{return await i.fromItem(t)}catch(r){const s=t&&t.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||or.portalUrl;throw ZQe.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",r),r}}let YQe=0,ta=class extends cs.EventedMixin(ZV(Zg)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new yi(-180,-90,180,90,at.WGS84),this.id=Date.now().toString(16)+"-layer-"+YQe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=at.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const t=typeof e=="string"?{url:e}:e;return(await import("./arcgisLayers.d6a61b13.js")).fromUrl(t)}static fromPortalItem(e){return XQe(e)}initialize(){this.when().catch(e=>{var t,i;as(e)||ve.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${(t=this.title)!=null?t:"no title"}', id: '${(i=this.id)!=null?i:"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,t=this.parent;"layers"in t&&t.layers.includes(e)?t.layers.remove(e):"tables"in t&&t.tables.includes(e)?t.tables.remove(e):"baseLayers"in t&&t.baseLayers.includes(e)?t.baseLayers.remove(e):"baseLayers"in t&&t.referenceLayers.includes(e)&&t.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){const e=this.url;return e?pn(e):null}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Zt(e,{query:{f:"json"},responseType:"json"})).data;throw new W("layer:no-attribution-data","Layer does not have attribution data")}};u([d({type:String})],ta.prototype,"attributionDataUrl",void 0),u([d({type:yi})],ta.prototype,"fullExtent",void 0),u([d({readOnly:!0})],ta.prototype,"hasAttributionData",null),u([d({type:String,clonable:!1})],ta.prototype,"id",void 0),u([d({type:Boolean,nonNullable:!0})],ta.prototype,"legendEnabled",void 0),u([d({type:["show","hide","hide-children"]})],ta.prototype,"listMode",void 0),u([d({type:Number,range:{min:0,max:1},nonNullable:!0})],ta.prototype,"opacity",void 0),u([d({clonable:!1})],ta.prototype,"parent",void 0),u([d({readOnly:!0})],ta.prototype,"parsedUrl",null),u([d({type:Boolean})],ta.prototype,"popupEnabled",void 0),u([d({type:Boolean})],ta.prototype,"attributionVisible",void 0),u([d({type:at})],ta.prototype,"spatialReference",void 0),u([d({type:String})],ta.prototype,"title",void 0),u([d({readOnly:!0,json:{read:!1}})],ta.prototype,"type",void 0),u([d()],ta.prototype,"url",void 0),u([d({type:Boolean,nonNullable:!0})],ta.prototype,"visible",void 0),ta=u([L("esri.layers.Layer")],ta);const _S=ta;function Ece(e,t,i){if(e.hasM==null||e.hasZ)for(const r of t)for(const s of r)s.length>2&&(s[2]*=i)}function JQe(e,t,i){if(!e&&!t||!i)return;const r=rd(i);Cce(e,i,r),Cce(t,i,r)}function Cce(e,t,i){if(e)for(const r of e)QQe(r.geometry,t,i)}function QQe(e,t,i){if(M(e)||!e.spatialReference||_a(e.spatialReference,t))return;const r=rd(e.spatialReference)/i;if(r!==1){if("x"in e)e.z!=null&&(e.z*=r);else if("rings"in e)Ece(e,e.rings,r);else if("paths"in e)Ece(e,e.paths,r);else if("points"in e&&(e.hasM==null||e.hasZ))for(const s of e.points)s.length>2&&(s[2]*=r)}}let KQe=0;const D9=ve.getLogger("esri.layers.graphics.sources.MemorySource");let w0=class extends Zg.LoadableMixin(nB(pm(nt))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=_(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get workerGeometryType(){var t;const e=(t=this.layer)==null?void 0:t.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,t={}){await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);$Z(e,this.layer.spatialReference,i);const r=GB.fromJSON(i);if(!this._requiresClientGraphicMapping())return r;const s=this.layer.objectIdField;for(const n of r.features){const o=n.attributes[s],a=this._idToClientGraphic.get(o);a&&(n.geometry=a.geometry)}return r.geometryType=this.layer.geometryType,r}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())throw new W("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return $Z(e,this.layer.spatialReference,i),i}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t)).then(i=>({count:i.count,extent:yi.fromJSON(i.extent)}))}querySnapping(e,t={}){return this.load(t).then(()=>this._connection.invoke("querySnapping",e,t))}async _applyEdits(e){if(!this._connection)throw new W("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let i=null;const r=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const n=c=>"objectId"in c&&c.objectId!=null?c.objectId:"attributes"in c&&c.attributes[t]!=null?c.attributes[t]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const c of e.deleteFeatures){const h=n(c);h!=null&&r.push(h)}const o=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const c of e.updateFeatures)if(s.push(this._serializeFeature(c)),o){const h=n(c);h!=null&&o.set(h,c)}}JQe(i?i.features:null,s,this.layer.spatialReference);const{fullExtent:a,featureEditResults:l}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:s,deletes:r});return this.fullExtent=a,i&&i.finish(l.uidToObjectId),this._updateClientGraphicIds(o,l),this._createEditsResult(l)}async _prepareClientMapping(e,t){if(this.layerOrSourceGeometryType!=="mesh"||M(e))return;const i=[];for(const{geometry:r}of e)!_(r)||r.type!=="mesh"||r.hasExtent||r.loaded||i.push(r.load({signal:t}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,t){if(this._idToClientGraphic){if(e)for(const i of t.updateResults){if(!i.success)continue;const r=e.get(i.objectId);r!=null&&this._addIdToClientGraphic(r)}for(const i of t.deleteResults)i.success&&this._idToClientGraphic.delete(i.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new W("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,i=new Array(e.length);let r=null;for(let n=0;n<e.length;n++){const o=e[n],a=this._serializeFeature(o);!r&&_(o.geometry)&&(r=o.geometry.type),i[n]=a,t.set(`${a.uid}`,o)}const s=this;return{features:i,inferredGeometryType:r,finish(n){const o=s.sourceJSON.objectIdField;for(const a in n){const l=n[a],c=t.get(a);c&&(c.attributes||(c.attributes={}),l===-1?delete c.attributes[o]:c.attributes[o]=l,s._addIdToClientGraphic(c))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[t];i!=null&&this._idToClientGraphic.set(i,e)}get layerOrSourceGeometryType(){var e,t,i;return(i=(e=this.layer)==null?void 0:e.geometryType)!=null?i:(t=this.sourceJSON)==null?void 0:t.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this.layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:t}=e,i=this._geometryForSerialization(e),r=(KQe++).toString();return i?{uid:r,geometry:i.toJSON(),attributes:t}:{uid:r,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return M(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?Uo.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await pbe("MemorySourceWorker",{strategy:ye("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:i,objectIdField:r,hasM:s,hasZ:n,timeInfo:o}=this.layer,a=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const l=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",f=>{D9.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),f.preventDefault()}));const c={features:l.features,fields:t&&t.map(f=>f.toJSON()),geometryType:goe.toJSON(this.workerGeometryType),hasM:this.layerOrSourceGeometryType!=="mesh"&&s,hasZ:this.layerOrSourceGeometryType==="mesh"||n,objectIdField:r,spatialReference:a?null:i&&i.toJSON(),timeInfo:o?o.toJSON():null},h=await this._connection.invoke("load",c,{signal:e});for(const f of h.warnings)D9.warn(f.message,{layer:this.layer,warning:f});h.featureErrors.length&&D9.warn(`Encountered ${h.featureErrors.length} validation errors while loading features`,h.featureErrors);const p=h.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(l.inferredGeometryType)&&(p.geometryType=goe.toJSON(l.inferredGeometryType)),this.sourceJSON=p,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),l.finish(h.assignedObjectIds)}};u([iK({Type:Ha,ensureType:dn(Ha)})],w0.prototype,"itemType",void 0),u([d()],w0.prototype,"type",void 0),u([d({constructOnly:!0})],w0.prototype,"layer",void 0),u([d({readOnly:!0})],w0.prototype,"workerGeometryType",null),u([d()],w0.prototype,"sourceJSON",void 0),w0=u([L("esri.layers.graphics.sources.MemorySource")],w0);function eKe(e){return"portalItem"in e}const wte=e=>{let t=class extends e{get apiKey(){var i;return this._isOverridden("apiKey")?this._get("apiKey"):eKe(this)?(i=this.portalItem)==null?void 0:i.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([d({type:String})],t.prototype,"apiKey",null),t=u([L("esri.layers.mixins.APIKeyMixin")],t),t},B2e={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},G2e=Object.values(B2e),j2e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${G2e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),tKe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${G2e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),iKe=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function rKe(e){return!!j2e.test(e)}function bv(e){if(M(e))return null;const t=pn(e),i=t.path.match(j2e)||t.path.match(tKe);if(!i)return null;const[,r,s,n,o]=i,a=s.indexOf("/");return{title:JB(a!==-1?s.slice(a+1):s),serverType:B2e[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function sKe(e){const t=pn(e).path.match(iKe);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function JB(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function H2e(e,t){const i=[];if(e){const r=bv(e);_(r)&&r.title&&i.push(r.title)}if(t){const r=JB(t);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function xte(e){if(!e)return!1;const t=".arcgis.com/",i="//services",r="//tiles",s="//features",n=(e=e.toLowerCase()).includes(t),o=e.includes(i)||e.includes(r)||e.includes(s);return n&&o}function nKe(e,t){return e&&S1e(E1e(e,t))}function q2e(e){let{url:t}=e;if(!t)return{url:t};t=E1e(t,e.logger);const i=pn(t),r=bv(i.path);let s;if(_(r))r.sublayer!=null&&e.layer.layerId==null&&(s=r.sublayer),t=r.url.path;else if(e.nonStandardUrlAllowed){const n=sKe(i.path);_(n)&&(t=n.serviceUrl,s=n.sublayerId)}return{url:S1e(t),layerId:s}}function W2e(e,t,i,r,s){Ab(t,r,"url",s),r.url&&e.layerId!=null&&(r.url=Bc(r.url,i,e.layerId.toString()))}function s5t(e){if(!e)return!1;const t=e.toLowerCase(),i=t.includes("/services/"),r=t.includes("/mapserver/wmsserver"),s=t.includes("/imageserver/wmsserver"),n=t.includes("/wmsserver");return i&&(r||s||n)}const Tte=e=>{let t=class extends e{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=bv(this.url);if(_(i)&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",nKe(i,ve.getLogger(this.declaredClass)))}};return u([d()],t.prototype,"title",null),u([d({type:String})],t.prototype,"url",null),t=u([L("esri.layers.mixins.ArcGISService")],t),t},Ace={read:{reader:Ree},write:{allowNull:!0,writer:Pee}},Ste=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([d({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],t.prototype,"blendMode",void 0),u([d({json:{read:!1,write:!1,origins:{"web-map":Ace,"portal-item":Ace}}})],t.prototype,"effect",void 0),t=u([L("esri.layers.mixins.BlendLayer")],t),t},Z2e=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return u([d({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],t.prototype,"customParameters",void 0),t=u([L("esri.layers.mixins.CustomParametersMixin")],t),t};var UX;const N9=new Ti({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),F9=new Ti({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Zm=UX=class extends Ce{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new Ou(F({geometry:ue(i),objectIds:ue(n),spatialRelationship:r,timeExtent:ue(s),where:t,units:o,distance:a},e))}clone(){const{where:e,geometry:t,spatialRelationship:i,timeExtent:r,objectIds:s,units:n,distance:o}=this;return new UX({geometry:ue(t),objectIds:ue(s),spatialRelationship:i,timeExtent:ue(r),where:e,units:n,distance:o})}};u([d({type:String,json:{write:!0}})],Zm.prototype,"where",void 0),u([d({types:qS,json:{write:!0}})],Zm.prototype,"geometry",void 0),u([d({type:N9.apiValues,json:{name:"spatialRel",read:{reader:N9.read},write:{allowNull:!1,writer:N9.write,overridePolicy(){return{enabled:_(this.geometry)}}}}})],Zm.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{write:{overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],Zm.prototype,"distance",void 0),u([d({type:[Number],json:{write:!0}})],Zm.prototype,"objectIds",void 0),u([d({type:F9.apiValues,json:{read:F9.read,write:{writer:F9.write,overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],Zm.prototype,"units",void 0),u([d({type:py,json:{write:!0}})],Zm.prototype,"timeExtent",void 0),Zm=UX=u([L("esri.layers.support.FeatureFilter")],Zm);const oKe=Zm;var zX;const Mce={read:{reader:Ree},write:{writer:Pee,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},Oce={read:{reader:Ree},write:{writer:Pee,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},Rce={name:"showExcludedLabels",default:!0};let wx=zX=class extends Ce{constructor(e){super(e),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(e,t){var r,s;const i=super.write(e,t);if(t==null?void 0:t.origin){if(i.filter){const n=Object.keys(i.filter);if(n.length>1||n[0]!=="where")return(r=t.messages)==null||r.push(new W("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}if("showExcludedLabels"in i)return(s=t.messages)==null||s.push(new W("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return i}clone(){return new zX({filter:_(this.filter)&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([d({type:oKe,json:{write:{allowNull:!0,writer(e,t,i,r){const s=e==null?void 0:e.write({},r);s&&Object.keys(s).length!==0?Bu(i,s,t):Bu(i,null,t)}}}})],wx.prototype,"filter",void 0),u([d({json:{write:!0,origins:{"web-map":Mce,"portal-item":Mce}}})],wx.prototype,"includedEffect",void 0),u([d({json:{write:!0,origins:{"web-map":Oce,"portal-item":Oce}}})],wx.prototype,"excludedEffect",void 0),u([d({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":Rce,"portal-item":Rce}}})],wx.prototype,"excludedLabelsVisible",void 0),wx=zX=u([L("esri.layers.support.FeatureEffect")],wx);const aKe=wx,Pce={write:{allowNull:!0}},lKe=e=>{let t=class extends e{constructor(){super(...arguments),this.featureEffect=null}};return u([d({type:aKe,json:{origins:{"web-map":Pce,"portal-item":Pce}}})],t.prototype,"featureEffect",void 0),t=u([L("esri.layers.mixins.FeatureEffectLayer")],t),t},cKe={"web-scene/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,OGCFeatureLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0}};function uKe(e){if(!e)return e;const{start:t,end:i}=e;return new py({start:_(t)?gp(t,-t.getTimezoneOffset(),"minutes"):t,end:_(i)?gp(i,-i.getTimezoneOffset(),"minutes"):i})}function hKe(e){if(!e)return e;const{start:t,end:i}=e;return new py({start:_(t)?gp(t,t.getTimezoneOffset(),"minutes"):t,end:_(i)?gp(i,i.getTimezoneOffset(),"minutes"):i})}var VX;let WP=VX=class extends Ce{async collectRequiredFields(e,t){return zc(e,t,this.expression)}clone(){return new VX({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};u([d({type:String,json:{write:!0}})],WP.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],WP.prototype,"title",void 0),WP=VX=u([L("esri.layers.support.FeatureExpressionInfo")],WP);const Ice=WP;function dKe(e){return aM[e]!=null}function X2e(e){return 1/(aM[e]||1)}function pKe(){const e=Object.keys(aM);return e.sort(),e}const fKe=pKe();var BX;const pN=ml()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),$ce=new Ti({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let t0=BX=class extends Ce{constructor(){super(...arguments),this.offset=null}readFeatureExpressionInfo(e,t){return e!=null?e:t.featureExpression&&t.featureExpression.value===0?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,i,r){t[i]=e.write({},r),e.expression==="0"&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):_(e)||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new BX({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&z4e(this.featureExpressionInfo,e.featureExpressionInfo)}};u([d({type:Ice,json:{write:!0}})],t0.prototype,"featureExpressionInfo",void 0),u([De("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],t0.prototype,"readFeatureExpressionInfo",null),u([it("featureExpressionInfo",{featureExpressionInfo:{type:Ice},"featureExpression.value":{type:[0]}})],t0.prototype,"writeFeatureExpressionInfo",null),u([d({type:pN.apiValues,nonNullable:!0,json:{type:pN.jsonValues,read:pN.read,write:{writer:pN.write,isRequired:!0}}})],t0.prototype,"mode",null),u([d({type:Number,json:{write:!0}})],t0.prototype,"offset",void 0),u([d({type:fKe,json:{type:String,read:$ce.read,write:$ce.write}})],t0.prototype,"unit",null),t0=BX=u([L("esri.layers.support.ElevationInfo")],t0);const Y2e=t0,J2e={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},RL={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,i){t[i]=!e}}}},QB={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},Ete={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:Ab}}},Q2e={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},K2e={value:null,type:Y2e,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function n5t(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const U5={type:Number,json:{origins:{"web-document":{write:!0,read:!0},"portal-item":{write:!0}}}},mKe=me(F({},U5),{json:me(F({},U5.json),{origins:{"web-document":me(F({},U5.json.origins["web-document"]),{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,i)=>i&&i.origin!=="service"||!t.drawingInfo||t.drawingInfo.transparency===void 0?t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.transparency!==void 0?ZA(t.layerDefinition.drawingInfo.transparency):void 0:ZA(t.drawingInfo.transparency)}})}),gKe={type:py,readOnly:!0,get(){var a,l;if(!((a=this.layer)==null?void 0:a.timeInfo))return null;const{datesInUnknownTimezone:e,timeOffset:t,useViewTime:i}=this.layer,r=(l=this.view)==null?void 0:l.timeExtent;let s=this.layer.timeExtent;e&&(s=hKe(s));let n=i?r&&s?r.intersection(s):r||s:s;if(!n||n.isEmpty||n.isAllTime)return n;t&&(n=n.offset(-t.value,t.unit)),e&&(n=uKe(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},o5t={type:yi,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const i=yi.fromJSON(e);return t.spatialReference!=null&&typeof t.spatialReference=="object"&&(i.spatialReference=at.fromJSON(t.spatialReference)),i}}}},read:!1}},Cte={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},yKe={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},vKe={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},eEe={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},Ate=e=>{let t=class extends e{constructor(){super(...arguments),this.title=null}writeListMode(i,r,s,n){(n&&n.layerContainerType==="ground"||i&&jke(this,s,{},n))&&(r[s]=i)}writeOperationalLayerType(i,r,s,n){!i||n&&n.layerContainerType==="tables"||(r.layerType=i)}writeTitle(i,r){r.title=i||"Layer"}read(i,r){r&&(r.layer=this),zke(this,i,s=>super.read(i,s),r)}write(i,r){var o,a;if(r==null?void 0:r.origin){const l=`${r.origin}/${r.layerContainerType||"operational-layers"}`,c=cKe[l];let h=c&&c[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),!h)return(o=r.messages)==null||o.push(new W("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(i,me(F({},r),{layer:this})),n=!!r&&!!r.messages&&!!r.messages.filter(l=>l instanceof W&&l.name==="web-document-write:property-required").length;return Cb(s==null?void 0:s.url)?((a=r==null?void 0:r.messages)==null||a.push(new W("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([d({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),u([d(eEe)],t.prototype,"listMode",void 0),u([it("listMode")],t.prototype,"writeListMode",null),u([d({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),u([it("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),u([d(U5)],t.prototype,"opacity",void 0),u([d({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),u([it([void 0,"web-scene"],"title")],t.prototype,"writeTitle",null),u([d({type:Boolean,json:{name:"visibility"}})],t.prototype,"visible",void 0),t=u([L("esri.layers.mixins.OperationalLayer")],t),t};var GX;const k9=new Ti({asc:"ascending",desc:"descending"});let KE=GX=class extends Ce{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new GX({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([d({type:String,json:{write:!0}})],KE.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],KE.prototype,"valueExpression",void 0),u([d({type:k9.apiValues,json:{read:k9.read,write:k9.write}})],KE.prototype,"order",void 0),KE=GX=u([L("esri.layers.support.OrderByInfo")],KE);const tEe=KE;function _Ke(e,t,i){if(!e)return null;const r=e.find(n=>!!n.field);if(!r)return null;const s=new tEe;return s.read(r,i),[s]}function bKe(e,t,i,r){const s=e.find(n=>!!n.field);s&&Bu(i,[s.toJSON()],t)}const wKe=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return u([d({type:[tEe],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:_Ke},write:{target:"layerDefinition.orderBy",writer:bKe}}})],t.prototype,"orderBy",void 0),t=u([L("esri.layers.mixins.OrderedLayer")],t),t},xKe=ve.getLogger("esri.portal.PortalItemResource");let J_=class extends Ee{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?me(F({},e),{path:this._normalizePath(e.path,e.portalItem)}):e}set path(e){_(e)&&Nu(e)?xKe.error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const i=this.url;if(M(i))throw new W("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal._request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:Wr(t,"signal")})}async update(e,t){return(await Promise.resolve().then(function(){return EI})).addOrUpdateResource(this,"update",e,t)}hasPath(){return _(this.path)}_normalizePath(e,t){return M(e)?e:(e=e.replace(/^\/+/,""),_(t)&&Nu(e)&&(e=wK(e,t.itemUrl)),e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([d()],J_.prototype,"portalItem",void 0),u([d({type:String,value:null})],J_.prototype,"path",null),u([Jt("path")],J_.prototype,"_castPath",null),u([d({type:String,readOnly:!0})],J_.prototype,"url",null),u([d({type:String,readOnly:!0})],J_.prototype,"itemRelativeUrl",null),J_=u([L("esri.portal.PortalItemResource")],J_);const TKe=J_;let ZP=class extends Ee{constructor(e){super(e),this.created=null,this.rating=null}};u([d()],ZP.prototype,"created",void 0),u([d()],ZP.prototype,"rating",void 0),ZP=u([L("esri.portal.PortalRating")],ZP);const U9=ZP;var eC;let Mi=eC=class extends eO(Zg){constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}static from(e){return xb(eC,e)}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let i=e;return e==="Feature Service"||e==="Feature Collection"?i=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":e==="Image Service"?i=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":e==="Scene Service"?i="Scene Layer":e==="Video Service"?i="Video Layer":e==="Scene Package"?i="Scene Layer Package":e==="Stream Service"?i="Feature Layer":e==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?i=t.includes("Web Tool")?"Tool":"Geoprocessing Service":e==="Geocoding Service"?i="Locator":e==="Geoenrichment Service"?i="GeoEnrichment Service":e==="Microsoft Powerpoint"?i="Microsoft PowerPoint":e==="GeoJson"?i="GeoJSON":e==="Globe Service"?i="Globe Layer":e==="Vector Tile Service"?i="Tile Layer":e==="netCDF"?i="NetCDF":e==="Map Service"?i=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e&&e.toLowerCase().includes("add in")?i=e.replace(/(add in)/gi,"Add-In"):e==="datastore catalog service"?i="Big Data File Share":e==="Compact Tile Package"?i="Tile Package (tpkx)":e==="OGCFeatureServer"?i="OGC Feature Layer":e==="web mapping application"&&t.includes("configurableApp")&&(i="Instant App"),i}readExtent(e){return e&&e.length?new yi(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type&&this.type.toLowerCase()||"",t=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return e.indexOf("service")>0||e==="feature collection"||e==="kml"||e==="wms"||e==="wmts"||e==="wfs"?(n=t.includes("Hosted Service"),e==="feature service"||e==="feature collection"||e==="kml"||e==="wfs"?(o=t.includes("Table"),a=t.includes("Route Layer"),l=t.includes("Markup"),c=t.includes("Spatiotemporal"),h=t.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":h?"utilitynetwork":"features"):s=e==="map service"||e==="wms"||e==="wmts"?n||t.includes("Tiled")||e==="wmts"?"maptiles":"mapimages":e==="scene service"?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":e==="image service"?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":e==="stream service"?"streamlayer":e==="video service"?"mediaservice":e==="vector tile service"?"vectortile":e==="datastore catalog service"?"datastorecollection":e==="geocoding service"?"geocodeservice":e==="geoprocessing service"?t.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":e==="geodata service"?"geodataservice":"layers"):s=e==="web map"||e==="cityengine web scene"?"maps":e==="web scene"?t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":e==="web mapping application"&&t.includes("configurableApp")?"instantapps":e==="web mapping application"||e==="mobile application"||e==="application"||e==="operation view"||e==="desktop application"?"apps":e==="map document"||e==="map package"||e==="published map"||e==="scene document"||e==="globe document"||e==="basemap package"||e==="mobile basemap package"||e==="mobile map package"||e==="project package"||e==="project template"||e==="pro map"||e==="layout"||e==="layer"&&t.includes("ArcGIS Pro")||e==="explorer map"&&t.indexOf("Explorer Document")?"mapsgray":e==="service definition"||e==="csv"||e==="shapefile"||e==="cad drawing"||e==="geojson"||e==="360 vr experience"||e==="netcdf"||e==="administrative report"?"datafiles":e==="explorer add in"||e==="desktop add in"||e==="windows viewer add in"||e==="windows viewer configuration"?"appsgray":e==="arcgis pro add in"||e==="arcgis pro configuration"?"addindesktop":e==="rule package"||e==="file geodatabase"||e==="sqlite geodatabase"||e==="csv collection"||e==="kml collection"||e==="windows mobile package"||e==="map template"||e==="desktop application template"||e==="gml"||e==="arcpad package"||e==="code sample"||e==="form"||e==="document link"||e==="earth configuration"||e==="operations dashboard add in"||e==="rules package"||e==="image"||e==="workflow manager package"||e==="explorer map"&&t.includes("Explorer Mapping Application")||t.includes("Document")?"datafilesgray":e==="network analysis service"||e==="geoprocessing service"||e==="geodata service"||e==="geometry service"||e==="geoprocessing package"||e==="locator package"||e==="geoprocessing sample"||e==="workflow manager service"?"toolsgray":e==="layer"||e==="layer package"||e==="explorer layer"?"layersgray":e==="scene package"?"scenepackage":e==="mobile scene package"?"mobilescenepackage":e==="tile package"||e==="compact tile package"?"tilepackage":e==="task file"?"taskfile":e==="report template"?"report-template":e==="statistical data collection"?"statisticaldatacollection":e==="insights workbook"?"workbook":e==="insights model"?"insightsmodel":e==="insights page"?"insightspage":e==="insights theme"?"insightstheme":e==="hub initiative"?"hubinitiative":e==="hubpage"?"hubpage":e==="hub event"?"hubevent":e==="hub site application"?"hubsite":e==="hub project"?"hubproject":e==="relational database connection"?"relationaldatabaseconnection":e==="big data file share"?"datastorecollection":e==="image collection"?"imagecollection":e==="style"?"style":e==="desktop style"?"desktopstyle":e==="dashboard"?"dashboard":e==="raster function template"?"rasterprocessingtemplate":e==="vector tile package"?"vectortilepackage":e==="ortho mapping project"?"orthomappingproject":e==="ortho mapping template"?"orthomappingtemplate":e==="solution"?"solutions":e==="geopackage"?"geopackage":e==="deep learning package"?"deeplearningpackage":e==="real time analytic"?"realtimeanalytics":e==="big data analytic"?"bigdataanalytics":e==="feed"?"feed":e==="excalibur imagery project"?"excaliburimageryproject":e==="notebook"?"notebook":e==="storymap"?"storymap":e==="survey123 add in"?"survey123addin":e==="mission"?"mission":e==="mission report"?"missionreport":e==="quickcapture project"?"quickcaptureproject":e==="pro report"?"proreport":e==="urban model"?"urbanmodel":e==="web experience"?"experiencebuilder":e==="web experience template"?"webexperiencetemplate":e==="experience builder widget"?"experiencebuilderwidget":e==="experience builder widget package"?"experiencebuilderwidgetpackage":e==="workflow"?"workflow":e==="insights script"?"insightsscript":e==="kernel gateway connection"?"kernelgatewayconnection":e==="hub initiative template"?"hubinitiativetemplate":e==="storymap theme"?"storymaptheme":e==="knowledge graph"?"knowledgegraph":e==="native application"?"nativeapp":e==="native application installer"?"nativeappinstaller":e==="link chart"?"linkchart":e==="investigation"?"investigation":e==="ogcfeatureserver"?"features":e==="pro project"?"proproject":e==="insights workbook package"?"insightsworkbookpackage":e==="apache parquet"?"apacheparquet":e==="notebook code snippets"?"notebookcodesnippets":e==="suitability model"?"suitabilitymodel":e==="esri classifier definition"?"classifierdefinition":e==="esri classification schema"?"classificationschema":e==="insights data engineering workbook"?"dataengineeringworkbook":e==="insights data engineering model"?"dataengineeringmodel":e==="deep learning studio project"?"deeplearningproject":"maps",s?ji(i+s+r+".png"):null}get isLayer(){return["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","WMTS","WMS"].includes(this.type)}get itemUrl(){const e=this.get("portal.restUrl");return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userItemUrl(){const e=this.get("portal.restUrl");if(!e)return null;const t=this.owner||this.get("portal.user.username");return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){this.portal||(this.portal=Bo.getDefault());const t=this.portal.load(e).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?this.portal._request(this.itemUrl,{signal:_(e)?e.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(t),Promise.resolve(this)}addRating(e){const t={method:"post",query:{}};return e instanceof U9&&(e=e.rating),isNaN(e)||typeof e!="number"||(t.query.rating=e),this.portal._request(this.itemUrl+"/addRating",t).then(()=>new U9({rating:e,created:new Date}))}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:ue(this.applicationProxies),avgRating:this.avgRating,categories:ue(this.categories),created:ue(this.created),culture:this.culture,description:this.description,extent:ue(this.extent),groupCategories:ue(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ue(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ue(this.screenshots),size:this.size,snippet:this.snippet,spatialReference:this.spatialReference,tags:ue(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ue(this.typeKeywords),url:this.url};return this.loaded&&(e.loadStatus="loaded"),new eC({sourceJSON:this.sourceJSON}).set(e)}createPostQuery(){const e=this.toJSON();for(const i of["tags","typeKeywords","categories"])e[i]&&(e[i]=e[i].join(", "));const{extent:t}=e;return t&&(e.extent=JSON.stringify(t)),e}deleteRating(){return this.portal._request(this.itemUrl+"/deleteRating",{method:"post"}).then(()=>{})}fetchData(e="json",t){return this.portal._request(this.itemUrl+"/data",me(F({responseType:e},t),{query:{token:this.apiKey}}))}fetchRating(e){return this.portal._request(this.itemUrl+"/rating",F({query:{token:this.apiKey}},e)).then(t=>t.rating!=null?(t.created=new Date(t.created),new U9(t)):null)}fetchRelatedItems(e,t){return this.portal._requestToTypedArray(this.itemUrl+"/relatedItems",F({query:me(F({},e),{token:this.apiKey})},t),eC)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal._request(this.itemUrl,{cacheBust:!0,query:{token:this.apiKey}}).then(e=>(this.sourceJSON=e,this.read(e),this))}update(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e&&e.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,t!=null&&(typeof t=="string"?i.query.text=t:typeof t=="object"&&(i.query.text=JSON.stringify(t))),this.portal._request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new W("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}updateThumbnail(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e.thumbnail,i=e.filename,r={method:"post"};if(typeof t=="string")uy(t)?r.query={data:t}:r.query={url:Wh(t)},_(i)&&(r.query.filename=i);else{const s=new FormData;_(i)?s.append("file",t,i):s.append("file",t),r.body=s}return this.portal._request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new W("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){return(await Promise.resolve().then(function(){return EI})).fetchResources(this,e,t)}async addResource(e,t,i){const r=await Promise.resolve().then(function(){return EI});return e.portalItem=this,r.addOrUpdateResource(e,"add",t,i)}async removeResource(e,t){const i=await Promise.resolve().then(function(){return EI});if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new W("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i.removeResource(this,e,t)}async removeAllResources(e){return(await Promise.resolve().then(function(){return EI})).removeAllResources(this,e)}resourceFromPath(e){return new TKe({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:ue(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,spatialReference:this.spatialReference,tags:ue(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ue(this.typeKeywords),url:this.url};return eve(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new eC({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)t==="tags"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="typeKeywords"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="extent"&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};u([d({type:["private","shared","org","public"]})],Mi.prototype,"access",void 0),u([d()],Mi.prototype,"accessInformation",void 0),u([d({type:String})],Mi.prototype,"apiKey",void 0),u([d({json:{read:{source:"appProxies"}}})],Mi.prototype,"applicationProxies",void 0),u([d()],Mi.prototype,"avgRating",void 0),u([d()],Mi.prototype,"categories",void 0),u([d({type:Date})],Mi.prototype,"created",void 0),u([d()],Mi.prototype,"culture",void 0),u([d()],Mi.prototype,"description",void 0),u([d({readOnly:!0})],Mi.prototype,"displayName",null),u([d({type:yi})],Mi.prototype,"extent",void 0),u([De("extent")],Mi.prototype,"readExtent",null),u([d()],Mi.prototype,"groupCategories",void 0),u([d({readOnly:!0})],Mi.prototype,"iconUrl",null),u([d()],Mi.prototype,"id",void 0),u([d({readOnly:!0})],Mi.prototype,"isLayer",null),u([d()],Mi.prototype,"itemControl",void 0),u([d({readOnly:!0})],Mi.prototype,"itemUrl",null),u([d()],Mi.prototype,"licenseInfo",void 0),u([d({type:Date})],Mi.prototype,"modified",void 0),u([d()],Mi.prototype,"name",void 0),u([d()],Mi.prototype,"numComments",void 0),u([d()],Mi.prototype,"numRatings",void 0),u([d()],Mi.prototype,"numViews",void 0),u([d()],Mi.prototype,"owner",void 0),u([d()],Mi.prototype,"ownerFolder",void 0),u([d({type:Bo})],Mi.prototype,"portal",void 0),u([d()],Mi.prototype,"screenshots",void 0),u([d()],Mi.prototype,"size",void 0),u([d()],Mi.prototype,"snippet",void 0),u([d()],Mi.prototype,"sourceJSON",void 0),u([d({type:String})],Mi.prototype,"spatialReference",void 0),u([d()],Mi.prototype,"tags",void 0),u([d()],Mi.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Mi.prototype,"thumbnailUrl",null),u([d()],Mi.prototype,"title",void 0),u([d()],Mi.prototype,"type",void 0),u([d()],Mi.prototype,"typeKeywords",void 0),u([d({type:String,json:{read(e,t){var r;if(t.type!=="KML")return e;const i=(r=this.portal)==null?void 0:r.restUrl;return e||(e=i&&this.id?`${i}/content/items/${this.id}/data`:null),e}}})],Mi.prototype,"url",void 0),u([d({readOnly:!0})],Mi.prototype,"userItemUrl",null),Mi=eC=u([L("esri.portal.PortalItem")],Mi);const uM=Mi;var iEe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:uM});const SKe=ve.getLogger("esri.layers.mixins.PortalLayer"),Mte=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0}destroy(){var i;(i=this.portalItem)==null||i.destroy(),this.portalItem=null}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,s){if(r.itemId)return new uM({id:r.itemId,portal:s&&s.portal})}writePortalItem(i,r){i&&i.id&&(r.itemId=i.id)}async loadFromPortal(i,r){if(this.portalItem&&this.portalItem.id)try{const s=await import("./layersLoader.6c8b0171.js").then(function(n){return n.l});return qt(r),await s.load({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData},r)}catch(s){throw as(s)||SKe.warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(cl(r),!0)))}async _fetchUserHasEditingPrivileges(i){const r=this.url?Es==null?void 0:Es.findCredential(this.url):null;if(!r)return!0;const s=fN.credential===r?fN.user:await this._fetchEditingUser(i);return fN.credential=r,fN.user=s,M(s)||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(i){var h,p;const r=(p=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:p.user;if(r)return r;const s=Es.findServerInfo(this.url);if(!(s==null?void 0:s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=Bo.getDefault();if(o&&o.loaded&&Zf(o.restUrl)===Zf(n))return o.user;const a=`${n}/community/self`,l=_(i)?i.signal:null,c=await Hu(Zt(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?MK.fromJSON(c.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){const s=r&&r.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||Bo.getDefault());return s&&n&&!b1e(n.restUrl,s.restUrl)?(r.messages&&r.messages.push(new W("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,me(F({},r),{layer:this}))}};return u([d({type:uM})],t.prototype,"portalItem",null),u([De("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),u([it("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),u([d({clonable:!1})],t.prototype,"resourceReferences",void 0),u([d({readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),t=u([L("esri.layers.mixins.PortalLayer")],t),t},fN={credential:null,user:null},e$=new nt,ZI=new WeakMap;function EKe(e){rEe(e)&&e$.push(e)}function CKe(e){rEe(e)&&e$.includes(e)&&e$.remove(e)}function rEe(e){return e&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function sEe(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:sEe(t,e%t):0}let z9=0,mN=0;function AKe(){var t;const e=Date.now();for(const i of e$)i.refreshInterval&&e-((t=ZI.get(i))!=null?t:0)+5>=6e4*i.refreshInterval&&(ZI.set(i,e),i.refresh(e))}$ve(()=>{const e=Date.now();let t=0;for(const i of e$)t=sEe(Math.round(6e4*i.refreshInterval),t),i.refreshInterval?ZI.get(i)||ZI.set(i,e):ZI.delete(i);if(t!==mN){if(mN=t,clearInterval(z9),mN===0)return void(z9=0);z9=setInterval(AKe,mN)}});function MKe(e){return e&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}const nEe=e=>{let t=class extends e{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=UV(()=>this.hasDataChanged()),this.when().then(()=>{EKe(this)},()=>{})}destroy(){CKe(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){VA(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{ve.getLogger(this.declaredClass).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}};return u([d({type:Number,cast:i=>i>=.1?i:i<=0?0:.1,json:{write:!0}})],t.prototype,"refreshInterval",void 0),u([d({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),u([d()],t.prototype,"refreshParameters",null),t=u([L("esri.layers.mixins.RefreshableLayer")],t),t},KB=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&OKe(i,r.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===i.minScale&&s.maxScale===i.maxScale?s:i}};return u([d({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),u([d({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=u([L("esri.layers.mixins.ScaleRangeLayer")],t),t};function OKe(e,t){return e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale,e}const PT=ml()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});var jX;let XP=jX=class extends Ce{constructor(e){super(e),this.value=0,this.unit="milliseconds"}toMilliseconds(){return tb(this.value,this.unit,"milliseconds")}clone(){return new jX({value:this.value,unit:this.unit})}};u([d({type:Number,json:{write:!0},nonNullable:!0})],XP.prototype,"value",void 0),u([d({type:PT.apiValues,json:{type:PT.jsonValues,read:PT.read,write:PT.write},nonNullable:!0})],XP.prototype,"unit",void 0),XP=jX=u([L("esri.TimeInterval")],XP);const t$=XP;var HX;let tC=HX=class extends Ce{constructor(e){super(e),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(e,t){return t.respectsDaylightSaving!==void 0?t.respectsDaylightSaving:t.respectDaylightSaving!==void 0&&t.respectDaylightSaving}clone(){const{respectsDaylightSaving:e,timezone:t}=this;return new HX({respectsDaylightSaving:e,timezone:t})}};u([d({type:Boolean,json:{write:!0}})],tC.prototype,"respectsDaylightSaving",void 0),u([De("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],tC.prototype,"readRespectsDaylightSaving",null),u([d({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],tC.prototype,"timezone",void 0),tC=HX=u([L("esri.layers.support.TimeReference")],tC);const RKe=tC;var qX;let Al=qX=class extends Ce{constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||t.timeExtent.length!==2)return null;const i=new Date(t.timeExtent[0]),r=new Date(t.timeExtent[1]);return new py({start:i,end:r})}writeFullTimeExtent(e,t){e&&_(e.start)&&_(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?new t$({value:t.timeInterval,unit:PT.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new t$({value:t.defaultTimeInterval,unit:PT.fromJSON(t.defaultTimeIntervalUnits)}):null}writeInterval(e,t){if(e){const i=e.toJSON();t.timeInterval=i.value,t.timeIntervalUnits=i.unit}else t.timeInterval=null,t.timeIntervalUnits=null}clone(){const{cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:n,fullTimeExtent:o,trackIdField:a,useTime:l}=this;return new qX({cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:ue(n),fullTimeExtent:ue(o),trackIdField:a,useTime:l})}};u([d({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],Al.prototype,"cumulative",void 0),u([d({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],Al.prototype,"endField",void 0),u([d({type:py,json:{write:{enabled:!0,allowNull:!0}}})],Al.prototype,"fullTimeExtent",void 0),u([De("fullTimeExtent",["timeExtent"])],Al.prototype,"readFullTimeExtent",null),u([it("fullTimeExtent")],Al.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,json:{write:!0}})],Al.prototype,"hasLiveData",void 0),u([d({type:t$,json:{write:{enabled:!0,allowNull:!0}}})],Al.prototype,"interval",void 0),u([De("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Al.prototype,"readInterval",null),u([it("interval")],Al.prototype,"writeInterval",null),u([d({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],Al.prototype,"startField",void 0),u([d({type:RKe,json:{write:{enabled:!0,allowNull:!0}}})],Al.prototype,"timeReference",void 0),u([d({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Al.prototype,"trackIdField",void 0),u([d({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],Al.prototype,"useTime",void 0),Al=qX=u([L("esri.layers.support.TimeInfo")],Al);const oEe=Al,PKe=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const s=r.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=PT.fromJSON(s.timeOffsetUnits);return n&&o?new t$({value:n,unit:o}):null}set timeInfo(i){S_e(i,this.fieldsIndex),this._set("timeInfo",i)}};return u([d({type:py,json:{write:!1}})],t.prototype,"timeExtent",void 0),u([d({type:t$})],t.prototype,"timeOffset",void 0),u([De("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),u([d({value:null,type:oEe,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),u([d({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=u([L("esri.layers.mixins.TemporalLayer")],t),t};var WX;let x0=WX=class extends Ce{constructor(e){super(e)}clone(){const{name:e,fields:t,isAscending:i,isUnique:r,description:s}=this;return new WX({name:e,fields:t,isAscending:i,isUnique:r,description:s})}};u([d({constructOnly:!0})],x0.prototype,"name",void 0),u([d({constructOnly:!0})],x0.prototype,"fields",void 0),u([d({constructOnly:!0})],x0.prototype,"isAscending",void 0),u([d({constructOnly:!0})],x0.prototype,"isUnique",void 0),u([d({constructOnly:!0})],x0.prototype,"description",void 0),x0=WX=u([L("esri.layers.support.FeatureIndex")],x0);let K0=class extends Ce{constructor(){super(...arguments),this.type=null}};u([d({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],K0.prototype,"type",void 0),K0=u([L("esri.layers.support.FeatureReduction")],K0);var ZX;let iC=ZX=class extends Ce{constructor(){super(...arguments),this.statisticType=null,this.onStatisticField=null,this.onStatisticValueExpression=null}clone(){return new ZX({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})}};u([d({type:String,json:{write:!0}})],iC.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],iC.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],iC.prototype,"onStatisticValueExpression",void 0),iC=ZX=u([L("esri.layers.support.OutStatistic")],iC);const IKe=iC;var XX;let YP=XX=class extends Ce{constructor(){super(...arguments),this.name=null,this.outStatistic=null}clone(){return new XX({name:this.name,outStatistic:this.outStatistic.clone()})}};u([d({type:String,json:{write:!0}})],YP.prototype,"name",void 0),u([d({type:IKe,json:{write:!0}})],YP.prototype,"outStatistic",void 0),YP=XX=u([L("esri.layers.support.AggregateField")],YP);const aEe=YP,Ote="__begin__",Rte="__end__",$Ke=new RegExp(Ote,"ig"),LKe=new RegExp(Rte,"ig"),Lce=new RegExp("^"+Ote,"i"),Dce=new RegExp(Rte+"$","i"),dz='"',DKe=dz+" + ",NKe=" + "+dz;function FKe(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function kKe(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function e6(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):e.labelExpression!=null&&(t.expression=FKe(e.labelExpression),t.type="conventional"),t}function UKe(e){const t=e6(e);if(!t)return null;switch(t.type){case"conventional":return YX(t.expression);case"arcade":return t.expression}return null}function zKe(e){const t=e6(e);if(!t)return null;switch(t.type){case"conventional":return BKe(t.expression);case"arcade":return Pte(t.expression)}return null}function YX(e){let t;return e?(t=Bg(e,i=>Ote+'$feature["'+i+'"]'+Rte),t=Lce.test(t)?t.replace(Lce,""):dz+t,t=Dce.test(t)?t.replace(Dce,""):t+dz,t=t.replace($Ke,DKe).replace(LKe,NKe)):t='""',t}const VKe=/^\s*\{([^}]+)\}\s*$/i;function BKe(e){const t=e.match(VKe);return t&&t[1].trim()||null}const GKe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,jKe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,HKe=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function Pte(e){if(!e)return null;let t=GKe.exec(e)||jKe.exec(e);return t?t[1]||t[3]:(t=HKe.exec(e),t?t[2]:null)}var JX;let Q_=JX=class extends Ce{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?YX(t.value):e}writeExpression(e,t,i){this.value!=null&&(e=YX(this.value)),e!=null&&(t[i]=e)}clone(){return new JX({expression:this.expression,title:this.title,value:this.value})}};u([d({type:String,json:{write:{writerEnsuresNonNull:!0}}})],Q_.prototype,"expression",void 0),u([De("expression",["expression","value"])],Q_.prototype,"readExpression",null),u([it("expression")],Q_.prototype,"writeExpression",null),u([d({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Q_.prototype,"title",void 0),u([d({json:{read:!1,write:!1}})],Q_.prototype,"value",void 0),Q_=JX=u([L("esri.layers.support.LabelExpressionInfo")],Q_);const lEe=Q_,cEe=[252,146,31,255],a5t=[153,153,153,255],qKe={type:"esriSMS",style:"esriSMSCircle",size:6,color:cEe,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},WKe={type:"esriSLS",style:"esriSLSSolid",width:.75,color:cEe},ZKe={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},XKe={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},YKe={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},JKe={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},QKe={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},KKe=hl.fromJSON(qKe),eet=dl.fromJSON(WKe),tet=wp.fromJSON(ZKe),iet=nO.fromJSON(XKe);function l5t(e){if(M(e))return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return KKe;case"polyline":return eet;case"polygon":case"extent":return tet}return null}hl.fromJSON(YKe);dl.fromJSON(JKe);wp.fromJSON(QKe);var QX;const gN=new Ti({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function uEe(e){var t;return!e||e.origin!=="service"&&((t=e.layer)==null?void 0:t.type)!=="map-image"}function ret(e){return(e==null?void 0:e.type)==="map-image"}function hEe(e){var t,i;return!!ret(e)&&!!((i=(t=e.capabilities)==null?void 0:t.exportMap)==null?void 0:i.supportsArcadeExpressionForLabeling)}function set(e){return uEe(e)||hEe(e.layer)}let zn=QX=class extends Ce{constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=iet,this.useCodedValues=void 0,this.where=null}static evaluateWhere(e,t){const i=(r,s,n)=>{switch(s){case"=":return r==n;case"<>":return r!=n;case">":return r>n;case">=":return r>=n;case"<":return r<n;case"<=":return r<=n}return!1};try{if(e==null)return!0;const r=e.split(" ");if(r.length===3)return i(t[r[0]],r[1],r[2]);if(r.length===7){const s=i(t[r[0]],r[1],r[2]),n=r[3],o=i(t[r[4]],r[5],r[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+e)}}readLabelExpression(e,t){const i=t.labelExpressionInfo;if(!i||!i.value&&!i.expression)return e}writeLabelExpression(e,t,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)e=kKe(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=Pte(this.labelExpressionInfo.expression);r&&(e="["+r+"]")}}e!=null&&(t[i]=e)}writeLabelExpressionInfo(e,t,i,r){if(e==null&&this.labelExpression!=null&&uEe(r))e=new lEe({expression:this.getLabelExpressionArcade()});else if(!e)return;const s=e.toJSON(r);s.expression&&(t[i]=s)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return e6(this)}getLabelExpressionArcade(){return UKe(this)}getLabelExpressionSingleField(){return zKe(this)}hash(){return JSON.stringify(this)}clone(){return new QX({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:ue(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:ue(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([d({type:String,json:{write:!0}})],zn.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],zn.prototype,"allowOverrun",void 0),u([d({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],zn.prototype,"deconflictionStrategy",void 0),u([d({type:String,json:{write:{overridePolicy(e,t,i){return this.labelExpressionInfo&&(i==null?void 0:i.origin)==="service"&&hEe(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],zn.prototype,"labelExpression",void 0),u([De("labelExpression")],zn.prototype,"readLabelExpression",null),u([it("labelExpression")],zn.prototype,"writeLabelExpression",null),u([d({type:lEe,json:{write:{overridePolicy:(e,t,i)=>set(i)?{allowNull:!0}:{enabled:!1}}}})],zn.prototype,"labelExpressionInfo",void 0),u([it("labelExpressionInfo")],zn.prototype,"writeLabelExpressionInfo",null),u([d({type:gN.apiValues,json:{type:gN.jsonValues,read:gN.read,write:gN.write}})],zn.prototype,"labelPlacement",void 0),u([d({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],zn.prototype,"labelPosition",void 0),u([d({type:Number})],zn.prototype,"maxScale",void 0),u([it("maxScale")],zn.prototype,"writeMaxScale",null),u([d({type:Number})],zn.prototype,"minScale",void 0),u([it("minScale")],zn.prototype,"writeMinScale",null),u([d({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:!1}}}})],zn.prototype,"repeatLabel",void 0),u([d({type:Number,cast:Tr,json:{write:!0,origins:{"web-scene":{write:!1}}}})],zn.prototype,"repeatLabelDistance",void 0),u([d({types:RBe,json:{origins:{"web-scene":{types:PBe,write:hce,default:null}},write:hce,default:null}})],zn.prototype,"symbol",void 0),u([d({type:Boolean,json:{write:!0}})],zn.prototype,"useCodedValues",void 0),u([d({type:String,json:{write:!0}})],zn.prototype,"where",void 0),zn=QX=u([L("esri.layers.support.LabelClass")],zn);const _O=zn;var KX;let af=KX=class extends K0{constructor(e){super(e),this.type="binning",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}clone(){return new KX({fields:ue(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:ue(this.labelingInfo),labelsVisible:this.labelsVisible,popupEnabled:this.popupEnabled,popupTemplate:ue(this.popupTemplate),renderer:ue(this.renderer)})}};u([bt({binning:"binning"})],af.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],af.prototype,"fixedBinLevel",void 0),u([d({type:[_O],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],af.prototype,"labelingInfo",void 0),u([d(QB)],af.prototype,"labelsVisible",void 0),u([d(RL)],af.prototype,"popupEnabled",void 0),u([d({type:ZS,json:{name:"popupInfo",write:!0}})],af.prototype,"popupTemplate",void 0),u([d({type:[aEe],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],af.prototype,"fields",void 0),u([d({types:ML,json:{write:!0}})],af.prototype,"renderer",void 0),af=KX=u([L("esri.layers.support.FeatureReductionBinning")],af);const net=af;var eY;let lu=eY=class extends Ce{constructor(e){super(e),this.type="cluster",this.clusterRadius=Tr("80px"),this.clusterMinSize=Tr("12px"),this.clusterMaxSize=Tr("50px"),this.popupEnabled=!0,this.popupTemplate=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}clone(){return new eY({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:ue(this.labelingInfo),labelsVisible:this.labelsVisible,fields:ue(this.fields),renderer:ue(this.renderer),popupEnabled:this.popupEnabled,popupTemplate:ue(this.popupTemplate)})}};u([d({type:["cluster"],readOnly:!0,json:{write:!0}})],lu.prototype,"type",void 0),u([d({type:Number,cast:e=>e==="auto"?e:Tr(e),json:{write:!0}})],lu.prototype,"clusterRadius",void 0),u([d({type:Number,cast:Tr,json:{write:!0}})],lu.prototype,"clusterMinSize",void 0),u([d({type:Number,cast:Tr,json:{write:!0}})],lu.prototype,"clusterMaxSize",void 0),u([d(RL)],lu.prototype,"popupEnabled",void 0),u([d({type:ZS,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],lu.prototype,"popupTemplate",void 0),u([d({types:ML,json:{write:!0}})],lu.prototype,"renderer",void 0),u([d({types:MBe})],lu.prototype,"symbol",void 0),u([d({type:[_O],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],lu.prototype,"labelingInfo",void 0),u([d(QB)],lu.prototype,"labelsVisible",void 0),u([d({type:[aEe],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],lu.prototype,"fields",void 0),lu=eY=u([L("esri.layers.support.FeatureReductionCluster")],lu);const dEe=lu;var tY;let z5=tY=class extends K0{constructor(e){super(e),this.type="selection"}clone(){return new tY}};u([d({type:["selection"]})],z5.prototype,"type",void 0),z5=tY=u([L("esri.layers.support.FeatureReductionSelection")],z5);const iY=z5,Nce={key:"type",base:K0,typeMap:{selection:dEe}},oet={types:{key:"type",base:K0,typeMap:{selection:iY,cluster:dEe,binning:net}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:Nce},"portal-item":{types:Nce},"web-scene":{types:{key:"type",base:K0,typeMap:{selection:iY}}}}}},Fce=new Ti({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let K_=class extends Wu(Ce){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([d({json:{write:!0}})],K_.prototype,"name",void 0),u([d({json:{write:!0}})],K_.prototype,"description",void 0),u([d({json:{read:Fce.read,write:Fce.write}})],K_.prototype,"drawingTool",void 0),u([d({json:{write:!0}})],K_.prototype,"prototype",void 0),u([d({json:{write:!0}})],K_.prototype,"thumbnail",void 0),K_=u([L("esri.layers.support.FeatureTemplate")],K_);const Ite=K_;let i0=class extends Wu(Ce){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const i of Object.keys(e))t[i]=Dee(e[i]);return t}writeDomains(e,t){var r;const i={};for(const s of Object.keys(e))e[s]&&(i[s]=(r=e[s])==null?void 0:r.toJSON());t.domains=i}};u([d({json:{write:!0}})],i0.prototype,"id",void 0),u([d({json:{write:!0}})],i0.prototype,"name",void 0),u([d({json:{write:!0}})],i0.prototype,"domains",void 0),u([De("domains")],i0.prototype,"readDomains",null),u([it("domains")],i0.prototype,"writeDomains",null),u([d({type:[Ite],json:{write:!0}})],i0.prototype,"templates",void 0),i0=u([L("esri.layers.support.FeatureType")],i0);const $te=i0;function aet(e){return e.type==="date"||e.type==="esriFieldTypeDate"}function kce(e){return e.type==="oid"||e.type==="esriFieldTypeOID"}function Uce(e){return e.type==="global-id"||e.type==="esriFieldTypeGlobalID"}class Lte{constructor(t){if(this.fields=t,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!t)return;const i=[];for(const r of t){const s=r&&r.name;if(s){const n=zce(s);this._fieldsMap.set(s,r),this._fieldsMap.set(n,r),i.push(n),aet(r)?(this.dateFields.push(r),this._dateFieldsSet.add(r)):jV(r)&&(this._numericFieldsSet.add(r),this.numericFields.push(r)),kce(r)||Uce(r)||(r.editable=r.editable==null||!!r.editable,r.nullable=r.nullable==null||!!r.nullable)}}i.sort(),this.uid=i.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const t of this.fields)kce(t)||Uce(t)||t.nullable||YUe(t)!==void 0||this._requiredFields.push(t)}return this._requiredFields}has(t){return this.get(t)!=null}get(t){return t!=null?this._fieldsMap.get(t)||this._fieldsMap.get(zce(t)):void 0}isDateField(t){return this._dateFieldsSet.has(this.get(t))}isNumericField(t){return this._numericFieldsSet.has(this.get(t))}normalizeFieldName(t){const i=this.get(t);if(i)return i.name}}function zce(e){return e.toLowerCase().trim()}const cet=ve.getLogger("esri.layers.support.fieldProperties");function pEe(){return{fields:{type:[hO],value:null},fieldsIndex:{readOnly:!0,get(){return new Lte(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e)this.fieldsIndex.has(t)||cet.error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e});return E_e(this.fieldsIndex,e)}}}}let rC=class extends Wu(Ce){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([d({type:String,json:{read:{source:"shapeAreaFieldName"}}})],rC.prototype,"shapeAreaField",void 0),u([d({type:String,json:{read:{source:"shapeLengthFieldName"}}})],rC.prototype,"shapeLengthField",void 0),u([d({type:String,json:{read:e=>N6e.read(e)||F6e.read(e)}})],rC.prototype,"units",void 0),rC=u([L("esri.layers.support.GeometryFieldsInfo")],rC);const uet=rC,het=/\[([^\[\]]+)\]/gi;function pz(e,t,i){return e?e.map(r=>{const s=new _O;if(s.read(r,i),s.labelExpression){const n=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replace(het,(o,a)=>`[${det(a,n)}]`)}return s}):null}function det(e,t){if(!t)return e;const i=e.toLowerCase();for(let r=0;r<t.length;r++){const s=t[r].name;if(s.toLowerCase()===i)return s}return e}var rY;let sC=rY=class extends Ce{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new nt}clone(){return new rY({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([d({type:String,json:{write:!0}})],sC.prototype,"floorField",void 0),u([d({json:{read:!1,write:!1}})],sC.prototype,"viewAllMode",void 0),u([d({json:{read:!1,write:!1}})],sC.prototype,"viewAllLevelIds",void 0),sC=rY=u([L("esri.layers.support.LayerFloorInfo")],sC);const Dte=sC,Vce=new Ti({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),Bce=new Ti({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let $d=class extends Wu(Ce){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([d({json:{read:Vce.read,write:Vce.write}})],$d.prototype,"cardinality",void 0),u([d({json:{read:!0,write:!0}})],$d.prototype,"composite",void 0),u([d({json:{read:!0,write:!0}})],$d.prototype,"id",void 0),u([d({json:{read:!0,write:!0}})],$d.prototype,"keyField",void 0),u([d({json:{read:!0,write:!0}})],$d.prototype,"keyFieldInRelationshipTable",void 0),u([d({json:{read:!0,write:!0}})],$d.prototype,"name",void 0),u([d({json:{read:!0,write:!0}})],$d.prototype,"relatedTableId",void 0),u([d({json:{read:!0,write:!0}})],$d.prototype,"relationshipTableId",void 0),u([d({json:{read:Bce.read,write:Bce.write}})],$d.prototype,"role",void 0),$d=u([L("esri.layers.support.Relationship")],$d);const pet=$d,lf=[];function fet(e,t){if(xte(e.url))return!0;const{wkid:i}=t;for(const r of lf){if(e.version>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}lf.push([10.91,()=>{const e=new Set([9709,9716,9741,9761,9766]);for(let t=9712;t<=9713;t++)e.add(t);for(let t=9748;t<=9749;t++)e.add(t);for(let t=20904;t<=20932;t++)e.add(t);for(let t=21004;t<=21032;t++)e.add(t);for(let t=21207;t<=21264;t++)e.add(t);for(let t=21307;t<=21364;t++)e.add(t);for(let t=102759;t<=102760;t++)e.add(t);for(let t=102901;t<=102955;t++)e.add(t);return e}]),lf.push([10.9,()=>{const e=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let t=9356;t<=9360;t++)e.add(t);for(let t=9404;t<=9407;t++)e.add(t);for(let t=9476;t<=9482;t++)e.add(t);for(let t=9487;t<=9494;t++)e.add(t);for(let t=9697;t<=9699;t++)e.add(t);return e}]),lf.push([10.81,()=>{const e=new Set([9265,9333,103598,103699]);for(let t=9248;t<=9254;t++)e.add(t);for(let t=9271;t<=9273;t++)e.add(t);for(let t=9284;t<=9285;t++)e.add(t);for(let t=21453;t<=21463;t++)e.add(t);return e}]),lf.push([10.8,()=>{const e=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let t=8035;t<=8036;t++)e.add(t);for(let t=8455;t<=8456;t++)e.add(t);for(let t=8518;t<=8529;t++)e.add(t);for(let t=8533;t<=8536;t++)e.add(t);for(let t=8538;t<=8540;t++)e.add(t);for(let t=8677;t<=8679;t++)e.add(t);for(let t=8902;t<=8903;t++)e.add(t);for(let t=8907;t<=8910;t++)e.add(t);for(let t=8949;t<=8951;t++)e.add(t);for(let t=8972;t<=8987;t++)e.add(t);for(let t=9039;t<=9040;t++)e.add(t);for(let t=9068;t<=9069;t++)e.add(t);for(let t=9140;t<=9141;t++)e.add(t);for(let t=9148;t<=9150;t++)e.add(t);for(let t=9153;t<=9159;t++)e.add(t);for(let t=9205;t<=9218;t++)e.add(t);for(let t=9221;t<=9222;t++)e.add(t);for(let t=54098;t<=54101;t++)e.add(t);return e}]),lf.push([10.71,()=>{const e=new Set([6316]);for(let t=8351;t<=8353;t++)e.add(t);for(let t=9294;t<=9297;t++)e.add(t);for(let t=103586;t<=103594;t++)e.add(t);for(let t=103696;t<=103698;t++)e.add(t);return e}]),lf.push([10.7,()=>{const e=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let t=8065;t<=8068;t++)e.add(t);for(let t=8082;t<=8083;t++)e.add(t);for(let t=8379;t<=8385;t++)e.add(t);for(let t=8836;t<=8840;t++)e.add(t);for(let t=8857;t<=8860;t++)e.add(t);for(let t=53035;t<=53037;t++)e.add(t);for(let t=54090;t<=54091;t++)e.add(t);for(let t=102498;t<=102499;t++)e.add(t);return e}]),lf.push([10.61,()=>new Set([102497])]),lf.push([10.6,()=>{const e=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let t=7755;t<=7787;t++)e.add(t);for(let t=7791;t<=7795;t++)e.add(t);for(let t=7799;t<=7801;t++)e.add(t);for(let t=7825;t<=7831;t++)e.add(t);for(let t=7877;t<=7878;t++)e.add(t);for(let t=7882;t<=7883;t++)e.add(t);for(let t=7991;t<=7992;t++)e.add(t);for(let t=8042;t<=8043;t++)e.add(t);for(let t=8058;t<=8059;t++)e.add(t);for(let t=8311;t<=8348;t++)e.add(t);for(let t=9060;t<=9067;t++)e.add(t);for(let t=102562;t<=102568;t++)e.add(t);for(let t=102799;t<=102900;t++)e.add(t);return e}]),lf.push([10.51,()=>{const e=new Set([7683,7881,7886,7899,8888,9e3]);for(let t=8013;t<=8032;t++)e.add(t);for(let t=9053;t<=9057;t++)e.add(t);for(let t=104017;t<=104018;t++)e.add(t);for(let t=104971;t<=104974;t++)e.add(t);return e}]),lf.push([10.5,()=>{const e=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let t=4087;t<=4088;t++)e.add(t);for(let t=5896;t<=5899;t++)e.add(t);for(let t=7005;t<=7007;t++)e.add(t);for(let t=7057;t<=7070;t++)e.add(t);for(let t=7073;t<=7082;t++)e.add(t);for(let t=7109;t<=7128;t++)e.add(t);for(let t=7844;t<=7859;t++)e.add(t);return e}]);async function fEe(e,t,i){const r=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const s=await Hu(r.populateFromStyle());if(qt(i),s.ok===!1){const n=s.error;t&&t.messages&&t.messages.push(new Uc("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:t})),e.clear("renderer",t.origin)}}}const met=["oid","global-id"],get=["oid","global-id","guid"];function Nte({displayField:e,editFieldsInfo:t,fields:i,objectIdField:r,title:s},n){if(!i)return null;const o=xet({editFieldsInfo:t,fields:i,objectIdField:r},n);if(!o.length)return null;const a=Cet({titleBase:s,fields:i,displayField:e}),l=Eet();return new ZS({title:a,content:l,fieldInfos:o})}const yet=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],vet=(e,{editFieldsInfo:t,objectIdField:i,visibleFieldNames:r})=>r?r.has(e.name):!mEe(e.name,t)&&(!i||e.name!==i)&&!met.includes(e.type)&&!yet.some(s=>s.test(e.name));function _et(e,t){const i=e;return t&&(e=e.filter(r=>!t.includes(r.type))),e===i&&(e=e.slice()),e.sort(bet),e}function bet(e,t){return e.type==="oid"?-1:t.type==="oid"?1:Gce(e)?-1:Gce(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function mEe(e,t){if(!e||!t)return!1;const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=t;return[i&&i.toLowerCase(),r&&r.toLowerCase(),s&&s.toLowerCase(),n&&n.toLowerCase()].includes(e.toLowerCase())}function wet(e,t){return e.editable&&!get.includes(e.type)&&!mEe(e.name,t)}function xet({editFieldsInfo:e,fields:t,objectIdField:i},r){return _et(t,(r==null?void 0:r.ignoreFieldTypes)||Aet).map(s=>new uL({fieldName:s.name,isEditable:wet(s,e),label:s.alias,format:Tet(s),visible:vet(s,{editFieldsInfo:e,objectIdField:i,visibleFieldNames:r==null?void 0:r.visibleFieldNames})}))}function Tet(e){switch(e.type){case"small-integer":case"integer":case"single":return new PC({digitSeparator:!0,places:0});case"double":return new PC({digitSeparator:!0,places:2});case"date":return new PC({dateFormat:"long-month-day-year"});default:return e.type==="string"&&P_e(e.name)?new PC({digitSeparator:!0,places:0}):null}}function Eet(){return[new qA,new $3]}function Cet(e){const t=HUe(e),{titleBase:i}=e;return t?`${i}: {${t.trim()}}`:i}function Gce(e){return(e.name&&e.name.toLowerCase())==="name"?!0:(e.alias&&e.alias.toLowerCase())==="name"||void 0}const Aet=["geometry","blob","raster","guid","xml"],V9=new Ti({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),Met={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},Un="FeatureLayer",jce=ve.getLogger("esri.layers.FeatureLayer");function yN(e,t){return new W("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function Hce(e){return e&&e instanceof nt}function ti(e,t,i){return!!(e&&e.hasOwnProperty(t)?e[t]:i)}function vN(e,t,i){return e&&e.hasOwnProperty(t)?e[t]:i}function Oet(e){var i;const t=(i=e==null?void 0:e.supportedSpatialAggregationStatistics)==null?void 0:i.map(r=>r.toLowerCase());return{envelope:!!(t==null?void 0:t.includes("envelopeaggregate")),centroid:!!(t==null?void 0:t.includes("centroidaggregate")),convexHull:!!(t==null?void 0:t.includes("convexhullaggregate"))}}function oR(e,t){var r;const i=(r=e==null?void 0:e.supportedOperationsWithCacheHint)==null?void 0:r.map(s=>s.toLowerCase());return!!(i==null?void 0:i.includes(t.toLowerCase()))}const B9=pEe();function G9(e,t,i){const r=!!(i==null?void 0:i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let je=class extends lKe(Ste(wKe(PKe(KB(nEe(Tte(Ate(Mte(OL(Z2e(wte(Wu(_S))))))))))))){constructor(...e){super(...e),this._handles=new Nt,this.capabilities=null,this.charts=null,this.copyright=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.dynamicDataSource=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.fieldsIndex=null,this.floorInfo=null,this.formTemplate=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.layerId=void 0,this.legendEnabled=!0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.screenSizePerspectiveEnabled=!0,this.serviceDefinitionExpression=null,this.spatialReference=at.WGS84,this.subtypeCode=null,this.subtypeField=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.trackIdField=null,this.type="feature",this.typeIdField=null,this.types=null,this.indexes=new(nt.ofType(x0)),this.userIsAdmin=!1,this.version=void 0,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=We(this._handles)}normalizeCtorArgs(e,t){return typeof e=="string"?F({url:e},t):e}load(e){const t=_(e)?e.signal:null;if(this.portalItem&&this.portalItem.loaded&&this.source)return void this.addResolvingPromise(this.createGraphicsSource(t).then(r=>this._initLayerProperties(r)));const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(cl).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const r=await this._fetchFirstLayerId(t);r!=null&&(this.layerId=r)}if(!this.url&&!this._hasMemorySource())throw new W("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this._initLayerProperties(await this.createGraphicsSource(t))}).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,t){return t=t.layerDefinition||t,{analytics:this._readAnalyticsCapabilities(t),attachment:this._readAttachmentCapabilities(t),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),queryTopFeatures:this._readQueryTopFeaturesCapabilities(t),editing:this._readEditingCapabilities(t)}}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")||0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){e!=null?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,i){return this._readEditingEnabled(t,!0,i)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,i,r){this._writeEditingEnabled(e,t,!0,r)}readEditingInfo(e,t){const{editingInfo:i}=t;return i?{lastEditDate:i.lastEditDate!=null?new Date(i.lastEditDate):null}:null}readIsTable(e,t){return(t=t&&t.layerDefinition||t).type==="Table"||!t.geometryType}writeIsTable(e,t,i,r){(r==null?void 0:r.writeLayerSchema)&&Bu(i,e?"Table":"Feature Layer",t)}readMinScale(e,t){return t.effectiveMinScale||e||0}readMaxScale(e,t){return t.effectiveMaxScale||e||0}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeGlobalID")return i.name}}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeOID")return i.name}}get parsedUrl(){const e=this.url?pn(this.url):null;return e!=null&&(this.dynamicDataSource!=null?e.path=Bc(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=Bc(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){fU(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,i){const r=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(r){const s=N2e(r,t,i)||void 0;return s||jce.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:i}),s}if(t.defaultSymbol)return t.types&&t.types.length?new gte({defaultSymbol:j9(t.defaultSymbol,t,i),field:t.typeIdField,uniqueValueInfos:t.types.map(s=>({id:s.id,symbol:j9(s.symbol,s,i)}))}):new fte({symbol:j9(t.defaultSymbol,t,i)})}set source(e){const t=this._get("source");t!==e&&(Hce(t)&&this._resetMemorySource(t),Hce(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof nt?new w0({layer:this,items:e}):e:null}readSource(e,t){const i=GB.fromJSON(t.featureSet);return new w0({layer:this,items:i&&i.features||[]})}readServiceDefinitionExpression(e,t){return t.definitionQuery||t.definitionExpression}readTemplates(e,t){const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e=e&&e.map(n=>Ite.fromJSON(n)),this._fixTemplates(e,r),this._fixTemplates(e,s),e}readTitle(e,t){const i=t.layerDefinition&&t.layerDefinition.name||t.name,r=t.title||t.layerDefinition&&t.layerDefinition.title;if(i){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?H2e(this.url,i):i;let n=i;if(!n&&this.url){const o=bv(this.url);_(o)&&(n=o.title)}return n?(this.sublayerTitleMode==="item-title-and-service-name"&&s&&s!==n&&(n=s+" - "+n),JB(n)):void 0}if(this.sublayerTitleMode==="item-title"&&r)return r}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let i=(t=t.layerDefinition||t).typeIdField;if(i&&t.fields){i=i.toLowerCase();const r=t.fields.find(s=>s.name.toLowerCase()===i);r&&(i=r.name)}return i}readTypes(e,t){e=(t=t.layerDefinition||t).types;const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e&&e.map(n=>(n=$te.fromJSON(n),this._fixTemplates(n.templates,r),this._fixTemplates(n.templates,s),n))}set url(e){const t=q2e({layer:this,url:e,nonStandardUrlAllowed:!0,logger:jce});this._set("url",t.url),t.layerId!=null&&this._set("layerId",t.layerId)}writeUrl(e,t,i,r){W2e(this,e,null,t,r)}readVersion(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}readVisible(e,t){return t.layerDefinition&&t.layerDefinition.defaultVisibility!=null?!!t.layerDefinition.defaultVisibility:t.visibility!=null?!!t.visibility:void 0}addAttachment(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("addAttachment"in this.source))throw new W(Un,"Layer source does not support addAttachment capability");return this.source.addAttachment(e,t)})}updateAttachment(e,t,i){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("updateAttachment"in this.source))throw new W(Un,"Layer source does not support updateAttachment capability");return this.source.updateAttachment(e,t,i)})}async applyEdits(e,t){const i=await import("./editingSupport.216e71af.js");return await this.load(),i.applyEdits(this,this.source,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return Nte(this,e)}async createGraphicsSource(e){if(this._hasMemorySource())return this.source.load({signal:e});const{default:t}=await VT(import("./FeatureLayerSource.7e4007c3.js"),e);return new t({layer:this}).load({signal:e})}createQuery(){const e=new Ou,t=this.get("capabilities.data"),i=this.get("capabilities.query");e.dynamicDataSource=this.dynamicDataSource,e.historicMoment=this.historicMoment,e.gdbVersion=this.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),t&&(t.supportsZ&&this.returnZ!=null&&(e.returnZ=this.returnZ),t.supportsM&&this.returnM!=null&&(e.returnM=this.returnM)),e.outFields=["*"];const r=_(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,s=_te(this.definitionExpression,r);e.where=s||"1=1";const{timeOffset:n,timeExtent:o}=this;return e.timeExtent=n!=null&&o!=null?o.offset(-n.value,n.unit):o||null,e.multipatchOption=this.geometryType==="multipatch"?"xyFootprint":null,e}deleteAttachments(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("deleteAttachments"in this.source))throw new W(Un,"Layer source does not support deleteAttachments capability");return this.source.deleteAttachments(e,t)})}fetchRecomputedExtents(e){return this.load({signal:e==null?void 0:e.signal}).then(()=>{if(this.source.fetchRecomputedExtents)return this.source.fetchRecomputedExtents(e);throw new W(Un,"Layer source does not support fetchUpdates capability")})}getFeatureType(e){const{typeIdField:t,types:i}=this;if(!t||!e)return null;const r=e.attributes?e.attributes[t]:void 0;if(r==null)return null;let s=null;return i.some(n=>{const{id:o}=n;return o!=null&&(o.toString()===r.toString()&&(s=n),!!s)}),s}getFieldDomain(e,t){const i=t&&t.feature,r=this.getFeatureType(i);if(r){const s=r.domains&&r.domains[e];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}queryAttachments(e,t){return e=uZ.from(e),this.load().then(()=>{if(!this.get("capabilities.data.supportsAttachment"))throw new W(Un,"this layer doesn't support attachments");const{attachmentTypes:i,objectIds:r,globalIds:s,num:n,size:o,start:a,where:l}=e;if(!this.get("capabilities.operations.supportsQueryAttachments")){const c=r&&r.length>1,h=i&&i.length,p=s&&s.length,f=o&&o.length;if(c||h||p||f||n||a||l)throw new W(Un,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(r&&r.length||l))throw new W(Un,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in this.source))throw new W(Un,"Layer source does not support queryAttachments capability",e);return this.source.queryAttachments(e)})}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(Ou.from(e)||this.createQuery(),t)).then(i=>{if(i==null?void 0:i.features)for(const r of i.features)r.layer=r.sourceLayer=this;return i})}queryObjectIds(e,t){return this.load().then(()=>{if(this.source.queryObjectIds)return this.source.queryObjectIds(Ou.from(e)||this.createQuery(),t);throw new W(Un,"Layer source does not support queryObjectIds capability")})}queryFeatureCount(e,t){return this.load().then(()=>{if(this.source.queryFeatureCount)return this.source.queryFeatureCount(Ou.from(e)||this.createQuery(),t);throw new W(Un,"Layer source does not support queryFeatureCount capability")})}queryExtent(e,t){return this.load().then(()=>{if(this.source.queryExtent)return this.source.queryExtent(Ou.from(e)||this.createQuery(),t);throw new W(Un,"Layer source does not support queryExtent capability")})}queryRelatedFeatures(e,t){return this.load().then(()=>{if("queryRelatedFeatures"in this.source)return this.source.queryRelatedFeatures(VZ.from(e),t);throw new W(Un,"Layer source does not support queryRelatedFeatures capability")})}queryRelatedFeaturesCount(e,t){return this.load().then(()=>{if("queryRelatedFeaturesCount"in this.source)return this.source.queryRelatedFeaturesCount(VZ.from(e),t);throw new W(Un,"Layer source does not support queryRelatedFeaturesCount capability")})}queryTopFeatures(e,t){return this.load().then(()=>{if("queryTopFeatures"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopFeatures(eN.from(e),t).then(i=>{if(i==null?void 0:i.features)for(const r of i.features)r.layer=r.sourceLayer=this;return i});throw new W(Un,"Layer source does not support queryTopFeatures capability")})}queryTopObjectIds(e,t){return this.load().then(()=>{if("queryTopObjectIds"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopObjectIds(eN.from(e),t);throw new W(Un,"Layer source does not support queryTopObjectIds capability")})}queryTopFeaturesExtent(e,t){return this.load().then(()=>{if("queryTopExtents"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopExtents(eN.from(e),t);throw new W(Un,"Layer source does not support queryTopExtents capability")})}queryTopFeatureCount(e,t){return this.load().then(()=>{if("queryTopCount"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopCount(eN.from(e),t);throw new W(Un,"Layer source does not support queryFeatureCount capability")})}read(e,t){const i=e.featureCollection;if(i){const r=i.layers;r&&r.length===1&&(super.read(r[0],t),i.showLegend!=null&&super.read({showLegend:i.showLegend},t))}super.read(e,t),t&&t.origin==="service"&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(e,t){var n;t=me(F({},t),{writeLayerSchema:(n=t==null?void 0:t.writeLayerSchema)!=null?n:this._hasMemorySource()});const{origin:i,layerContainerType:r,messages:s}=t;if(this.dynamicDataSource)return s==null||s.push(yN(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(i==="web-scene"||i==="web-map"&&r!=="tables")return s==null||s.push(yN(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return s==null||s.push(yN(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&i==="web-map"&&r==="tables")return s==null||s.push(yN(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,t)}clone(){if(this._hasMemorySource())throw new W(Un,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){return!!this.loaded&&(this.source.type==="memory"||fet(this,e))}async save(e){return(await import("./featureLayerUtils.0471f6f2.js")).save(this,e)}async saveAs(e,t){return(await import("./featureLayerUtils.0471f6f2.js")).saveAs(this,e,t)}_readEditingEnabled(e,t,i){var s;let r=(s=e.layerDefinition)==null?void 0:s.capabilities;return r?this._hasEditingCapability(r):(r=e.capabilities,t&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&r?this._hasEditingCapability(r):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(t=>t.trim()).includes("editing")}_writeEditingEnabled(e,t,i,r){var s,n;if(!e){const o=((n=(s=this.capabilities)==null?void 0:s.operations)==null?void 0:n.supportsSync)?"Query,Sync":"Query";Bu("layerDefinition.capabilities",o,t),i&&!(r==null?void 0:r.writeLayerSchema)&&(t.capabilities=o)}}_checkAttachmentSupport(e){const{attributes:t}=e,{objectIdField:i}=this;return this.get("capabilities.data.supportsAttachment")?e?t?t[i]?void 0:Promise.reject(new W(Un,`feature is missing the identifying attribute ${i}`)):Promise.reject(new W(Un,"'attributes' are required on a feature to query attachments")):Promise.reject(new W(Un,"A feature is required to add/delete/update attachments")):Promise.reject(new W(Un,"this layer doesn't support attachments"))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return Zt(this.url,{query:me(F({f:"json"},this.customParameters),{token:this.apiKey}),responseType:"json",signal:e}).then(t=>{const i=t.data;if(i)return Array.isArray(i.layers)&&i.layers.length>0?i.layers[0].id:Array.isArray(i.tables)&&i.tables.length>0?i.tables[0].id:void 0})}async _initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),fU(this.renderer,this.fieldsIndex),S_e(this.timeInfo,this.fieldsIndex),fEe(this,{origin:"service"})}async hasDataChanged(){var e,t;if((e=this.source)==null?void 0:e.refresh)try{const{dataChanged:i,updates:r}=await((t=this.source)==null?void 0:t.refresh());if(_(r)&&(this.sourceJSON=F(F({},this.sourceJSON),r),this.read(r,{origin:"service",url:this.parsedUrl})),i)return!0}catch{}if(this.definitionExpression)try{return(await DQe(this.definitionExpression,this.fieldsIndex)).hasDateFunctions}catch{}return!1}_verifyFields(){var t;const e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||((t=this.fields)==null?void 0:t.some(i=>i.type==="geometry"))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach(i=>{const r=i.prototype&&i.prototype.attributes;r&&t&&delete r[t]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new W("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new W("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(t=>{t.layer=this,t.sourceLayer=this}),this._handles.add([e.on("after-add",t=>{t.item.layer=this,t.item.sourceLayer=this}),e.on("after-remove",t=>{t.item.layer=null,t.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(t=>{t.layer=null,t.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}_readAnalyticsCapabilities(e){return{supportsCacheHint:oR(e.advancedQueryCapabilities,"queryAnalytics")}}_readAttachmentCapabilities(e){const t=e.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:oR(e.advancedQueryCapabilities,"queryAttachments"),supportsResize:ti(e,"supportsAttachmentsResizing",!1)};return t&&Array.isArray(t)&&t.forEach(r=>{const s=Met[r.name];s&&(i[s]=!!r.isEnabled)}),i}_readDataCapabilities(e){return{isVersioned:ti(e,"isDataVersioned",!1),supportsAttachment:ti(e,"hasAttachments",!1),supportsM:ti(e,"hasM",!1),supportsZ:ti(e,"hasZ",!1)}}_readMetadataCapabilities(e){return{supportsAdvancedFieldProperties:ti(e,"supportsFieldDescriptionProperty",!1)}}_readOperationsCapabilities(e,t){const i=e?e.toLowerCase().split(",").map(p=>p.trim()):[],r=this.url?bv(this.url):null,s=i.includes(_(r)&&r.serverType==="MapServer"?"data":"query"),n=i.includes("editing")&&!t.datesInUnknownTimezone;let o=n&&i.includes("create"),a=n&&i.includes("delete"),l=n&&i.includes("update");const c=i.includes("changetracking"),h=t.advancedQueryCapabilities;return n&&!(o||a||l)&&(o=a=l=!0),{supportsCalculate:ti(t,"supportsCalculate",!1),supportsTruncate:ti(t,"supportsTruncate",!1),supportsValidateSql:ti(t,"supportsValidateSql",!1),supportsAdd:o,supportsDelete:a,supportsEditing:n,supportsChangeTracking:c,supportsQuery:s,supportsQueryAnalytics:ti(h,"supportsQueryAnalytic",!1),supportsQueryAttachments:ti(h,"supportsQueryAttachments",!1),supportsQueryTopFeatures:ti(h,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:ti(t,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:l,supportsExceedsLimitStatistics:ti(t,"supportsExceedsLimitStatistics",!1)}}_readQueryCapabilities(e){var l;const t=e.advancedQueryCapabilities,i=e.ownershipBasedAccessControlForFeatures,r=e.archivingInfo,s=(l=this.url)==null?void 0:l.includes("MapServer"),n=!ye("mapserver-pbf-enabled")&&s&&this.version<10.81,o=xte(this.url),a=(e.supportedQueryFormats||"").split(",").reduce((c,h)=>{const p=h.toLowerCase().trim();return p&&c.add(p),c},new Set);return{supportsStatistics:ti(t,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:ti(t,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:ti(t,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:Oet(t),supportsCentroid:ti(t,"supportsReturningGeometryCentroid",!1),supportsDistance:ti(t,"supportsQueryWithDistance",!1),supportsDistinct:ti(t,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:ti(t,"supportsReturningQueryExtent",!1),supportsGeometryProperties:ti(t,"supportsReturningGeometryProperties",!1),supportsHavingClause:ti(t,"supportsHavingClause",!1),supportsOrderBy:ti(t,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:ti(t,"supportsPagination",!1),supportsQuantization:ti(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:ti(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:ti(e,"supportsReturningQueryGeometry",!1),supportsResultType:ti(t,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:ti(t,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:ti(t,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:ti(e,"useStandardizedQueries",!1),supportsTopFeaturesQuery:ti(t,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:ti(i,"allowOthersToQuery",!0),supportsHistoricMoment:ti(r,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:!n&&a.has("pbf"),supportsDisjointSpatialRelationship:ti(t,"supportsDisjointSpatialRel",!1),supportsCacheHint:ti(t,"supportsQueryWithCacheHint",!1)||oR(t,"query"),supportsDefaultSpatialReference:ti(t,"supportsDefaultSR",!1),supportsCompactGeometry:o,maxRecordCountFactor:vN(e,"maxRecordCountFactor",void 0),maxRecordCount:vN(e,"maxRecordCount",void 0),standardMaxRecordCount:vN(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:vN(e,"tileMaxRecordCount",void 0)}}_readQueryRelatedCapabilities(e){const t=e.advancedQueryCapabilities,i=ti(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:ti(t,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:oR(t,"queryRelated")}}_readQueryTopFeaturesCapabilities(e){return{supportsCacheHint:oR(e.advancedQueryCapabilities,"queryTopFilter")}}_readEditingCapabilities(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:ti(e,"allowGeometryUpdates",!0),supportsGlobalId:ti(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:ti(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:ti(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:ti(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:ti(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:ti(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:ti(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:ti(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:ti(t,"allowOthersToUpdate",!0)}}};u([d({readOnly:!0,json:{read:!1}})],je.prototype,"capabilities",void 0),u([De("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],je.prototype,"readCapabilities",null),u([d({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],je.prototype,"charts",void 0),u([d({readOnly:!0})],je.prototype,"createQueryVersion",null),u([d({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],je.prototype,"copyright",void 0),u([d({type:Boolean})],je.prototype,"datesInUnknownTimezone",void 0),u([d({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],je.prototype,"displayField",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],je.prototype,"definitionExpression",void 0),u([d({types:bu,readOnly:!0})],je.prototype,"defaultSymbol",void 0),u([d({type:Ph})],je.prototype,"dynamicDataSource",void 0),u([d({readOnly:!0})],je.prototype,"editFieldsInfo",void 0),u([d({type:Boolean})],je.prototype,"editingEnabled",null),u([De(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],je.prototype,"readEditingEnabled",null),u([De("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],je.prototype,"readEditingEnabledFromWebMap",null),u([it(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],je.prototype,"writeEditingEnabled",null),u([it("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],je.prototype,"writeEditingEnabledToWebMap",null),u([d({readOnly:!0})],je.prototype,"editingInfo",void 0),u([De("editingInfo")],je.prototype,"readEditingInfo",null),u([d((()=>{const e=ue(K2e),t=e.json.origins;return t["web-map"]={read:!1,write:!1},t["portal-item"]={read:!1,write:!1},e})())],je.prototype,"elevationInfo",void 0),u([d(oet)],je.prototype,"featureReduction",void 0),u([d(me(F({},B9.fields),{json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:G9}}}}}))],je.prototype,"fields",void 0),u([d(B9.fieldsIndex)],je.prototype,"fieldsIndex",void 0),u([d({type:Dte,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],je.prototype,"floorInfo",void 0),u([d({type:WQe,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],je.prototype,"formTemplate",void 0),u([d({type:yi,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],je.prototype,"fullExtent",void 0),u([d()],je.prototype,"gdbVersion",void 0),u([d({readOnly:!0,type:uet,json:{read:{source:"geometryProperties"}}})],je.prototype,"geometryFieldsInfo",void 0),u([d({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:V9.read},"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:G9,writer(e,t,i){const r=e?V9.toJSON(e):null;r&&Bu(i,r,t)}}}},read:{source:"layerDefinition.geometryType",reader:V9.read}}})],je.prototype,"geometryType",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],je.prototype,"hasM",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],je.prototype,"hasZ",void 0),u([d({readOnly:!0,type:e2})],je.prototype,"heightModelInfo",void 0),u([d({type:Date})],je.prototype,"historicMoment",void 0),u([d(Cte)],je.prototype,"id",void 0),u([d({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],je.prototype,"infoFor3D",void 0),u([d({readOnly:!0,json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],je.prototype,"isTable",void 0),u([De("service","isTable",["type","geometryType"]),De("isTable",["layerDefinition.type","layerDefinition.geometryType"])],je.prototype,"readIsTable",null),u([it("web-map","isTable")],je.prototype,"writeIsTable",null),u([d(QB)],je.prototype,"labelsVisible",void 0),u([d({type:[_O],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:pz},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:pz},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],je.prototype,"labelingInfo",void 0),u([d((()=>{const e=ue(mKe);return e.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(t,i,r){Bu(r,YV(t),i)}}},e})())],je.prototype,"opacity",void 0),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],je.prototype,"layerId",void 0),u([d(Q2e)],je.prototype,"legendEnabled",void 0),u([d({type:["show","hide"],json:(()=>{const e=ue(eEe.json);return e.origins["portal-item"]={read:!1,write:!1},e})()})],je.prototype,"listMode",void 0),u([d(yKe)],je.prototype,"minScale",void 0),u([De("service","minScale",["minScale","effectiveMinScale"])],je.prototype,"readMinScale",null),u([d(vKe)],je.prototype,"maxScale",void 0),u([De("service","maxScale",["maxScale","effectiveMaxScale"])],je.prototype,"readMaxScale",null),u([d({type:String})],je.prototype,"globalIdField",void 0),u([De("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),De("service","globalIdField",["globalIdField","fields"])],je.prototype,"readGlobalIdFieldFromService",null),u([d({type:String,json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:G9}}}}})],je.prototype,"objectIdField",void 0),u([De("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),De("service","objectIdField",["objectIdField","fields"])],je.prototype,"readObjectIdFieldFromService",null),u([d({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],je.prototype,"operationalLayerType",void 0),u([d(B9.outFields)],je.prototype,"outFields",void 0),u([d({readOnly:!0})],je.prototype,"parsedUrl",null),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],je.prototype,"path",void 0),u([d(RL)],je.prototype,"popupEnabled",void 0),u([d({type:ZS,json:{name:"popupInfo",write:!0}})],je.prototype,"popupTemplate",void 0),u([d({readOnly:!0})],je.prototype,"defaultPopupTemplate",null),u([d({type:[pet],readOnly:!0})],je.prototype,"relationships",void 0),u([d({types:ML,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:yte,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(e,t,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}})],je.prototype,"renderer",null),u([De("service","renderer",["drawingInfo.renderer","defaultSymbol"]),De("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],je.prototype,"readRenderer",null),u([d()],je.prototype,"sourceJSON",void 0),u([d({type:Boolean})],je.prototype,"returnM",void 0),u([d({type:Boolean})],je.prototype,"returnZ",void 0),u([d((()=>{const e=ue(J2e);return e.json.origins["portal-item"]={read:!1,write:!1},e})())],je.prototype,"screenSizePerspectiveEnabled",void 0),u([d({clonable:!1})],je.prototype,"source",null),u([Jt("source")],je.prototype,"castSource",null),u([De("portal-item","source",["featureSet"]),De("web-map","source",["featureSet"])],je.prototype,"readSource",null),u([d({readOnly:!0})],je.prototype,"serviceDefinitionExpression",void 0),u([De("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],je.prototype,"readServiceDefinitionExpression",null),u([d({type:at,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],je.prototype,"spatialReference",void 0),u([d({type:Number})],je.prototype,"subtypeCode",void 0),u([d({type:String,json:{origins:{service:{read:!0}}}})],je.prototype,"subtypeField",void 0),u([d({type:[Ite]})],je.prototype,"templates",void 0),u([De("templates",["editFieldsInfo","creatorField","editorField","templates"])],je.prototype,"readTemplates",null),u([d({type:oEe})],je.prototype,"timeInfo",void 0),u([d()],je.prototype,"title",void 0),u([De("service","title",["name"]),De("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],je.prototype,"readTitle",null),u([De("web-map","title",["layerDefinition.name","title"])],je.prototype,"readTitleFromWebMap",null),u([d({type:String})],je.prototype,"sublayerTitleMode",void 0),u([d({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],je.prototype,"trackIdField",void 0),u([d({json:{read:!1}})],je.prototype,"type",void 0),u([d({type:String})],je.prototype,"typeIdField",void 0),u([De("service","typeIdField"),De("typeIdField",["layerDefinition.typeIdField"])],je.prototype,"readTypeIdField",null),u([d({type:[$te]})],je.prototype,"types",void 0),u([De("service","types",["types"]),De("types",["layerDefinition.types"])],je.prototype,"readTypes",null),u([d({readOnly:!0,json:{write:!1}})],je.prototype,"serverGens",void 0),u([d({type:nt.ofType(x0),readOnly:!0})],je.prototype,"indexes",void 0),u([d(Ete)],je.prototype,"url",null),u([it("url")],je.prototype,"writeUrl",null),u([d({readOnly:!0})],je.prototype,"userIsAdmin",void 0),u([d({json:{origins:{service:{read:!0}},read:!1}})],je.prototype,"version",void 0),u([De("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],je.prototype,"readVersion",null),u([d({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],je.prototype,"visible",void 0),u([De("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],je.prototype,"readVisible",null),je=u([L("esri.layers.FeatureLayer")],je);const j9=KM({types:rbe}),fz=je;var Ret=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:fz});const Pet=["$datastore","$map","$layer","$aggregatedfeatures"],Iet="esri.widgets.Feature.support.arcadeFeatureUtils",$et=ve.getLogger(Iet);function Let(e){return typeof e=="string"?vL(xee(e)):Array.isArray(e)?Det(e):(e==null?void 0:e.declaredClass)==="esri.arcade.Dictionary"?Net(e):e}function Det(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?vL(xee(t)):t}</li>`).join("")}</ul>`}function Net(e){return`<table class="esri-widget__table">${e.keys().map(t=>{const i=e.field(t);return`<tr><th>${t}</th><td>${typeof i=="string"?vL(xee(i)):i}</td></tr>`}).join("")}</table>`}function Fet({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:i,context:r,viewInfo:s,map:n,graphic:o,interceptor:a}){i.forEach(l=>{const c=l.toLowerCase(),h={map:n,spatialReference:s.sr,interceptor:a};if(c==="$map"&&(r.vars[c]=t.convertMapToFeatureSetCollection(h)),c==="$layer"&&(r.vars[c]=t.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:s.sr,interceptor:a})),c==="$datastore"&&(r.vars[c]=t.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:s.sr,interceptor:a})),c==="$aggregatedfeatures"){const p=o.layer,{fields:f,objectIdField:m,geometryType:g,spatialReference:y,displayField:x}=p,b=new fz(me(F({fields:f,objectIdField:m,geometryType:g,spatialReference:y,displayField:x},p.type==="feature"?{templates:p.templates,typeIdField:p.typeIdField,types:p.types}:null),{source:e}));r.vars[c]=t.convertFeatureLayerToFeatureSet({layer:b,spatialReference:s.sr,interceptor:a})}})}function gEe(){return import("./arcadeUtils.2b1023a3.js").then(function(e){return e.t})}async function ket({graphic:e,view:t}){const{isAggregate:i,layer:r}=e;if(!i||!r||(t==null?void 0:t.type)!=="2d")return[];const s=await t.whenLayerView(r);if(!s.createQuery||!s.queryFeatures)return[];const n=s.createQuery();n.aggregateIds=[e.getObjectId()];const{features:o}=await s.queryFeatures(n);return o}async function yEe({expressionInfo:e,arcadeUtils:t,interceptor:i,spatialReference:r,map:s,graphic:n,view:o}){if(!e||!e.expression)return null;const a=t.createSyntaxTree(e.expression),l=Pet.filter(m=>t.hasVariable(a,m)),[c]=await Promise.all([ket({graphic:n,view:o}),t.loadScriptDependencies(a,!0,l)]),h=t.getViewInfo({spatialReference:r}),p=t.createExecContext(n,h);p.interceptor=i,p.useAsync=!0,Fet({aggregatedFeatures:c,arcadeUtils:t,featureSetVars:l,context:p,viewInfo:h,map:s,graphic:n,interceptor:i});const f=t.createFunction(a,p);return t.executeAsyncFunction(f,p).catch(m=>$et.error("arcade-execution-error",{error:m,graphic:n,expressionInfo:e}))}async function Uet({expressionInfos:e,spatialReference:t,graphic:i,interceptor:r,map:s,view:n}){if(!e||!e.length)return{};const o=await gEe(),a={};for(const h of e)a[`expression/${h.name}`]=yEe({expressionInfo:h,arcadeUtils:o,interceptor:r,spatialReference:t,map:s,graphic:i,view:n});const l=await Us(a),c={};for(const h in l)c[h]=Let(l[h].value);return c}const zet=1;let hh=class extends pm(Ee){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{var r,s;const t=(r=this.contentElement)==null?void 0:r.type;(s=this.contentElementViewModel)==null||s.destroy();const i=t==="fields"?new PB:t==="media"?new RT:t==="text"?new XU:null;this._set("contentElementViewModel",i)},this._compile=async()=>{this._cancelQuery();const t=new AbortController;this._abortController=t,await this._compileExpression(),this._abortController===t&&(this._abortController=null)},this._compileThrottled=gL(this._compile,zet,this),this._compileExpression=async()=>{const{expressionInfo:t,graphic:i,interceptor:r,spatialReference:s,map:n,view:o,_abortController:a}=this;if(!(t&&i&&s&&n))return void this._set("contentElement",null);const l=await gEe();if(a!==this._abortController)return;const c=await yEe({arcadeUtils:l,expressionInfo:t,graphic:i,interceptor:r,map:n,spatialReference:s,view:o});if(!c||c.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const h=await nte(c,a.signal),p=h==null?void 0:h.type,f=p==="media"?N3.fromJSON(h):p==="text"?WA.fromJSON(h):p==="fields"?qA.fromJSON(h):null;this._set("contentElement",f)},this.handles.add([re(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),Et),re(()=>[this.contentElement],()=>this._createVM(),Et)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get state(){const{_abortController:e,contentElement:t,contentElementViewModel:i}=this;return e?"loading":t||i?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}};u([d()],hh.prototype,"_abortController",void 0),u([d({type:I_e})],hh.prototype,"expressionInfo",void 0),u([d({type:Ha})],hh.prototype,"graphic",void 0),u([d({readOnly:!0})],hh.prototype,"contentElement",void 0),u([d({readOnly:!0})],hh.prototype,"contentElementViewModel",void 0),u([d()],hh.prototype,"interceptor",void 0),u([d()],hh.prototype,"spatialReference",null),u([d({readOnly:!0})],hh.prototype,"state",null),u([d()],hh.prototype,"map",null),u([d()],hh.prototype,"view",void 0),hh=u([L("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],hh);const Fte=hh,_N={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let V5=class extends Yr{constructor(e,t){super(e,t),this.viewModel=new Fte}initialize(){this.own(re(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),Et))}destroy(){this._destroyContentWidget()}renderLoading(){return N("div",{key:"loading-container",class:_N.loadingSpinnerContainer},N("span",{class:this.classes(_N.iconLoading,_N.spinner)}))}render(){var t;const{state:e}=this.viewModel;return N("div",{class:_N.base},e==="loading"?this.renderLoading():e==="disabled"?null:(t=this._contentWidget)==null?void 0:t.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t==null?void 0:t.type;this._destroyContentWidget();const r=e?i==="fields"?new dTe({viewModel:e}):i==="media"?new iSe({viewModel:e}):i==="text"?new v5({viewModel:e}):null:null;this._contentWidget=r,this.scheduleRender()}};u([d({type:Fte})],V5.prototype,"viewModel",void 0),V5=u([L("esri.widgets.Feature.FeatureExpression")],V5);const Vet=V5;class Bet{constructor(t,i){this.preLayerQueryCallback=t,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}}var B5;const Get=1,qce="content-view-models",vEe="esri.widgets.FeatureViewModel",jet=ve.getLogger(vEe),Wce={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};let sn=B5=class extends Ee{constructor(e){super(e),this._handles=new Nt,this._error=null,this._featureAbortController=null,this.graphicChangedThrottled=gL(this._graphicChanged,Get,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities=F({},Wce),this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{const{abilities:i}=this;return t.type==="attachments"&&i.attachmentsContent||t.type==="custom"&&i.customContent||t.type==="fields"&&i.fieldsContent||t.type==="media"&&i.mediaContent||t.type==="text"&&i.textContent||t.type==="expression"&&i.expressionContent},this._handles.add(re(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this.graphicChangedThrottled(),Et))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return _(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return oHe(Gae(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Qxe(this.graphic)}castAbilities(e){return F(F({},Wce),e)}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof RT&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof RT&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof RT&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:e}=this;if(!e)return;const t=new AbortController;this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(i){as(i)||(this._error=i,jet.error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,i)=>this._compileContentElement(t,i)):typeof e=="string"?this._compileText(new WA({text:e}),0).text:e}_destroyContentViewModels(){var e;(e=this._handles)==null||e.remove(qce),this.contentViewModels.forEach(t=>t&&!t.destroyed&&t.destroy()),this._set("contentViewModels",[])}_setExpressionContentVM(e,t){const{formattedAttributes:i}=this,{contentElement:r,contentElementViewModel:s}=e,n=r==null?void 0:r.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createFieldsVMParams(r,t))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createMediaVMParams(r,t))),n==="text"&&s.set(this._createTextVMParams(r)))}_compileExpression(e,t){const{expressionInfo:i}=e,{graphic:r,map:s,spatialReference:n,view:o}=this,a=new Fte({expressionInfo:i,graphic:r,interceptor:B5.interceptor,map:s,spatialReference:n,view:o});return this.contentViewModels[t]=a,this._handles.add(re(()=>a.contentElementViewModel,()=>this._setExpressionContentVM(a,t),Et),qce),e}_compileAttachments(e,t){const{graphic:i}=this,{description:r,title:s}=e;return this.contentViewModels[t]=new See(F({graphic:i},this._compileTitleAndDesc({title:s,description:r}))),e}_compileCustom(e,t){const{graphic:i}=this,{creator:r,destroyer:s}=e;return this.contentViewModels[t]=new XU({graphic:i,creator:r,destroyer:s}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:i,_sourceLayer:r,graphic:s,formattedAttributes:n,_expressionAttributes:o}=this,{attributes:a}=s,l=n.global;return{title:MT({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:e}),description:MT({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:t})}}_createFieldsVMParams(e,t){var c;const{_effectivePopupTemplate:i,formattedAttributes:r}=this,s=F(F({},r.global),r.content[t]),n=(c=(e==null?void 0:e.fieldInfos)||(i==null?void 0:i.fieldInfos))==null?void 0:c.filter(({fieldName:h})=>eTe(h)||z0(h)||s.hasOwnProperty(h)),o=i==null?void 0:i.expressionInfos,{description:a,title:l}=e;return F({attributes:s,expressionInfos:o,fieldInfos:n},this._compileTitleAndDesc({title:l,description:a}))}_compileFields(e,t){const i=e.clone(),r=new PB(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,i.fieldInfos=r.formattedFieldInfos.slice(0),i}_createMediaVMParams(e,t){const{abilities:i,graphic:r,_fieldInfoMap:s,formattedAttributes:n,_effectivePopupTemplate:o,relatedInfos:a,_sourceLayer:l,_expressionAttributes:c}=this,{attributes:h}=r,{description:p,mediaInfos:f,title:m}=e;return F({abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:h,layer:l,fieldInfoMap:s,formattedAttributes:F(F({},n.global),n.content[t]),expressionAttributes:c,mediaInfos:f,popupTemplate:o,relatedInfos:a},this._compileTitleAndDesc({title:m,description:p}))}_compileMedia(e,t){const i=e.clone(),r=new RT(this._createMediaVMParams(e,t));return i.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[t]=r,i}_createTextVMParams(e){const{graphic:t,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:s}=this;if(e&&e.text){const{attributes:n}=t,o=this.formattedAttributes.global;e.text=MT({attributes:n,fieldInfoMap:i,globalAttributes:o,expressionAttributes:s,layer:r,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const i=e.clone();return this.contentViewModels[t]=new XU(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i}=this;if(!e)return;const{lastEditInfoEnabled:r}=e,s=t==null?void 0:t.editFieldsInfo;return r&&s?nHe(s,i.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:i,graphic:r,_expressionAttributes:s}=this,{attributes:n}=r,o=this.formattedAttributes.global;return MT({attributes:n,fieldInfoMap:t,globalAttributes:o,expressionAttributes:s,layer:i,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this,i=e==null?void 0:e.title;return WU(i,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this,i=e==null?void 0:e.content;return WU(i,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:i,graphic:r,_effectivePopupTemplate:s,spatialReference:n,map:o,view:a}=this,{content:{value:l},title:{value:c}}=await Us({content:this._getContent(),title:this._getTitle()});if(t!==this._featureAbortController||!r)return;await cHe({graphic:r,popupTemplate:s,layer:i,spatialReference:n},e);const{expressionAttributes:{value:h}}=await Us({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:Uet({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:n,graphic:r,map:o,interceptor:B5.interceptor,view:a})});t===this._featureAbortController&&r&&(this._expressionAttributes=h,this._graphicExpressionAttributes=F(F({},r.attributes),h),this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){const{_effectivePopupTemplate:r,graphic:s,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;i.content[t]=s9({fieldInfos:r==null?void 0:r.fieldInfos,graphic:s,attributes:F(F({},l),e.attributes),layer:o,fieldInfoMap:a,relatedInfos:n})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){const{graphic:r,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a}=this;i.content[t]=s9({fieldInfos:e.fieldInfos,graphic:r,attributes:F(F({},a),e.attributes),layer:n,fieldInfoMap:o,relatedInfos:s})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:i,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:o}=this,a=t==null?void 0:t.fieldInfos,l={global:s9({fieldInfos:a,graphic:i,attributes:o,layer:s,fieldInfoMap:n,relatedInfos:r}),content:[]};return Array.isArray(e)&&e.forEach((c,h)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l})}),l}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,Gae(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:r,_sourceLayer:s}=this;r.clear();const n=_(s.associatedLayer)?await s.associatedLayer.load(i):s;if(!n)return;const o=t.filter(c=>c&&z0(c.fieldName));if(!o||!o.length)return;t.forEach(c=>this._configureRelatedInfo(c,n));const a=await kZe({relatedInfos:r,layer:n},i);Object.keys(a).forEach(c=>{var f;const h=r.get(c.toString()),p=(f=a[c])==null?void 0:f.value;h&&p&&(h.layerInfo=p.data)});const l=await UZe({graphic:e,relatedInfos:r,layer:n},i);Object.keys(l).forEach(c=>{var h;$Ze((h=l[c])==null?void 0:h.value,r.get(c.toString()))})}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,r=jZ(e.fieldName);if(!r)return;const{layerId:s,fieldName:n}=r;if(!s)return;const o=i.get(s.toString())||IZe(s,t);o&&(zZe({relatedInfo:o,fieldName:n,fieldInfo:e}),this.relatedInfos.set(s,o))}};sn.interceptor=new Bet(dHe,pHe),u([d()],sn.prototype,"_error",void 0),u([d()],sn.prototype,"_featureAbortController",void 0),u([d({readOnly:!0})],sn.prototype,"_effectivePopupTemplate",null),u([d({readOnly:!0})],sn.prototype,"_fieldInfoMap",null),u([d({readOnly:!0})],sn.prototype,"_sourceLayer",null),u([d()],sn.prototype,"abilities",void 0),u([Jt("abilities")],sn.prototype,"castAbilities",null),u([d({readOnly:!0})],sn.prototype,"content",void 0),u([d({readOnly:!0})],sn.prototype,"contentViewModels",void 0),u([d({type:Boolean})],sn.prototype,"defaultPopupTemplateEnabled",void 0),u([d({readOnly:!0})],sn.prototype,"state",null),u([d({readOnly:!0})],sn.prototype,"formattedAttributes",void 0),u([d({type:Ha,value:null})],sn.prototype,"graphic",null),u([d({readOnly:!0})],sn.prototype,"lastEditInfo",void 0),u([d({readOnly:!0})],sn.prototype,"relatedInfos",void 0),u([d()],sn.prototype,"spatialReference",null),u([d({readOnly:!0})],sn.prototype,"title",void 0),u([d()],sn.prototype,"map",null),u([d({readOnly:!0})],sn.prototype,"waitingForContent",null),u([d()],sn.prototype,"view",void 0),sn=B5=u([L(vEe)],sn);const kte=sn,_Ee=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>YU(i)&&!i.destroyed?N("div",{key:i},i.render()):i instanceof HTMLElement?N("div",{key:i,bind:i,afterCreate:this._attachToNode}):hTe(i)?N("div",{key:i,bind:i.domNode,afterCreate:this._attachToNode}):null}_attachToNode(i){const r=this;i.appendChild(r)}};return t=u([L("esri.widgets.Feature.ContentMixin")],t),t},Wa={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"},Zce={title:!0,content:!0,lastEditedInfo:!0};let Ka=class extends _Ee(Yr){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.headingLevel=2,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements=F({},Zce),this.map=null,this.view=null,this.viewModel=new kte}initialize(){this.own(re(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentViewModels},()=>this._setupContentWidgets(),Et))}loadDependencies(){return import("./calcite-notice.9a8b41e3.js")}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return F(F({},Zce),e)}render(){const{state:e}=this.viewModel,t=N("div",{class:Wa.container,key:"container"},this.renderTitle(),e==="error"?this.renderError():e==="loading"?this.renderLoading():this.renderContentContainer());return N("div",{class:this.classes(Wa.base,Wa.esriWidget)},t)}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderError(){const{messagesCommon:e,messages:t,visibleElements:i}=this;return N("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},i.title?N("div",{key:"error-title",slot:"title"},e.errorMessage):null,N("div",{key:"error-message",slot:"message"},t.loadingError))}renderLoading(){return N("div",{key:"loading-container",class:Wa.loadingSpinnerContainer},N("span",{class:this.classes(Wa.iconLoading,Wa.spinner)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?N("div",{class:Wa.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?N(J0,{level:this.headingLevel,class:Wa.title,innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?N("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if(typeof e=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:N("div",{key:`${t}-content`},i.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!i.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);case"expression":return this.renderExpression(t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:r}=t.viewModel;return i==="loading"||r.length>0?N("div",{key:this._buildKey("attachments-element",e),class:this.classes(Wa.contentElement)},t.render()):null}renderExpression(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:N("div",{key:this._buildKey("expression-element",e),class:Wa.contentElement},t.render())}renderCustom(e,t){const{creator:i}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:i?N("div",{key:this._buildKey("custom-element",t),class:Wa.contentElement},r.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:N("div",{key:this._buildKey("fields-element",e),class:Wa.contentElement},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:N("div",{key:this._buildKey("media-element",e),class:Wa.contentElement},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:r,user:s}=i,n=i.type==="edit"?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,o=xc(n,{date:r,user:s});return N("div",{key:"edit-info-element",class:this.classes(Wa.lastEditedInfo,Wa.contentElement)},o)}renderText(e,t){const i=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:i?N("div",{key:this._buildKey("text-element",t),class:this.classes(Wa.contentElement,Wa.text)},r.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,i=this.get("viewModel.content"),{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach((s,n)=>{s.type==="attachments"&&(this._contentWidgets[n]=new THe({displayType:s.displayType,headingLevel:t.title?e+1:e,viewModel:r[n]})),s.type==="fields"&&(this._contentWidgets[n]=new dTe({viewModel:r[n]})),s.type==="media"&&(this._contentWidgets[n]=new iSe({viewModel:r[n]})),s.type==="text"&&(this._contentWidgets[n]=new v5({viewModel:r[n]})),s.type==="custom"&&(this._contentWidgets[n]=new v5({viewModel:r[n]})),s.type==="expression"&&(this._contentWidgets[n]=new Vet({viewModel:r[n]}))},this);else{const s=r[0];s&&!s.destroyed&&(this._contentWidgets[0]=new v5({viewModel:s}))}this.scheduleRender()}};u([ze("viewModel.graphic")],Ka.prototype,"graphic",void 0),u([ze("viewModel.defaultPopupTemplateEnabled")],Ka.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],Ka.prototype,"headingLevel",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ka.prototype,"label",void 0),u([d(),pr("esri/widgets/Feature/t9n/Feature")],Ka.prototype,"messages",void 0),u([d(),pr("esri/t9n/common")],Ka.prototype,"messagesCommon",void 0),u([d(),pr("esri/widgets/support/t9n/uriUtils")],Ka.prototype,"messagesURIUtils",void 0),u([ze("viewModel.spatialReference")],Ka.prototype,"spatialReference",void 0),u([ze("viewModel.title")],Ka.prototype,"title",void 0),u([d()],Ka.prototype,"visibleElements",void 0),u([Jt("visibleElements")],Ka.prototype,"castVisibleElements",null),u([ze("viewModel.map")],Ka.prototype,"map",void 0),u([ze("viewModel.view")],Ka.prototype,"view",void 0),u([d({type:kte})],Ka.prototype,"viewModel",void 0),Ka=u([L("esri.widgets.Feature")],Ka);const Het=Ka;var bEe;const G5=Symbol("anchorHandles");let xx=class extends cs.EventedAccessor{constructor(e){super(e),this[bEe]=new Nt,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[G5].add([Jn(()=>wt(this.screenLocationEnabled?this.view:null,t=>[t.size,t.type==="3d"?t.camera:t.viewpoint]),()=>this.notifyChange("screenLocation")),re(()=>this.screenLocation,(t,i)=>{_(t)&&_(i)&&this.emit("view-change")})])}destroy(){this.view=null,this[G5]=We(this[G5])}get screenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this;return i&&_(e)&&_(t)&&t.ready?t.toScreen(e):null}};bEe=G5,u([d()],xx.prototype,"location",void 0),u([d()],xx.prototype,"screenLocation",null),u([d()],xx.prototype,"screenLocationEnabled",void 0),u([d()],xx.prototype,"view",void 0),xx=u([L("esri.widgets.support.AnchorElementViewModel")],xx);const wEe=xx,qet="esri.widgets.CompassViewModel";let j5=class extends wEe{constructor(e){super(e),this.visible=!1}};u([d()],j5.prototype,"visible",void 0),j5=u([L(qet)],j5);const xEe=j5,H9={base:"esri-spinner",spinnerStart:"esri-spinner--start",spinnerFinish:"esri-spinner--finish"};let Tx=class extends Yr{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new xEe,this.visible=!1}initialize(){this.own([re(()=>this.visible,e=>this._visibleChange(e))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:i}=e;t&&(this.viewModel.location=t),this.visible=!0;const r=()=>this.hide();i&&i.catch(()=>{}).then(r)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,r=e&&i,s=!e&&i,n={[H9.spinnerStart]:r,[H9.spinnerFinish]:s},o=this._getPositionStyles();return N("div",{class:this.classes(H9.base,n),styles:o})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=nS(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(M(t)||M(e))return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};u([ze("viewModel.location")],Tx.prototype,"location",void 0),u([ze("viewModel.view")],Tx.prototype,"view",void 0),u([d({type:xEe})],Tx.prototype,"viewModel",void 0),u([ze("viewModel.visible")],Tx.prototype,"visible",void 0),Tx=u([L("esri.widgets.Spinner")],Tx);const Wet=Tx;var jo;(function(e){e[e.size=22]="size",e[e.lineWidth=50]="lineWidth",e[e.maxSize=120]="maxSize",e[e.maxOutlineSize=80]="maxOutlineSize",e[e.tallSymbolWidth=20]="tallSymbolWidth"})(jo||(jo={}));const sY={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};function Zet(e,t,i){const r=jo.size;let s=r,n=r;e<1?s*=.75:e>1&&(n*=1.25);const o=0,a=0;let l=r,c=r;return t&&i&&(s=n=l=c=0),[{type:"path",path:[{command:"M",values:[l,o]},{command:"L",values:[i?l:.875*l,o]},{command:"L",values:[i?s-.5*l:a,n-.5*c]},{command:"L",values:[s-.5*l,n-.5*c]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[l,o]},{command:"L",values:[l,t?o:.125*c]},{command:"L",values:[s-.5*l,t?n-.5*c:c]},{command:"L",values:[s-.5*l,n-.5*c]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[s-.5*l,n-.5*c]},{command:"L",values:[i?s-.5*l:a,n-.5*c]},{command:"L",values:[i?s-.5*l:a,t?n-.5*c:c]},{command:"L",values:[s-.5*l,t?n-.5*c:c]},{command:"Z",values:[]}]}]}function Xet(e){const t=jo.size,i=.5*e,r=0,s=0;return[{type:"path",path:[{command:"M",values:[s,.7*t*.5]},{command:"L",values:[.3*t,.7*t]},{command:"L",values:[.3*t,.7*t+i]},{command:"L",values:[s,.7*t+i-.7*t*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*t,.7*t]},{command:"L",values:[.3*t,.7*t+i]},{command:"L",values:[t,i]},{command:"L",values:[t,r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*t,r]},{command:"L",values:[t,r]},{command:"L",values:[.3*t,.7*t]},{command:"L",values:[s,.7*t*.5]},{command:"Z",values:[]}]}]}function Yet(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]}function Jet(e,t){let i=t?jo.tallSymbolWidth:e;const r=e,s=t?4:6;i<=jo.size?i-=.5*s:i-=s;const n=0,o=0,a=t?.35*i:.5*i;return[{type:"path",path:[{command:"M",values:[.5*i,n]},{command:"L",values:[i,.5*a]},{command:"L",values:[.5*i,a]},{command:"L",values:[o,.5*a]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,.5*a]},{command:"L",values:[.5*i,a]},{command:"L",values:[.5*i,r]},{command:"L",values:[o,r-.5*a]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*i,a]},{command:"L",values:[.5*i,r]},{command:"L",values:[i,r-.5*a]},{command:"L",values:[i,.5*a]},{command:"Z",values:[]}]}]}function Qet(e,t){let i=t?jo.tallSymbolWidth:e;const r=e,s=t?4:6;i<=jo.size?i-=.5*s:i-=s;const n=.5*i,o=.15*i,a=0,l=r-o;return[{type:"ellipse",cx:.5*i,cy:l,rx:n,ry:o},{type:"path",path:[{command:"M",values:[a,o]},{command:"L",values:[a,l]},{command:"L",values:[i,l]},{command:"L",values:[i,o]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*i,cy:o,rx:n,ry:o}]}function Ket(e,t){let i=t?jo.tallSymbolWidth:e;const r=e,s=t?4:6;i<=jo.size?i-=.5*s:i-=s;const n=.15*i,o=r-n;return[{type:"ellipse",cx:.5*i,cy:o,rx:.5*i,ry:n},{type:"path",path:[{command:"M",values:[.5*i,0]},{command:"L",values:[i,o]},{command:"L",values:[0,o]},{command:"Z",values:[]}]}]}function ett(e){let t=e;const i=e,r=6;t<jo.size?t-=.5*r:t-=r;const s=.15*t,n=0;return[{type:"path",path:[{command:"M",values:[0,n]},{command:"L",values:[t,n]},{command:"L",values:[.5*t,i-s]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*t,cy:n,rx:.5*t,ry:s}]}function ttt(e){let t=e;const i=e,r=4;t<jo.size?t-=.5*r:t-=r;const s=0,n=0,o=t,a=i,l=Math.floor(e/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*o,s]},{command:"L",values:[o,.5*a-l]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*o,s]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"L",values:[n,.5*a-l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,.5*a-l]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"L",values:[.45*o,i]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*o,i]},{command:"L",values:[o,.5*a-l]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"Z",values:[]}]}]}function itt(e){const t=e,i=2;let r=e;r<jo.size?r-=.5*i:r-=i;const s=0,n=0;return[{type:"path",path:[{command:"M",values:[.45*t,s]},{command:"L",values:[t,r]},{command:"L",values:[.45*t,.6*r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*t,s]},{command:"L",values:[.45*t,.6*r]},{command:"L",values:[n,r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,r]},{command:"L",values:[.45*t,.6*r]},{command:"L",values:[t,r]},{command:"Z",values:[]}]}]}function pb(e,t){return Math.round(Math.min(Math.max(e+255*t*.75,0),255))}function c5t(e,t){if("type"in e&&(e.type==="linear"||e.type==="pattern"))return e;const i=new Le(e);return new Le([pb(i.r,t),pb(i.g,t),pb(i.b,t),i.a])}function rtt(e){return"r"in e&&"g"in e&&"b"in e}function TEe(e){return"h"in e&&"s"in e&&"v"in e}function SEe(e){return"l"in e&&"a"in e&&"b"in e}function EEe(e){return"l"in e&&"c"in e&&"h"in e}function stt(e){return"x"in e&&"y"in e&&"z"in e}const ntt=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],ott=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function CEe(e,t){const i=[];let r,s;if(e[0].length!==t.length)throw"dimensions do not match";const n=e.length,o=e[0].length;let a=0;for(r=0;r<n;r++){for(a=0,s=0;s<o;s++)a+=e[r][s]*t[s];i.push(a)}return i}function AEe(e){const t=[e.r/255,e.g/255,e.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=CEe(ntt,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function Ute(e){const t=CEe(ott,[e.x/100,e.y/100,e.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function MEe(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function OEe(e){const t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function att(e){const t=e.l,i=e.a,r=e.b,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n=n>0?n:n+2*Math.PI,{l:t,c:s,h:n}}function ltt(e){const t=e.l,i=e.c,r=e.h;return{l:t,a:i*Math.cos(r),b:i*Math.sin(r)}}function REe(e){return MEe(AEe(e))}function PEe(e){return Ute(OEe(e))}function ctt(e){return att(MEe(AEe(e)))}function utt(e){return Ute(OEe(ltt(e)))}function htt(e){const t=e.r,i=e.g,r=e.b,s=Math.max(t,i,r),n=s-Math.min(t,i,r);let o=s,a=n===0?0:s===t?(i-r)/n%6:s===i?(r-t)/n+2:(t-i)/n+4,l=n===0?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function dtt(e){const t=(e.h+360)%360/60,i=e.s/100,r=e.v/100*255,s=r*i,n=s*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-s),o.g=Math.round(o.g+r-s),o.b=Math.round(o.b+r-s),o}function PL(e){return rtt(e)?e:EEe(e)?utt(e):SEe(e)?PEe(e):stt(e)?Ute(e):TEe(e)?dtt(e):e}function zte(e){return TEe(e)?e:htt(PL(e))}function u5t(e){return SEe(e)?e:REe(PL(e))}function h5t(e){return EEe(e)?e:ctt(PL(e))}function d5t(e,t){const i=REe(e);return i.l*=1-t,PEe(i)}function mz(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function ptt(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function ftt(e,t,i,r,s,n){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function mtt(e,t){return new Float32Array(e,t,6)}function IEe(e,t,i,r){const s=t[r],n=t[r+1];e[r]=i[0]*s+i[2]*n+i[4],e[r+1]=i[1]*s+i[3]*n+i[5]}function gtt(e,t,i,r=0,s=0,n=2){const o=s||t.length/n;for(let a=r;a<o;a++)IEe(e,t,i,a*n)}Object.freeze(Object.defineProperty({__proto__:null,create:mz,clone:ptt,fromValues:ftt,createView:mtt,transform:IEe,transformMany:gtt},Symbol.toStringTag,{value:"Module"}));function ytt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function t6(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function vtt(e,t,i,r,s,n,o){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e}function $Ee(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];let l=i*n-r*s;return l?(l=1/l,e[0]=n*l,e[1]=-r*l,e[2]=-s*l,e[3]=i*l,e[4]=(s*a-n*o)*l,e[5]=(r*o-i*a)*l,e):null}function _tt(e){return e[0]*e[3]-e[1]*e[2]}function nT(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1],p=i[2],f=i[3],m=i[4],g=i[5];return e[0]=r*c+n*h,e[1]=s*c+o*h,e[2]=r*p+n*f,e[3]=s*p+o*f,e[4]=r*m+n*g+a,e[5]=s*m+o*g+l,e}function i6(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(i),h=Math.cos(i);return e[0]=r*h+n*c,e[1]=s*h+o*c,e[2]=r*-c+n*h,e[3]=s*-c+o*h,e[4]=a,e[5]=l,e}function Vte(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r*c,e[1]=s*c,e[2]=n*h,e[3]=o*h,e[4]=a,e[5]=l,e}function r6(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=r*c+n*h+a,e[5]=s*c+o*h+l,e}function btt(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e}function wtt(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function Bte(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function xtt(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function Ttt(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function Stt(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e}function LEe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}function Ett(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e}function Ctt(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e}function Att(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function Mtt(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=t[0],c=t[1],h=t[2],p=t[3],f=t[4],m=t[5];return Math.abs(i-l)<=Ut*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=Ut*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-h)<=Ut*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-p)<=Ut*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-f)<=Ut*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=Ut*Math.max(1,Math.abs(a),Math.abs(m))}const Ott=nT,Rtt=LEe;Object.freeze(Object.defineProperty({__proto__:null,copy:ytt,identity:t6,set:vtt,invert:$Ee,determinant:_tt,multiply:nT,rotate:i6,scale:Vte,translate:r6,fromRotation:btt,fromScaling:wtt,fromTranslation:Bte,str:xtt,frob:Ttt,add:Stt,subtract:LEe,multiplyScalar:Ett,multiplyScalarAndAdd:Ctt,exactEquals:Att,equals:Mtt,mul:Ott,sub:Rtt},Symbol.toStringTag,{value:"Module"}));const Ptt="http://www.w3.org/2000/svg";let Itt=0,$tt=0;const Xce=ye("android"),Ltt=ye("chrome")||Xce&&Xce>=4?"auto":"optimizeLegibility",Dtt={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},Ntt=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let Ao={},Dr={};const Yce={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},Ftt=Math.PI;let ktt=1;function NC(e,t){const i=e*(Ftt/180);return Math.abs(t*Math.sin(i))+Math.abs(t*Math.cos(i))}function DEe(e){return e.map(t=>`${t.command} ${t.values.join(" ")}`).join(" ").trim()}function Gte(e,t,i,r){if(e){if(e.type==="circle")return N("circle",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-dashoffset":i.dashOffset,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,r:e.r});if(e.type==="ellipse")return N("ellipse",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,rx:e.rx,ry:e.ry});if(e.type==="rect")return N("rect",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",x:e.x,y:e.y,width:e.width,height:e.height});if(e.type==="image")return N("image",{href:e.src,x:e.x,y:e.y,width:e.width,height:e.height,preserveAspectRatio:"none"});if(e.type==="path"){const s=typeof e.path!="string"?DEe(e.path):e.path;return N("path",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",d:s})}if(e.type==="text")return N("text",{"alignment-baseline":r.alignBaseline,fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4","text-anchor":r.align,"text-decoration":r.decoration,kerning:r.kerning,rotate:r.rotate,"text-rendering":Ltt,"font-style":r.font.style,"font-variant":r.font.variant,"font-weight":r.font.weight,"font-size":r.font.size,"font-family":r.font.family,x:e.x,y:e.y},e.text)}return null}function jte(e){const t={fill:"none",pattern:null,linearGradient:null};if(e){if("type"in e&&e.type==="pattern"){const i="patternId-"+ ++Itt;t.fill=`url(#${i})`,t.pattern={id:i,x:e.x,y:e.y,width:e.width,height:e.height,image:{x:0,y:0,width:e.width,height:e.height,href:e.src}}}else if("type"in e&&e.type==="linear"){const i="linearGradientId-"+ ++$tt;t.fill=`url(#${i})`,t.linearGradient={id:i,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,stops:e.colors.map(r=>({offset:r.offset,color:r.color&&new Le(r.color).toString()}))}}else if(e){const i=new Le(e);t.fill=i.toString()}}return t}function Hte(e){const t={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};if(e&&(e.width!=null&&(t.width=e.width),e.cap&&(t.cap=e.cap),e.join&&(t.join=e.join.toString()),e.color&&(t.color=new Le(e.color).toString()),e.dashArray&&(t.dashArray=e.dashArray),e.dashArray&&(t.dashOffset=e.dashoffset),e.style)){let i=null;if(e.style in Yce&&(i=Yce[e.style]),Array.isArray(i)){i=i.slice(0);for(let r=0;r<i.length;++r)i[r]*=e.width;if(e.cap!=="butt"){for(let r=0;r<i.length;r+=2)i[r]-=e.width,i[r]<1&&(i[r]=1);for(let r=1;r<i.length;r+=2)i[r]+=e.width}i=i.join(",")}t.dashArray=i}return t}function NEe(e,t){const i={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};return e&&(i.align=e.align,i.alignBaseline=e.alignBaseline,i.decoration=e.decoration,i.kerning=e.kerning?"auto":"0",i.rotate=e.rotated?"90":"0",i.font.style=t.style||"normal",i.font.variant=t.variant||"normal",i.font.weight=t.weight||"normal",i.font.size=t.size&&t.size.toString()||"10pt",i.font.family=t.family||"serif"),i}function FEe(e){const{pattern:t,linearGradient:i}=e;if(t)return N("pattern",{id:t.id,patternUnits:"userSpaceOnUse",x:t.x,y:t.y,width:t.width,height:t.height},N("image",{x:t.image.x,y:t.image.y,width:t.image.width,height:t.image.height,href:t.image.href}));if(i){const r=i.stops.map((s,n)=>N("stop",{key:`${n}-stop`,offset:s.offset,"stop-color":s.color}));return N("linearGradient",{id:i.id,gradientUnits:"userSpaceOnUse",x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},r)}return null}function Utt(e,t){if(!e)return null;const i=[];for(const r of e){const{shape:s,fill:n,stroke:o,font:a}=r,l=jte(n),c=Hte(o),h=s.type==="text"?NEe(s,a):null;i.push(Gte(s,l.fill,c,h))}return N("mask",{id:t,maskUnits:"userSpaceOnUse"},N("g",null,i))}function Jce(e,t,i){return r6(e,t6(e),[t,i])}function Qce(e,t,i,r,s){return Vte(e,t6(e),[t,i]),e[4]=e[4]*t-r*t+r,e[5]=e[5]*i-s*i+s,e}function ztt(e,t,i,r){const s=t%360*Math.PI/180;i6(e,t6(e),s);const n=Math.cos(s),o=Math.sin(s),a=e[4],l=e[5];return e[4]=a*n-l*o+r*o-i*n+i,e[5]=l*n+a*o-i*o-r*n+r,e}function ec(e,t){Ao&&"left"in Ao?(Ao.left>e&&(Ao.left=e),Ao.right<e&&(Ao.right=e),Ao.top>t&&(Ao.top=t),Ao.bottom<t&&(Ao.bottom=t)):Ao={left:e,bottom:t,right:e,top:t}}function Kce(e){const t=e.args,i=t.length;let r;switch(e.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(r=0;r<i;r+=2)ec(t[r],t[r+1]);Dr.x=t[i-2],Dr.y=t[i-1];break;case"H":for(r=0;r<i;++r)ec(t[r],Dr.y);Dr.x=t[i-1];break;case"V":for(r=0;r<i;++r)ec(Dr.x,t[r]);Dr.y=t[i-1];break;case"m":{let s=0;for(("x"in Dr)||(ec(Dr.x=t[0],Dr.y=t[1]),s=2),r=s;r<i;r+=2)ec(Dr.x+=t[r],Dr.y+=t[r+1]);break}case"l":case"t":for(r=0;r<i;r+=2)ec(Dr.x+=t[r],Dr.y+=t[r+1]);break;case"h":for(r=0;r<i;++r)ec(Dr.x+=t[r],Dr.y);break;case"v":for(r=0;r<i;++r)ec(Dr.x,Dr.y+=t[r]);break;case"c":for(r=0;r<i;r+=6)ec(Dr.x+t[r],Dr.y+t[r+1]),ec(Dr.x+t[r+2],Dr.y+t[r+3]),ec(Dr.x+=t[r+4],Dr.y+=t[r+5]);break;case"s":case"q":for(r=0;r<i;r+=4)ec(Dr.x+t[r],Dr.y+t[r+1]),ec(Dr.x+=t[r+2],Dr.y+=t[r+3]);break;case"A":for(r=0;r<i;r+=7)ec(t[r+5],t[r+6]);Dr.x=t[i-2],Dr.y=t[i-1];break;case"a":for(r=0;r<i;r+=7)ec(Dr.x+=t[r+5],Dr.y+=t[r+6])}}function eue(e,t,i){const r=Dtt[e.toLowerCase()];let s;typeof r=="number"&&(r?t.length>=r&&(s={action:e,args:t.slice(0,t.length-t.length%r)},i.push(s),Kce(s)):(s={action:e,args:[]},i.push(s),Kce(s)))}function Vtt(e){const t=(typeof e.path!="string"?DEe(e.path):e.path).match(Ntt),i=[];if(Ao={},Dr={},!t)return null;let r="",s=[];const n=t.length;for(let a=0;a<n;++a){const l=t[a],c=parseFloat(l);isNaN(c)?(r&&eue(r,s,i),s=[],r=l):s.push(c)}eue(r,s,i);const o={x:0,y:0,width:0,height:0};return Ao&&"left"in Ao&&(o.x=Ao.left,o.y=Ao.top,o.width=Ao.right-Ao.left,o.height=Ao.bottom-Ao.top),o}function kEe(e){const t={x:0,y:0,width:0,height:0};if(e.type==="circle")t.x=e.cx-e.r,t.y=e.cy-e.r,t.width=2*e.r,t.height=2*e.r;else if(e.type==="ellipse")t.x=e.cx-e.rx,t.y=e.cy-e.ry,t.width=2*e.rx,t.height=2*e.ry;else if(e.type==="image"||e.type==="rect")t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height;else if(e.type==="path"){const i=Vtt(e);t.x=i.x,t.y=i.y,t.width=i.width,t.height=i.height}return t}function UEe(e){const t={x:0,y:0,width:0,height:0};let i=null,r=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(const n of e)i?(i.x=Math.min(i.x,n.x),i.y=Math.min(i.y,n.y),r=Math.max(r,n.x+n.width),s=Math.max(s,n.y+n.height)):(i=t,i.x=n.x,i.y=n.y,r=n.x+n.width,s=n.y+n.height);return i&&(i.width=r-i.x,i.height=s-i.y),i}function nY(e,t,i,r,s,n,o,a,l){let c=(o&&n?NC(n,t):t)/2,h=(o&&n?NC(n,i):i)/2;if(l){const S=l[0],T=l[1];c=(o&&n?NC(n,S):S)/2,h=(o&&n?NC(n,T):T)/2}const p=e.width+r,f=e.height+r,m=mz(),g=mz();let y=!1;if(s&&p!==0&&f!==0){const S=t!==i?t/i:p/f,T=t>i?t:i;let C=1,A=1;isNaN(T)||(S>1?(C=T/p,A=T/S/f):(A=T/f,C=T*S/p)),nT(g,g,Qce(m,C,A,c,h)),y=!0}const x=e.x+(p-r)/2,b=e.y+(f-r)/2;if(nT(g,g,Jce(m,c-x,h-b)),!y&&(p>t||f>i)){const S=p/t>f/i,T=(S?t:i)/(S?p:f);nT(g,g,Qce(m,T,T,x,b))}return n&&nT(g,g,ztt(m,n,x,b)),a&&nT(g,g,Jce(m,a[0],a[1])),`matrix(${g[0]},${g[1]},${g[2]},${g[3]},${g[4]},${g[5]})`}function Btt(e,t,i){const r=e==null?void 0:e.effects.find(c=>c.type==="bloom");if(!r)return null;const{strength:s,radius:n}=r,o=s>0?n:0,a=(s+o)*t,l=4*s+1;return N("filter",{id:`bloom${i}`,x:"-100%",y:"-100%",width:"300%",height:"300%",filterUnits:"userSpaceOnUse"},N("feMorphology",{operator:"dilate",radius:(s+.5*o)*(5**(t/100)*(.4+t/100)),in:"SourceGraphic",result:"dilate"}),N("feGaussianBlur",{in:"dilate",stdDeviation:a/25,result:"blur"}),N("feGaussianBlur",{in:"blur",stdDeviation:a/50,result:"intensityBlur"}),N("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},N("feFuncR",{type:"linear",slope:l}),N("feFuncG",{type:"linear",slope:l}),N("feFuncB",{type:"linear",slope:l})),N("feMerge",null,N("feMergeNode",{in:"intensityBlur"}),N("feMergeNode",{in:"intensityBrightness"}),N("feGaussianBlur",{stdDeviation:s/10})))}function zEe(e,t,i,r={}){var c;const s=[],n=[],o=++ktt,a=Btt(r.effectView,t,o);let l=null;if(a){const h=(c=r.effectView)==null?void 0:c.effects.find(g=>g.type==="bloom"),p=(h.strength?h.strength+h.radius/2:0)/3,f=t+t*p,m=i+i*p;l=[Math.max(f,10),Math.max(m,10)]}for(let h=0;h<e.length;h++){const p=e[h],f=[],m=[];let g=0,y=0,x=0;for(const T of p){const{shape:C,fill:A,stroke:O,font:D,offset:U}=T;r.ignoreStrokeWidth||(g+=O&&O.width||0);const k=jte(A),B=Hte(O),j=C.type==="text"?NEe(C,D):null;s.push(FEe(k)),f.push(Gte(C,k.fill,B,j)),m.push(kEe(C)),U&&(y+=U[0],x+=U[1])}const b=nY(UEe(m),t,i,g,r.scale,r.rotation,r.useRotationSize,[y,x],l);let S=null;if(r.masking){const T=`mask-${h}`,C=r.masking[h];s.push(Utt(C,T)),S=`url(#${T})`}n.push(S?N("g",{mask:S},N("g",{transform:b},f)):N("g",{transform:b},f))}return r.useRotationSize&&r.rotation&&(t=NC(r.rotation,t),i=NC(r.rotation,i)),a&&(t=l[0],i=l[1]),N("svg",{xmlns:Ptt,width:t,height:i,style:"display: block;"},a,N("defs",null,s),a?N("g",{filter:`url(#bloom${o})`},n):n)}const Gtt=zU();function IL(e,t,i){const r=Math.ceil(t[0]),s=Math.ceil(t[1]);if(!e.some(o=>!!o.length))return null;const n=i&&i.node||document.createElement("div");return i.opacity!=null&&(n.style.opacity=i.opacity.toString()),i.effectView!=null&&(n.style.filter=Z3(i.effectView)),Gtt.append(n,zEe.bind(null,e,r,s,i)),n}function jtt(e,t){e=Math.ceil(e),t=Math.ceil(t);const i=document.createElement("canvas");i.width=e,i.height=t,i.style.width=e+"px",i.style.height=t+"px";const r=i.getContext("2d");return r.clearRect(0,0,e,t),r}function Htt(e,t,i){return e?Zt(e,{responseType:"image"}).then(r=>{const s=r.data,n=s.width,o=s.height,a=n/o;let l=t;if(i){const c=Math.max(n,o);l=Math.min(l,c)}return{image:s,width:a<=1?Math.ceil(l*a):l,height:a<=1?l:Math.ceil(l/a)}}):Promise.reject(new W("renderUtils: imageDataSize","href not provided."))}function qtt(e,t){return!(!e||t==="ignore")&&(t!=="multiply"||e.r!==255||e.g!==255||e.b!==255||e.a!==1)}function Wtt(e,t,i,r,s){switch(s){case"multiply":e[t+0]*=i[0],e[t+1]*=i[1],e[t+2]*=i[2],e[t+3]*=i[3];break;default:{const n=zte({r:e[t+0],g:e[t+1],b:e[t+2]});n.h=r.h,n.s=r.s,n.v=n.v/100*r.v;const o=PL(n);e[t+0]=o.r,e[t+1]=o.g,e[t+2]=o.b,e[t+3]*=i[3];break}}}function Ztt(e,t,i,r,s){return Htt(e,t,s).then(n=>{const o=n.width?n.width:t,a=n.height?n.height:t;if(n.image&&qtt(i,r)){let l=n.image.width,c=n.image.height;ye("edge")&&/\.svg$/i.test(e)&&(l-=1,c-=1);const h=jtt(o,a);h.drawImage(n.image,0,0,l,c,0,0,o,a);const p=h.getImageData(0,0,o,a),f=[i.r/255,i.g/255,i.b/255,i.a],m=zte(i);for(let g=0;g<p.data.length;g+=4)Wtt(p.data,g,f,m,r);h.putImageData(p,0,0),e=h.canvas.toDataURL("image/png")}else{const l=Es&&Es.findCredential(e);if(l&&l.token){const c=e.includes("?")?"&":"?";e=`${e}${c}token=${l.token}`}}return{url:e,width:o,height:a}}).catch(()=>({url:e,width:t,height:t}))}let I2=null;const tue=[255,255,255];function iue(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function Xtt(e,t,i){const{backgroundColor:r,outline:s,dotSize:n}=e,o=i&&i.swatchSize||jo.size,a=.8,l=Math.round(o*o/n**2*a),c=window.devicePixelRatio,h=document.createElement("canvas"),p=o*c;h.width=p,h.height=p,h.style.width=h.width/c+"px",h.style.height=h.height/c+"px";const f=h.getContext("2d");if(r&&(f.fillStyle=r.toCss(!0),f.fillRect(0,0,p,p),f.fill()),f.fillStyle=t.toCss(!0),I2&&I2.length/2===l)for(let g=0;g<2*l;g+=2){const y=I2[g],x=I2[g+1];f.fillRect(y,x,n*c,n*c),f.fill()}else{I2=[];for(let g=0;g<2*l;g+=2){const y=iue(0,p),x=iue(0,p);I2.push(y,x),f.fillRect(y,x,n*c,n*c),f.fill()}}s&&(s.color&&(f.strokeStyle=s.color.toCss(!0)),f.lineWidth=s.width,f.strokeRect(0,0,p,p));const m=new Image(o,o);return m.src=h.toDataURL(),m}function Ytt(e,t={}){const i=t.radius||40,r=2*Math.PI*i,s=e.length,n=r/s,o=[],a=q3(t.outline);a&&(a.width*=2),(a||t.backgroundColor)&&o.push({shape:{type:"circle",cx:i,cy:i,r:i},fill:t.backgroundColor,stroke:a,offset:[0,0]});const l=t.values,c=l&&l.length===s&&l.reduce((g,y)=>g+y,0)===100,h=[0];for(let g=0;g<s;g++){const y=c?l[g]*r/100:null;c&&h.push(y+h[g]),o.push({shape:{type:"circle",cx:i,cy:i,r:i/2},fill:[0,0,0,0],stroke:{width:i,dashArray:`${y||n} ${r}`,dashoffset:"-"+(c?h[g]/2:g*(n/2)),color:e[g]},offset:[0,0]})}let p=null;const f=2*i+((a==null?void 0:a.width)||0),m=t.holePercentage;if(m){a&&o.push({shape:{type:"circle",cx:i,cy:i,r:i*m},fill:null,stroke:a,offset:[0,0]});const g=f/2;p=[[{shape:{type:"circle",cx:g,cy:g,r:g},fill:tue,stroke:a?me(F({},a),{color:tue}):null,offset:[0,0]},{shape:{type:"circle",cx:g,cy:g,r:i*m},fill:[0,0,0],stroke:null,offset:[0,0]}]]}return IL([o],[f,f],{effectView:t.effectList,ignoreStrokeWidth:!0,masking:p,rotation:-90})}function Sx(e,t={}){const s=t.align==="horizontal",n=s?75:24,o=s?24:75,{width:a=n,height:l=o,gradient:c=!0}=t,h=window.devicePixelRatio,p=a*h,f=l*h,m=document.createElement("canvas");m.width=p,m.height=f,m.style.width=`${a}px`,m.style.height=`${l}px`;const g=m.getContext("2d"),y=s?p:0,x=s?0:f;if(c){const S=g.createLinearGradient(0,0,y,x),T=e.length,C=T===1?0:1/(T-1);e.forEach((A,O)=>S.addColorStop(O*C,A.toString())),g.fillStyle=S,g.fillRect(0,0,p,f)}else{const S=s?p/e.length:p,T=s?f:f/e.length;let C=0,A=0;for(const O of e)g.fillStyle=O.toString(),g.fillRect(C,A,S,T),C=s?C+S:0,A=s?0:A+T}const b=document.createElement("div");return b.style.width=`${a}px`,b.style.height=`${l}px`,Jtt(b,t==null?void 0:t.effectList),b.appendChild(m),b}function Jtt(e,t){if(!t)return;e.style.filter=Z3(t);const i=t.effects;if(i){for(const r of i)if((r==null?void 0:r.type)==="drop-shadow"){r.offsetX<0?e.style.marginLeft=`${Math.abs(r.offsetX)}px`:e.style.marginRight=`${r.offsetX}px`;break}}}async function VEe(e,t){switch(e.type){case"web-style":{const{previewWebStyleSymbol:i}=await import("./previewWebStyleSymbol.e173f9c2.js");return i(e,VEe,t)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:i}=await Promise.resolve().then(function(){return yDt});return i(e,t)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:i}=await import("./previewSymbol2D.8f454ad6.js");return i(e,t)}case"cim":{const{previewCIMSymbol:i}=await import("./previewCIMSymbol.1ee7a658.js");return i(e,t)}default:return}}function BEe(e){return e&&"opacity"in e?e.opacity*BEe(e.parent):1}async function Qtt(e,t){var x;if(!e)return;const i=e.sourceLayer,r=(x=_(t)&&t.useSourceLayer?i:e.layer)!=null?x:i,s=BEe(r);if(_(e.symbol)&&(!_(t)||t.ignoreGraphicSymbol!==!0)){const b=e.symbol.type==="web-style"?await e.symbol.fetchSymbol(me(F({},t),{cache:_(t)?t.webStyleCache:null})):e.symbol.clone();return c9(b,null,s),b}const n=_(t)&&t.renderer||r&&"renderer"in r&&r.renderer;let o=n&&"getSymbolAsync"in n?await n.getSymbolAsync(e,t):null;if(!o)return;if(o=o.type==="web-style"?await o.fetchSymbol(me(F({},t),{cache:_(t)?t.webStyleCache:null})):o.clone(),!("visualVariables"in n)||!n.visualVariables||!n.visualVariables.length)return c9(o,null,s),o;if("arcadeRequiredForVisualVariables"in n&&n.arcadeRequiredForVisualVariables&&(M(t)||M(t.arcade))){const b=F({},t);b.arcade=await sm(),t=b}const a=await Promise.resolve().then(function(){return o2}),l=[],c=[],h=[],p=[];for(const b of n.visualVariables)switch(b.type){case"color":l.push(b);break;case"opacity":c.push(b);break;case"rotation":p.push(b);break;case"size":b.target||h.push(b)}const f=!!l.length&&l[l.length-1],m=f?a.getColor(f,e,t):null,g=!!c.length&&c[c.length-1];let y=g?a.getOpacity(g,e,t):null;if(s!=null&&(y=y!=null?y*s:s),c9(o,m,y),h.length){const b=a.getAllSizes(h,e,t);await Qqe(o,b)}for(const b of p)Kqe(o,a.getRotationAngle(b,e,t),b.axis);return o}class wv{constructor(t,i){this.owner=i,this.properties={},this.afterDispatchHandle=null;for(const r in t){const s=t[r],n=new Tve(s,null,null,2,2);this.properties[r]={pool:n,acquired:[]}}this.afterDispatchHandle=Nve(()=>this._release())}destroy(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const t in this.properties){const i=this.properties[t];for(const r of i.acquired)Kne(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this.properties=null,this.owner=null}get(t){const i=this.owner._get(t),r=this.properties[t];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const t in this.properties){const i=this.properties[t];let r=0;for(const s of i.acquired)Kne(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}}const Ktt=ye("mac")?"Meta":"Ctrl",s6={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)s6[e]=String.fromCharCode(e);for(let e=1;e<25;e++)s6[111+e]=`F${e}`;for(let e=65;e<91;e++)s6[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function eit(e){if(e.key!==void 0)return Mc(e);const t=s6[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function tit(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class iit{constructor(t,i=[]){this.eventType=t,this.keyModifiers=i}matches(t){if(t.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=t.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}}const rue=ve.getLogger("esri.views.input.InputHandler");class qa{constructor(t){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const t in this._incoming){const i=this._incoming[t];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(t=>t.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(t){this._manager?rue.error("This InputHandler has already been registered with an InputManager"):(t.setEventCallback(i=>this._handleEvent(i)),t.setUninstallCallback(()=>this._onUninstall()),this._manager=t)}onUninstall(){}registerIncoming(t,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof t=="string"?new iit(t,s):t,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const p=this._incoming[h.match.eventType];if(p){const f=p.indexOf(h);p.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new rit(n,r,{onPause:a,onRemove:a,onResume:h=>{const p=this._incoming[h.match.eventType];p&&!p.includes(h)&&(p.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(t){if(this._outgoing[t])throw Error("There is already a callback registered for this outgoing InputEvent: "+t);const i=new sit(t,{onEmit:(r,s,n,o)=>{this._manager.emit(r.eventType,s,n,o)},onRemove:r=>{delete this._outgoing[r.eventType],this._manager.updateDependencies()}});return this._outgoing[t]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(t){this._manager.setPointerCapture(t,!0)}stopCapturingPointer(t){this._manager.setPointerCapture(t,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):rue.error("This InputHandler is not registered with an InputManager")}_handleEvent(t){const i=this._incoming[t.type];if(i){for(const r of i)if(r.match.matches(t)&&(r.callback(t),t.shouldStopPropagation()))break}}}class rit{constructor(t,i,r){this.match=t,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class sit{constructor(t,i){this.eventType=t,this._removed=!1,this._handler=i}emit(t,i,r){this._removed||this._handler.onEmit(this,t,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}}class nit extends qa{constructor(t){super(!0),this._onChange=t,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{const r=i.data.native.pointerType==="touch";this._setValue(r?"touch":"mouse",i.data.x,i.data.y)})}_setValue(t,i,r){t===this._value&&this._x===i&&this._y===r||(this._value=t,this._x=i,this._y=r,this._onChange(t,i,r))}}const q9=ve.getLogger("esri.views.input.InputManager");let e1=class extends Ee{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=Ktt,this.latestPointerType="mouse",this._propertiesPool=new wv({latestPointerLocation:ait},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}installHandlers(e,t,i=ts.INTERNAL){if(this._nameToGroup[e])return void q9.error("There is already an InputHandler group registered under the name `"+e+"`");if(t.length===0)return void q9.error("Can't register a group of zero handlers");const r={name:e,handlers:t.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=r;for(let s=r.handlers.length-1;s>=0;s--){const n=r.handlers[s];this._handlers.push(n),n.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(o,a,l,c,h)=>{this._emitInputEvent(n.priorityIndex+1,o,a,l,h,c)},setPointerCapture:(o,a)=>{this._setPointerCapture(r,n,o,a)},setEventCallback:o=>{n.eventCallback=o},setUninstallCallback:o=>{n.uninstallCallback=o},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(i=>{i.removed=!0,i.uninstallCallback()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):q9.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const r=this._handlers[i];r.priorityIndex=i,this._handlersPriority.push(r)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const r=this._handlersPriority[i];r.priorityIndex=i;let s=r.handler.hasSideEffects;if(!s){for(const n of r.handler.outgoingEventTypes)if(e.has(n)){s=!0;break}}if(s)for(const n of r.handler.incomingEventMatches){e.add(n.eventType);for(const o of n.keyModifiers)tit(o)||t.add(o)}r.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,i){this._get("latestPointerType")!==e&&this._set("latestPointerType",e);const r=this._get("latestPointerLocation");if(M(r)||r.x!==t||r.y!==i){const s=this._propertiesPool.get("latestPointerLocation");s.x=t,s.y=i,this._set("latestPointerLocation",s)}}_onEventReceived(e,t){if(e==="pointer-capture-lost"){const s=t;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,t);const i=this.test.timestamp!=null?this.test.timestamp:t.native?t.native.timestamp:void 0,r=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,r)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const r=()=>{if(!i){const o=new Set;this._activeKeyModifiers.forEach(a=>{o.add(a)}),this._activeKeyModifiers=o,i=!0}},s=(o,a)=>{a&&!this._activeKeyModifiers.has(o)?(r(),this._activeKeyModifiers.add(o)):!a&&this._activeKeyModifiers.has(o)&&(r(),this._activeKeyModifiers.delete(o))};if(e==="key-down"||e==="key-up"){const o=t.key;this._keyModifiers.has(o)&&s(o,e==="key-down")}const n=t.native;s("Alt",!(!n||!n.altKey)),s("Ctrl",!(!n||!n.ctrlKey)),s("Shift",!(!n||!n.shiftKey)),s("Meta",!(!n||!n.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new nit((e,t,i)=>this._setLatestPointer(e,t,i)),this.installHandlers("input-manager-logic",[this._latestPointerHandler],ts.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,ts.INTERNAL)}_setPointerCapture(e,t,i,r){const s=e.name+"-"+t.priorityIndex,n=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,n),r?(n.add(s),n.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):n.has(s)&&(n.delete(s),n.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,i,r){this._emitInputEvent(0,e,t,i,r)}_emitInputEvent(e,t,i,r,s,n){const o=r!==void 0?r:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=s!==void 0&&s,l={event:new oit(t,i,o,n||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new xU,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:i}=this._currentPropagation.events.pop(),r=t.data&&t.data.eventId;if(!(r!=null&&this._stoppedPropagationEventIds.has(r)))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){r!=null&&this._stoppedPropagationEventIds.add(r);break}if(t.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new xU;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const r of t.handler.incomingEventMatches){if(i.eventType!==r.eventType)continue;const s=i.keyModifiers.filter(n=>r.keyModifiers.includes(n));if(s.length===i.keyModifiers.length!=(s.length===r.keyModifiers.length))return i.keyModifiers.length>r.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let r=0;for(;r<t.length&&this._compareHandlerPriority(i,t[r])>=0;)r++;t.splice(r,0,i)}return t}get debug(){const e=t=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=i};return{injectEvent:(t,i)=>{e(()=>{this._onEventReceived(t,i)})},disablePointerCapture:e}}};u([d({readOnly:!0})],e1.prototype,"hasPendingInputs",null),u([d()],e1.prototype,"eventSource",void 0),u([d()],e1.prototype,"recognizers",void 0),u([d({readOnly:!0})],e1.prototype,"latestPointerType",void 0),u([d({readOnly:!0})],e1.prototype,"latestPointerLocation",void 0),e1=u([L("esri.views.input.InputManager")],e1);class oit{constructor(t,i,r,s,n){this.type=t,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=M1.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=M1.STOPPED}shouldStopPropagation(){return(this._propagationState&M1.STOPPED)!=0}async(t){this._propagationState|=M1.PAUSED;const i=(r,s)=>{this._propagationState&=~M1.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof t=="function"?t():t).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(t){return!!(this._propagationState&M1.PAUSED)&&(this._resumeCallback=t,!0)}preventDefault(){this.data.native.preventDefault()}}var M1;(function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"})(M1||(M1={}));const ts={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};class ait{}function sue(e){return e&&typeof e.highlight=="function"}function lit(e){return e&&typeof e.maskOccludee=="function"}function p5t(e,t,i){return M(e)||e>i&&(t===0||e<t)}function f5t(e,t){return e>0||t>0}function m5t(e){var i,r;const t=e.effectiveScaleRange;return{minScale:(i=t==null?void 0:t.minScale)!=null?i:0,maxScale:(r=t==null?void 0:t.maxScale)!=null?r:0}}const n6={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},IT=new iO({id:"zoom-to-feature",title:"{messages.zoom}",className:n6.iconZoom}),nue=new iO({id:"remove-selected-feature",title:"{messages.remove}",className:n6.iconTrash}),FC=new iO({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:n6.iconZoom}),kC=new iO({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:n6.iconBrowseClusteredFeatures}),cit="esri.widgets.Popup.PopupViewModel",gz=ve.getLogger(cit),uit=e=>{const{event:t,view:i}=e,{action:r}=t,s=i&&i.popup;if(!r)return Promise.reject(new W("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new W("trigger-action:missing-arguments","view.popup is missing"));const{disabled:n,id:o}=r;if(!o)return Promise.reject(new W("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new W("trigger-action:invalid-action","Action is disabled"));if(o===IT.id)return dit(s.viewModel).catch(sU);if(o===FC.id)return pit(s.viewModel);if(o===kC.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,o===nue.id){s.close();const{selectedFeature:a}=s;if(!a)return Promise.reject(new W(`trigger-action:${nue.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):i.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function GEe(e){const{selectedFeature:t,location:i,view:r}=e;return r?r.type==="3d"?t||i:e.get("selectedFeature.geometry")||i:null}function oT(e){var t,i;return(e==null?void 0:e.isAggregate)&&((i=(t=e==null?void 0:e.sourceLayer)==null?void 0:t.featureReduction)==null?void 0:i.type)==="cluster"}function hit(e,t){if((t==null?void 0:t.type)!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let r=!1;return i.whenGraphicBounds(e,{useViewElevation:!0}).then(s=>{r=!s||!s.boundingBox||s.boundingBox[0]===s.boundingBox[3]&&s.boundingBox[1]===s.boundingBox[4]&&s.boundingBox[2]===s.boundingBox[5]}).catch(()=>{const s=new W("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});gz.error(s)}),r}return!0}async function dit(e){const{location:t,selectedFeature:i,view:r,zoomFactor:s}=e,n=GEe(e);if(!n){const c=new W("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:r});throw gz.error(c),c}const o=r.scale/s,a=e.get("selectedFeature.geometry")||t,l=a&&a.type==="point"&&hit(i,r);IT.active=!0,IT.disabled=!0;try{await e.view.goTo({target:n,scale:l?o:void 0})}finally{IT.active=!1,IT.disabled=!1,e.zoomToLocation=null,l&&(e.location=a)}}async function pit(e){const{selectedFeature:t,view:i}=e;if((i==null?void 0:i.type)!=="2d"){const a=new W("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw gz.error(a),a}if(!oT(t)){const a=new W("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw gz.error(a),a}const r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],FC.active=!0,FC.disabled=!0;const{extent:o}=await s.queryExtent(n);await i.goTo({target:o}),FC.active=!1,FC.disabled=!1}async function fit(e){const{selectedFeature:t,view:i}=e,r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()];const{extent:o}=await s.queryExtent(n);e.selectedClusterBoundaryFeature.geometry=o,i.graphics.add(e.selectedClusterBoundaryFeature)}async function mit(e){const{selectedFeature:t,view:i}=e,r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],kC.active=!0,kC.disabled=!0;const{features:o}=await s.queryFeatures(n);kC.active=!1,kC.disabled=!1,i.popup.open({features:[t].concat(o),featureMenuOpen:!0})}function git(e){const t=e.features.filter(i=>oT(i));t.length&&(e.features=t)}const qte=e=>{let t=class extends e{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return u([d()],t.prototype,"goToOverride",void 0),u([d()],t.prototype,"view",void 0),t=u([L("esri.widgets.support.GoTo")],t),t},XI=nt.ofType({key:"type",defaultKeyValue:"button",base:XV,typeMap:{button:iO,toggle:Z_e}}),yit=()=>[IT.clone()],vit=()=>[FC.clone(),kC.clone()],jEe="esri.widgets.Popup.PopupViewModel",bN=ve.getLogger(jEe);let Zi=class extends qte(wEe){constructor(e){super(e),this._handles=new Nt,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new XI,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new Ha({symbol:new wp({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}initialize(){this._handles.add([re(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),re(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),re(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),re(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.animation)==null?void 0:t.state},e=>this._animationStateChange(e)),re(()=>this.location,e=>this._locationChange(e)),re(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),re(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),re(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),re(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>uit({event:e,view:this.view})),Jn(()=>!this.waitingForResult,()=>this._waitingForResultChange(),Ui),re(()=>{var e,t;return[this.features,(e=this.view)==null?void 0:e.map,(t=this.view)==null?void 0:t.spatialReference]},()=>this._updateFeatureVMs()),re(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),Jn(()=>!this.visible,()=>this.browseClusterEnabled=!1),re(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new XI;e.removeAll();const{actions:t,defaultActions:i,defaultPopupTemplateEnabled:r,includeDefaultActions:s,selectedFeature:n}=this,o=s?i.concat(t):t,a=n&&(typeof n.getEffectivePopupTemplate=="function"&&n.getEffectivePopupTemplate(r)||n.popupTemplate),l=a&&a.actions,c=a&&a.overwriteActions?l:l?l.concat(o):o;return c&&c.filter(Boolean).forEach(h=>e.add(h)),e}get defaultActions(){const e=this._get("defaultActions")||new XI;return e.removeAll(),e.addMany(oT(this.selectedFeature)?vit():yit()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:r,selectedFeatureIndex:s}=this,n=r&&t.length;n&&i&&s===-1?this.selectedFeatureIndex=0:n&&s!==-1||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=$g(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(!!this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(t=>{this._pendingPromises.add(t);const i=s=>{this._pendingPromises.has(t)&&this._updateFeatures(s),this._updatePendingPromises(t)},r=()=>this._updatePendingPromises(t);t.then(i,r)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=GEe(this);if(!t){const i=new W("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return bN.error(i),Promise.reject(i)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e){const r=new W("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return bN.error(r),Promise.reject(r)}return i.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t=me(F({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},e),{visible:!0}),{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);const r=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const s of r)delete t[s];this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){git(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;(e==null?void 0:e.type)==="2d"?oT(t)?(await fit(this),await mit(this)):bN.warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):bN.warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}_animationStateChange(e){this.zoomToLocation||(IT.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var t;const e=(t=this.view)==null?void 0:t.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(oT(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=[this.selectedFeature])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:r,featureViewModels:s}=this;if(i===null)return;const n=((i-1)*r+t)%t,o=n+r;s.slice(n,o).forEach((a,l)=>{a&&!a.graphic&&(a.graphic=e[n+l])})}async _selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:i,view:r}=this;if(this.browseClusterEnabled)return this._selectedClusterFeature&&(r.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),oT(e)?void 0:(e.symbol=await Qtt(e),this._selectedClusterFeature=e,void r.graphics.add(this._selectedClusterFeature));!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then(()=>{this.location=r.center.clone()}):this.location=this._getPointFromGeometry(e.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(t=>{const{clientOnlyGraphics:i,promisesPerLayerView:r}=t,s=Promise.resolve(i),n=r.map(o=>o.promise);this.promises=[s,...n]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i}=this;if(oT(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const r=i.slice(0),s=[];t.forEach((n,o)=>{var l,c;if(!n)return;let a=null;if(r.some((h,p)=>(h&&h.graphic===n&&(a=h,r.splice(p,1)),!!a)),a)s[o]=a;else{const h=new kte({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(l=this.view)==null?void 0:l.spatialReference,graphic:n===e?n:null,map:(c=this.view)==null?void 0:c.map,view:this.view});s[o]=h}}),r.forEach(n=>n&&!n.destroyed&&n.destroy()),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:t}=this;return t&&e&&typeof t.toScreen=="function"?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:i}=this;if(t.remove(e),i&&this.view){const r=this.view.on("click",s=>{s.pointerType==="mouse"&&s.button!==0||this._fetchFeaturesAndOpen(s)},ts.WIDGET);t.add(r,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const i=new AbortController,{signal:r}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:r,event:t});return s.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:i}=e,{view:r}=this;this._fetchFeaturesWithController(t,e).then(s=>{const{clientOnlyGraphics:n,promisesPerLayerView:o,location:a}=s,l=[Promise.resolve(n),...o.map(c=>c.promise)];return r.popup.open({location:a||i,promises:l}),s})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(e){return M(e)?null:e.type==="point"?e:e.type==="extent"?e.center:e.type==="polygon"?e.centroid:e.type==="multipoint"||e.type==="polyline"?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:i}=e;return(i==null?void 0:i.type)==="map-notes"||(i==null?void 0:i.type)==="subtype-group"?i:t}_getHighlightTarget(e,t){const i=t.type==="imagery"?void 0:"objectIdField"in t&&t.objectIdField,r=e.attributes;return r&&i&&r[i]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:t,view:i,activeFeature:r,visible:s}=this;if(!(r&&i&&t&&s))return;const n=this._getHighlightLayer(r);if(!(n&&n instanceof _S))return;const o=this._getLayerView(i,n);this._highlightActiveFeaturePromise=o;const a=await o;if(!(a&&sue(a)&&this._highlightActiveFeaturePromise===o&&this.activeFeature&&this.highlightEnabled))return;const l=a.highlight(this._getHighlightTarget(r,n));this._handles.add(l,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:i,view:r,visible:s}=this;if(!(t&&r&&i&&s))return;const n=this._getHighlightLayer(t);if(!(n&&n instanceof _S))return;const o=this._getLayerView(r,n);this._highlightSelectedFeaturePromise=o;const a=await o;if(!(a&&sue(a)&&this._highlightSelectedFeaturePromise===o&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l=a.highlight(this._getHighlightTarget(t,n));this._handles.add(l,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const i=e.filter(r=>!t.includes(r));this.features=t.concat(i)}};u([d()],Zi.prototype,"featurePage",void 0),u([d()],Zi.prototype,"isLoadingFeature",null),u([d({type:XI})],Zi.prototype,"actions",void 0),u([d({readOnly:!0})],Zi.prototype,"active",null),u([d()],Zi.prototype,"activeFeature",void 0),u([d({readOnly:!0})],Zi.prototype,"allActions",null),u([d({type:Boolean})],Zi.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],Zi.prototype,"autoCloseEnabled",void 0),u([d()],Zi.prototype,"autoOpenEnabled",void 0),u([d()],Zi.prototype,"browseClusterEnabled",void 0),u([d()],Zi.prototype,"content",void 0),u([d({type:XI,readOnly:!0})],Zi.prototype,"defaultActions",null),u([d({readOnly:!0})],Zi.prototype,"featureCount",null),u([d()],Zi.prototype,"features",null),u([d()],Zi.prototype,"featuresPerPage",void 0),u([d()],Zi.prototype,"featureViewModelAbilities",void 0),u([d({readOnly:!0})],Zi.prototype,"featureViewModels",void 0),u([d()],Zi.prototype,"highlightEnabled",void 0),u([d()],Zi.prototype,"includeDefaultActions",void 0),u([d({type:dt})],Zi.prototype,"location",null),u([d({readOnly:!0})],Zi.prototype,"pendingPromisesCount",null),u([d({readOnly:!0})],Zi.prototype,"selectedClusterBoundaryFeature",void 0),u([d({readOnly:!0})],Zi.prototype,"waitingForResult",null),u([d({readOnly:!0})],Zi.prototype,"promiseCount",null),u([d()],Zi.prototype,"promises",null),u([d({value:null,readOnly:!0})],Zi.prototype,"selectedFeature",null),u([d({value:-1})],Zi.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],Zi.prototype,"selectedFeatureViewModel",null),u([d({readOnly:!0})],Zi.prototype,"state",null),u([d()],Zi.prototype,"title",void 0),u([d()],Zi.prototype,"updateLocationEnabled",void 0),u([d()],Zi.prototype,"view",void 0),u([d()],Zi.prototype,"visible",void 0),u([d()],Zi.prototype,"zoomFactor",void 0),u([d()],Zi.prototype,"zoomToLocation",void 0),u([d()],Zi.prototype,"centerAtLocation",null),Zi=u([L(jEe)],Zi);const HEe=Zi,oue="selected-index",_it=0,aue="popup-spinner",Ge={iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:"esri-popup",widget:"esri-widget",main:"esri-popup__main-container",loadingContainer:"esri-popup__loading-container",isCollapsible:"esri-popup--is-collapsible",isCollapsed:"esri-popup--is-collapsed",shadow:"esri-popup--shadow",isDocked:"esri-popup--is-docked",isDockedTopLeft:"esri-popup--is-docked-top-left",isDockedTopCenter:"esri-popup--is-docked-top-center",isDockedTopRight:"esri-popup--is-docked-top-right",isDockedBottomLeft:"esri-popup--is-docked-bottom-left",isDockedBottomCenter:"esri-popup--is-docked-bottom-center",isDockedBottomRight:"esri-popup--is-docked-bottom-right",alignTopCenter:"esri-popup--aligned-top-center",alignBottomCenter:"esri-popup--aligned-bottom-center",alignTopLeft:"esri-popup--aligned-top-left",alignBottomLeft:"esri-popup--aligned-bottom-left",alignTopRight:"esri-popup--aligned-top-right",alignBottomRight:"esri-popup--aligned-bottom-right",isFeatureMenuOpen:"esri-popup--feature-menu-open",isActionsMenuOpen:"esri-popup--actions-menu-open",hasFeatureUpdated:"esri-popup--feature-updated",header:"esri-popup__header",headerButtons:"esri-popup__header-buttons",headerContainer:"esri-popup__header-container",headerContainerButton:"esri-popup__header-container--button",headerTitle:"esri-popup__header-title",content:"esri-popup__content",footer:"esri-popup__footer",footerHasPagination:"esri-popup__footer--has-pagination",footerHasActions:"esri-popup__footer--has-actions",footerHasActionsMenu:"esri-popup__footer--has-actions-menu",button:"esri-popup__button",buttonDisabled:"esri-popup__button--disabled",buttonDock:"esri-popup__button--dock",icon:"esri-popup__icon",iconDock:"esri-popup__icon--dock-icon",inlineActionsContainer:"esri-popup__inline-actions-container",actionsMenuButton:"esri-popup__actions-menu-button",actions:"esri-popup__actions",action:"esri-popup__action",actionImage:"esri-popup__action-image",actionText:"esri-popup__action-text",actionToggle:"esri-popup__action-toggle",actionToggleOn:"esri-popup__action-toggle--on",pointer:"esri-popup__pointer",pointerDirection:"esri-popup__pointer-direction",navigation:"esri-popup__navigation",paginationPrevious:"esri-popup__pagination-previous",paginationNext:"esri-popup__pagination-next",paginationPreviousIconLTR:"esri-popup__pagination-previous-icon",paginationPreviousIconRTL:"esri-popup__pagination-previous-icon--rtl",paginationNextIconLTR:"esri-popup__pagination-next-icon",paginationNextIconRTL:"esri-popup__pagination-next-icon--rtl",featureMenu:"esri-popup__feature-menu",featureMenuList:"esri-popup__feature-menu-list",featureMenuItem:"esri-popup__feature-menu-item",featureMenuViewport:"esri-popup__feature-menu-viewport",featureMenuHeader:"esri-popup__feature-menu-header",featureMenuNote:"esri-popup__feature-menu-note",featureMenuSelected:"esri-popup__feature-menu-item--selected",featureMenuButton:"esri-popup__feature-menu-button",featureMenuTitle:"esri-popup__feature-menu-title",featureMenuObserver:"esri-popup__feature-menu-observer",featureMenuLoader:"esri-popup__feature-menu-loader",collapseButton:"esri-popup__collapse-button"},lue={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},cue="esri-popup";function Oy(e,t){return t===void 0?`${cue}__${e}`:`${cue}__${e}-${t}`}const qEe="esri.widgets.Popup",uue=ve.getLogger(qEe),hue={closeButton:!0,featureNavigation:!0};let Ft=class extends _Ee(Yr){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new Nt,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([i])=>{(i==null?void 0:i.isIntersecting)&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=gL(()=>this._displaySpinner(),_it),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new HEe,this.visible=null,this.visibleElements=F({},hue),this._addSelectedFeatureIndexHandle(),this.own([re(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},()=>this._positionContainer()),re(()=>{var i;return[(i=this.viewModel)==null?void 0:i.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),re(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},(i,r)=>{!!i!=!!r&&this.reposition()}),re(()=>{var i,r,s,n,o,a;return[(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.padding,(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.size,(o=this.viewModel)==null?void 0:o.active,(a=this.viewModel)==null?void 0:a.location,this.alignment]},()=>this.reposition()),re(()=>this.spinnerEnabled,i=>this._spinnerEnabledChange(i)),re(()=>{var i,r;return(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.size},(i,r)=>this._updateDockEnabledForViewSize(i,r)),re(()=>{var i;return(i=this.viewModel)==null?void 0:i.view},(i,r)=>this._viewChange(i,r)),re(()=>{var i,r;return(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.ready},(i,r)=>this._viewReadyChange(i,r)),re(()=>{var i,r;return[(i=this.viewModel)==null?void 0:i.waitingForResult,(r=this.viewModel)==null?void 0:r.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),re(()=>{var i,r,s,n;return[(r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.title,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setTitleFromFeatureWidget()),re(()=>{var i,r,s,n;return[(r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.content,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setContentFromFeatureWidget()),Jn(()=>!this.collapsed,()=>{var i,r;((r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),os(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},"change",()=>this._watchActions()),re(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},()=>this._watchActions(),Et),re(()=>{var i;return(i=this.viewModel)==null?void 0:i.featureViewModels},()=>this._featureMenuViewportScrollTop())])}destroy(){var e,t;this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(t=this._featureMenuIntersectionObserver)==null||t.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var e,t,i,r,s,n,o;return!!(this.selectedFeatureWidget?((t=(e=this.selectedFeatureWidget)==null?void 0:e.viewModel)==null?void 0:t.waitingForContent)||((r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.state)==="error"||((n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.content):(o=this.viewModel)==null?void 0:o.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||lue}set dockOptions(e){const t=F({},lue),i=this.get("viewModel.view.breakpoints"),r={};i&&(r.width=i.xsmall,r.height=i.xsmall);const s=F(F({},t),e),n=F(F({},t.breakpoint),r),{breakpoint:o}=s;o===!0?s.breakpoint=n:typeof o=="object"&&(s.breakpoint=F(F({},n),o)),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:i}=this,{selectedFeatureViewModel:r}=this.viewModel,s=me(F({},t),{title:!1});return r?(e?(e.viewModel=r,e.visibleElements=s):this._feature=new Het({headingLevel:i+1,viewModel:r,visibleElements:s}),this._feature):null}castVisibleElements(e){return F(F({},hue),e)}blur(){const{active:e}=this.viewModel;e||uue.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||uue.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var s,n;this._handles.remove(oue);const t=!!e&&!!e.featureMenuOpen,i=!!e&&!!e.actionsMenuOpen,r={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:i,featureMenuOpen:t};((n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint)==="xsmall"&&(r.collapsed=!0),this.set(r),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var g,y,x,b;const{actionsMenuOpen:e,dockEnabled:t,featureMenuVisible:i,dividedActions:r,currentAlignment:s,currentDockPosition:n}=this,{active:o}=this.viewModel,{menuActions:a}=r,l=o&&a.length>1&&e,c=o&&t,h=o&&!t,p=(y=(g=this.selectedFeature)==null?void 0:g.layer)==null?void 0:y.title,f=(b=(x=this.selectedFeature)==null?void 0:x.layer)==null?void 0:b.id,m={[Ge.alignTopCenter]:s==="top-center",[Ge.alignBottomCenter]:s==="bottom-center",[Ge.alignTopLeft]:s==="top-left",[Ge.alignBottomLeft]:s==="bottom-left",[Ge.alignTopRight]:s==="top-right",[Ge.alignBottomRight]:s==="bottom-right",[Ge.isDocked]:c,[Ge.shadow]:h,[Ge.isDockedTopLeft]:n==="top-left",[Ge.isDockedTopCenter]:n==="top-center",[Ge.isDockedTopRight]:n==="top-right",[Ge.isDockedBottomLeft]:n==="bottom-left",[Ge.isDockedBottomCenter]:n==="bottom-center",[Ge.isDockedBottomRight]:n==="bottom-right",[Ge.isFeatureMenuOpen]:i,[Ge.isActionsMenuOpen]:l};return N("div",{class:this.classes(Ge.base,m),role:"presentation","data-layer-title":p,"data-layer-id":f,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},o?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return N("span",{"aria-hidden":"true",class:this.classes(Ge.icon,Ge.iconLoading,Ge.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?N("div",{key:Oy("loading-container"),role:"presentation",class:Ge.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=jl(this.container),t={[Ge.iconRightTriangleArrow]:e,[Ge.paginationPreviousIconRTL]:e,[Ge.iconLeftTriangleArrow]:!e,[Ge.paginationPreviousIconLTR]:!e};return N("span",{"aria-hidden":"true",class:this.classes(Ge.icon,t)})}renderPreviousButton(){const{messages:e}=this;return N("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(Ge.button,Ge.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=jl(this.container),t={[Ge.iconLeftTriangleArrow]:e,[Ge.paginationNextIconRTL]:e,[Ge.iconRightTriangleArrow]:!e,[Ge.paginationNextIconLTR]:!e};return N("span",{"aria-hidden":"true",class:this.classes(Ge.icon,t)})}renderNextButton(){const{messages:e}=this;return N("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(Ge.button,Ge.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:r,selectedFeatureIndex:s}=this.viewModel;return N("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(Ge.button,Ge.featureMenuButton),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(r,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={[Ge.iconUndock]:e,[Ge.iconDock]:!e,[Ge.iconDockToRight]:!e&&(t==="top-right"||t==="bottom-right"),[Ge.iconDockToLeft]:!e&&(t==="top-left"||t==="bottom-left"),[Ge.iconDockToTop]:!e&&t==="top-center",[Ge.iconDockToBottom]:!e&&t==="bottom-center"};return N("span",{"aria-hidden":"true",class:this.classes(i,Ge.icon)})}renderDockButton(){var s,n,o;const{dockEnabled:e,messages:t}=this,i=(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint,r=e?t.undock:t.dock;return i!=="xsmall"&&((o=this.dockOptions)==null?void 0:o.buttonEnabled)?N("div",{role:"button","aria-label":r,title:r,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(Ge.button,Ge.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:r,messagesCommon:s}=this,n={[Ge.headerContainerButton]:i},o=N(J0,{level:this.headingLevel,class:Ge.headerTitle,innerHTML:e}),a=i?N("button",{key:`${e}--collapsible`,id:t,title:r?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Ge.headerContainer,n),"aria-expanded":r?"false":"true",onclick:this._toggleCollapsed,type:"button"},o):N("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Ge.headerContainer,n)},o);return e?a:null}renderCloseIcon(){return N("span",{"aria-hidden":"true",class:this.classes(Ge.icon,Ge.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?N("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:Ge.button,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return N("header",{class:Ge.header},this.renderTitle(),N("div",{class:Ge.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i}=this,{content:r}=this.viewModel;return t&&!i?N("article",{key:r,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:Ge.content},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r,messagesCommon:s}=this,n=i?s.close:s.open,{menuActions:o}=r;return o.length?N("div",{key:Oy("actions-menu-button"),class:this.classes(Ge.button,Ge.actionsMenuButton),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":n,title:n},N("span",{"aria-hidden":"true",class:Ge.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r}=this,{menuActions:s}=r;return s.length&&i?N("ul",{id:e,role:"menu","aria-labelledby":t,key:Oy("actions"),class:Ge.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(n=>this.renderAction({action:n,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map(t=>this.renderAction({action:t,type:"inline"}))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,r=!!t.length;return i||r?N("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":r.toString(),class:Ge.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?N("section",{key:Oy("navigation"),class:this.classes(Ge.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:r}=t,s=!!i.length,n=!!r.length,o={[Ge.footerHasPagination]:e,[Ge.footerHasActions]:s,[Ge.footerHasActionsMenu]:n};return e||s?N("div",{key:Oy("feature-buttons"),class:this.classes(Ge.footer,o)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:i}=this.viewModel,r=xc(e.selectedFeatures,{total:t.length});return N("section",{key:Oy("menu"),class:Ge.featureMenu},N("strong",{class:Ge.featureMenuHeader},r),N("nav",{bind:this,class:Ge.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:AT},this.renderFeatureMenu(),N("div",{class:Ge.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?N("div",{class:Ge.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:N("div",{key:Oy("pointer"),class:Ge.pointer,role:"presentation"},N("div",{class:this.classes(Ge.pointerDirection,Ge.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:r,contentId:s,collapsible:n,hasContent:o,contentCollapsed:a,visibleElements:l}=this,{title:c}=this.viewModel,h=t==="bottom-left"||t==="bottom-center"||t==="bottom-right"||i==="top-left"||i==="top-center"||i==="top-right",p=t==="top-left"||t==="top-center"||t==="top-right"||i==="bottom-left"||i==="bottom-center"||i==="bottom-right",f={[Ge.shadow]:e,[Ge.isCollapsible]:n,[Ge.isCollapsed]:a};return N("div",{class:this.classes(Ge.main,Ge.widget,f),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":c?r:"","aria-describedby":o&&!a?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},h?this.renderFooter():null,h?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null)}renderContent(){var t;const e=(t=this.viewModel)==null?void 0:t.content;return e?typeof e=="string"?N("div",{key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return N("span",{key:"text",class:Ge.actionText},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),r={[Ge.iconLoading]:e.active,[Ge.rotating]:e.active,[Ge.icon]:!!t,[Ge.actionImage]:!e.active&&!!i};return t&&(r[t]=!e.active),N("span",{key:"icon","aria-hidden":"true",class:this.classes(Ge.icon,r),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,type:i}=e,r=this._getActionTitle(t),s={[Ge.action]:t.type!=="toggle",[Ge.actionToggle]:t.type==="toggle",[Ge.actionToggleOn]:t.type==="toggle"&&t.value,[Ge.buttonDisabled]:t.disabled},n=[this.renderActionIcon(t),this.renderActionText(r)],o=i==="menu-item"?N("li",{key:t.uid,role:"menuitem",tabIndex:0,title:r,"aria-label":r,class:this.classes(Ge.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n):N("div",{key:t.uid,role:"button",tabIndex:0,title:r,"aria-label":r,class:this.classes(Ge.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n);return t.visible?o:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:r}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:n}=this.viewModel,o=e===n,a={[Ge.featureMenuSelected]:o},l=o?N("span",{key:Oy(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:Ge.iconCheckMark}):null,c=N("span",{innerHTML:e.title||r.untitled});return N("li",{role:"menuitem",tabIndex:-1,key:Oy(`feature-menu-feature-${s}`),class:this.classes(a,Ge.featureMenuItem),bind:this,"data-feature-index":t,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},N("span",{class:Ge.featureMenuTitle},c,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?N("ol",{class:Ge.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter(i=>!!i.graphic).map((i,r)=>this.renderFeatureMenuItem(i,r))):null}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:r}=this,{id:s}=e,n=i==null?void 0:i.attributes,o=s==="zoom-to-feature"?xc(e.title,{messages:t}):s==="remove-selected-feature"?xc(e.title,{messages:r}):s==="zoom-to-clustered-features"||s==="browse-clustered-features"?xc(e.title,{messages:t}):e.title;return o&&n?xc(o,n):o}_getActionClass(e){const{selectedFeature:t}=this,i=t==null?void 0:t.attributes,{className:r,image:s}=e,n=s||r?r:Ge.iconDefaultAction;return n&&i?xc(n,i):n}_getActionImage(e){const{selectedFeature:t}=this,i=t==null?void 0:t.attributes,{image:r}=e;return r&&i?xc(r,i):r}_createFeatureUpdatedAnimation(){return lje("enter",Ge.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if(typeof e!="number")return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach(i=>{this._handles.add(re(()=>[i.uid,i.active,i.className,i.disabled,i.id,i.title,i.image,i.visible],()=>this.scheduleRender()),t)})}_divideActions(){const{allActions:e}=this.viewModel,t=e.filter(n=>n.visible),i=this._getInlineActionCount(),r=i===null,s=i===0;return{inlineActions:r?t.slice(0):s?new nt:t.slice(0,i),menuActions:r?new nt:s?t.slice(0):t.slice(i)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var i,r;const{selectedFeatureWidget:e,messagesCommon:t}=this;e&&(this.viewModel.title=((i=e.viewModel)==null?void 0:i.state)==="error"?t.errorMessage:((r=e.viewModel)==null?void 0:r.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){Mc(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){Mc(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:t}=this,i=e.currentTarget["data-feature-index"];t.activeFeature=t.features[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const t=Mc(e),{_featureMenuNode:i}=this,r=e.currentTarget["data-feature-index"];if(!i)return;const s=i.querySelectorAll("li"),n=s.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(r+1+n)%n].focus()):(e.stopPropagation(),s[(r-1+n)%n].focus())}_handleActionMenuItemKeyup(e){const t=Mc(e),{_actionsMenuNode:i}=this,r=e.currentTarget.dataset.actionUid,{menuActions:s}=this.dividedActions,n=s.findIndex(l=>l.uid===r);if(!i)return;const o=i.querySelectorAll("li"),a=o.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),o[o.length-1].focus()):(e.stopPropagation(),o[0].focus()):(e.stopPropagation(),o[(n+1+a)%a].focus()):(e.stopPropagation(),o[(n-1+a)%a].focus())}_handleMainKeyup(e){const t=Mc(e);t==="ArrowLeft"&&(e.stopPropagation(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e.shouldFocus&&(await gv(()=>{var t;return((t=this.viewModel)==null?void 0:t.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=re(()=>{var t;return(t=this.viewModel)==null?void 0:t.selectedFeatureIndex},(t,i)=>this._selectedFeatureIndexUpdated(t,i));this._handles.add(e,oue)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&e!==-1&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:r,side:s,view:n}=e;if(isNaN(i)||isNaN(t)||!n||!r)return!1;const o=n.padding;return s==="right"&&r.x+i/2>n.width-o.right||s==="left"&&r.x-i/2<o.left||s==="top"&&r.y-t<o.top||s==="bottom"&&r.y+t>n.height-o.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:r,viewModel:s}=this,{screenLocation:n,view:o}=s;if(M(n)||!o||!i)return"top-center";if(!this._isScreenLocationWithinView(n,o))return this._get("currentAlignment")||"top-center";function a(T){return parseInt(T.replace(/[^-\d\.]/g,""),10)}const l=r?window.getComputedStyle(r,null):null,c=l?a(l.getPropertyValue("max-height")):0,h=l?a(l.getPropertyValue("height")):0,{height:p,width:f}=i.getBoundingClientRect(),m=f+t,g=Math.max(p,c,h)+t,y=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"right",view:o}),x=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"left",view:o}),b=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"top",view:o}),S=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"bottom",view:o});return x?b?"bottom-right":"top-right":y?b?"bottom-left":"top-left":b?S?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return jl(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var o;if(e!=="auto")return e;const t=(o=this.viewModel)==null?void 0:o.view,i=jl(this.container)?"top-left":"top-right";if(!t)return i;const r=t.padding||{left:0,right:0,top:0,bottom:0},s=t.width-r.left-r.right,{breakpoints:n}=t;return n&&s<=n.xsmall?"bottom-center":i}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:i}=e.getBoundingClientRect(),r=this._calculatePositionStyle(t,i);r&&(e.style.top=r.top,e.style.left=r.left,e.style.bottom=r.bottom,e.style.right=r.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,t,i,r){const{currentAlignment:s,_pointerOffsetInPx:n}=this,o=r/2,a=i.height-t,l=i.width-e,{padding:c}=this.view;return s==="bottom-center"?{top:t+n-c.top,left:e-o-c.left}:s==="top-left"?{bottom:a+n-c.bottom,right:l+n-c.right}:s==="bottom-left"?{top:t+n-c.top,right:l+n-c.right}:s==="top-right"?{bottom:a+n-c.bottom,left:e+n-c.left}:s==="bottom-right"?{top:t+n-c.top,left:e+n-c.left}:s==="top-center"?{bottom:a+n-c.bottom,left:e-o-c.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if(M(e)||!t)return;const s=this._calculateFullWidth(t),n=this._calculateAlignmentPosition(e.x,e.y,r,s);return n?{top:n.top!==void 0?`${n.top}px`:"auto",left:n.left!==void 0?`${n.left}px`:"auto",bottom:n.bottom!==void 0?`${n.bottom}px`:"auto",right:n.right!==void 0?`${n.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const i=this.get("viewModel.view");this._wireUpView(i)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[r,s]=e,[n,o]=t,{width:a,height:l}=i;return r<=a&&n>a||r>a&&n<=a||s<=l&&o>l||s>l&&o<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,s=i.top+i.bottom,n=[],o=[];n[0]=e[0]-r,n[1]=e[1]-s,o[0]=t[0]-r,o[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(n,o,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var a,l;const t=e.breakpoint,i=(l=(a=this.viewModel)==null?void 0:a.view)==null?void 0:l.ui;if(!i)return!1;const{width:r,height:s}=i;if(isNaN(r)||isNaN(s))return!1;const n=t.hasOwnProperty("width")&&r<=t.width,o=t.hasOwnProperty("height")&&s<=t.height;return n||o}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?xc(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,aue),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new Wet({view:e}),e.ui.add(this._spinner,{key:aue,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget.dataset.actionUid,{allActions:i}=this.viewModel,r=i.findIndex(n=>n.uid===t),s=i.getItemAt(r);s&&s.type==="toggle"&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(r)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};u([d({readOnly:!0})],Ft.prototype,"actionsMenuId",null),u([d({readOnly:!0})],Ft.prototype,"actionsMenuButtonId",null),u([d({readOnly:!0})],Ft.prototype,"featureMenuId",null),u([d({readOnly:!0})],Ft.prototype,"titleId",null),u([d({readOnly:!0})],Ft.prototype,"contentId",null),u([d({readOnly:!0})],Ft.prototype,"hasContent",null),u([d({readOnly:!0})],Ft.prototype,"featureNavigationVisible",null),u([d({readOnly:!0})],Ft.prototype,"collapsible",null),u([d({readOnly:!0})],Ft.prototype,"featureMenuVisible",null),u([d({readOnly:!0})],Ft.prototype,"contentCollapsed",null),u([d({readOnly:!0})],Ft.prototype,"dividedActions",null),u([ze("viewModel.actions")],Ft.prototype,"actions",void 0),u([d()],Ft.prototype,"actionsMenuOpen",null),u([d()],Ft.prototype,"alignment",void 0),u([ze("viewModel.autoCloseEnabled")],Ft.prototype,"autoCloseEnabled",void 0),u([ze("viewModel.autoOpenEnabled")],Ft.prototype,"autoOpenEnabled",void 0),u([ze("viewModel.defaultPopupTemplateEnabled")],Ft.prototype,"defaultPopupTemplateEnabled",void 0),u([ze("viewModel.content")],Ft.prototype,"content",void 0),u([d()],Ft.prototype,"collapsed",void 0),u([d()],Ft.prototype,"collapseEnabled",void 0),u([d({readOnly:!0})],Ft.prototype,"currentAlignment",null),u([d({readOnly:!0})],Ft.prototype,"currentDockPosition",null),u([d()],Ft.prototype,"dockOptions",null),u([d()],Ft.prototype,"dockEnabled",void 0),u([ze("viewModel.featureCount")],Ft.prototype,"featureCount",void 0),u([d()],Ft.prototype,"featureMenuOpen",void 0),u([ze("viewModel.features")],Ft.prototype,"features",void 0),u([ze("viewModel.goToOverride")],Ft.prototype,"goToOverride",void 0),u([d()],Ft.prototype,"headingLevel",void 0),u([ze("viewModel.highlightEnabled")],Ft.prototype,"highlightEnabled",void 0),u([ze("viewModel.location")],Ft.prototype,"location",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ft.prototype,"label",void 0),u([d()],Ft.prototype,"maxInlineActions",void 0),u([d(),pr("esri/widgets/Popup/t9n/Popup")],Ft.prototype,"messages",void 0),u([d(),pr("esri/t9n/common")],Ft.prototype,"messagesCommon",void 0),u([ze("viewModel.promises")],Ft.prototype,"promises",void 0),u([ze("viewModel.selectedFeature")],Ft.prototype,"selectedFeature",void 0),u([ze("viewModel.selectedFeatureIndex")],Ft.prototype,"selectedFeatureIndex",void 0),u([d({readOnly:!0})],Ft.prototype,"selectedFeatureWidget",null),u([d()],Ft.prototype,"spinnerEnabled",void 0),u([ze("viewModel.title")],Ft.prototype,"title",void 0),u([ze("viewModel.updateLocationEnabled")],Ft.prototype,"updateLocationEnabled",void 0),u([ze("viewModel.view")],Ft.prototype,"view",void 0),u([d({type:HEe}),cTe(["triggerAction","trigger-action"])],Ft.prototype,"viewModel",void 0),u([ze("viewModel.visible")],Ft.prototype,"visible",void 0),u([d()],Ft.prototype,"visibleElements",void 0),u([Jt("visibleElements")],Ft.prototype,"castVisibleElements",null),u([Da()],Ft.prototype,"_close",null),u([Da()],Ft.prototype,"_toggleDockEnabled",null),u([Da()],Ft.prototype,"_toggleFeatureMenu",null),u([Da()],Ft.prototype,"_toggleActionsMenu",null),u([Da()],Ft.prototype,"_triggerAction",null),u([Da()],Ft.prototype,"_selectFeature",null),u([Da()],Ft.prototype,"_next",null),u([Da()],Ft.prototype,"_previous",null),Ft=u([L(qEe)],Ft);const due=Ft,W9=[0,0];function bit(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return W9[0]=i.left+t.pageXOffset,W9[1]=i.top+t.pageYOffset,W9}function pue(e){e&&(nbe(e),e.parentNode&&e.parentNode.removeChild(e))}function wit(e){const t=document.createElement("div");return e.appendChild(t),t}const aR=16,wN=750,xit=512,Tit=2,Sit=e=>{let t=class extends e{constructor(...i){super(...i),this._freqInfo={freq:aR,time:wN},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([re(()=>this.cursor,r=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",r)}),re(()=>this.interacting,r=>{const{surface:s}=this;s&&s.setAttribute("data-interacting",r.toString())})])}initialize(){this.handles.add(re(()=>this.ui,(i,r)=>this._handleUIChange(i,r))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(i){const r=this._get("container");if(r===i)return;const s="dom-size";if(this.handles.remove(s),this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),pue(this.root),this._set("root",null),Foe(this.userContent,r),pue(this.userContent),this._set("userContent",null)),i){i.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",Foe(i,n),i.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",i.insertBefore(o,i.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new Sae;o.appendChild(l.surface),this._set("overlay",l),re(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=aS({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)}),this.forceDOMReadyCycle(),this.handles.add(re(()=>this.size,c=>{const[h,p]=c,f="esri-view-surface--inset-outline";h>=document.body.clientWidth||p>=document.body.clientHeight?a.classList.add(f):a.classList.remove(f)},Et),s),this._set("container",i),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get popup(){return this._get("popup")||new due({view:this})}set popup(i){const r=this._get("popup");r&&r!==i&&r.destroy(),this._set("popup",i)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(i,r,s){const n=this.position;return i-=n[0],r-=n[1],s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const n=this.position;return i+=n[0],r+=n[1],s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){r&&(this.handles.remove("ui"),r.destroy()),i&&this._wireUI(i),this._set("ui",i)}_wireUI(i){this.handles.remove("ui"),i&&(i.view=this,this.handles.add([re(()=>this.root,r=>{i.container=r?wit(r):null},Et),re(()=>this.popup,(r,s)=>{const n="popup",o="manual";s&&i.remove(s,n),r&&(r.view=i.view,i.add(r,{key:n,position:o}))},Et)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=aR,i.time=wN,this.handles.add([(()=>{const r=()=>{i.freq=aR,i.time=wN};return window.addEventListener("resize",r),{remove(){window.removeEventListener("resize",r)}}})(),aS({prepare:r=>{const s=this._measure(),n=this._freqInfo;if(n.time+=r.deltaTime,s&&(n.freq=aR,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?aR:Math.min(wN,n.freq*Tit),!s&&n.freq>=xit&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return r===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=bit(i);return(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([d({value:null,cast:i=>fL(i)})],t.prototype,"container",null),u([d({readOnly:!0})],t.prototype,"focused",null),u([d({readOnly:!0})],t.prototype,"height",void 0),u([d({type:due})],t.prototype,"popup",null),u([d({type:Sae})],t.prototype,"overlay",void 0),u([d({readOnly:!0})],t.prototype,"position",void 0),u([d({readOnly:!0})],t.prototype,"resizing",void 0),u([d({readOnly:!0})],t.prototype,"root",void 0),u([d({value:null,readOnly:!0})],t.prototype,"size",null),u([d({readOnly:!0})],t.prototype,"surface",void 0),u([d({readOnly:!0})],t.prototype,"suspended",void 0),u([d()],t.prototype,"ui",void 0),u([d({readOnly:!0})],t.prototype,"userContent",void 0),u([d({readOnly:!0})],t.prototype,"width",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),t=u([L("esri.views.DOMContainer")],t),t};function WEe(e){return e&&"focus"in e}const Wte=ve.getLogger("esri.layers.support.ElevationSampler");class ZEe{queryElevation(t){return XEe(t.clone(),this)}on(){return Oit}projectIfRequired(t,i){return YEe(t,i)}}class Eit extends ZEe{constructor(t,i,r){super(),this.tile=t,this.noDataValue=r,this.extent=JV(t.tile.extent,i.spatialReference),this.extent.zmin=t.zmin,this.extent.zmax=t.zmax,this.aaExtent=t.tile.extent;const s=$n(i.spatialReference),n=i.lodAt(t.tile.level).resolution*s;this.demResolution={min:n,max:n}}get spatialReference(){return this.extent.spatialReference}contains(t){const i=this.projectIfRequired(t,this.spatialReference);return!M(i)&&this.containsAt(i.x,i.y)}containsAt(t,i){return pK(this.aaExtent,t,i)}elevationAt(t,i){if(!this.containsAt(t,i)){const r=this.extent,s=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return Wte.warn("#elevationAt()",`Point used to sample elevation (${t}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return Ye(this.tile.sample(t,i),this.noDataValue)}}class fue extends ZEe{constructor(t,i,r){let s;super(),typeof i=="number"?(this.noDataValue=i,s=null):(s=i,this.noDataValue=r),this.samplers=s?t.map(o=>new Eit(o,s,this.noDataValue)):t;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=JV(Qt(),s.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt(t,i){for(const r of this.samplers)if(r.containsAt(t,i))return r.elevationAt(t,i);return Wte.warn("#elevationAt()",`Point used to sample elevation (${t}, ${i}) is outside of the sampler`),this.noDataValue}}function XEe(e,t){const i=YEe(e,t.spatialReference);if(!i)return null;switch(e.type){case"point":Cit(e,i,t);break;case"polyline":Ait(e,i,t);break;case"multipoint":Mit(e,i,t)}return e}function YEe(e,t){if(M(e))return null;const i=e.spatialReference;if(i.equals(t))return e;const r=HS(e,t);return r||Wte.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),r}function Cit(e,t,i){e.z=i.elevationAt(t.x,t.y)}function Ait(e,t,i){Tg.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s],o=t.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];Tg.x=c[0],Tg.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(Tg.x,Tg.y)}}e.hasZ=!0}function Mit(e,t,i){Tg.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.points.length;s++){const n=e.points[s],o=t.points[s];Tg.x=o[0],Tg.y=o[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(Tg.x,Tg.y)}e.hasZ=!0}const Tg=new dt,Oit={remove(){}};var oY;let Xm=oY=class extends Ce{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new oY({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Xm.prototype,"cols",void 0),u([d({type:Zr,json:{write:!0}})],Xm.prototype,"level",void 0),u([d({type:String,json:{write:!0}})],Xm.prototype,"levelValue",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Xm.prototype,"origin",void 0),u([d({type:Number,json:{write:!0}})],Xm.prototype,"resolution",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Xm.prototype,"rows",void 0),u([d({type:Number,json:{write:!0}})],Xm.prototype,"scale",void 0),Xm=oY=u([L("esri.layers.support.LOD")],Xm);const JEe=Xm;var t1;const mue=new Ti({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let ia=t1=class extends Ce{constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(e={}){const{resolutionFactor:t=1,scales:i,size:r=256,spatialReference:s=at.WebMercator,numLODs:n=24}=e;if(!ja(s)){const p=[];if(i)for(let f=0;f<i.length;f++){const m=i[f];p.push({level:f,scale:m,resolution:m})}else{let f=5e-4;for(let m=n-1;m>=0;m--)p.unshift({level:m,scale:f,resolution:f}),f*=2}return new t1({dpi:96,lods:p,origin:new dt(0,0,s),size:[r,r],spatialReference:s})}const o=X0(s),a=e.origin?new dt({x:e.origin.x,y:e.origin.y,spatialReference:s}):new dt(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/($n(s)*39.37*l),h=[];if(i)for(let p=0;p<i.length;p++){const f=i[p],m=f*c;h.push({level:p,scale:f,resolution:m})}else{let p=BV(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const f=Math.ceil(n/t);h.push({level:0,scale:p,resolution:p*c});for(let m=1;m<f;m++){const g=p/2**t,y=g*c;h.push({level:m,scale:g,resolution:y}),p=g}}return new t1({dpi:l,lods:h,origin:a,size:[r,r],spatialReference:s})}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const i=X0(e);return e.isWrappable&&Math.abs(i.origin[0]-t.x)<=i.dx}return!1}readOrigin(e,t){return dt.fromJSON(F({spatialReference:t.spatialReference},e))}set lods(e){let t=0,i=0;const r=[];this._levelToLOD={},e&&(t=-1/0,i=1/0,e.forEach(s=>{r.push(s.scale),t=s.scale>t?s.scale:t,i=s.scale<i?s.scale:i,this._levelToLOD[s.level]=s})),this._set("scales",r),this._set("minScale",t),this._set("maxScale",i),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];{const i=Math.floor(e),r=i+1;return t[i]/(t[i]/t[r])**(e-i)}}scaleToZoom(e){const t=this.scales,i=t.length-1;let r=0;for(;r<i;r++){const s=t[r],n=t[r+1];if(s<=e)return r;if(n===e)return r+1;if(s>e&&n<e)return r+Math.log(s/e)/Math.log(s/n)}return r}snapScale(e,t=.95){const i=this.scaleToZoom(e);return i%Math.floor(i)>=t?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(e,t,i,r){const s=this.lodAt(e);if(!s)return null;let n,o;if(typeof t=="number")n=t,o=i;else if(_a(t.spatialReference,this.spatialReference))n=t.x,o=t.y,r=i;else{const c=HS(t,this.spatialReference);if(M(c))return null;n=c.x,o=c.y,r=i}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r={id:null,level:0,row:0,col:0,extent:Qt()}),r.level=e,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(e,t=t1.ExtrapolateOptions.NONE){let i=this.lodAt(e.level);if(!i&&t===t1.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<e.level&&(i=o)}if(!i)return;const r=e.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=Qt()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+n}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||t.parentLevel===-1)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){const{resolution:i}=this.lodAt(t.level),r=i*this.size[0],s=i*this.size[1];return e[0]=this.origin.x+t.col*r,e[1]=this.origin.y-(t.row+1)*s,e[2]=e[0]+r,e[3]=e[1]+s,e}lodAt(e){return this._levelToLOD&&this._levelToLOD[e]||null}clone(){return t1.fromJSON(this.write({}))}getOrCreateCompatible(e,t){if(this.size[0]===256&&this.size[1]===256)return e===256?this:null;const i=[],r=this.lods.length;for(let s=0;s<r;s++){const n=this.lods[s],o=n.resolution*t;i.push(new JEe({level:n.level,scale:n.scale,resolution:o}))}return new t1({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let i=0;i<e.length;i++){const r=e[i];this._upsampleLevels[r.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/r.resolution:0},t=r}}};u([d({type:Number,json:{write:!0}})],ia.prototype,"compressionQuality",void 0),u([d({type:Number,json:{write:!0}})],ia.prototype,"dpi",void 0),u([d({type:String,json:{read:mue.read,write:mue.write,origins:{"web-scene":{read:!1,write:!1}}}})],ia.prototype,"format",void 0),u([d({readOnly:!0})],ia.prototype,"isWrappable",null),u([d({type:dt,json:{write:!0}})],ia.prototype,"origin",void 0),u([De("origin")],ia.prototype,"readOrigin",null),u([d({type:[JEe],value:null,json:{write:!0}})],ia.prototype,"lods",null),u([d({readOnly:!0})],ia.prototype,"minScale",void 0),u([d({readOnly:!0})],ia.prototype,"maxScale",void 0),u([d({readOnly:!0})],ia.prototype,"scales",void 0),u([d({cast:e=>Array.isArray(e)?e:typeof e=="number"?[e,e]:[256,256]})],ia.prototype,"size",void 0),u([De("size",["rows","cols"])],ia.prototype,"readSize",null),u([it("size",{cols:{type:Zr},rows:{type:Zr}})],ia.prototype,"writeSize",null),u([d({type:at,json:{write:!0}})],ia.prototype,"spatialReference",void 0),ia=t1=u([L("esri.layers.support.TileInfo")],ia),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}(ia||(ia={}));const B0=ia,Rit=12;class ms{constructor(t){const i=ms.checkUnsupported(t);if(_(i))throw i;const r=t;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=fS(this.spatialReference)||ay(this.spatialReference)||ly(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,h,p)=>(h.level<c.min&&(c.min=h.level,c.minIndex=p),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=r.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new ms(this.toTileInfo())}toTileInfo(){return new B0({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,i)=>({level:i,scale:t.scale,resolution:t.resolution}))})}getExtent(t,i,r,s){const n=this.levels[t],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+r*o,s[2]=this.origin[0]+(r+1)*o,s[3]=this.origin[1]-i*a,s[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(t,i){this._isWebMercator?(i[0]=uoe(t[0]),i[1]=dU(t[1]),i[2]=uoe(t[2]),i[3]=dU(t[3])):this._isGCS&&(i[0]=Yt(t[0]),i[1]=Yt(t[1]),i[2]=Yt(t[2]),i[3]=Yt(t[3]))}getExtentGeometry(t,i,r,s=new yi){return this.getExtent(t,i,r,_m),s.spatialReference=this.spatialReference,s.xmin=_m[0],s.ymin=_m[1],s.xmax=_m[2],s.ymax=_m[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(t){if(t==null)return!1;let i=!1;for(;this.levels.length<=t;){const r=this.levels[this.levels.length-1],s=r.resolution/2;this.levels.push({resolution:s,scale:r.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),i=!0}return i}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const i=this.levels[0].scale;return t>=i?0:Math.log(i/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t){if(!(t instanceof ms)){if(ms.checkUnsupported(t))return!1;t=new ms(t)}if(!t.spatialReference.equals(this.spatialReference)||t.pixelSize!==this.pixelSize)return!1;const i=Math.min(this.levels.length,t.levels.length)-1,r=this.levels[i].resolution;let s=.5*r;return!Rg(t.origin[0],this.origin[0],s)||!Rg(t.origin[1],this.origin[1],s)?!1:(s=.5*r/2**i/this.pixelSize*Rit,Rg(r,t.levels[i].resolution,s))}rootTilesInExtent(t,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(M(t)||n[0]===0||n[1]===0)return s;ms.computeRowColExtent(t,n,this.origin,_m);let o=_m[1],a=_m[3],l=_m[0],c=_m[2];const h=c-l,p=a-o;if(h*p>r){const f=Math.floor(Math.sqrt(r));p>f&&(o=o+Math.floor(.5*p)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return _(i)&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-a*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(t,i,r,s){const n=.001*(t[2]-t[0]+(t[3]-t[1]));s[0]=Math.max(0,Math.floor((t[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((t[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-t[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-t[1]-n)/i[1]))}static isPowerOfTwo(t){const i=t.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!F4e(s.resolution,r/2**s.level))}static hasGapInLevels(t){const i=t.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(t){const i=t.size[1];return i===t.size[0]&&(i&i-1)==0&&i>=128&&i<=512}static hasOriginPerLODs(t){const i=t.origin;return t.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new W("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return M(t)?Zte():t.lods.length<1?new W("tilingscheme:generic","Tiling scheme must have at least one level"):ms.isPowerOfTwo(t)?ms.hasGapInLevels(t)?new W("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):ms.tileSizeSupported(t)?ms.hasOriginPerLODs(t)?new W("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new W("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new W("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,i){const r=t[2]-t[0],s=t[3]-t[1],n=$n(i),o=1.2*Math.max(r,s),a=256,l=96,c=.0254,h=new ms(new B0({size:[a,a],origin:{x:t[0]-.5*(o-r),y:t[3]+.5*(o-s)},lods:[{level:0,resolution:o/a,scale:1/(a/l*c/(o*n))}],spatialReference:i}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(t){const i=new ms(ms.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i}static makeGCSWithTileSize(t,i=256,r=16){const s=256/i,n=new ms(new B0({size:[i,i],origin:{x:-180,y:90,spatialReference:t},spatialReference:t,lods:[{level:0,resolution:.703125*s,scale:295497598570834e-6*s}]}));return n.ensureMaxLod(r),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function Zte(){return new W("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}ms.WebMercatorAuxiliarySphereTileInfo=new B0({size:[256,256],origin:{x:-20037508342787e-6,y:20037508342787e-6,spatialReference:at.WebMercator},spatialReference:at.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527591555e-6}]}),ms.WebMercatorAuxiliarySphere=ms.makeWebMercatorAuxiliarySphere(19);const _m=Qt(),UC=64,aY=512,Pit=2.5,i$=k4e(WH/10),QEe=4,Iit=4,H5=e=>e<4?3:Iit,KEe=Qt();ms.WebMercatorAuxiliarySphere.getExtent(0,0,0,KEe);const $it=Qt([-180,-90,180,90]),Lit="Cannot extend surface to encompass all layers because it would result in too many root tiles.",Dit="Surface extent is too large for tile resolution at level 0.",qd=8,Nit=ve.getLogger("esri.views.support.GroundViewElevationSampler");let i1=class extends cs.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=i$}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(M(e.extent)||!e.spatialReference)return null;const t=JV(e.extent,e.spatialReference);return t.zmin=e.elevationBounds.min,t.zmax=e.elevationBounds.max,t}elevationAt(e,t){if(M(this.extent)||!Nl(this.extent,e,t)){const i=_(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return Nit.warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${i})`),this.noDataValue}return Ye(this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return XEe(e.clone(),this)}};u([d({readOnly:!0})],i1.prototype,"demResolution",void 0),u([d({readOnly:!0})],i1.prototype,"extent",null),u([d({readOnly:!0})],i1.prototype,"noDataValue",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],i1.prototype,"spatialReference",void 0),u([d({constructOnly:!0})],i1.prototype,"view",void 0),i1=u([L("esri.views.support.GroundViewElevationSampler")],i1);const Fit=i1;let r1=class extends Ee{constructor(e){super(e),this.handles=new Nt,this.view=null,this.layerViews=new nt}initialize(){this.handles.add(Jn(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground},e=>e.load())),this.handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this.handles&&(this.handles.destroy(),this.handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new Fit({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.handles.remove("updating"),this.handles.add(this.layerViews.map(e=>re(()=>e.updating,()=>this._updateUpdating(),Ui)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([d({readOnly:!0})],r1.prototype,"elevationSampler",null),u([d({type:Boolean,readOnly:!0})],r1.prototype,"updating",null),u([d({constructOnly:!0})],r1.prototype,"view",void 0),u([d({type:nt,readOnly:!0})],r1.prototype,"layerViews",void 0),u([d({readOnly:!0})],r1.prototype,"suspended",null),r1=u([L("esri.views.GroundView")],r1);const kit=r1,Uit=e=>{let t=class extends e{async fetchPopupFeatures(i,r){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(i,r),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,r),h=c.map(p=>p.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:Cve([l,...h]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(i,r,s){return r.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:_(s)?s.event:null,signal:_(s)?s.signal:null,defaultPopupTemplateEnabled:!!_(s)&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(i,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(_(r)&&r.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(i,r){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(i,r),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(i,r){const{results:s,mapPoint:n}=await this.popupHitTest(i),o=s.filter(l=>l.type==="graphic"&&this._isValidPopupGraphic(l.graphic,r)),a=o.length?o[0].mapPoint:null;return{clientGraphics:o.map(l=>l.graphic),queryArea:n,location:n||a}}_getFetchPopupLayerViews(){const i=[];return this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&i.push(r)}),_(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&i.push(this.graphicsView),i.reverse()}_isValidPopupLayerView(i){return _(i)&&(!("layer"in i)||!i.suspended)&&"fetchPopupFeatures"in i}_graphicsPerFetchPopupLayerView(i,r){const s=[],n=new Map,o=r.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of i){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return t=u([L("esri.views.PopupView")],t),t};async function eCe(e,t){return await e.load(),zit(e,t)}async function zit(e,t){const i=[],r=(...n)=>{for(const o of n)M(o)||(Array.isArray(o)?r(...o):nt.isCollection(o)?o.forEach(a=>r(a)):Zg.isLoadable(o)&&i.push(o))};t(r);let s=null;if(await VHe(i,async n=>{(await Hu(Vit(n)?n.loadAll():n.load())).ok!==!1||s||(s=n)}),s)throw s.loadError;return e}function Vit(e){return"loadAll"in e&&typeof e.loadAll=="function"}async function Bit(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e,i=await hbe("esri/t9n/basemaps");return i[e]||i[t]}const lY={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return ji("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return ji("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return ji("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return ji("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return ji("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return ji("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return ji("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return ji("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return ji("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return ji("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return ji("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return ji("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return ji("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return ji("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return ji("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return ji("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return ji("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return ji("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return ji("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return ji("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return ji("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return ji("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return ji("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return ji("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return ji("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return ji("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return ji("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]}},Git=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),jit=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","ogc-feature","route","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function Hit(e){return e.layerContainerType==="basemap"?Git:e.layerContainerType==="operational-layers"?jit:null}function qit(e,t){if(t.restrictedWebMapWriting){const i=Hit(t);return!_(i)||i.has(e.type)&&!hee(e)}return!0}function Wit(e,t){if(hee(e)){const i=QM("featureCollection.layers",t),r=i&&i[0]&&i[0].layerDefinition;r&&Z9(e,r)}else e.type==="stream"?Z9(e,t.layerDefinition=t.layerDefinition||{}):e.type!=="group"&&Z9(e,t)}function Z9(e,t){"maxScale"in e&&(t.maxScale=hU(e.maxScale)),"minScale"in e&&(t.minScale=hU(e.minScale))}function Zit(e,t){if(Wit(e,t),"blendMode"in e&&(t.blendMode=e.blendMode,t.blendMode==="normal"&&delete t.blendMode),t.opacity=hU(e.opacity),t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&e.type!=="wmts")if(hee(e)){const i=t.featureCollection;i&&(i.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function gue(e,t,i){if(!("write"in e)||!e.write)return i&&i.messages&&i.messages.push(new W("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(qit(e,i)){const r={};return e.write(r,i)?r:null}return _(t)&&Zit(e,t=ue(t)),t}var q5;let Xit=0;const X9=ve.getLogger("esri.Basemap");let Ld=q5=class extends eO(Zg){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+Xit++,this.baseLayers=new nt,this.referenceLayers=new nt;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&X9.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.baseLayers.on("after-add",r=>t(r.item)),this.referenceLayers.on("after-add",r=>t(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(e=>{X9.error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var i;const e=this.baseLayers.removeAll();for(const r of e)r.destroy();const t=this.referenceLayers.removeAll();for(const r of t)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(i=this.portalItem)==null||i.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=F({},e)).resourceInfo),e}set baseLayers(e){this._set("baseLayers",Mb(e,this._get("baseLayers")))}_writeBaseLayers(e,t,i){const r=[];e&&(i=me(F({},i),{layerContainerType:"basemap"}),this.baseLayers.forEach(s=>{const n=gue(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);_(n)&&r.push(n)}),this.referenceLayers.forEach(s=>{const n=gue(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);_(n)&&(n.isReference=!0,r.push(n))})),t.baseMapLayers=r}set referenceLayers(e){this._set("referenceLayers",Mb(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return eCe(this,e=>{e(this.baseLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new q5({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t=F({origin:"web-map"},t)),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=ue(i);return r.url&&Wg(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&Wg(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:i}=this;qt(e);const r=[];if(t){const s=t.context?t.context.url:null;if(r.push(this._loadLayersFromJSON(t.data,s,e)),t.data.id&&!t.data.title){const n=t.data.id;r.push(Bit(n).then(o=>{o&&this.read({title:o},t.context)}))}}else i&&r.push(this._loadFromItem(i,e));await Promise.all(r)}async _loadLayersFromJSON(e,t,i){const r=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||r&&r.portal||null,n=r&&r.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:o}=await import("./layersCreator.dd189102.js"),a=[];if(qt(i),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const l={context:{origin:n,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=o(this.baseLayers,e.baseMapLayers.filter(p=>!p.isReference),l);a.push(c);const h=o(this.referenceLayers,e.baseMapLayers.filter(p=>p.isReference),l);a.push(h)}await Us(a)}async _loadFromItem(e,t){const i=await e.load(t),r=await i.fetchData("json",t),s=pn(e.itemUrl);return this._set("resourceInfo",{data:r.baseMap,context:{origin:"web-map",portal:e.portal||Bo.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||Bo.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=lY[e];if(t){if(t.deprecated){let i=null;e==="dark-gray"?i="dark-gray-vector":e==="gray"?i="gray-vector":e==="streets"?i="streets-vector":e==="topo"&&(i="topo-vector"),Sve(X9,`The ${e} basemap has entered mature support and is no longer being updated.`,{replacement:i,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return q5.fromJSON(t)}return null}};u([d({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,i,r){this._writeBaseLayers(e,t,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:nt}},writer(e,t,i,r){this._writeBaseLayers(e,t,r)}}}}}})],Ld.prototype,"baseLayers",null),u([d({type:String,json:{origins:{"web-scene":{write:!0}}}})],Ld.prototype,"id",void 0),u([d({type:uM})],Ld.prototype,"portalItem",void 0),u([d()],Ld.prototype,"referenceLayers",null),u([d({readOnly:!0})],Ld.prototype,"resourceInfo",void 0),u([d({type:at})],Ld.prototype,"spatialReference",void 0),u([d()],Ld.prototype,"thumbnailUrl",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Ld.prototype,"title",void 0),u([it("title")],Ld.prototype,"writeTitle",null),Ld=q5=u([L("esri.Basemap")],Ld);const yz=Ld;var Yit=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:yz}),cY;let W5=cY=class extends Ce{constructor(e){super(e),this.type="none"}clone(){return new cY({type:this.type})}};u([bt({none:"none",stayAbove:"stay-above"})],W5.prototype,"type",void 0),W5=cY=u([L("esri.ground.NavigationConstraint")],W5);var uY;const yue=ve.getLogger("esri.Ground");let r0=uY=class extends eO(Zg){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new nt;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&yue.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.layers.on("after-add",r=>t(r.item)),this.layers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(e=>{yue.error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=F({},e)).resourceInfo),e}set layers(e){this._set("layers",Mb(e,this._get("layers")))}writeLayers(e,t,i,r){const s=[];e&&(r=me(F({},r),{layerContainerType:"ground"}),e.forEach(n=>{if("write"in n){const o={};GJe(n)().write(o,r)&&s.push(o)}else r&&r.messages&&r.messages.push(new W("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),t.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return eCe(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await Promise.resolve().then(function(){return _ye});qt(t);const r=new i,s=this.layers.filter(vue).toArray();return r.queryAll(s,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await Promise.resolve().then(function(){return _ye});qt(t);const r=new i,s=this.layers.filter(vue).toArray();return r.createSamplerAll(s,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:ue(this.surfaceColor),navigationConstraint:ue(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new uY({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve(null)}_loadLayersFromJSON(e,t,i){const r=t&&t.origin||"web-scene",s=t&&t.portal||null,n=t&&t.url||null;return import("./layersCreator.dd189102.js").then(({populateOperationalLayers:o})=>{qt(i);const a=[];if(e.layers&&Array.isArray(e.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,e.layers,l))}return Us(a)}).then(()=>{})}};function Jit(e){return e&&"createElevationSampler"in e}function vue(e){return e.type==="elevation"||Jit(e)}u([d({json:{read:!1}})],r0.prototype,"layers",null),u([it("layers")],r0.prototype,"writeLayers",null),u([d({readOnly:!0})],r0.prototype,"resourceInfo",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Zr,read:{reader:ZA,source:"transparency"},write:{writer:(e,t)=>{t.transparency=YV(e)},target:"transparency"}}})],r0.prototype,"opacity",void 0),u([d({type:Le,json:{type:[Zr],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],r0.prototype,"surfaceColor",void 0),u([d({type:W5,json:{write:!0}})],r0.prototype,"navigationConstraint",void 0),r0=uY=u([L("esri.Ground")],r0);const r$=r0;let nC=class extends pm(nt){constructor(e){super(e),this.getCollections=null}initialize(){this.handles.add($ve(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=_(this.getCollections)?this.getCollections():null;if(M(e))return void this.removeAll();let t=0;for(const i of e)_(i)&&(t=this._processCollection(t,i));this.splice(t,this.length)}_createNewInstance(e){return new nt(e)}_processCollection(e,t){if(!t)return e;const i=this.itemFilterFunction?this.itemFilterFunction:r=>!!r;for(const r of t)if(r){if(i(r)){const s=this.indexOf(r,e);s>=0?s!==e&&this.reorder(r,e):this.add(r,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(r);if(Array.isArray(s))for(const n of s)e=this._processCollection(e,n);else e=this._processCollection(e,s)}}return e}};u([d()],nC.prototype,"getCollections",void 0),u([d()],nC.prototype,"getChildrenFunction",void 0),u([d()],nC.prototype,"itemFilterFunction",void 0),nC=u([L("esri.core.CollectionFlattener")],nC);const bS=nC;function Qit(e){var t;return!!(e&&e.loaded&&"capabilities"in e&&((t=e==null?void 0:e.capabilities)==null?void 0:t.operations)&&"supportsEditing"in e.capabilities.operations&&e.capabilities.operations.supportsEditing===!0)&&!("editingEnabled"in e&&!e.editingEnabled)}const _ue=ve.getLogger("esri.support.basemapUtils");function Kit(){return{}}function ert(e){for(const t in e){const i=e[t];(i==null?void 0:i.destroyed)===!1&&i.destroy(),delete e[t]}}function trt(e,t){let i;if(typeof e=="string"){if(!(e in lY)){const r=Object.entries(lY).filter(([s,n])=>or.apiKey&&!n.classic||!or.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return _ue.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${r}`),null}t&&(i=t[e]),i||(i=yz.fromId(e),t&&(t[e]=i))}else i=dn(yz,e);return(i==null?void 0:i.destroyed)&&(_ue.warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function irt(e){return new bS({getCollections:()=>[e.tables,e.layers],getChildrenFunction:t=>{const i=[];return"tables"in t&&i.push(t.tables),"layers"in t&&i.push(t.layers),i},itemFilterFunction:t=>{const i=t.parent;return i&&"tables"in i&&i.tables.includes(t)}})}const rrt=ve.getLogger("esri.support.groundUtils"),bue={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function srt(e){let t=null;if(typeof e=="string")if(e in bue){const i=bue[e];t=new r$({resourceInfo:{data:{layers:[i]}}})}else rrt.warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=dn(r$,e);return t}function hY(e,t,i){let r,s;if(e)for(let n=0,o=e.length;n<o;n++){if(r=e.getItemAt(n),r[t]===i)return r;if((r==null?void 0:r.type)==="group"&&(s=hY(r.layers,t,i),s))return s}}const wue=ve.getLogger("esri.support.LayersMixin"),nrt=e=>{let t=class extends e{constructor(...i){super(...i),this.layers=new nt;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||wue.error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.layers.on("before-add",o=>r(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))}destroy(){const i=this.layers.removeAll();for(const r of i)this.layerRemoved(r),r.destroy();this.layers.destroy()}set layers(i){this._set("layers",Mb(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof _S){const n=i;n.parent===this?this.reorder(n,r):s.add(n,r)}else qu(i)?i.then(n=>{this.destroyed||this.add(n,r)}):wue.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;r=s.getNextIndex(r),i.slice().forEach(n=>{n.parent!==this?(s.add(n,r),r+=1):this.reorder(n,r)})}findLayerById(i){return hY(this.layers,"id",i)}findLayerByUid(i){return hY(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return u([d()],t.prototype,"layers",null),t=u([L("esri.support.LayersMixin")],t),t},tCe="esri.support.TablesMixin",ort=ve.getLogger(tCe);function dY(e,t,i){if(e)for(let r=0,s=e.length;r<s;r++){const n=e.getItemAt(r);if(n[t]===i)return n;if((n==null?void 0:n.type)==="group"){const o=dY(n.tables,t,i);if(o)return o}}}const art=e=>{let t=class extends e{constructor(...i){super(...i),this.tables=new nt,this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&ort.error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})}destroy(){const i=this.tables.removeAll();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",Mb(i,this._get("tables")))}findTableById(i){return dY(this.tables,"id",i)}findTableByUid(i){return dY(this.tables,"uid",i)}};return u([d()],t.prototype,"tables",null),t=u([L(tCe)],t),t};let Ym=class extends art(nrt(cs.EventedMixin(Ee))){constructor(e){super(e),this.allLayers=new bS({getCollections:()=>{var t,i,r;return[(t=this.basemap)==null?void 0:t.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(r=this.basemap)==null?void 0:r.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=irt(this),this.basemap=null,this.editableLayers=new bS({getCollections:()=>[this.allLayers],itemFilterFunction:Qit}),this.ground=new r$,this._basemapCache=Kit()}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(t=this.basemap)==null||t.destroy(),ert(this._basemapCache),this._basemapCache=null}castBasemap(e){return trt(e,this._basemapCache)}castGround(e){const t=srt(e);return M(t)?this._get("ground"):t}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};u([d({readOnly:!0,dependsOn:[]})],Ym.prototype,"allLayers",void 0),u([d({readOnly:!0})],Ym.prototype,"allTables",void 0),u([d({type:yz})],Ym.prototype,"basemap",void 0),u([Jt("basemap")],Ym.prototype,"castBasemap",null),u([d({readOnly:!0})],Ym.prototype,"editableLayers",void 0),u([d({type:r$,nonNullable:!0})],Ym.prototype,"ground",void 0),u([Jt("ground")],Ym.prototype,"castGround",null),Ym=u([L("esri.Map")],Ym);const lrt=Ym;let QT=class extends NI{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([iK({Type:Ha,ensureType:dn(Ha)})],QT.prototype,"itemType",void 0),QT=u([L("esri.support.GraphicsCollection")],QT);let s1=class extends Ee{constructor(e){super(e),this.view=null,this.baseLayerViews=new nt,this.referenceLayerViews=new nt,this._loadingHandle=re(()=>{var t,i;return(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.basemap},t=>{t&&t.load().catch(()=>{})},Et)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var t,i;if(this.view&&this.view.suspended)return!1;const e=(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(r=>r.updating)||this.referenceLayerViews.some(r=>r.updating))}};u([d({constructOnly:!0})],s1.prototype,"view",void 0),u([d({readOnly:!0})],s1.prototype,"baseLayerViews",void 0),u([d({readOnly:!0})],s1.prototype,"referenceLayerViews",void 0),u([d({readOnly:!0})],s1.prototype,"suspended",null),u([d({type:Boolean,readOnly:!0})],s1.prototype,"updating",null),s1=u([L("esri.views.BasemapView")],s1);const crt=ve.getLogger("esri.views.LayerViewManager");class urt{constructor(t,i,r){this.layer=t,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=hv(),this._started=!1,this.done=!1,va(this._controller.signal,()=>{const s=new W("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(s)})}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:t}=this;if(!t)return;const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:t}),r.emit("layerview-destroy",{layer:i,layerView:t}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){var s,n;if(this._started)return;this._started=!0;const{_controller:{signal:t},layer:i,view:r}=this;this._map=r.map;try{let o,a;if(await i.load({signal:t}),"prefetchResources"in i&&await i.prefetchResources({signal:t}),i.createLayerView)o=await i.createLayerView(r,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new W("layer:view-not-supported","No layerview implementation was found");const h=await this.layerViewImporter.importLayerView(i);qt(t),o="default"in h?new h.default({layer:i,view:r}):new h({layer:i,view:r})}const l=()=>{a=hn(a),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};a=va(t,l),qt(t);try{await o.when()}catch(h){throw l(),h}if(!((n=(s=this._map)==null?void 0:s.allLayers)==null?void 0:n.includes(i)))return l(),void this._deferred.reject(new W("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=o,i.emit("layerview-create",{view:r,layerView:o}),r.emit("layerview-create",{layer:i,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){i.emit("layerview-create-error",{view:r,error:o}),r.emit("layerview-create-error",{layer:i,error:o}),this.done=!0,this._deferred.reject(new W("layerview:create-error","layerview creation failed",{layer:i,error:o}))}}}let Dd=class extends yv{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new Lg,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const t=(i=this.view.map)==null?void 0:i.allLayers;if(t)for(const r of t)this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>(M(this._workPromise)&&(this._workPromise=hv()),this.handles.remove("reschedule"),this.handles.add(Zb(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var n,o,a;const t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),M(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const i=new bS({getCollections:()=>this._rootCollectionNames.map(l=>this.get(l)),getChildrenFunction:l=>l&&"layers"in l?l.layers:null});if(!i)return this._workPromise.resolve(),void(this._workPromise=null);for(const l of i)this._createLayerView(l);this._refreshCollections();for(const[l,c]of this._layerLayerViewInfoMap)i.includes(l)||(this._layerLayerViewInfoMap.delete(c.layer),c.destroy());const r=i.filter(l=>l.type==="group").map(l=>l.layers),s=[(n=t==null?void 0:t.ground)==null?void 0:n.layers,(o=t==null?void 0:t.basemap)==null?void 0:o.baseLayers,(a=t==null?void 0:t.basemap)==null?void 0:a.referenceLayers,t==null?void 0:t.layers,...r].filter(l=>!!l);this.handles.add(s.map(l=>this._watchUpdatingTracking.addOnCollectionChange(()=>l,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([os(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),re(()=>{const e=this.view,t=e==null?void 0:e.map;return[t==null?void 0:t.basemap,t==null?void 0:t.ground,t==null?void 0:t.layers,e==null?void 0:e.ready]},()=>this._reschedule(),fi)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return _(this._workPromise)||this._watchUpdatingTracking.updating||Mn(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new W("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let r=0;for(const s of e){const n=this._layerLayerViewInfoMap.get(s);if(!n||!n.layerView)continue;const o=n.layerView;o.layer=s,o.parent=i,t.getItemAt(r)!==o&&t.splice(r,0,o),s.layers&&this._populateLayerViewsOwners(s.layers,o.layerViews,o),r+=1}r<t.length&&t.splice(r,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new urt(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),i=>{var r,s;i&&(as(i)||i.name==="cancelled:layerview-create")||crt.error(`Failed to create layerview for layer title:'${(r=e.title)!=null?r:"no title"}', id:'${(s=e.id)!=null?s:"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([d()],Dd.prototype,"_workPromise",void 0),u([d({readOnly:!0})],Dd.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],Dd.prototype,"_layersToLayerViews",null),u([d({readOnly:!0})],Dd.prototype,"_rootCollectionNames",null),u([d()],Dd.prototype,"layerViewImporter",void 0),u([d()],Dd.prototype,"supportsGround",void 0),u([d({readOnly:!0})],Dd.prototype,"updating",null),u([d({readOnly:!0})],Dd.prototype,"updatingRemaining",null),u([d({constructOnly:!0})],Dd.prototype,"view",void 0),Dd=u([L("esri.views.LayerViewManager")],Dd);const hrt=Dd;let dh=class extends Ee{constructor(e){super(e),this.factor=1.5,this.offset=bp(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([d({type:Number})],dh.prototype,"factor",void 0),u([d({nonNullable:!0})],dh.prototype,"offset",void 0),u([d()],dh.prototype,"position",void 0),u([d({type:Number,range:{min:0}})],dh.prototype,"size",void 0),u([d()],dh.prototype,"maskUrl",void 0),u([d()],dh.prototype,"maskEnabled",void 0),u([d()],dh.prototype,"overlayUrl",void 0),u([d()],dh.prototype,"overlayEnabled",void 0),u([d({readOnly:!0})],dh.prototype,"version",null),u([d({type:Boolean})],dh.prototype,"visible",void 0),dh=u([L("esri.views.Magnifier")],dh);const iCe=dh;let Z5=class extends Ee{constructor(){super(...arguments),this._tasks=new Array,this.running=!1}get length(){return this._tasks.length}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,i){return this.running=!0,new Promise((r,s)=>this._tasks.push(new xue(r,s,e,t,i)))}unshift(e,t,i){return this.running=!0,new Promise((r,s)=>this._tasks.unshift(new xue(r,s,e,t,i)))}_process(e){if(this._tasks.length===0)return!1;const t=this._tasks.shift();try{const i=an(t.signal);if(i&&!t.abortCallback)t.reject(mi());else{const r=i?t.abortCallback(mi()):t.callback(e);qu(r)?r.then(t.resolve,t.reject):t.resolve(r)}}catch(i){t.reject(i)}return this.running=this._tasks.length>0,!0}cancelAll(){const e=mi();for(const t of this._tasks)if(t.abortCallback){const i=t.abortCallback(e);t.resolve(i)}else t.reject(e);this._tasks.length=0,this.running=!1}};u([d()],Z5.prototype,"running",void 0),Z5=u([L("esri.layers.support.PromiseQueue")],Z5);class xue{constructor(t,i,r,s,n){this.resolve=t,this.reject=i,this.callback=r,this.signal=s,this.abortCallback=n}}let JP=class extends Ee{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([d()],JP.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([d()],JP.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),JP=u([L("esri.views.support.DebugFlags")],JP);const drt=new JP,prt=ve.getLogger("esri.views.support.Scheduler");function frt(){return new vz.Scheduler}var Ot;(function(e){e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="cloud generator",e[e.TEST_PRIO=1]="TEST_PRIO"})(Ot||(Ot={}));const gg=0,Tue=new Map([[Ot.RESOURCE_CONTROLLER,gg],[Ot.SLIDE,gg],[Ot.STREAM_DATA_LOADER,gg],[Ot.ELEVATION_QUERY,gg],[Ot.TERRAIN_SURFACE,1],[Ot.SURFACE_GEOMETRY_UPDATES,1],[Ot.GRAPHICS_CORE,2],[Ot.I3S_CONTROLLER,2],[Ot.POINT_CLOUD_LAYER,2],[Ot.FEATURE_TILE_FETCHER,2],[Ot.OVERLAY,4],[Ot.STAGE,4],[Ot.GRAPHICS_DECONFLICTOR,4],[Ot.FILTER_VISIBILITY,4],[Ot.SCALE_VISIBILITY,4],[Ot.FRUSTUM_VISIBILITY,4],[Ot.POINT_OF_INTEREST_FREQUENT,6],[Ot.POINT_OF_INTEREST_INFREQUENT,30],[Ot.LABELER,8],[Ot.FEATURE_QUERY_ENGINE,8],[Ot.FEATURE_TILE_TREE,16],[Ot.FEATURE_TILE_TREE_ACTIVE,gg],[Ot.ELEVATION_ALIGNMENT,12],[Ot.TEXT_TEXTURE_ATLAS,12],[Ot.CLOUDS_GENERATOR,12],[Ot.TEXTURE_UNLOAD,12],[Ot.LINE_OF_SIGHT_TOOL,16],[Ot.LINE_OF_SIGHT_TOOL_INTERACTIVE,gg],[Ot.SNAPPING,gg],[Ot.SHADOW_ACCUMULATOR,30]]);function Sue(e){return Tue.has(e)?Tue.get(e):typeof e=="number"?e:1}var Mo;(function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"})(Mo||(Mo={}));const Eue=6.5,Cue=1,mrt=30,Aue=1e3/30,Mue=100,Oue=.9;var vz,dw;(function(e){let t=class extends Ee{constructor(){super(),this.updating=!0,this._microTaskQueued=!1,this.performanceInfo={total:new cb("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=Mo.INTERACTING,this._tasks=new ai,this._runQueue=new ai,this._load=0,this._idleStateCallbacks=new ai,this._idleUpdatesStartFired=!1,this._maxReschedule=xN,this._forceTask=!1,this._debug=!1,this._debugHandle=re(()=>drt.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,Et);for(const o of Object.keys(Ot))this.performanceInfo.tasks.set(Ot[o],new cb(Ot[o]));let s;const n=this;this._test={get state(){return Ye(s,n._state)},set state(o){s=o},FRAME_SAFETY_BUDGET:Eue,INTERACTING_BUDGET:Aue,IDLE_BUDGET:Mue,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),hn(this._debugHandle),this._microTaskQueued=!1,this.updating=!1}activate(){this._budget.done||this._microTaskQueued||(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.done||(this._maxReschedule=xN,this._schedule(),this.frame()))}))}registerTask(s,n){const o=Sue(s),a=new i(this,s,n,o);return this._tasks.push(a),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new cb(s)),a}registerIdleStateCallbacks(s,n){const o={idleBegin:s,idleEnd:n};this._idleStateCallbacks.push(o),this.state===Mo.IDLE&&this._idleUpdatesStartFired&&o.idleBegin();const a=this;return{remove:()=>this._removeIdleStateCallbacks(o),set idleBegin(l){a._idleUpdatesStartFired&&(o.idleEnd(),a._state===Mo.IDLE&&l()),o.idleBegin=l},set idleEnd(l){o.idleEnd=l}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==Mo.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(n=>n.idleEnd())))}get state(){return M(this._test.state)?this._state:this._test.state}updateBudget(s){this._test.usedBudget=0;let n=Eue,o=s.frameDuration,a=Cue;switch(this.state){case Mo.IDLE:n=0,o=Math.max(Mue,s.frameDuration),a=mrt;break;case Mo.INTERACTING:o=Math.max(Aue,s.frameDuration);case Mo.ANIMATING:}return o=o-s.elapsedFrameTime-n,this.state!==Mo.IDLE&&o<Cue&&!this._forceTask?(this._forceTask=!0,!1):(o=Math.max(o,a),this._budget.reset(o,this.state),this._maxReschedule=xN,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Mo.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case Mo.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s)}_updateTask(s){this._tasks.forAll(n=>{n.name===s&&n.setPriority(s)})}_getState(s){if(this._runQueue.some(o=>o.name===s))return dw.SCHEDULED;let n=dw.IDLE;return this._tasks.forAll(o=>{o.name===s&&o.needsUpdate&&(o.schedulePriority<=1?n=dw.READY:n!==dw.READY&&(n=dw.WAITING))}),n}_getRuntime(s){let n=0;return this._tasks.forAll(o=>{o.name===s&&(n+=o.runtime)}),n}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(o=>{o.needsUpdate&&s.set(o.name,(s.get(o.name)||0)+1)}),s.size===0)return null;let n="";return s.forEach((o,a)=>{n+=o>1?` ${o}x ${a}`:` ${a}`}),n}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((n,o)=>o.needsUpdate?++n:n,0);this._load=this._load*Oue+s*(1-Oue)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===gg&&s.needsUpdate&&!this._runQueue.includes(s)&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,n=0;if(this._tasks.forAll(o=>{o.needsUpdate&&o.schedulePriority!==0&&o.basePriority!==gg&&(s=!0,n=Math.max(n,o.basePriority),o.schedulePriority===1?(o.schedulePriority=0,this._runQueue.push(o)):--o.schedulePriority)}),!s)return this.updating=!1,!1;this._maxReschedule===xN&&(this._maxReschedule=n),--this._maxReschedule}return this.updating=!0,!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const n=this._budget.now(),o=this._runQueue.pop();this._budget.resetProgress();try{o.task.runTask(this._budget)}catch(l){prt.error(`Exception in task "${o.name}"`,l)}o.schedulePriority=o.basePriority;const a=this._budget.now()-n;if(o.runtime+=a,this._frameTaskTimes.set(o.priority,this._frameTaskTimes.get(o.priority)+a),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",o.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this.updating=this._tasks.some(l=>l.needsUpdate),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this.updating=this._tasks.some(n=>n.needsUpdate),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(Ot))this._frameTaskTimes.set(Ot[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((n,o)=>this.performanceInfo.tasks.get(o).record(n)),this.performanceInfo.total.record(s)}get test(){return this._test}};u([d()],t.prototype,"updating",void 0),t=u([L("esri.views.support.Scheduler")],t),e.Scheduler=t;let i=class extends Ee{constructor(s,n,o,a){super({}),this._scheduler=s,this.name=n,this._basePriority=a,this.runtime=0,this._queue=new Z5,this._handles=new Nt,this.schedulePriority=this._basePriority,this.task=_(o)?o:this._queue,this._handles.add(Jn(()=>this.task.running,()=>s.activate()))}get updating(){return this._queue.running}normalizeCtorArgs(){return{}}remove(){this.processQueue(bO),this._scheduler.removeTask(this),this.schedule=hM.schedule,this.reschedule=hM.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){this.name=s;const n=Sue(s);this._basePriority!==gg&&this.schedulePriority===0||(this.schedulePriority=n),this._basePriority=n}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,n,o){return this._queue.push(s,n,o)}reschedule(s,n,o){return this._queue.unshift(s,n,o)}processQueue(s){this._queue.runTask(s)}};u([d({constructOnly:!0})],i.prototype,"task",void 0),u([d({readOnly:!0})],i.prototype,"updating",null),i=u([L("esri.views.support.SchedulerTask")],i);class r{constructor(){this._begin=typeof performance!="undefined"?performance.now():0,this._budget=0,this._state=Mo.IDLE,this._didWork=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}e.Budget=r})(vz||(vz={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(dw||(dw={}));const bO=(()=>{const e=new vz.Budget;return e.enabled=!1,e})();class grt{remove(){}processQueue(){}schedule(t,i,r){try{if(an(i)){const s=mi();return r?Promise.resolve(r(s)):Promise.reject(s)}return tq(t(bO))}catch(s){return Promise.reject(s)}}reschedule(t,i,r){return this.schedule(t,i,r)}}const hM=new grt,xN=Number.MAX_SAFE_INTEGER;let zC=class extends Ee{constructor(e,t){var i;super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(i=t==null?void 0:t.registerTask(Ot.TEXTURE_UNLOAD))!=null?i:hM}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,t,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);return s||(s={referenceCount:0,texture:t(),textureAsync:null,abortController:null,onRemove:i},this._stage&&(this._stage.add(s.texture),this._stage.loadImmediate(s.texture)),this._textureRequests.set(r,s)),s.referenceCount++,{uid:r,texture:s.texture,release:()=>this._release(r)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){var t;e.onRemove&&e.onRemove(),e.texture?(t=this._stage)==null||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return _(t)?`${e}.${t}px`:e}};u([d()],zC.prototype,"_frameTask",void 0),u([d()],zC.prototype,"updating",null),zC=u([L("esri.views.3d.support.TextureCollection")],zC);var Rue;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"})(Rue||(Rue={}));const rCe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],sCe={};function nCe(e){return!!sCe[e]}function yrt(e){for(const t of e)if(!nCe(t))return!1;return!0}rCe.forEach(e=>{sCe[e]=!0});class vrt{constructor(t){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this.handlers.forEach(({handler:i,priority:r},s)=>this.inputManager.installHandlers(s,[i],r))}disconnect(){this.inputManager&&this.handlers.forEach((t,i)=>this.inputManager.uninstallHandlers(i)),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(t,i,r,s){const n=Array.isArray(t)?t:t.split(",");if(!yrt(n))return n.some(nCe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:s=r,s=s!=null?s:ts.DEFAULT;const l=this._createUniqueGroupName(),c=new _rt(this.view,n,a,o);this.handlers.set(l,{handler:c,priority:s});for(const h of n){const p=this.handlerCounts.get(h)||0;this.handlerCounts.set(h,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(t){return!!this.handlerCounts.get(t)}_removeHandler(t,i){if(this.handlers.has(t)){this.handlers.delete(t);for(const r of i){const s=this.handlerCounts.get(r);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",r):s===1?this.handlerCounts.delete(r):this.handlerCounts.set(r,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(t)}_createUniqueGroupName(){return this.counter+=1,`viewEvents_${this.counter}`}}class _rt extends qa{constructor(t,i,r,s){super(!0),this.view=t;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",r,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",r,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",r,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",r,o=>{s(this._wrapBlur(o))})}}_wrapFocus(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapBlur(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:bp(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapImmediateClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapImmediateDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapHold(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a}=t.data,{cancelable:l,timestamp:c}=t;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>t.stopPropagation(),async:h=>t.async(h),preventDefault:()=>t.preventDefault()}}_getMapPoint(t,i){return this.view.toMap(bp(t,i),{exclude:[]})}_wrapDrag(t){const i=t.data,{x:r,y:s}=i.center,{action:n,pointerType:o,button:a}=i;if(n==="start"&&(this.latestDragStart=i),!this.latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:h,timestamp:p}=t,f={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return n==="end"&&(this.latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:i.radius,angle:Vu(i.angle),native:l,timestamp:p,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapKeyDown(t){const{key:i,repeat:r,native:s}=t.data,{cancelable:n,timestamp:o}=t;return{type:"key-down",key:i,repeat:r,native:s,timestamp:o,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:a=>t.async(a),preventDefault:()=>t.preventDefault()}}_wrapKeyUp(t){const{key:i,native:r}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-up",key:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}_wrapPointer(t,i){const{x:r,y:s,button:n,buttons:o,native:a,eventId:l}=t.data,c=a.pointerId,h=a.pointerType,{cancelable:p,timestamp:f}=t;return{type:i,x:r,y:s,pointerId:c,pointerType:h,button:n,buttons:o,native:a,timestamp:f,eventId:l,cancelable:p,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapPointerDrag(t){const{x:i,y:r,buttons:s,native:n,eventId:o}=t.data.currentEvent,{button:a}=t.data.startEvent,l=t.data.startEvent.native.pointerId,c=t.data.startEvent.native.pointerType,h=t.data.action,p={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:f,timestamp:m}=t;return{type:"pointer-drag",x:i,y:r,pointerId:l,pointerType:c,button:a,buttons:s,action:h,origin:p,native:n,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>t.stopPropagation(),async:g=>t.async(g),preventDefault:()=>t.preventDefault()}}_wrapMouseWheel(t){const{cancelable:i,data:r,timestamp:s}=t,{x:n,y:o,deltaY:a,native:l}=r;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:i,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}_wrapGamepad(t){const{action:i,state:r,device:s}=t.data,{cancelable:n,timestamp:o}=t,{buttons:a,axes:l}=r;return{type:"gamepad",device:s,timestamp:o,action:i,buttons:a,axes:l,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}}var s$,Pue,Iue;(function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"})(s$||(s$={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(Pue||(Pue={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(Iue||(Iue={}));const brt=ve.getLogger("esri.views.interactive.interactiveToolUtils");function wrt(e){return[e.on("before-add",t=>{const i=t.item;if(i==null||e.includes(i))return brt.warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();i.onAdd()}),e.on("after-remove",t=>{const i=t.item;i.visible=!1,i.active&&(i.view.activeTool=null),i.destroy()})]}function _z(e){return e.visible&&e.getEditableFlag(s$.USER)&&e.getEditableFlag(s$.MANAGER)}function jd(e){return bp(e.x,e.y)}function g5t(e){return Ts(e.x,e.y)}function oCe(e,t){const i=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return bp(t.clientX-i.left,t.clientY-i.top)}function $ue(e,t){return t instanceof Event?oCe(e,t):jd(t)}function Lue(e){if(e instanceof Event)return!0;if(typeof e=="object"&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}class xrt{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._currentlyActiveTool=null,this._revertToActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(t,i){const r=()=>t.stopPropagation();switch(t.type){case"pointer-move":Due(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),t.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Nue(t))break;const s=jd(t),n=this._intersect(s,t.pointerType,i.forEachTool);if(M(n))break;const o=this._findToolAndManipulatorByKey(n,i.forEachTool,TN),a=wt(o,c=>c.manipulator),l=wt(o,c=>c.tool);!(_(a)&&_(l)&&a.interactive)||a.grabbable&&a.grabbableForEvent(t)||!a.grabbing||a.dragging||this._ungrabManipulatorBeforeDragging(a,l,t),_(a)&&a.interactive&&a.grabbable&&a.grabbableForEvent(t)&&!a.grabbing&&(this._grabbedManipulators.set(t.pointerId,{key:n,start:s,pointerType:t.pointerType}),this._grabbedManipulators.size===1&&i.activeTool!==n.tool&&(this._currentlyActiveTool=i.activeTool,this._revertToActiveTool=!0,i.setActiveTool(n.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:s}),r());break}case"pointer-up":this._handlePointerEnd(t,i);break;case"pointer-drag":{if(!Nue(t))break;const s=this._grabbedManipulators.get(t.pointerId),n=this._draggedManipulators.get(t.pointerId),o=wt(s||n,({key:h})=>h),a=this._findManipulatorByKey(o,i.forEachTool);if(M(a))break;const l=jd(t);l.x=He(l.x,0,i.view.width),l.y=He(l.y,0,i.view.height);const c=(s||n).start;switch(t.action){case"start":case"update":t.action!=="update"&&this._grabbedManipulators.size!==1||(a.dragging=!0,n?a.events.emit("drag",{action:"update",start:c,screenPoint:l}):a.events.emit("drag",{action:"start",start:c,screenPoint:l,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{key:o,start:c}));break;case"end":a.dragging=!1,n&&a.events.emit("drag",{action:"end",start:c,screenPoint:l}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,i)}r();break}case"immediate-click":{const s=jd(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findToolAndManipulatorByKey(n,i.forEachTool,TN);if(Trt(t)||i.forEachTool(h=>{if((!_(o)||o.tool!==h||h.automaticManipulatorSelection)&&h.manipulators){let p=!1;h.manipulators.forEach(({manipulator:f})=>{f.selected&&(f.selected=!1,p=!0)}),p&&h.manipulatorSelectionChanged&&h.manipulatorSelectionChanged()}}),M(o))break;const{manipulator:a,tool:l}=o;if(!a.interactive)break;a.selectable&&l.automaticManipulatorSelection&&(a.selected=!a.selected,l.manipulatorSelectionChanged&&l.manipulatorSelectionChanged());const c=t.native.shiftKey;a.events.emit("immediate-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:c,stopPropagation:r});break}case"click":{const s=jd(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(M(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit(t.type,{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a}),r();break}case"double-click":{const s=jd(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(M(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r});break}case"immediate-double-click":{const s=jd(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(M(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r});break}}this._onFocusChange(i.forEachTool)}_ungrabManipulatorBeforeDragging(t,i,r){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:jd(r)}),this._grabbedManipulators.forEach(({key:s},n)=>{s.tool===i&&i.manipulators.findById(s.manipulatorId)===t&&this._grabbedManipulators.delete(n)})}_handlePointerEnd(t,i){const r=wt(this._grabbedManipulators.get(t.pointerId),({key:n})=>n),s=this._findManipulatorByKey(r,i.forEachTool);_(s)&&!s.dragging&&(this._grabbedManipulators.size===1&&this._draggedManipulators.size===0&&this._revertToActiveTool&&(i.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),s.grabbing&&(s.grabbing=!1,s.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:jd(t)})),this._grabbedManipulators.delete(t.pointerId))}_cursorFromMap(t,i){let r=null;return Mn(t,({key:s})=>{const n=this._findManipulatorByKey(s,i);return!!(_(n)&&n.interactive&&"cursor"in n&&n.cursor)&&(r=n.cursor,!0)}),r}_onFocusChange(t){this._updateCursor(t),this._updateFocusedManipulatorTools(t)}_updateCursor(t){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,t)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,t)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(t){const i=new Set;this._grabbedManipulators.forEach(({key:{tool:r}})=>{i.add(r)}),this._hoveredManipulators.forEach(({key:{tool:r}})=>{i.add(r)}),t(r=>{r.hasFocusedManipulators=i.has(r)})}clearPointers(t,i,r=!0,s){const n=o=>o.tool===t&&(M(s)||o.manipulatorId===s);this._grabbedManipulators.forEach(({key:o,pointerType:a},l)=>{if(n(o)){this._grabbedManipulators.delete(l);const c=this._findManipulatorByKey(o,i);_(c)&&(c.grabbing=!1,c.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:a}))}}),this._draggedManipulators.forEach(({key:o},a)=>{if(n(o)){this._draggedManipulators.delete(a);const l=this._findManipulatorByKey(o,i);_(l)&&(l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}}),r&&this._hoveredManipulators.forEach(({key:o},a)=>{if(n(o)){this._hoveredManipulators.delete(a);const l=this._findManipulatorByKey(o,i);_(l)&&(l.hovering=!1)}}),this._onFocusChange(i)}_intersect(t,i,r){let s=null;return r(n=>{if(n.manipulators==null||!_z(n))return!1;const o=n.manipulators.intersect(t,i);return!M(o)&&(s={manipulatorId:o.id,tool:n},!0)}),s}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(bp(i.x,i.y),r,i.pointerType,t)})}handleHoverEvent(t,i){t.type!=="pointer-up"&&t.type!=="immediate-click"&&t.type!=="pointer-move"||!Due(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(jd(t),t.pointerId,t.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(t,i,r,s){const n=this._intersect(t,r,s);let o=this._findManipulatorByKey(n,s);const a=wt(this._hoveredManipulators.get(i),({key:c})=>c),l=this._findManipulatorByKey(a,s);_(o)&&!o.interactive&&(o=null),l!==o&&(_(l)&&(l.hovering=!1),_(o)?(o.hovering=!0,this._hoveredManipulators.set(i,{key:n})):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_findManipulatorByKey(t,i){return this._findToolAndManipulatorByKey(t,i,TN)?TN.manipulator:null}_findToolAndManipulatorByKey(t,i,r){return M(t)?null:(r.tool=null,r.manipulator=null,i(s=>{if(s!==t.tool||s.manipulators==null||!_z(s))return!1;const n=s.manipulators.findById(t.manipulatorId);return!!_(n)&&(r.manipulator=n,r.tool=s,!0)}),r.manipulator?r:null)}}function Due(e){return e==="mouse"}function Nue(e){return e.pointerType!=="mouse"||e.button===0}function Trt(e){return!!e.native.shiftKey}const TN={manipulator:null,tool:null},Srt=ve.getLogger("esri.views.ToolViewManager"),Fue="attached",Y9="tools";let s0=class extends yv{constructor(e){super(e),this._manipulatorState=new xrt,this.tools=new nt,this.cursor=null,this._forEachTool=t=>{for(const i of this.tools.items)if(t(i))return}}initialize(){this.handles.add([this.view.on(rCe,e=>{this._handleInputEvent(e)},ts.TOOL),...wrt(this.tools),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._forEachTool)}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}set activeTool(e){if(_(e)&&!this.view.ready)return void Srt.error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),_(t)&&t.deactivate(),_(e)&&e.activate(),this._removeIncompleteTools(e);const i=M(this.activeTool);for(const r of this.tools){r.setEditableFlag(s$.MANAGER,i||r===this.activeTool);const s=_z(r);!i&&s||this._manipulatorState.clearPointers(r,this._forEachTool,!s)}this._updateCursor()}get updating(){var e,t;return this.updatingHandles.updating||this.tools.some(i=>i.updating)||((t=(e=this.textures)==null?void 0:e.updating)!=null?t:!1)}attach(){this.view.type==="3d"?(this._set("textures",new zC(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([re(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}),this.view.elevationProvider.on("elevation-change",e=>{this._forEachManipulator(t=>{t.onElevationChange!=null&&t.onElevationChange(e)})}),Fo(()=>this._set("textures",We(this.textures)))],Fue)):this.handles.add(re(()=>this.view.extent,()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}))}detach(){_(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(Fue)}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:i})=>e(i,t))})}_handleInputEvent(e){let t=!1;const i=me(F({},e),{stopPropagation:()=>{t=!0,e.stopPropagation()}});_(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(r=>{!t&&r.visible&&r.handleInputEvent(i)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:r=>{this.activeTool=r},view:this.view}),!t&&_(this.activeTool)&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(Y9),this._forEachTool(e=>{if(e instanceof Ee){const t=re(()=>[e.cursor,e.visible,e.editable],()=>{_z(e)||this._manipulatorState.clearPointers(e,this._forEachTool),this._updateCursor()});this.handles.add(t,Y9)}e.manipulators&&this.handles.add(e.manipulators.on("change",t=>{t.removed.forEach(({id:i})=>{this._manipulatorState.clearPointers(e,this._forEachTool,!0,i)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}),Y9)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){const e=this._manipulatorState.cursor;let t=e;this._forEachTool(i=>!(!_(i.cursor)||!i.visible||!M(e)&&i.preferManipulatorCursor)&&(t=i.cursor,!0)),this._get("cursor")!==t&&this._set("cursor",t)}_removeIncompleteTools(e){this.tools.filter(t=>(M(e)||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}};u([d({constructOnly:!0,nonNullable:!0})],s0.prototype,"view",void 0),u([d({readOnly:!0,nonNullable:!0})],s0.prototype,"textures",void 0),u([d({value:null})],s0.prototype,"activeTool",null),u([d({readOnly:!0,type:nt})],s0.prototype,"tools",void 0),u([d({readOnly:!0})],s0.prototype,"cursor",void 0),u([d({readOnly:!0})],s0.prototype,"updating",null),s0=u([L("esri.views.ToolViewManager")],s0);const Ert=s0;let oC=class extends Ee{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Crt.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Art[this.deviceType]}};u([d({nonNullable:!0,readOnly:!0})],oC.prototype,"nativeIndex",void 0),u([d({type:String,readOnly:!0})],oC.prototype,"deviceType",null),u([d({type:Number,readOnly:!0})],oC.prototype,"axisThreshold",null),oC=u([L("esri.views.input.gamepad.GamepadInputDevice")],oC);const Crt=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Art={standard:.15,spacemouse:.025,unknown:0},Xte=oC;let QP=class extends Ee{constructor(...e){super(...e),this.devices=new nt,this.enabledFocusMode="document"}};u([d({type:nt.ofType(Xte),readOnly:!0})],QP.prototype,"devices",void 0),u([d({type:["document","view","none"]})],QP.prototype,"enabledFocusMode",void 0),QP=u([L("esri.views.input.gamepad.GamepadSettings")],QP);const Mrt=QP;let X5=class extends Ee{constructor(){super(...arguments),this.gamepad=new Mrt}};u([d({readOnly:!0})],X5.prototype,"gamepad",void 0),X5=u([L("esri.views.input.Input")],X5);const Ort=X5;let n1=class extends Ee{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([d({type:Boolean,nonNullable:!0})],n1.prototype,"enabled",void 0),u([d({type:Xte})],n1.prototype,"device",void 0),u([d({type:["pan","zoom"],nonNullable:!0})],n1.prototype,"mode",void 0),u([d({type:["forward-down","forward-up"],nonNullable:!0})],n1.prototype,"tiltDirection",void 0),u([d({type:Number,nonNullable:!0})],n1.prototype,"velocityFactor",void 0),n1=u([L("esri.views.navigation.gamepad.GamepadSettings")],n1);const aCe=n1;let Ex=class extends Ee{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new aCe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([d({type:Boolean})],Ex.prototype,"browserTouchPanEnabled",void 0),u([d({type:aCe,nonNullable:!0})],Ex.prototype,"gamepad",void 0),u([d({type:Boolean})],Ex.prototype,"momentumEnabled",void 0),u([d({type:Boolean})],Ex.prototype,"mouseWheelZoomEnabled",void 0),Ex=u([L("esri.views.navigation.Navigation")],Ex);const lCe=Ex;function y5t(e,t,i){const r=cCe(e),s=t,n=Rrt(r,s,i);if(r){const o=e2.deriveUnitFromSR(r,e.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new W("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new W("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!Prt(e)||n===yu.Unsupported)return new W("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case yu.Units:{const o=r.heightUnit||"unknown",a=s.heightUnit||"unknown",l=new W("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new W("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case yu.HeightModel:{const o=r.heightModel||"unknown",a=s.heightModel||"unknown",l=new W("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new W("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case yu.CRS:{const o=r.vertCRS||"unknown",a=s.vertCRS||"unknown",l=new W("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new W("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function Rrt(e,t,i){if(!kue(e)||!kue(t))return yu.Unsupported;if(e==null||t==null)return yu.Ok;if(!i&&e.heightUnit!==t.heightUnit)return yu.Units;if(e.heightModel!==t.heightModel)return yu.HeightModel;switch(e.heightModel){case"gravity-related-height":return yu.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?yu.Ok:yu.CRS;default:return yu.Unsupported}}var yu;function kue(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function Prt(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!dCe(e)}function cCe(e){const t=e.url&&bv(e.url);return!((e.spatialReference&&e.spatialReference.vcsWkid)==null&&_(t)&&t.serverType==="ImageServer")&&uCe(e)&&e.heightModelInfo?e.heightModelInfo:dCe(e)?e2.deriveUnitFromSR($rt,e.spatialReference):null}function uCe(e){return"heightModelInfo"in e}function hCe(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;default:return!1}}function dCe(e){return hCe(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):pCe(e)}function Irt(e){return e.layers!=null||pCe(e)||hCe(e)||uCe(e)}function pCe(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"line-of-sight":case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"})(yu||(yu={}));const $rt=new e2({heightModel:"gravity-related-height"});var tt;function Uue(e){return e==="global"?tt.Global:tt.Local}function J9(e){return e===tt.Global?"global":"local"}(function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"})(tt||(tt={}));let pY,Q9=null;async function Lrt(e){Q9||(Q9=Promise.resolve().then(function(){return Cwt}).then(t=>pY=t)),await Q9,qt(e)}async function fCe(e,t,i,r){if(!e)return null;const s=e.spatialReference;return fB()||Jg(s,t)?Tp(e,t):pY?pY.projectGeometry(e,t,i,r):(await Promise.race([Lrt(r),V3(r)]),fCe(e,t,i,r))}let hs=class extends Ee{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Wn(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return _(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return M(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,r,s,n;const e=(i=this.map)==null?void 0:i.call(this),t=[];return _(this.priorityCollection)&&t.push(this.priorityCollection),t.push({parent:e==null?void 0:e.basemap,layers:(r=e==null?void 0:e.basemap)==null?void 0:r.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){var s;if(this.suspended)return(s=this._get("_spatialReferenceTask"))!=null?s:{updating:!1};const{layers:e,updating:t}=this._allLayers;let i=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);_(a)&&(i=a)}if(_(i)&&i.length===1)break}if(t&&(M(i)||i.length!==1))return{updating:!0};const r=this._pickSpatialReferenceCandidate(i);return{spatialReference:_(r)?r.spatialReference:null,viewingMode:_(r)?r.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,r,s,n,o,a,l,c;if(!this.required.tileInfo)return(i=this._get("_tileInfoTask"))!=null?i:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:(s=(r=this.map)==null?void 0:r.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const h=e[0].tileInfo;return{tileInfo:h&&h.spatialReference.equals(this.spatialReference)?h:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){var i,r,s,n;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))==null?void 0:i.heightModelInfo))return(r=this._get("_heightModelInfoTask"))!=null?r:{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const o of e)if(Irt(o)){const a=cCe(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){var r,s;if(this.suspended||!this.required.extent)return(r=this._get("_extentCandidatesTask"))!=null?r:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,i=[];for(const n of e.layers){const o="fullExtents"in n&&n.fullExtents||(_(n.fullExtent)?[n.fullExtent]:[]),a=this.requiresExtentInSpatialReference?null:o[0],l=(s=o.find(c=>c.spatialReference.equals(this.spatialReference)))!=null?s:a;if(l)return{candidates:[{extent:l,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const c of o)i.push({extent:c,layer:n})}return{candidates:i,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(M(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),r=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&r.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:_(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(_(this._projectExtentTask.task)&&(this._projectExtentTask.task=Wn(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:r.clone(),task:Pv(async s=>{try{const n=await fCe(i.extent,r,i.layer.portalItem,s);this._projectExtentTask=me(F({},this._projectExtentTask),{task:null,output:n})}catch{if(an(s))return;this._projectExtentTask=me(F({},this._projectExtentTask),{task:null})}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(M(e))return t;const i=[],r=(s,n)=>_(s)?_(n)?s===n&&s:s:n;for(const s of e)for(const n of t){if(!s.spatialReference.equals(n.spatialReference))continue;const o=r(s.viewingMode,n.viewingMode);if(o!==!1){i.push({spatialReference:s.spatialReference,viewingMode:o});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return M(e)||e.length<1?_(t)?{spatialReference:t,viewingMode:null}:null:(_(t)&&e.length>1&&e.some(({spatialReference:i})=>i.equals(t))&&(e=e.filter(({spatialReference:i})=>i.equals(t))),e.length>1&&e.some(({viewingMode:i})=>i!==tt.Local)&&(e=e.filter(({viewingMode:i})=>i!==tt.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const i=[];for(const r of t){const s=this.getSpatialReferenceSupport({spatialReference:r,layer:e});if(_(s)){const n=_(s.constraints)?s.constraints:[{spatialReference:r,viewingMode:null}];for(const{spatialReference:o,viewingMode:a}of n)(!this.requiresExtentInSpatialReference||M(this.userSpatialReference)||o.equals(this.userSpatialReference))&&i.push({spatialReference:o,viewingMode:a})}}return i}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:i})=>t.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const t={layers:[],preloading:-1,updating:!1};for(const r of e)if(this._collectCollection(r,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e?e.loadStatus==="not-loaded"?(e.load(),"loading"):e.loadStatus:"loaded"}};u([d()],hs.prototype,"required",void 0),u([d({constructOnly:!0})],hs.prototype,"map",void 0),u([d({constructOnly:!0})],hs.prototype,"getSpatialReferenceSupport",void 0),u([d()],hs.prototype,"defaultSpatialReference",void 0),u([d()],hs.prototype,"userSpatialReference",void 0),u([d()],hs.prototype,"sourcePreloadCount",void 0),u([d()],hs.prototype,"priorityCollection",void 0),u([d()],hs.prototype,"requiresExtentInSpatialReference",void 0),u([d()],hs.prototype,"suspended",void 0),u([d({readOnly:!0})],hs.prototype,"ready",null),u([d({readOnly:!0})],hs.prototype,"heightModelInfoReady",null),u([d({readOnly:!0})],hs.prototype,"spatialReference",null),u([d({readOnly:!0})],hs.prototype,"extent",null),u([d({readOnly:!0})],hs.prototype,"heightModelInfo",null),u([d({readOnly:!0})],hs.prototype,"vcsWkid",null),u([d({readOnly:!0})],hs.prototype,"latestVcsWkid",null),u([d({readOnly:!0})],hs.prototype,"viewingMode",null),u([d({readOnly:!0})],hs.prototype,"tileInfo",null),u([d({readOnly:!0})],hs.prototype,"mapCollections",null),u([d({readOnly:!0})],hs.prototype,"_allLayers",null),u([d({readOnly:!0})],hs.prototype,"_spatialReferenceTask",null),u([d({readOnly:!0})],hs.prototype,"_tileInfoTask",null),u([d({readOnly:!0})],hs.prototype,"_heightModelInfoTask",null),u([d({readOnly:!0})],hs.prototype,"_extentCandidatesTask",null),u([d()],hs.prototype,"_extentTask",null),u([d()],hs.prototype,"_projectExtentTask",void 0),hs=u([L("esri.views.support.DefaultsFromMap")],hs);var Y5;const SN=ve.getLogger("esri.views.View");let jt=Y5=class extends pm(cs.EventedMixin(nB(Ee))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new bS({getCollections:()=>{var t,i,r;return[(t=this.basemapView)==null?void 0:t.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:t=>t.layerViews}),this.groundView=null,this.animation=null,this.basemapView=null,this.fatalError=null,this.extent=null,this.graphics=new QT,this.analyses=new rM,this.navigating=!1,this.typeSpecificPreconditionsReady=!0,this.layerViews=new nt,this.magnifier=new iCe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Ort,this.navigation=new lCe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new vrt(this),this.persistableViewModels=new nt,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(re(()=>this.preconditionsReady,t=>{var i,r;t?(this._currentSpatialReference=this.spatialReference,Y5.views.add(this)):(this._currentSpatialReference=null,Y5.views.remove(this)),this.notifyChange("spatialReference"),!t&&this.ready?((i=this.layerViewManager)==null||i.clear(),(r=this.toolViewManager)==null||r.detach(),_(this.analysisViewManager)&&this.analysisViewManager.detach(),this._teardown()):t&&!this.ready&&(this._startup(),_(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},Ui))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,gv(()=>this.ready)))),this.basemapView=new s1({view:this}),this.layerViewManager=new hrt({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new Ert({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([re(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required=me(F({},this.defaultsFromMap.required),{extent:e}),{sync:!0,initial:!0}),re(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},{sync:!0}),re(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let e=null;this.handles.add([re(()=>{var t;return(t=this.defaultsFromMap)==null?void 0:t.ready},t=>{var r;const i=((r=this.map)==null?void 0:r.allLayers.length)>0;if(t&&!this.spatialReference&&i){if(_(e))return;const s=Fo(()=>e=Wn(e));e=Pv(async n=>{try{await nS(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{e=null}SN.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=We(this.graphics),this.analyses=We(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),We(this.analysisViewManager),this.toolViewManager=We(this.toolViewManager),this.layerViewManager=We(this.layerViewManager),this.basemapView=We(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,e==null||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return SN.error("#toMap()","Not implemented on this instance of View"),null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new hs(F({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:e=>this.getSpatialReferenceSupport(e)},this._defaultsFromMapSettings))}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){var e;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Zg.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((e=this.defaultsFromMap)==null?void 0:e.ready)||!this.typeSpecificPreconditionsReady)}set map(e){e!==this._get("map")&&((e==null?void 0:e.destroyed)&&(SN.warn("#map","The provided map is already destroyed",{map:e}),e=null),Zg.isLoadable(e)&&e.load().catch(()=>{}),this.initialized&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}get spatialReference(){var t,i;let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&((i=(t=this.defaultsFromMap)==null?void 0:t.required)==null?void 0:i.heightModelInfo)&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){const t=!_a(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){var e;return(e=this.defaultsFromMap)==null?void 0:e.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return _(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){var e;return(e=this.defaultsFromMap)==null?void 0:e.spatialReference}getDefaultHeightModelInfo(){var e,t,i;return(i=(t=this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)!=null?t:(e=this.defaultsFromMap)==null?void 0:e.heightModelInfo)!=null?i:null}importLayerView(e){throw new W("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return _(this.getSpatialReferenceSupport({spatialReference:e}))}when(e,t){return this.isResolved()&&!this.ready&&SN.warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(Jn(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};jt.views=new nt,u([d()],jt.prototype,"_userSpatialReference",void 0),u([ze("toolViewManager.activeTool")],jt.prototype,"activeTool",void 0),u([d({readOnly:!0})],jt.prototype,"allLayerViews",void 0),u([d()],jt.prototype,"groundView",void 0),u([d()],jt.prototype,"animation",void 0),u([d()],jt.prototype,"basemapView",void 0),u([d({readOnly:!0})],jt.prototype,"_defaultsFromMapSettings",null),u([d()],jt.prototype,"defaultsFromMap",null),u([d()],jt.prototype,"fatalError",void 0),u([d({type:yi})],jt.prototype,"extent",void 0),u([d(SU(QT,"graphics"))],jt.prototype,"graphics",void 0),u([d(SU(rM,"analyses"))],jt.prototype,"analyses",void 0),u([d({readOnly:!0,type:e2})],jt.prototype,"heightModelInfo",null),u([d({readOnly:!0})],jt.prototype,"interacting",null),u([d({readOnly:!0})],jt.prototype,"navigating",void 0),u([d({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],jt.prototype,"preconditionsReady",null),u([d({readOnly:!0})],jt.prototype,"typeSpecificPreconditionsReady",void 0),u([d({type:nt,readOnly:!0})],jt.prototype,"layerViews",void 0),u([d({type:iCe})],jt.prototype,"magnifier",void 0),u([d({value:null,type:lrt})],jt.prototype,"map",null),u([d()],jt.prototype,"padding",void 0),u([d({readOnly:!0})],jt.prototype,"ready",void 0),u([d({type:at})],jt.prototype,"spatialReference",null),u([d()],jt.prototype,"spatialReferenceWarningDelay",void 0),u([d()],jt.prototype,"stationary",null),u([d({readOnly:!0})],jt.prototype,"supportsGround",void 0),u([d({type:py})],jt.prototype,"timeExtent",void 0),u([ze("toolViewManager.tools")],jt.prototype,"tools",void 0),u([d()],jt.prototype,"toolViewManager",void 0),u([d({readOnly:!0})],jt.prototype,"type",void 0),u([d({type:Number})],jt.prototype,"scale",void 0),u([d({readOnly:!0})],jt.prototype,"updating",void 0),u([d({readOnly:!0})],jt.prototype,"initialExtentRequired",void 0),u([d({readOnly:!0})],jt.prototype,"initialExtent",null),u([d()],jt.prototype,"cursor",null),u([d({readOnly:!0})],jt.prototype,"input",void 0),u([d({type:lCe,nonNullable:!0})],jt.prototype,"navigation",void 0),u([d()],jt.prototype,"layerViewManager",void 0),u([d()],jt.prototype,"analysisViewManager",void 0),u([d()],jt.prototype,"width",void 0),u([d()],jt.prototype,"height",void 0),u([d({readOnly:!0})],jt.prototype,"resizing",void 0),u([d({value:null,readOnly:!0})],jt.prototype,"size",null),u([d({readOnly:!0})],jt.prototype,"suspended",void 0),u([d({readOnly:!0})],jt.prototype,"viewEvents",void 0),u([d({readOnly:!0})],jt.prototype,"persistableViewModels",void 0),u([d()],jt.prototype,"_isValid",void 0),u([d()],jt.prototype,"_readyCycleForced",void 0),u([d()],jt.prototype,"_currentSpatialReference",void 0),jt=Y5=u([L("esri.views.View")],jt);const Drt=jt;let o1=class extends wU{constructor(e){super(e),this.state="running",this.target=null}initialize(){this.addResolvingPromise(new Promise((e,t)=>this._dfd={resolve:e,reject:t}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._dfd.reject(new W("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._dfd.resolve())}update(e,t){t||(t=qu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};u([d({readOnly:!0})],o1.prototype,"done",null),u([d({readOnly:!0,type:String})],o1.prototype,"state",void 0),u([d()],o1.prototype,"target",void 0),o1=u([L("esri.views.ViewAnimation")],o1),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(o1||(o1={}));const dM=o1,lR=()=>import("./TileLayerView3D.3b5560db.js"),zue=()=>import("./ElevationLayerView3D.9bec8c4e.js"),Vue={"base-dynamic":()=>import("./BaseDynamicLayerView3D.39452472.js"),"base-elevation":zue,"base-tile":lR,"bing-maps":lR,"building-scene":()=>import("./BuildingSceneLayerView3D.db5e22c8.js"),csv:()=>import("./CSVLayerView3D.fc8bd326.js"),elevation:zue,feature:()=>import("./FeatureLayerView3D.bf58a421.js"),geojson:()=>import("./GeoJSONLayerView3D.edbf9510.js"),graphics:()=>import("./GraphicsLayerView3D.79aac1b2.js"),group:()=>import("./GroupLayerView.17296a80.js"),imagery:()=>import("./ImageryLayerView3D.47ad3333.js"),"integrated-mesh":()=>import("./IntegratedMeshLayerView3D.ebd5baf7.js"),"line-of-sight":()=>import("./LineOfSightLayerView3D.de13df3b.js"),"map-image":()=>import("./MapImageLayerView3D.3b4200fa.js"),media:()=>import("./MediaLayerView3D.a5f89b59.js"),"ogc-feature":()=>import("./OGCFeatureLayerView3D.d1f02d74.js"),"open-street-map":lR,"point-cloud":()=>import("./PointCloudLayerView3D.215ecc47.js").then(function(e){return e.P}),voxel:()=>import("./VoxelLayerView3D.114ef5eb.js"),route:()=>import("./RouteLayerView3D.a0c8f8ff.js"),scene:e=>e.profile==null||e.profile==="mesh-pyramids"?import("./SceneLayerView3D.f245b415.js"):import("./SceneLayerGraphicsView3D.1425c530.js"),stream:()=>import("./StreamLayerView3D.7bd2a320.js"),tile:lR,"imagery-tile":()=>import("./ImageryTileLayerView3D.70c4c16f.js"),"vector-tile":()=>import("./VectorTileLayerView3D.ecf48113.js"),wcs:()=>import("./ImageryTileLayerView3D.70c4c16f.js"),"web-tile":lR,wfs:()=>import("./WFSLayerView3D.48e33527.js"),wms:()=>import("./WMSLayerView3D.35461bb0.js"),wmts:()=>import("./WMTSLayerView3D.e22162e3.js"),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function Nrt(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new W(`${i}:view-not-supported`,`${t} is not supported in 3D`)}const Bue={hasLayerViewModule:e=>_(Vue[e.type]),importLayerView:e=>{const t=Vue[e.type];if(M(t))throw Nrt(e);return t(e)}},Frt=ve.getLogger("esri.views.3d.analysis.AnalysisViewManager3D"),Gue="analyses-owner-handles";var VC,aT;(function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED"})(VC||(VC={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(aT||(aT={}));let Cx=class extends yv{constructor(e){super(e),this._allAnalysisViews=new nt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=rm(),this._analysisModules={"area-measurement":{module:null},dimensioning:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(mi("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(mi()),this._attachedToViewResolver=rm(),this._attachedToViewResolver.promise.catch(()=>{})}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const t=this._items.get(e);if(M(t)||t.state.list===aT.REMOVED)throw new W("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),Gue)}_disconnectOwners(){this.handles.remove(Gue),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const r of e)this._addAnalysis(r);const t=e.on("after-add",r=>this._addAnalysis(r.item)),i=e.on("after-remove",r=>this._removeAnalysis(r.item));return{remove:()=>{t.remove(),i.remove();for(const r of e)this._removeAnalysis(r)}}}_addAnalysis(e){const t=this._items.get(e);if(t==null){const i={state:{view:VC.PENDING,list:aT.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=Pv(r=>this._createAnalysisViewPromise(i,r))}else t.state.list=aT.ADDED}_removeAnalysis(e){const t=this._items.get(e);t!=null?(t.state.list=aT.REMOVED,this._scheduleUpdate()):Frt.error("Trying to remove analysis which was not added")}_scheduleUpdate(){_(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=Zb(()=>this._update()))}_update(){this._scheduledUpdateHandle=hn(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===aT.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case VC.PENDING:e.createAnalysisViewTask=Wn(e.createAnalysisViewTask);break;case VC.CREATED:_(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=We(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,t){const i=e.analysis,r=i.type,s=this._analysisModules[r];if(this._creatingViewCount+=1,M(s.module))try{s.module=await this._loadAnalysisModule(r)}catch(o){throw this._creatingViewCount-=1,o}if(an(t))throw this._creatingViewCount-=1,mi("AnalysisView creation aborted");const n=new s.module.default({analysis:i,view:this.view});try{await n.when()}catch(o){throw this._creatingViewCount-=1,o}if(an(t))throw this._creatingViewCount-=1,n.destroy(),mi("AnalysisView creation aborted");return e.view=n,e.state.view=VC.CREATED,this._allAnalysisViews.add(n),this._creatingViewCount-=1,n}_loadAnalysisModule(e){switch(e){case"area-measurement":return import("./AreaMeasurementAnalysisView3D.3857f961.js").then(function(t){return t.A});case"dimensioning":return import("./DimensioningAnalysisView3D.de8793bd.js");case"direct-line-measurement":return import("./DirectLineMeasurementAnalysisView3D.c9f2ba46.js").then(function(t){return t.D});case"line-of-sight":return import("./LineOfSightAnalysisView3D.d8d01f90.js");case"slice":return import("./SliceAnalysisView3D.1c1105f7.js")}}};u([d()],Cx.prototype,"updating",null),u([d({constructOnly:!0})],Cx.prototype,"view",void 0),u([d()],Cx.prototype,"_allAnalysisViews",void 0),u([d()],Cx.prototype,"_creatingViewCount",void 0),Cx=u([L("esri.views.3d.analysis.AnalysisViewManager3D")],Cx);const krt=Cx,Urt=ve.getLogger("esri.views.3d.state.Constraints");let n0=class extends Ee{constructor(e){super(e),this.collision=new KP,this.distance=1/0,this.minimumPoiDistance=4}get altitude(){return this.mode===tt.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==tt.Local?this._set("altitude",e):Urt.warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?He(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const i=this.tilt(e);return He(t,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===tt.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,i=K9)=>(i.min=La.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?f5([[4e3,La.max],[1e4,Yt(88)],[6e6,Yt(88)]]):()=>La.max;return(t,i=K9)=>(i.min=La.min,i.max=e(t),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?f5([[4e3,La.max],[5e4,Yt(88)],[6e6,Yt(88)],[2e7,La.min]]):f5([[3e5,La.max],[3e6,Yt(88)],[6e6,Yt(88)],[2e7,La.min]]);return(t,i=K9)=>(i.min=La.min,i.max=e(t),i)}};function zrt(e){return{min:-2e5,max:4*e.radius}}u([d()],n0.prototype,"altitude",null),u([d({readOnly:!0})],n0.prototype,"collision",void 0),u([d()],n0.prototype,"distance",void 0),u([d({readOnly:!0})],n0.prototype,"minimumPoiDistance",void 0),u([d()],n0.prototype,"tilt",void 0),u([d({constructOnly:!0})],n0.prototype,"mode",void 0),n0=u([L("esri.views.3d.state.Constraints")],n0);const jue=zrt(Qi),La={min:Yt(.5),max:Yt(179.5)},K9={min:0,max:0};let KP=class extends Ee{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([d({type:Boolean})],KP.prototype,"enabled",void 0),u([d({type:Number})],KP.prototype,"elevationMargin",void 0),KP=u([L("esri.views.3d.state.Constraints.CollisionConstraint")],KP);let BC=class extends Ee{constructor(){super(...arguments),this.min=jue.min,this.max=jue.max}};u([d({type:Number})],BC.prototype,"min",void 0),u([d({type:Number})],BC.prototype,"max",void 0),BC=u([L("esri.views.3d.constraints.AltitudeConstraint")],BC);let T0=class extends Ee{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};u([d({type:Number,value:1e-8})],T0.prototype,"near",null),u([Jt("near")],T0.prototype,"castNear",null),u([d({type:Number,value:1e-8})],T0.prototype,"far",null),u([Jt("far")],T0.prototype,"castFar",null),u([d({type:["auto","manual"]})],T0.prototype,"mode",void 0),T0=u([L("esri.views.3d.constraints.ClipDistanceConstraint")],T0);const fY={min:Vu(La.min),max:Vu(La.max)};let lT=class extends Ee{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return He(e,fY.min,fY.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([d({type:["auto","manual"]})],lT.prototype,"mode",void 0),u([d({type:Number,value:fY.max})],lT.prototype,"max",null),u([Jt("max")],lT.prototype,"castMax",null),lT=u([L("esri.views.3d.constraints.TiltConstraint")],lT);let cT=class extends Ee{constructor(){super(...arguments),this.tilt=new lT,this.altitude=new BC,this.clipDistance=new T0}};u([d({type:lT})],cT.prototype,"tilt",void 0),u([d({type:BC})],cT.prototype,"altitude",void 0),u([d({type:T0})],cT.prototype,"clipDistance",void 0),cT=u([L("esri.views.3d.constraints.Constraints")],cT);var mY;let Nd=mY=class extends Ce{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return t.datetime!=null&&new Date(t.datetime)||null}writeDate(e,t,i){t[i]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,i){e&&(t[i]=e)}writeDisplayUTCOffset(e,t){e!=null&&(t.displayUTCOffset=e)}clone(){return new mY(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(e.date=new Date(this.date.getTime())),e}};u([d({readOnly:!0,type:["sun"],json:{write:!0}})],Nd.prototype,"type",void 0),u([d({type:Date,json:{type:Number,write:{target:"datetime"}}})],Nd.prototype,"date",void 0),u([De("date",["datetime"])],Nd.prototype,"readDate",null),u([it("date")],Nd.prototype,"writeDate",null),u([d({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Nd.prototype,"directShadowsEnabled",void 0),u([De("directShadowsEnabled",["directShadows"])],Nd.prototype,"readDirectShadowsEnabled",null),u([it("directShadowsEnabled")],Nd.prototype,"writedirectShadowsEnabled",null),u([d({type:Number,json:{write:!0}})],Nd.prototype,"displayUTCOffset",void 0),u([it("displayUTCOffset")],Nd.prototype,"writeDisplayUTCOffset",null),Nd=mY=u([L("esri.webscene.SunLighting")],Nd);const n$=Nd;var aC;let Jm=aC=class extends cs.EventedMixin(n$){constructor(e){super(e),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const t=new Date().getFullYear(),i=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new aC(e.cloneConstructProperties())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){e!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const i=aC.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let r=null;e!=null&&(this.positionTimezoneInfo.autoUpdated=!0,r=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime())));const s=aC.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(ej.target=this,ej.timezoneOffset=s,this.emit("timezone-will-change",ej)),e!=null)return r!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new aC(me(F({},this.cloneConstructProperties()),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}));return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return e.date!=null&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}};u([d({type:Boolean})],Jm.prototype,"cameraTrackingEnabled",void 0),u([d({type:Boolean})],Jm.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],Jm.prototype,"waterReflectionEnabled",void 0),u([d({type:Date})],Jm.prototype,"defaultDate",null),u([d({type:Date})],Jm.prototype,"date",null),Jm=aC=u([L("esri.views.3d.environment.SunLighting")],Jm),function(e){function t({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}e.calculateTimezoneOffset=t}(Jm||(Jm={}));const ej={target:null,timezoneOffset:0},yg=Jm;var gY;let eI=gY=class extends Ce{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new gY(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([d({readOnly:!0,type:["virtual"],json:{write:!0}})],eI.prototype,"type",void 0),u([d({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],eI.prototype,"directShadowsEnabled",void 0),eI=gY=u([L("esri.webscene.VirtualLighting")],eI);const o6=eI;var J5;let tI=J5=class extends cs.EventedMixin(o6){constructor(e){super(e),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1}clone(){return new J5(me(F({},this.cloneConstructProperties()),{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}))}static fromWebsceneLighting(e){return new J5(e.cloneConstructProperties())}cloneWithWebsceneLighting(e){const t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}};u([d({type:Boolean})],tI.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],tI.prototype,"waterReflectionEnabled",void 0),tI=J5=u([L("esri.views.3d.environment.VirtualLighting")],tI);const GC=tI,Vrt={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:yg,virtual:GC}};var yY;let YI=yY=class extends Ee{set quality(e){["low","high"].includes(e)&&this._set("quality",e)}clone(){return new yY({quality:this.quality})}};u([d({type:["low","high"],value:"low"})],YI.prototype,"quality",null),YI=yY=u([L("esri.views.3d.environment.SceneViewAtmosphere")],YI);var vY;let iI=vY=class extends Ce{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new vY({cloudCover:this.cloudCover})}};u([bt({sunny:"sunny"})],iI.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],iI.prototype,"cloudCover",void 0),iI=vY=u([L("esri.views.3d.environment.SunnyWeather")],iI);const bz=iI;var _Y;let rI=_Y=class extends Ce{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new _Y({cloudCover:this.cloudCover})}};u([bt({cloudy:"cloudy"})],rI.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],rI.prototype,"cloudCover",void 0),rI=_Y=u([L("esri.views.3d.environment.CloudyWeather")],rI);const mCe=rI;var bY;let sI=bY=class extends Ce{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new bY({fogStrength:this.fogStrength})}};u([bt({foggy:"foggy"})],sI.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],sI.prototype,"fogStrength",void 0),sI=bY=u([L("esri.views.3d.environment.FoggyWeather")],sI);const gCe=sI;var wY;let lC=wY=class extends Ce{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new wY({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([bt({rainy:"rainy"})],lC.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],lC.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],lC.prototype,"precipitation",void 0),lC=wY=u([L("esri.views.3d.environment.RainyWeather")],lC);const yCe=lC;var xY;let Ax=xY=class extends Ce{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new xY({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([bt({snowy:"snowy"})],Ax.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Ax.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Ax.prototype,"precipitation",void 0),u([d({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],Ax.prototype,"snowCover",void 0),Ax=xY=u([L("esri.views.3d.environment.SnowyWeather")],Ax);const vCe=Ax,_Ce={key:"type",base:bz,typeMap:{sunny:bz,cloudy:mCe,rainy:yCe,snowy:vCe,foggy:gCe}},bCe=Object.keys(_Ce.typeMap);function wCe(e,t){return!!bCe.includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)}const Qd=1e4,Brt={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:n$,virtual:o6}};let Q5=class extends Ce{constructor(e){super(e)}clone(){}};u([d({readOnly:!0,json:{read:!1}})],Q5.prototype,"type",void 0),Q5=u([L("esri.webscene.background.Background")],Q5);const xCe=Q5;var TY;const Grt=me(F({},Iv),{nonNullable:!0});let nI=TY=class extends xCe{constructor(e){super(e),this.type="color",this.color=new Le([0,0,0,1])}clone(){return new TY(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([bt({color:"color"},{readOnly:!0})],nI.prototype,"type",void 0),u([d(Grt)],nI.prototype,"color",void 0),nI=TY=u([L("esri.webscene.background.ColorBackground")],nI);const TCe=nI,Hue={base:xCe,key:"type",typeMap:{color:TCe}};function jrt(e){return(t,i,r)=>{if(!t)return t;for(const s in e.typeMap)if(t.type===s){const n=new e.typeMap[s];return n.read(t,r),n}}}const Hrt={types:Hue,json:{read:jrt(Hue),write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.isPresentation})}}};var SY;const qrt=ve.getLogger("esri.webscene.Environment"),que=(e,t,i)=>({enabled:!i||!i.isPresentation});let a1=SY=class extends Ce{constructor(e){super(e),this.lighting=new n$,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){wCe(e==null?void 0:e.type,qrt)&&this._set("weather",e)}clone(){return new SY(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?o6.prototype.clone.call(this.lighting):n$.prototype.clone.call(this.lighting),background:ue(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([d({types:Brt,nonNullable:!0,json:{write:!0}})],a1.prototype,"lighting",void 0),u([d(Hrt)],a1.prototype,"background",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:que}}})],a1.prototype,"atmosphereEnabled",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:que}}})],a1.prototype,"starsEnabled",void 0),u([d({types:_Ce,nonNullable:!0,json:{write:!0},value:new bz})],a1.prototype,"weather",null),a1=SY=u([L("esri.webscene.Environment")],a1);const SCe=a1;var oI;let cC=oI=class extends SCe{constructor(e){super(e),this.atmosphere=new YI,this.lighting=new yg}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new oI(me(F({},t),{lighting:t.lighting.type==="virtual"?GC.fromWebsceneLighting(t.lighting):yg.fromWebsceneLighting(t.lighting)}))}castLighting(e){return this._convertLighting(e)}applyLighting(e){this.lighting=this._convertLighting(e)}_convertLighting(e){return e?e instanceof yg||e instanceof GC?e:e instanceof n$?this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e):new yg(e.cloneConstructProperties()):e instanceof o6?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e):new GC(e.cloneConstructProperties()):im(Vrt,e):new yg}clone(){return new oI({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ue(this.background)})}cloneWithWebsceneEnvironment(e){return new oI(me(F({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ue(this.background)},e.cloneConstructProperties()),{lighting:this._getLighting(e)}))}_getLighting(e){return e.lighting.type==="sun"?this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e.lighting):yg.fromWebsceneLighting(e.lighting):e.lighting.type==="virtual"?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e.lighting):GC.fromWebsceneLighting(e.lighting):yg.fromWebsceneLighting(e.lighting)}};u([d({type:YI,json:{read:!1},nonNullable:!0})],cC.prototype,"atmosphere",void 0),u([d({nonNullable:!0})],cC.prototype,"lighting",void 0),u([Jt("lighting")],cC.prototype,"castLighting",null),cC=oI=u([L("esri.views.3d.environment.SceneViewEnvironment")],cC);const uC=cC;function po(e,t){return e[0]=t[0],e[1]=t[1],e}function Li(e,t,i){return e[0]=t,e[1]=i,e}function $h(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function Ss(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function ECe(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function CCe(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function Wrt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function Zrt(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Xrt(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e}function Yrt(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e}function Jrt(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function Oc(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function Fg(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e}function a2(e,t){const i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}function ty(e,t){const i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function a6(e){const t=e[0],i=e[1];return Math.sqrt(t*t+i*i)}function wS(e){const t=e[0],i=e[1];return t*t+i*i}function Yte(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Qrt(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function pM(e,t){const i=t[0],r=t[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function ys(e,t){return e[0]*t[0]+e[1]*t[1]}function Krt(e,t,i){const r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e}function F0(e,t,i,r){const s=t[0],n=t[1];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e}function est(e,t){t=t||1;const i=2*$f()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e}function EY(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s,e[1]=i[1]*r+i[3]*s,e}function Mx(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s+i[4],e[1]=i[1]*r+i[3]*s+i[5],e}function tst(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[3]*s+i[6],e[1]=i[1]*r+i[4]*s+i[7],e}function ist(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[4]*s+i[12],e[1]=i[1]*r+i[5]*s+i[13],e}function rst(e,t,i,r){const s=t[0]-i[0],n=t[1]-i[1],o=Math.sin(r),a=Math.cos(r);return e[0]=s*a-n*o+i[0],e[1]=s*o+n*a+i[1],e}function sst(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function nst(e){return"vec2("+e[0]+", "+e[1]+")"}function ACe(e,t){return e[0]===t[0]&&e[1]===t[1]}function ost(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];return Math.abs(i-s)<=Ut*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=Ut*Math.max(1,Math.abs(r),Math.abs(n))}function ast(e,t,i,r,s){let n=t[0]-i[0],o=t[1]-i[1];const a=(r[0]*n+r[1]*o)*(s-1);return n=r[0]*a,o=r[1]*a,e[0]=t[0]+n,e[1]=t[1]+o,e}const lst=a6,cst=Ss,ust=ECe,hst=CCe,MCe=a2,dst=ty,pst=wS;Object.freeze(Object.defineProperty({__proto__:null,copy:po,set:Li,add:$h,subtract:Ss,multiply:ECe,divide:CCe,ceil:Wrt,floor:Zrt,min:Xrt,max:Yrt,round:Jrt,scale:Oc,scaleAndAdd:Fg,distance:a2,squaredDistance:ty,length:a6,squaredLength:wS,negate:Yte,inverse:Qrt,normalize:pM,dot:ys,cross:Krt,lerp:F0,random:est,transformMat2:EY,transformMat2d:Mx,transformMat3:tst,transformMat4:ist,rotate:rst,angle:sst,str:nst,exactEquals:ACe,equals:ost,projectAndScale:ast,len:lst,sub:cst,mul:ust,div:hst,dist:MCe,sqrDist:dst,sqrLen:pst},Symbol.toStringTag,{value:"Module"}));function OCe(e){return Math.min(1,Math.max(0,(e-1e5)/(1e6-1e5)))}const CY=1e4,$2=Ze(5802e-9,13558e-9,331e-7),tj=3,ij=Ze(65e-8*tj,1881e-9*tj,85e-9*tj),fst=3996e-9,mst=.085,K5=1e5;class Nn{}function E(e,...t){let i="";for(let r=0;r<t.length;r++)i+=e[r]+t[r];return i+=e[e.length-1],i}(function(e){function t(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}e.int=t,e.float=i})(E||(E={}));var P;(function(e){e.POSITION="position",e.NORMAL="normal",e.UV0="uv0",e.AUXPOS1="auxpos1",e.AUXPOS2="auxpos2",e.MAPPOS="mapPos",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.NORMALCOMPRESSED="normalCompressed",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.MODELORIGINHI="modelOriginHi",e.MODELORIGINLO="modelOriginLo",e.MODEL="model",e.MODELNORMAL="modelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMALA="normalA",e.NORMALB="normalB",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.U8PADDING="u8padding",e.U16PADDING="u16padding",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude"})(P||(P={}));var Hn;function ev(e,t){switch(t.textureCoordinateType){case Hn.Default:return e.attributes.add(P.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(E`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Hn.Atlas:return e.attributes.add(P.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(P.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(E`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);case Hn.None:return void e.vertex.code.add(E`void forwardTextureCoordinates() {}`);default:t.textureCoordinateType;case Hn.COUNT:return}}(function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.COUNT=3]="COUNT"})(Hn||(Hn={}));function Zu(e){e.code.add(E`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function ad(e){e.include(Zu),e.code.add(E`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function l6(e){e.fragment.code.add(E`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var ar;(function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"})(ar||(ar={}));class $s{constructor(t,i,r,s,n=null){this.name=t,this.type=i,this.arraySize=n,this.bind={[ar.Pass]:null,[ar.Draw]:null},_(r)&&_(s)&&(this.bind[r]=s)}equals(t){return this.type===t.type&&this.name===t.name&&this.arraySize===t.arraySize}}class Di extends $s{constructor(t,i){super(t,"vec2",ar.Pass,(r,s,n)=>r.setUniform2fv(t,i(s,n)))}}class tv extends $s{constructor(t){super(t,"vec2")}}class Dt extends $s{constructor(t,i){super(t,"vec3",ar.Pass,(r,s,n)=>r.setUniform3fv(t,i(s,n)))}}class Lc extends $s{constructor(t){super(t,"vec3")}}class Gl extends $s{constructor(t){super(t,"vec4")}}class nr extends $s{constructor(t){super(t,"float")}}class Xr extends $s{constructor(t,i){super(t,"mat4",ar.Pass,(r,s,n)=>r.setUniformMatrix4fv(t,i(s,n)))}}const gst=ve.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class RCe{constructor(){this.includedModules=new Map}include(t,i){if(this.includedModules.has(t)){const r=this.includedModules.get(t);if(r!==i){gst.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(r))r[n]!==t[n]&&s.add(n);for(const n of Object.keys(t))r[n]!==t[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${r[n]} new ${t[n]}`))}}else this.includedModules.set(t,i),t(this.builder,i)}}class mr extends RCe{constructor(){super(...arguments),this.vertex=new Wue,this.fragment=new Wue,this.attributes=new _st,this.varyings=new bst,this.extensions=new fM,this.constants=new nn}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t){const i=this.extensions.generateSource(t),r=this.attributes.generateSource(t),s=this.varyings.generateSource(),n=t==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=t==="vertex"?xst:wst,c=this.constants.generateSource().concat(n.constants.generateSource());return`
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(t,i){const r=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[t];_(a)&&r.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[t];_(a)&&r.set(o.name,a)});const s=Array.from(r.values()),n=s.length;return(o,a)=>{for(let l=0;l<n;++l)s[l](i,o,a)}}}class yst{constructor(){this._entries=new Map}add(t){if(!Array.isArray(t))return this._add(t);for(const i of t)this._add(i)}_add(t){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new W(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}generateSource(){return Array.from(this._entries.values()).map(t=>_(t.arraySize)?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}}class vst{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class Wue extends RCe{constructor(){super(...arguments),this.uniforms=new yst,this.code=new vst,this.constants=new nn}get builder(){return this}}class _st{constructor(){this._entries=new Array}add(t,i){this._entries.push([t,i])}generateSource(t){return t==="fragment"?[]:this._entries.map(i=>`attribute ${i[1]} ${i[0]};`)}}class bst{constructor(){this._entries=new Array}add(t,i){this._entries.push([t,i])}generateSource(){return this._entries.map(t=>`varying ${t[1]} ${t[0]};`)}}class fM{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const i=t==="vertex"?fM.ALLOWLIST_VERTEX:fM.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}}fM.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],fM.ALLOWLIST_VERTEX=[];class nn{constructor(){this._entries=new Set}add(t,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=nn._numberToFloatStr(r);break;case"int":s=nn._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${nn._numberToFloatStr(r[0])},                            ${nn._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${nn._numberToFloatStr(r[0])},                            ${nn._numberToFloatStr(r[1])},                            ${nn._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${nn._numberToFloatStr(r[0])},                            ${nn._numberToFloatStr(r[1])},                            ${nn._numberToFloatStr(r[2])},                            ${nn._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${nn._numberToIntStr(r[0])},                             ${nn._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${nn._numberToIntStr(r[0])},                             ${nn._numberToIntStr(r[1])},                             ${nn._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${nn._numberToIntStr(r[0])},                             ${nn._numberToIntStr(r[1])},                             ${nn._numberToIntStr(r[2])},                             ${nn._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>nn._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${t} = ${s};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const wst=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,xst=`precision highp float;
precision highp sampler2D;`;class ws extends $s{constructor(t){super(t,"sampler2D")}}function Tst(e){const t=new mr;t.attributes.add(P.POSITION,"vec2"),t.include(ev,{textureCoordinateType:Hn.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=t;return i.uniforms.add([new Xr("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Xr("inverseViewMatrix",(s,n)=>Ks(Sst,n.camera.viewMatrix))]),i.code.add(E`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add([new Dt("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new tv("radii"),new nr("scaleHeight"),new Lc("cameraPosition"),new Gl("heightParameters"),new nr("innerFadeDistance"),new nr("altitudeFade"),new ws("depthTex"),new Lc("betaRayleigh"),new Lc("betaCombined"),new nr("betaMie"),new nr("hazeStrength")]),t.include(l6),e.haze&&(r.include(ad),r.uniforms.add(new Di("nearFar",(s,n)=>n.camera.nearFar))),r.code.add(E`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(E`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(E`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(E`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${e.haze?E`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${e.haze?E``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${e.haze?"":E`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.05968310365 * mumu;

      ${e.haze?E`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:E`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.haze?E`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:E`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${e.haze?E`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:E`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${e.haze?"":E`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `),t}const Sst=Ne(),Est=Object.freeze(Object.defineProperty({__proto__:null,build:Tst},Symbol.toStringTag,{value:"Module"}));class Sr{constructor(t,i){this._module=t,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}var wr,Wt,ke,xv,Lt,zf,mM,St,Fr,Vs,gt,$t,At,Qe,Mt,kt,Ul,Wi,kh,Oo,zs,Yi;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(wr||(wr={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Wt||(Wt={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(ke||(ke={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(xv||(xv={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(Lt||(Lt={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(zf||(zf={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(mM||(mM={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(St||(St={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(Fr||(Fr={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(Vs||(Vs={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(gt||(gt={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}($t||($t={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(At||(At={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Qe||(Qe={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(Mt||(Mt={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(kt||(kt={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Ul||(Ul={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(Wi||(Wi={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(kh||(kh={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Oo||(Oo={})),function(e){e[e.TEXTURE=0]="TEXTURE",e[e.RENDER_BUFFER=1]="RENDER_BUFFER",e[e.CUBEMAP=2]="CUBEMAP"}(zs||(zs={})),function(e){e[e.NONE=0]="NONE",e[e.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",e[e.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(Yi||(Yi={}));const rj=33984;var co,Eh;(function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.Sync=7]="Sync",e[e.COUNT=8]="COUNT"})(co||(co={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Eh||(Eh={}));const Zue=33306;var ks,Xue,Yue,Jue,wz,AY,Que;(function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(ks||(ks={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(Xue||(Xue={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(Yue||(Yue={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(Jue||(Jue={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(wz||(wz={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(AY||(AY={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Que||(Que={}));class Lr{constructor(t,i,r){this.release=r,i&&(this.initializeConfiguration(t,i),this._configuration=i.snapshot()),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}destroy(){this._program=ht(this._program),this._pipeline=this._configuration=null}reload(t){ht(this._program),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.isCompiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPass(t,i){this.program.bindPass(t,i)}bindDraw(t,i){this.program.bindDraw(t,i),this.program.rebindTextures()}bindPipelineState(t,i=null,r){t.setPipelineState(this.getPipelineState(i,r))}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}get primitiveType(){return Wt.TRIANGLES}getPipelineState(t,i){return this._pipeline}initializeConfiguration(t,i){}}const lr=new Map([[P.POSITION,0],[P.NORMAL,1],[P.UV0,2],[P.COLOR,3],[P.SIZE,4],[P.TANGENT,4],[P.AUXPOS1,5],[P.SYMBOLCOLOR,5],[P.AUXPOS2,6],[P.FEATUREATTRIBUTE,6],[P.INSTANCEFEATUREATTRIBUTE,6],[P.INSTANCECOLOR,7],[P.MODEL,8],[P.MODELNORMAL,12],[P.MODELORIGINHI,11],[P.MODELORIGINLO,15]]),Cst=ve.getLogger("esri/views/webgl");function Ast(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const PCe=!!ye("enable-feature:webgl-debug");function Wd(){return PCe}function o$(){return PCe}function ib(e){if(Wd()){const t=e.getError();if(t){const i=Ast(e,t),r=new Error().stack;Cst.error(new W("webgl-error","WebGL error occured",{message:i,stack:r}))}}}class Er{constructor(t,i,r){this._context=t,this._locations=r,this._textures=new Map,this._freeTextureUnits=new ai({deallocator:null}),this._glProgram=t.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBind(ar.Pass,this),this.bindDraw=i.generateBind(ar.Draw,this),this._fragmentUniforms=Wd()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get isCompiled(){return this._glProgram.isCompiled}setUniform1b(t,i){this._glProgram.setUniform1i(t,i?1:0)}setUniform1i(t,i){this._glProgram.setUniform1i(t,i)}setUniform1f(t,i){this._glProgram.setUniform1f(t,i)}setUniform2f(t,i,r){this._glProgram.setUniform2f(t,i,r)}setUniform2fv(t,i){this._glProgram.setUniform2fv(t,i)}setUniform3f(t,i,r,s){this._glProgram.setUniform3f(t,i,r,s)}setUniform3fv(t,i){this._glProgram.setUniform3fv(t,i)}setUniform4f(t,i,r,s,n){this._glProgram.setUniform4f(t,i,r,s,n)}setUniform4fv(t,i){this._glProgram.setUniform4fv(t,i)}setUniformMatrix3fv(t,i){this._glProgram.setUniformMatrix3fv(t,i)}setUniformMatrix4fv(t,i){this._glProgram.setUniformMatrix4fv(t,i)}setUniform1fv(t,i){this._glProgram.setUniform1fv(t,i)}setUniform1iv(t,i){this._glProgram.setUniform1iv(t,i)}setUniform2iv(t,i){this._glProgram.setUniform3iv(t,i)}setUniform3iv(t,i){this._glProgram.setUniform3iv(t,i)}setUniform4iv(t,i){this._glProgram.setUniform4iv(t,i)}assertCompatibleVertexAttributeLocations(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(t,i){if(M(i)||i.glName==null){const s=this._textures.get(t);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(t)),null}let r=this._textures.get(t);return r==null?(r=this._allocTextureUnit(i),this._textures.set(t,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(t,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((t,i)=>{this._context.bindTexture(t.texture,t.unit),this.setUniform1i(i,t.unit)}),_(this._fragmentUniforms)&&this._fragmentUniforms.forEach(t=>{t.type!=="sampler2D"&&t.type!=="samplerCube"||this._textures.has(t.name)||console.error(`Texture sampler ${t.name} has no bound texture`)})}_allocTextureUnit(t){return{texture:t,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(t){this._freeTextureUnits.push(t.unit)}}var Ir,xS,uT,Rt,An,Tu,Fc,gM,Tv,kc,fb,yM,Rr,TS;(function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"})(Ir||(Ir={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(xS||(xS={})),function(e){e[e.NONE=0]="NONE",e[e.SMAA=1]="SMAA"}(uT||(uT={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"}(Rt||(Rt={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(An||(An={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(Tu||(Tu={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Fc||(Fc={})),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(gM||(gM={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(Tv||(Tv={})),function(e){e[e.Triangle=0]="Triangle",e[e.Point=1]="Point",e[e.Line=2]="Line"}(kc||(kc={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}(fb||(fb={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(yM||(yM={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(Rr||(Rr={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(TS||(TS={}));function my(e,t,i=xv.ADD,r=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function ba(e,t,i,r,s=xv.ADD,n=xv.ADD,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const Jte={face:zf.BACK,mode:mM.CCW},ICe={face:zf.FRONT,mode:mM.CCW},c6=e=>e===Ir.Back?Jte:e===Ir.Front?ICe:null,jc={zNear:0,zFar:1},xi={r:!0,g:!0,b:!0,a:!0};function Mst(e){return Nst.intern(e)}function Ost(e){return Fst.intern(e)}function Rst(e){return kst.intern(e)}function Pst(e){return Ust.intern(e)}function Ist(e){return zst.intern(e)}function $st(e){return Vst.intern(e)}function Lst(e){return Bst.intern(e)}function Dst(e){return Gst.intern(e)}function ri(e){return jst.intern(e)}class Nv{constructor(t,i){this.makeKey=t,this.makeRef=i,this.interns=new Map}intern(t){if(!t)return null;const i=this.makeKey(t),r=this.interns;return r.has(i)||r.set(i,this.makeRef(t)),r.get(i)}}function Fv(e){return"["+e.join(",")+"]"}const Nst=new Nv($Ce,e=>F({__tag:"Blending"},e));function $Ce(e){return e?Fv([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const Fst=new Nv(LCe,e=>F({__tag:"Culling"},e));function LCe(e){return e?Fv([e.face,e.mode]):null}const kst=new Nv(DCe,e=>F({__tag:"PolygonOffset"},e));function DCe(e){return e?Fv([e.factor,e.units]):null}const Ust=new Nv(NCe,e=>F({__tag:"DepthTest"},e));function NCe(e){return e?Fv([e.func]):null}const zst=new Nv(FCe,e=>F({__tag:"StencilTest"},e));function FCe(e){return e?Fv([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const Vst=new Nv(kCe,e=>F({__tag:"DepthWrite"},e));function kCe(e){return e?Fv([e.zNear,e.zFar]):null}const Bst=new Nv(UCe,e=>F({__tag:"ColorWrite"},e));function UCe(e){return e?Fv([e.r,e.g,e.b,e.a]):null}const Gst=new Nv(zCe,e=>F({__tag:"StencilWrite"},e));function zCe(e){return e?Fv([e.mask]):null}const jst=new Nv(Hst,e=>({blending:Mst(e.blending),culling:Ost(e.culling),polygonOffset:Rst(e.polygonOffset),depthTest:Pst(e.depthTest),stencilTest:Ist(e.stencilTest),depthWrite:$st(e.depthWrite),colorWrite:Lst(e.colorWrite),stencilWrite:Dst(e.stencilWrite)}));function Hst(e){return e?Fv([$Ce(e.blending),LCe(e.culling),DCe(e.polygonOffset),NCe(e.depthTest),FCe(e.stencilTest),kCe(e.depthWrite),UCe(e.colorWrite),zCe(e.stencilWrite)]):null}class qst{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(t,i,r,s){return(r||t!==i)&&(s(t),this._pipelineInvalid=!0),t}}class a$ extends Lr{initializeProgram(t){const i=a$.shader.get().build(this.configuration);return new Er(t.rctx,i,lr)}initializePipeline(){return this.configuration.haze?ri({blending:ba(ke.ONE,ke.ZERO,ke.ONE_MINUS_SRC_COLOR,ke.ONE),colorWrite:xi}):ri({blending:ba(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),depthTest:{func:Fr.LEQUAL},colorWrite:xi})}}a$.shader=new Sr(Est,()=>import("./ChapmanAtmosphere.glsl.5082b008.js"));class Xl{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const t=this._parameterNames,i={key:this.key};for(const r of t)i[r]=this[r];return i}}function Q(e={}){return(t,i)=>{var r,s;if(t._parameterNames=(r=t._parameterNames)!=null?r:[],t._parameterNames.push(i),e.constValue!=null)Object.defineProperty(t,i,{get:()=>e.constValue});else{const n=t._parameterNames.length-1,o=e.count||2,a=Math.ceil(Math.log2(o)),l=(s=t._parameterBits)!=null?s:[0];let c=0;for(;l[c]+a>16;)c++,c>=l.length&&l.push(0);t._parameterBits=l;const h=l[c],p=(1<<a)-1<<h;l[c]+=a,Object.defineProperty(t,i,{get(){return this[n]},set(f){if(this[n]!==f&&(this[n]=f,this._keyDirty=!0,this._parameterBits[c]=this._parameterBits[c]&~p|+f<<h&p,typeof f!="number"&&typeof f!="boolean"))throw"Configuration value for "+i+" must be boolean or number, got "+typeof f}})}}}class VCe extends Xl{constructor(){super(...arguments),this.haze=!1}}u([Q()],VCe.prototype,"haze",void 0);class ya{constructor(t,i,r,s,n,o=!1,a=0){this.name=t,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}}new ya(P.POSITION,3,St.FLOAT,0,12);new ya(P.POSITION,3,St.FLOAT,0,20),new ya(P.UV0,2,St.FLOAT,12,20);new ya(P.POSITION,3,St.FLOAT,0,32),new ya(P.NORMAL,3,St.FLOAT,12,32),new ya(P.UV0,2,St.FLOAT,24,32);new ya(P.POSITION,3,St.FLOAT,0,16),new ya(P.COLOR,4,St.UNSIGNED_BYTE,12,16);const Qte=[new ya(P.POSITION,2,St.FLOAT,0,8)],$L=[new ya(P.POSITION,2,St.FLOAT,0,16),new ya(P.UV0,2,St.FLOAT,8,16)];var Ii;function Wst(e,t,i={}){const r=BCe(e);for(;r.length>1;){const s=xz(t,r.shift(),i);if(_(s))return s}return Zst(t,r.shift(),i)}function BCe(e){const t=ye("esri-force-webgl");if(t===Ii.WEBGL1||t===Ii.WEBGL2)return[t];switch(e){case"2d":return ye("mac")&&ye("chrome")?[Ii.WEBGL1,Ii.WEBGL2]:[Ii.WEBGL2,Ii.WEBGL1];case"3d":return[Ii.WEBGL2,Ii.WEBGL1]}}function Zst(e,t,i={}){if(!window.WebGLRenderingContext)return Kue(e,Xst),null;const r=xz(e,t,i);return M(r)&&Kue(e,Yst),r}function xz(e,t,i={}){const r=t===Ii.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let s=null;for(const n of r){try{s=e.getContext(n,i)}catch{}if(s)break}return s}function Kue(e,t){const i=e.parentNode;i&&(i.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}(function(e){e[e.WEBGL1=1]="WEBGL1",e[e.WEBGL2=2]="WEBGL2"})(Ii||(Ii={}));const Xst='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',Yst=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`,Qu=ve.getLogger("esri.views.webgl.BufferObject");function Jst(e){return q4e(e)}class Ci{constructor(t,i,r,s){this._context=t,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(co.BufferObject,this),this._glName=this._context.gl.createBuffer(),ib(this._context.gl),s&&this.setData(s)}static createIndex(t,i,r){return new Ci(t,Lt.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(t,i,r){return new Ci(t,Lt.ARRAY_BUFFER,i,r)}static createUniform(t,i,r){if(t.type!==Ii.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new Ci(t,Lt.UNIFORM_BUFFER,i,r)}static createPixelPack(t,i=Wi.STREAM_READ,r){if(t.type!==Ii.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new Ci(t,Lt.PIXEL_PACK_BUFFER,i);return r&&s.setSize(r),s}static createPixelUnpack(t,i=Wi.STREAM_DRAW,r){if(t.type!==Ii.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new Ci(t,Lt.PIXEL_UNPACK_BUFFER,i,r)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===Lt.ELEMENT_ARRAY_BUFFER?this._indexType===St.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===Lt.ELEMENT_ARRAY_BUFFER||this.bufferType===Lt.ARRAY_BUFFER}dispose(){var t;((t=this._context)==null?void 0:t.gl)?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(co.BufferObject,this),this._context=null):this._glName&&Qu.warn("Leaked WebGL buffer object")}setSize(t,i=null){if(t<=0&&Qu.error("Buffer size needs to be positive!"),this.bufferType===Lt.ELEMENT_ARRAY_BUFFER&&_(i))switch(this._indexType=i,i){case St.UNSIGNED_SHORT:t*=2;break;case St.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let i=t.byteLength;this.bufferType===Lt.ELEMENT_ARRAY_BUFFER&&(Yk(t)&&(i/=2,this._indexType=St.UNSIGNED_SHORT),Jk(t)&&(i/=4,this._indexType=St.UNSIGNED_INT)),this._setBufferData(i,t)}_setBufferData(t,i=null){this._size=t;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;_(i)?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,t,this.usage),ib(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(t,i=0,r=0,s=t.byteLength){if(!t)return;(i<0||i>=this._size)&&Qu.error("offset is out of range!");let n=i,o=r,a=s,l=t.byteLength;this.bufferType===Lt.ELEMENT_ARRAY_BUFFER&&(Yk(t)?(l/=2,n*=2,o*=2,a*=2):Jk(t)&&(l/=4,n*=4,o*=4,a*=4)),s===void 0&&(s=l-1),r>=s&&Qu.error("end must be bigger than start!"),i+r-s>this._size&&Qu.error("An attempt to write beyond the end of the buffer!");const c=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const h=this._context.gl,p=ArrayBuffer.isView(t)?t.buffer:t,f=o===0&&a===t.byteLength?p:p.slice(o,a);h.bufferSubData(this.bufferType,n,f),ib(h),this._isVAOAware&&this._context.bindVAO(c)}setSubDataFromView(t,i,r,s){if(!t)return;(i<0||i>=this._size)&&Qu.error("offset is out of range!"),r>=s&&Qu.error("end must be bigger than start!"),i+r-s>this._size&&Qu.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===Ii.WEBGL2)o.bufferSubData(this.bufferType,i*t.BYTES_PER_ELEMENT,t,r,s-r);else{const a=r===0&&s===t.length?t:t.subarray(r,s);o.bufferSubData(this.bufferType,i*t.BYTES_PER_ELEMENT,a)}ib(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(t,i=0,r,s){if(this._context.type!==Ii.WEBGL2)return void Qu.error("Get buffer subdata is supported in WebGL2 only!");if(r<0||s<0)return void Qu.error("Problem getting subdata: offset and length were less than zero!");const n=Jst(t)?t.BYTES_PER_ELEMENT:1;if(n*((r!=null?r:0)+(s!=null?s:0))>t.byteLength)return void Qu.error("Problem getting subdata: offset and length exceeded destination size!");i+n*(s!=null?s:0)>this.byteSize&&Qu.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,Lt.COPY_READ_BUFFER),o.getBufferSubData(Lt.COPY_READ_BUFFER,i,t,r,s),this._context.unbindBuffer(Lt.COPY_READ_BUFFER)}async getSubDataAsync(t,i=0,r,s){this._context.type===Ii.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(t,i,r,s)):Qu.error("Get buffer subdata is supported in WebGL2 only!")}}function Lo(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}const ehe=4;class _t{constructor(t,i,r=null){if(this._context=t,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,t.instanceCounter.increment(co.Texture,this),this._descriptor=F({target:At.TEXTURE_2D,samplingMode:gt.LINEAR,wrapMode:$t.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1},i),t.type!==Ii.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),pw(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===At.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(co.Texture,this))}release(){this.dispose()}resize(t,i){const r=this._descriptor;if(r.width!==t||r.height!==i){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");r.width=t,r.height=i,this._descriptor.target===At.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(t=null){for(let i=At.TEXTURE_CUBE_MAP_POSITIVE_X;i<=At.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(t,i)}setData(t){this._setData(t)}_setData(t,i){var c;if(!this._context||!this._context.gl)return;const r=this._context.gl;this._glName||(this._glName=r.createTexture()),t===void 0&&(t=null);const s=this._descriptor;i!=null||(i=s.target);const n=pw(i);t===null&&(s.width=s.width||ehe,s.height=s.height||ehe,n&&(s.depth=(c=s.depth)!=null?c:1));const o=this._context.bindTexture(this,_t.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(_t.TEXTURE_UNIT_FOR_UPDATES),_t._validateTexture(this._context,s),this._configurePixelStorage();const a=s.pixelFormat;let l=s.internalFormat?s.internalFormat:this._deriveInternalFormat(a,s.dataType);if(sj(t)){let h=t.width,p=t.height;const f=1;t instanceof HTMLVideoElement&&(h=t.videoWidth,p=t.videoHeight),s.width&&s.height,n&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,l,s.hasMipmap,h,p,f),this._texImage(i,0,l,h,p,f,t),ib(r),s.hasMipmap&&this.generateMipmap(),s.width===void 0&&(s.width=h),s.height===void 0&&(s.height=p),n&&s.depth===void 0&&(s.depth=f)}else{const{width:h,height:p,depth:f}=s;if(h!=null&&p!=null||console.error("Width and height must be specified!"),n&&f==null&&console.error("Depth must be specified!"),s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,l,s.hasMipmap,h,p,f),r.DEPTH24_STENCIL8&&l===r.DEPTH_STENCIL&&(l=r.DEPTH24_STENCIL8),ek(t)){const m=t.levels,g=the(i,h,p,f),y=Math.min(g-1,m.length-1);Lo(r)?r.texParameteri(s.target,r.TEXTURE_MAX_LEVEL,y):s.hasMipmap=s.hasMipmap&&g===m.length;const x=l;if(!Kst(x))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((b,S,T,C)=>{const A=m[Math.min(b,m.length-1)];this._compressedTexImage(i,b,x,S,T,C,A)},y)}else _(t)?(this._texImage(i,0,l,h,p,f,t),ib(r),s.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((m,g,y,x)=>{this._texImage(i,m,l,g,y,x,null),ib(r)})}_t._applySamplingMode(r,this._descriptor),_t._applyWrapMode(r,this._descriptor),_t._applyAnisotropicFilteringParameters(this._context,this._descriptor),ib(r),this._context.bindTexture(o,_t.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,i,r,s,n,o){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const a=this._context.gl,l=this._descriptor,{pixelFormat:c,internalFormat:h,dataType:p,isImmutable:f,target:m}=l;if(f&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const g=this._context.bindTexture(this,_t.TEXTURE_UNIT_FOR_UPDATES);(i<0||r<0||s>l.width||n>l.height||i+s>l.width||r+n>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),sj(o)?a.texSubImage2D(m,t,i,r,c,p,o):ek(o)?a.compressedTexSubImage2D(m,t,i,r,s,n,h,o.levels[t]):a.texSubImage2D(m,t,i,r,s,n,c,p,o),this._context.bindTexture(g,_t.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(t,i,r,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._context.gl;if(!Lo(c))throw new Error("3D textures are not supported in WebGL1");const h=this._descriptor,{pixelFormat:p,dataType:f,isImmutable:m,target:g,internalFormat:y}=h;if(m&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");pw(g)||console.warn("Attempting to set 3D texture data on a non-3D texture");const x=this._context.bindTexture(this,_t.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(_t.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||n>h.width||o>h.height||a>h.depth||i+n>h.width||r+o>h.height||s+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),ek(l))l=l.levels[t],c.compressedTexSubImage3D(g,t,i,r,s,n,o,a,y,l);else{const b=l;c.texSubImage3D(g,t,i,r,s,n,o,a,p,f,b)}this._context.bindTexture(x,_t.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");t.hasMipmap=!0,this._samplingModeDirty=!0,_t._validateTexture(this._context,t)}t.samplingMode===gt.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=gt.LINEAR_MIPMAP_NEAREST):t.samplingMode===gt.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=gt.NEAREST_MIPMAP_NEAREST);const i=this._context.bindTexture(this,_t.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(_t.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(t.target),this._context.bindTexture(i,_t.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(t){t!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=t,this._samplingModeDirty=!0)}setWrapMode(t){t!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=t,_t._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const t=this._context.gl,i=this._descriptor;this._samplingModeDirty&&(_t._applySamplingMode(t,i),this._samplingModeDirty=!1),this._wrapModeDirty&&(_t._applyWrapMode(t,i),this._wrapModeDirty=!1)}_deriveInternalFormat(t,i){if(this._context.type===Ii.WEBGL1)return t;switch(i){case kt.FLOAT:switch(t){case Qe.RGBA:return Mt.RGBA32F;case Qe.RGB:return Mt.RGB32F;default:throw new Error("Unable to derive format")}case kt.UNSIGNED_BYTE:switch(t){case Qe.RGBA:return Mt.RGBA8;case Qe.RGB:return Mt.RGB8}default:return t}}_configurePixelStorage(){const t=this._context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;t.pixelStorei(t.UNPACK_ALIGNMENT,i),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r?1:0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(t,i,r,s,n,o){const a=this._context.gl;if(!Lo(a))throw new Error("Immutable textures are not supported in WebGL1");if(!Qst(i))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?the(t,s,n,o):1;pw(t)?a.texStorage3D(t,l,i,s,n,o):a.texStorage2D(t,l,i,s,n),this._wasImmutablyAllocated=!0}_texImage(t,i,r,s,n,o,a){const l=this._context.gl;let c=null;const h=this._context.type===Ii.WEBGL2,p=pw(t),{isImmutable:f,pixelFormat:m,dataType:g}=this._descriptor;if(h&&(c=l),h||!sj(a))if(f){if(_(a)){const y=a;p?c.texSubImage3D(t,i,0,0,0,s,n,o,m,g,y):l.texSubImage2D(t,i,0,0,s,n,m,g,y)}}else{const y=a;p?c.texImage3D(t,i,r,s,n,o,0,m,g,y):l.texImage2D(t,i,r,s,n,0,m,g,y)}else l.texImage2D(t,0,r,m,g,a)}_compressedTexImage(t,i,r,s,n,o,a){const l=this._context.gl;let c=null;const h=pw(t),p=this._descriptor.isImmutable;if(h){if(this._context.type!==Ii.WEBGL2)throw new Error("3D textures are not supported in WebGL1");c=l}p?_(a)&&(h?c.compressedTexSubImage3D(t,i,0,0,0,s,n,o,r,a):l.compressedTexSubImage2D(t,i,0,0,s,n,r,a)):h?c.compressedTexImage3D(t,i,r,s,n,o,0,a):l.compressedTexImage2D(t,i,r,s,n,0,a)}_forEachMipmapLevel(t,i=1/0){let{width:r,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===At.TEXTURE_3D;for(let c=0;t(c,r,s,n),o&&(r!==1||s!==1||l&&n!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}static _validateTexture(t,i){(i.width<0||i.height<0||i.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=Lo(t.gl),s=kA(i.width)&&kA(i.height);r||!i.isImmutable&&!pw(i.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),r||s||(typeof i.wrapMode=="number"?i.wrapMode!==$t.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):i.wrapMode.s===$t.CLAMP_TO_EDGE&&i.wrapMode.t===$t.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),i.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(t,i){let r=i.samplingMode,s=i.samplingMode;r===gt.LINEAR_MIPMAP_NEAREST||r===gt.LINEAR_MIPMAP_LINEAR?(r=gt.LINEAR,i.hasMipmap||(s=gt.LINEAR)):r!==gt.NEAREST_MIPMAP_NEAREST&&r!==gt.NEAREST_MIPMAP_LINEAR||(r=gt.NEAREST,i.hasMipmap||(s=gt.NEAREST)),t.texParameteri(i.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(i.target,t.TEXTURE_MIN_FILTER,s)}static _applyWrapMode(t,i){typeof i.wrapMode=="number"?(t.texParameteri(i.target,t.TEXTURE_WRAP_S,i.wrapMode),t.texParameteri(i.target,t.TEXTURE_WRAP_T,i.wrapMode)):(t.texParameteri(i.target,t.TEXTURE_WRAP_S,i.wrapMode.s),t.texParameteri(i.target,t.TEXTURE_WRAP_T,i.wrapMode.t))}static _applyAnisotropicFilteringParameters(t,i){var s;const r=t.capabilities.textureFilterAnisotropic;!r||t.gl.texParameterf(i.target,r.TEXTURE_MAX_ANISOTROPY,(s=i.maxAnisotropy)!=null?s:1)}}function Qst(e){return e in Mt}function Kst(e){return e in ks}function ek(e){return _(e)&&"type"in e&&e.type==="compressed"}function ent(e){return _(e)&&"byteLength"in e}function sj(e){return _(e)&&!ek(e)&&!ent(e)}function pw(e){return e===At.TEXTURE_3D||e===At.TEXTURE_2D_ARRAY}function the(e,t,i,r=1){let s=Math.max(t,i);return e===At.TEXTURE_3D&&(s=Math.max(s,r)),Math.round(Math.log(s)/Math.LN2)+1}_t.TEXTURE_UNIT_FOR_UPDATES=0;function ihe(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"A numeric argument is out of range";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function ka(e,t){return e.vertexBuffers[t].size/tnt(e.layout[t])}function tnt(e){return e[0].stride}function Kte(e,t,i,r,s=0){const n=e.gl,o=e.capabilities.instancing;e.bindBuffer(i);for(const a of r){const l=t.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function eie(e,t,i,r){const s=e.gl,n=e.capabilities.instancing;e.bindBuffer(i);for(const o of r){const a=t.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}e.unbindBuffer(Lt.ARRAY_BUFFER)}function GCe(e){switch(e){case Qe.ALPHA:case Qe.LUMINANCE:case Qe.RED:case Qe.RED_INTEGER:case Mt.R8:case Mt.R8I:case Mt.R8UI:case Mt.R8_SNORM:case Ul.STENCIL_INDEX8:return 1;case Qe.LUMINANCE_ALPHA:case Qe.RG:case Qe.RG_INTEGER:case Mt.RGBA4:case Mt.R16F:case Mt.R16I:case Mt.R16UI:case Mt.RG8:case Mt.RG8I:case Mt.RG8UI:case Mt.RG8_SNORM:case Mt.RGB565:case Mt.RGB5_A1:case Ul.DEPTH_COMPONENT16:return 2;case Qe.DEPTH_COMPONENT:case Qe.RGB:case Qe.RGB_INTEGER:case Mt.RGB8:case Mt.RGB8I:case Mt.RGB8UI:case Mt.RGB8_SNORM:case Mt.SRGB8:case Ul.DEPTH_COMPONENT24:return 3;case Qe.DEPTH_STENCIL:case Qe.RGBA:case Qe.RGBA_INTEGER:case Mt.RGBA8:case Mt.R32F:case Mt.R11F_G11F_B10F:case Mt.RG16F:case Mt.R32I:case Mt.R32UI:case Mt.RG16I:case Mt.RG16UI:case Mt.RGBA8I:case Mt.RGBA8UI:case Mt.RGBA8_SNORM:case Mt.SRGB8_ALPHA8:case Mt.RGB9_E5:case Mt.RGB10_A2UI:case Mt.RGB10_A2:case Ul.DEPTH_STENCIL:case Ul.DEPTH_COMPONENT32F:case Ul.DEPTH24_STENCIL8:return 4;case Ul.DEPTH32F_STENCIL8:return 5;case Mt.RGB16F:case Mt.RGB16I:case Mt.RGB16UI:return 6;case Mt.RG32F:case Mt.RG32I:case Mt.RG32UI:case Mt.RGBA16F:case Mt.RGBA16I:case Mt.RGBA16UI:return 8;case Mt.RGB32F:case Mt.RGB32I:case Mt.RGB32UI:return 12;case Mt.RGBA32F:case Mt.RGBA32I:case Mt.RGBA32UI:return 16;case ks.COMPRESSED_RGB_S3TC_DXT1_EXT:case ks.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case ks.COMPRESSED_RGBA_S3TC_DXT3_EXT:case ks.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case ks.COMPRESSED_R11_EAC:case ks.COMPRESSED_SIGNED_R11_EAC:case ks.COMPRESSED_RGB8_ETC2:case ks.COMPRESSED_SRGB8_ETC2:case ks.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case ks.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case ks.COMPRESSED_RG11_EAC:case ks.COMPRESSED_SIGNED_RG11_EAC:case ks.COMPRESSED_RGBA8_ETC2_EAC:case ks.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function SS(e){if(M(e))return 0;if("descriptor"in e)return e.glName?SS(e.descriptor):0;const t=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!t)return 0;const i="hasMipmap"in e&&e.hasMipmap?1.3:1,r=e.width*e.height;return GCe(t)*r*i}const fw=ve.getLogger("esri.views.webgl.VertexArrayObject");class Ln{constructor(t,i,r,s,n=null){this._context=t,this._locations=i,this._layout=r,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,t.instanceCounter.increment(co.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((t,i)=>t+this._buffers[i].size,_(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(t=!0){var i,r;if(!this._context)return void((this._glName||t&&Object.getOwnPropertyNames(this._buffers).length>0)&&fw.warn("Leaked WebGL VAO"));if(this._glName){const s=(r=(i=this._context)==null?void 0:i.capabilities)==null?void 0:r.vao;s?(s.deleteVertexArray(this._glName),this._glName=null):fw.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),t){for(const s in this._buffers)this._buffers[s].dispose(),delete this._buffers[s];this._indexBuffer=ht(this._indexBuffer)}this._context.instanceCounter.decrement(co.VertexArrayObject,this),this._context=null}initialize(){if(this._initialized)return;const t=this._context.capabilities.vao;if(t){const i=t.createVertexArray();t.bindVertexArray(i),this._bindLayout(),t.bindVertexArray(null),this._glName=i}this._initialized=!0}bind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:t,_layout:i,_indexBuffer:r}=this;t||fw.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in t){const o=t[n];o||fw.error("Vertex buffer is uninitialized!");const a=i[n];a||fw.error("Vertex element descriptor is empty!"),Kte(this._context,this._locations,o,a)}_(r)&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName):this._context.bindBuffer(r))}unbind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:t,_layout:i}=this;t||fw.error("Vertex buffer dictionary is empty!");for(const r in t){const s=t[r];s||fw.error("Vertex buffer is uninitialized!");const n=i[r];eie(this._context,this._locations,s,n)}_(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}function Yl(e,t=Qte,i=lr,r=-1,s=1){let n=null;return t===$L?n=new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]):n=new Float32Array([r,r,s,r,r,s,s,s]),new Ln(e,i,{geometry:t},{geometry:Ci.createVertex(e,Wi.STATIC_DRAW,n)})}function int(e,t=Qte,i=lr){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new Ln(e,i,{geometry:t},{geometry:Ci.createVertex(e,Wi.STATIC_DRAW,r)})}const jCe=4;function HCe(e,t=jCe){return new _t(e,{target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:gt.NEAREST,width:t,height:t})}function rnt(e,t,i=jCe){const r=new Uint8Array(i*i*4);for(let s=0;s<r.length;s+=4)r[s+0]=255*t[0],r[s+1]=255*t[1],r[s+2]=255*t[2],r[s+3]=255*t[3];return new _t(e,{target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:gt.NEAREST,width:i,height:i},r)}function qCe(e){return new _t(e,{target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:gt.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}class rhe{constructor(t){this._view=t,this.type="realistic",this.canRender=!0,this._cameraPosition=$(),this._heightParameters=si(),this._betasRayleigh=$(),this._betasCombined=$(),this._scaleHeight=0,this._radii=Ke(),this._cameraHeight=0,this._cameraHeightSq=0,this._cAtmosphere=0,this._innerFadeDistance=0,this._altitudeFade=0,this._lowerElevationBoundRadius=0,this._lowerBoundEarthRadius=Qi.radius,this._hazeStrength=1,this._darkenHaze=!1,this._updateRadius(Qi.radius)}destroy(){this._atmosphereTechnique=br(this._atmosphereTechnique),this._atmosphereHazeTechnique=br(this._atmosphereHazeTechnique),this._vao=ht(this._vao),this._handles=We(this._handles)}when(){return Promise.resolve()}initializeRenderContext(t){const i=t.renderContext.rctx,r=this._handles=new Nt,s=this._view.basemapTerrain;_(s.rootTiles)&&this._updateElevation({spatialReference:s.spatialReference,tile:s.rootTiles[0],extent:s.rootTiles[0].extent,context:"ground"}),r.add(os(()=>this._view.basemapTerrain,"elevation-change",o=>this._updateElevation(o),{onListenerAdd:()=>this._updateElevation()})),r.add(os(()=>this._view.basemapTerrain,"elevation-bounds-change",()=>this._updateVisibleElevationBounds()));const n=new VCe;n.haze=!1,this._atmosphereTechnique=t.shaderTechniqueRepository.acquire(a$,n),n.haze=!0,this._atmosphereHazeTechnique=t.shaderTechniqueRepository.acquire(a$,n),this._vao=Yl(i,$L),this._scaleHeight=mst*K5,he(this._betasRayleigh,$2[0],$2[1],$2[2]),he(this._betasCombined,$2[0]+ij[0],$2[1]+ij[1],$2[2]+ij[2])}render(t){this._render(t,this._atmosphereTechnique,t.offscreenRenderingHelper.depthTexture)}renderHaze(t,i){this._darkenHaze=i,this._render(t,this._atmosphereHazeTechnique,t.offscreenRenderingHelper.linearDepthTexture)}_render(t,i,r){this._update(t.bindParameters.camera);const s=t.rctx.bindTechnique(i,snt,t.bindParameters);t.offscreenRenderingHelper.renderDepthDetached(()=>{s.bindTexture("depthTex",r),this._renderCommon(i.program,t)})}_renderCommon(t,i){if(M(this._vao))return;const r=i.rctx;t.setUniform4fv("heightParameters",this._heightParameters),t.setUniform3fv("cameraPosition",this._cameraPosition),t.setUniform2fv("radii",this._radii),t.setUniform1f("scaleHeight",this._scaleHeight),t.setUniform1f("betaMie",fst),t.setUniform3fv("betaRayleigh",this._betasRayleigh),t.setUniform3fv("betaCombined",this._betasCombined),t.setUniform1f("innerFadeDistance",this._innerFadeDistance),t.setUniform1f("altitudeFade",this._altitudeFade),t.setUniform1f("hazeStrength",this._hazeStrength),r.bindVAO(this._vao),t.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Wt.TRIANGLE_STRIP,0,4)}_adjustRadiusForTesselation(t){return t*Math.cos(Math.PI/16/16)}_updateElevation(t){const i=t?t.tile:Ye(this._view.basemapTerrain.rootTiles,[null])[0];if(M(i)||i.level!==0)return;const r=this._adjustRadiusForTesselation(Qi.radius+i.elevationBounds[0]);r!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=r,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const t=this._adjustRadiusForTesselation(Qi.radius+this._view.basemapTerrain.elevationBounds.min);(this._lowerBoundEarthRadius<0||t<this._lowerBoundEarthRadius)&&this._updateRadius(t)}_updateRadius(t){this._lowerBoundEarthRadius=t,Li(this._radii,t,t+K5),this._innerFadeDistance=2*Math.sqrt((2*t-CY)*CY)}_update(t){if(M(t))return;this._cameraHeight=Ue(t.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*this._radii[1];const i=Math.min(1,Math.max(0,(this._cameraHeight-this._radii[0])/K5));this._heightParameters=zi(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,i),pe(this._cameraPosition,t.eye),this._altitudeFade=OCe(this._cameraHeight-this._lowerBoundEarthRadius),this._hazeStrength=this._darkenHaze?ui(.6,1,UA(9500,10500,this._cameraHeight-Qi.radius)):1}static isSupported(t){return t.renderContext.rctx.capabilities.depthTexture}}const snt=new Nn;function nnt(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function WCe(e,t,i){i*=.5;const r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function ZCe(e,t){const i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>Ut?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i}function tie(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*h+o*a+s*c-n*l,e[1]=s*h+o*l+n*a-r*c,e[2]=n*h+o*c+r*l-s*a,e[3]=o*h-r*a-s*l-n*c,e}function ont(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+o*a,e[1]=s*l+n*a,e[2]=n*l-s*a,e[3]=o*l-r*a,e}function ant(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l-n*a,e[1]=s*l+o*a,e[2]=n*l+r*a,e[3]=o*l-s*a,e}function lnt(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+s*a,e[1]=s*l-r*a,e[2]=n*l+o*a,e[3]=o*l-n*a,e}function cnt(e,t){const i=t[0],r=t[1],s=t[2];return e[0]=i,e[1]=r,e[2]=s,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),e}function tk(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];let l,c,h,p,f,m=i[0],g=i[1],y=i[2],x=i[3];return c=s*m+n*g+o*y+a*x,c<0&&(c=-c,m=-m,g=-g,y=-y,x=-x),1-c>Ut?(l=Math.acos(c),h=Math.sin(l),p=Math.sin((1-r)*l)/h,f=Math.sin(r*l)/h):(p=1-r,f=r),e[0]=p*s+f*m,e[1]=p*n+f*g,e[2]=p*o+f*y,e[3]=p*a+f*x,e}function unt(e){const t=$f(),i=$f(),r=$f(),s=Math.sqrt(1-t),n=Math.sqrt(t);return e[0]=s*Math.sin(2*Math.PI*i),e[1]=s*Math.cos(2*Math.PI*i),e[2]=n*Math.sin(2*Math.PI*r),e[3]=n*Math.cos(2*Math.PI*r),e}function hnt(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return e[0]=-i*a,e[1]=-r*a,e[2]=-s*a,e[3]=n*a,e}function Sv(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function XCe(e,t){const i=t[0]+t[4]+t[8];let r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;r=Math.sqrt(t[3*s+s]-t[3*n+n]-t[3*o+o]+1),e[s]=.5*r,r=.5/r,e[3]=(t[3*n+o]-t[3*o+n])*r,e[n]=(t[3*n+s]+t[3*s+n])*r,e[o]=(t[3*o+s]+t[3*s+o])*r}return e}function dnt(e,t,i,r){const s=.5*Math.PI/180;t*=s,i*=s,r*=s;const n=Math.sin(t),o=Math.cos(t),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),h=Math.cos(r);return e[0]=n*l*h-o*a*c,e[1]=o*a*h+n*l*c,e[2]=o*l*c-n*a*h,e[3]=o*l*h+n*a*c,e}function pnt(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const LL=Lf,fnt=_r,mnt=SQ,gnt=tie,ynt=rL,vnt=F0e,_nt=RV,YCe=EQ,bnt=YCe,JCe=CQ,wnt=JCe,iie=N0e,xnt=S3,Tnt=k0e;function Snt(e,t,i){const r=Pe(t,i);return r<-.999999?(Tt(bm,Ent,t),TQ(bm)<1e-6&&Tt(bm,Cnt,t),Re(bm,bm),WCe(e,bm,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Tt(bm,t,i),e[0]=bm[0],e[1]=bm[1],e[2]=bm[2],e[3]=1+r,iie(e,e))}const bm=$(),Ent=Ze(1,0,0),Cnt=Ze(0,1,0);function Ant(e,t,i,r,s,n){return tk(she,t,s,n),tk(nhe,i,r,n),tk(e,she,nhe,2*n*(1-n)),e}const she=Lv(),nhe=Lv();function Mnt(e,t,i,r){const s=Ont;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-t[0],s[5]=-t[1],s[8]=-t[2],iie(e,XCe(e,s))}const Ont=ls();Object.freeze(Object.defineProperty({__proto__:null,identity:nnt,setAxisAngle:WCe,getAxisAngle:ZCe,multiply:tie,rotateX:ont,rotateY:ant,rotateZ:lnt,calculateW:cnt,slerp:tk,random:unt,invert:hnt,conjugate:Sv,fromMat3:XCe,fromEuler:dnt,str:pnt,copy:LL,set:fnt,add:mnt,mul:gnt,scale:ynt,dot:vnt,lerp:_nt,length:YCe,len:bnt,squaredLength:JCe,sqrLen:wnt,normalize:iie,exactEquals:xnt,equals:Tnt,rotationTo:Snt,sqlerp:Ant,setAxes:Mnt},Symbol.toStringTag,{value:"Module"}));function wO(e=Pnt){return[e[0],e[1],e[2],e[3]]}function l$(e,t){return Rnt(e[0],e[1],e[2],t,KK.get())}function Rnt(e,t,i,r,s=wO()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function c$(e,t,i=wO()){return Tt(i,e,t),Re(i,i),i[3]=iee(e,t),i}const Pnt=[0,0,1,0];class Int{constructor(){this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=$(),this.parallax={anchorPointClouds:$(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Ne()},this.parallaxNew={anchorPointClouds:$(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Ne()},this.crossFade={enabled:!1,factor:0,distanceThresholdFactor:.3},this.fadeInOut={stage:aa.FINISHED,factor:0,distanceThresholdFactor:.6},this.fadeIn={stage:Zd.FINISHED,factor:0,distanceThresholdFactor:2},this.fadeInOutHeight={stage:mb.FINISHED,factor:-1}}}var Zd,aa,mb;(function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"})(Zd||(Zd={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.SWITCH=2]="SWITCH",e[e.FADE_IN=3]="FADE_IN"}(aa||(aa={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(mb||(mb={}));function Xi(){return new Float32Array(3)}function Tz(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ki(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function QCe(e,t){return new Float32Array(e,t,3)}function rie(){return Xi()}function KCe(){return Ki(1,1,1)}function eAe(){return Ki(1,0,0)}function tAe(){return Ki(0,1,0)}function iAe(){return Ki(0,0,1)}const $nt=rie(),Lnt=KCe(),Dnt=eAe(),Nnt=tAe(),Fnt=iAe();Object.freeze(Object.defineProperty({__proto__:null,create:Xi,clone:Tz,fromValues:Ki,createView:QCe,zeros:rie,ones:KCe,unitX:eAe,unitY:tAe,unitZ:iAe,ZEROS:$nt,ONES:Lnt,UNIT_X:Dnt,UNIT_Y:Nnt,UNIT_Z:Fnt},Symbol.toStringTag,{value:"Module"}));function rAe(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(E`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function sie(e,t){switch(e.include(ev,t),e.fragment.code.add(E`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),t.textureCoordinateType){case Hn.Default:return void e.fragment.code.add(E`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case Hn.Atlas:return e.include(rAe),void e.fragment.code.add(E`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:t.textureCoordinateType;case Hn.None:case Hn.COUNT:return}}class ql extends $s{constructor(t,i){super(t,"vec3",ar.Draw,(r,s,n)=>r.setUniform3fv(t,i(s,n)))}}class nie extends $s{constructor(t,i){super(t,"vec2",ar.Draw,(r,s,n)=>r.setUniform2fv(t,i(s,n)))}}class oie extends $s{constructor(t,i){super(t,"sampler2D",ar.Draw,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function JI(e,t,i){const r=[new oie(e,t)];if(i){const s=e+"Size";r.push(new nie(s,(n,o)=>{const a=t(n,o);return _(a)?Li(knt,a.descriptor.width,a.descriptor.height):Sp}))}return r}const knt=Ke();class oi extends $s{constructor(t,i){super(t,"sampler2D",ar.Pass,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function ik(e,t,i){const r=[new oi(e,t)];if(i){const s=e+"Size";r.push(new Di(s,(n,o)=>{const a=t(n,o);return _(a)?Li(Unt,a.descriptor.width,a.descriptor.height):Sp}))}return r}const Unt=Ke();class Qb{constructor(t){this._material=t.material,this._techniqueRepository=t.techniqueRep,this._output=t.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}ensureTechnique(t,i,r=this._output){return this._technique=this._techniqueRepository.releaseAndAcquire(t,this._material.getConfiguration(r,i),this._technique),this._technique}ensureResources(t){return Tu.LOADED}}class aie extends Qb{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textureRepository=t.textureRep,this._textureId=t.textureId,this._acquire(t.textureId,i=>this._texture=i),this._acquire(t.normalTextureId,i=>this._textureNormal=i),this._acquire(t.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(t.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(t.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=br(this._texture),this._textureNormal=br(this._textureNormal),this._textureEmissive=br(this._textureEmissive),this._textureOcclusion=br(this._textureOcclusion),this._textureMetallicRoughness=br(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return this._numLoading===0?Tu.LOADED:Tu.LOADING}get textureBindParameters(){return new sAe(_(this._texture)?this._texture.glTexture:null,_(this._textureNormal)?this._textureNormal.glTexture:null,_(this._textureEmissive)?this._textureEmissive.glTexture:null,_(this._textureOcclusion)?this._textureOcclusion.glTexture:null,_(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(t){(M(this._texture)||t!==this._texture.id)&&(this._texture=br(this._texture),this._textureId=t,this._acquire(this._textureId,i=>this._texture=i))}_acquire(t,i){if(M(t))return void i(null);const r=this._textureRepository.acquire(t);if(qu(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return br(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}}class sAe extends Nn{constructor(t=null,i=null,r=null,s=null,n=null){super(),this.texture=t,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=s,this.textureMetallicRoughness=n}}const v5t=Ki(0,.6,.2);var Gt;(function(e){e[e.Disabled=0]="Disabled",e[e.Normal=1]="Normal",e[e.Schematic=2]="Schematic",e[e.Water=3]="Water",e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",e[e.COUNT=5]="COUNT"})(Gt||(Gt={}));function lie(e,t){const i=e.fragment,r=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===Gt.Normal&&r&&e.include(sie,t),t.pbrMode!==Gt.Schematic)if(t.pbrMode!==Gt.Disabled){if(t.pbrMode===Gt.Normal){i.code.add(E`vec3 mrr;
vec3 emission;
float occlusion;`);const s=t.supportsTextureAtlas,n=t.pbrTextureBindType;t.hasMetalnessAndRoughnessTexture&&(i.uniforms.add(n===ar.Pass?ik("texMetallicRoughness",o=>o.textureMetallicRoughness,s):JI("texMetallicRoughness",o=>o.textureMetallicRoughness,s)),i.code.add(E`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(i.uniforms.add(n===ar.Pass?ik("texEmission",o=>o.textureEmissive,s):JI("texEmission",o=>o.textureEmissive,s)),i.code.add(E`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(i.uniforms.add(n===ar.Pass?ik("texOcclusion",o=>o.textureOcclusion,s):JI("texOcclusion",o=>o.textureOcclusion,s)),i.code.add(E`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(E`float getBakedOcclusion() { return 1.0; }`),i.uniforms.add(n===ar.Pass?[new Dt("emissionFactor",o=>o.emissiveFactor),new Dt("mrrFactors",o=>o.mrrFactors)]:[new ql("emissionFactor",o=>o.emissiveFactor),new ql("mrrFactors",o=>o.mrrFactors)]),i.code.add(E`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${r?"vtc.uv = vuv0;":""}
      ${t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)}}else i.code.add(E`float getBakedOcclusion() { return 1.0; }`);else i.code.add(E`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}class Ei extends $s{constructor(t,i){super(t,"vec4",ar.Pass,(r,s,n)=>r.setUniform4fv(t,i(s,n)))}}function cie(e,t){const i=e.fragment,r=t.lightingSphericalHarmonicsOrder!==void 0?t.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new Dt("lightingAmbientSH0",(s,n)=>he(ohe,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),i.code.add(E`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add([new Ei("lightingAmbientSH_R",(s,n)=>_r(Ry,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new Ei("lightingAmbientSH_G",(s,n)=>_r(Ry,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new Ei("lightingAmbientSH_B",(s,n)=>_r(Ry,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))]),i.code.add(E`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add([new Dt("lightingAmbientSH0",(s,n)=>he(ohe,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new Ei("lightingAmbientSH_R1",(s,n)=>_r(Ry,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new Ei("lightingAmbientSH_G1",(s,n)=>_r(Ry,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new Ei("lightingAmbientSH_B1",(s,n)=>_r(Ry,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new Ei("lightingAmbientSH_R2",(s,n)=>_r(Ry,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new Ei("lightingAmbientSH_G2",(s,n)=>_r(Ry,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new Ei("lightingAmbientSH_B2",(s,n)=>_r(Ry,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))]),i.code.add(E`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==Gt.Normal&&t.pbrMode!==Gt.Schematic||i.code.add(E`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const ohe=$(),Ry=si();class lt extends $s{constructor(t,i){super(t,"float",ar.Pass,(r,s,n)=>r.setUniform1f(t,i(s,n)))}}function uie(e,t){const i=e.fragment;t.isGround?i.uniforms.add(new lt("lightingFixedFactor",(r,s)=>(1-s.lighting.groundLightingFactor)*(1-s.lighting.globalFactor))):i.constants.add("lightingFixedFactor","float",0),i.uniforms.add([new Dt("lightingMainDirection",(r,s)=>s.lighting.lightingMainDirection),new Dt("lightingMainIntensity",(r,s)=>s.lighting.mainLight.intensity)]),i.code.add(E`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)}function u6(e){e.vertex.code.add(E`const float PI = 3.141592653589793;`),e.fragment.code.add(E`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}class ES extends $s{constructor(t,i){super(t,"bool",ar.Pass,(r,s,n)=>r.setUniform1b(t,i(s,n)))}}class znt extends $s{constructor(t,i){super(t,"samplerCube",ar.Pass,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function nAe(e){const t=e.fragment;t.uniforms.add([new Xr("rotationMatrixClouds",(i,r)=>r.clouds.parallax.transform),new Xr("rotationMatrixCloudsCrossFade",(i,r)=>r.clouds.parallaxNew.transform),new Dt("anchorPosition",(i,r)=>r.clouds.parallax.anchorPointClouds),new Dt("anchorPositionCrossFade",(i,r)=>r.clouds.parallaxNew.anchorPointClouds),new Di("cloudVariables",(i,r)=>_(r.clouds.data)?Li(Vnt,r.clouds.data.coverage,r.clouds.data.absorption):Sp),new lt("cloudsHeight",(i,r)=>r.clouds.parallax.cloudsHeight),new lt("radiusCurvatureCorrectionFactor",(i,r)=>r.clouds.parallax.radiusCurvatureCorrectionFactor),new lt("totalFadeInOut",(i,r)=>r.clouds.fadeInOut.stage===aa.FINISHED?r.clouds.fadeInOutHeight.factor+Math.max(He(r.clouds.fadeIn.factor,0,1)):r.clouds.fadeInOutHeight.factor+Math.max(He(r.clouds.fadeInOut.factor,0,1))),new lt("crossFadeAnchorFactor",(i,r)=>He(r.clouds.crossFade.factor,0,1)),new znt("cubeMap",(i,r)=>_(r.clouds.data)?r.clouds.data.cubeMap.colorTexture:null),new ES("crossFade",(i,r)=>r.clouds.crossFade.enabled)]),t.constants.add("planetRadius","float",Qi.radius),t.code.add(E`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(E`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(E`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),t.uniforms.add([new Dt("lightingMainDirection",(i,r)=>r.lighting.lightingMainDirection),new Dt("lightingMainIntensity",(i,r)=>r.lighting.mainLight.intensity)]),t.code.add(E`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(E`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`),t.code.add(E`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(E`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(E`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}const Vnt=Ke();function gy(e){e.code.add(E`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function Bnt(){const e=new mr;e.attributes.add(P.POSITION,"vec2"),e.varyings.add("worldRay","vec3");const{vertex:t,fragment:i}=e;return t.uniforms.add([new Xr("inverseProjectionMatrix",(r,s)=>s.camera.inverseProjectionMatrix),new Xr("inverseViewMatrix",(r,s)=>Ks(Gnt,s.camera.viewMatrix))]),t.code.add(E`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),i.include(gy),i.include(Zu),e.include(cie,{pbrMode:Gt.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(u6),e.include(l6),e.include(uie,{isGround:!1}),e.include(nAe,{instancedDoublePrecision:!1,isGround:!1}),i.uniforms.add([new Dt("cameraPosition",(r,s)=>s.camera.eye)]),i.code.add(E`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),e}const Gnt=Ne(),jnt=Object.freeze(Object.defineProperty({__proto__:null,build:Bnt},Symbol.toStringTag,{value:"Module"}));class h6 extends Lr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=h6.shader.get().build();return new Er(t.rctx,i,lr)}initializePipeline(){return ri({blending:my(ke.ONE,ke.SRC_ALPHA),depthTest:{func:Fr.LEQUAL},colorWrite:xi})}}h6.shader=new Sr(jnt,()=>import("./CloudsComposition.glsl.61be033d.js"));function Hnt(e){return _(e)&&_(e.cubeMap)&&e.coverage>0}function ahe(e){return _(e)&&!e.running}let Ox=class extends Ee{constructor(e){super(e),this._technique=new h6(e),this._vao=Yl(e.rctx)}destroy(){this._technique=br(this._technique),this._vao=ht(this._vao)}render(e,t){const i=e.bindParameters.clouds;if(M(this._vao)||M(i.data))return;if(!this._technique.compiled)return void this.requestRender();this._setParallaxParameters(i,e.bindParameters.camera.eye,t);const r=e.rctx.bindTechnique(this._technique,Jnt,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Wt.TRIANGLE_STRIP,0,4),Ynt(i)&&this.requestRender()}_setFadeInStage(e,t){const i=performance.now(),r=e.parallax.anchorPointClouds;e.fadeIn.stage===Zd.FINISHED&&(e.fadeIn.factor=1,pe(r,wm),e.fadeIn.stage=Zd.CHANGE_ANCHOR,e.crossFade.enabled=!1,e.fadeInOut.stage=aa.FINISHED);const s=uhe(e,t);e.fadeIn.stage===Zd.CHANGE_ANCHOR&&s&&ahe(e.data)&&(pe(r,wm),e.fadeIn.stage=Zd.FADE_IN,e.startTime=i),e.fadeIn.factor>0&&e.fadeIn.stage===Zd.FADE_IN&&(e.fadeIn.factor=1-(i-e.startTime)/che),e.fadeIn.factor<=0&&e.fadeIn.stage===Zd.FADE_IN&&(e.fadeIn.stage=Zd.FINISHED,e.fadeIn.factor=0)}_setCrossFadingStage(e){const t=performance.now(),{crossFade:i}=e,r=e.parallax.anchorPointClouds;e.crossFade.enabled||(pe(e.parallaxNew.anchorPointClouds,wm),e.startTime=t,i.factor=0,e.crossFade.enabled=!0),i.factor<1&&e.crossFade.enabled&&(i.factor=(t-e.startTime)/Znt),i.factor>=1&&e.crossFade.enabled&&(e.crossFade.enabled=!1,i.factor=1,pe(r,e.parallaxNew.anchorPointClouds))}_setFadeInOutStage(e,t){const i=performance.now(),{fadeInOut:r,crossFade:s}=e;r.stage===aa.FINISHED&&(e.startTime=i,r.factor=0,r.stage=aa.FADE_OUT),r.factor<1&&r.stage===aa.FADE_OUT&&(r.factor=(i-e.startTime)/Wnt),r.factor>=1&&r.stage===aa.FADE_OUT&&(r.factor=1,pe(e.parallax.anchorPointClouds,wm)),r.factor>=1&&r.stage===aa.FADE_OUT&&uhe(e,t)&&(r.factor=1,r.stage=aa.SWITCH,e.crossFade.enabled=!1,s.factor=1),ahe(e.data)&&r.stage===aa.SWITCH&&(e.startTime=i,r.factor=1,r.stage=aa.FADE_IN,pe(e.parallax.anchorPointClouds,wm),e.crossFade.enabled=!1,s.factor=1),r.factor>0&&r.stage===aa.FADE_IN&&(r.factor=1-(i-e.startTime)/che),r.factor<=0&&r.stage===aa.FADE_IN&&(r.stage=aa.FINISHED,r.factor=0)}_setFadeInOutHeight(e,t){const i=performance.now(),r=e.fadeInOutHeight,s=(i-(r.stage===mb.FINISHED?i:e.startTimeHeightFade))/Xnt;r.factor+=t?-s:s,e.startTimeHeightFade=i,r.factor=He(r.factor,0,1),r.stage=mb.HEIGHT_FADE}_setParallaxParameters(e,t,i){const{parallax:r}=e;e.fadeInOutHeight.factor<0&&(e.fadeInOutHeight.factor=Ue(t)-this.planetRadius>Qd?1:0),Re(wm,t),fe(wm,wm,this.planetRadius),r.anchorPointClouds[0]===0&&r.anchorPointClouds[1]===0&&r.anchorPointClouds[2]===0&&pe(r.anchorPointClouds,wm);const s=Ue(xe(qnt,r.anchorPointClouds,wm));let n=!0;s>e.fadeIn.distanceThresholdFactor*r.cloudsHeight||e.fadeIn.stage!==Zd.FINISHED?this._setFadeInStage(e,t):s>e.fadeInOut.distanceThresholdFactor*r.cloudsHeight||e.fadeInOut.stage!==aa.FINISHED?this._setFadeInOutStage(e,t):s>e.crossFade.distanceThresholdFactor*r.cloudsHeight&&!i||e.crossFade.enabled?this._setCrossFadingStage(e):n=!1;const o=Ue(t),a=o-this.planetRadius;if((a>1.7*Qd||a<-Qd)&&e.fadeInOutHeight.factor<1?e.fadeInOutHeight.factor=1:(a>Qd||a<-.35*Qd)&&e.fadeInOutHeight.factor<1?this._setFadeInOutHeight(e,!1):a<Qd&&a>-.35*Qd&&e.fadeInOutHeight.factor>0?this._setFadeInOutHeight(e,!0):e.fadeInOutHeight.stage=mb.FINISHED,r.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(o*o-this.planetRadius*this.planetRadius,0))/o,c$(lhe,r.anchorPointClouds,L2),r.transform=Ne(),Iu(r.transform,r.transform,L2[3],L2),n){const{parallaxNew:l}=e;c$(lhe,l.anchorPointClouds,L2),l.transform=Ne(),Iu(l.transform,l.transform,L2[3],L2)}pe(e.cameraPositionLastFrame,t)}};u([d({constructOnly:!0})],Ox.prototype,"rctx",void 0),u([d({constructOnly:!0})],Ox.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],Ox.prototype,"planetRadius",void 0),u([d({constructOnly:!0})],Ox.prototype,"requestRender",void 0),Ox=u([L("esri.views.3d.environment.CloudsComposition")],Ox);const lhe=Ze(0,0,1),L2=wO(),wm=$(),qnt=$(),che=500,Wnt=250,Znt=500,Xnt=500;function Ynt(e){return e.crossFade.enabled||e.fadeInOut.stage!==aa.FINISHED||e.fadeIn.stage!==Zd.FINISHED||e.fadeInOutHeight.stage!==mb.FINISHED}function uhe(e,t){return sS(e.cameraPositionLastFrame,t)}const Jnt=new Nn;function Cp(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function Qnt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function hie(e,t,i,r,s,n,o,a,l,c){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function die(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Ap(e,t){if(e===t){const i=t[1],r=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function l2(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l;let g=i*p+r*f+s*m;return g?(g=1/g,e[0]=p*g,e[1]=(-h*r+s*c)*g,e[2]=(a*r-s*o)*g,e[3]=f*g,e[4]=(h*i-s*l)*g,e[5]=(-a*i+s*n)*g,e[6]=m*g,e[7]=(-c*i+r*l)*g,e[8]=(o*i-r*n)*g,e):null}function Knt(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return e[0]=o*h-a*c,e[1]=s*c-r*h,e[2]=r*a-s*o,e[3]=a*l-n*h,e[4]=i*h-s*l,e[5]=s*n-i*a,e[6]=n*c-o*l,e[7]=r*l-i*c,e[8]=i*o-r*n,e}function eot(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*n-o*l)+i*(-c*s+o*a)+r*(l*s-n*a)}function d6(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=i[0],m=i[1],g=i[2],y=i[3],x=i[4],b=i[5],S=i[6],T=i[7],C=i[8];return e[0]=f*r+m*o+g*c,e[1]=f*s+m*a+g*h,e[2]=f*n+m*l+g*p,e[3]=y*r+x*o+b*c,e[4]=y*s+x*a+b*h,e[5]=y*n+x*l+b*p,e[6]=S*r+T*o+C*c,e[7]=S*s+T*a+C*h,e[8]=S*n+T*l+C*p,e}function Sz(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=i[0],m=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=a,e[5]=l,e[6]=f*r+m*o+c,e[7]=f*s+m*a+h,e[8]=f*n+m*l+p,e}function pie(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=Math.sin(i),m=Math.cos(i);return e[0]=m*r+f*o,e[1]=m*s+f*a,e[2]=m*n+f*l,e[3]=m*o-f*r,e[4]=m*a-f*s,e[5]=m*l-f*n,e[6]=c,e[7]=h,e[8]=p,e}function fie(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=n*t[6],e[7]=n*t[7],e[8]=n*t[8],e}function tot(e,t,i){const r=i[0],s=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e}function iot(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function rot(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function sot(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function not(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function p6(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,p=r*a,f=s*o,m=s*a,g=s*l,y=n*o,x=n*a,b=n*l;return e[0]=1-p-g,e[3]=h-b,e[6]=f+x,e[1]=h+b,e[4]=1-c-g,e[7]=m-y,e[2]=f-x,e[5]=m+y,e[8]=1-c-p,e}function oAe(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l,g=i*p+r*f+s*m;if(!g)return null;const y=1/g;return e[0]=p*y,e[1]=(-h*r+s*c)*y,e[2]=(a*r-s*o)*y,e[3]=f*y,e[4]=(h*i-s*l)*y,e[5]=(-a*i+s*n)*y,e[6]=m*y,e[7]=(-c*i+r*l)*y,e[8]=(o*i-r*n)*y,e}function vM(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],g=t[12],y=t[13],x=t[14],b=t[15],S=i*a-r*o,T=i*l-s*o,C=i*c-n*o,A=r*l-s*a,O=r*c-n*a,D=s*c-n*l,U=h*y-p*g,k=h*x-f*g,B=h*b-m*g,j=p*x-f*y,H=p*b-m*y,K=f*b-m*x;let ee=S*K-T*H+C*j+A*B-O*k+D*U;return ee?(ee=1/ee,e[0]=(a*K-l*H+c*j)*ee,e[1]=(l*B-o*K-c*k)*ee,e[2]=(o*H-a*B+c*U)*ee,e[3]=(s*H-r*K-n*j)*ee,e[4]=(i*K-s*B+n*k)*ee,e[5]=(r*B-i*H-n*U)*ee,e[6]=(y*D-x*O+b*A)*ee,e[7]=(x*C-g*D-b*T)*ee,e[8]=(g*O-y*C+b*S)*ee,e):null}function oot(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function aot(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function lot(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function cot(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e}function aAe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}function uot(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e}function hot(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e}function dot(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function pot(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=t[0],f=t[1],m=t[2],g=t[3],y=t[4],x=t[5],b=t[6],S=t[7],T=t[8];return Math.abs(i-p)<=Ut*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-f)<=Ut*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-m)<=Ut*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-g)<=Ut*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(o-y)<=Ut*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(a-x)<=Ut*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(l-b)<=Ut*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-S)<=Ut*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(h-T)<=Ut*Math.max(1,Math.abs(h),Math.abs(T))}function mie(e){const t=Ut,i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return Math.abs(1-(i*i+n*n+l*l))<=t&&Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}const fot=d6,mot=aAe;Object.freeze(Object.defineProperty({__proto__:null,fromMat4:Cp,copy:Qnt,set:hie,identity:die,transpose:Ap,invert:l2,adjoint:Knt,determinant:eot,multiply:d6,translate:Sz,rotate:pie,scale:fie,scaleByVec2:tot,fromTranslation:iot,fromRotation:rot,fromScaling:sot,fromMat2d:not,fromQuat:p6,normalFromMat4Legacy:oAe,normalFromMat4:vM,projection:oot,str:aot,frob:lot,add:cot,subtract:aAe,multiplyScalar:uot,multiplyScalarAndAdd:hot,exactEquals:dot,equals:pot,isOrthoNormal:mie,mul:fot,sub:mot},Symbol.toStringTag,{value:"Module"}));function gie(){return new Float32Array(2)}function got(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}function zl(e,t){const i=new Float32Array(2);return i[0]=e,i[1]=t,i}function yot(e,t){return new Float32Array(e,t,2)}function lAe(){return gie()}function cAe(){return zl(1,1)}function uAe(){return zl(1,0)}function hAe(){return zl(0,1)}const vot=lAe(),_ot=cAe(),bot=uAe(),wot=hAe();Object.freeze(Object.defineProperty({__proto__:null,create:gie,clone:got,fromValues:zl,createView:yot,zeros:lAe,ones:cAe,unitX:uAe,unitY:hAe,ZEROS:vot,ONES:_ot,UNIT_X:bot,UNIT_Y:wot},Symbol.toStringTag,{value:"Module"}));var Of;(function(e){e[e.SIXTEEN=0]="SIXTEEN",e[e.HUNDRED=1]="HUNDRED",e[e.TWOHUNDRED=2]="TWOHUNDRED",e[e.COUNT=3]="COUNT"})(Of||(Of={}));class dAe extends Xl{constructor(){super(...arguments),this.steps=Of.SIXTEEN}}u([Q({count:Of.COUNT})],dAe.prototype,"steps",void 0);const Kd=ye("esri-mobile")?64:128,xot=Kd/128,vf=Math.ceil(Math.sqrt(Kd)),Cf=(Kd+2)*vf,Tot=1e5,nj=128,Sot=Cf/1560;function Kb(e,t=!0){e.attributes.add(P.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(E`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?E`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}class u$ extends $s{constructor(t,i){super(t,"mat3",ar.Draw,(r,s,n)=>r.setUniformMatrix3fv(t,i(s,n)))}}class pAe extends Nn{constructor(){super(...arguments),this.viewMatrix=ls()}}function Eot(e){const t=new mr;return t.include(Kb,!1),t.fragment.uniforms.add(new nr("cloudRadius")),t.fragment.uniforms.add(new nr("halfCubeMapSize")),t.fragment.uniforms.add(new nr("power")),t.fragment.uniforms.add(new nr("sigmaE")),t.fragment.uniforms.add(new nr("density")),t.fragment.uniforms.add(new nr("cloudSize")),t.fragment.uniforms.add(new nr("detailSize")),t.fragment.uniforms.add(new nr("smoothness")),t.fragment.uniforms.add(new nr("cloudHeight")),t.fragment.uniforms.add(new nr("coverage")),t.fragment.uniforms.add(new u$("view",i=>i.viewMatrix)),t.fragment.uniforms.add(new ws("cloudShapeTexture")),t.fragment.code.add(E`
    const int STEPS = ${e.steps===Of.SIXTEEN?E`16`:e.steps===Of.HUNDRED?E`100`:E`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),t.fragment.code.add(E`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${E.float(Cf)};
      const float dataWidth = ${E.float(Cf)};
      const float tileRows = ${E.float(vf)};
      const vec3 atlasDimensions = vec3(${E.float(Kd)}, ${E.float(Kd)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${E.float(xot)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${E.float(Sot)} * p) / ${E.float(Cf)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),t.fragment.code.add(E`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),t.fragment.code.add(E`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),t.fragment.code.add(`
    vec3 multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      vec3 luminance = vec3(0);

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),t.fragment.code.add(E`vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
vec3 beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),t.fragment.code.add(E`vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return vec3(0);
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
vec3 color = vec3(0.0);
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
vec3 luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
color += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return color;
}`),t.fragment.code.add(E`void main() {
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
if (hitsPlanet) {
gl_FragColor = vec4(vec3(0), 1);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
float totalTransmittance = 1.0;
vec3 sunDirection = normalize(vec3(0, 0, 1));
vec3 col = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;
gl_FragColor = vec4(col, totalTransmittance);
}`),t}const Cot=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:pAe,build:Eot},Symbol.toStringTag,{value:"Module"}));class cR{constructor(t,i,r,s,n,o,a,l,c=.5){this.coverage=t,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingStepType=l,this.median=c}}const fAe={sunny:new cR([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Of.SIXTEEN),cloudy:new cR([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Of.TWOHUNDRED,.6),rainy:new cR([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Of.TWOHUNDRED,.4),snowy:new cR([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Of.HUNDRED,.65),foggy:new cR([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Of.SIXTEEN)};class f6 extends Lr{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=f6.shader.get().build(this.configuration);return new Er(t.rctx,i,lr)}initializePipeline(){return ri({blending:ba(ke.ONE,ke.ONE,ke.ZERO,ke.ZERO),depthTest:{func:Fr.LEQUAL},colorWrite:xi})}}f6.shader=new Sr(Cot,()=>import("./Clouds.glsl.65cdfa6e.js"));var Vh;(function(e){e[e.Full=0]="Full",e[e.WeatherMap=1]="WeatherMap",e[e.COUNT=2]="COUNT"})(Vh||(Vh={}));class MY extends Xl{constructor(){super(...arguments),this.mode=Vh.Full}}u([Q({count:Vh.COUNT})],MY.prototype,"mode",void 0);function Aot(e){const t=new mr;return t.include(Kb,!1),t.fragment.code.add(E`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.fragment.uniforms.add(new tv("weatherTile")),e.mode===Vh.Full&&t.fragment.code.add(E`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${E.float(vf)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${E.float(8)});

      float worley0 = worley(p, ${E.float(2)} * 2.0);
      float worley1 = worley(p, ${E.float(2)} * 8.0);
      float worley2 = worley(p, ${E.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${E.float(2)});
      float worley1 = worley(p, ${E.float(2)} * 2.0);
      float worley2 = worley(p, ${E.float(2)} * 4.0);
      float worley3 = worley(p, ${E.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),t.fragment.code.add(E`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${E.float(nj)});

      // Get global coordinates of p
      p += weatherTile * ${E.float(nj)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${E.float(Tot)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.fragment.code.add(E`void main() {`),e.mode===Vh.Full&&t.fragment.code.add(E`
        float padWidth = 1.0;
        float paddedSize = ${E.float(Kd)} + 2.0 * padWidth;
        float tileCount = ${E.float(vf)} * ${E.float(vf)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${E.float(Kd)};
          }

          if (startPadY) {
            pixel.y += ${E.float(Kd)};
          }

          if (endPadX) {
            pixel.x -= ${E.float(Kd)};
          }

          if (endPadY) {
            pixel.y -= ${E.float(Kd)};
          }

          uv = vec2(pixel.xy / ${E.float(Kd)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${E.float(Kd)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${E.float(vf)} * ${E.float(vf)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${E.float(vf)} * ${E.float(vf)});
        p = p_;
        p.z /= (${E.float(vf)} * ${E.float(vf)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),t.fragment.code.add(E`
      vec2 mapUV = ${E.float(nj)} * (gl_FragCoord.xy / ${E.float(Cf)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${e.mode===Vh.Full?E`gl_FragColor.ba = vec2(0.0, map);`:E`gl_FragColor = vec4(map);`};
    }
  `),t}const Mot=Object.freeze(Object.defineProperty({__proto__:null,build:Aot},Symbol.toStringTag,{value:"Module"}));class h$ extends Lr{initializeProgram(t){const i=h$.shader.get().build(this.configuration);return new Er(t.rctx,i,lr)}initializePipeline(){return ri({blending:this.configuration.mode===Vh.Full?my(ke.ONE,ke.ZERO):ba(ke.ZERO,ke.ONE,ke.ONE,ke.ZERO),depthTest:{func:Fr.ALWAYS},colorWrite:xi})}}h$.shader=new Sr(Mot,()=>import("./NoiseTextureAtlas.glsl.10fbae21.js"));class hC{constructor(t,i){this._context=t,this._desc=i,this.type="renderbuffer",this._context.instanceCounter.increment(co.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=i;if(a){if(this._context.type!==Ii.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,s,n)}else r.renderbufferStorage(r.RENDERBUFFER,o,s,n)}get descriptor(){return this._desc}get samples(){const t=this._desc.samples,i=this._context.parameters.maxSamples;return t?Math.min(t,i):i}resize(t,i){const r=this._desc;if(r.width===t&&r.height===i)return;r.width=t,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(co.Renderbuffer,this),this._context=null)}}const Oot=ve.getLogger("esri.views.webgl.FrameBufferObject");class ss{constructor(t,i,r=null,s=null){var n;if(this._context=t,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc=F({},i),t.instanceCounter.increment(co.FramebufferObject,this),_(r)){Array.isArray(r)||(r=[r]);for(let o=0;o<r.length;++o){const a=r[o],l=Eh.COLOR_ATTACHMENT0+o;let c;dhe(a)?(o0(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new _t(this._context,c))),EN(c,this._desc)):(hhe(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new hC(this._context,c))),oj(c,this._desc)),this._validateColorAttachmentPoint(l)}}if(_(s)){let o,a;if(dhe(s))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),o0(s)?(a=s.descriptor,this._depthStencilTexture=s):(a=s,this._depthStencilTexture=new _t(this._context,a)),EN(a,this._desc);else{hhe(s)?(a=s.descriptor,o=s):(a=s,o=new hC(this._context,a));const l=(n=this._desc.depthStencilTarget)!=null?n:Yi.DEPTH_STENCIL_RENDER_BUFFER;l===Yi.STENCIL_RENDER_BUFFER?this._stencilAttachment=o:l===Yi.DEPTH_RENDER_BUFFER||l===Yi.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=o:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),oj(a,this._desc)}}}dispose(){if(!this._desc)return;const t=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(co.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const t=this._colorAttachments.get(Eh.COLOR_ATTACHMENT0);return t&&o0(t)?t:null}get colorAttachment(){return this._colorAttachments.get(Eh.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((t,[i,r])=>t+SS(r),0)+SS(this.depthStencilAttachment)}getColorTexture(t){const i=this._colorAttachments.get(t);return i&&o0(i)?i:null}attachColorTexture(t,i=Eh.COLOR_ATTACHMENT0){!t||(this._validateColorAttachmentPoint(i),EN(t.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,i)),this._colorAttachments.set(i,t))}detachColorTexture(t=Eh.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(t);if(o0(i)){const r=i;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)),this._colorAttachments.delete(t),r}}setColorTextureTarget(t,i=Eh.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);o0(r)&&this._framebufferTexture2D(r.glName,i,t)}attachDepthStencilTexture(t){if(M(t))return;const i=t.descriptor;i.pixelFormat!==Qe.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==kt.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),EN(i,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==Yi.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=Yi.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,Zue)),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,Zue)),this._depthStencilTexture=null,t}attachDepthStencilBuffer(t){if(M(t))return;const i=t.descriptor;if(i.internalFormat!==Ul.DEPTH_STENCIL&&i.internalFormat!==Ul.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),oj(i,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=i.internalFormat===Ul.DEPTH_STENCIL?Yi.DEPTH_STENCIL_RENDER_BUFFER:Yi.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,s=this._desc.depthStencilTarget===Yi.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(Oo.FRAMEBUFFER,s,r.RENDERBUFFER,t.glName)}this._depthAttachment=t}detachDepthStencilBuffer(){const t=this._context.gl,i=this._depthAttachment;if(i&&this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===Yi.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(Oo.FRAMEBUFFER,r,t.RENDERBUFFER,null)}return this._depthAttachment=null,i}detachAll(){this._colorAttachments.forEach((t,i)=>this._detachColorAttachment(i)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(t,i,r,s,n,o,a){(t<0||i<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=a.descriptor;a.descriptor.target!==At.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(t+r>l.width||i+s>l.height||n+r>c.width||o+s>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const h=this._context,p=h.bindTexture(a,_t.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(_t.TEXTURE_UNIT_FOR_UPDATES),h.bindFramebuffer(this),h.gl.copyTexSubImage2D(At.TEXTURE_2D,0,n,o,t,i,r,s),h.bindTexture(p,_t.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,i,r,s,n,o,a){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,i,r,s,n,o,a)}async readPixelsAsync(t,i,r,s,n,o,a){if(this._context.type!==Ii.WEBGL2)return Wd()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(t,i,r,s,n,o,a);const l=this._context.gl,c=Ci.createPixelPack(this._context,Wi.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(t,i,r,s,n,o,0),this._context.unbindBuffer(Lt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(t,i){const r=this._desc;if(r.width!==t||r.height!==i){if(!this._initialized)return r.width=t,r.height=i,this._colorAttachments.forEach(s=>{s&&s.resize(t,i)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,i));r.width=t,r.height=i,this._colorAttachments.forEach(s=>{s&&s.resize(t,i)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(t,i):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(t,i),this._stencilAttachment&&this._stencilAttachment.resize(t,i)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(t=Oo.FRAMEBUFFER){var h,p,f,m;const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(t,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=this._context,s=i.createFramebuffer(),n=this._desc,o=(h=n.colorTarget)!=null?h:zs.RENDER_BUFFER,a=(p=n.width)!=null?p:1,l=(f=n.height)!=null?f:1;if(i.bindFramebuffer(t,s),this._colorAttachments.size===0)if(o===zs.TEXTURE||o===zs.CUBEMAP)this._colorAttachments.set(Eh.COLOR_ATTACHMENT0,Rot(r,n,this.descriptor.colorTarget===zs.CUBEMAP?At.TEXTURE_CUBE_MAP:At.TEXTURE_2D));else{const g=new hC(r,{internalFormat:Mt.RGBA4,width:a,height:l});this._colorAttachments.set(Eh.COLOR_ATTACHMENT0,g)}this._colorAttachments.forEach((g,y)=>{g&&(o0(g)?this._framebufferTexture2D(g.glName,y,phe(g),t):i.framebufferRenderbuffer(t,y,i.RENDERBUFFER,g.glName))});const c=(m=n.depthStencilTarget)!=null?m:Yi.NONE;switch(c){case Yi.DEPTH_RENDER_BUFFER:case Yi.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new hC(r,{internalFormat:n.depthStencilTarget===Yi.DEPTH_RENDER_BUFFER?Ul.DEPTH_COMPONENT16:Ul.DEPTH_STENCIL,width:a,height:l}));const g=c===Yi.DEPTH_RENDER_BUFFER?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(t,g,i.RENDERBUFFER,this._depthAttachment.glName);break}case Yi.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new hC(r,{internalFormat:Ul.STENCIL_INDEX8,width:a,height:l})),i.framebufferRenderbuffer(t,i.STENCIL_ATTACHMENT,i.RENDERBUFFER,this._stencilAttachment.glName);break;case Yi.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){r.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const g={target:At.TEXTURE_2D,pixelFormat:Qe.DEPTH_STENCIL,dataType:kt.UNSIGNED_INT_24_8,samplingMode:gt.NEAREST,wrapMode:$t.CLAMP_TO_EDGE,width:a,height:l};this._depthStencilTexture=new _t(r,g)}this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,phe(this._depthStencilTexture),t)}o$()&&i.checkFramebufferStatus(t)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=s,this._initialized=!0}_framebufferTexture2D(t,i=Eh.COLOR_ATTACHMENT0,r=At.TEXTURE_2D,s=Oo.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,i,r,t,n)}_detachColorAttachment(t){Wd()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const i=this._context.gl,r=this._colorAttachments.get(t);return o0(r)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)):this._initialized&&(this._context.bindFramebuffer(this),i.framebufferRenderbuffer(Oo.FRAMEBUFFER,t,i.RENDERBUFFER,null)),this._colorAttachments.delete(t),r}_disposeColorAttachments(){this._colorAttachments.forEach((t,i)=>{this._detachColorAttachment(i),t.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===Yi.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(Oo.FRAMEBUFFER,i,t.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),t.framebufferRenderbuffer(Oo.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(t){if(ss._MAX_COLOR_ATTACHMENTS===-1){const r=this._context.capabilities.drawBuffers;if(r){const s=this._context.gl;ss._MAX_COLOR_ATTACHMENTS=s.getParameter(r.MAX_COLOR_ATTACHMENTS)}else ss._MAX_COLOR_ATTACHMENTS=1}const i=t-Eh.COLOR_ATTACHMENT0;i+1>ss._MAX_COLOR_ATTACHMENTS&&Oot.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${ss._MAX_COLOR_ATTACHMENTS} color attachments`)}}function o0(e){return"type"in e&&e.type==="texture"}function hhe(e){return"type"in e&&e.type==="renderbuffer"}function dhe(e){return o0(e)||"pixelFormat"in e}function Rot(e,t,i){return new _t(e,{target:i,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:gt.NEAREST,wrapMode:$t.CLAMP_TO_EDGE,width:t.width,height:t.height})}function EN(e,t){e.target!==At.TEXTURE_2D&&e.target!==At.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function oj(e,t){t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function phe(e){return e.descriptor.target===At.TEXTURE_CUBE_MAP?At.TEXTURE_CUBE_MAP_POSITIVE_X:At.TEXTURE_2D}ss._MAX_COLOR_ATTACHMENTS=-1;class mAe extends Ee{constructor(t){let i;super(t),this._weatherTile=zl(0,0),this._needsRender=!0,this._frameBuffer=new ss(t.context.renderContext.rctx,{colorTarget:zs.TEXTURE,width:Cf,height:Cf},{target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:gt.LINEAR,hasMipmap:!1,width:Cf,height:Cf}),this._vao=Yl(t.context.renderContext.rctx),this._shaderTechniqueRepository=t.context.shaderTechniqueRepository,this._ensureRendered=()=>(_(i)?_(this.weatherMapTechnique)&&this.weatherMapTechnique.compiled&&this._needsRender&&(i=this._render(t.context.renderContext.rctx,Vh.WeatherMap)):_(this.fullTechnique)&&this.fullTechnique.compiled&&(i=this._render(t.context.renderContext.rctx,Vh.Full)),i)}get textureAtlas(){return this._ensureRendered()}_setDirty(){this._needsRender=!0}updateWeatherMap(t){this._weatherTile[0]===t[0]&&this._weatherTile[1]===t[1]||(this._weatherTile=t,this._setDirty())}destroy(){this._fullTechnique=br(this._fullTechnique),this._weatherMapTechnique=br(this._weatherMapTechnique),this._frameBuffer=ht(this._frameBuffer),this._vao=ht(this._vao)}get fullTechnique(){if(M(this._fullTechnique)){const t=new MY;t.mode=Vh.Full,this._fullTechnique=this._shaderTechniqueRepository.acquire(h$,t)}return this._fullTechnique}get weatherMapTechnique(){if(M(this._weatherMapTechnique)){const t=new MY;t.mode=Vh.WeatherMap,this._weatherMapTechnique=this._shaderTechniqueRepository.acquire(h$,t)}return this._weatherMapTechnique}_render(t,i){if(M(this._vao)||M(this._frameBuffer))return null;const r=i===Vh.Full?this.fullTechnique:this.weatherMapTechnique;if(M(r))return null;const s=t.getViewport();t.setViewport(0,0,Cf,Cf),t.bindFramebuffer(this._frameBuffer);const n=t.bindTechnique(r);return n.setUniform2f("weatherTile",this._weatherTile[0],this._weatherTile[1]),t.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),t.gl.drawArrays(t.gl.TRIANGLE_STRIP,0,4),t.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}}u([d({constructOnly:!0})],mAe.prototype,"context",void 0);function gAe(e){e.include(ad),e.uniforms.add([new oi("geometryDepthTexture",(t,i)=>i.multipassGeometry.linearDepthTexture),new Di("nearFar",(t,i)=>i.camera.nearFar)]),e.code.add(E`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class Pot{constructor(){this.enabled=!1}}function ld(e,t){t.hasMultipassTerrain&&(e.fragment.include(ad),e.fragment.uniforms.add(new oi("terrainDepthTexture",(i,r)=>r.multipassTerrain.linearDepthTexture)),e.fragment.uniforms.add(new Di("nearFar",(i,r)=>r.camera.nearFar)),e.fragment.uniforms.add(new Di("inverseViewport",(i,r)=>r.inverseViewport)),e.fragment.code.add(E`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class Iot{constructor(){this.enabled=!1,this.cullAboveGround=!1}}function $ot(e,t){const i=e.fragment.uniforms;i.add(new Di("nearFar",(r,s)=>s.camera.nearFar)),i.add(new oi("depthMap",(r,s)=>s.linearDepthTexture)),i.add(new Xr("view",(r,s)=>s.ssr.camera.viewMatrix)),i.add(new Xr("proj",(r,s)=>s.ssr.camera.projectionMatrix)),i.add(new lt("invResolutionHeight",(r,s)=>1/s.ssr.camera.height)),i.add(new oi("lastFrameColorMap",(r,s)=>s.ssr.lastFrameColorTexture)),i.add(new Xr("reprojectionMatrix",(r,s)=>s.ssr.reprojectionMatrix)),e.fragment.include(ad),e.fragment.code.add(E`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class Lot{constructor(){this.reprojectionMatrix=Ne()}}var $e;(function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",e[e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=12]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=14]="HUD_MATERIAL",e[e.LABEL_MATERIAL=15]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",e[e.DRAPED_WATER=19]="DRAPED_WATER",e[e.VOXEL=20]="VOXEL",e[e.MAX_SLOTS=21]="MAX_SLOTS"})($e||($e={}));class yie{constructor(t=$()){this.intensity=t}}class yAe{constructor(t=$(),i=Ze(.57735,.57735,.57735)){this.intensity=t,this.direction=i}}class OY{constructor(t=$(),i=Ze(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=t,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}}class vAe{constructor(){this.r=[0],this.g=[0],this.b=[0]}}function Dot(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t[r];return i}function aj(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t;return i}function yA(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]+t[r];return i}function _Ae(e){return(e+1)*(e+1)}function Not(e){return He(Math.floor(Math.sqrt(e)-1),0,2)}function bAe(e,t,i){const r=e[0],s=e[1],n=e[2],o=i||[];return o.length=_Ae(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),t>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function Fot(e,t){const i=_Ae(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function kot(e,t){const i=Not(t.r.length);for(const r of e)ll(RY,r.direction),bAe(RY,i,k0),Dot(k0,rk),aj(k0,r.intensity[0],D2),yA(t.r,D2),aj(k0,r.intensity[1],D2),yA(t.g,D2),aj(k0,r.intensity[2],D2),yA(t.b,D2);return t}function Uot(e,t){bAe(RY,0,k0);for(const i of e)t.r[0]+=k0[0]*rk[0]*i.intensity[0]*4*Math.PI,t.g[0]+=k0[0]*rk[0]*i.intensity[1]*4*Math.PI,t.b[0]+=k0[0]*rk[0]*i.intensity[2]*4*Math.PI;return t}function zot(e,t,i,r){Fot(t,r),he(i.intensity,0,0,0);let s=!1;const n=Vot,o=Bot,a=Got;n.length=0,o.length=0,a.length=0;for(const l of e)l instanceof OY&&!s?(pe(i.direction,l.direction),pe(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof OY||l instanceof yAe?n.push(l):l instanceof yie?o.push(l):l instanceof vAe&&a.push(l);kot(n,r),Uot(o,r);for(const l of a)yA(r.r,l.r),yA(r.g,l.g),yA(r.b,l.b)}const Vot=[],Bot=[],Got=[],k0=[0],D2=[0],RY=$(),rk=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],xO=.4;class jot{constructor(){this._shOrder=2,this._oldSunlight={direction:$(),ambient:{color:$(),intensity:1},diffuse:{color:$(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new vAe,this._mainLight={intensity:$(),direction:Ze(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}get lightingMainDirection(){return this._mainLight.direction}set(t){zot(t,this._shOrder,this._mainLight,this._sphericalHarmonics),pe(this._oldSunlight.direction,this._mainLight.direction);const i=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,fe(this._oldSunlight.diffuse.color,this._mainLight.intensity,i),pe(CN,this._oldSunlight.diffuse.color),fe(CN,CN,xO*this.globalFactor),we(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,CN)}get old(){return this._oldSunlight}}const CN=$();class m6{constructor(t,i,r){this.shadowMap=t,this.ssaoHelper=i,this.slicePlane=r,this.slot=$e.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this._inverseViewport=Ke(),this.lighting=new jot,this.ssr=new Lot,this.multipassTerrain=new Iot,this.multipassGeometry=new Pot,this.clouds=new Int,this.overlays=[]}get camera(){return this._camera}set camera(t){this._camera=this.ssr.camera=t,this._inverseViewport[0]=1/t.fullViewport[2],this._inverseViewport[1]=1/t.fullViewport[3]}get inverseViewport(){return this._inverseViewport}}let Ml=class extends Ee{constructor(e){super(e),this._frameTask=null,this._handles=new Nt,this._cubeMapSize=ye("esri-mobile")?1024:2048,this._techniques=[],this._techniqueConfiguration=new dAe,this._bindParameters=new m6(null,null,null),this._drawParameters=new pAe,this._weatherTile=zl(0,0),this._weatherTileCount=128,this.coverage=ui(tc.coverage[0],tc.coverage[1],.5),this.density=ui(tc.density[0],tc.density[1],.5),this.absorption=ui(tc.absorption[0],tc.absorption[1],.5),this.cloudSize=ui(tc.cloudSize[0],tc.cloudSize[1],.5),this.detailSize=ui(tc.detailSize[0],tc.detailSize[1],.5),this.smoothness=ui(tc.smoothness[0],tc.smoothness[1],.5),this.cloudHeight=ui(tc.cloudHeight[0],tc.cloudHeight[1],.5),this.raymarchingStepType=tc.raymarchingStepType,this._cloudRadius=0,this._viewMatrix=Ne(),this._cameraPositionLastFrame=$(),this.running=!1}_getTechnique(e){return this._techniques[e]||(this._techniqueConfiguration.steps=e,this._techniques[e]=new f6({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[e])}_getWeatherTile(){const e=this.view.camera.position.latitude,t=this.view.camera.position.longitude;let i=zl((e+90)/180,(t+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*i[0]-1));i=zl(Math.floor(2*this._weatherTileCount*i[0]),Math.floor(4*(this._weatherTileCount-r)*i[1]));let s=0,n=0;if(_(this.view.environment)&&this.view.environment.lighting.type==="sun"&&_(this.view.environment.lighting.date)){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+this.view.environment.lighting.displayUTCOffset),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}return i[0]=(i[0]+s)%(2*this._weatherTileCount),i[1]=(i[1]+n%100)%(4*this._weatherTileCount),i}initialize(){this._vao=Yl(this.context.renderContext.rctx);const e=Ri(this.view.spatialReference);this._cloudRadius=.5*e.radius,this.setDirty(),this._weatherTile=this._getWeatherTile(),this._frameTask=this.view.resourceController.scheduler.registerTask(Ot.CLOUDS_GENERATOR,this),this._handles.add(this._frameTask),this._handles.add(re(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingStepType],()=>this.setDirty(),Et))}destroy(){this._handles.destroy(),this._techniques.forEach(e=>br(e)),this._techniques=null,this._frameBufferCube=ht(this._frameBufferCube),this._vao=ht(this._vao),this._noiseTexture=We(this._noiseTexture)}_ensureNoiseTexture(){if(M(this._noiseTexture)){const e=this.context;this._noiseTexture=new mAe({context:e}),this._noiseTexture.updateWeatherMap(this._weatherTile)}return this._noiseTexture.textureAtlas}ensureWeatherTile(){const e=this._getWeatherTile();_(this._noiseTexture)&&_(this.context)&&this._noiseTexture.updateWeatherMap(e),e[0]===this._weatherTile[0]&&e[1]===this._weatherTile[1]||(this._weatherTile=e,this.setDirty())}get frameBufferCube(){if(M(this._frameBufferCube)){const e={target:At.TEXTURE_CUBE_MAP,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:gt.LINEAR,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize};this._frameBufferCube=new ss(this.context.renderContext.rctx,{colorTarget:zs.CUBEMAP,width:this._cubeMapSize,height:this._cubeMapSize},e)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}isFading(e){return e.crossFade.enabled||e.fadeInOut.stage===aa.FADE_OUT||e.fadeInOutHeight.stage!==mb.FINISHED}applyPreset(e,t){const i=e.median,r=s=>{const n=ui(s[0],s[1],i);return t<.5?ui(s[0],n,2*t):ui(n,s[1],2*(t-.5))};this.coverage=r(e.coverage),this.density=r(e.density),this.absorption=r(e.absorption),this.cloudSize=r(e.cloudSize),this.detailSize=r(e.detailSize),this.smoothness=r(e.smoothness),this.cloudHeight=r(e.cloudHeight),this.raymarchingStepType=e.raymarchingStepType}setDirty(){this.running=!0}runTask(e){if(this.coverage===0||M(this._vao))return void(this.running=!1);const t=this._getTechnique(this.raymarchingStepType);if(!t.compiled)return;if(!sS(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye)||this.isFading(this.context.renderContext.bindParameters.clouds))return void pe(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye);this.ensureWeatherTile();const i=this._ensureNoiseTexture();if(M(i))return;const r=this.context.renderContext.rctx,s=r.bindTechnique(t),n=1+this.absorption,o=ui(35,120,this.absorption);s.bindTexture("cloudShapeTexture",i),s.setUniform1f("cloudRadius",this._cloudRadius),s.setUniform1f("halfCubeMapSize",.5*this._cubeMapSize),s.setUniform1f("power",o),s.setUniform1f("sigmaE",n),s.setUniform1f("density",ui(0,.3,this.density)),s.setUniform1f("cloudSize",ui(0,.02,Math.max(.01,1-this.cloudSize))),s.setUniform1f("detailSize",ui(0,.2,Math.max(.01,1-this.detailSize))),s.setUniform1f("smoothness",ui(0,.5,1-this.smoothness)),s.setUniform1f("cloudHeight",ui(0,1500,this.cloudHeight)),s.setUniform1f("coverage",this.coverage),r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const a=r.getViewport();r.setViewport(0,0,this._cubeMapSize,this._cubeMapSize),r.bindFramebuffer(this.frameBufferCube);for(let l=0;l<5;l++){const c=Hot[l],h=qot[l];$be(this._viewMatrix,Wot,c,h),Cp(this._drawParameters.viewMatrix,this._viewMatrix);const p=At.TEXTURE_CUBE_MAP_POSITIVE_X+l;this.frameBufferCube.setColorTextureTarget(p),s.bindDraw(this._drawParameters,this._bindParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush()}this.running=!1,r.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),e.madeProgress()}};u([d({constructOnly:!0})],Ml.prototype,"context",void 0),u([d({constructOnly:!0})],Ml.prototype,"view",void 0),u([d({constructOnly:!0})],Ml.prototype,"requestRender",void 0),u([d()],Ml.prototype,"_frameTask",void 0),u([d()],Ml.prototype,"coverage",void 0),u([d()],Ml.prototype,"density",void 0),u([d()],Ml.prototype,"absorption",void 0),u([d()],Ml.prototype,"cloudSize",void 0),u([d()],Ml.prototype,"detailSize",void 0),u([d()],Ml.prototype,"smoothness",void 0),u([d()],Ml.prototype,"cloudHeight",void 0),u([d()],Ml.prototype,"raymarchingStepType",void 0),u([d()],Ml.prototype,"running",void 0),Ml=u([L("esri.views.3d.environment.CloudsGenerator")],Ml);const Hot=[Ki(1,0,0),Ki(-1,0,0),Ki(0,1,0),Ki(0,-1,0),Ki(0,0,1)],qot=[Ki(0,1,0),Ki(0,1,0),Ki(0,0,-1),Ki(0,0,1),Ki(0,1,0)],Wot=rie(),tc=fAe.sunny;function Zot(e){const t=new mr;t.attributes.add(P.POSITION,"vec2"),t.include(ev,{textureCoordinateType:Hn.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=t;return i.uniforms.add([new Xr("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Xr("inverseViewMatrix",(s,n)=>Ks(Xot,n.camera.viewMatrix))]),i.code.add(E`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new nr("atmosphereC")),r.uniforms.add(new Lc("cameraPosition")),r.uniforms.add(new Di("nearFar",(s,n)=>n.camera.nearFar)),r.uniforms.add(new ws("depthTex")),r.uniforms.add(new nr("fogStrength")),r.uniforms.add(new nr("fogAmount")),r.uniforms.add(new Lc("fogColor")),t.include(l6),r.include(ad),r.code.add(E`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(E`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(E`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${e.haze?E`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),t}const Xot=Ne(),Yot=Object.freeze(Object.defineProperty({__proto__:null,build:Zot},Symbol.toStringTag,{value:"Module"}));class d$ extends Lr{initializeProgram(t){const i=d$.shader.get().build(this.configuration);return new Er(t.rctx,i,lr)}initializePipeline(){return this.configuration.haze?ri({blending:ba(ke.ONE,ke.ZERO,ke.ONE_MINUS_SRC_COLOR,ke.ONE),colorWrite:xi}):ri({blending:ba(ke.SRC_ALPHA,ke.ZERO,ke.ONE_MINUS_SRC_ALPHA,ke.ONE),colorWrite:xi})}}d$.shader=new Sr(Yot,()=>import("./Fog.glsl.38b0cc98.js"));class PY extends Xl{constructor(){super(...arguments),this.haze=!1}}u([Q()],PY.prototype,"haze",void 0);let aI=class extends Ee{constructor(e){super(e),this._fogColor=Xi(),this._fogColorAtNight=Xi(),this._cameraDirection=Xi(),this._foggyFadeStart=.95,this._foggyFadeEnd=1,this._hazeFadeStart=.7,this._hazeFadeEnd=1,this._strength=4e-6;const t=e.context.renderContext.rctx;this._vao=Yl(t,$L);const i=Ri(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+K5}destroy(){this._hazeFogTechnique=br(this._hazeFogTechnique),this._thickFogTechnique=br(this._thickFogTechnique),this._vao=ht(this._vao)}get _shaderTechniqueRepository(){return this.context.shaderTechniqueRepository}set strength(e){this._strength=e}get strength(){return this._strength}get thickFogTechnique(){if(M(this._thickFogTechnique)){const e=new PY;e.haze=!1,this._thickFogTechnique=this._shaderTechniqueRepository.acquire(d$,e)}return this._thickFogTechnique}get hazeFogTechnique(){if(M(this._hazeFogTechnique)){const e=new PY;e.haze=!0,this._hazeFogTechnique=this._shaderTechniqueRepository.acquire(d$,e)}return this._hazeFogTechnique}when(){return Promise.resolve()}render(e,t,i){if(this.view.basemapTerrain.baseOpacity===0&&!t||(this._update(e,t,i),this._fogAmount<=0))return;const r=t?this.thickFogTechnique:this.hazeFogTechnique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper,n=e.rctx.bindTechnique(r,Jot,e.bindParameters);s.renderDepthDetached(()=>{n.bindTexture("depthTex",s.depthTexture),this._renderFog(r.program,e)})}_renderFog(e,t){if(M(this._vao))return!1;const i=t.rctx,r=t.bindParameters.camera;return e.setUniform3fv("cameraPosition",r.eye),e.setUniform1f("atmosphereC",this._atmosphereC),e.setUniform1f("fogStrength",this._strength),e.setUniform1f("fogAmount",this._fogAmount),e.setUniform3fv("fogColor",this._fogColor),i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Wt.TRIANGLE_STRIP,0,4),!0}_update(e,t,i){const r=e.bindParameters.camera,s=t?.1:0;i?he(this._fogColor,.5,.5,.5):t?he(this._fogColor,1.5,1.5,1.5):he(this._fogColor,.24,.44,.8),fe(this._fogColorAtNight,this._fogColor,s),Re(this._cameraDirection,r.eye);const n=Math.max(0,Pe(this._cameraDirection,e.bindParameters.lighting.lightingMainDirection));Pn(this._fogColor,this._fogColorAtNight,this._fogColor,n);const o=Ue(r.eye),a=o*o;this._atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._fogAmount=t?1-UA(this._foggyFadeStart*Qd,this._foggyFadeEnd*Qd,Math.abs(o-this._planetRadius)):1-UA(this._hazeFadeStart*Qd,this._hazeFadeEnd*Qd,Math.abs(o-this._planetRadius))}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],aI.prototype,"context",void 0),u([d({constructOnly:!0})],aI.prototype,"view",void 0),aI=u([L("esri.views.3d.environment.Fog")],aI);const Jot=new Nn;async function lm(e,t){const{data:i}=await Zt(e,F({responseType:"image"},t));return i}var iy;(function(e){e[e.Cone=0]="Cone",e[e.Cylinder=1]="Cylinder",e[e.Underground=2]="Underground",e[e.COUNT=3]="COUNT"})(iy||(iy={}));class Ez extends Xl{constructor(){super(...arguments),this.geometry=iy.Cone}}u([Q({count:iy.COUNT})],Ez.prototype,"geometry",void 0);function Ua(e,t={hasModelTransformation:!1,linearDepth:!1}){if(t.hasModelTransformation)return t.linearDepth?void e.vertex.code.add(E`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):void e.vertex.code.add(E`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.linearDepth?e.vertex.code.add(E`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(E`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}class Ib extends $s{constructor(t){super(t,"mat4")}}class vie extends Nn{}function Qot(e){const t=new mr,{vertex:i,fragment:r}=t;if(e.geometry===iy.Underground)t.attributes.add(P.POSITION,"vec2"),t.varyings.add("color","vec4"),i.uniforms.add([new Dt("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new Lc("cameraPosition"),new nr("undergroundFadeAlpha")]),i.code.add(E`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(E`void main() {
gl_FragColor = color;
}`);else{t.include(Ua),t.attributes.add(P.POSITION,"vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const s=e.geometry===iy.Cylinder;i.uniforms.add([new Xr("proj",(a,l)=>l.camera.projectionMatrix),new Ib("view"),new Dt("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection)]),s||(t.varyings.add("innerFactor","float"),i.uniforms.add(new Lc("silCircleCenter")),i.uniforms.add(new Lc("silCircleV1")),i.uniforms.add(new Lc("silCircleV2")),i.uniforms.add(new tv("texV")),i.uniforms.add(new nr("innerScale")));const n=6.2831853,o=1/128;i.code.add(E`
		void main(void) {
      ${s?E`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:E`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${E.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${E.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new oi("tex",a=>a.texture)),s||r.uniforms.add(new nr("altitudeFade")),r.code.add(E`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${s?E`gl_FragColor = atmosphereColor;`:E`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return t}const Kot=Object.freeze(Object.defineProperty({__proto__:null,SimpleAtmospherePassParameters:vie,build:Qot},Symbol.toStringTag,{value:"Module"}));class _M extends Lr{initializeProgram(t){const i=_M.shader.get().build(this.configuration);return new Er(t.rctx,i,lr)}initializePipeline(){return this.configuration.geometry===iy.Cylinder?ri({blending:ba(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),culling:Jte,depthTest:{func:Fr.LEQUAL},colorWrite:xi}):ri({blending:ba(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),depthTest:{func:Fr.LEQUAL},colorWrite:xi})}}_M.shader=new Sr(Kot,()=>import("./SimpleAtmosphere.glsl.bb9d47f1.js"));const wAe="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII=";function Xu(e,t=0){const i=e.stride;return e.fieldNames.filter(r=>{const s=e.fields.get(r).optional;return!(s&&s.glPadding)}).map(r=>{const s=e.fields.get(r),n=s.constructor.ElementCount,o=eat(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new ya(r,n,o,a,i,l,t)})}function eat(e){const t=tat[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const tat={u8:St.UNSIGNED_BYTE,u16:St.UNSIGNED_SHORT,u32:St.UNSIGNED_INT,i8:St.BYTE,i16:St.SHORT,i32:St.INT,f32:St.FLOAT};class _ie{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}_ie.ElementCount=9;class bie{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}bie.ElementCount=16;class kv{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}get(t){return this.typedBuffer[t*this.typedBufferStride]}set(t,i){this.typedBuffer[t*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}}kv.ElementCount=1;class Uv{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,Li(i,this.typedBuffer[t],this.typedBuffer[t+1])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t]=i[1]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}Uv.ElementCount=2;class zv{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,he(i,this.typedBuffer[t],this.typedBuffer[t+1],this.typedBuffer[t+2])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t++]=i[1],this.typedBuffer[t]=i[2]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r,s){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t++]=r,this.typedBuffer[t]=s}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}zv.ElementCount=3;class Vv{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,_r(i,this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t++]=i[1],this.typedBuffer[t++]=i[2],this.typedBuffer[t]=i[3]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r,s,n){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t++]=r,this.typedBuffer[t++]=s,this.typedBuffer[t]=n}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}Vv.ElementCount=4;class DL extends kv{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}static fromTypedArray(t,i){return new DL(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}DL.ElementType="f32";class Mp extends Uv{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(Mp,t,i)}static fromTypedArray(t,i){return new Mp(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Mp.ElementType="f32";class fr extends zv{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(fr,t,i)}static fromTypedArray(t,i){return new fr(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}fr.ElementType="f32";class Ho extends Vv{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(Ho,t,i)}static fromTypedArray(t,i){return new Ho(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Ho.ElementType="f32";class cm extends _ie{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(cm,t,i)}static fromTypedArray(t,i){return new cm(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}cm.ElementType="f32";class $b extends _ie{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer($b,t,i)}static fromTypedArray(t,i){return new $b(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}$b.ElementType="f64";class bM extends bie{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(bM,t,i)}static fromTypedArray(t,i){return new bM(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}bM.ElementType="f32";class Lb extends bie{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(Lb,t,i)}static fromTypedArray(t,i){return new Lb(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Lb.ElementType="f64";class wM extends kv{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(wM,t,i)}static fromTypedArray(t,i){return new wM(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}wM.ElementType="f64";class xM extends Uv{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(xM,t,i)}static fromTypedArray(t,i){return new xM(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}xM.ElementType="f64";class fn extends zv{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(fn,t,i)}static fromTypedArray(t,i){return new fn(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}fn.ElementType="f64";class CS extends Vv{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(CS,t,i)}static fromTypedArray(t,i){return new CS(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}CS.ElementType="f64";class Ev extends kv{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(Ev,t,i)}static fromTypedArray(t,i){return new Ev(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Ev.ElementType="u8";class AS extends Uv{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(AS,t,i)}static fromTypedArray(t,i){return new AS(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}AS.ElementType="u8";class Db extends zv{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(Db,t,i)}static fromTypedArray(t,i){return new Db(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Db.ElementType="u8";class Hc extends Vv{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(Hc,t,i)}static fromTypedArray(t,i){return new Hc(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Hc.ElementType="u8";class MS extends kv{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(MS,t,i)}static fromTypedArray(t,i){return new MS(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}MS.ElementType="u16";class TM extends Uv{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(TM,t,i)}static fromTypedArray(t,i){return new TM(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}TM.ElementType="u16";class OS extends zv{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(OS,t,i)}static fromTypedArray(t,i){return new OS(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}OS.ElementType="u16";class Nb extends Vv{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(Nb,t,i)}static fromTypedArray(t,i){return new Nb(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Nb.ElementType="u16";class RS extends kv{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(RS,t,i)}static fromTypedArray(t,i){return new RS(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}RS.ElementType="u32";class SM extends Uv{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(SM,t,i)}static fromTypedArray(t,i){return new SM(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}SM.ElementType="u32";class p$ extends zv{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(p$,t,i)}static fromTypedArray(t,i){return new p$(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}p$.ElementType="u32";class f$ extends Vv{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(f$,t,i)}static fromTypedArray(t,i){return new f$(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}f$.ElementType="u32";class EM extends kv{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(EM,t,i)}static fromTypedArray(t,i){return new EM(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}EM.ElementType="i8";class PS extends Uv{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(PS,t,i)}static fromTypedArray(t,i){return new PS(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}PS.ElementType="i8";class m$ extends zv{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(m$,t,i)}static fromTypedArray(t,i){return new m$(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}m$.ElementType="i8";class g$ extends Vv{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(g$,t,i)}static fromTypedArray(t,i){return new g$(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}g$.ElementType="i8";class y$ extends kv{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(y$,t,i)}static fromTypedArray(t,i){return new y$(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}y$.ElementType="i16";class IS extends Uv{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(IS,t,i)}static fromTypedArray(t,i){return new IS(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}IS.ElementType="i16";class v$ extends zv{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(v$,t,i)}static fromTypedArray(t,i){return new v$(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}v$.ElementType="i16";class _$ extends Vv{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(_$,t,i)}static fromTypedArray(t,i){return new _$(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}_$.ElementType="i16";class b$ extends kv{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(b$,t,i)}static fromTypedArray(t,i){return new b$(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}b$.ElementType="i32";class w$ extends Uv{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(w$,t,i)}static fromTypedArray(t,i){return new w$(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}w$.ElementType="i32";class x$ extends zv{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(x$,t,i)}static fromTypedArray(t,i){return new x$(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}x$.ElementType="i32";class T$ extends Vv{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(T$,t,i)}static fromTypedArray(t,i){return new T$(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}T$.ElementType="i32";function xAe(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8;default:return}}function iat(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function rat(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function sat(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}class Cz{constructor(t,i){this.layout=t,this.buffer=typeof i=="number"?new ArrayBuffer(i*t.stride):i;for(const r of t.fieldNames){const s=t.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(t,i){const r=this[t];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(t,i){return new Cz(this.layout,this.buffer.slice(t*this.stride,i*this.stride))}copyFrom(t,i,r,s){const n=this.stride;if(n%4==0){const o=new Uint32Array(t.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(o)}else{const o=new Uint8Array(t.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(o)}}}class wie{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(t,i){return this._appendField(t,Mp,i),this}vec2f64(t,i){return this._appendField(t,xM,i),this}vec3f(t,i){return this._appendField(t,fr,i),this}vec3f64(t,i){return this._appendField(t,fn,i),this}vec4f(t,i){return this._appendField(t,Ho,i),this}vec4f64(t,i){return this._appendField(t,CS,i),this}mat3f(t,i){return this._appendField(t,cm,i),this}mat3f64(t,i){return this._appendField(t,$b,i),this}mat4f(t,i){return this._appendField(t,bM,i),this}mat4f64(t,i){return this._appendField(t,Lb,i),this}vec4u8(t,i){return this._appendField(t,Hc,i),this}f32(t,i){return this._appendField(t,DL,i),this}f64(t,i){return this._appendField(t,wM,i),this}u8(t,i){return this._appendField(t,Ev,i),this}u16(t,i){return this._appendField(t,MS,i),this}i8(t,i){return this._appendField(t,EM,i),this}vec2i8(t,i){return this._appendField(t,PS,i),this}vec2i16(t,i){return this._appendField(t,IS,i),this}vec2u8(t,i){return this._appendField(t,AS,i),this}vec4u16(t,i){return this._appendField(t,Nb,i),this}u32(t,i){return this._appendField(t,RS,i),this}_appendField(t,i,r){const s=i.ElementCount*xAe(i.ElementType),n=this.stride;this.fields.set(t,{size:s,constructor:i,offset:n,optional:r}),this.stride+=s,this.fieldNames.push(t)}alignTo(t){return this.stride=Math.floor((this.stride+t-1)/t)*t,this}hasField(t){return this.fieldNames.includes(t)}createBuffer(t){return new Cz(this,t)}createView(t){return new Cz(this,t)}clone(){const t=new wie;return t.stride=this.stride,t.fields=new Map,this.fields.forEach((i,r)=>t.fields.set(r,i)),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t}}function Bs(){return new wie}var IY;(function(e){function t(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function i(o,a){const l=o[a],c=o[a+1],h=o[a+2],p=1/Math.sqrt(l*l+c*c+h*h);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]+l[c],h[p+1]=o[a+1]+l[c+1],h[p+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]-l[c],h[p+1]=o[a+1]-l[c+1],h[p+2]=o[a+2]-l[c+2]}e.length=t,e.normalize=i,e.scale=r,e.add=s,e.subtract=n})(IY||(IY={}));const _l=si();class nat{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function Ct(e,t){if(!e)throw t=t||"assert",console.log(new Error(t).stack),new nat(t)}function N2(e,t){e||(t=t||"",console.warn("Verify failed: "+t+`
`+new Error("verify").stack))}function fhe(e,t,i,r){let s,n=(i[0]-e[0])/t[0],o=(r[0]-e[0])/t[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-e[1])/t[1],l=(r[1]-e[1])/t[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(i[2]-e[2])/t[2],h=(r[2]-e[2])/t[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function AN(e,t,i,r,s,n=Ke()){const o=(r[s]-i[s])*(t[0]-e[0])-(r[0]-i[0])*(t[s]-e[s]),a=(r[0]-i[0])*(e[s]-i[s])-(r[s]-i[s])*(e[0]-i[0]);if(o===0)return!1;const l=a/o;return n[0]=e[0]+l*(t[0]-e[0]),n[1]=e[s]+l*(t[s]-e[s]),!0}function mhe(e,t,i,r,s){s||(s=e),_l[0]=e[0],_l[1]=e[1],_l[2]=e[2],_l[3]=1,jh(_l,_l,t),s.length>2&&(s[2]=-_l[2]),jh(_l,_l,i),Ct(_l[3]!==0),s[0]=_l[0]/_l[3],s[1]=_l[1]/_l[3],s[2]=_l[2]/_l[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function oat(e,t){return Math.log(e)/Math.log(t)}function TAe(e,t,i,r){e[12]=t,e[13]=i,e[14]=r}function SAe(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[15]===1}function aat(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/t)}function lat(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/i)}function cat(e,t,i){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function uat(e,t,i){return 2*Math.atan(i*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}class g6{constructor(t,i,r,s){this.primitiveIndices=t,this._numIndexPerPrimitive=i,this.indices=r,this.position=s,this.center=$(),Ct(t.length>=1),Ct(r.length%this._numIndexPerPrimitive==0),Ct(r.length>=t.length*this._numIndexPerPrimitive),Ct(s.size===3||s.size===4);const{data:n,size:o}=s,a=t.length;let l=o*r[this._numIndexPerPrimitive*t[0]];mw.clear(),mw.push(l),this.bbMin=Ze(n[l],n[l+1],n[l+2]),this.bbMax=Rn(this.bbMin);for(let h=0;h<a;++h){const p=this._numIndexPerPrimitive*t[h];for(let f=0;f<this._numIndexPerPrimitive;++f){l=o*r[p+f],mw.push(l);let m=n[l];this.bbMin[0]=Math.min(m,this.bbMin[0]),this.bbMax[0]=Math.max(m,this.bbMax[0]),m=n[l+1],this.bbMin[1]=Math.min(m,this.bbMin[1]),this.bbMax[1]=Math.max(m,this.bbMax[1]),m=n[l+2],this.bbMin[2]=Math.min(m,this.bbMin[2]),this.bbMax[2]=Math.max(m,this.bbMax[2])}}Pn(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let c=this.radius*this.radius;for(let h=0;h<mw.length;++h){l=mw.getItemAt(h);const p=n[l]-this.center[0],f=n[l+1]-this.center[1],m=n[l+2]-this.center[2],g=p*p+f*f+m*m;if(g<=c)continue;const y=Math.sqrt(g),x=.5*(y-this.radius);this.radius=this.radius+x,c=this.radius*this.radius;const b=x/y;this.center[0]+=p*b,this.center[1]+=f*b,this.center[2]+=m*b}mw.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(uo(this.bbMin,this.bbMax)>1){const t=Pn($(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<i;++c){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[p],m=n[f],g=n[f+1],y=n[f+2];for(let x=1;x<this._numIndexPerPrimitive;++x){f=o*this.indices[p+x];const b=n[f],S=n[f+1],T=n[f+2];b<m&&(m=b),S<g&&(g=S),T<y&&(y=T)}m<t[0]&&(h|=1),g<t[1]&&(h|=2),y<t[2]&&(h|=4),r[c]=h,++s[h]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<i;++c){const h=r[c];l[h][s[h]++]=this.primitiveIndices[c]}this._children=new Array(8);for(let c=0;c<8;++c)l[c]!==void 0&&(this._children[c]=new g6(l[c],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){mw.prune()}}const mw=new ai({deallocator:null});class NL{constructor(){this.id=Dc()}unload(){}}var um;(function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Geometry=2]="Geometry",e[e.Material=3]="Material",e[e.Texture=4]="Texture",e[e.COUNT=5]="COUNT"})(um||(um={}));function ghe(e,t,i){const r=t[0]-e[0],s=t[1]-e[1],n=i[0]-e[0],o=i[1]-e[1];return .5*Math.abs(r*o-s*n)}function hat(e,t,i){return xe(lj,t,e),xe(yhe,i,e),Ue(Tt(lj,lj,yhe))/2}new $v(dy);new $v(()=>({p0:null,p1:null,p2:null}));const lj=$(),yhe=$();let O1=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const EAe=new Uint16Array([0]),Az=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function CM(e){if(e===1)return EAe;if(e<Az.length)return new Uint16Array(Az.buffer,0,e);if(e>O1.length){const t=Math.max(2*O1.length,e);O1=new Uint32Array(t);for(let i=0;i<O1.length;i++)O1[i]=i}return new Uint32Array(O1.buffer,0,e)}function _5t(e){if(e===1)return new Uint16Array(EAe);if(e<Az.length)return new Uint16Array(Az.slice(0,e));if(e>O1.length){const t=new Uint32Array(e);for(let i=0;i<t.length;i++)t[i]=i;return t}return new Uint32Array(O1.slice(0,e))}function CAe(e,t,i){if(!e)return!1;const{size:r,data:s}=e;he(i,0,0,0),he(Xd,0,0,0);let n=0,o=0;for(let a=0;a<t.length-2;a+=3){const l=t[a+0]*r,c=t[a+1]*r,h=t[a+2]*r;he(Ro,s[l+0],s[l+1],s[l+2]),he(U0,s[c+0],s[c+1],s[c+2]),he(MN,s[h+0],s[h+1],s[h+2]);const p=hat(Ro,U0,MN);p?(we(Ro,Ro,U0),we(Ro,Ro,MN),fe(Ro,Ro,1/3*p),we(i,i,Ro),n+=p):(we(Xd,Xd,Ro),we(Xd,Xd,U0),we(Xd,Xd,MN),o+=3)}return(o!==0||n!==0)&&(n!==0?(fe(i,i,1/n),!0):o!==0&&(fe(i,Xd,1/o),!0))}function AAe(e,t,i){if(!e||!t)return!1;const{size:r,data:s}=e;he(i,0,0,0);let n=-1,o=0;for(let a=0;a<t.length;a++){const l=t[a]*r;n!==l&&(i[0]+=s[l+0],i[1]+=s[l+1],i[2]+=s[l+2],o++),n=l}return o>1&&fe(i,i,1/o),o>0}function xie(e,t,i,r){if(!e)return!1;const{size:s,data:n}=e;he(r,0,0,0),he(Xd,0,0,0);let o=0,a=0;const l=t?t.length-1:n.length/s-1,c=l+(i?2:0);for(let h=0;h<c;h+=2){const p=h<l?h:l,f=h<l?h+1:0,m=(t?t[p]:p)*s,g=(t?t[f]:f)*s;Ro[0]=n[m+0],Ro[1]=n[m+1],Ro[2]=n[m+2],U0[0]=n[g+0],U0[1]=n[g+1],U0[2]=n[g+2],fe(Ro,we(Ro,Ro,U0),.5);const y=wQ(Ro,U0);y>0?(we(r,r,fe(Ro,Ro,y)),o+=y):(we(Xd,Xd,Ro),a++)}return o!==0?(fe(r,r,1/o),!0):a!==0&&(fe(r,Xd,1/a),!0)}const Ro=$(),U0=$(),MN=$(),Xd=$();class vs extends NL{constructor(t,i=[],r=kc.Triangle,s=-1){super(),this._primitiveType=r,this.edgeIndicesLength=s,this.type=um.Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[n,o]of t)o&&this._vertexAttributes.set(n,F({},o));if(i==null||i.length===0){const n=dat(this._vertexAttributes),o=CM(n);this.edgeIndicesLength=this.edgeIndicesLength<0?n:this.edgeIndicesLength;for(const a of this._vertexAttributes.keys())this._indices.set(a,o)}else for(const[n,o]of i)o&&(this._indices.set(n,pat(o)),n===P.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(n).length:this.edgeIndicesLength))}cloneShallow(){const t=new vs([],void 0,this._primitiveType,void 0),{_vertexAttributes:i,_indices:r}=t;return this._vertexAttributes.forEach((s,n)=>{i.set(n,s)}),this._indices.forEach((s,n)=>{r.set(n,s)}),t.screenToWorldRatio=this.screenToWorldRatio,t._boundingInfo=this._boundingInfo,t}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(t){const i=this._vertexAttributes.get(t);return i&&!i.exclusive&&(i.data=Array.from(i.data),i.exclusive=!0),i}get indices(){return this._indices}get indexCount(){const t=this._indices.values().next().value;return t?t.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return M(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return this.primitiveType===kc.Triangle?this._computeAttachmentOriginTriangles(t):this._computeAttachmentOriginPoints(t)}_computeAttachmentOriginTriangles(t){const i=this.indices.get(P.POSITION),r=this.vertexAttributes.get(P.POSITION);return CAe(r,i,t)}_computeAttachmentOriginPoints(t){const i=this.indices.get(P.POSITION),r=this.vertexAttributes.get(P.POSITION);return AAe(r,i,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.indices.get(P.POSITION);if(t.length===0)return null;const i=this.primitiveType===kc.Triangle?3:1;Ct(t.length%i==0,"Indexing error: "+t.length+" not divisible by "+i);const r=CM(t.length/i),s=this.vertexAttributes.get(P.POSITION);return new g6(r,i,t,s)}}function dat(e){const t=e.values().next().value;return t==null?0:t.data.length/t.size}function pat(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}const F2=IY;var cj,uj,hj,$Y;(function(e){const i=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],s=[0,0,1,0,1,1,0,1],n=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),o=new Uint16Array(36);for(let c=0;c<6;c++)for(let h=0;h<6;h++)o[6*c+h]=c;const a=new Uint16Array(36);for(let c=0;c<6;c++)a[6*c+0]=0,a[6*c+1]=1,a[6*c+2]=2,a[6*c+3]=2,a[6*c+4]=3,a[6*c+5]=0;function l(c){Array.isArray(c)||(c=[c,c,c]);const h=new Array(24);for(let p=0;p<8;p++)h[3*p]=i[p][0]*c[0],h[3*p+1]=i[p][1]*c[1],h[3*p+2]=i[p][2]*c[2];return new vs([[P.POSITION,{size:3,data:h,exclusive:!0}],[P.NORMAL,{size:3,data:r}],[P.UV0,{size:2,data:s}]],[[P.POSITION,n],[P.NORMAL,o],[P.UV0,a]])}e.createGeometry=l})(cj||(cj={})),function(e){const i=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],s=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),n=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);function o(a){Array.isArray(a)||(a=[a,a,a]);const l=new Array(18);for(let c=0;c<6;c++)l[3*c]=i[c][0]*a[0],l[3*c+1]=i[c][1]*a[1],l[3*c+2]=i[c][2]*a[2];return new vs([[P.POSITION,{size:3,data:l,exclusive:!0}],[P.NORMAL,{size:3,data:r}]],[[P.POSITION,s],[P.NORMAL,n]])}e.createGeometry=o}(uj||(uj={})),function(e){const r=Ki(-.5,0,-.5),s=Ki(.5,0,-.5),n=Ki(0,0,.5),o=Ki(0,0+.5,0),a=Xi(),l=Xi(),c=Xi(),h=Xi(),p=Xi();xe(a,r,o),xe(l,r,s),Tt(c,a,l),Re(c,c),xe(a,s,o),xe(l,s,n),Tt(h,a,l),Re(h,h),xe(a,n,o),xe(l,n,r),Tt(p,a,l),Re(p,p);const f=[r,s,n,o],m=[0,-1,0,c[0],c[1],c[2],h[0],h[1],h[2],p[0],p[1],p[2]],g=[0,1,2,3,1,0,3,2,1,3,0,2],y=[0,0,0,1,1,1,2,2,2,3,3,3];function x(b){Array.isArray(b)||(b=[b,b,b]);const S=new Array(12);for(let T=0;T<4;T++)S[3*T]=f[T][0]*b[0],S[3*T+1]=f[T][1]*b[1],S[3*T+2]=f[T][2]*b[2];return new vs([[P.POSITION,{size:3,data:S,exclusive:!0}],[P.NORMAL,{size:3,data:m}]],[[P.POSITION,new Uint16Array(g)],[P.NORMAL,new Uint16Array(y)]])}e.createGeometry=x}(hj||(hj={})),function(e){function t(T,C,A,O={uv:!0}){const D=-Math.PI,U=2*Math.PI,k=-Math.PI/2,B=Math.PI,j=Math.max(3,Math.floor(C)),H=Math.max(2,Math.floor(A)),K=(j+1)*(H+1),ee=new Float32Array(3*K),ce=new Float32Array(3*K),le=new Float32Array(2*K),z=[];let q=0;for(let se=0;se<=H;se++){const J=[],ae=se/H,_e=k+ae*B,Oe=Math.cos(_e);for(let Be=0;Be<=j;Be++){const Se=Be/j,Te=D+Se*U,Ie=Math.cos(Te)*Oe,Ve=Math.sin(_e),Ni=-Math.sin(Te)*Oe;ee[3*q]=Ie*T,ee[3*q+1]=Ve*T,ee[3*q+2]=Ni*T,ce[3*q]=Ie,ce[3*q+1]=Ve,ce[3*q+2]=Ni,le[2*q]=Se,le[2*q+1]=ae,J.push(q),++q}z.push(J)}const Z=new Uint32Array(2*j*(H-1)*3);q=0;for(let se=0;se<H;se++)for(let J=0;J<j;J++){const ae=z[se][J],_e=z[se][J+1],Oe=z[se+1][J+1],Be=z[se+1][J];se===0?(Z[q++]=ae,Z[q++]=Oe,Z[q++]=Be):se===H-1?(Z[q++]=ae,Z[q++]=_e,Z[q++]=Oe):(Z[q++]=ae,Z[q++]=_e,Z[q++]=Oe,Z[q++]=Oe,Z[q++]=Be,Z[q++]=ae)}const Y=[[P.POSITION,Z],[P.NORMAL,Z]],te=[[P.POSITION,{size:3,data:ee,exclusive:!0}],[P.NORMAL,{size:3,data:ce,exclusive:!0}]];return O.uv&&(te.push([P.UV0,{size:2,data:le,exclusive:!0}]),Y.push([P.UV0,Z])),O.offset&&(Y[0][0]=P.OFFSET,te[0][0]=P.OFFSET,Y.push([P.POSITION,new Uint32Array(Z.length)]),te.push([P.POSITION,{size:3,data:Float64Array.from(O.offset),exclusive:!0}])),new vs(te,Y)}function i(T,C,A){const O=T;let D,U;if(A)D=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],U=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const ee=O*(1+Math.sqrt(5))/2;D=[-O,ee,0,O,ee,0,-O,-ee,0,O,-ee,0,0,-O,ee,0,O,ee,0,-O,-ee,0,O,-ee,ee,0,-O,ee,0,O,-ee,0,-O,-ee,0,O],U=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let ee=0;ee<D.length;ee+=3)F2.scale(D,ee,T/F2.length(D,ee));let k={};function B(ee,ce){ee>ce&&([ee,ce]=[ce,ee]);const le=ee.toString()+"."+ce.toString();if(k[le])return k[le];let z=D.length;return D.length+=3,F2.add(D,3*ee,D,3*ce,D,z),F2.scale(D,z,T/F2.length(D,z)),z/=3,k[le]=z,z}for(let ee=0;ee<C;ee++){const ce=U.length,le=new Uint32Array(4*ce);for(let z=0;z<ce;z+=3){const q=U[z],Z=U[z+1],Y=U[z+2],te=B(q,Z),se=B(Z,Y),J=B(Y,q),ae=4*z;le[ae]=q,le[ae+1]=te,le[ae+2]=J,le[ae+3]=Z,le[ae+4]=se,le[ae+5]=te,le[ae+6]=Y,le[ae+7]=J,le[ae+8]=se,le[ae+9]=te,le[ae+10]=se,le[ae+11]=J}U=le,k={}}const j=new Float32Array(D);for(let ee=0;ee<j.length;ee+=3)F2.normalize(j,ee);const H=[[P.POSITION,U],[P.NORMAL,U]],K=[[P.POSITION,{size:3,data:new Float32Array(D),exclusive:!0}],[P.NORMAL,{size:3,data:j,exclusive:!0}]];return new vs(K,H)}function r(T,C,A,O,D,U,k){const B=C?[C[0],C[1],C[2]]:[0,0,0],j=T?[T[0],T[1],T[2]]:[0,0,1];U=U||[0,0];const H=A?[255*A[0],255*A[1],255*A[2],A.length>3?255*A[3]:255]:[255,255,255,255],K=O!=null&&O.length===2?O:[1,1],ee=[[P.POSITION,{size:3,data:B,exclusive:!0}],[P.NORMAL,{size:3,data:j,exclusive:!0}],[P.UV0,{size:U.length,data:U}],[P.COLOR,{size:4,data:H,exclusive:!0}],[P.SIZE,{size:2,data:K}]];if(D!=null){const ce=new Float32Array([D[0],D[1],D[2],D[3]]);ee.push([P.AUXPOS1,{size:4,data:ce}])}if(k!=null){const ce=new Float32Array([k[0],k[1],k[2],k[3]]);ee.push([P.AUXPOS2,{size:4,data:ce}])}return new vs(ee,null,kc.Point)}function s(T,C,A,O,D,U,k,B){if(T!=null){const{data:j}=B.getMutableAttribute(P.NORMAL);j[0]=T[0],j[1]=T[1],j[2]=T[2]}if(C!=null){const{data:j}=B.getMutableAttribute(P.POSITION);j[0]=C[0],j[1]=C[1],j[2]=C[2]}if(A!=null){const{data:j}=B.getMutableAttribute(P.COLOR);j[0]=A[0],j[1]=A[1],j[2]=A[2],j[3]=A[3]}if(O!=null){const{data:j}=B.getMutableAttribute(P.SIZE);j[0]=O[0],j[1]=O[1]}if(D!=null){const{data:j}=B.getMutableAttribute(P.AUXPOS1);j[0]=D[0],j[1]=D[1],j[2]=D[2],j[3]=D[3]}if(U!=null){const{data:j}=B.getMutableAttribute(P.UV0);j[0]=U[0],j[1]=U[1]}if(k!=null){const{data:j}=B.getMutableAttribute(P.AUXPOS2);j[0]=k[0],j[1]=k[1],j[2]=k[2],j[3]=k[3]}}function n(T,C){const A=new Float32Array(3*T.length),O=new Float32Array(C?3*T.length:3),D=new Uint32Array(T.length),U=new Uint32Array(T.length);for(let H=0;H<T.length;H++)A[3*H]=T[H][0],A[3*H+1]=T[H][1],A[3*H+2]=T[H][2],C&&(O[3*H]=C[H][0],O[3*H+1]=C[H][1],O[3*H+2]=C[H][2]),D[H]=H,U[H]=0;C||(O[0]=0,O[1]=1,O[2]=0);const k=[0,0],B=[[P.POSITION,D],[P.NORMAL,C?D:U],[P.UV0,U]],j=[[P.POSITION,{size:3,data:A,exclusive:!0}],[P.NORMAL,{size:3,data:O,exclusive:!0}],[P.UV0,{size:2,data:k,exclusive:!0}]];return new vs(j,B,kc.Point)}function o(){const T=[0,0,0,0,0,100,100,0,0],C=new Uint16Array([0,1,2]),A=[0,1,0],O=new Uint16Array([0,0,0]),D=[0,0],U=new Uint16Array([0,0,0]),k=[[P.POSITION,C],[P.NORMAL,O],[P.UV0,U]],B=[[P.POSITION,{size:3,data:T,exclusive:!0}],[P.NORMAL,{size:3,data:A,exclusive:!0}],[P.UV0,{size:2,data:D,exclusive:!0}]];return new vs(B,k)}e.createBoxGeometry=cj.createGeometry,e.createDiamondGeometry=uj.createGeometry,e.createTetrahedronGeometry=hj.createGeometry,e.createSphereGeometry=t,e.createPolySphereGeometry=i,e.createPointGeometry=r,e.updatePointGeometry=s,e.createPointArrayGeometry=n,e.createTriangleGeometry=o;const a=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function l(T=a){const C=new Array(12);for(let H=0;H<4;H++)for(let K=0;K<3;K++)C[3*H+K]=T[H][K];const A=new Uint32Array([0,1,2,2,3,0]),O=[0,0,1],D=new Uint32Array([0,0,0,0,0,0]),U=[0,0,1,0,1,1,0,1],k=[255,255,255,255],B=[[P.POSITION,A],[P.NORMAL,D],[P.UV0,A],[P.COLOR,D]],j=[[P.POSITION,{size:3,data:C,exclusive:!0}],[P.NORMAL,{size:3,data:O,exclusive:!0}],[P.UV0,{size:2,data:U,exclusive:!0}],[P.COLOR,{size:4,data:k,exclusive:!0}]];return new vs(j,B)}function c(T,C,A,O,D=!0,U=!0){let k=0;const B=C,j=T;let H=Ki(0,k,0),K=Ki(0,k+j,0),ee=Ki(0,-1,0),ce=Ki(0,1,0);O&&(k=j,K=Ki(0,0,0),H=Ki(0,k,0),ee=Ki(0,1,0),ce=Ki(0,-1,0));const le=[K,H],z=[ee,ce],q=A+2,Z=Math.sqrt(j*j+B*B);if(O)for(let Se=A-1;Se>=0;Se--){const Te=Se*(2*Math.PI/A),Ie=Ki(Math.cos(Te)*B,k,Math.sin(Te)*B);le.push(Ie);const Ve=Ki(j*Math.cos(Te)/Z,-B/Z,j*Math.sin(Te)/Z);z.push(Ve)}else for(let Se=0;Se<A;Se++){const Te=Se*(2*Math.PI/A),Ie=Ki(Math.cos(Te)*B,k,Math.sin(Te)*B);le.push(Ie);const Ve=Ki(j*Math.cos(Te)/Z,B/Z,j*Math.sin(Te)/Z);z.push(Ve)}const Y=new Uint32Array(2*(A+2)*3),te=new Uint32Array(2*(A+2)*3);let se=0,J=0;if(D){for(let Se=3;Se<le.length;Se++)Y[se++]=1,Y[se++]=Se-1,Y[se++]=Se,te[J++]=0,te[J++]=0,te[J++]=0;Y[se++]=le.length-1,Y[se++]=2,Y[se++]=1,te[J++]=0,te[J++]=0,te[J++]=0}if(U){for(let Se=3;Se<le.length;Se++)Y[se++]=Se,Y[se++]=Se-1,Y[se++]=0,te[J++]=Se,te[J++]=Se-1,te[J++]=1;Y[se++]=0,Y[se++]=2,Y[se++]=le.length-1,te[J++]=1,te[J++]=2,te[J++]=z.length-1}const ae=new Float32Array(3*q);for(let Se=0;Se<q;Se++)ae[3*Se]=le[Se][0],ae[3*Se+1]=le[Se][1],ae[3*Se+2]=le[Se][2];const _e=new Float32Array(3*q);for(let Se=0;Se<q;Se++)_e[3*Se]=z[Se][0],_e[3*Se+1]=z[Se][1],_e[3*Se+2]=z[Se][2];const Oe=[[P.POSITION,Y],[P.NORMAL,te]],Be=[[P.POSITION,{size:3,data:ae,exclusive:!0}],[P.NORMAL,{size:3,data:_e,exclusive:!0}]];return new vs(Be,Oe)}function h(T,C,A,O,D,U){const k=O?Tz(O):Ki(1,0,0),B=D?Tz(D):Ki(0,0,0);U=U==null||U;const j=Xi();Re(j,k);const H=Xi();fe(H,j,Math.abs(T));const K=Xi();fe(K,H,-.5),we(K,K,B);const ee=Ki(0,1,0);Math.abs(1-Pe(j,ee))<.2&&he(ee,0,0,1);const ce=Xi();Tt(ce,j,ee),Re(ce,ce),Tt(ee,ce,j);const le=2*A+(U?2:0),z=A+(U?2:0),q=new Float32Array(3*le),Z=new Float32Array(3*z),Y=new Float32Array(2*le),te=new Uint32Array(3*A*(U?4:2)),se=new Uint32Array(3*A*(U?4:2));U&&(q[3*(le-2)+0]=K[0],q[3*(le-2)+1]=K[1],q[3*(le-2)+2]=K[2],Y[2*(le-2)]=0,Y[2*(le-2)+1]=0,q[3*(le-1)+0]=q[3*(le-2)+0]+H[0],q[3*(le-1)+1]=q[3*(le-2)+1]+H[1],q[3*(le-1)+2]=q[3*(le-2)+2]+H[2],Y[2*(le-1)]=1,Y[2*(le-1)+1]=1,Z[3*(z-2)+0]=-j[0],Z[3*(z-2)+1]=-j[1],Z[3*(z-2)+2]=-j[2],Z[3*(z-1)+0]=j[0],Z[3*(z-1)+1]=j[1],Z[3*(z-1)+2]=j[2]);const J=(Te,Ie,Ve)=>{te[Te]=Ie,se[Te]=Ve};let ae=0;const _e=Xi(),Oe=Xi();for(let Te=0;Te<A;Te++){const Ie=Te*(2*Math.PI/A);fe(_e,ee,Math.sin(Ie)),fe(Oe,ce,Math.cos(Ie)),we(_e,_e,Oe),Z[3*Te+0]=_e[0],Z[3*Te+1]=_e[1],Z[3*Te+2]=_e[2],fe(_e,_e,C),we(_e,_e,K),q[3*Te+0]=_e[0],q[3*Te+1]=_e[1],q[3*Te+2]=_e[2],Y[2*Te+0]=Te/A,Y[2*Te+1]=0,q[3*(Te+A)+0]=q[3*Te+0]+H[0],q[3*(Te+A)+1]=q[3*Te+1]+H[1],q[3*(Te+A)+2]=q[3*Te+2]+H[2],Y[2*(Te+A)+0]=Te/A,Y[2*Te+1]=1;const Ve=(Te+1)%A;J(ae++,Te,Te),J(ae++,Te+A,Te),J(ae++,Ve,Ve),J(ae++,Ve,Ve),J(ae++,Te+A,Te),J(ae++,Ve+A,Ve)}if(U){for(let Te=0;Te<A;Te++){const Ie=(Te+1)%A;J(ae++,le-2,z-2),J(ae++,Te,z-2),J(ae++,Ie,z-2)}for(let Te=0;Te<A;Te++){const Ie=(Te+1)%A;J(ae++,Te+A,z-1),J(ae++,le-1,z-1),J(ae++,Ie+A,z-1)}}const Be=[[P.POSITION,te],[P.NORMAL,se],[P.UV0,te]],Se=[[P.POSITION,{size:3,data:q,exclusive:!0}],[P.NORMAL,{size:3,data:Z,exclusive:!0}],[P.UV0,{size:2,data:Y,exclusive:!0}]];return new vs(Se,Be)}function p(T,C,A,O,D){A=A||10,O=O==null||O,Ct(T.length>1);const U=[[0,0,0]],k=[],B=[];for(let j=0;j<A;j++){k.push([0,-j-1,-(j+1)%A-1]);const H=j/A*2*Math.PI;B.push([Math.cos(H)*C,Math.sin(H)*C])}return e.createPathExtrusionGeometry(B,T,U,k,O,D)}function f(T,C,A,O,D,U=Ki(0,0,0)){const k=T.length,B=new Float32Array(C.length*k*3+(6*A.length||0)),j=new Float32Array(C.length*k*3+(A?6:0)),H=(C.length-1)*k*6+3*O.length*2,K=new Uint32Array(H),ee=new Uint32Array(H);let ce=0,le=0,z=0,q=0;const Z=Xi(),Y=Xi(),te=Xi(),se=Xi(),J=Xi(),ae=Xi(),_e=Xi(),Oe=$(),Be=Xi(),Se=Xi(),Te=Xi(),Ie=Xi(),Ve=Xi(),Ni=qi();he(Be,0,1,0),xe(Y,C[1],C[0]),Re(Y,Y),D?(we(Oe,C[0],U),Re(te,Oe)):he(te,0,0,1),S(Y,te,Be,Be,J,te,vhe),pe(se,te),pe(Ie,J);for(let ot=0;ot<A.length;ot++)fe(ae,J,A[ot][0]),fe(Oe,te,A[ot][2]),we(ae,ae,Oe),we(ae,ae,C[0]),B[ce++]=ae[0],B[ce++]=ae[1],B[ce++]=ae[2];j[le++]=-Y[0],j[le++]=-Y[1],j[le++]=-Y[2];for(let ot=0;ot<O.length;ot++)K[z++]=O[ot][0]>0?O[ot][0]:-O[ot][0]-1+A.length,K[z++]=O[ot][1]>0?O[ot][1]:-O[ot][1]-1+A.length,K[z++]=O[ot][2]>0?O[ot][2]:-O[ot][2]-1+A.length,ee[q++]=0,ee[q++]=0,ee[q++]=0;let Fi=A.length;const hi=A.length-1;for(let ot=0;ot<C.length;ot++){let cr=!1;ot>0&&(pe(Z,Y),ot<C.length-1?(xe(Y,C[ot+1],C[ot]),Re(Y,Y)):cr=!0,we(Se,Z,Y),Re(Se,Se),we(Te,C[ot-1],se),iM(C[ot],Se,Ni),t2(Ni,od(Te,Z),Oe)?(xe(Oe,Oe,C[ot]),Re(te,Oe),Tt(J,Se,te),Re(J,J)):S(Se,se,Ie,Be,J,te,vhe),pe(se,te),pe(Ie,J)),D&&(we(Oe,C[ot],U),Re(Ve,Oe));for(let en=0;en<k;en++)if(fe(ae,J,T[en][0]),fe(Oe,te,T[en][1]),we(ae,ae,Oe),Re(_e,ae),j[le++]=_e[0],j[le++]=_e[1],j[le++]=_e[2],we(ae,ae,C[ot]),B[ce++]=ae[0],B[ce++]=ae[1],B[ce++]=ae[2],!cr){const mo=(en+1)%k;K[z++]=Fi+en,K[z++]=Fi+k+en,K[z++]=Fi+mo,K[z++]=Fi+mo,K[z++]=Fi+k+en,K[z++]=Fi+k+mo;for(let Fn=0;Fn<6;Fn++)ee[q++]=K[z-6+Fn]-hi}Fi+=k}const Vi=C[C.length-1];for(let ot=0;ot<A.length;ot++)fe(ae,J,A[ot][0]),fe(Oe,te,A[ot][1]),we(ae,ae,Oe),we(ae,ae,Vi),B[ce++]=ae[0],B[ce++]=ae[1],B[ce++]=ae[2];const di=le/3;j[le++]=Y[0],j[le++]=Y[1],j[le++]=Y[2];const ki=Fi-k;for(let ot=0;ot<O.length;ot++)K[z++]=O[ot][0]>=0?Fi+O[ot][0]:-O[ot][0]-1+ki,K[z++]=O[ot][2]>=0?Fi+O[ot][2]:-O[ot][2]-1+ki,K[z++]=O[ot][1]>=0?Fi+O[ot][1]:-O[ot][1]-1+ki,ee[q++]=di,ee[q++]=di,ee[q++]=di;const kr=[[P.POSITION,K],[P.NORMAL,ee]],us=[[P.POSITION,{size:3,data:B,exclusive:!0}],[P.NORMAL,{size:3,data:j,exclusive:!0}]];return new vs(us,kr)}function m(T,C,A){Ct(T.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Ct(T[0].length===3,"createPolylineGeometry(): malformed vertex"),Ct(C==null||C.length===T.length,"createPolylineGeometry: need same number of points and normals"),Ct(C==null||C[0].length===3,"createPolylineGeometry(): malformed normal");const O=new Float64Array(3*T.length),D=new Uint32Array(2*(T.length-1));let U=0,k=0;for(let H=0;H<T.length;H++){for(let K=0;K<3;K++)O[U++]=T[H][K];H>0&&(D[k++]=H-1,D[k++]=H)}const B=[],j=[];if(B.push([P.POSITION,D]),j.push([P.POSITION,{size:3,data:O,exclusive:!0}]),C){const H=new Float32Array(3*C.length);let K=0;for(let ee=0;ee<T.length;ee++)for(let ce=0;ce<3;ce++)H[K++]=C[ee][ce];B.push([P.NORMAL,D]),j.push([P.NORMAL,{size:3,data:H,exclusive:!0}])}return A&&(j.push([P.COLOR,{size:4,data:A}]),B.push([P.COLOR,CM(A.length/4)])),new vs(j,B,kc.Line)}function g(T,C,A,O,D=0){const U=new Array(18),k=[[-C,D,O/2],[A,D,O/2],[0,T+D,O/2],[-C,D,-O/2],[A,D,-O/2],[0,T+D,-O/2]],B=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let j=0;j<6;j++)U[3*j]=k[j][0],U[3*j+1]=k[j][1],U[3*j+2]=k[j][2];return new vs([[P.POSITION,{size:3,data:U,exclusive:!0}]],[[P.POSITION,B]])}function y(T,C){const A=T.getMutableAttribute(P.POSITION).data;for(let O=0;O<A.length;O+=3){const D=A[O],U=A[O+1],k=A[O+2];he(k2,D,U,k),Xe(k2,k2,C),A[O]=k2[0],A[O+1]=k2[1],A[O+2]=k2[2]}}function x(T,C=T){const A=T.vertexAttributes,O=A.get(P.POSITION).data,D=A.get(P.NORMAL).data;if(D){const U=C.getMutableAttribute(P.NORMAL).data;for(let k=0;k<D.length;k+=3){const B=D[k+1];U[k+1]=-D[k+2],U[k+2]=B}}if(O){const U=C.getMutableAttribute(P.POSITION).data;for(let k=0;k<O.length;k+=3){const B=O[k+1];U[k+1]=-O[k+2],U[k+2]=B}}return C}function b(T,C,A,O,D){return!(Math.abs(Pe(C,T))>D)&&(Tt(A,T,C),Re(A,A),Tt(O,A,T),Re(O,O),!0)}function S(T,C,A,O,D,U,k){return b(T,C,D,U,k)||b(T,A,D,U,k)||b(T,O,D,U,k)}e.createSquareGeometry=l,e.createConeGeometry=c,e.createCylinderGeometry=h,e.createTubeGeometry=p,e.createPathExtrusionGeometry=f,e.createPolylineGeometry=m,e.createExtrudedTriangle=g,e.transformInPlace=y,e.cgToGIS=x,e.makeOrthoBasisDirUp=b,e.makeOrthoBasisDirUpFallback=S}($Y||($Y={}));const vhe=.99619469809,k2=Xi(),vu=$Y,fat=ve.getLogger("esri.views.3d.environment.PanoramicAtmosphere");class mat{constructor(){this.type="panoramic",this._techniqueConfig=new Ez,this._passParameters=new vie,this._readyResolver=rm(),this._readyController=new AbortController}destroy(){this._readyResolver.reject(),this._passParameters.texture=ht(this._passParameters.texture),this._vao=ht(this._vao),this._readyController=Wn(this._readyController)}when(){return this._readyResolver.promise}initializeRenderContext(t){this._techniqueConfig.geometry=iy.Cylinder,this._technique=t.shaderTechniqueRepository.acquire(_M,this._techniqueConfig);const i=t.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=ka(this._vao,"geometry"),lm(wAe,{signal:this._readyController.signal}).then(r=>{this._passParameters.texture=new _t(i,{pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:gt.LINEAR,flipped:!0},r),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}).catch(r=>{as(r)||fat.error("Unable to initialize atmosphere: image request failed",r),this._readyResolver.reject()})}get canRender(){return this._passParameters.texture!=null}render(t){const i=t.rctx,r=i.bindTechnique(this._technique,this._passParameters,t.bindParameters);gat(_he,t.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",_he),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Wt.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(t){const i=vu.createPolySphereGeometry(1,2,!1),r=i.indices.get(P.POSITION);for(let a=0;a<r.length;a+=3){const l=r[a];r[a]=r[a+2],r[a+2]=l}const s=i.vertexAttributes.get(P.POSITION).data,n=bhe.createBuffer(r.length),o=n.position;for(let a=0;a<r.length;++a){const l=3*r[a];o.set(a,0,s[l]),o.set(a,1,s[l+1]),o.set(a,2,s[l+2])}return new Ln(t,lr,{geometry:Xu(bhe)},{geometry:Ci.createVertex(t,Wi.STATIC_DRAW,n.buffer)})}}function gat(e,t){ln(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}const _he=Ne(),bhe=Bs().vec3f(P.POSITION);var Fb;(function(e){e[e.Rain=0]="Rain",e[e.Snow=1]="Snow",e[e.COUNT=2]="COUNT"})(Fb||(Fb={}));class LY extends Xl{constructor(){super(...arguments),this.type=Fb.Rain}}u([Q({count:Fb.COUNT})],LY.prototype,"type",void 0);function yat(e){const t=new mr;return t.attributes.add(P.POSITION,"vec3"),t.attributes.add(P.INSTANCEFEATUREATTRIBUTE,"float"),t.vertex.uniforms.add(new Lc("cameraPosition")),t.vertex.uniforms.add(new Lc("offset")),t.vertex.uniforms.add(new nr("width")),t.vertex.uniforms.add(new Xr("proj",(i,r)=>r.camera.projectionMatrix)),t.vertex.uniforms.add(new Ib("view")),t.vertex.uniforms.add(new nr("time")),t.varyings.add("vUv","vec2"),t.vertex.code.add(E`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${e.type===Fb.Rain?E`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:E`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),t.fragment.uniforms.add(new nr("opacity")),t.fragment.uniforms.add(new Lc("particleColor")),t.fragment.code.add(E`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${e.type===Fb.Rain?E`d = 0.35 * smoothstep(0.5, 0.0, d);`:E`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),t}const vat=Object.freeze(Object.defineProperty({__proto__:null,build:yat},Symbol.toStringTag,{value:"Module"}));class _at extends Nn{constructor(){super(...arguments),this.time=0,this.radius=1}}class G0 extends Lr{initializeProgram(t){const i=G0.shader.get().build(this.configuration);return new Er(t.rctx,i,G0.attributeLocation)}initializePipeline(){return ri({blending:ba(ke.ONE,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),depthTest:{func:Fr.LEQUAL},colorWrite:xi})}}G0.shader=new Sr(vat,()=>import("./Precipitation.glsl.d967a845.js")),G0.attributeLocation=new Map([[P.POSITION,0],[P.INSTANCEFEATUREATTRIBUTE,1]]);class MAe{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance(t){return _(t.forcedTime)?this._time!==t.forcedTime&&(this._time=t.forcedTime,!0):!(!this.enabled||t.dt===0)&&(this._time+=t.dt,!0)}}let Rx=class extends Ee{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._opacity=1,this._width=500,this._offset=$(),this._tile=$(),this._particleColor=Xi(),this._particleColorAtNight=Xi(),this._nightMultiplier=.7,this._cameraDirection=Xi(),this._renderParameters=new _at,this._animation=new MAe,this._updatingTracking=new Lg,this._renderParameters.time=0,this._renderParameters.radius=Ri(e.view.spatialReference).radius,this._shaderTechniqueRepository=e.context.shaderTechniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechnique=br(this._snowTechnique),this._rainTechnique=br(this._rainTechnique),this._vao=ht(this._vao),this._instanceIdBuffer=ht(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get rainTechnique(){if(M(this._rainTechnique)){const e=new LY;e.type=Fb.Rain,this._rainTechnique=this._shaderTechniqueRepository.acquire(G0,e)}return this._rainTechnique}get snowTechnique(){if(M(this._snowTechnique)){const e=new LY;e.type=Fb.Snow,this._snowTechnique=this._shaderTechniqueRepository.acquire(G0,e)}return this._snowTechnique}update(e){return this._animation.advance(e)}render(e,t,i){const r=i==="rainy",s=r?this.rainTechnique:this.snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),M(s)||M(this._vao)||M(this._instanceIdBuffer)||(_(e.bindParameters.clouds.data)&&(this._opacity=1-e.bindParameters.clouds.fadeInOutHeight.factor),this._opacity<=0))return;const o=.35;t=t<.5?ui(0,o,2*t):ui(o,1,2*(t-.5));const a=n.bindTechnique(s);this._renderParameters.camera=e.bindParameters.camera,this._renderParameters.time=(r?this._rainSpeed:this._snowSpeed)*FQ(this._animation.time),this._renderParameters.time=this._renderParameters.time%1e5,this._update(a,i,e),n.bindVAO(this._vao);const l=G0.attributeLocation;a.assertCompatibleVertexAttributeLocations(this._vao),Kte(n,l,this._instanceIdBuffer,whe,0),n.capabilities.instancing.drawArraysInstanced(Wt.TRIANGLES,0,3,this._numParticles*t),eie(n,l,this._instanceIdBuffer,whe)}_update(e,t,i){const r=i.bindParameters.camera,s=r.eye;this._tile[0]=Math.floor((s[0]+.5*this._width)/this._width),this._tile[1]=Math.floor((s[1]+.5*this._width)/this._width),this._tile[2]=Math.floor((s[2]+.5*this._width)/this._width),this._offset[0]=s[0]-this._tile[0]*this._width,this._offset[1]=s[1]-this._tile[1]*this._width,this._offset[2]=s[2]-this._tile[2]*this._width,e.setUniform1f("width",this._width),e.setUniform3fv("offset",this._offset),e.setUniformMatrix4fv("view",r.viewMatrix),e.setUniform3fv("cameraPosition",s),e.bindPass(null,i.bindParameters),e.setUniform1f("time",this._renderParameters.time),t==="rainy"?he(this._particleColor,.85,.85,.85):he(this._particleColor,1,1,1),fe(this._particleColorAtNight,this._particleColor,this._nightMultiplier),Re(this._cameraDirection,s);const n=Math.max(0,Pe(this._cameraDirection,i.bindParameters.lighting.lightingMainDirection));Pn(this._particleColor,this._particleColorAtNight,this._particleColor,n),e.setUniform3fv("particleColor",this._particleColor),e.setUniform1f("opacity",this._opacity)}_ensureResources(e){M(this._vao)&&(this._vao=this._createVertexArrayObject(e)),M(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const t=[];for(let i=0;i<this._numParticles;i++)t.push(i);return Ci.createVertex(e,Wi.STATIC_DRAW,new Float32Array(t))}_createVertexArrayObject(e){const t=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Ln(e,G0.attributeLocation,{geometry:Xu(bat)},{geometry:Ci.createVertex(e,Wi.STATIC_DRAW,t)})}};u([d({constructOnly:!0})],Rx.prototype,"context",void 0),u([d({constructOnly:!0})],Rx.prototype,"view",void 0),u([d({readOnly:!0})],Rx.prototype,"updating",null),u([d()],Rx.prototype,"_updatingTracking",void 0),Rx=u([L("esri.views.3d.environment.Precipitation")],Rx);const bat=Bs().vec3f(P.POSITION),whe=Xu(Bs().f32(P.INSTANCEFEATUREATTRIBUTE),1),wat="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg==",xat=ve.getLogger("esri.views.3d.environment.SimpleAtmosphere"),ON=128,xhe=-CY,The=0,dj=50,Tat=()=>1-511/512,Sat=f5([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class Eat{constructor(t){this.view=t,this.type="simple",this._renderData={texV:Ke(),silCircleCenter:$(),silCircleV1:$(),silCircleV2:$(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0},this._passParameters=new vie,this._fadeVaoCount=0,this._readyResolver=rm(),this._readyController=new AbortController,this.texV1=1,this.canRender=!0,this.isOnMars=ay(t.spatialReference);const i=Ri(t.spatialReference);this.planetRadius=i.radius,this.outerRimWidth=i.outerAtmosphereRimWidth,this.innerRimFactor=(this.planetRadius+xhe)/this.planetRadius,this.middleRimFactor=(this.planetRadius+The)/this.planetRadius,this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius,this.texV0=The/this.outerRimWidth,this.texVScale=this.texV1-this.texV0}destroy(){this._readyResolver.reject(),this._cameraChangeHandle=hn(this._cameraChangeHandle),this._passParameters.texture=ht(this._passParameters.texture),this._fadeVao=ht(this._fadeVao),this._vao=ht(this._vao),this._readyController=Wn(this._readyController)}when(){return this._readyResolver.promise}async initializeRenderContext(t){this._shaderTechniqueRepository=t.shaderTechniqueRepository;const i=t.renderContext.rctx;this._cameraChangeHandle=re(()=>{var n;return(n=this.view.state)==null?void 0:n.camera},()=>t.requestRender(),fi),this._vao=this._createRibbon(i),this._vaoCount=ka(this._vao,"geometry"),this._fadeVao=Yl(i),this._fadeVaoCount=ka(this._fadeVao,"geometry");const r=this.isOnMars?wat:wAe,s=this._readyController.signal;try{const n=await lm(r,{signal:s});qt(s),this._passParameters.texture=new _t(i,{pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:gt.LINEAR,flipped:!0},n),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}catch(n){as(n)||xat.error("Unable to initialize simple atmosphere: image request failed",n),this._readyResolver.reject(n)}}get coneTechnique(){if(M(this._coneTechnique)){const t=new Ez;t.geometry=iy.Cone,this._coneTechnique=this._shaderTechniqueRepository.acquire(_M,t)}return this._coneTechnique}get undergroundTechnique(){if(M(this._undergroundTechnique)){const t=new Ez;t.geometry=iy.Underground,this._undergroundTechnique=this._shaderTechniqueRepository.acquire(_M,t)}return this._undergroundTechnique}render(t){const i=t.bindParameters.camera;this._update(i);const r=t.rctx;if(this._renderData.undergroundFadeAlpha<1){const s=r.bindTechnique(this.coneTechnique,this._passParameters,t.bindParameters);s.setUniformMatrix4fv("proj",i.projectionMatrix),s.setUniformMatrix4fv("view",i.viewMatrix),s.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),s.setUniform3fv("silCircleV1",this._renderData.silCircleV1),s.setUniform3fv("silCircleV2",this._renderData.silCircleV2),s.setUniform2fv("texV",this._renderData.texV),s.setUniform1f("altitudeFade",this._renderData.altitudeFade),s.setUniform1f("innerScale",this._renderData.innerScale),r.bindVAO(this._vao),r.drawArrays(Wt.TRIANGLES,0,this._vaoCount)}if(this._renderData.undergroundFadeAlpha>0){const s=r.bindTechnique(this.undergroundTechnique,this._passParameters,t.bindParameters);s.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),s.setUniform3fv("cameraPosition",i.eye),r.bindVAO(this._fadeVao),r.drawArrays(Wt.TRIANGLE_STRIP,0,this._fadeVaoCount)}}renderHaze(){return!1}_update(t){const i=$(),r=this.planetRadius,s=Ue(t.eye),n=s-r;if(n<0){const m=Math.min(-n/5e3,1);this._renderData.undergroundFadeAlpha=m}else this._renderData.undergroundFadeAlpha=0;const o=Math.max(dj,n),a=r+xhe;this._renderData.innerScale=Cat(r+o,r,a)-1,this._renderData.altitudeFade=OCe(n),fe(i,t.eye,(r+dj)/s),She(i,t.center,t.up,r,this._renderData);const l=this._computeScreenRimWidth(t,i,t.up,this._renderData),c=Tat(),h=Sat(n);let p=this.texV0+c*this.texVScale,f=this.texV0+l*h*this.texVScale;if(n>dj){She(t.eye,t.center,t.up,r,this._renderData);const m=this._computeScreenRimWidth(t,t.eye,t.up,this._renderData),g=He((m-1.5)/(l-1.5),0,1);p=this.texV0+g*c*this.texVScale,f=this.texV0+ui(this.texV1,l*h,g)*this.texVScale}Li(this._renderData.texV,p,f)}_createRibbon(t){const i=new Float32Array(3+3*ON*3),r=new Uint32Array(3*ON*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<ON;o++){const a=9*o+3;i[a+0]=o,i[a+1]=this.innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this.middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this.outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===ON-1?1:l+3,h=15*o;r[h+0]=l,r[h+1]=l+1,r[h+2]=c+1,r[h+3]=c+1,r[h+4]=c,r[h+5]=l,r[h+6]=l+1,r[h+7]=l+2,r[h+8]=c+2,r[h+9]=c+2,r[h+10]=c+1,r[h+11]=l+1,r[h+12]=l,r[h+13]=c,r[h+14]=0}const s=Ehe.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new Ln(t,lr,{geometry:Xu(Ehe)},{geometry:Ci.createVertex(t,Wi.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(t,i,r,s){return we(uR,s.silCircleCenter,s.silCircleV2),fe(fj,uR,this.outerRimFactor),pB(pj,i,uR,r),mhe(uR,pj,t.projectionMatrix,t.viewport),mhe(fj,pj,t.projectionMatrix,t.viewport),Pr(uR,fj)/t.height}}function She(e,t,i,r,s){const n=Ue(e),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.silCircleV1,c=s.silCircleV2;return fe(s.silCircleCenter,e,a/n),Tt(l,e,t),Vl(l)<1&&Tt(l,e,i),fe(l,l,o/Ue(l)),Tt(c,l,e),fe(c,c,o/Ue(c)),o}const pj=Ne(),uR=$(),fj=$();function Cat(e,t,i){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-i*i)+t*i)}const Ehe=Bs().vec3f(P.POSITION);function Tie(e){const t=E`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=E`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}function Aat(){const e=new mr;return e.attributes.add(P.POSITION,"vec3"),e.attributes.add(P.COLOR,"vec4"),e.attributes.add(P.SIZE,"float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add([new Xr("transform",(t,i)=>Mat(t,i)),new Ei("viewport",(t,i)=>i.camera.fullViewport),new lt("pixelRatio",(t,i)=>i.camera.pixelRatio)]),e.include(Tie),e.vertex.code.add(E`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(E`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),e}function Mat(e,t){return ln(n_,t.camera.projectionMatrix),n_[10]=24e-8-1,n_[11]=-1,n_[14]=(24e-8-2)*t.camera.near,As(n_,n_,t.camera.viewMatrix),As(n_,n_,e.modelMatrix)}const n_=Ne(),Oat=Object.freeze(Object.defineProperty({__proto__:null,build:Aat},Symbol.toStringTag,{value:"Module"}));class Rat extends Nn{constructor(){super(...arguments),this.modelMatrix=Ne()}}class y6 extends Lr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=y6.shader.get().build();return new Er(t.rctx,i,lr)}initializePipeline(){return ri({blending:ba(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),depthTest:{func:Fr.LEQUAL},colorWrite:xi})}}y6.shader=new Sr(Oat,()=>import("./Stars.glsl.0287fafa.js"));const Pat=ve.getLogger("esri.views.3d.environment.Stars");let l1=class extends Ee{constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new Rat,this._updatingTracking=new Lg}get updating(){return this._updatingTracking.updating||this.loading}get loading(){return _(this._loadDataTask)&&!this._loadDataTask.finished}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Wn(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=br(this._technique),this._vao=ht(this._vao)}render(e){const{rctx:t}=e;if(this._ensureResources(t),M(this._technique)||M(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const i=t.bindTechnique(this._technique,this._renderParameter,e.bindParameters);t.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(Wt.POINTS,0,this._numPoints)}_ensureResources(e){if(_(this._technique)||M(U2))return;this._technique=new y6({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=U2.byteLength/Che;const t=new Float32Array(U2,0,2*this._numPoints),i=new Uint8Array(U2,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,t,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type==="sun"?this.view.environment.lighting.date:null,r=>this._update(r),Et)}_computeDayDuration(e){const t=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),r=ln(this._renderParameter.modelMatrix,Lat);QA(r,r,-i*Math.PI),As(r,$at,r),QA(r,r,-t*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,i,r){const s=Ahe.createBuffer(r),n=s.position,o=s.color,a=s.size;for(let l=0;l<r;l++){const c=t[2*l+0],h=t[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(h)),n.set(l,1,-Math.sin(c)*Math.sin(h)),n.set(l,2,-Math.cos(h));const p=this._unpackUint8Attributes(i[l]),f=this._hexToRGB(Iat[p[1]]);o.set(l,0,255*f[0]),o.set(l,1,255*f[1]),o.set(l,2,255*f[2]),o.set(l,3,255),a.set(l,p[0])}return new Ln(e,lr,{geometry:Xu(Ahe)},{geometry:Ci.createVertex(e,Wi.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(_(U2))return null;const e=Pv(async t=>{const{data:i}=await WBe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});this._verifyStarData(i),U2=i});return e.promise.catch(t=>{as(t)||Pat.error(t)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new W("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/Che;if(t%1!=0||t>5e4||t<5e3)throw new W("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([d({constructOnly:!0})],l1.prototype,"view",void 0),u([d({constructOnly:!0})],l1.prototype,"requestRender",void 0),u([d({readOnly:!0})],l1.prototype,"updating",null),u([d()],l1.prototype,"_loadDataTask",void 0),u([d()],l1.prototype,"_updatingTracking",void 0),l1=u([L("esri.views.3d.environment.Stars")],l1);const Iat=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],$at=QK(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),Lat=QK(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Che=9,Ahe=Bs().vec3f(P.POSITION).vec4u8(P.COLOR).f32(P.SIZE);let U2=null;var rt;(function(e){e[e.MATERIAL=0]="MATERIAL",e[e.MATERIAL_ALPHA=1]="MATERIAL_ALPHA",e[e.MATERIAL_DEPTH=2]="MATERIAL_DEPTH",e[e.MATERIAL_NORMAL=3]="MATERIAL_NORMAL",e[e.MATERIAL_DEPTH_SHADOWMAP_ALL=4]="MATERIAL_DEPTH_SHADOWMAP_ALL",e[e.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT",e[e.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT",e[e.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT"})(rt||(rt={}));var lI;const Dat=[$e.POSTPROCESSING_ENVIRONMENT_OPAQUE,$e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let Mhe,Ol=lI=class extends Ee{constructor(e){super(e),this._handles=new Nt,this._context=null,this._pendingAtmosphere=null,this._atmosphere=null}initialize(){this.view._stage.addRenderPlugin(Dat,this)}destroy(){var e;this._pendingAtmosphere=We(this._pendingAtmosphere),((e=this.view)==null?void 0:e._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._handles=We(this._handles),this._set("view",null)}get atmosphereType(){return _(this._pendingAtmosphere)?this._pendingAtmosphere.type:_(this._atmosphere)?this._atmosphere.type:"none"}get canRender(){var e;return!!((e=this.view.basemapTerrain)==null?void 0:e.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._selectAtmosphereType()==="realistic"}updateAnimation(e){return!!_(this._precipitation)&&this._precipitation.update(e)}get updating(){return _(this._pendingAtmosphere)||_(this._stars)&&this._stars.updating||_(this._clouds)&&this._clouds.running}get weatherVisible(){return Ue(this.view.state.camera.eye)-Ri(this.view.spatialReference).radius<=Qd}get _stars(){var r,s;const e=this.view,t=(s=(r=e.environment)==null?void 0:r.starsEnabled)!=null?s:!1,i=this._get("_stars");return!t||M(this._context)?(We(i),null):_(i)?i:new l1({view:e,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||M(this._context))return We(e),null;const t=this.view,i=this._context;return _(e)&&e.context===i?e:(We(e),new Rx({context:i,view:t}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||M(this._context))return We(e),null;if(_(e))return e;const t=this.view,i=this._context;return We(e),new Ml({context:i,view:t,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||M(this._context))return We(e),null;const t=this.view.state.viewingMode,i=this._context.renderContext.rctx,r=Ri(this.view.spatialReference).radius;return _(e)&&e.viewingMode===t&&e.planetRadius===r?e:(We(e),new Ox({rctx:i,viewingMode:t,planetRadius:r,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||M(this._context))return We(e),null;if(_(e))return e;const t=this.view,i=this._context;return We(e),new aI({context:i,view:t})}get weatherEnabled(){var e,t;return!!((t=(e=this.view)==null?void 0:e.environmentManager)==null?void 0:t.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(e=null){this._context=e,this._handles.add([Jn(()=>{var t;return(t=this.view)==null?void 0:t.basemapTerrain},()=>this._updateBasemapTerrain(),fi),re(()=>({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),fi),re(()=>this._stars,()=>this._setNeedsRender()),re(()=>this._clouds,()=>this._updateWeather(this._weatherUpdateParameters),Et),re(()=>this._precipitation,()=>this._setNeedsRender()),re(()=>this._fog,()=>this._updateFog(this._weatherUpdateParameters),Et),re(()=>this._weatherUpdateParameters,t=>{this._updateWeather(t),this._updateFog(t)},fi)])}uninitializeRenderContext(){this._context=null,this._atmosphere=We(this._atmosphere),this._set("_stars",We(this._stars)),this._set("_precipitation",We(this._precipitation)),this._set("_clouds",We(this._clouds)),this._set("_cloudsComposition",We(this._cloudsComposition)),this._set("_fog",We(this._fog))}prepareRender(e){e.bindParameters.clouds.data=Hnt(this._clouds)?this._clouds:null}render(e){if(e.pass===rt.MATERIAL)switch(e.bindParameters.slot){case $e.POSTPROCESSING_ENVIRONMENT_OPAQUE:_(this._stars)&&this._stars.render(e),_(this._atmosphere)&&this._atmosphere.canRender&&(this._atmosphere.render(e),_(this._cloudsComposition)&&_(e.bindParameters.clouds.data)&&(this.weatherVisible&&_(this._clouds)&&this._clouds.ensureWeatherTile(),this._cloudsComposition.render(e,_(this.view.animation))));break;case $e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(_(this._atmosphere)&&this._atmosphere.canRender){const t=this.weatherEnabled?this.view.environment.weather.type:"disabled";if(this._atmosphere.renderHaze(e,t==="rainy"),_(this._fog)){const i=t==="foggy"||t==="rainy"||t==="snowy";(i||this._selectAtmosphereType()!=="realistic")&&this._fog.render(e,i,t==="rainy")}if(_(this._precipitation)){const i=this.view.environment.weather;i.type!=="rainy"&&i.type!=="snowy"||this._precipitation.render(e,i.precipitation,i.type)}}}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return M(e)?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeather(e){M(e)||M(this._clouds)||(this._clouds.applyPreset(fAe[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){_(this._context)&&this._context.requestRender()}_updateFog(e){if(!M(this._fog)&&!M(e))switch(e.type){case"foggy":this._fog.strength=ui(3e-5,.005,e.weatherAdjustment**3),this._setNeedsRender();break;case"rainy":case"snowy":this._fog.strength=ui(4e-6,2e-4,e.effect**3),this._setNeedsRender();break;default:this._fog.strength=4e-6,this._setNeedsRender()}}_updateAtmosphere(){const e=this._selectAtmosphereType();if(this.atmosphereType===e)return;_(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);const t=this._getAtmosphereClass();if(!t)return _(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();const i=new t(this.view);_(this._context)&&i.initializeRenderContext(this._context),M(this._atmosphere)&&(this._atmosphere=i,this._setNeedsRender()),this._pendingAtmosphere=i,i.when().then(()=>{_(this._atmosphere)&&this._pendingAtmosphere&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere),this._pendingAtmosphere=null,this._setNeedsRender(),this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===i&&(this._pendingAtmosphere=null)})}_getAtmosphereClass(){switch(this._selectAtmosphereType()){case"none":return null;case"realistic":return rhe;case"panoramic":return mat;case"simple":return Eat;default:return}}_selectAtmosphereType(){const e=this.view.get("environment.atmosphereEnabled"),t=this.view.get("environment.atmosphere.quality"),i=this.view.viewingMode;return!e||t==null||ly(this.view.spatialReference)?"none":i==="local"?"panoramic":t==="high"&&_(this._context)&&rhe.isSupported(this._context)&&O3(this.view.spatialReference)?"realistic":"simple"}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=_(this._atmosphere)&&this.atmosphereType==="simple")}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:e=>{Mhe=lI.prototype._getAtmosphereClass,lI.prototype._getAtmosphereClass=e},restoreGetAtmosphereClass:()=>{lI.prototype._getAtmosphereClass=Mhe}}}};u([d({constructOnly:!0})],Ol.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],Ol.prototype,"updating",null),u([d({readOnly:!0})],Ol.prototype,"weatherVisible",null),u([d()],Ol.prototype,"_context",void 0),u([d()],Ol.prototype,"_pendingAtmosphere",void 0),u([d({readOnly:!0})],Ol.prototype,"_stars",null),u([d({readOnly:!0})],Ol.prototype,"_precipitation",null),u([d({readOnly:!0})],Ol.prototype,"_clouds",null),u([d({readOnly:!0})],Ol.prototype,"_cloudsComposition",null),u([d({readOnly:!0})],Ol.prototype,"_fog",null),u([d({readOnly:!0})],Ol.prototype,"weatherEnabled",null),u([d({readOnly:!0})],Ol.prototype,"_precipitationEnabled",null),u([d({readOnly:!0})],Ol.prototype,"_weatherUpdateParameters",null),Ol=lI=u([L("esri.views.3d.environment.EnvironmentRenderer")],Ol);function Ohe(e,t,i){return Nat(e,t.longitude,t.latitude,i.longitude,i.latitude)}function Nat(e,t,i,r,s){const n=Yt(i),o=Yt(s),a=n-o,l=Yt(t)-Yt(r),c=Math.sin(a/2),h=Math.sin(l/2),p=2*tm(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*e;return Math.round(1e4*p)/1e4}function Fat(e,t,i){const r=t.spatialReference,s=Ri(r),n=new dt(t.x,e.y,r),o=new dt(i.x,e.y,r),a=new dt(e.x,t.y,r),l=new dt(e.x,i.y,r);return{lon:Ohe(s.radius,n,o),lat:Ohe(s.radius,a,l)}}function kat(e,t,i){const r=t/i,s=Yt(e),n=Math.sin(r/2),o=Math.cos(s),a=2*tm(Math.sqrt(n*n/(o*o)));return Vu(a)}function Uat(e,t){let i=e/15;return t||(i=Math.round(i)),i}function DY(e,t){t||(t={hours:0,minutes:0,seconds:0}),t.hours=Uat(e[0],!0);const i=t.hours%1;t.hours-=i,t.minutes=60*i;const r=t.minutes%1;return t.minutes-=r,t.seconds=Math.round(60*r),t}var Rhe,Phe,Ihe,OAe={exports:{}};Rhe=OAe,Phe=function(){var e=Math.PI,t=Math.sin,i=Math.cos,r=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=e/180,l=864e5,c=2440588,h=2451545,p={dec:0,ra:0};function f(z){return z.valueOf()/l-.5+c}function m(z){return new Date((z+.5-c)*l)}function g(z){return f(z)-h}var y=23.4397*a;function x(z,q){return n(t(z)*i(y)-r(q)*t(y),i(z))}function b(z,q){return s(t(q)*i(y)+i(q)*t(y)*t(z))}function S(z,q,Z){return n(t(z),i(z)*t(q)-r(Z)*i(q))}function T(z,q,Z){return s(t(q)*t(Z)+i(q)*i(Z)*i(z))}function C(z,q){return a*(280.16+360.9856235*z)-q}function A(z){return a*(357.5291+.98560028*z)}function O(z){return a*(1.9148*t(z)+.02*t(2*z)+3e-4*t(3*z))}function D(z,q){return z+q+102.9372*a+e}function U(z,q){var Z=A(z),Y=D(Z,O(Z));return q||(q={dec:0,ra:0}),q.dec=b(Y,0),q.ra=x(Y,0),q}var k={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(z,q,Z,Y){var te=a*-Z,se=a*q,J=g(z),ae=U(J,p),_e=C(J,te)-ae.ra;return Y||(Y={azimuth:0,altitude:0}),Y.azimuth=S(_e,se,ae.dec),Y.altitude=T(_e,se,ae.dec),Y}},B=[[-.83,"sunrise","sunset"]];k.addTime=function(z,q,Z){B.push([z,q,Z])};var j=9e-4;function H(z,q){return Math.round(z-j-q/(2*e))}function K(z,q,Z){return j+(z+q)/(2*e)+Z}function ee(z,q,Z){return h+z+.0053*t(q)-.0069*t(2*Z)}function ce(z,q,Z){return o((t(z)-t(q)*t(Z))/(i(q)*i(Z)))}function le(z){var q=a*(134.963+13.064993*z),Z=a*(93.272+13.22935*z),Y=a*(218.316+13.176396*z)+6.289*a*t(q),te=5.128*a*t(Z),se=385001-20905*i(q);return{ra:x(Y,te),dec:b(Y,te),dist:se}}return k.getTimes=function(z,q,Z){var Y=a*-Z,te=a*q,se=H(g(z),Y),J=K(0,Y,se),ae=A(J),_e=O(ae),Oe=D(ae,_e),Be=b(Oe,0),Se=ee(J,ae,Oe);function Te(ki){return ee(K(ce(ki,te,Be),Y,se),ae,Oe)}function Ie(ki){var kr=(t(ki)-t(te)*t(Be))/(i(te)*i(Be));return kr<-1?k.PolarException.MIDNIGHT_SUN:kr>1?k.PolarException.POLAR_NIGHT:k.PolarException.NORMAL}var Ve,Ni,Fi,hi,Vi,di={solarNoon:m(Se),nadir:m(Se-.5),polarException:k.PolarException.NORMAL};for(Ve=0,Ni=B.length;Ve<Ni;Ve+=1)Vi=Se-((hi=Te((Fi=B[Ve])[0]*a))-Se),di[Fi[1]]=m(Vi),di[Fi[2]]=m(hi);return di.polarException=Ie(B[0][0]*a),di},k.getMoonPosition=function(z,q,Z){var Y=a*-Z,te=a*q,se=g(z),J=le(se),ae=C(se,Y)-J.ra,_e=T(ae,te,J.dec);return _e+=.017*a/r(_e+10.26*a/(_e+5.1*a)),{azimuth:S(ae,te,J.dec),altitude:_e,distance:J.dist}},k.getMoonFraction=function(z){var q=g(z),Z=U(q),Y=le(q),te=149598e3,se=o(t(Z.dec)*t(Y.dec)+i(Z.dec)*i(Y.dec)*i(Z.ra-Y.ra)),J=n(te*t(se),Y.dist-te*i(se));return(1+i(J))/2},k},(Ihe=Phe())!==void 0&&(Rhe.exports=Ihe);const kb=OAe.exports,vg={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function zat(e,t,i,r,s,n,o){he(o.ambient.color,1,1,1),o.ambient.intensity=vg.global.ambient,he(o.direct.color,1,1,1),o.direct.intensity=vg.global.direct;const a=t[2],l=He((Math.abs(a)-vg.local.altitude)/(vg.global.altitude-vg.local.altitude),0,1);let c;if(o.globalFactor=l,n==="sun"&&(c=kb.getTimes(e,t[1],t[0])),l<1){let h;if(n==="sun")h=Zat(e,c,r);else{const p=PAe(r);h={direct:{intensity:vg.local.directAtNoon*p.direct,color:Ze(1,1,1)},ambient:{intensity:vg.local.ambientAtNoon*p.ambient,color:Ze(1,1,1)},timeOfDay:"early afternoon"}}Pn(o.ambient.color,h.ambient.color,o.ambient.color,l),o.ambient.intensity=ui(h.ambient.intensity,o.ambient.intensity,l),Pn(o.direct.color,h.direct.color,o.direct.color,l),o.direct.intensity=ui(h.direct.intensity,o.direct.intensity,l),o.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,o.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}o.noonFactor=n==="sun"?Wat(e,c):1,n==="sun"?Bat(e,t,i,o.direct.directionToLightSource):Vat(s,i,o.direct.directionToLightSource)}function Vat(e,t,i){t===tt.Global?Re(mj,e.eye):he(mj,0,0,1),fe(gj,e.viewForward,-1);const r=p5(gj,mj),s=Math.max(r-2*yj,0),n=.85*s/(s+1),o=Math.max(yj,r-yj-n);sd(Lhe,-o,e.viewRight),Xe(i,gj,Lhe),we(i,i,fe(Xat,e.viewRight,Yat)),Re(i,i)}function Bat(e,t,i,r){const s=qat,n=Yg(Hat);if(i===tt.Global)kb.getPosition(e,0,0,s),he(r,0,0,-1),JA(n,n,-s.azimuth),hB(n,n,-s.altitude),Xe(r,r,n);else{const o=vg.planarDirection,a=o.globalAngles,l=t[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=He(c,0,1),c<1?(kb.getPosition(e,t[1],t[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),he(r,0,-1,0),QA(n,n,-s.azimuth),JA(n,n,-s.altitude),Xe(r,r,n)}}function Gat(e,t){if(t===tt.Global)return!0;const i=vg.planarDirection;return Math.abs(e)<i.localAltitude}const jat=Ze(.5773502691896258,-.5773502691896258,.5773502691896258);class RAe{constructor(){this.ambient={color:Ze(1,1,1),intensity:.55},this.direct={color:Ze(1,1,1),intensity:.55,directionToLightSource:Rn(jat)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const Hat=Ne(),qat={azimuth:0,altitude:0};function Wat(e,t){const i=e.valueOf();let r,s;t.polarException===kb.PolarException.MIDNIGHT_SUN?(r=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=r+432e6):t.polarException===kb.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=t.sunrise.valueOf(),s=t.sunset.valueOf());const n=r+(s-r)/2;return 1-He(Math.abs(i-n)/432e5,0,1)}function PAe(e){switch(e){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function $he(e,t){const i=(e[0]+e[1]+e[2])/3;for(let r=0;r<3;r++)e[r]=e[r]+(i-e[r])*t;return e}function Zat(e,t,i){const r=e.valueOf();let s,n;t.polarException===kb.PolarException.MIDNIGHT_SUN?(s=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=s+432e6):t.polarException===kb.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=t.sunrise.valueOf(),n=t.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,f=s-p/2,m=s+p/2,g=n-p/2,y=n+p/2,x=vg.local,b=[.01,x.ambientAtNight],S=[.8,.8,1],T=[.01,.01,.01],C=[x.directAtTwilight,x.ambientAtTwilight],A=[1,.6,.5],O=[.8,.8,1],D=[.9*x.directAtNoon,x.ambientAtNoon],U=[1,.98,.98],k=[.98,.98,1],B=[x.directAtNoon,x.ambientAtNoon],j=[1,1,1],H=[1,1,1],K=D,ee=U,ce=k,le=C,z=A,q=O;let Z,Y,te=[0,0],se=[0,0,0],J=[0,0,0];r<f||r>y?(te=b,se=T,J=S,Y="night"):r<m?(Z=m-f,te=xa(r-f,Z,b,C),se=xa(r-f,Z,T,A),J=xa(r-f,Z,S,O),Y="sun rising"):r<c?(Z=c-m,te=xa(r-m,Z,C,D),se=xa(r-m,Z,A,U),J=xa(r-m,Z,O,k),Y="early morning"):r<a?(Z=a-c,te=xa(r-c,Z,D,B),se=xa(r-c,Z,U,j),J=xa(r-c,Z,k,H),Y="late morning"):r<h?(Z=h-a,te=xa(r-a,Z,B,K),se=xa(r-a,Z,j,ee),J=xa(r-a,Z,H,ce),Y="early afternoon"):r<g?(Z=g-h,te=xa(r-h,Z,K,le),se=xa(r-h,Z,ee,z),J=xa(r-h,Z,ce,q),Y="late afternoon"):r<y&&(Z=y-g,te=xa(r-g,Z,le,b),se=xa(r-g,Z,z,T),J=xa(r-g,Z,q,S),Y="sun setting");let ae=0;switch(i){case"rainy":case"foggy":ae=.9;case"snowy":ae=.5}ae>0&&(se=$he(se,ae),J=$he(J,ae));const _e=Ze(se[0],se[1],se[2]),Oe=Ze(J[0],J[1],J[2]),Be=PAe(i);return{direct:{intensity:te[0]*Be.direct,color:_e},ambient:{intensity:te[1]*Be.ambient,color:Oe},timeOfDay:Y}}function xa(e,t,i,r){const s=[];for(let n=0;n<i.length;n++)s[n]=(r[n]-i[n])*e/t+i[n];return s}const Lhe=Ne(),mj=$(),gj=$(),Xat=$(),yj=.25,Yat=.2;let cf=class extends cs.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Nt,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new OY,this._ambientLight=new yie,this._moonLight=new yAe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)==null?void 0:e.updating))}get weatherEnabled(){var e,t,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(t=this._view)==null?void 0:t.state)==null?void 0:i.viewingMode)===tt.Global&&O3(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Ol({view:e});const t=()=>this._updateRenderParameters(),i=()=>this._cameraHandler(),r=()=>this._updateLighting();this._viewHandles.add([re(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Ui),re(()=>e.environment.lighting.type==="sun"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),Ui),re(()=>e.stationary,()=>this._interactingStationaryHandler()),re(()=>e.environment.lighting.directShadowsEnabled,t,Ui),re(()=>e.environment.lighting.ambientOcclusionEnabled,t,Ui),re(()=>e.environment.lighting.waterReflectionEnabled,t,Ui),re(()=>{var s;return(s=e.environment.background)==null?void 0:s.color},t,Ui),re(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Ui),re(()=>e.environment.weather.type,r,Ui),re(()=>this.weatherEnabled,r,Ui),re(()=>e.viewingMode,()=>this._resetReferencePosition(!0),fi),re(()=>e.environment.lighting.type==="sun"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),fi),re(()=>e.state.camera,i,fi),re(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=We(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type==="sun"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type==="sun"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const t=this._view.environment.lighting;(t==null?void 0:t.type)==="sun"&&(t.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if((t==null?void 0:t.type)!=="virtual"){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!fS(i)){const r=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(r))return void this._requestReferencePositionUpdate(r)}if(this._preupdateTracking(e),_(this._referencePosWGS84Comparable)){const r=DY(this._referencePosWGS84Comparable,Dhe);_(r)&&(t.autoUpdate(null,r),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type==="sun"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const i=t.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,t){const i=O3(this._view.spatialReference);if(i&&!fS(this._view.spatialReference))return!1;const r=e.position;return M(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=$()),i?T8e(r,this._referencePosWGS84Comparable):he(this._referencePosWGS84Comparable,r.longitude,r.latitude,r.z),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=t.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e){const t=this._view,i=e||(t.environment.lighting.type==="sun"?t.environment.lighting.date:null),r=this._referencePosWGS84Comparable,s=_(r)?Jat:Qat;if(_(r)){const h=this.weatherVisible?t.environment.weather.type:"disabled";zat(i,r,t.state.viewingMode,h,t.state.camera,t.environment.lighting.type,s)}const n=this._mainLight,o=s.direct;fe(n.intensity,o.color,o.intensity*Math.PI),pe(n.direction,o.directionToLightSource),n.specularStrength=s.specularStrength,n.environmentStrength=s.environmentStrength;const a=this._ambientLight;fe(a.intensity,s.ambient.color,s.ambient.intensity);const l=this._moonLight;Pn(l.intensity,elt,tlt,s.globalFactor);const c=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));fe(l.intensity,l.intensity,c),pe(l.direction,o.directionToLightSource),t._stage.renderView.updateLightSources([n,a,l],1-s.noonFactor,s.globalFactor),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||M(e))return!1;const i=Kat;i.setTime((t||this._view.environment.lighting.date).getTime());const r=DY(e,Dhe);if(M(r))return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===r.hours&&s.minutes===r.minutes&&s.seconds===r.seconds)return!1}else s=r;const n=i.getUTCHours()-(r.hours-s.hours),o=i.getUTCMinutes()-(r.minutes-s.minutes),a=i.getUTCSeconds()-(r.seconds-s.seconds);return i.setUTCHours(n),i.setUTCMinutes(o),i.setUTCSeconds(a),!t&&this._view.environment.lighting.autoUpdate(i,r)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=Nh(this._referencePosWGS84Comparable,!0,s=>Gat(s[2],this._view.state.viewingMode)),i=this._view.environment.background,r=i instanceof TCe?{type:"color",color:yB(Le.toUnitRGBA(i.color))}:{type:"color",color:zi(0,0,0,1)};e.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,background:r,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=nS(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const s=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),r=this._referencePosUpdateTimer=nS(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===r&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const i=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[t[0],t[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};u([d({type:Boolean,readOnly:!0})],cf.prototype,"updating",null),u([d()],cf.prototype,"disableQueries",void 0),u([d()],cf.prototype,"_disableWeather",void 0),u([d()],cf.prototype,"weatherEnabled",null),u([d()],cf.prototype,"weatherVisible",null),u([d()],cf.prototype,"referencePositionWGS84Comparable",null),u([d()],cf.prototype,"_renderer",void 0),u([d()],cf.prototype,"_referencePosWGS84Comparable",void 0),cf=u([L("esri.views.3d.environment.SceneViewEnvironmentManager")],cf);const Jat=new RAe,Qat=new RAe,Kat=new Date,Dhe={hours:0,minutes:0,seconds:0},elt=Ze(.22,.22,.33),tlt=Ze(.22,.22,.22);function S$(e,t){return(e&t)!=0}function Mz(e,t,i,r,s,n){e!==0&&(i?(n.min=Math.min(n.min,t),n.max=Math.max(n.max,t)):r!=null?(n.min-=Math.max(0,(t-n.min)*(1-r)),n.max+=Math.max(0,(t-n.max)*(1-r))):s&&(n.min-=Math.max(0,t-n.min-s),n.max+=Math.max(0,t-n.max-s)))}var ni,jr,zo;(function(e){e[e.NONE=0]="NONE",e[e.ZOOM=1]="ZOOM",e[e.TUMBLE=2]="TUMBLE",e[e.LOOK_AROUND=3]="LOOK_AROUND",e[e.PAN=4]="PAN",e[e.ASCEND=5]="ASCEND"})(ni||(ni={})),function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"}(jr||(jr={})),function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"}(zo||(zo={}));const Ub={selection:jr.NONE,interactionType:ni.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:zo.TUMBLE};function IAe(e,t,i,r){return t=t||e.viewForward,pe(r,t),fe(r,r,Math.sign(Pe(t,i))),r}function ilt(e,t,i,r){return alt(e,t,i,nlt(r,t,i,!0))}function rlt(e,t,i,r){const s=Pe(i,xe(e,r,t));return we(e,t,fe(e,i,s))}const slt={dir:$(),len:0,clip:Ke()};function nlt(e,t,i,r){const s=slt;return e?(i&&r&&(s.len=Pr(t,i)),pe(s.dir,e)):r?(s.len=Pr(t,i),xe(s.dir,i,t),fe(s.dir,s.dir,1/s.len)):(xe(s.dir,i,t),Re(s.dir,s.dir)),s}function olt(e,t,i){const r=Pe(e,i.dir),s=-Or(e,t);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function alt(e,t,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<e.length;s++)if(!olt(e[s],t,r))return!1;return!0}function llt(e,t,i=Ub){const r=Sie(e,t,i);if(r===0)return!1;const s=e.renderCoordsHelper,n=s.getAltitude(t.eye)+r,o=IAe(t,i.interactionDirection,hlt(e,t,Math.sign(r),mlt),flt),a=pe(glt,t.viewForward),l=s.intersectInfiniteManifold(od(t.eye,o),n,vj);return t.eye=_(l)?l:s.setAltitude(vj,n,t.eye),t.center=rlt(vj,t.eye,a,t.center),!0}function Sie(e,t,i=Ub){if(!clt(e,i))return 0;const r=dlt(e.state.constraints.altitude,plt);ult(e,i,r);const s=e.renderCoordsHelper.getAltitude(t.eye),n=He(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function clt(e,t){const i=e.state.constraints.altitude;return!(!e.state.isGlobal||!i)&&(t.interactionType!==ni.TUMBLE||!S$(t.selection,jr.TILT))}function ult(e,t,i){const r=t.interactionType;if(r===ni.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t,l=r===ni.TUMBLE||r===ni.ZOOM,c=Sie(e,o),h=c===0?0:e.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,Mz(c,h,l,a,.05*h,i)}function hlt(e,t,i,r){return e.renderCoordsHelper.worldUpAtPosition(t.eye,r),fe(r,r,i),r}function dlt(e,t){return t.min=e.min,t.max=e.max,t}const plt={min:0,max:0},flt=$(),mlt=$(),glt=$(),vj=$();function Eie(e,t,i=Ub){if(!e.state.isLocal)return 0;const r=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;RN.min=0,RN.max=r,vlt(e,i,RN);const s=Cie(e,t),n=RN.max-s;return n>=-1e-6?0:n}function ylt(e,t,i=Ub){const r=Eie(e,t,i);if(r===0)return!1;const s=e.pointsOfInterest.surfaceOrigin,n=Cie(e,t)+r,o=pe(blt,t.eye),a=IAe(t,i.interactionDirection,_lt(e,t,Tlt),xlt);if(!Yb(Ewe(s.renderLocation,n),od(t.eye,a),PN))return!1;t.eye=PN;const l=xe(wlt,t.eye,o);t.center=we(PN,t.center,l);const c=e.renderCoordsHelper.getAltitude(t.center),h=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,c,PN);return _(h)&&(t.center=h),!0}function vlt(e,t,i){const r=t.interactionType;if(r===ni.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t,l=r===ni.ZOOM||r===ni.PAN,c=Eie(e,o),h=c===0?0:Cie(e,o);i.min=s,i.max=n,Mz(c,h,l,a,.05*h,i)}function Cie(e,t){const i=e.pointsOfInterest.surfaceOrigin;return Pr(t.eye,i.renderLocation)}function _lt(e,t,i){const r=e.pointsOfInterest.surfaceOrigin;return Rv(i,t.eye,r.renderLocation)}const RN={min:0,max:0},blt=$(),wlt=$(),xlt=$(),Tlt=$(),PN=$();var xs,Vo;(function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"})(xs||(xs={}));class Slt{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=Vo.ALL}}(function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"})(Vo||(Vo={}));function yy(e){return _(e)&&_(e.dist)}function Nhe(e){return(t,i,r)=>(Pn(Fhe,t,i,r),!aee(e,Fhe))}function v6(e){return yy(e)&&e.intersector===xs.OBJECT&&!!e.target}function _6(e){return yy(e)&&e.intersector===xs.HUD&&!!e.target&&_(e.target.center)}const Fhe=$();class Elt{constructor(){this._transform=Ne(),this._transformInverse=new IN({value:this._transform},Ks,Ne),this._transformInverseTranspose=new IN(this._transformInverse,Gc,Ne),this._transformTranspose=new IN({value:this._transform},Gc,Ne),this._transformInverseRotation=new IN({value:this._transform},oAe,ls)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){ln(this._transform,t)}multiplyTransform(t){As(this._transform,this._transform,t)}set(t){ln(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,i){this.setTransformMatrix(t),this.multiplyTransform(i),this._invalidateLazyTransforms()}}class IN{constructor(t,i,r){this.original=t,this.update=i,this.dirty=!0,this.transform=r()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class Clt{constructor(t=0){this.offset=t,this.tmpVertex=$()}applyToVertex(t,i,r){const s=t+this.localOrigin[0],n=i+this.localOrigin[1],o=r+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=t+s*a,this.tmpVertex[1]=i+n*a,this.tmpVertex[2]=r+o*a,this.tmpVertex}applyToAabb(t){for(let n=0;n<3;++n)o_[n]=t[0+n]+this.localOrigin[n],$N[n]=t[3+n]+this.localOrigin[n],z2[n]=o_[n];const i=this.applyToVertex(o_[0],o_[1],o_[2]);for(let n=0;n<3;++n)t[n]=i[n],t[n+3]=i[n];const r=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)t[a+0]=Math.min(t[a+0],o[a]),t[a+3]=Math.max(t[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)z2[o]=(n&1<<o)==0?o_[o]:$N[o];r(z2)}let s=0;for(let n=0;n<3;++n)o_[n]*$N[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if((s&n)==0){for(let o=0;o<3;++o)s[o]?z2[o]=0:z2[o]=(n&1<<o)!=0?o_[o]:$N[o];r(z2)}}for(let n=0;n<3;++n)t[n+0]-=this.localOrigin[n],t[n+3]-=this.localOrigin[n];return t}}const o_=$(),$N=$(),z2=$();class Alt{constructor(t=0){this.componentLocalOriginLength=0,this._tmpVertex=$(),this._mbs=fo(),this._obb={center:$(),halfSize:Xi(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,i,r){const s=t,n=i,o=r+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=t+s*a,this._tmpVertex[1]=i+n*a,this._tmpVertex[2]=r+o*a,this._tmpVertex}applyToAabb(t){const i=t[0],r=t[1],s=t[2]+this.componentLocalOriginLength,n=t[3],o=t[4],a=t[5]+this.componentLocalOriginLength,l=i*n<0?0:Math.min(Math.abs(i),Math.abs(n)),c=r*o<0?0:Math.min(Math.abs(r),Math.abs(o)),h=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),p=Math.sqrt(l*l+c*c+h*h);if(p<this._totalOffset)return t[0]-=i<0?this._totalOffset:0,t[1]-=r<0?this._totalOffset:0,t[2]-=s<0?this._totalOffset:0,t[3]+=n>0?this._totalOffset:0,t[4]+=o>0?this._totalOffset:0,t[5]+=a>0?this._totalOffset:0,t;const f=Math.max(Math.abs(i),Math.abs(n)),m=Math.max(Math.abs(r),Math.abs(o)),g=Math.max(Math.abs(s),Math.abs(a)),y=Math.sqrt(f*f+m*m+g*g),x=this._totalOffset/y,b=this._totalOffset/p;return t[0]+=i*(i>0?x:b),t[1]+=r*(r>0?x:b),t[2]+=s*(s>0?x:b),t[3]+=n*(n<0?x:b),t[4]+=o*(o<0?x:b),t[5]+=a*(a<0?x:b),t}applyToMbs(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this._totalOffset/i;return this._mbs[0]=t[0]+t[0]*r,this._mbs[1]=t[1]+t[1]*r,this._mbs[2]=t[2]+t[2]*r,this._mbs[3]=t[3]+t[3]*this._totalOffset/i,this._mbs}applyToObb(t){const i=t.center,r=this._totalOffset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);this._obb.center[0]=i[0]+i[0]*r,this._obb.center[1]=i[1]+i[1]*r,this._obb.center[2]=i[2]+i[2]*r,Xh(this._obb.halfSize,t.halfSize,t.quaternion),we(this._obb.halfSize,this._obb.halfSize,t.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,xe(this._obb.halfSize,this._obb.halfSize,t.center),Sv(Vhe,t.quaternion),Xh(this._obb.halfSize,this._obb.halfSize,Vhe),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=t.quaternion,this._obb}}class Mlt{constructor(t=0){this.offset=t,this.sphere=fo(),this.tmpVertex=$()}applyToVertex(t,i,r){const s=this.objectTransform.transform;let n=s[0]*t+s[4]*i+s[8]*r+s[12],o=s[1]*t+s[5]*i+s[9]*r+s[13],a=s[2]*t+s[6]*i+s[10]*r+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(t,i){const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r;const s=this.offset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);i[0]+=i[0]*s,i[1]+=i[1]*s,i[2]+=i[2]*s}applyToAabb(t){const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;const r=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*r,t[4]+=t[4]*r,t[5]+=t[5]*r,t}applyToBoundingSphere(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/i;return this.sphere[0]=t[0]+t[0]*r,this.sphere[1]=t[1]+t[1]*r,this.sphere[2]=t[2]+t[2]*r,this.sphere[3]=t[3]+t[3]*this.offset/i,this.sphere}}const khe=new Mlt;function NY(e){return _(e)?(khe.offset=e,khe):null}const Uhe=new Alt;function Olt(e){return _(e)?(Uhe.offset=e,Uhe):null}const zhe=new Clt;function Rlt(e){return _(e)?(zhe.offset=e,zhe):null}const Rf="terrain",Vhe=Lv();function FY(e,t,i){for(let r=0;r<i;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function Plt(e,t){const i=e.length;for(let r=0;r<i;++r)jC[0]=e[r],t[r]=jC[0];return t}function Ilt(e,t){const i=e.length;for(let r=0;r<i;++r)jC[0]=e[r],jC[1]=e[r]-jC[0],t[r]=jC[1];return t}const jC=new Float32Array(2);function kY(e,t){return M(e)&&(e=[]),e.push(t),e}function UY(e,t){if(M(e))return null;const i=e.filter(r=>r!==t);return i.length===0?null:i}function FL(e){return!!_(e)&&!e.visible}function $lt(e,t,i){const r=e.origin.vec3;TAe(_j,-r[0],-r[1],-r[2]),_(e.transformation)?As(t,_j,e.transformation):ln(t,_j),i&&(Ks(i,t),Gc(i,i))}function Llt(e,t,i,r,s){LN[0]=e.get(t,0),LN[1]=e.get(t,1),LN[2]=e.get(t,2),FY(LN,gw,3),i.set(s,0,gw[0]),r.set(s,0,gw[1]),i.set(s,1,gw[2]),r.set(s,1,gw[3]),i.set(s,2,gw[4]),r.set(s,2,gw[5])}const LN=new Float64Array(3),gw=new Float32Array(6),_j=Ne(),AM=1e-5;class Dlt{constructor(t){this.options=new Slt,this._results=new Nlt,this.transform=new Elt,this.tolerance=AM,this.verticalOffset=null,this._ray=Do(),this._rayEnd=$(),this._rayBeginTransformed=$(),this._rayEndTransformed=$(),this.viewingMode=t==null?tt.Global:t}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,i,r){this.resetWithRay(Twe(t,i,this._ray),r)}resetWithRay(t,i){this.camera=i,t!==this._ray&&NU(t,this._ray),this.options.verticalOffset!==0?this.viewingMode===tt.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,we(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(t=null,i,r,s,n){this.point=i,this.filterPredicate=s,this.tolerance=r==null?AM:r;const o=NY(this.verticalOffset);if(_(t)&&t.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of t){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();_(c)?(_(o)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(t){const i=t.geometryRecords;if(!i)return;const r=t.transformation,s=NY(this.verticalOffset);for(const n of i){const{geometry:o,material:a,instanceParameters:l}=n;if(FL(l))continue;const c=o.id;this.transform.setAndInvalidateLazyTransforms(r,n.getShaderTransformation()),Xe(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Xe(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const h=this.transform.transform;_(s)&&(s.objectTransform=this.transform),a.intersect(o,l,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(p,f,m,g,y,x)=>{if(p>=0){if(_(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,p))return;const b=g?this._results.hud:this._results,S=g?T=>{const C={object:t,geometryId:c,triangleNr:m,center:_(x)?[x[0],x[1],x[2]]:null};T.set(xs.HUD,C,p,f,Xn,y)}:T=>T.set(xs.OBJECT,{object:t,geometryId:c,triangleNr:m},p,f,h,y);if((b.min.drapedLayerOrder==null||y>=b.min.drapedLayerOrder)&&(b.min.dist==null||p<b.min.dist)&&S(b.min),this.options.store!==Vo.MIN&&(b.max.drapedLayerOrder==null||y<b.max.drapedLayerOrder)&&(b.max.dist==null||p>b.max.dist)&&S(b.max),this.options.store===Vo.ALL)if(g){const T=new zY(this._ray);S(T),this._results.hud.all.push(T)}else{const T=new vA(this._ray);S(T),this._results.all.push(T)}}},n.shaderTransformation)}}sortResults(t=this._results.all){t.sort((i,r)=>i.dist!==r.dist?Ye(i.dist,0)-Ye(r.dist,0):i.drapedLayerOrder!==r.drapedLayerOrder?Ye(i.drapedLayerOrder,Number.MAX_VALUE)-Ye(r.drapedLayerOrder,Number.MAX_VALUE):Ye(r.drapedLayerGraphicOrder,Number.MIN_VALUE)-Ye(i.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function cd(e){return new Dlt(e)}class Nlt{constructor(){this.min=new vA(Do()),this.max=new vA(Do()),this.hud={min:new zY(Do()),max:new zY(Do()),all:new Array},this.ground=new vA(Do()),this.all=[]}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0}}class vA{constructor(t){this.intersector=xs.OBJECT,this.normal=$(),this.transformation=Ne(),this._ray=Do(),this.init(t)}get ray(){return this._ray}get distanceInRenderSpace(){return _(this.dist)?(fe(DN,this.ray.direction,this.dist),Ue(DN)):null}getIntersectionPoint(t){return!!yy(this)&&(fe(DN,this.ray.direction,this.dist),we(t,this.ray.origin,DN),!0)}getTransformedNormal(t){return pe(hR,this.normal),hR[3]=0,jh(hR,hR,this.transformation),pe(t,hR),Re(t,t)}init(t){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=xs.OBJECT,NU(t,this._ray)}set(t,i,r,s,n,o,a){this.intersector=t,this.dist=r,pe(this.normal,Ye(s,O0e)),ln(this.transformation,Ye(n,Xn)),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(t){NU(t.ray,this._ray),this.intersector=t.intersector,this.dist=t.dist,this.target=t.target,this.drapedLayerOrder=t.drapedLayerOrder,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,pe(this.normal,t.normal),ln(this.transformation,t.transformation)}}class zY extends vA{constructor(){super(...arguments),this.intersector=xs.HUD}}function Aie(e){return new vA(e)}const DN=$(),hR=si();function $Ae(e,t,i,r){return _(e.renderCoordsHelper.fromRenderCoords(t.eye,Oz,r))&&o1e(i,Oz)}function b6(e,t){return e.elevationProvider?Ye(e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function c2(e,t,i,r){const s=e.state.camera.clone();t&&(s.eye=t,s.center=i,s.up=r),Flt(e,s.ray,a_)||pe(a_,s.center);const n=e.state.constraints,o=n.minimumPoiDistance;if(uo(s.eye,a_)<o){const a=n.collision.enabled;pe(yw,s.viewForward),fe(yw,yw,o),a?s.eye=xe(Oz,a_,yw):we(a_,s.eye,yw);const l=e.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(xe(yw,a_,s.eye),s.eye=l.setAltitude(Oz,h,s.eye),we(a_,s.eye,yw))}return s.center=a_,s}function Bhe(e,t,i){if(!e.state.isGlobal)return!1;const r=b6(e,t),s=e.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(t,i,e.renderDataExtent,r,Ult),o=n*n;return uo(t,i)>o}function Flt(e,t,i){let r=Ghe[e.viewingMode];r||(r=cd(e.state.viewingMode),r.options.backfacesTerrain=!e.state.isGlobal,r.options.invisibleTerrain=!0,Ghe[e.viewingMode]=r);const{isGlobal:s}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,r,i)||Bhe(e,t.origin,i))||!(!e.renderCoordsHelper.intersectManifold(t,0,i)||Bhe(e,t.origin,i))||!!s&&klt(t,i,Ri(e.spatialReference).radius)}function klt(e,t,i){const r=Pe(e.origin,e.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return fe(t,e.direction,s/Ue(e.direction)),we(t,t,e.origin),!0}const Ghe={},Oz=$(),a_=$(),yw=$(),Ult={near:0,far:0};function TO(e,t,i=pp.EYE){const r=e.state.constraints;if(!r.collision.enabled)return!1;const s=b6(e,t.eye),n=e.renderCoordsHelper.getAltitude(t.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;const a=Ue(t.eye);if(xe(NN,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(zlt,o,t.eye),i===pp.EYE_AND_CENTER)t.center=we(NN,t.eye,NN);else if(i===pp.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;t.center=fe(NN,t.center,l)}return!0}var pp;(function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(pp||(pp={}));const NN=$(),zlt=$();function zb(e,t,i){e.worldUpAtPosition(t,jhe),xe(bj,i,t);const r=Ue(bj);return r===0?0:Yn(Pe(bj,jhe)/r)}const jhe=$(),bj=$();function LAe(e,t,i=Ub,r=!0){dR.eyeCenterDistance=0,dR.requiresTwoSteps=!1;const s=Mie(e,t,i,void 0,dR);if(s===0)return!1;switch(sd(FN,-s,t.viewRight),i.tiltMode){case zo.LOOK_AROUND:Xe(l_,t.viewForward,FN),fe(l_,l_,dR.eyeCenterDistance),t.center=we(F1,t.eye,l_);break;case zo.TUMBLE:xe(l_,t.center,t.eye),Xe(l_,l_,FN),t.eye=xe(F1,t.center,l_);break;default:i.tiltMode}return t.up=Xe(F1,t.up,FN),!dR.requiresTwoSteps||!r||LAe(e,t,i,!1)}function Mie(e,t,i=Ub,r=Ub,s){if(!e.state.constraints.tilt)return 0;const n=t.distance,o=e.state.constraints.tilt(n,Ylt);return Xlt(e,i,o),r.interactionType===ni.TUMBLE&&S$(r.selection,jr.ALTITUDE)&&DAe(e,r.interactionStartCamera,o),i.tiltMode===zo.LOOK_AROUND||r.tiltMode===zo.LOOK_AROUND?Blt(e,t,o,s):Vlt(e,t,o)}function Vlt(e,t,i){const r=zb(e.renderCoordsHelper,t.center,t.eye),s=r-He(r,i.min,i.max);return E$(s)?s:0}function Blt(e,t,i,r){switch(r&&(r.requiresTwoSteps=!1),e.viewingMode){case"global":return jlt(e,t,i,r);case"local":return Glt(e,t,i,r);default:return void(e.viewingMode,void 0)}}function Glt(e,t,i,r){const s=zb(e.renderCoordsHelper,t.center,t.eye),n=He(s,i.min,i.max),o=s-n;if(!E$(o))return 0;if(r){const a=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=e.renderCoordsHelper.getAltitude(t.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=t.distance}return o}function jlt(e,t,i,r){const s=Hlt(e,t,Jlt),n=He(s.tiltAtCenter,i.min,i.max);if(!E$(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=qlt(s),a=Wlt(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=Zlt(s,o)),r&&(r.eyeCenterDistance=VY(s,o)),a}function Hlt(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+Ri(e.spatialReference).radius,n=e.renderCoordsHelper.intersectManifold(t.ray,r,F1);return i.eyeCenterDistance=t.distance,i.centerIsOnSurface=!1,_(n)?(i.eyeCenterDistance=Pr(t.eye,n),i.tiltAtCenter=zb(e.renderCoordsHelper,n,t.eye),i.centerIsOnSurface=!0):e.state.isLocal?i.tiltAtCenter=zb(e.renderCoordsHelper,t.center,t.eye):(aO(vB(_B,s),t.ray,F1),i.eyeCenterDistance=Pr(t.eye,F1),i.tiltAtCenter=Yn(-Pe(t.viewForward,Re(F1,F1)))),i.radius=s,i.eyeRadius=Ue(t.eye),i.constraints=e.state.constraints,i}function E$(e){return Math.abs(e)>1e-9}function qlt(e){const{constraints:t,eyeCenterDistance:i,tiltAtCenter:r}=e;let s=r,n=t.clampTilt(i,r);const o=VY(e,n);if(t.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&E$(n-s);){const l=(s+n)/2,c=VY(e,l);E$(t.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function VY(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const i=Math.PI-He(t,0,Math.PI),r=tm(e.radius/e.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(e.eyeRadius<e.radius&&n>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*e.eyeRadius}return n*e.eyeRadius}function Wlt(e,t){const i=tm(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),r=tm(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?i-r:r-i}function Zlt(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}function Xlt(e,t,i){if(t.interactionType===ni.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=t,{min:n,max:o}=i,a=Mie(e,r,Ub,t),l=a===0?0:zb(e.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,t.interactionType===ni.TUMBLE?(S$(t.selection,jr.ALTITUDE)&&DAe(e,r,i),Mz(a,l,!0,s,Hhe,i)):Mz(a,l,!1,s,Hhe,i)}function DAe(e,t,i){if(e.state.isLocal)return;const r=e.state.constraints;if(!r.altitude)return;const s=Vl(t.center),n=Math.sqrt(s),o=t.distance,a=Ri(e.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),p=(c*c-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-Yn(p),i.max)),i.max=Math.min(i.max,Math.PI-Yn(h))}const l_=$(),FN=Ne(),F1=$(),Hhe=Yt(5),Ylt={min:0,max:0},Jlt={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},dR={eyeCenterDistance:0,requiresTwoSteps:!1};function Qlt(e){return e}const w6=e=>e*e,Oie=e=>1-w6(1-e),Klt=e=>e<.5?w6(2*e)/2:(Oie(2*(e-.5))+1)/2,Rie=e=>e*e*e,NAe=e=>1-Rie(1-e),FAe=e=>e<.5?Rie(2*e)/2:(NAe(2*(e-.5))+1)/2,Pie=e=>e*e*e*e,kAe=e=>1-Pie(1-e),ect=e=>e<.5?Pie(2*e)/2:(kAe(2*(e-.5))+1)/2,Iie=e=>e*e*e*e*e,UAe=e=>1-Iie(1-e),tct=e=>e<.5?Iie(2*e)/2:(UAe(2*(e-.5))+1)/2,$ie=e=>1-Math.cos(e*Math.PI/2),zAe=e=>1-$ie(1-e),ict=e=>e<.5?$ie(2*e)/2:(zAe(2*(e-.5))+1)/2,Lie=e=>2**(10*(e-1)),kL=e=>1-Lie(1-e),rct=e=>e<.5?Lie(2*e)/2:(kL(2*(e-.5))+1)/2,Die=e=>-(Math.sqrt(1-e*e)-1),VAe=e=>1-Die(1-e),sct=e=>e<.5?Die(2*e)/2:(VAe(2*(e-.5))+1)/2;function $p(e){const t=2*(e-Math.sqrt((e-1)*e)),i=t/2/e;return r=>r<i?e*r*r:t*r-t+1}function Lp(e,t){return(i,r)=>i<t?t*e(i/t,r):1-e((1-i)/(1-t),r)*(1-t)}const nct=Lp($p(1),1),oct=Lp($p(1),0),BAe=Lp($p(1),.5),act=Lp($p(2),1),lct=Lp($p(2),0),cct=Lp($p(2),.5),uct=Lp($p(3),1),hct=Lp($p(3),0),dct=Lp($p(3),.5),pct=Lp($p(4),1),fct=Lp($p(4),0),mct=Lp($p(4),.5),gct={linear:Qlt,"in-quad":w6,"out-quad":Oie,"in-out-quad":Klt,"in-coast-quad":nct,"out-coast-quad":oct,"in-out-coast-quad":BAe,"in-cubic":Rie,"out-cubic":NAe,"in-out-cubic":FAe,"in-coast-cubic":act,"out-coast-cubic":lct,"in-out-coast-cubic":cct,"in-quart":Pie,"out-quart":kAe,"in-out-quart":ect,"in-coast-quart":uct,"out-coast-quart":hct,"in-out-coast-quart":dct,"in-quint":Iie,"out-quint":UAe,"in-out-quint":tct,"in-coast-quint":pct,"out-coast-quint":fct,"in-out-coast-quint":mct,"in-sine":$ie,"out-sine":zAe,"in-out-sine":ict,"in-expo":Lie,"out-expo":kL,"in-out-expo":rct,"in-circ":Die,"out-circ":VAe,"in-out-circ":sct};function Js(e,t,i=bct,r=t){let s=!1;r!==t&&r.copyFrom(t),r.computeUp(e.state.viewingMode);for(let a=0;a<wct;a++){let l=0;for(const c of _ct)if(S$(i.selection,c.type)){const h=Math.abs(c.error(e,r,i));c.apply(e,r,i)&&(s=!0,l+=h)}if(l===0)break}const n=S$(i.selection,jr.COLLISION),o=yct(i.interactionType,e);return n&&TO(e,r,o)&&(s=!0),s&&r.computeUp(e.state.viewingMode),s}function yct(e,t){switch(e){case ni.PAN:return pp.EYE_AND_CENTER;case ni.ASCEND:return t.state.isGlobal?pp.EYE_AND_CENTER_SCALE:pp.EYE_AND_CENTER;default:return pp.EYE}}function Af(e,t){const i=typeof e=="number"?e:a2(e,t),r=Math.min(1,i/150);return FAe(r)}function vct(e,t,i){return Mie(e,t,i)*t.distance}const _ct=[{type:jr.TILT,error:vct,apply:LAe},{type:jr.ALTITUDE,error:Sie,apply:llt},{type:jr.DISTANCE,error:Eie,apply:ylt}],bct={selection:jr.ALL,interactionType:ni.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:zo.TUMBLE},wct=5,Ku=$(),Xc=$(),c_=$(),Za=$(),vw=$(),xct=$(),eh={upward:Ze(0,0,1),forward:Ze(0,1,0),sideway:Ze(1,0,0)},qhe=ls();class Whe{constructor(t=tt.Global){this.viewingMode=t,this.center=$(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=Rn(eh.forward)}pixelsPerPanAtZoom(t){return this.size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this.size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t}compareTo(t,i){if(i||(i={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===tt.Global){const n=(Ue(this.center)+Ue(t.center))/2;i.pan=p5(this.center,t.center)*n}else i.pan=Pr(this.center,t.center);let r=Math.abs(t.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(t.pitch-this.pitch);return i.rotate=Math.max(r,s),i.sourceZoom=this.distance,i.targetZoom=t.distance,i}interpolate(t,i,r){this.viewingMode===tt.Global?mGe(t.center,i.center,r.pan,this.center):Pn(this.center,t.center,i.center,r.pan),this.distance=ui(t.distance,i.distance,r.zoom),this.pitch=ui(t.pitch,i.pitch,r.rotate);let s=t.yaw;const n=i.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=ui(s,n,r.rotate)}copyFrom(t){pe(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,pe(this.lookAtDirection,t.lookAtDirection),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const i=this._lookAtOrientation(t.center,qhe);pe(this.center,t.center),xe(Za,t.center,t.eye),Pu(Za,Za,i),Pu(vw,t.up,i),this.distance=Ue(Za),Za[0]/=this.distance,Za[1]/=this.distance,Za[2]/=this.distance,this.pitch=this._eyeUpToPitch(Za),this.yaw=this._eyeUpToYaw(Za,vw),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)}copyFromCommon(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(t){const i=this._lookAtOrientation(this.center,qhe);Ap(i,i),this._axisAngleVec3(eh.sideway,this.pitch-Math.PI/2,eh.forward,Za),this._axisAngleVec3(eh.upward,this.yaw,Za),this._axisAngleVec3(eh.sideway,this.pitch-Math.PI/2,eh.upward,vw),this._axisAngleVec3(eh.upward,this.yaw,vw),fe(Za,Za,this.distance),Pu(Za,Za,i),Pu(vw,vw,i),t.center=this.center,t.eye=xe(Za,this.center,Za),t.up=vw}_axisAngleVec3(t,i,r,s=r){const n=Math.cos(i),o=Math.sin(i);return fe(Ku,r,n),Tt(Xc,t,r),fe(Xc,Xc,o),fe(c_,t,(1-n)*Pe(t,r)),we(s,we(s,Ku,Xc),c_)}_lookAtOrientation(t,i=ls()){return this._upAtLookAt(t,c_),Tt(Ku,this.lookAtDirection,c_),Re(Ku,Ku),Ku[0]===0&&Ku[1]===0&&Ku[2]===0&&pe(Ku,eh.sideway),Tt(Xc,c_,Ku),Re(Xc,Xc),i[0]=Ku[0],i[1]=Xc[0],i[2]=c_[0],i[3]=Ku[1],i[4]=Xc[1],i[5]=c_[1],i[6]=Ku[2],i[7]=Xc[2],i[8]=c_[2],i}_upAtLookAt(t,i){return this.viewingMode===tt.Local?pe(i,eh.upward):Re(i,t)}_eyeUpToPitch(t){return Math.PI-p5(eh.upward,t)}_eyeUpToYaw(t,i){const r=xct;return Math.abs(i[2])<.5?(pe(r,i),t[2]>0&&fe(r,r,-1)):pe(r,t),Tt(Xc,r,eh.upward),Re(Xc,Xc),p5(eh.sideway,Xc,eh.upward)}}function Nie(e){return e?{ray:Do(e.ray),c0:e.c0,c1:e.c1}:{ray:Do(),c0:0,c1:Number.MAX_VALUE}}function Tct(e,t=Nie()){return NU(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function Sct(e,t,i=Nie()){const r=Ue(e.vector);return Swe(e.origin,t,i.ray),i.c0=0,i.c1=r,i}function b5t(e,t){return GAe(e,e.c0,t)}function w5t(e,t){return GAe(e,e.c1,t)}function GAe(e,t,i){return we(i,e.ray.origin,fe(i,e.ray.direction,t))}new $v(()=>({c0:0,c1:0,ray:null}));function C$(e){return e?[qi(e[0]),qi(e[1]),qi(e[2]),qi(e[3]),qi(e[4]),qi(e[5])]:[qi(),qi(),qi(),qi(),qi(),qi()]}function jAe(){return[$(),$(),$(),$(),$(),$(),$(),$()]}function Rz(e,t){for(let i=0;i<Cv.NUM;i++)bB(e[i],t[i])}function HAe(e,t,i,r=Rct){const s=As(eee.get(),t,e);Ks(s,s);for(let n=0;n<BY.NUM;++n){const o=jh(KK.get(),Oct[n],s);he(r[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}qAe(i,r)}function qAe(e,t){sl(t[mt.FAR_BOTTOM_LEFT],t[mt.NEAR_BOTTOM_LEFT],t[mt.NEAR_TOP_LEFT],e[Mr.LEFT]),sl(t[mt.NEAR_BOTTOM_RIGHT],t[mt.FAR_BOTTOM_RIGHT],t[mt.FAR_TOP_RIGHT],e[Mr.RIGHT]),sl(t[mt.FAR_BOTTOM_LEFT],t[mt.FAR_BOTTOM_RIGHT],t[mt.NEAR_BOTTOM_RIGHT],e[Mr.BOTTOM]),sl(t[mt.NEAR_TOP_LEFT],t[mt.NEAR_TOP_RIGHT],t[mt.FAR_TOP_RIGHT],e[Mr.TOP]),sl(t[mt.NEAR_BOTTOM_LEFT],t[mt.NEAR_BOTTOM_RIGHT],t[mt.NEAR_TOP_RIGHT],e[Mr.NEAR]),sl(t[mt.FAR_BOTTOM_RIGHT],t[mt.FAR_BOTTOM_LEFT],t[mt.FAR_TOP_LEFT],e[Mr.FAR])}function rb(e,t){for(let i=0;i<Cv.NUM;i++){const r=e[i];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}function Ect(e,t){return ZAe(e,Tct(t,XAe.get()))}function x5t(e,t){for(let i=0;i<Cv.NUM;i++){const r=e[i];if(!TGe(r,t))return!1}return!0}function Cct(e,t,i){return ZAe(e,Sct(t,i,XAe.get()))}function WAe(e,t){for(let i=0;i<Cv.NUM;i++)if(Or(e[i],t)>0)return!1;return!0}function Act(e,t){for(let i=0;i<Cv.NUM;i++)if(wGe(e[i],t))return!1;return!0}function ZAe(e,t){for(let i=0;i<Cv.NUM;i++)if(!xGe(e[i],t))return!1;return!0}var Mr,mt;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.TOP=3]="TOP",e[e.NEAR=4]="NEAR",e[e.FAR=5]="FAR"})(Mr||(Mr={})),function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(mt||(mt={}));const Mct={bottom:[mt.FAR_BOTTOM_RIGHT,mt.NEAR_BOTTOM_RIGHT,mt.NEAR_BOTTOM_LEFT,mt.FAR_BOTTOM_LEFT],near:[mt.NEAR_BOTTOM_LEFT,mt.NEAR_BOTTOM_RIGHT,mt.NEAR_TOP_RIGHT,mt.NEAR_TOP_LEFT],far:[mt.FAR_BOTTOM_RIGHT,mt.FAR_BOTTOM_LEFT,mt.FAR_TOP_LEFT,mt.FAR_TOP_RIGHT],right:[mt.NEAR_BOTTOM_RIGHT,mt.FAR_BOTTOM_RIGHT,mt.FAR_TOP_RIGHT,mt.NEAR_TOP_RIGHT],left:[mt.FAR_BOTTOM_LEFT,mt.NEAR_BOTTOM_LEFT,mt.NEAR_TOP_LEFT,mt.FAR_TOP_LEFT],top:[mt.FAR_TOP_LEFT,mt.NEAR_TOP_LEFT,mt.NEAR_TOP_RIGHT,mt.FAR_TOP_RIGHT]};var Cv,BY;(function(e){e[e.NUM=6]="NUM"})(Cv||(Cv={})),function(e){e[e.NUM=8]="NUM"}(BY||(BY={}));const Oct=[zi(-1,-1,-1,1),zi(1,-1,-1,1),zi(1,1,-1,1),zi(-1,1,-1,1),zi(-1,-1,1,1),zi(1,-1,1,1),zi(1,1,1,1),zi(-1,1,1,1)],XAe=new $v(Nie),Rct=jAe(),Pct=ve.getLogger("esri.views.3d.webgl-engine.lib.Camera");class xr{constructor(t=null,i=null,r=null){this._viewUp=$(),this._viewForward=$(),this._viewRight=$(),this._ray=Do(),this._viewport=zi(0,0,1,1),this._padding=zi(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=er(1,1e3),this._viewDirty=!0,this._viewMatrix=Ne(),this._projectionDirty=!0,this._projectionMatrix=Ne(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Ne(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Ne(),this._inverseProjectionDirty=!0,this._inverseProjectionMatrix=null,this._frustumDirty=!0,this._frustum=C$(),this._fullViewport=si(),this._pixelRatio=1,this.relativeElevation=0,_(t)&&pe(this._ray.origin,t),this._center=_(i)?Rn(i):$(),this._up=_(r)?Rn(r):Ze(0,0,1)}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center)}get ray(){return xe(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){ln(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get x(){return this._viewport[0]}set x(t){t+=this._padding[Vt.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(t){t+=this._padding[Vt.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[Vt.RIGHT]+this._padding[Vt.LEFT]}set fullWidth(t){this.width=t-(this._padding[Vt.RIGHT]+this._padding[Vt.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[Vt.TOP]+this._padding[Vt.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[Vt.TOP]+this._padding[Vt.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[Vt.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[Vt.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){this._padding[Vt.TOP]===t[Vt.TOP]&&this._padding[Vt.RIGHT]===t[Vt.RIGHT]&&this._padding[Vt.BOTTOM]===t[Vt.BOTTOM]&&this._padding[Vt.LEFT]===t[Vt.LEFT]||(this._viewport[0]+=t[Vt.LEFT]-this._padding[Vt.LEFT],this._viewport[1]+=t[Vt.BOTTOM]-this._padding[Vt.BOTTOM],this._viewport[2]-=t[Vt.RIGHT]+t[Vt.LEFT]-(this._padding[Vt.RIGHT]+this._padding[Vt.LEFT]),this._viewport[3]-=t[Vt.TOP]+t[Vt.BOTTOM]-(this._padding[Vt.TOP]+this._padding[Vt.BOTTOM]),Lf(this._padding,t),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(As(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const t=this.width,i=this.height,r=this.near*Math.tan(this.fovY/2),s=r*this.aspect;Ibe(this._projectionMatrix,-s*(1+2*this._padding[Vt.LEFT]/t),s*(1+2*this._padding[Vt.RIGHT]/t),-r*(1+2*this._padding[Vt.BOTTOM]/i),r*(1+2*this._padding[Vt.TOP]/i),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}get inverseProjectionMatrix(){return M(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=Ne()),this._inverseProjectionDirty&&Ks(this._inverseProjectionMatrix,this.projectionMatrix),this._inverseProjectionMatrix}set projectionMatrix(t){ln(this._projectionMatrix,t),this._projectionDirty=!1,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(t){this._fov=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return cat(this._fov,this.width,this.height)}set fovX(t){this._fov=aat(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return uat(this._fov,this.width,this.height)}set fovY(t){this._fov=lat(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Pr(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Ks(this._viewInverseTransposeMatrix,this.viewMatrix),Gc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const i=2*t-1;return 2*this.near*this.far/(this.far+this.near-i*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this._pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(t){pe(this._ray.origin,t.eye),pe(this._center,t.center),pe(this._up,t.up),Lf(this._viewport,t.viewport),Lf(this._padding,t.padding),po(this._nearFar,t.nearFar),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const i=t;return this._viewDirty=i._viewDirty,this._viewDirty||(ln(this._viewMatrix,t.viewMatrix),pe(this._viewRight,t.viewRight),pe(this._viewUp,t.viewUp),pe(this._viewForward,t.viewForward)),i._projectionDirty?this._projectionDirty=!0:(ln(this._projectionMatrix,t.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._inverseProjectionDirty=!0,this._frustumDirty=i._frustumDirty,this._frustumDirty||(Rz(this._frustum,t.frustum),this._frustumDirty=!1),i._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(ln(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Lf(this._fullViewport,t.fullViewport),this._pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new xr().copyFrom(this)}equals(t){return Ic(this.eye,t.eye)&&Ic(this._center,t.center)&&Ic(this._up,t.up)&&S3(this._viewport,t.viewport)&&S3(this._padding,t.padding)&&ACe(this._nearFar,t.nearFar)&&this._fov===t.fov&&this._pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(this._pixelRatio!==t.pixelRatio||Math.abs(t.fov-this._fov)>=.001)return!1;const i=5e-4,r=1-1e-10;zu(Xa,t.eye,t.center),zu(wj,this.eye,this._center);const s=Pe(Xa,wj),n=HH(Xa),o=HH(wj);return s*s>=r*n*o&&xQ(t.eye,this.eye)<Math.max(n,o)*i*i&&Xk(t.padding,this._padding)<.5&&Xk(t.viewport,this._viewport)<.5}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(hb(this.viewForward,xe(Xa,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,i){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(i||1)))}getScreenCenter(t=Ts()){return t[0]=(this.padding[Vt.LEFT]+this.width/2)/this._pixelRatio,t[1]=(this.padding[Vt.TOP]+this.height/2)/this._pixelRatio,t}getRenderCenter(t,i=.5,r=.5){return t[0]=this.padding[Vt.LEFT]+this.width*i,t[1]=this.padding[Vt.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const i=this.viewport,r=this.padding;t.setViewport(i[0]-r[3],i[1]-r[2],i[2]+r[1]+r[3],i[3]+r[0]+r[2])}applyProjection(t,i){t!==li&&pe(li,t),li[3]=1,jh(li,li,this.projectionMatrix);const r=Math.abs(li[3]);fe(li,li,1/r);const s=this.fullViewport;i[0]=ui(0,s[0]+s[2],.5+.5*li[0]),i[1]=ui(0,s[1]+s[3],.5+.5*li[1]),i[2]=.5*(li[2]+1),i[3]=r}unapplyProjection(t,i){const r=this.fullViewport;li[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],li[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],li[2]=(2*t[2]-1)*t[3],li[3]=t[3],jh(li,li,this.inverseProjectionMatrix),i[0]=li[0],i[1]=li[1],i[2]=li[2]}projectToScreen(t,i){this.projectToRenderScreen(t,xj),this.renderToScreen(xj,i)}projectToRenderScreen(t,i){if(li[0]=t[0],li[1]=t[1],li[2]=t[2],li[3]=1,jh(li,li,this.viewProjectionMatrix),li[3]===0)return null;fe(li,li,1/Math.abs(li[3]));const r=this.fullViewport;return"x"in i?(i.x=ui(0,r[0]+r[2],.5+.5*li[0]),i.y=ui(0,r[1]+r[3],.5+.5*li[1])):(i[0]=ui(0,r[0]+r[2],.5+.5*li[0]),i[1]=ui(0,r[1]+r[3],.5+.5*li[1]),i.length>2&&(i[2]=.5*(li[2]+1))),i}unprojectFromScreen(t,i){return this.unprojectFromRenderScreen(this.screenToRender(t,xj),i)}unprojectFromRenderScreen(t,i){if(As(kN,this.projectionMatrix,this.viewMatrix),!Ks(kN,kN))return null;const r=this.fullViewport;return li[0]=2*(t[0]-r[0])/r[2]-1,li[1]=2*(t[1]-r[1])/r[3]-1,li[2]=2*t[2]-1,li[3]=1,jh(li,li,kN),li[3]===0?null:(i[0]=li[0]/li[3],i[1]=li[1]/li[3],i[2]=li[2]/li[3],i)}constrainWindowSize(t,i,r,s=r){const n=t*this._pixelRatio,o=i*this._pixelRatio,a=Math.max(n-r/2,0),l=Math.max(this.fullHeight-o-s/2,0),c=-Math.min(n-r/2,0),h=-Math.min(this.fullHeight-o-s/2,0);return[a,l,r-c- -Math.min(this.fullWidth-n-r/2,0),s-h- -Math.min(o-s/2,0)]}computeUp(t){t===tt.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,i){const r=t[0]*this._pixelRatio,s=this.fullHeight-t[1]*this._pixelRatio;return i[0]=r,i[1]=s,i}renderToScreen(t,i){const r=t[0]/this._pixelRatio,s=(this.fullHeight-t[1])/this._pixelRatio;i[0]=r,i[1]=s}_computeUpGlobal(){xe(Xa,this.center,this.eye);const t=Ue(this.center);t<1?(he(this._up,0,0,1),this._markViewDirty()):Math.abs(Pe(Xa,this.center))>.9999*Ue(Xa)*t||(Tt(this._up,Xa,this.center),Tt(this._up,this._up,Xa),Re(this._up,this._up),this._markViewDirty())}_computeUpLocal(){Rv(Xa,this.eye,this.center),Math.abs(Xa[2])<=.9999&&(fe(Xa,Xa,Xa[2]),he(this._up,-Xa[0],-Xa[1],1-Xa[2]),Re(this._up,this._up),this._markViewDirty())}_compareAndSetView(t,i){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?Ic(t,i)||(pe(i,t),this._markViewDirty()):Pct.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(HAe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(pB(this._viewMatrix,this.eye,this._center,this._up),he(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),he(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),he(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const li=si(),kN=Ne(),Xa=$(),wj=$(),xj=ko();var Vt;(function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"})(Vt||(Vt={}));const Pz={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};class Fie{constructor(t){this.createCamera=t,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:Pz.desiredScreenFlow},this.source=t(),this.target=t()}clone(){const t=new Fie(this.createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,i,r){this.source!==t&&this.source.copyFrom(t),this.target!==i&&this.target.copyFrom(i),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:Pz.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){const i=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}class Ict{constructor(){this.segments=[]}get time(){return this.segments.reduce((t,i)=>t+i.time,0)}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1),t*=this.time;let r=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(t<=a.time||o===this.segments.length-1){i=this.segmentInterpolateComponentsAt(a,t/a.time,i),n.hasPan?i.pan=(r+l.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate?i.rotate=(s+l.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1;const c=i.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;return n.hasZoom?i.zoom=(c-h)/(p-h):i.zoom=1,i}t-=a.time,r+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(t,i,r){return t.interpolateComponentsAt(i,r)}}class Tj{constructor(t){t&&this.update(t)}get time(){return this._time}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const t=this.definition,i=t.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*t.source.pixelsPerPanAtZoom(r);const n=(t.source.pixelsPerRotateAtZoom(r)+t.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const t=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;r&&(s&&(o=(i/t-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(t/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:r?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=t*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(t*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(t){if(t===0||t===1)return t;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-t-i)/(r-i)}return t}_interpolateComponentsPan(t){if(t===0||t===1)return t;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*t*this._time)-1))/(i*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1);const r=this._interpolateComponentsZoom(t),s=this._interpolateComponentsPan(t),n=this._interpolateComponentsRotate(t);return i?(i.zoom=r,i.pan=s,i.rotate=n):i={zoom:r,pan:s,rotate:n},i}}function $ct(e,t,i){const r=t-e.compared.sourceZoom,s=e.halfWindowPanAtZoom(r);return-e.halfWindowSize*(i.ascensionFactor*Math.LN2*e.compared.pan+s)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*s)}function Lct(e,t,i){const r=1/t,s=Math.log(e.compared.sourceZoom*r),n=1/e.desiredPixelFlow,o=1/Math.LN2,a=t-e.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(a))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*r*n*o*l*c-e.halfWindowSize*s*n*o*l+e.halfWindowSize*s*n*o*c/(a*a)}function Dct(e,t,i){const r=t-e.compared.sourceZoom,s=1/r,n=1/t,o=Math.log(e.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(r))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function Nct(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function Fct(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function kct(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function Uct(e,t,i){return-e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function zct(e,t,i){return e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function Vct(e,t,i){return-2*e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function Bct(e,t,i){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function Gct(e,t,i){const r=Math.log(t/e.compared.targetZoom),s=1/e.desiredPixelFlow,n=1/Math.LN2,o=-t+e.compared.targetZoom,a=1/o,l=(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*r*s*n*a+e.halfWindowSize*r*s*n*l/(o*o)+e.halfWindowSize*s*n*a*l/t}function jct(e,t,i){const r=t-e.compared.targetZoom,s=1/r,n=1/t,o=Math.log(t/e.compared.targetZoom),a=(e.halfWindowPanAtZoom(t)+i.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function Hct(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function qct(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function Wct(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function Zct(e){const t=Math.LN2*e.compared.pan,i=e.compared.sourceZoom-e.compared.targetZoom,r=e.halfWindowPanAtZoom(i),s=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*r);return e.compared.sourceZoom<=e.compared.targetZoom?s*(t-r):s*(t+r)}function Xct(e,t){let i=Yct(e,t);const r={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,o=s?Nct:$ct,a=s?Fct:Lct,l=s?kct:Dct,c=n?Hct:Bct,h=n?qct:Gct,p=n?Wct:jct,f=C=>o(e,C,r)+Uct(e,C,r)+c(e,C,r),m=C=>a(e,C,r)+zct(e,C,r)+h(e,C,r),g=C=>l(e,C,r)+Vct(e,C,r)+p(e,C,r);let y=f(i);const x=Zct(e);let b;const S=t.maximumIterations||20,T=t.maximumDistance!=null?t.maximumDistance:1/0;for(b=0;b<S;b++){const A=(m(i)+1e-6)/g(i);if(isNaN(A)||i>=T&&A<0){if(!isFinite(T))return null;i=T,y=f(i);break}if(i-=A,i<e.compared.sourceZoom||i<e.compared.targetZoom)return null;const O=f(i);if(Math.abs(O-y)/y<=.005)break;y=O}return y>x*(1-.3)||i<e.compared.sourceZoom||i<e.compared.targetZoom?null:i}function Yct(e,t){const i=Math.max(e.compared.sourceZoom,e.compared.targetZoom),r=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return r<i?t.maximumDistance!=null?i+(t.maximumDistance-i)/2:1.5*i:t.maximumDistance?Math.min(t.maximumDistance,r):r}class Jct extends Ict{constructor(t,i){super(),this._preallocSegments=[new Tj,new Tj,new Tj],this.update(t,i)}update(t,i){if(!t)return;this.definition?this.definition.copyFrom(t):this.definition=t.clone();let r=null;i&&i.apex&&(r=Xct(t,i.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r==null?this._updateWithoutApex():this._updateWithApex(r,i.apex)}segmentInterpolateComponentsAt(t,i,r){return r=t.interpolateComponentsAt(i,r),t===this._ascensionSegment?r.zoom=Oie(r.zoom):t===this._descensionSegment&&(r.zoom=w6(r.zoom)),r}_updateWithApex(t,i){const[r,s,n]=this._preallocSegments,o=i.ascensionFactor!=null?i.ascensionFactor:.5,a=Math.min(1-o,i.ascensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=t,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=t,s.definition.compared.targetZoom=t,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=t,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[t]=this._preallocSegments;t.update(this.definition),this.segments.push(t)}}const Qct={zoom:0,pan:0,rotate:0};class Kct{constructor(t){this.createCamera=t,this._time=0,this.definition=new Fie(t),this.path=new Jct}get time(){return this._time}update(t,i,r){this.definition.update(t,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(Ave(this.path.time),r),this._easing=r.easing?r.easing:this._time>=1e3?BAe:kL}cameraAt(t,i){i=i||this.createCamera(),t=Math.min(Math.max(0,t),1),t=this._normalizedEasing(t);const r=this.path.interpolateComponentsAt(t,Qct);return i.interpolate(this.definition.source,this.definition.target,r),i}_normalizedEasing(t){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(t,this._time)-i)/(r-i)}_applyTimeSettings(t,i){const r=i.speedFactor!=null?i.speedFactor:1;i.duration!=null?t=i.duration:i.speedFactor!=null&&(t=t/r);const s=i.minDuration!=null?i.minDuration:Pz.minDuration/r,n=i.maxDuration!=null?i.maxDuration:Pz.maxDuration/r;return Math.min(Math.max(s,t),n)}}const eut=$();class tut{constructor(t){this.currentTime=0,this._animation=new Kct(()=>new Whe(t)),this._current=new Whe(t)}get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}update(t,i,r){const s=this._animation.definition.source,n=this._animation.definition.target,o=xe(eut,i.center,t.center),a=Ue(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),pe(s.lookAtDirection,o),pe(n.lookAtDirection,o),s.copyFromRenderCamera(t),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,t.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(t,i){return this._animation.cameraAt(t,this._current),i=i||new xr,this._current.copyToRenderCamera(i),i}step(t,i){return this.finished||(this.currentTime=this.currentTime+Ave(t),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}}var bs;(function(e){e.Ready="ready",e.Rejected="rejected",e.Running="running",e.Stopped="stopped",e.Finished="finished"})(bs||(bs={}));let $T=class extends Ee{constructor(){super(...arguments),this.state=bs.Ready}get active(){return this.state===bs.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=bs.Stopped,!0)}finishController(){this.state=bs.Finished}get steppingFinished(){return!1}};u([d({readOnly:!0})],$T.prototype,"active",null),u([d()],$T.prototype,"state",void 0),$T=u([L("esri.views.3d.state.controllers.CameraController")],$T);let A$=class extends $T{get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(mi()),this._asyncResult=null),this.state===bs.Finished||this.state===bs.Stopped?this.state===bs.Finished?e.resolve():e.reject(mi()):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=bs.Running,_(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!_(this.viewAnimation)||this.state!==bs.Ready&&this.state!==bs.Running||(this.viewAnimation.state===dM.State.FINISHED?this.finish():this.viewAnimation.state===dM.State.STOPPED&&(this.state=bs.Stopped))}onControllerEnd(){_(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===bs.Finished?this.viewAnimation.finish():this.state===bs.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===bs.Finished?this._asyncResult.resolve():this._asyncResult.reject(mi()))}finish(){this.finishController()}};A$=u([L("esri.views.3d.state.controllers.AnimationController")],A$);let j0=class extends A${constructor(e){super(e),this.view=null,this.mode="interaction",this.hasTarget=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.animation=new tut(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new dM}get isInteractive(){return this.mode==="interaction"}begin(e,t){this.hasTarget=!0;const i=this.animationSettings(t);UN.copyFrom(this.view.state.camera);const r=cd(this.view.state.viewingMode);this.intersectionHelper.intersectRay(UN.ray,r,Zhe)&&(UN.center=Zhe),this.animation.update(UN,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this.hasTarget&&this.animation.finished}stepController(e,t){this.hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return me(F({apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0}},e),{easing:typeof e.easing=="string"?gct[e.easing]:e.easing})}};u([d({constructOnly:!0})],j0.prototype,"view",void 0),u([d({constructOnly:!0})],j0.prototype,"mode",void 0),j0=u([L("esri.views.3d.state.controllers.PointToPointAnimationController")],j0);const UN=new xr,Zhe=$();function YAe(e,t,i){return iut(e,e.screenToRender(t,Je.get()),i)}function iut(e,t,i){const r=po(Je.get(),t);if(r[2]=0,!e.unprojectFromRenderScreen(r,i.origin))return null;const s=po(Je.get(),t);s[2]=1;const n=e.unprojectFromRenderScreen(s,Je.get());return M(n)?null:(xe(i.direction,n,i.origin),i)}function SO(e,t,i){return kie(e,e.screenToRender(t,Je.get()),i)}function kie(e,t,i){pe(i.origin,e.eye);const r=he(Je.get(),t[0],t[1],1),s=e.unprojectFromRenderScreen(r,Je.get());return M(s)?null:(xe(i.direction,s,i.origin),i)}function Uie(e,t,i,r){const s=SO(t,i,rut);return Yb(e,s,r)}const rut=Do();var MM;(function(e){e[e.Ellipsoid=0]="Ellipsoid",e[e.Silhouette=1]="Silhouette"})(MM||(MM={}));const JAe=30,Iz=[1,3e8],QAe=70;function KT(e,t,i){return i[0]=t[0]/(e.fullWidth/e.pixelRatio),i[1]=t[1]/(e.fullHeight/e.pixelRatio),i}function GY(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function Vb(e,t,i){const r=sd(eee.get(),i[3],i);M(r)||(xe(hr,e.eye,t),Xe(hr,hr,r),e.eye=we(hr,hr,t),xe(hr,e.center,t),Xe(hr,hr,r),e.center=we(hr,hr,t),e.up=Xe(hr,e.up,r))}function sut(e,t,i,r){return t2(e,YAe(t,i,Bie),r)}function jY(e,t,i,r){return t2(e,SO(t,i,Bie),r)}function zie(e,t,i,r){const s=Je.get();let n=1-i;xe(s,t,e.eye);const o=Ue(s);let a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||(fe(s,s,n),e.eye=we(hr,e.eye,s),e.center=Pn(hr,e.center,t,n))}function KAe(e,t,i){t.getScreenCenter(Xhe),Uie(e,t,Xhe,hr)&&(t.center=hr);const r=t.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=fe(Je.get(),t.viewForward,s);t.eye=xe(hr,t.center,n)}const Xhe=Ts();function Sj(e,t){he(t,0,0,0);for(const i of e)we(t,t,i);fe(t,t,1/e.length)}function sk(e,t,i,r){return Math.sin(e/Ue(t))*(i+r.radius)}function Yhe(e,t,i,r){return sk(Math.PI/2,t,i,r)+(e-Math.PI/2)}var fa;(function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"})(fa||(fa={}));const Jhe={Elevation:3e4,Angle:Yt(6)},QI={Pole:.95,Angle:Yt(18),Tilt:45},eMe=Yt(80);function tMe(e,t,i,r,s,n){const o=$(),a=fo();let l=!0,c=!0;return e.intersectScreen(i,o,n)?a[3]=Ue(o):(c=!1,t.aboveGround&&s!==MM.Ellipsoid?a[3]=Math.max(Ue(t.center),.9*r.radius):a[3]=Ue(t.eye)-t.relativeElevation,s===MM.Silhouette?M$(a,t,i,o):l=Uie(a,t,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function x6(e,t,i,r){return Ue(e.eye)-r.radius>Jhe.Elevation?fa.Horizontal:i?(SO(e,t,nde),-Math.sign(e.relativeElevation)*(.5*Math.PI+iee(e.eye,nde.direction))<Jhe.Angle?fa.Vertical:fa.Horizontal):fa.Vertical}function iMe(e,t,i){xe(Ej,i,t),e.eye=xe(hr,e.eye,Ej),e.center=xe(hr,e.center,Ej)}const Ej=$();function M$(e,t,i,r){const s=SO(t,i,Bie);return!M(s)&&(aO(e,s,zN),Yb(e,s,r)?!(uo(zN,s.origin)<uo(r,s.origin))||(pe(r,zN),!1):(xe(V2,t.eye,t.center),Re(V2,V2),$we(V2,-Pe(Re(V2,V2),zN),Qhe),t2(Qhe,s,r),!1))}const zN=$(),V2=$(),Qhe=qi();function rMe(e,t,i,r,s,n){let o;if(Tt(Dz,e,t),xe(jN,e,t),Ue(e)<=s||!r.aboveGround){Tt(i,jN,r.eye);const a=Pe(e,t)/(Ue(e)*Ue(t)),l=Math.cos(He(Sb.normalize(Yt(n)),0,eMe));o=-Yn(a)-Math.max(0,Ue(t)-s)/(l*s)}else xe(Khe,r.eye,r.center),Tt(i,jN,Khe),o=-Ue(jN)/s;return Re(i,i),fe(i,i,Ue(Dz)),o}const Khe=$();function ede(e,t,i,r){let s,n;const o=Math.cos(He(Sb.normalize(Yt(r)),0,eMe));return s=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):Yn(t/i),n=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):Yn(e/i),(n-s)*i}function nut(e,t,i,r,s,n,o,a,l,c){const h=ede(e[2],t[2],o[3],l),p=c?ede(e[0],t[0],o[3],180):t[0]-e[0],f=Math.sin(a)*p-Math.cos(a)*h,m=Math.cos(a)*p+Math.sin(a)*h;Re(hr,s);const g=c?f/Math.sqrt(Math.abs(o[3]**2-Pe(i,hr)**2)):f/o[3],y=m/Math.sqrt(Math.abs(o[3]**2-Pe(i,r)**2));Li(n,g,y)}function sMe(e,t,i,r,s,n,o,a,l,c){Tt(Dz,e,t),tZ(n.up,n.eye,VN,BN,GN),tZ([0,0,1],n.eye,iv,gb,lMe),pe(i,gb),pe(r,iv),Re(i,i),fe(i,i,Ue(Dz)),dae(e,Re(BN,BN),Re(GN,GN),Re(VN,VN),tde),dae(t,BN,GN,VN,ide),nut(tde,ide,e,iv,gb,s,o,a,l,c)}function out(e,t,i,r,s,n,o){sd($z,s,r),sd(Lz,o,n),As(HC,$z,Lz),xe(t,e,i),Xe(t,t,HC),we(t,t,i)}function nMe(e,t,i,r,s,n){sd($z,r,i),sd(Lz,n,s),As(HC,$z,Lz),xe(hr,e.eye,t),Xe(hr,hr,HC),e.eye=we(hr,hr,t),xe(hr,e.center,t),Xe(hr,hr,HC),e.center=we(hr,hr,t),xe(hr,e.up,t),Xe(hr,hr,HC),e.up=we(hr,hr,t)}function Vie(e,t,i,r,s,n,o=QI.Pole,a=QI.Angle){const l=Math.abs(r)>Math.PI-a||Math.abs(r)<a,c=Math.abs(e[2])<i*o||Math.abs(t)>i;return!!(l&&c&&n.aboveGround&&s<QI.Tilt)}function oMe(e,t,i,r,s,n){if(n)c$(i,r,rde),Vb(t,e,rde);else{const o=rMe(i,r,sde,t,e[3],s);Vb(t,e,l$(sde,o))}}function aMe(e,t,i,r,s,n,o){const a=o?20:1,l=1e-12;let c,h;pe(_w,r),HN.copyFrom(t);for(let p=0;p<a&&uo(i,_w)>l&&(c=uo(i,_w),sMe(i,_w,gb,iv,pR,HN,e,s,n,o),nMe(HN,e,iv,pR[1],gb,pR[0]),out(_w,_w,e,iv,pR[1],gb,pR[0]),h=uo(i,_w),h<c||p===0);p++)t.copyFrom(HN)}function aut(e,t,i,r,s,n,o){Vie(i,Pe(t.up,i),e[3],-Sb.normalize(Yt(s)),n,t,QI.Pole,QI.Angle)?aMe(e,t,i,r,-Sb.normalize(Yt(s)),n,o):oMe(e,t,i,r,n,o)}function lut(e,t,i,r,s,n){const{eye:o}=e;tZ([0,0,1],o,iv,gb,lMe);const a=t.translation[0]*i.pan,l=s.mode==="zoom"?0:t.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-Pe(e.center,iv)**2/Ue(e.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,p=-Math.cos(n)*l+Math.sin(n)*a;switch(Iu(r.pan.matrix,r.pan.matrix,h,iv),r.pan.enabled=!0,s.mode){case"pan":Iu(r.pan.matrix,r.pan.matrix,p,gb),r.pan.enabled=!0;break;case"zoom":r.zoom=-t.translation[1]*i.zoom}}function cut(e,t,i,r,s){const{eye:n,viewRight:o}=e,a=Tt(Je.get(),o,n),l=t.translation[0]*i.pan;switch(l!==0&&(Iu(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{const c=t.translation[1]*i.pan;c!==0&&(Iu(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-t.translation[1]*i.zoom}}function uut(e,t,i,r,s,n,o,a,l){Vie(e.center,Pe(e.up,e.center),Ue(e.center),-Sb.normalize(Yt(n)),o,t)?lut(t,i,r,a,l,-Sb.normalize(Yt(s))):cut(t,i,r,a,l)}const iv=$(),gb=$(),lMe=$(),VN=$(),BN=$(),GN=$(),tde=$(),ide=$(),pR=Ke(),rde=wO(),$z=Ne(),Lz=Ne(),HC=Ne(),_w=$(),hr=$(),jN=$(),HN=new xr,Dz=$(),sde=$(),Bie={origin:$(),direction:$()},nde={origin:$(),direction:$()},ode=.6,Cj=4,hut=12,dut=60,put=200;let Nz=class extends j0{constructor(){super(...arguments),this.zoomLocation=$(),this.tmpCamera=new xr,this.tmpViewDir=$(),this.tmpRayDir={origin:$(),direction:$()},this.targetOnSphere=$(),this.tmpCenter=$(),this.constraintOptions={selection:jr.ALL_EXCEPT_COLLISION,interactionType:ni.ZOOM,interactionFactor:null,interactionStartCamera:new xr,interactionDirection:null,tiltMode:zo.TUMBLE},this.sphere=fo()}initialize(){this.intersector=cd(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r);let s=!1,n=!1;this.intersectionHelper.intersectScreen(t,this.zoomLocation,this.view.map.ground.opacity===0?fut:{})&&(s=e>0,n=!0),this.tmpCamera.copyFrom(i.camera),s?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:pe(this.zoomLocation,this.tmpCamera.center),this._updateCamera(this.tmpCamera,e,this.zoomLocation,t,n),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:kL}}_updateCamera(e,t,i,r,s){const n=Ri(this.view.spatialReference),o=x6(e,r,s,n);let a;this.view.camera.position.hasZ&&(a=Math.abs(this.view.camera.position.z)),Re(WN,e.eye),fe(WN,WN,-1),SO(e,r,this.tmpRayDir),Re(this.tmpRayDir.direction,this.tmpRayDir.direction);const l=Math.max(Math.min(hut,1/Math.abs(Pe(WN,this.tmpRayDir.direction)))*a,put);if(o===fa.Horizontal){let c=ode**t;this.sphere[3]=Ue(i),xe(this.tmpViewDir,e.center,e.eye);const h=Math.min(Ue(this.tmpViewDir),l);let p=h*c;if(c<=1&&p<Cj&&(p=Cj,c=p/h),Math.abs(h-p)<1e-6)return;const f=Ue(e.center);if(this.sphere[3]!==f){const m=this.sphere[3]+c*(f-this.sphere[3]);e.center=fe(qN,e.center,m/f)}fe(this.tmpViewDir,this.tmpViewDir,-c),e.eye=we(qN,e.center,this.tmpViewDir),Js(this.view,e,this.constraintOptions),uo(i,e.center)>1e-12&&Uie(this.sphere,e,r,this.targetOnSphere)&&aut(this.sphere,e,i,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=ode**Math.abs(t);const h=t>0?1:-1;xe(this.tmpViewDir,i,e.eye);const p=Ue(this.tmpViewDir),f=this.view._stage.renderView.getMinimalDepthForArea(null,r[0],r[1],this.view.state.camera,dut);let m=f?Math.min(l,f):l;m=s?Math.min(m,p):m,fe(this.tmpRayDir.direction,this.tmpRayDir.direction,m),we(i,this.tmpRayDir.origin,this.tmpRayDir.direction);let g=m*c;const y=Math.max(Cj,1.01*e.nearFar[0]);if(t>0&&g<y&&(g=y,c=g/m),Math.abs(m-g)<1e-6)return;fe(this.tmpRayDir.direction,this.tmpRayDir.direction,h*(1-c)),e.eye=we(qN,e.eye,this.tmpRayDir.direction),e.center=we(qN,e.center,this.tmpRayDir.direction)}TO(this.view,e)}};Nz=u([L("esri.views.3d.state.controllers.global.ZoomStepController")],Nz);const qN=$(),WN=$(),fut={exclude:new Set([Rf])},mut=.6,gut=4,yut=60,vut=14,_ut=200;let Fz=class extends j0{constructor(){super(...arguments),this.zoomLocation=$(),this.tmpCamera=new xr,this.tmpRayDir=$(),this.tmpCenter=$(),this.constraintOptions={selection:jr.ALL,interactionType:ni.ZOOM,interactionFactor:null,interactionStartCamera:new xr,interactionDirection:null,tiltMode:zo.TUMBLE}}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r),this.tmpCamera.copyFrom(i.camera);const s=cd(this.view.state.viewingMode);e>0?(this.view.map.ground.opacity===0?this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation,wut):this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:pe(this.zoomLocation,this.tmpCamera.center);const n=mut**e;let o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,t[0],t[1],this.view.state.camera,yut);xe(ZN,this.tmpCamera.eye,this.zoomLocation),Re(ZN,ZN);const a=Math.max(Math.min(vut,1/Math.abs(Pe(but,ZN)))*Math.abs(this.view.camera.position.z),_ut);if(o=o?Math.min(o,a):a,o){const l=$();xe(l,this.zoomLocation,this.tmpCamera.eye),o<Ue(l)&&(Re(l,l),we(this.zoomLocation,this.tmpCamera.eye,fe(l,l,o)))}this._updateCamera(this.tmpCamera,n,this.zoomLocation),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:kL}}_updateCamera(e,t,i){xe(this.tmpRayDir,i,e.eye);const r=Ue(this.tmpRayDir);let s=r*t;const n=t<=1,o=Math.max(gut,1.01*e.nearFar[0]);n&&s<o&&(s=o,t=s/r),Math.abs(r-s)<1e-6||(fe(this.tmpRayDir,this.tmpRayDir,t),e.eye=xe(ade,i,this.tmpRayDir),e.center=Pn(ade,e.center,i,1-t),Js(this.view,e,this.constraintOptions))}};Fz=u([L("esri.views.3d.state.controllers.local.ZoomStepController")],Fz);const ade=$(),but=Ze(0,0,1),ZN=$(),wut={exclude:new Set([Rf])};function xut(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}function Gie(e,t){if(e.pointerType==="touch")return!1;switch(t){case"primary":return e.button===0;case"secondary":return e.button===2;case"tertiary":return e.button===1}}class Tut extends qa{constructor(t,i){super(!0),this.view=t,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(t){const i=t.data;if(xut(i,"primary")){const r=this.view.state.isGlobal?new Nz({view:this.view,mode:"animation"}):new Fz({view:this.view,mode:"animation"});this.view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),Ts(i.x,i.y)),t.stopPropagation()}}}let Bb=class extends $T{constructor(){super(...arguments),this.startCamera=new xr,this.currentCamera=new xr}get isInteractive(){return!0}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=bs.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}};Bb=u([L("esri.views.3d.state.controllers.InteractiveController")],Bb);var _u;(function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"})(_u||(_u={}));const Sut=7,Aj=90;let qC=class extends Bb{constructor(e){super(e),this.view=null,this.pivot=_u.CENTER,this.lastPoint=Ke(),this.tmpWorldUp=$(),this.tmpViewDir=$(),this.tmpRotCurPoint=Ke(),this.tmpTransf=Ne(),this.tmpAxis=$(),this.tmpPivotPoint=$(),this.pivotPos=$(),this.constraintOptions={selection:jr.ALL,interactionType:ni.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:zo.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.rotScale=this.pivot===_u.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case _u.EYE:pe(this.pivotPos,this.startCamera.eye),this.constraintOptions.interactionType=ni.LOOK_AROUND,this.constraintOptions.tiltMode=zo.LOOK_AROUND,this.constraintOptions.selection=jr.NONE;break;case _u.CENTER:{const t=this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos);t||pe(this.pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=ni.TUMBLE,this.constraintOptions.tiltMode=zo.TUMBLE,this.constraintOptions.selection=jr.ALL&~jr.DISTANCE;break}}this.constraintOptions.interactionStartCamera=this.startCamera,KT(this.startCamera,e,this.lastPoint)}}_constrainPivotPoint(e,t){const i=this.startCamera,r=$();xe(r,this.pivotPos,i.eye);const s=Ue(r);let n=Math.min(s,Sut*Math.abs(this.view.camera.position.z));const o=Ri(this.view.spatialReference),a=Ts(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),l=x6(this.startCamera,a,!0,o);let c=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*Aj,Aj),h=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,Aj);c===void 0&&h===void 0||(c=c===void 0?h:c,h=h===void 0||l===fa.Horizontal?c:h,n=c>h?h:c,n=t?Math.min(n,s):n),Re(r,r),pe(this.pivotPos,we(this.tmpPivotPoint,i.eye,fe(this.tmpPivotPoint,r,n)))}update(e){if(this.active){switch(this.pivot){case _u.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this.pivotPos);break;case _u.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this.pivotPos)}Js(this.view,this.currentCamera,this.constraintOptions)}}end(){this.active&&this.finishController()}_applyRotation(e,t,i,r){this.view.renderCoordsHelper.worldUpAtPosition(r,this.tmpWorldUp),KT(e,t,this.tmpRotCurPoint);let s=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale,n=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;xe(this.tmpViewDir,i,r);const o=Ue(this.tmpViewDir),a=Yn(Pe(this.tmpViewDir,this.tmpWorldUp)/o);if(this.pivot===_u.EYE){s*=-.5;const l=.5*Math.PI-a,c=.5*Math.PI*.99;s=l-Math.max(-c,Math.min(c,l+s))}return s=He(s+a,La.min,La.max)-a,Tt(this.tmpAxis,e.up,this.tmpViewDir),this.pivot===_u.CENTER&&(n=-n),sd(this.tmpTransf,n,this.tmpWorldUp),Iu(this.tmpTransf,this.tmpTransf,s,this.tmpAxis),Xe(this.tmpViewDir,this.tmpViewDir,this.tmpTransf),e.up=Xe(Mj,e.up,this.tmpTransf),we(Mj,r,this.tmpViewDir),po(this.lastPoint,this.tmpRotCurPoint),Mj}};u([d({constructOnly:!0})],qC.prototype,"view",void 0),u([d()],qC.prototype,"pivot",void 0),qC=u([L("esri.views.3d.state.controllers.RotateController")],qC);const Mj=$();class Oj extends qa{constructor(t,i,r,s){super(!0),this.view=t,this.pointerAction=i,this.pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(t){const i=t.data;if(i.pointers.size>1||!Gie(t.data,this.pointerAction))return;const r=Ts(i.center.x,i.center.y);switch(i.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.cameraController=new qC({view:this.view,pivot:this.pivot}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}let nk=class extends Bb{constructor(e){super(e),this.view=null,this.pickPoint=$(),this.tmpP0=Ke(),this.panAxisAngle=wO(),this.tmpRayDir=$(),this.tmpRayDirPick=$(),this.targetOnSphere=$(),this.tmpRay={origin:$(),direction:$()},this.dragBeginPoint=Ts(),this.normalizedAnchorPoint=Ke(),this.constraintOptions={selection:jr.ALL_EXCEPT_COLLISION,interactionType:ni.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:zo.TUMBLE},this.sphere=fo(),this.hasPickPoint=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;po(this.dragBeginPoint,e),KT(this.startCamera,e,this.normalizedAnchorPoint);const t=Ri(this.view.spatialReference),i=tMe(this.intersectionHelper,this.startCamera,e,t,MM.Ellipsoid,this.view.map.ground.opacity===0?Eut:{});if(this.navMode=x6(this.startCamera,e,i.hasGeometryIntersection,t),this.navMode===fa.Horizontal)this.hasPickPoint=!!i.scenePickPoint,this.pickPoint=i.scenePickPoint,this.sphere=i.sphere;else{let r,s;SO(this.startCamera,e,this.tmpRay),Re(this.tmpRay.direction,this.tmpRay.direction),i.scenePickPoint&&(xe(this.tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),s=Ue(this.tmpRayDirPick)),this.view.camera.position.hasZ&&(r=Math.abs(this.view.camera.position.z));let n=He(JAe*r,Iz[0],Iz[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,QAe);n=o?Math.min(n,o):n,n=i.scenePickPoint?Math.min(n,s):n,this.hasPickPoint=!0,fe(this.tmpRay.direction,this.tmpRay.direction,n),we(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this.navMode===fa.Horizontal){xe(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=Ue(this.tmpRayDir);KT(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;if(this.hasPickPoint&&r<t){const n=1-(1-r/t)*(1-this.sphere[3]/Ue(this.currentCamera.center));this.currentCamera.center=fe(XN,this.currentCamera.center,n)}fe(this.tmpRayDir,this.tmpRayDir,-r/t),this.currentCamera.eye=we(XN,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=Af(this.dragBeginPoint,e),Js(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(M$(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),c$(this.pickPoint,this.targetOnSphere,this.panAxisAngle),Vb(this.currentCamera,this.sphere,this.panAxisAngle))}else{const t=Ue(this.tmpRay.direction);KT(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;fe(this.tmpRayDir,this.tmpRay.direction,1-r/t),this.currentCamera.eye=we(XN,this.currentCamera.eye,this.tmpRayDir),this.currentCamera.center=we(XN,this.currentCamera.center,this.tmpRayDir)}TO(this.view,this.currentCamera)}}end(){this.active&&this.finishController()}};u([d({constructOnly:!0})],nk.prototype,"view",void 0),nk=u([L("esri.views.3d.state.controllers.global.ZoomController")],nk);const XN=$(),Eut={exclude:new Set([Rf])};let ok=class extends Bb{constructor(e){super(e),this.view=null,this.tmpP=$(),this.tmpDir=$(),this.tmpN=$(),this.tmpP0=Ke(),this.tmpPoi=$(),this.tmpRayDir=$(),this.dragBeginPoint=Ts(),this.normalizedAnchorPoint=Ke(),this.constraintOptions={selection:jr.ALL,interactionType:ni.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:$(),tiltMode:zo.TUMBLE},this.plane=qi()}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;po(this.dragBeginPoint,e),KT(this.startCamera,e,this.normalizedAnchorPoint);const t=this.intersectionHelper.intersectScreenFreePointFallback(e,this.tmpP,this.view.map.ground.opacity===0?Cut:{});xe(this.tmpDir,this.tmpP,this.startCamera.eye);const i=Ue(this.tmpDir);let r;Re(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(r=Math.abs(this.view.camera.position.z));let s=He(JAe*r,Iz[0],Iz[1]);const n=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,QAe);s=n?Math.min(s,n):s,s=t?Math.min(s,i):s,fe(this.tmpDir,this.tmpDir,s),we(this.tmpP,this.startCamera.eye,this.tmpDir),xe(this.tmpN,this.startCamera.eye,this.startCamera.center),Re(this.tmpN,this.tmpN),this.tmpN[1]<0&&ll(this.tmpN,this.tmpN),iM(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;sut(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||pe(this.tmpPoi,this.currentCamera.center),KT(this.currentCamera,e,this.tmpP0);let t=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);po(this.normalizedAnchorPoint,this.tmpP0),xe(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const i=Ue(this.tmpRayDir);let r=i*(1-t);pe(this.constraintOptions.interactionDirection,this.tmpRayDir),fe(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(t)/i);const s=this.view.state.constraints.minimumPoiDistance;t>=0&&r<s&&(r=s,t=-(r-i)/i),Math.abs(i-r)<1e-6||(fe(this.tmpRayDir,this.tmpRayDir,t),this.currentCamera.eye=we(bw,this.currentCamera.eye,this.tmpRayDir),Pn(bw,this.currentCamera.center,this.tmpPoi,t),this.tmpPoi[2]>this.startCamera.center[2]?bw[2]=Math.max(this.startCamera.center[2],bw[2]):bw[2]=Math.min(this.startCamera.center[2],bw[2]),this.currentCamera.center=bw,this.constraintOptions.interactionFactor=Af(this.dragBeginPoint,e),Js(this.view,this.currentCamera,this.constraintOptions))}end(){this.active&&this.finishController()}};u([d({constructOnly:!0})],ok.prototype,"view",void 0),ok=u([L("esri.views.3d.state.controllers.local.ZoomController")],ok);const bw=$(),Cut={exclude:new Set([Rf])};class Aut extends qa{constructor(t,i,r){super(!0),this.view=t,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){const i=t.data;if(i.pointers.size>1||!Gie(t.data,this.pointerAction))return;const r=Ts(i.center.x,i.center.y);switch(i.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.view.state.isGlobal?this.cameraController=new nk({view:this.view}):this.cameraController=new ok({view:this.view}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}const Mut=$(),YN=$();function jie(){return{direction:$(),up:$()}}function cMe(e,t,i,r,s){let n=Re(Mut,e),o=Pe(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(Pe(t,r)),o<.99?(pe(n,t),a&&fe(n,n,-1)):n=null);let l=0;if(n){fe(YN,r,Pe(r,n)),xe(n,n,YN);const h=Pe(n,s)/(Ue(n)*Ue(s));Tt(YN,n,s),l=(Pe(YN,r)>0?1:-1)*Vu(Yn(h))}const c=Vu(Yn(-Pe(r,e)/Ue(e)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const uMe=Ze(0,1,0),hMe=Ze(0,0,1),fR=Ne(),Py=$(),Iy=$();function dMe(e,t,i,r=jie()){const{direction:s,up:n}=r;return Obe(fR,-Yt(t)),JA(fR,fR,Yt(i)),Xe(s,hMe,fR),fe(s,s,-1),Xe(n,uMe,fR),r}function Out(e,t,i,r){return cMe(t,i,r,hMe,uMe)}function Rut(e,t,i,r){const s=dMe(e,i,r),n=$();return fe(n,s.direction,-t),we(n,n,e),{up:s.up,eye:n,heading:i,tilt:r}}function Put(e){return Vu(e)}function Iut(e){return Yt(e)}function pMe(e,t,i,r,s){const n=e.renderSpatialReference,o=e.map&&e.spatialReference||t.spatialReference;return Go(t,Py,n),Go(t,Iy,n),Py[0]-=i/2,Iy[0]+=i/2,Py[1]-=r/2,Iy[1]+=r/2,Zn(Py,n,Py,o),Zn(Iy,n,Iy,o),s?(s.xmin=Py[0],s.ymin=Py[1],s.xmax=Iy[0],s.ymax=Iy[1],s.spatialReference=o):s=new yi(Py[0],Py[1],Iy[0],Iy[1],o),s}const $ut=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:dMe,directionToHeadingTilt:Out,eyeForCenterWithHeadingTilt:Rut,lookAtTiltToEyeTilt:Put,eyeTiltToLookAtTilt:Iut,toExtent:pMe},Symbol.toStringTag,{value:"Module"})),fMe=Ze(0,0,1),mMe=Re($(),Ze(1,1,1)),Lut=new Tb(-180,180),mR=Ne(),R1=$(),B2=$();function gMe(e,t,i,r=jie()){Tt(R1,e,fMe),Pe(R1,R1)===0&&Tt(R1,e,mMe),sd(mR,-Yt(t),e),Iu(mR,mR,-Yt(i),R1);const{up:s,direction:n}=r;return Tt(s,R1,e),Re(s,s),Xe(s,s,mR),Re(n,e),ll(n,n),Xe(n,n,mR),r}function Dut(e,t,i,r){const s=R1,n=B2;return Re(s,e),Tt(B2,s,fMe),Pe(B2,B2)===0&&Tt(B2,s,mMe),Tt(n,B2,s),cMe(t,i,r,s,n)}function Nut(e,t,i,r){const s={eye:$(),up:null,tilt:r,heading:i},n=R1;n[0]=e[0],n[1]=e[2],n[2]=-e[1];const o=t,a=Yt(i),l=Yt(r),c=Math.sin(a),h=Math.cos(a),p=Math.sin(l),f=Math.cos(l),m=Ue(n);let g;if(Math.abs(l)<1e-8)g=o+m;else{const le=m/p,z=tm(o/le),q=Math.PI-l-z;g=le*Math.sin(q)}const y=f*o,x=o*o*(p*p),b=h*h*x,S=g-y,T=S*S,C=b*(b+T-n[1]*n[1]);if(C<0)return fe(s.eye,n,g/m),s.tilt=0,s;const A=Math.sqrt(C),O=n[1]*S,D=b+T;let U;if(U=h>0?-A+O:A+O,Math.abs(D)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):fe(s.eye,n,g/m),s.tilt=0,Rj(s.eye),Pj(s,e);s.eye[1]=U/D;const k=c*c*x,B=p*o,j=h*B*s.eye[1],H=s.eye[1]*s.eye[1],K=1-H,ee=Math.sqrt(K),ce=b*H+k-2*j*ee*S+K*T;return Math.abs(ce)<1e-8?(fe(s.eye,n,g/m),s.tilt=0,Rj(s.eye),Pj(s,e)):(s.eye[0]=(K*(g*n[0]-y*n[0])-B*ee*(n[0]*s.eye[1]*h+n[2]*c))/ce,s.eye[2]=(K*(g*n[2]-y*n[2])-B*ee*(n[2]*s.eye[1]*h-n[0]*c))/ce,fe(s.eye,s.eye,g),Rj(s.eye),Pj(s,e))}function Rj(e){const t=e[1];e[1]=-e[2],e[2]=t}function Pj(e,t){const i=gMe(t,e.heading,e.tilt);return e.up=i.up,e}function Fut(e,t,i){const r=Ue(t),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-e)),n=tm(i/(s/Math.sin(e)));return Vu(e-n)}function kut(e,t,i){const r=Yt(e),s=Ue(t);return tm(i/(s/Math.sin(r)))+r}function yMe(e,t,i,r,s){let n,o,a,l;const c=t.latitude,h=Ri(e.spatialReference).radius,p=t.longitude,f=kat(c,i,h)/2;n=p-f,o=p+f;const m=Yt(c),g=(1+Math.sin(m))/(1-Math.sin(m)),y=(g+1)*Math.tan(r/h/2),x=y*y;function b(T){const C=Math.PI/2;return(T=Lke.normalize(T,-C))>C&&(T=Math.PI-T),T}if(a=1.5*Math.PI-2*Math.atan(.5*(y+Math.sqrt(4*g+x))),l=a+r/h,a=b(a),l=b(l),l<a){const T=l;l=a,a=T}if(a=Math.max(Vu(a),-90),l=Math.min(Vu(l),90),o=Lut.monotonic(n,o),o-n>180){const T=(o-n-180)/2;n+=T,o-=T}const S=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:at.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=S):s=new yi(n,a,o,l,S),e.spatialReference&&e.spatialReference.isWebMercator&&$g(s,!1,s),s}const Uut=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:gMe,directionToHeadingTilt:Dut,eyeForCenterWithHeadingTilt:Nut,lookAtTiltToEyeTilt:Fut,eyeTiltToLookAtTilt:kut,toExtent:yMe},Symbol.toStringTag,{value:"Module"}));function kz(e){return e.type==="point"}class vMe{constructor(t,i=null,r=0){this.array=t,this.spatialReference=i,this.offset=r}}function _Me(e){return"array"in e}function Ag(e,t,i="ground"){if(kz(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(_Me(t)){let r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,Ye(t.spatialReference,e.spatialReference),i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}function Uz(e,t){return e!=null&&(t==null||(t===tt.Local?!e.isGeographic||e.isWGS84||e.wkid===ap.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===ap.CGCS2000||e.wkid===ap.GCSMARS2000||e.wkid===ap.GCSMARS2000_SPHERE||e.wkid===ap.GCSMOON2000))}const bMe=ve.getLogger("esri.views.3d.support.cameraUtils"),wMe=39.37,xMe=96,HY=1,zut=8,Vut=5,TMe=1,lde=$(),JN=$(),But={heading:0,tilt:0},R0=new dt,Gut=new Tb(-20037508342788905e-9,20037508342788905e-9),jut=new Tb(-180,180);var za;function UL(e){return e.spatialReference||at.WGS84}function EO(e){return e.viewingMode==="global"?Uut:$ut}function Hut(e,t,i,r,s){return EO(e).headingTiltToDirectionUp(t,i,r,s)}function S0(e,t){if(M(t))return null;const i=e.renderSpatialReference,r=EO(e).headingTiltToDirectionUp,s=$();if(!Go(t.position,s,i))return null;const n=r(s,t.heading,t.tilt);fe(n.direction,n.direction,e.state.camera.distance),we(n.direction,n.direction,s);const o=c2(e,s,n.direction,n.up);return o.fov=Yt(t.fov),o}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(za||(za={}));const G2=$();function OM(e,t,i){const r=e.renderSpatialReference,s=T6(e,t.eye,t.viewForward,t.up,But);let n=UL(e);return Zn(t.eye,r,G2,n)||(n=at.WGS84,Zn(t.eye,r,G2,n)),M(i)?new ju(new dt(G2,n),s.heading,s.tilt,Vu(t.fov)):(i.position.x=G2[0],i.position.y=G2[1],i.position.z=G2[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=Vu(t.fov),i)}function Hie(e,t,i){const r=e.state.camera,s=r.width/2/r.pixelRatio;return e.renderCoordsHelper.viewingMode===tt.Global&&i!=null&&(t*=Math.cos(Yt(i))),t/=e.renderCoordsHelper.unitInMeters,s/(xMe*wMe/t)/Math.tan(r.fovX/2)}function $S(e,t,i){const r=e.state.camera,s=t*Math.tan(r.fovX/2),n=r.width/2/r.pixelRatio;let o=xMe*wMe/(n/s);return e.renderCoordsHelper.viewingMode===tt.Global&&(o/=Math.cos(Yt(i))),o*=e.renderCoordsHelper.unitInMeters,o}function SMe(e,t,i,r,s,n){return EMe(e,t,Hie(e,i,t.latitude),r,s,n)}function EMe(e,t,i,r,s,n){if(eS(n)){const a=new CO(n.signal);return O$(e,r.heading,r.tilt,t,i,s,a),void a.resolver.promise.then(l=>{const c=Vz(e,l,r.fov);if(!M(c))return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=O$(e,r.heading,r.tilt,t,i,s);return Vz(e,o,r.fov,n)}function T6(e,t,i,r,s){return EO(e).directionToHeadingTilt(t,i,r,s)}function qut(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,R0,e.spatialReference)&&Ye(Ag(e.elevationProvider,R0),0)>R0.z-TMe)}async function Wut(e,t,i){if(!e.renderCoordsHelper.fromRenderCoords(t,R0,e.spatialReference))return!1;const r=await e.elevationProvider.queryElevation(R0.x,R0.y,R0.z,R0.spatialReference,"ground",i);return Ye(r,0)>R0.z-TMe}async function Zut(e,t,i){const r=$();if(t)if(t instanceof dt){if(Go(t,r,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const s=await e.elevationProvider.queryElevation(t.x,t.y,t.z,t.spatialReference,"ground",i);return _(s)&&e.renderCoordsHelper.setAltitude(r,s),r}}else pe(r,t);else pe(r,e.state.camera.center);return r}function Xut(e,t){const i=$();if(t&&t instanceof dt){if(Go(t,i,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const r=Ag(e.elevationProvider,t);_(r)&&e.renderCoordsHelper.setAltitude(i,r)}}else pe(i,t||e.state.camera.center);return i}function O$(e,t,i,r,s,n,o){const a=r&&r instanceof dt?r:null;if(eS(o))return Zut(e,r,o.signal).then(c=>{qY(e,t,i,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=Xut(e,r);return qY(e,t,i,a,l,s,n,o)}function qY(e,t,i,r,s,n,o,a){if(M(r)){const p=e.renderSpatialReference;if(r=Ob(s,p,UL(e)),M(r))return null}n=Math.max(n,e.state.constraints.minimumPoiDistance);const l=Qut(e,t,i,s,n,o),c=(0,EO(e).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===za.ADJUST&&e.viewingMode==="global"&&i>0){const p=()=>{const m=CMe(e,s,n,eht(e,n,i,s));return o=i-m<1?za.LOCKED:za.ADJUST,qY(e,t,m,r,s,n,o,a)},f=e.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(qut(e,c.eye))return p();if(eS(a))return Wut(e,c.eye,a.signal).then(m=>m?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:Rn(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||eS(a)?{center:$(),eye:$(),up:$(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=Rn(s),h.heading=c.heading,h.tilt=c.tilt,eS(a)&&a.resolver.resolve(h),h}function KI(e,t,i,r,s,n=null){const o=t.zmax!=null&&t.zmin!=null;let a,l,c;if(e.state.isGlobal){if(!Uz(t.spatialReference,tt.Global))return eS(n)&&n.resolver.reject(),null;const b=new dt(t.xmin,t.ymin,t.spatialReference),S=new dt(t.xmax,t.ymax,t.spatialReference),T=t.spatialReference.isGeographic?jut:Gut;a=new dt({x:T.center(b.x,S.x),y:(S.y+b.y)/2,z:o?(t.zmax+t.zmin)/2:null,spatialReference:t.spatialReference});const C=Ri(t.spatialReference),A=Fat(a,b,S);l=A.lon,c=A.lat,T.diff(b.x,S.x)>T.range/2&&(l+=C.halfCircumference),l=Math.min(l,C.halfCircumference),c=Math.min(c,C.halfCircumference)}else{const b=Ye(e.renderSpatialReference,t.spatialReference);b.equals(t.spatialReference)||(t=Tp(t,b)),l=t.xmax-t.xmin,c=t.ymax-t.ymin;const S=o?(t.zmax+t.zmin)/2:null;a=new dt({x:t.xmin+.5*l,y:t.ymin+.5*c,z:S,spatialReference:b})}const h=o?t.zmax-t.zmin:0,p=e.state.camera,f=1/Math.tan(p.fovX/2),m=1/Math.tan(p.fovY/2),g=1/Math.tan(p.fov/2),y=Math.max(.5*l*f,.5*c*m,.5*h*g)/HY;if(eS(n)){const b=new CO(n.signal);return O$(e,i,r,a,y,s,b),void b.resolver.promise.then(S=>{const T=Vz(e,S,e.camera.fov);if(!M(T))return n.resolver.resolve(T);n.resolver.reject()},S=>n.resolver.reject(S))}const x=O$(e,i,r,a,y,s);return Vz(e,x,e.camera.fov,n)}function Yut(e,t,i){const r=e.renderSpatialReference,s=Ob(i,r,UL(e));if(M(s))return null;const n=Math.tan(t.fovX/2),o=Math.tan(t.fovY/2),a=wQ(t.eye,i),l=2*a*n*HY,c=2*a*o*HY;return e.viewingMode==="global"?yMe(e,s,l,c):pMe(e,s,l,c)}function Jut(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>zut)return!0;const s=e.renderSpatialReference,n=UL(e),o=Ob(t,s,n),a=Ob(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(M(o)||M(a))return!1;const l=Math.tan(.5*e.state.camera.fov)*r;return a.distance(o)/l>Vut}function Qut(e,t,i,r,s,n){let o=0;return n===za.ADJUST&&Jut(e,r,s)?(t=0,o=Kut(e,s,i,r)):o=qie(e,r,s,i),o=e.state.constraints.clampTilt(s,o),{heading:t,tilt:i=CMe(e,r,s,o)}}const zz=.7;function Kut(e,t,i,r){const s=e.state.constraints.tilt(t);s.max=Math.min(s.max,.5*Math.PI);const n=s.min*(1-zz)+s.max*zz,o=qie(e,r,t,i);return Math.min(o,n)}function eht(e,t,i,r){const s=e.state.constraints.tilt(t);let n=qie(e,r,t,i);return n=Math.min(n,.5*Math.PI),s.min*(1-zz)+n*zz}function CMe(e,t,i,r){return EO(e).lookAtTiltToEyeTilt(r,t,i)}function qie(e,t,i,r){return EO(e).eyeTiltToLookAtTilt(r,t,i)}function Vz(e,t,i,r){if(M(t))return null;const s=e.renderSpatialReference,n=Ob(t.eye,s,UL(e));return M(n)?null:_(r)?(r.position=n,r.heading=t.heading,r.tilt=t.tilt,r.fov=i,r):new ju(n,t.heading,t.tilt,i)}function AMe(e,t){var r;const i=(r=e.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.levelAtScale(t);bMe.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function MMe(e,t){var r;const i=(r=e.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.scaleAtLevel(t);bMe.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function tht(e,t){return e.spatialReference?Qwe(t,e.spatialReference):void 0}function OMe(e,t,i){const r=e.renderSpatialReference;let s,n;t||(t=e.state.camera);const o=at.WGS84;return t instanceof ju?(s=t.position.latitude,Go(t.position,lde,r),Go(i,JN,r),n=Pr(lde,JN)):(Zn(t.center,r,JN,o),s=JN[1],n=t.distance),$S(e,n,s)}class CO{constructor(t){this.signal=t,this.resolver=rm()}}function eS(e){return e&&"resolver"in e}function zp(e){let t=e*e;return e<0&&(t*=-1),t}function cde(e,t,i){const r=i,s=e.state,n=e.device,o=t.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(r.translation[0]=zp(s.axes[0]),r.translation[1]=zp(s.axes[1]),r.translation[2]=zp(s.buttons[7])-zp(s.buttons[6]),r.heading=zp(s.axes[2]),r.tilt=zp(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*zp(s.axes[0]),r.translation[1]=1.2*zp(s.axes[1]),r.translation[2]=2*-zp(s.axes[2]),r.heading=1.2*zp(s.axes[5]),r.tilt=1.2*zp(s.axes[3])),r.tilt*=o,fe(r.translation,r.translation,a),r}function ude(e,t){const i=t;return i.translation[0]=e[1]-e[0],i.translation[1]=e[3]-e[2],i.translation[2]=e[4]-e[5],i.heading=e[7]-e[6],i.tilt=e[8]-e[9],i.zoom=e[10]-e[11],i}function Ij(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}let k1=class extends Bb{constructor(e){super(e),this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this.tmpCamera=new xr,this.constraintOptions={selection:jr.ALL,interactionType:ni.NONE,interactionStartCamera:new xr,interactionFactor:0,interactionDirection:null,tiltMode:zo.LOOK_AROUND}}handleEventGamepad(e){const t=cde(e,this.view.navigation.gamepad,this.transformation);(e.action==="end"||Ij(t))&&this.finishController()}activateDirection(e){this.keysButtonState[e]=1,ude(this.keysButtonState,this.transformation)}deactivateDirection(e){this.keysButtonState[e]=0;const t=ude(this.keysButtonState,this.transformation);Ij(t)&&this.finishController()}onControllerStart(e){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this.headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this.filteredSurfaceElevation+=i*(t-this.filteredSurfaceElevation)*e}stepController(e,t){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,ww),this._applyDisabledMovementTypes(ww),this._applyPan(ww.pan),this._applyRotate(ww.rotate),this._applyZoom(ww.zoom),this._applyAscend(ww.ascend),this.constraintOptions.interactionType=ni.NONE,this.constraintOptions.selection=jr.COLLISION,Js(this.view,this.currentCamera,this.constraintOptions),super.stepController(e,t)}_updateStartHeading(){this.transformation.heading!==0&&(this.headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;xe(ic,t.center,t.eye),Xe(ic,ic,e.matrix),t.center=we(ic,ic,t.eye),t.up=Xe(ic,t.up,e.matrix),this.constraintOptions.interactionType=ni.LOOK_AROUND,this.constraintOptions.selection=jr.ALL_EXCEPT_COLLISION,Js(this.view,t,this.constraintOptions)}_applyPan(e,t=this.currentCamera){!e.enabled||(t.eye=Xe(ic,t.eye,e.matrix),t.center=Xe(ic,t.center,e.matrix),this.view.state.isGlobal&&(t.up=Xe(ic,t.up,e.matrix)),this.constraintOptions.interactionType=ni.PAN,this.constraintOptions.selection=jr.ALL,Js(this.view,t,this.constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=we(ic,this.currentCamera.eye,fe(Je.get(),t,e)),pe(gR,t),ll(gR,gR),this.constraintOptions.interactionDirection=gR,this.constraintOptions.interactionType=ni.ZOOM,this.constraintOptions.selection=jr.ALL_EXCEPT_COLLISION,Js(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Je.get());if(this.constraintOptions.interactionDirection=pe(gR,t),this.view.state.isGlobal){const i=Ue(this.currentCamera.eye),r=(i+e)/i;this.currentCamera.eye=fe(ic,this.currentCamera.eye,r),this.currentCamera.center=fe(ic,this.currentCamera.center,r)}else{const i=fe(Je.get(),t,e);this.currentCamera.eye=we(ic,this.currentCamera.eye,i),this.currentCamera.center=we(ic,this.currentCamera.center,i)}this._updateCameraCenter(),this.constraintOptions.interactionType=ni.ASCEND,this.constraintOptions.selection=jr.COLLISION,Js(this.view,this.currentCamera,this.constraintOptions)&&this._updateCameraCenter(),this.constraintOptions.selection=jr.ALL_EXCEPT_COLLISION,Js(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,i){lht(i);const r=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(r,t,i):this._calculateControlTransformationGlobal(r,t,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(i,e,ic)}_calculateControlTransformationLocal(e,t,i){const{viewRight:r,viewForward:s}=t,n=this.transformation,o=this.view.navigation.gamepad,a=he(Je.get(),s[0],s[1],0);Re(a,a);const l=n.translation[0]*e.pan;if(l!==0){const g=fe(Je.get(),r,l);Zl(i.pan.matrix,i.pan.matrix,g),i.pan.enabled=!0}switch(o.mode){case"pan":{const g=-n.translation[1]*e.pan;if(g!==0){const y=fe(Je.get(),a,g);Zl(i.pan.matrix,i.pan.matrix,y),i.pan.enabled=!0}i.zoom=n.zoom*e.zoom;break}case"zoom":i.zoom=(-n.translation[1]+n.zoom)*e.zoom;break;default:o.mode}const c=n.translation[2]*e.ascend;i.ascend=c;const h=-n.heading*e.rotate;h!==0&&(Iu(i.rotate.matrix,i.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,Je.get())),i.rotate.enabled=!0);const p=n.tilt*e.rotate,f=zb(this.view.renderCoordsHelper,t.center,t.eye),m=He(f+p,La.min,La.max)-f;m&&(Iu(i.rotate.matrix,i.rotate.matrix,m,r),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,i){const{eye:r,viewRight:s}=t,n=this.transformation,o=this.view.navigation.gamepad,a=Tt(Je.get(),s,r);Re(a,a),ll(a,a),uut(this.startCamera,t,n,e,this.view.camera.heading,this.headingStart,this.view.camera.tilt,i,o),this.tmpCamera.copyFrom(this.currentCamera),this._applyPan(ww.pan,this.tmpCamera);const l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,c=n.translation[2]*e.ascend;i.ascend=c;const h=-n.heading*e.rotate;h!==0&&(Iu(i.rotate.matrix,i.rotate.matrix,h,this.tmpCamera.eye),i.rotate.enabled=!0);const p=n.tilt*e.rotate,f=this._clampTiltDeltaGlobalToValidRange(p,t.ray,l);f!==0&&(Iu(i.rotate.matrix,i.rotate.matrix,f,this.tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=n.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,i){const r=Ri(this.view.spatialReference),s=sk(La.min,t.origin,i,r);let n=0,o=0;const a=Je.get();if(this.view.renderCoordsHelper.intersectManifold(t,i,a)){const l=zb(this.view.renderCoordsHelper,a,t.origin);n=sk(l,t.origin,i,r),o=sk(La.max,t.origin,i,r)}else{aO(vB(_B,i+r.radius),t,a);const l=Yn(-Pe(t.direction,Re(a,a)));n=Yhe(l,t.origin,i,r),o=Yhe(La.max,t.origin,i,r)}return He(n+e,s,o)-n}_getPointAbsoluteSurfaceElevation(e,t,i){const{renderCoordsHelper:r}=this.view,s=r.getAltitude(e),n=t+Math.abs(s-t);return r.setAltitude(i,n,e),n}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:i}=this.view,{camera:r}=this.view.state,{direction:s}=Hut(this.view,t,0,RMe,aht),n=i.intersectManifoldClosestSilhouette(od(t,s),e,Je.get()),o=Pr(t,n),a=i.intersectManifoldClosestSilhouette(od(t,Rv(Je.get(),t,r.center)),e,Je.get()),l=Pr(t,a);return Math.min(o,l)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:i}=this.view,{camera:r,isGlobal:s}=i,n=t.intersectManifoldClosestSilhouette(r.ray,this.filteredSurfaceElevation,Je.get());if(s){const o=xe(Je.get(),e,n),a=Ue(o);fe(o,o,1/a);const l=Re(Je.get(),e),c=Yn(Pe(l,o));return a*Math.sin(Math.min(rht,c))}{const o=pe(Je.get(),e);return t.setAltitude(o,this.filteredSurfaceElevation),Pr(n,o)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:sht}_computeVelocities(e){const t=this.filteredSurfaceElevation,i=t+Ri(this.view.spatialReference).radius,{camera:r,isGlobal:s}=this.view.state,n=Je.get(),o=this._getPointAbsoluteSurfaceElevation(r.eye,t,n),a=this._clampedDistanceToSurface(t,n),l=r.width/2,c=hde*r.width,h=hde*r.width,p=a*Math.tan(.5*r.fovX)/l,f=p/i,m=p/this._computeHeadingRotateRadius(n),g=o-t;return{pan:(s?f:p)*c*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(c*e/l)*g-g),zoom:2**(c*e/l)*a-a,rotate:He(m*h,nht,oht)*e}}_applyDisabledMovementTypes(e){!_(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Yg(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Yg(e.rotate.matrix))}static activatesFor(e,t){const i=cde(t,e.navigation.gamepad,iht);return!(t.action==="end"||Ij(i))}};u([d({constructOnly:!0})],k1.prototype,"view",void 0),u([d({constructOnly:!0})],k1.prototype,"gamepadDevice",void 0),u([d({constructOnly:!0})],k1.prototype,"disableMovements",void 0),k1=u([L("esri.views.3d.state.controllers.GamepadKeyboardController")],k1);const iht={translation:[0,0,0],heading:0,tilt:0,zoom:0},RMe=80,rht=Yt(RMe),hde=.75,sht=5,nht=Yt(30),oht=Yt(80),ww={zoom:0,ascend:0,pan:{enabled:!1,matrix:Ne()},rotate:{enabled:!1,matrix:Ne()}},ic=$(),gR=$(),aht=jie();function lht(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,Yg(e.pan.matrix),e.rotate.enabled=!1,Yg(e.rotate.matrix)}class cht extends qa{constructor(t){super(!0),this.view=t,this.watchHandles=new Nt,this.handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this.handle.pause()}onInstall(t){super.onInstall(t),this.watchHandles.add([re(()=>this.view.navigation.gamepad.enabled,i=>{i?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))},Et),re(()=>this.view.navigation.gamepad.device,i=>{this.cameraControllerGamepad&&i&&this.cameraControllerGamepad.gamepadDevice!==i&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)})])}onUninstall(){this.watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(t){const i=this.view.navigation.gamepad.device;if(i&&t.data.device!==i)return;const r=this.cameraControllerGamepad&&this.cameraControllerGamepad.active;if(r||k1.activatesFor(this.view,t.data)){if(!r){const s=new k1({view:this.view,gamepadDevice:t.data.device});this.view.state.switchCameraController(s)&&(this.cameraControllerGamepad=s)}this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===t.data.device&&this.cameraControllerGamepad.handleEventGamepad(t.data)}}}var du;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"})(du||(du={}));class uht extends qa{constructor(t,i){super(!0),this.view=t,this.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:tt.Local},this.keyToNumber={[i.left]:du.LEFT,[i.right]:du.RIGHT,[i.forward]:du.FORWARD,[i.backward]:du.BACKWARD,[i.up]:du.UP,[i.down]:du.DOWN,[i.headingLeft]:du.HEADINGLEFT,[i.headingRight]:du.HEADINGRIGHT,[i.tiltUp]:du.TILTUP,[i.tiltDown]:du.TILTDOWN,[i.zoomIn]:du.ZOOMIN,[i.zoomOut]:du.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const i=this.keyToNumber[t.data.key];i!=null&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new k1({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(i),t.stopPropagation()))}_handleBlur(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)}_handleKeyUp(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const i=this.keyToNumber[t.data.key];i!=null&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(i),t.stopPropagation())}}class hht extends qa{constructor(t,i){super(!0),this.view=t,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(t){if(!this.view.navigation.mouseWheelZoomEnabled)return;const i=t.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new Nz({view:this.view,mode:"interaction"}):new Fz({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController)),this.cameraController.zoomStep(-1/60*i.deltaY,Ts(i.x,i.y)),t.preventDefault(),t.stopPropagation()}}class Bz{constructor(t){this._gain=t}reset(t){this._value=t}set gain(t){this._gain=t}get value(){return this._value===void 0?0:this._value}update(t){this._value===void 0?this._value=t:this._value=this._gain*t+(1-this._gain)*this._value}}let yb=class extends A${constructor(e){super(e),this.view=null,this.beginCamera=new xr,this.elapsedTimeSec=0,this.constraintOptions={selection:jr.ALL,interactionType:ni.PAN,interactionFactor:0,interactionStartCamera:new xr,interactionDirection:null,tiltMode:zo.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new dM}get steppingFinished(){return this.momentum.isFinished(this.elapsedTimeSec)}onControllerStart(e){this.beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this.beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this.beginCamera),this.elapsedTimeSec+=e,this.momentumStep(this.elapsedTimeSec,t),Js(this.view,t,this.constraintOptions)}};u([d({constructOnly:!0})],yb.prototype,"view",void 0),yb=u([L("esri.views.3d.state.controllers.momentum.MomentumController")],yb);let e3=class extends yb{constructor(e){super(e),this.interactionType=ni.PAN,this.tmpPan=$()}momentumStep(e,t){const i=this.momentum.value(e);fe(this.tmpPan,this.momentum.direction,i),t.eye=xe(dde,t.eye,this.tmpPan),t.center=xe(dde,t.center,this.tmpPan),this.constraintOptions.interactionDirection=this.tmpPan}};u([d({constructOnly:!0})],e3.prototype,"momentum",void 0),e3=u([L("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],e3);const dde=$(),dht=$(),QN=$();let ak=class extends yb{constructor(e){super(e),this.interactionType=ni.PAN}momentumStep(e,t){const i=this.momentum.value1(e),r=this.momentum.value2(e);pe(QN,t.eye),Re(QN,QN),Tt(this.momentum.axis2,QN,this.momentum.axis1),nMe(t,dht,this.momentum.axis1,i,this.momentum.axis2,r)}};u([d({constructOnly:!0})],ak.prototype,"momentum",void 0),ak=u([L("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],ak);let hT=class extends yb{constructor(e){super(e),this.interactionType=ni.TUMBLE}set center(e){this._set("center",Rn(e))}set axis(e){this._set("axis",Rn(e))}momentumStep(e,t){const i=this.momentum.value(e);Vb(t,this.center,l$(this.axis,i))}};u([d({constructOnly:!0})],hT.prototype,"momentum",void 0),u([d({constructOnly:!0})],hT.prototype,"center",null),u([d({constructOnly:!0})],hT.prototype,"axis",null),hT=u([L("esri.views.3d.state.controllers.momentum.MomentumController")],hT);let WC=class extends yb{constructor(e){super(e),this.interactionType=ni.ZOOM,this.constraintOptions.interactionDirection=$()}set zoomCenter(e){this._set("zoomCenter",Rn(e))}momentumStep(e,t){pe(this.constraintOptions.interactionDirection,t.eye);const i=this.momentum.valueDelta(0,e);zie(t,this.zoomCenter,i,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionDirection=Rv(this.constraintOptions.interactionDirection,t.eye,this.constraintOptions.interactionDirection)}};u([d({constructOnly:!0})],WC.prototype,"momentum",void 0),u([d({constructOnly:!0})],WC.prototype,"zoomCenter",null),WC=u([L("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],WC);let Px=class extends yb{constructor(e){super(e),this.interactionType=ni.ZOOM,this.radius=0,this.tmpSceneCenter=$(),this.tmpZoomAxisAngle=wO(),this.sphere=fo()}set screenCenter(e){this._set("screenCenter",Ts(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Rn(e))}initialize(){this.sphere[3]=this.radius}momentumStep(e,t){const i=this.momentum.valueDelta(0,e);KAe(this.sphere,t,i),this.constraintOptions.interactionType=ni.ZOOM,Js(this.view,t,this.constraintOptions),M$(this.sphere,t,this.screenCenter,this.tmpSceneCenter),c$(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle),Vb(t,this.sphere,this.tmpZoomAxisAngle),this.constraintOptions.interactionType=ni.PAN}};u([d({constructOnly:!0})],Px.prototype,"momentum",void 0),u([d({constructOnly:!0})],Px.prototype,"screenCenter",null),u([d({constructOnly:!0})],Px.prototype,"sceneCenter",null),u([d({constructOnly:!0})],Px.prototype,"radius",void 0),Px=u([L("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],Px);class Mf{constructor(t){this.gain=t}update(t){if(this.hasLastValue){const i=this.computeDelta(t);this._updateDelta(i)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}get hasLastValue(){return this.lastValue!==void 0}get hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(t){return t-this.lastValue}_updateDelta(t){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*t:this.filteredDelta=t}}class S6{constructor(t,i,r){this._initialVelocity=t,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,i){const r=this.value(t);return this.value(t+i)-r}valueFromInitialVelocity(t,i){i=Math.min(i,this.duration);const r=1-this.friction;return t*(r**i-1)/Math.log(r)}}class pht extends S6{constructor(t,i,r,s,n){super(t,i,r),this.sceneVelocity=s,this.direction=n}value(t){return super.valueFromInitialVelocity(this.sceneVelocity,t)}}class PMe{constructor(t=300,i=12,r=.84){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.enabled=!0,this.time=new Mf(.6),this.screen=[new Mf(.4),new Mf(.4)],this.scene=[new Mf(.6),new Mf(.6),new Mf(.6)],this.tmpDirection=$()}add(t,i,r){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(r)<.015)return;this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.scene[0].update(i[0]),this.scene[1].update(i[1]),this.scene[2].update(i[2]),this.time.update(r)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,i=this.screen[1].filteredDelta,r=Math.sqrt(t*t+i*i)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}createMomentum(t,i,r){he(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const s=Ue(this.tmpDirection);s>0&&fe(this.tmpDirection,this.tmpDirection,1/s);const n=s/this.time.filteredDelta;return new pht(t,i,r,n,this.tmpDirection)}}class pde{constructor(t){this.gain=t}update(t){this.hasFilteredValue?this.filteredValue=(1-this.gain)*this.filteredValue+this.gain*t:this.filteredValue=t}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}}const fde=1e-5;class fht extends S6{constructor(t,i,r,s,n,o=0,a){super(t,i,r),this.angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(t){return super.valueFromInitialVelocity(this.angularVelocity1,t)}value2(t){return super.valueFromInitialVelocity(this.angularVelocity2,t)}}class mht{constructor(t=300,i=12,r=.84){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.enabled=!0,this.tmpAxis1=$(),this.tmpAxis2=$(),this.tmpAngles=Ke(),this.time=new Mf(.3),this.screen=[new Mf(.4),new Mf(.4)],this.angle1=new pde(.6),this.angle2=new pde(.6),this.axis1=$(),this.axis2=$(),this.lastScene=$()}addMomentumDirectRotation(t,i,r,s,n,o){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;let a=rMe(this.lastScene,i,this.tmpAxis2,s,n,o);this.angle2.update(0),Vl(this.tmpAxis2)<fde?a=0:Re(this.axis1,this.tmpAxis2),this.angle1.update(a),pe(this.lastScene,i)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(r)}}addMomentumPreserveHeading(t,i,r,s,n,o,a){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;sMe(this.lastScene,i,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,s,n,o,a,!1),Vl(this.tmpAxis2)<fde?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),Re(this.axis1,this.tmpAxis1),Re(this.axis2,this.tmpAxis2)),pe(this.lastScene,i)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(r)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.angle1.reset(),this.angle2.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,i=this.screen[1].filteredDelta,r=Math.sqrt(t*t+i*i)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}createMomentum(t,i,r){const s=this.angle1.filteredValue/this.time.filteredDelta,n=this.angle2.filteredValue/this.time.filteredDelta;return new fht(t,i,r,s,this.axis1,n,this.axis2)}}class IMe{constructor(t=2.5,i=.01,r=.95,s=12){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.maxVelocity=s,this.enabled=!0,this.value=new Mf(.8),this.time=new Mf(.3)}add(t,i){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta){const r=this.value.computeDelta(t);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=He(t,-this.maxVelocity,this.maxVelocity),Math.abs(t)<this.minimumInitialVelocity?null:this.createMomentum(t,this.stopVelocity,this.friction)}createMomentum(t,i,r){return new S6(t,i,r)}}class $Me extends IMe{constructor(t=3,i=.01,r=.95,s=12){super(t,i,r,s)}add(t,i){if(this.value.hasLastValue){const r=this.value.lastValue;let s=t-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;t=r+s}super.add(t,i)}}class ght extends S6{constructor(t,i,r){super(t,i,r)}value(t){const i=super.value(t);return Math.exp(i)}valueDelta(t,i){const r=super.value(t),s=super.value(t+i)-r;return Math.exp(s)}}class LMe extends IMe{constructor(t=2.5,i=.01,r=.95,s=12){super(t,i,r,s)}add(t,i){super.add(Math.log(t),i)}createMomentum(t,i,r){return new ght(t,i,r)}}let lk=class extends Bb{constructor(e){super(e),this.view=null,this.smoothRotation=new Bz(.05),this.rotationAxis=$(),this.panningPlane=qi(),this.smoothScaling=new Bz(.05),this.zoomCenterScreen=Ts(),this.zoomMomentumEstimator=new LMe,this.rotationMomentumEstimator=new $Me,this.panSphericalMomentumEstimator=new mht,this.panPlanarMomentumEstimator=new PMe,this.adjustedSphere=fo(),this.tmp3d=$(),this.tmpScreenPointArray=Ts(),this.beginScreenPoint=Ts(),this.beginScenePoint=$(),this.screenPickPoint=Ts(),this.navMode=fa.Horizontal,this.tmpInteractionDirection=$(),this.constraintOptions={selection:jr.ALL,interactionType:ni.NONE,interactionFactor:0,interactionStartCamera:new xr,interactionDirection:null,tiltMode:zo.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panPlanarMomentumEstimator.enabled=t,this.panSphericalMomentumEstimator.enabled=t,this.beginHeading=-Sb.normalize(Yt(this.view.camera.heading)),this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.smoothRotation.reset(),L0(e.center,this.screenPickPoint),po(this.beginScreenPoint,this.screenPickPoint);const i=Ri(this.view.spatialReference),r=tMe(this.intersectionHelper,this.startCamera,this.screenPickPoint,i,MM.Silhouette);this.scenePickPoint=r.scenePickPoint,this.sphere=r.sphere,pe(this.beginScenePoint,this.scenePickPoint),this.navMode=x6(this.startCamera,this.screenPickPoint,r.hasGeometryIntersection,i),this.navMode===fa.Vertical&&this._preparePlanarPanMode(e),this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}_preparePlanarPanMode(e){const t=ll(this.tmp3d,this.startCamera.viewForward);iM(this.scenePickPoint,t,this.panningPlane);const i=Ts(this.screenPickPoint[0],0),r=$(),s=Ue(this.startCamera.eye);this.adjustedSphere[3]=s<this.sphere[3]?s-100:this.sphere[3],M$(this.adjustedSphere,this.startCamera,i,r);const n=ko();this.startCamera.projectToRenderScreen(r,n);const o=.9*n[1];this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],o);const a=this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint);a&&iM(this.scenePickPoint,this.panningPlane,this.panningPlane);const l=$(),c=$(),h=$(),p=80,f=5,m=50;xe(l,this.scenePickPoint,this.currentCamera.eye);const g=Ue(l);Re(l,l);const y=f*Math.max(Math.abs(this.view.camera.position.z),m),x=this.view._stage.renderView.getMinimalDepthForArea(null,this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,p);let b=x?Math.min(x,y):y;b=a?Math.min(b,g):b,pe(h,we(c,this.currentCamera.eye,fe(c,l,b))),this.panningPlane[3]=-Pe(this.panningPlane,h),this.startCamera.center=we(c,this.startCamera.eye,fe(c,this.startCamera.viewForward,b));const S=L0(e.center,this.tmpScreenPointArray);jY(this.panningPlane,this.startCamera,S,this.beginScenePoint)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this.navMode===fa.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e))}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return this.navMode===fa.Horizontal?new Px({view:this.view,momentum:t,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new WC({view:this.view,momentum:t,zoomCenter:this.beginScenePoint});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new hT({view:this.view,momentum:i,center:this.sphere,axis:this.rotationAxis});if(this.navMode===fa.Horizontal){const r=this.panSphericalMomentumEstimator.evaluateMomentum();if(r)return new ak({view:this.view,momentum:r})}else{const r=this.panPlanarMomentumEstimator.evaluateMomentum();if(r)return new e3({view:this.view,momentum:r})}return null}_zoomSpherical(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),KAe(this.sphere,this.currentCamera,this.smoothScaling.value),L0(e.center,this.zoomCenterScreen),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),this.constraintOptions.interactionType=ni.ZOOM,this.constraintOptions.interactionFactor=Af(e.radius-this.beginRadius),Js(this.view,this.currentCamera,this.constraintOptions)}_panningSpherical(e){const t=L0(e.center,this.tmpScreenPointArray);M$(this.sphere,this.currentCamera,t,this.tmp3d),Vie(this.beginScenePoint,Pe(this.currentCamera.up,this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(aMe(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(oMe(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt)),this.constraintOptions.interactionType=ni.PAN,this.constraintOptions.interactionFactor=Af(this.screenPickPoint,t),Js(this.view,this.currentCamera,this.constraintOptions)}_rotateSpherical(e){Re(this.rotationAxis,this.scenePickPoint),this.currentCamera.aboveGround||ll(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value,i=t+GY(e.angle-t),r=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=r,this.smoothRotation.update(i);const s=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(s,.001*e.timestamp),Vb(this.currentCamera,this.sphere,l$(this.rotationAxis,s)),this.constraintOptions.interactionType=ni.TUMBLE,this.constraintOptions.interactionFactor=Af(e.radius*i),Js(this.view,this.currentCamera,this.constraintOptions)}_panningPlanar(e){const t=L0(e.center,this.tmpScreenPointArray);jY(this.panningPlane,this.currentCamera,t,this.tmp3d)&&(iMe(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(t,this.tmp3d,.001*e.timestamp),this.constraintOptions.interactionType=ni.PAN,this.constraintOptions.interactionFactor=Af(this.beginScreenPoint,t),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),Js(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),zie(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionType=ni.ZOOM,this.constraintOptions.interactionFactor=Af(e.radius-this.beginRadius),Js(this.view,this.currentCamera,this.constraintOptions)}_rotatePlanar(e){pe(this.rotationAxis,this.beginScenePoint),this.currentCamera.aboveGround||ll(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value;let i=e.angle-t;i=GY(i);const r=t+i,s=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=s,this.smoothRotation.update(r);const n=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(n,.001*e.timestamp),Vb(this.currentCamera,this.sphere,l$(this.rotationAxis,n)),this.constraintOptions.interactionType=ni.TUMBLE,this.constraintOptions.interactionFactor=Af(e.radius*n),Js(this.view,this.currentCamera,this.constraintOptions)}};u([d({constructOnly:!0})],lk.prototype,"view",void 0),lk=u([L("esri.views.3d.state.controllers.global.PinchAndPanController")],lk);const mde=Ze(0,0,1),yht={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI},vht=80;let ck=class extends Bb{constructor(e){super(e),this.view=null,this.rotationValueSmooth=new Bz(.05),this.scalingValueSmooth=new Bz(.05),this.planeHorizontal=qi(),this.planeVertical=qi(),this.rotationMomentumEstimator=new $Me,this.panMomentumEstimator=new PMe(300,12,.9),this.zoomMomentumEstimator=new LMe,this.beginCenter=$(),this.tmpPoints=[],this.beginCenterScreen=Ts(),this.tmpCentroid3d=$(),this.tmpCentroid2d=Ts(),this.tmp2d=Ts(),this.constraintOptions={selection:jr.ALL,interactionType:ni.NONE,interactionFactor:0,interactionStartCamera:new xr,interactionDirection:null,tiltMode:zo.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panMomentumEstimator.enabled=t,this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.rotationValueSmooth.reset(),this.scalingValueSmooth.reset(),L0(e.center,this.beginCenterScreen),$we(mde,0,this.planeHorizontal);const i=$(),r=this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,i),s=$();ll(s,this.startCamera.viewForward);const n=$();pe(n,mde);const o=Pe(s,n),a=tm(o<0?-o:o);if(this.panMode=a>=yht.ANGLE_THRESHOLD?fa.Horizontal:fa.Vertical,QW(this.planeHorizontal,this.planeHorizontal,i),this.startCamera.aboveGround||KW(this.planeHorizontal,this.planeHorizontal),this.panMode===fa.Vertical){fe(n,n,o),xe(this.planeVertical,s,n),Re(this.planeVertical,this.planeVertical),QW(this.planeVertical,this.planeVertical,i);const l=$(),c=$(),h=$();xe(l,i,this.currentCamera.eye);const p=Ue(l);Re(l,l);const f=5*Math.max(Math.abs(this.view.camera.position.z),50),m=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,vht);let g=m?Math.min(m,f):f;g=r?Math.min(g,p):g,pe(h,we(c,this.currentCamera.eye,fe(c,l,g))),this.planeVertical[3]=-Pe(this.planeVertical,h),this.computePlanePoints(e.pointers,this.planeVertical,this.startCamera,this.tmpPoints),Sj(this.tmpPoints,this.beginCenter)}else this.computePlanePoints(e.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints),Sj(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,i=this.panMode===fa.Horizontal?this.planeHorizontal:this.planeVertical,r=this.beginCenter;if(t){const s=this.beginRadius/e.radius,n=.001875*Math.min(Math.max(e.radius,40),120);this.scalingValueSmooth.gain=n,this.scalingValueSmooth.update(s),zie(this.currentCamera,r,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*e.timestamp),this.constraintOptions.interactionType=ni.ZOOM,this.constraintOptions.interactionFactor=Af(Math.abs(e.radius-this.beginRadius)),Js(this.view,this.currentCamera,this.constraintOptions)}if(this.computePlanePoints(e.pointers,i,this.currentCamera,this.tmpPoints),Sj(this.tmpPoints,this.tmpCentroid3d),L0(e.center,this.tmpCentroid2d),iMe(this.currentCamera,r,this.tmpCentroid3d),this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*e.timestamp),this.constraintOptions.interactionType=ni.PAN,this.constraintOptions.interactionFactor=Af(this.beginCenterScreen,this.tmpCentroid2d),Js(this.view,this.currentCamera,this.constraintOptions),t){const s=this.planeHorizontal,n=r,o=this.rotationValueSmooth.value,a=o+GY(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this.rotationValueSmooth.gain=l,this.rotationValueSmooth.update(a);const c=this.rotationValueSmooth.value-this.beginAngle;this.rotationMomentumEstimator.add(c,.001*e.timestamp),Vb(this.currentCamera,n,l$(s,c)),this.constraintOptions.interactionType=ni.TUMBLE,this.constraintOptions.interactionFactor=Af(Math.abs(e.radius*c)),Js(this.view,this.currentCamera,this.constraintOptions)}}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return new WC({view:this.view,momentum:t,zoomCenter:this.beginCenter});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new hT({view:this.view,momentum:i,center:this.beginCenter,axis:this.planeHorizontal});const r=this.panMomentumEstimator.evaluateMomentum();return r?new e3({view:this.view,momentum:r}):null}computePlanePoints(e,t,i,r){r.length=e.size;const s=this.tmp2d;let n=0;return e.forEach(o=>{s[0]=o.x,s[1]=o.y,r[n]===void 0&&(r[n]=$()),jY(t,i,s,r[n]),n+=1}),r}};u([d({constructOnly:!0})],ck.prototype,"view",void 0),ck=u([L("esri.views.3d.state.controllers.local.PinchAndPanController")],ck);class gde extends qa{constructor(t,i,r){super(!0),this.view=t,this.pointerAction=i,this.lastEndTimestamp=0,this.lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){if(t.data.pointerType==="mouse"&&!Gie(t.data,this.pointerAction))return;const i=t.timestamp-this.lastEndTimestamp,r=40,s=this.momentum&&this.momentum.active&&i<r;switch(t.data.action){case"start":case"update":if(s)break;this.controller&&this.controller.active?t.data.timestamp-this.lastTimestamp>2&&(this.controller.update(t.data),this.lastTimestamp=t.timestamp):this._startController(t);break;case"end":case"removed":this._endController(t,!0);break;case"added":this._endController(t,!1),this._startController(t)}t.stopPropagation()}_endController(t,i){if(this.controller&&this.controller.active){this.lastEndTimestamp=t.timestamp;const r=this.controller.end(t.data);i&&r&&(this.momentum=r,this.view.state.switchCameraController(this.momentum))}this.controller=null}_startController(t){this.controller=this._createController(),this.view.state.switchCameraController(this.controller),this.controller.begin(t.data),this.lastTimestamp=t.timestamp}_createController(){return this.view.state.isGlobal?new lk({view:this.view}):new ck({view:this.view})}}class _ht extends qa{constructor(t,i){super(!0),this.view=t,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}}class DMe extends qa{constructor(t,i){super(!0),this.key=t,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(t){t.data.key===this.key&&(this.activate(),t.stopPropagation())}}class bht extends DMe{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({heading:0}).catch(()=>{})}}class wht extends DMe{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}class xht extends qa{constructor(t,i=!1){super(!0),this.view=t,this.invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(t){var s,n,o;const i=this.invert?-1:1,r=Ts(0,t.data.delta*i);switch(t.data.action){case"begin":(s=this.cameraController)==null||s.end(),this.cameraController=new qC({view:this.view,pivot:_u.CENTER}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":(n=this.cameraController)==null||n.update(r);break;case"end":(o=this.cameraController)==null||o.end(),this.cameraController=null}}}function yde(e){const t=e.native;return t?{buttons:t.buttons.map(i=>i.pressed?i.value?i.value:1:0),axes:t.axes.map(i=>Eht(i,e.axisThreshold))}:{buttons:[],axes:[]}}function Tht(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}function Sht(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function Eht(e,t){const i=Math.abs(e);return i<t?0:Math.sign(e)*(i-t)/(1-t)}class Cht{constructor(t,i){this.element=t,this.input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this.inputDevices[a];l&&(this._emitGamepadEvent(o,yde(l),!1),this.inputDevices.splice(a,1),this.latestUpdate.splice(a,1),this.input.gamepad.devices.remove(l),this.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get eventsEnabled(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this.callback=t}_connectGamepad(t){const i=new Xte(t);i.deviceType!=="unknown"&&(this.inputDevices[t.index]=i,this.input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this.eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this.frameTask==null&&(this.frameTask=aS({update:()=>this._readGamepadState()}))}_stopPolling(){this.frameTask!=null&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}_readGamepadState(){const t=document.hasFocus(),i=this.element.contains(document.activeElement),r=this.input.gamepad.enabledFocusMode==="document"&&!t||this.input.gamepad.enabledFocusMode==="view"&&!i;this._forEachGamepad(s=>{const n=this.inputDevices[s.index];if(!n)return;const o=this.latestUpdate[s.index],a=yde(n),l=r||Sht(a);o&&(o.timestamp===s.timestamp||!o.active&&l||Tht(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(t){const i=window.navigator.getGamepads();for(let r=0;r<i.length;r++){const s=i[r];this._validate(s)&&t(s)}}_emitGamepadEvent(t,i,r){const s=this.latestUpdate[t.index],n=s&&s.active;if(!n&&!r)return;const o=!n&&r?"start":n&&r?"update":"end";this.latestUpdate[t.index]={timestamp:t.timestamp,state:i,active:r},this.callback&&this.callback({device:this.inputDevices[t.index],state:i,action:o})}_validate(t){if(!t||!t.connected)return!1;for(let i=0;i<t.axes.length;i++)if(isNaN(t.axes[i]))return!1;return!0}}const vde=ye("trident"),_de=ye("edge"),Aht=ye("chrome"),Mht=ye("ff"),Oht=ye("safari"),j2={touchNone:"esri-view-surface--touch-none",touchPan:"esri-view-surface--touch-pan"};class E6{constructor(t,i){this.input=i,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Cht(t,this.input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach(t=>{this._releasePointerCaptureSafe(t)}),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(t){this._browserTouchPanningEnabled=t,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(t){this._callback=t}set activeEvents(t){for(const i in this._active)if(!t||!t.has(i)){const r=this._active[i];this._element.removeEventListener($j[i],r),delete this._active[i]}t&&t.forEach(i=>{if(!this._active[i]&&$j[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener($j[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=t&&t.has("gamepad")}setPointerCapture(t,i){i?(this._element.setPointerCapture(t.pointerId),this._activePointerCaptures.add(t.pointerId)):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?j2.touchNone:j2.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?j2.touchPan:j2.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(j2.touchNone),this._element.classList.remove(j2.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(t){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(t))return;this._element.releasePointerCapture(t)}catch{}}_updateNormalizedPointerLikeEvent(t,i){const r=oCe(this._element,t);return E6.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(t,i){const r=eit(i);r&&t==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:r&&this._keyDownState.has(r)};r&&t==="key-down"&&this._keyDownState.add(s.key),this._callback(t,s)}_handlePointer(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(t,r)}_handlePointerPreventDefault(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(t,r)}_handleMouseWheel(t,i){let r=i.deltaY;switch(i.deltaMode){case 0:(vde||_de)&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}vde||_de?r*=.7:Aht||Oht?r*=.6:Mht&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(t,o)}_handlePointerCaptureLost(t,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(t,i)}_handleDefault(t,i){const r={native:i};i.preventDefault(),this._callback(t,r)}_preventAltKeyDefault(t){t.key==="Alt"&&t.preventDefault()}_preventMultiTouchPanning(t){t.touches.length>1&&t.preventDefault()}}E6.test={disableSubpixelCoordinates:!1};const $j={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class Rht extends qa{constructor(){super(!0),this.registerIncoming("context-menu",t=>{t.data.native.preventDefault()})}}function NMe(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function Pht(e,t){const i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}function Iht(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:bp()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){const[T,C]=e,[A,O]=[C.x-T.x,C.y-T.y];return t.radius=Math.sqrt(A*A+O*O)/2,t.center.x=(T.x+C.x)/2,t.center.y=(T.y+C.y)/2,t}let i=0,r=0;for(let T=0;T<e.length;T++)i+=e[T].x,r+=e[T].y;i/=e.length,r/=e.length;const s=e.map(T=>T.x-i),n=e.map(T=>T.y-r);let o=0,a=0,l=0,c=0,h=0,p=0,f=0;for(let T=0;T<s.length;T++){const C=s[T],A=n[T],O=C*C,D=A*A;o+=O,a+=D,l+=C*A,c+=O*C,h+=D*A,p+=C*D,f+=A*O}const m=.5*(c+p),g=.5*(h+f),y=o*a-l*l,x=(m*a-g*l)/y,b=(o*g-l*m)/y,S=bp(x+i,b+r);return{radius:Math.sqrt(x*x+b*b+(o+a)/e.length),center:S}}class $ht extends qa{constructor(t){super(!1),this.navigationTouch=t,this.startStateModifiers=new Set,this.activePointerMap=new Map,this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,i,r,s){return{action:t,pointerType:this.pointerType,button:this.mouseButton,buttons:i.buttons,timestamp:s,pointers:Lht(this.activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(t){const i=t.native.pointerId,r=KN(this.activePointerMap).angle,s={event:t,initialAngle:0,lastAngle:0};this.activePointerMap.set(i,s);const n=uk(s,FMe(this.activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;const i=t.native.pointerId,r=this.activePointerMap.get(i);r?r.event=t:this._addPointer(t)}_removePointer(t){const i=KN(this.activePointerMap).angle;this.activePointerMap.delete(t),this._updatePointerAngles(i)}_updatePointerAngles(t){const i=KN(this.activePointerMap);this.activePointerMap.forEach(r=>{r.initialAngle=uk(r,i)-t,r.lastAngle=uk(r,i)-t})}_emitEvent(t,i,r){const s=KN(this.activePointerMap);this.drag.emit(this._createPayload(t,i,s,r),void 0,this.startStateModifiers)}_handlePointerUpAndPointerLost(t){const i=t.data.native.pointerId,r=t.timestamp;this.activePointerMap.get(i)&&(this.activePointerMap.size===1?(this._updatePointer(t.data),!this.isCurrentDragSuppressed&&this._emitEvent("end",t.data,r),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){const i=t.data,r=i.currentEvent,s=t.timestamp;switch(i.action){case"start":case"update":this.isDragging?this.activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this.isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this.isCurrentDragSuppressed=this.isSuppressed):(this._updatePointer(r),this.pointerType=t.data.startEvent.pointerType,this.mouseButton=t.data.startEvent.button,this.startStateModifiers=t.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get isSuppressed(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&this.pointerType==="touch"&&this.activePointerMap.size===1}}function FMe(e){const t=[];return e.forEach(i=>{t.push(bp(i.event.x,i.event.y))}),Iht(t)}function KN(e){const t=FMe(e);let i=0;return e.forEach(r=>{let s=uk(r,t),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s,i+=s-r.initialAngle}),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function Lht(e){const t=new Map;return e.forEach((i,r)=>t.set(r,i.event)),t}function uk(e,t){const i=e.event,r=i.x-t.center.x,s=i.y-t.center.y;return Math.atan2(s,r)}var bde;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(bde||(bde={}));const sb={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};class Dht extends qa{constructor(t=sb.maximumDoubleClickDelay,i=sb.maximumDoubleClickDistance,r=sb.maximumDoubleTouchDelay,s=sb.maximumDoubleTouchDistance,n=DV){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=i,this.maximumDoubleTouchDelay=r,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("drag",this._handleDrag.bind(this))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimeout=hn(t.doubleClickTimeout))}get hasPendingInputs(){return Mn(this._pointerState,t=>t.doubleClickTimeout!=null)}_pointerId(t){const i=t.native;return i.pointerType==="mouse"?`${i.pointerId}:${i.button}`:`${i.pointerType}`}_handleImmediateClick(t){const i=t.data,r=this._pointerId(i),s=this._pointerState.get(r);if(s){const n=i.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;NMe(s.event.data,i)>n?(this._clearDoubleClickTimeout(r,!0),this._startClick(t)):(this._clearDoubleClickTimeout(r,!1),this._doubleClick.emit(s.event.data,void 0,s.event.modifiers))}else this._startClick(t)}_startClick(t){const i=this._pointerId(t.data),r=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;this._pointerState.set(i,{event:t,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(i),r)}),this.refreshHasPendingInputs()}_handlePointerDrag(t){const i=this._pointerId(t.data.currentEvent);this._clearDoubleClickTimeout(i,!0)}_handleDrag(t){const i=this._pointerId(t.data.pointer);this._clearDoubleClickTimeout(i,!0)}_clearDoubleClickTimeout(t,i){const r=this._pointerState.get(t);r&&(r.doubleClickTimeout.remove(),r.doubleClickTimeout=null,i&&this._doubleClickTimeoutExceeded(t),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){const i=this._pointerState.get(t);this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimeout=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}}class Nht extends qa{constructor(t=sb.maximumDoubleClickDelay,i=sb.maximumDoubleClickDistance,r=sb.maximumDoubleTouchDelay,s=sb.maximumDoubleTouchDistance,n=DV){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=i,this.maximumDoubleTouchDelay=r,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",o=>{this._handlePointerLoss(o,"pointer-up")}),this.registerIncoming("pointer-capture-lost",o=>{this._handlePointerLoss(o,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",o=>{this._handlePointerLoss(o,"pointer-cancel")})}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=this._pointerId(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerLoss(t,i){const r=t.data,s=this._pointerId(r),n=this._pointerState.get(s);if(n&&i==="pointer-up"&&n.downButton===r.native.button){const o=n.immediateDoubleClick;if(o){o.timeoutHandle.remove();const a=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;NMe(o,t.data)>a?this._startImmediateDoubleClick(t,n):(this._immediateDoubleClick.emit(t.data,void 0,o.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(t,n)}}_startImmediateDoubleClick(t,i){const r=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;i.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),r)}}_pointerId(t){const i=t.native;return i.pointerType==="mouse"?`${i.pointerId}:${i.button}`:`${i.pointerType}`}_removeState(t){const i=this._pointerId(t);this._pointerState.delete(i),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}}const yR={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};class Fht extends qa{constructor(t=yR.maximumClickDelay,i=yR.movementUntilMouseDrag,r=yR.movementUntilPenDrag,s=yR.movementUntilTouchDrag,n=yR.holdDelay,o=DV){super(!1),this.maximumClickDelay=t,this.movementUntilMouseDrag=i,this.movementUntilPenDrag=r,this.movementUntilTouchDrag=s,this.holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout!=null&&(t.holdTimeout.remove(),t.holdTimeout=null)}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,t.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this.holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:t.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_createPointerDragData(t,i,r){return{action:t,startEvent:i.startEvent,previousEvent:i.previousEvent,currentEvent:r}}_handlePointerMove(t){const i=t.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,i),void 0,s.modifiers):Pht(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(t),s.previousEvent=i)}_getDragThreshold(t){switch(t){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}}_startDragging(t){const i=t.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=t.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,i)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),t.timestamp))})}_handlePointerLoss(t,i){const r=t.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&t.timestamp-n.startTimestamp<=this.maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}}class kht{constructor(t){this.callbacks=t,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=()=>!0)}handle(t){const i=t.data,r=i.pointers.size;switch(i.action){case"start":this.currentCount=r,this._emitStart(t);break;case"added":this._emitEnd(this.previousEvent),this.currentCount=r,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this.startEvent&&this._emitEnd(this.previousEvent),this.currentCount=r,this._emitStart(t);break;case"end":this._emitEnd(t),this.currentCount=0}this.previousEvent=t}_emitStart(t){this.startEvent=t,this.callbacks.condition(this.currentCount,t)&&this.callbacks.start(this.currentCount,t,this.startEvent)}_emitUpdate(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.update(this.currentCount,t,this.startEvent)}_emitEnd(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.end(this.currentCount,t,this.startEvent),this.startEvent=null}}class Uht extends qa{constructor(t=20,i=40){super(!1),this._threshold=t,this._maxDelta=i,this.state="ready",this.emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this.dragEventSeparator=new kht({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this.dragEventSeparator.handle(r))}get failed(){return this.state==="failed"}_observeStart(t,i){t===1&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this.state=t===2?"ready":"failed"}_observeUpdate(t,i,r){if(this.state!=="failed"&&t===2)return this.state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this.state="failed")}_observeEnd(t){this.state==="active"&&(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",t.stopPropagation())}_checkMovementWithinLimits(t,i){let r=-1/0,s=1/0,n=-1/0,o=1/0;i.pointers.forEach(y=>{r=Math.max(r,y.x),s=Math.min(s,y.x),n=Math.max(n,y.y),o=Math.min(o,y.y)});let a=-1/0,l=1/0,c=-1/0,h=1/0;t.pointers.forEach(y=>{a=Math.max(a,y.x),l=Math.min(l,y.x),c=Math.max(c,y.y),h=Math.min(h,y.y)});const p=r-s,f=n-o,m=a-l,g=c-h;return Math.abs(t.center.x-i.center.x)<this._threshold&&Math.abs(m-p)<=this._maxDelta&&Math.abs(g-f)<=this._maxDelta}_checkVerticalThresholdReached(t,i){let r=Math.abs(t.center.y-i.center.y);return t.pointers.forEach((s,n)=>{const o=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-o.y))}),r>=this._threshold}}let Qm=class extends Ee{constructor(){super(...arguments),this._handles=new Nt}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){var e;return(e=this._inputManager)==null?void 0:e.hasPendingInputs}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}disconnect(){this.view.viewEvents.disconnect(),this._inputManager&&(this._inputManager.destroy(),this._inputManager=null),this._source&&(this._source.destroy(),this._source=null)}connect(){const e=this.view;this._source=new E6(this.view.surface,e.input);const t=[new Nht,new Fht,new Dht,new $ht(this.view.navigation),new Uht],i=new e1({eventSource:this._source,recognizers:t});this._inputManager=i,i.installHandlers("prevent-context-menu",[new Rht],ts.INTERNAL),this._modeDragPan=new gde(e,"primary"),this._modeDragRotate=new Oj(e,"secondary",_u.CENTER),this._modeDragZoom=new Aut(e,"tertiary");const r={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new _ht(e),new Tut(e),new cht(e),new uht(e,r.pan),new hht(e),new wht(e,r.resetTilt),new bht(e,r.resetHeading),new Oj(e,"primary",_u.EYE,[r.lookAround]),new Oj(e,"secondary",_u.CENTER,[r.lookAround]),new gde(e,"tertiary",[r.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new xht(e)],ts.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(re(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},Et))}_updateMode(){const e=this.mode,t=this.primaryDragAction,i=WY.get(e).get(t);this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([d()],Qm.prototype,"view",void 0),u([d({value:"pan"})],Qm.prototype,"primaryDragAction",null),u([d({value:"default"})],Qm.prototype,"mode",null),u([d({readOnly:!0})],Qm.prototype,"hasPendingInputs",null),u([d()],Qm.prototype,"latestPointerType",null),u([d()],Qm.prototype,"latestPointerLocation",null),u([d()],Qm.prototype,"_inputManager",void 0),Qm=u([L("esri.views.3d.input.SceneInputManager")],Qm);const WY=new Map,Lj=new Map,Dj=new Map;Lj.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),Lj.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),Dj.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),Dj.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),WY.set("default",Lj),WY.set("pro",Dj);const zht=Qm;let qs=class extends Ee{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};u([d()],qs.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([d()],qs.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([d()],qs.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([d()],qs.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([d()],qs.prototype,"LABELS_SHOW_BORDER",void 0),u([d()],qs.prototype,"TEXT_SHOW_BASELINE",void 0),u([d()],qs.prototype,"TEXT_SHOW_BORDER",void 0),u([d()],qs.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([d()],qs.prototype,"OVERLAY_SHOW_CENTER",void 0),u([d()],qs.prototype,"SHOW_POI",void 0),u([d()],qs.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([d()],qs.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([d()],qs.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([d()],qs.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([d()],qs.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([d()],qs.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([d()],qs.prototype,"I3S_TREE_SHOW_TILES",void 0),u([d()],qs.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([d()],qs.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([d()],qs.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([d()],qs.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([d()],qs.prototype,"LINE_WIREFRAMES",void 0),qs=u([L("esri.views.3d.support.DebugFlags")],qs);const dr=new qs;let Ah,_A,ZY=!1,XY=!1,YY=!1,JY=!1,t3=null;function Vht(e,t){if(!XY||!_A)return;kMe();const i=_A;let r=0;for(let s=0;s<e.accBinsNumX;s++)for(let n=0;n<e.accBinsNumY;n++){const o=e.accBins[s][e.accBinsNumY-1-n];r+=o.length;const a=s*e.accBinsSizeX,l=(s+1)*e.accBinsSizeX,c=n*e.accBinsSizeY,h=(n+1)*e.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),UMe(a,l,c,h,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+t.size,70,50),i.fillText("total numTests: "+e.accNumTests,70,30)}function Bht(e){YY=dr.DECONFLICTOR_SHOW_VISIBLE,JY=dr.DECONFLICTOR_SHOW_INVISIBLE,ZY=YY||JY,XY=dr.DECONFLICTOR_SHOW_GRID,t3=null,ZY||XY?t3=()=>Ght(e):Ah&&(Ah.parentElement.removeChild(Ah),Ah=null)}function kMe(){t3&&(t3(),t3=null)}function Ght(e){Ah==null&&(Ah=document.createElement("canvas"),Ah.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(Ah));const{state:t}=e,{camera:i,pixelRatio:r}=t,{width:s,height:n}=i,o=s*r,a=n*r;Ah.setAttribute("width",`${o}px`),Ah.setAttribute("height",`${a}px`),Ah.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),_A=Ah.getContext("2d"),_A.clearRect(0,0,s,n),_A.font="12px Arial"}function UMe(e,t,i,r,s){kMe();const n=Ah.height,o=_A;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(e,n-i),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.closePath()}function jht(e,t){ZY&&(t&&YY||!t&&JY)&&UMe(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var da,Bh;(function(e){e[e.GRAPHIC=0]="GRAPHIC",e[e.LABEL=1]="LABEL",e[e._COUNT=2]="_COUNT"})(da||(da={})),function(e){e[e.USER_SETTING=0]="USER_SETTING",e[e.SCALE_RANGE=1]="SCALE_RANGE",e[e.FILTER=2]="FILTER",e[e.DECONFLICTION=3]="DECONFLICTION",e[e._COUNT=4]="_COUNT"}(Bh||(Bh={}));function zMe(e,t){return new C6(e,jMe,t)}function Hht(e,t){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=jMe;return new C6(e,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:Nj.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:Nj.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:Nj.minPixelSize},t)}function qht(e){return Math.abs(e*e*e)}function VMe(e,t,i){const r=i.parameters,s=i.paddingPixelsOverride;return vR.scale=Math.min(r.divisor/(t-r.offset),1),vR.factor=qht(e),vR.minPixelSize=r.minPixelSize,vR.paddingPixels=s,vR}function BMe(e,t){return e===0?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function Wie(e,t){return Math.max(ui(e*t.scale,e,t.factor),BMe(e,t))}function Wht(e,t,i){const r=VMe(e,t,i);return r.minPixelSize=0,r.paddingPixels=0,Wie(1,r)}function wde(e,t,i,r){r.scale=Wht(e,t,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function GMe(e,t,i=[0,0]){const r=Math.min(Math.max(t.scale,BMe(e[1],t)/Math.max(1e-5,e[1])),1);return i[0]=e[0]*r,i[1]=e[1]*r,i}function Zht(e,t,i,r){return Wie(e,VMe(t,i,r))}class C6{constructor(t,i,r,s=Xht(),n){this.viewingMode=t,this.description=i,this.ellipsoidRadius=r,this.parameters=s,this._paddingPixelsOverride=n,this.viewingMode===tt.Local?(this.coverageCompensation=this._surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this._surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}update(t){return(!this.parameters||this.parameters.camera.fovY!==t.fovY||this.parameters.camera.distance!==t.distance)&&(this._calculateParameters(t,this.ellipsoidRadius,this.parameters),!0)}overridePadding(t){return t!==this.paddingPixelsOverride?new C6(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,t):this}_calculateParameters(t,i,r){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this.description,{fovY:a,distance:l}=t,c=this.calculateCurvatureDependentParameters(t,i),h=this.coverageCompensation(t,i,c),{tiltAngle:p,scaleFallOffFactor:f}=c,m=Math.sin(p)*l,g=.5*Math.PI-p-a*(.5-s*h),y=m/Math.cos(g),x=g+a*n*h,b=(y-f*(m/Math.cos(x)))/(1-f);return r.camera.fovY=t.fovY,r.camera.distance=t.distance,r.offset=b,r.divisor=y-b,r.minPixelSize=o,r}_calculateCurvatureDependentParametersLocal(t,i,r=xde){return r.tiltAngle=this.description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(t,i,r=xde){const s=this.description.curvatureDependent,n=1+t.distance/i,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=He((o-a)/(l-a),0,1),[h,p]=[s.min,s.max];return r.tiltAngle=ui(h.tiltAngle,p.tiltAngle,c),r.scaleFallOffFactor=ui(h.scaleFallOffFactor,p.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(t,i,r){return(t.fovY-r.tiltAngle)/t.fovY}_surfaceCoverageCompensationGlobal(t,i,r){const s=i*i,n=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=t,l=a*a+s-2*Math.cos(n)*a*i,c=Math.sqrt(l),h=Math.sqrt(l-s);return(Math.acos(h/c)-Math.asin(i/(c/Math.sin(n)))+.5*o)/o}}const jMe={curvatureDependent:{min:{curvature:Yt(10),tiltAngle:Yt(12),scaleFallOffFactor:.5},max:{curvature:Yt(70),tiltAngle:Yt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},Nj={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function Xht(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const vR={scale:0,factor:0,minPixelSize:0,paddingPixels:0},xde={tiltAngle:0,scaleFallOffFactor:0};function Yht(e){return e instanceof Float32Array&&e.length>=16}function Jht(e){return Array.isArray(e)&&e.length>=16}function Qht(e){return Yht(e)||Jht(e)}var oe;(function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.Highlight=4]="Highlight",e[e.Draped=5]="Draped",e[e.Occlusion=6]="Occlusion",e[e.Alpha=7]="Alpha",e[e.COUNT=8]="COUNT"})(oe||(oe={}));function Zie(e){e.vertex.code.add(E`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(E`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(E`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(E`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(E`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(E`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),e.vertex.code.add(E`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function Kht(e){e.uniforms.add(new Ei("screenSizePerspective",t=>HMe(t.screenSizePerspective)))}function A6(e){e.uniforms.add(new Ei("screenSizePerspectiveAlignment",t=>HMe(t.screenSizePerspectiveAlignment||t.screenSizePerspective)))}function HMe(e){return _r(edt,e.parameters.divisor,e.parameters.offset,e.parameters.minPixelSize,e.paddingPixelsOverride)}const edt=si();class QY extends $s{constructor(t,i){super(t,"mat4",ar.Draw,(r,s,n)=>r.setUniformMatrix4fv(t,i(s,n)))}}function ry(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",Hl):e.uniforms.add(new ql("cameraPosition",(i,r)=>he(qMe,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function Kh(e,t){if(e.vertex.uniforms.add(new Xr("proj",(r,s)=>s.camera.projectionMatrix)),t.instancedDoublePrecision){const r=(n,o)=>he(qMe,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]);e.vertex.uniforms.add(new Xr("view",(n,o)=>Zl(Tde,o.camera.viewMatrix,r(n,o))));const s=new Dt("localOrigin",r);return e.vertex.uniforms.add(s),s}e.vertex.uniforms.add(new QY("view",(r,s)=>Zl(Tde,s.camera.viewMatrix,r.origin)));const i=new ql("localOrigin",r=>r.origin);return e.vertex.uniforms.add(i),i}const Tde=_L(),qMe=$();function WMe(e,t){const i=e.vertex;t.hasVerticalOffset?(ZMe(i),t.hasScreenSizePerspective&&(e.include(Zie),A6(i),ry(e.vertex,t)),i.code.add(E`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?E`vec3 worldNormal = normalize(worldPos + localOrigin);`:E`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?E`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:E`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(E`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const tdt=si();function ZMe(e){e.uniforms.add(new Ei("verticalOffset",(t,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=t.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return _r(tdt,n*a,o,r,s)}))}var Yd;(function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"})(Yd||(Yd={}));var Rc;function XMe(e,t){e.include(Zie),e.attributes.add(P.POSITION,"vec3"),e.attributes.add(P.NORMAL,"vec3"),e.attributes.add(P.AUXPOS1,"vec4");const i=e.vertex;Kh(e,t),ry(i,t),i.uniforms.add([new Ei("viewport",(r,s)=>s.camera.fullViewport),new lt("polygonOffset",r=>r.shaderPolygonOffset),new lt("cameraGroundRelative",(r,s)=>s.camera.aboveGround?1:-1),new lt("renderTransparentlyOccludedHUD",(r,s)=>s.renderTransparentlyOccludedHUD===Yd.Occluded?1:s.renderTransparentlyOccludedHUD===Yd.NotOccluded?0:.75),new oi("hudVisibilityTexture",(r,s)=>s.hudVisibilityTexture)]),t.hasVerticalOffset&&ZMe(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(E`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(E`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped&&!t.hasVerticalOffset||i.uniforms.add(new Xr("viewNormal",(r,s)=>s.camera.viewInverseTransposeMatrix)),t.isDraped||(i.uniforms.add(new lt("perDistancePixelRatio",(r,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),i.code.add(E`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),t.screenCenterOffsetUnitsEnabled===Rc.Screen&&i.uniforms.add(new lt("pixelRatio",(r,s)=>s.camera.pixelRatio)),t.hasScreenSizePerspective&&A6(i),i.code.add(E`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===Rc.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?E`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==Rc.Screen?E`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===Rc.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===Rc.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.code.add(E`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"})(Rc||(Rc={}));const eF=In();function M6(e,t,i,r,s,n,o){if(!FL(t))if(e.boundingInfo){Ct(e.primitiveType===kc.Triangle);const a=i.tolerance;YMe(e.boundingInfo,r,s,a,n,o)}else{const a=e.indices.get(P.POSITION),l=e.vertexAttributes.get(P.POSITION);zL(r,s,0,a.length/3,a,l,void 0,n,o)}}const idt=$();function YMe(e,t,i,r,s,n){if(M(e))return;const o=QMe(t,i,idt);if(c1e(eF,e.getBBMin()),u1e(eF,e.getBBMax()),_(s)&&s.applyToAabb(eF),Yie(eF,t,o,r)){const{primitiveIndices:a,indices:l,position:c}=e,h=a?a.length:l.length/3;if(h>adt){const p=e.getChildren();if(p!==void 0){for(let f=0;f<8;++f)p[f]!==void 0&&YMe(p[f],t,i,r,s,n);return}}zL(t,i,0,h,l,c,a,s,n)}}const JMe=$();function zL(e,t,i,r,s,n,o,a,l){if(o)return rdt(e,t,i,r,s,n,o,a,l);const c=n.data,h=n.stride||n.size,p=e[0],f=e[1],m=e[2],g=t[0]-p,y=t[1]-f,x=t[2]-m;for(let b=i,S=3*i;b<r;++b){let T=h*s[S++],C=c[T++],A=c[T++],O=c[T];T=h*s[S++];let D=c[T++],U=c[T++],k=c[T];T=h*s[S++];let B=c[T++],j=c[T++],H=c[T];_(a)&&([C,A,O]=a.applyToVertex(C,A,O,b),[D,U,k]=a.applyToVertex(D,U,k,b),[B,j,H]=a.applyToVertex(B,j,H,b));const K=D-C,ee=U-A,ce=k-O,le=B-C,z=j-A,q=H-O,Z=y*q-z*x,Y=x*le-q*g,te=g*z-le*y,se=K*Z+ee*Y+ce*te;if(Math.abs(se)<=Number.EPSILON)continue;const J=p-C,ae=f-A,_e=m-O,Oe=J*Z+ae*Y+_e*te;if(se>0){if(Oe<0||Oe>se)continue}else if(Oe>0||Oe<se)continue;const Be=ae*ce-ee*_e,Se=_e*K-ce*J,Te=J*ee-K*ae,Ie=g*Be+y*Se+x*Te;if(se>0){if(Ie<0||Oe+Ie>se)continue}else if(Ie>0||Oe+Ie<se)continue;const Ve=(le*Be+z*Se+q*Te)/se;Ve>=0&&l(Ve,Xie(K,ee,ce,le,z,q,JMe),b,!1)}}function rdt(e,t,i,r,s,n,o,a,l){const c=n.data,h=n.stride||n.size,p=e[0],f=e[1],m=e[2],g=t[0]-p,y=t[1]-f,x=t[2]-m;for(let b=i;b<r;++b){const S=o[b];let T=3*S,C=h*s[T++],A=c[C++],O=c[C++],D=c[C];C=h*s[T++];let U=c[C++],k=c[C++],B=c[C];C=h*s[T];let j=c[C++],H=c[C++],K=c[C];_(a)&&([A,O,D]=a.applyToVertex(A,O,D,b),[U,k,B]=a.applyToVertex(U,k,B,b),[j,H,K]=a.applyToVertex(j,H,K,b));const ee=U-A,ce=k-O,le=B-D,z=j-A,q=H-O,Z=K-D,Y=y*Z-q*x,te=x*z-Z*g,se=g*q-z*y,J=ee*Y+ce*te+le*se;if(Math.abs(J)<=Number.EPSILON)continue;const ae=p-A,_e=f-O,Oe=m-D,Be=ae*Y+_e*te+Oe*se;if(J>0){if(Be<0||Be>J)continue}else if(Be>0||Be<J)continue;const Se=_e*le-ce*Oe,Te=Oe*ee-le*ae,Ie=ae*ce-ee*_e,Ve=g*Se+y*Te+x*Ie;if(J>0){if(Ve<0||Be+Ve>J)continue}else if(Ve>0||Be+Ve<J)continue;const Ni=(z*Se+q*Te+Z*Ie)/J;Ni>=0&&l(Ni,Xie(ee,ce,le,z,q,Z,JMe),S,!1)}}const Sde=$(),Ede=$();function Xie(e,t,i,r,s,n,o){return he(Sde,e,t,i),he(Ede,r,s,n),Tt(o,Sde,Ede),Re(o,o),o}function QMe(e,t,i){return he(i,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function Yie(e,t,i,r){return Jie(e,t,i,r,1/0)}function Jie(e,t,i,r,s){const n=(e[0]-r-t[0])*i[0],o=(e[3]+r-t[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(e[1]-r-t[1])*i[1],h=(e[4]+r-t[1])*i[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const p=(e[2]-r-t[2])*i[2],f=(e[5]+r-t[2])*i[2];return l=Math.min(l,Math.max(p,f)),!(l<0)&&(a=Math.max(a,Math.min(p,f)),!(a>l)&&a<s)}function KMe(e,t,i,r,s){let n=(i.screenLength||0)*e.pixelRatio;_(s)&&(n=Zht(n,r,t,s));const o=n*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return He(o*t,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function eOe(e,t){const i=t?eOe(t):{};for(const r in e){let s=e[r];s&&s.forEach&&(s=odt(s)),s==null&&r in i||(i[r]=s)}return i}function sdt(e,t){let i=!1;for(const r in t){const s=t[r];s!==void 0&&(Array.isArray(s)?e[r]===null?(e[r]=s.slice(),i=!0):AQ(e[r],s)&&(i=!0):e[r]!==s&&(i=!0,e[r]=s))}return i}function ndt(e,t,i,r,s,n){if(!t.options.selectionMode)return;const o=e.vertexAttributes.get(P.POSITION).data,a=e.vertexAttributes.get(P.SIZE),l=a&&a.data[0],c=r[0],h=r[1],p=((l+s)/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,m=0;for(let g=0;g<o.length-5;g+=3){const y=o[g],x=o[g+1],b=c-y,S=h-x,T=o[g+3]-y,C=o[g+4]-x,A=He((T*b+C*S)/(T*T+C*C),0,1),O=T*A-b,D=C*A-S,U=O*O+D*D;U<f&&(f=U,m=g/3)}f<p*p&&n(i.dist,i.normal,m,!1)}function odt(e){const t=[];return e.forEach(i=>t.push(i)),t}const tOe={multiply:1,ignore:2,replace:3,tint:4},adt=1e3;class vy extends NL{constructor(t,i){super(),this.type=um.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=lr,this._parameters=eOe(t,i),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(t){return!1}setParameters(t,i=!0){sdt(this._parameters,t)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(t){}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.parametersChanged())}shouldRender(t){return this.isVisible()&&this.isVisibleInPass(t.pass)&&(this.renderOccluded&t.renderOccludedMask)!=0}isVisibleInPass(t){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(t){t!==this._insertOrder&&(this._insertOrder=t,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){_(this.repository)&&this.repository.materialChanged(this)}}var rs;(function(e){e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"})(rs||(rs={}));class AO extends Nn{constructor(){super(...arguments),this.renderOccluded=rs.Occlude}}function T5t(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s===1)for(let l=0;l<a;++l)n[r]=t[e[l]],r+=o;else for(let l=0;l<a;++l){const c=t[e[l]];for(let h=0;h<s;h++)n[r]=c,r+=o}}function ldt(e,t,i,r){const s=i.typedBuffer,n=i.typedBufferStride,o=e.length;r*=n;for(let a=0;a<o;++a){const l=2*e[a];s[r]=t[l],s[r+1]=t[l+1],r+=n}}function iOe(e,t,i,r,s){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*e[l];n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],r+=o}else for(let l=0;l<a;++l){const c=3*e[l];for(let h=0;h<s;++h)n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],r+=o}}function RM(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s===1)for(let l=0;l<a;++l){const c=4*e[l];n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],n[r+3]=t[c+3],r+=o}else for(let l=0;l<a;++l){const c=4*e[l];for(let h=0;h<s;++h)n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],n[r+3]=t[c+3],r+=o}}function O6(e,t,i,r,s,n=1){if(!i)return void iOe(e,t,r,s,n);const o=r.typedBuffer,a=r.typedBufferStride,l=e.length,c=i[0],h=i[1],p=i[2],f=i[4],m=i[5],g=i[6],y=i[8],x=i[9],b=i[10],S=i[12],T=i[13],C=i[14];if(s*=a,n===1)for(let A=0;A<l;++A){const O=3*e[A],D=t[O],U=t[O+1],k=t[O+2];o[s]=c*D+f*U+y*k+S,o[s+1]=h*D+m*U+x*k+T,o[s+2]=p*D+g*U+b*k+C,s+=a}else for(let A=0;A<l;++A){const O=3*e[A],D=t[O],U=t[O+1],k=t[O+2],B=c*D+f*U+y*k+S,j=h*D+m*U+x*k+T,H=p*D+g*U+b*k+C;for(let K=0;K<n;++K)o[s]=B,o[s+1]=j,o[s+2]=H,s+=a}}function Qie(e,t,i,r,s,n=1){if(!i)return void iOe(e,t,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=e.length,h=o[0],p=o[1],f=o[2],m=o[4],g=o[5],y=o[6],x=o[8],b=o[9],S=o[10],T=!jK(o),C=1e-6,A=1-C;if(s*=l,n===1)for(let O=0;O<c;++O){const D=3*e[O],U=t[D],k=t[D+1],B=t[D+2];let j=h*U+m*k+x*B,H=p*U+g*k+b*B,K=f*U+y*k+S*B;if(T){const ee=j*j+H*H+K*K;if(ee<A&&ee>C){const ce=1/Math.sqrt(ee);j*=ce,H*=ce,K*=ce}}a[s+0]=j,a[s+1]=H,a[s+2]=K,s+=l}else for(let O=0;O<c;++O){const D=3*e[O],U=t[D],k=t[D+1],B=t[D+2];let j=h*U+m*k+x*B,H=p*U+g*k+b*B,K=f*U+y*k+S*B;if(T){const ee=j*j+H*H+K*K;if(ee<A&&ee>C){const ce=1/Math.sqrt(ee);j*=ce,H*=ce,K*=ce}}for(let ee=0;ee<n;++ee)a[s+0]=j,a[s+1]=H,a[s+2]=K,s+=l}}function cdt(e,t,i,r,s,n=1){if(!i)return void RM(e,t,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=e.length,h=o[0],p=o[1],f=o[2],m=o[4],g=o[5],y=o[6],x=o[8],b=o[9],S=o[10],T=!jK(o),C=1e-6,A=1-C;if(s*=l,n===1)for(let O=0;O<c;++O){const D=4*e[O],U=t[D],k=t[D+1],B=t[D+2],j=t[D+3];let H=h*U+m*k+x*B,K=p*U+g*k+b*B,ee=f*U+y*k+S*B;if(T){const ce=H*H+K*K+ee*ee;if(ce<A&&ce>C){const le=1/Math.sqrt(ce);H*=le,K*=le,ee*=le}}a[s+0]=H,a[s+1]=K,a[s+2]=ee,a[s+3]=j,s+=l}else for(let O=0;O<c;++O){const D=4*e[O],U=t[D],k=t[D+1],B=t[D+2],j=t[D+3];let H=h*U+m*k+x*B,K=p*U+g*k+b*B,ee=f*U+y*k+S*B;if(T){const ce=H*H+K*K+ee*ee;if(ce<A&&ce>C){const le=1/Math.sqrt(ce);H*=le,K*=le,ee*=le}}for(let ce=0;ce<n;++ce)a[s+0]=H,a[s+1]=K,a[s+2]=ee,a[s+3]=j,s+=l}}function Gz(e,t,i,r,s,n=1){const o=r.typedBuffer,a=r.typedBufferStride,l=e.length;if(s*=a,n===1){if(i===4)for(let c=0;c<l;++c){const h=4*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}else if(i===3)for(let c=0;c<l;++c){const h=3*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}}else if(i===4)for(let c=0;c<l;++c){const h=4*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}else if(i===3)for(let c=0;c<l;++c){const h=3*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}}function R6(e,t,i,r,s,n){for(const o of t.fieldNames){const a=e.vertexAttributes.get(o),l=e.indices.get(o);if(a&&l)switch(o){case P.POSITION:{Ct(a.size===3);const c=s.getField(o,fr);c&&O6(l,a.data,i,c,n);break}case P.NORMAL:{Ct(a.size===3);const c=s.getField(o,fr);c&&Qie(l,a.data,r,c,n);break}case P.UV0:{Ct(a.size===2);const c=s.getField(o,Mp);c&&ldt(l,a.data,c,n);break}case P.COLOR:{Ct(a.size===3||a.size===4);const c=s.getField(o,Hc);c&&Gz(l,a.data,a.size,c,n);break}case P.SYMBOLCOLOR:{Ct(a.size===3||a.size===4);const c=s.getField(o,Hc);c&&Gz(l,a.data,a.size,c,n);break}case P.TANGENT:{Ct(a.size===4);const c=s.getField(o,Ho);c&&cdt(l,a.data,r,c,n);break}}}}function R$(e,t,i=0){const r=He(e,0,ddt);for(let s=0;s<4;s++)t[i+s]=Math.floor(256*pdt(r*udt[s]))}function Kie(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*hdt[r];return i}const udt=[1,256,65536,16777216],hdt=[1/256,1/65536,1/16777216,1/4294967296],ddt=Kie(new Uint8ClampedArray([255,255,255,255]));function pdt(e){return e-Math.floor(e)}function fdt(){if(M(Fj)){const e=t=>ji(`esri/libs/basisu/${t}`);Fj=import("./basis_transcoder.9d83be80.js").then(t=>t.b).then(({default:t})=>t({locateFile:e}).then(i=>(i.initializeBasis(),delete i.then,i)))}return Fj}let Fj;var dT;(function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"})(dT||(dT={}));let Jf=null,tF=null;async function rOe(){return M(tF)&&(tF=fdt(),Jf=await tF),tF}function mdt(e,t){if(M(Jf))return e.byteLength;const i=new Jf.BasisFile(new Uint8Array(e)),r=nOe(i)?sOe(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),r}function gdt(e,t){if(M(Jf))return e.byteLength;const i=new Jf.KTX2File(new Uint8Array(e)),r=oOe(i)?sOe(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),r}function sOe(e,t,i,r,s){const n=GCe(t?ks.COMPRESSED_RGBA8_ETC2_EAC:ks.COMPRESSED_RGB8_ETC2),o=s&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*r*n*o)}function nOe(e){return e.getNumImages()>=1&&!e.isUASTC()}function oOe(e){return e.getFaces()>=1&&e.isETC1S()}async function ydt(e,t,i){M(Jf)&&(Jf=await rOe());const r=new Jf.BasisFile(new Uint8Array(i));if(!nOe(r))return null;r.startTranscoding();const s=aOe(e,t,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,o)=>r.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>r.transcodeImage(a,0,n,o,0,0));return r.close(),r.delete(),s}async function vdt(e,t,i){M(Jf)&&(Jf=await rOe());const r=new Jf.KTX2File(new Uint8Array(i));if(!oOe(r))return null;r.startTranscoding();const s=aOe(e,t,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,o)=>r.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>r.transcodeImage(a,n,0,0,o,0,-1,-1));return r.close(),r.delete(),s}function aOe(e,t,i,r,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[h,p]=l?r?[dT.ETC2_RGBA,ks.COMPRESSED_RGBA8_ETC2_EAC]:[dT.ETC1_RGB,ks.COMPRESSED_RGB8_ETC2]:c?r?[dT.BC3_RGBA,ks.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[dT.BC1_RGB,ks.COMPRESSED_RGB_S3TC_DXT1_EXT]:[dT.RGBA32,Qe.RGBA],f=t.hasMipmap?i:Math.min(1,i),m=[];for(let b=0;b<f;b++)m.push(new Uint8Array(o(b,h))),a(b,h,m[b]);const g=m.length>1,y=g?gt.LINEAR_MIPMAP_LINEAR:gt.LINEAR,x=me(F({},t),{samplingMode:y,hasMipmap:g,internalFormat:p,width:s,height:n});return new _t(e,x,{type:"compressed",levels:m})}const _R=ve.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),_dt=542327876,bdt=131072,wdt=4;function ere(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function xdt(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const Tdt=ere("DXT1"),Sdt=ere("DXT3"),Edt=ere("DXT5"),Cdt=31,Adt=0,Mdt=1,Odt=2,Rdt=3,Pdt=4,Idt=7,$dt=20,Ldt=21;function Ddt(e,t,i){const{textureData:r,internalFormat:s,width:n,height:o}=Ndt(i,t.hasMipmap);return t.samplingMode=r.levels.length>1?gt.LINEAR_MIPMAP_LINEAR:gt.LINEAR,t.hasMipmap=r.levels.length>1,t.internalFormat=s,t.width=n,t.height=o,new _t(e,t,r)}function Ndt(e,t){const i=new Int32Array(e,0,Cdt);if(i[Adt]!==_dt)return _R.error("Invalid magic number in DDS header"),null;if(!(i[$dt]&wdt))return _R.error("Unsupported format, must contain a FourCC code"),null;const r=i[Ldt];let s,n;switch(r){case Tdt:s=8,n=ks.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Sdt:s=16,n=ks.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Edt:s=16,n=ks.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return _R.error("Unsupported FourCC code:",xdt(r)),null}let o=1,a=i[Pdt],l=i[Rdt];(3&a)==0&&(3&l)==0||(_R.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let p,f;i[Odt]&bdt&&t!==!1&&(o=Math.max(1,i[Idt])),o===1||kA(a)&&kA(l)||(_R.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let m=i[Mdt]+4;const g=[];for(let y=0;y<o;++y)f=(a+3>>2)*(l+3>>2)*s,p=new Uint8Array(e,m,f),g.push(p),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:n,width:c,height:h}}class En extends NL{constructor(t,i){super(),this.data=t,this.type=um.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new cs,this.params=i||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:$t.REPEAT,t:$t.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||fb.STRETCH,this.estimatedTexMemRequired=En._estimateTexMemRequired(this.data,this.params),this._startPreload()}_startPreload(){const t=this.data;M(t)||(t instanceof HTMLVideoElement?this._startPreloadVideoElement(t):t instanceof HTMLImageElement&&this._startPreloadImageElement(t))}_startPreloadVideoElement(t){if(!(Cb(t.src)||t.preload==="auto"&&t.crossOrigin)){t.preload="auto",t.crossOrigin="anonymous";const i=!t.paused;if(t.src=t.src,i&&t.autoplay){const r=()=>{t.removeEventListener("canplay",r),t.play()};t.addEventListener("canplay",r)}}}_startPreloadImageElement(t){uy(t.src)||Cb(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}static _getDataDimensions(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}static _estimateTexMemRequired(t,i){if(M(t))return 0;if(UO(t)||Jx(t))return i.encoding===En.KTX2_ENCODING?gdt(t,i.mipmap):i.encoding===En.BASIS_ENCODING?mdt(t,i.mipmap):t.byteLength;const{width:r,height:s}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?En._getDataDimensions(t):i;return(i.mipmap?4/3:1)*r*s*(i.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(t){var i;return{target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?gt.LINEAR_MIPMAP_LINEAR:gt.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:(i=this.params.maxAnisotropy)!=null?i:this.params.mipmap?t.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(t,i){if(_(this._glTexture))return this._glTexture;if(_(this._loadingPromise))return this._loadingPromise;const r=this.data;return M(r)?(this._glTexture=new _t(t,this._createDescriptor(t),null),this._glTexture):typeof r=="string"?this._loadFromURL(t,i,r):r instanceof Image?this._loadFromImageElement(t,i,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(t,i,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(t,r,i):(UO(r)||Jx(r))&&this.params.encoding===En.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(t,r)):(UO(r)||Jx(r))&&this.params.encoding===En.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(t,r)):(UO(r)||Jx(r))&&this.params.encoding===En.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(t,r)):Jx(r)?this._loadFromPixelData(t,r):UO(r)?this._loadFromPixelData(t,new Uint8Array(r)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(t,i,r){if(!(this.data instanceof HTMLVideoElement)||M(this._glTexture)||this.data.readyState<i3.HAVE_CURRENT_DATA||r===this.data.currentTime)return r;if(_(this._powerOfTwoStretchInfo)){const{framebuffer:s,vao:n,sourceTexture:o}=this._powerOfTwoStretchInfo;o.setData(this.data),this._drawStretchedTexture(t,i,s,n,o,this._glTexture)}else{const{videoWidth:s,videoHeight:n}=this.data,{width:o,height:a}=this._glTexture.descriptor;s!==o||n!==a?this._glTexture.updateData(0,0,0,Math.min(s,o),Math.min(n,a),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this.data.currentTime}_loadFromDDSData(t,i){return this._glTexture=Ddt(t,this._createDescriptor(t),i),this._glTexture}_loadFromKTX2(t,i){return this._loadAsync(()=>vdt(t,this._createDescriptor(t),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(t,i){return this._loadAsync(()=>ydt(t,this._createDescriptor(t),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(t,i){Ct(this.params.width>0&&this.params.height>0);const r=this._createDescriptor(t);return r.pixelFormat=this.params.components===1?Qe.LUMINANCE:this.params.components===3?Qe.RGB:Qe.RGBA,r.width=this.params.width,r.height=this.params.height,this._glTexture=new _t(t,r,i),this._glTexture}_loadFromURL(t,i,r){return this._loadAsync(async s=>{const n=await lm(r,{signal:s});return qt(s),this._loadFromImage(t,n,i)})}_loadFromImageElement(t,i,r){return r.complete?this._loadFromImage(t,r,i):this._loadAsync(async s=>{const n=await D1e(r,r.src,!1,s);return qt(s),this._loadFromImage(t,n,i)})}_loadFromVideoElement(t,i,r){return r.readyState>=i3.HAVE_CURRENT_DATA?this._loadFromImage(t,r,i):this._loadFromVideoElementAsync(t,i,r)}_loadFromVideoElementAsync(t,i,r){return this._loadAsync(s=>new Promise((n,o)=>{const a=()=>{r.removeEventListener("loadeddata",l),r.removeEventListener("error",c),hn(h)},l=()=>{r.readyState>=i3.HAVE_CURRENT_DATA&&(a(),n(this._loadFromImage(t,r,i)))},c=p=>{a(),o(p||new W("Failed to load video"))};r.addEventListener("loadeddata",l),r.addEventListener("error",c);const h=va(s,()=>c(mi()))}))}_loadFromImage(t,i,r){const s=En._getDataDimensions(i);this.params.width=s.width,this.params.height=s.height;const n=this._createDescriptor(t);return n.pixelFormat=this.params.components===3?Qe.RGB:Qe.RGBA,!this._requiresPowerOfTwo(t,n)||kA(s.width)&&kA(s.height)?(n.width=s.width,n.height=s.height,this._glTexture=new _t(t,n,i),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(t,i,s,n,r),this._glTexture)}_loadAsync(t){const i=new AbortController;this._loadingController=i;const r=t(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(s,s),r}_requiresPowerOfTwo(t,i){const r=$t.CLAMP_TO_EDGE,s=typeof i.wrapMode=="number"?i.wrapMode===r:i.wrapMode.s===r&&i.wrapMode.t===r;return!Lo(t.gl)&&(i.hasMipmap||!s)}_makePowerOfTwoTexture(t,i,r,s,n){const{width:o,height:a}=r,l=FA(o),c=FA(a);let h;switch(s.width=l,s.height=c,this.params.powerOfTwoResizeMode){case fb.PAD:s.textureCoordinateScaleFactor=[o/l,a/c],h=new _t(t,s),h.updateData(0,0,0,o,a,i);break;case fb.STRETCH:case null:case void 0:h=this._stretchToPowerOfTwo(t,i,s,n());break;default:this.params.powerOfTwoResizeMode}return s.hasMipmap&&h.generateMipmap(),h}_stretchToPowerOfTwo(t,i,r,s){const n=new _t(t,r),o=new ss(t,{colorTarget:zs.TEXTURE,depthStencilTarget:Yi.NONE},n),a=new _t(t,{target:At.TEXTURE_2D,pixelFormat:r.pixelFormat,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:gt.LINEAR,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},i),l=Yl(t),c=t.getBoundFramebufferObject();return this._drawStretchedTexture(t,s,o,l,a,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:l,sourceTexture:a,framebuffer:o}:(l.dispose(!0),a.dispose(),o.detachColorTexture(),o.dispose()),t.bindFramebuffer(c),n}_drawStretchedTexture(t,i,r,s,n,o){t.bindFramebuffer(r);const a=t.getViewport();t.setViewport(0,0,o.descriptor.width,o.descriptor.height);const l=t.bindTechnique(i);l.setUniform4f("uColor",1,1,1,1),l.bindTexture("tex",n),t.bindVAO(s),t.drawArrays(Wt.TRIANGLE_STRIP,0,ka(s,"geometry")),t.bindFramebuffer(null),t.setViewport(a.x,a.y,a.width,a.height)}unload(){if(_(this._powerOfTwoStretchInfo)){const{framebuffer:t,vao:i,sourceTexture:r}=this._powerOfTwoStretchInfo;i.dispose(!0),r.dispose(),t.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(_(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),_(this._loadingController)){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}}var i3;En.DDS_ENCODING="image/vnd-ms.dds",En.KTX2_ENCODING="image/ktx2",En.BASIS_ENCODING="image/x.basis",function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(i3||(i3={}));const P$=128,tre=.5;function lOe(e,t=P$,i=t*tre,r=0){const s=Fdt(e,t,i,r);return new En(s,{mipmap:!1,wrap:{s:$t.CLAMP_TO_EDGE,t:$t.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function Fdt(e,t=P$,i=t*tre,r=0){switch(e){case"circle":default:return kdt(t,i);case"square":return Udt(t,i);case"cross":return Vdt(t,i,r);case"x":return Bdt(t,i,r);case"kite":return zdt(t,i);case"triangle":return Gdt(t,i);case"arrow":return jdt(t,i)}}function kdt(e,t){const i=e/2-.5;return VL(e,hOe(i,i,t/2))}function Udt(e,t){return cOe(e,t,!1)}function zdt(e,t){return cOe(e,t,!0)}function Vdt(e,t,i=0){return uOe(e,t,!1,i)}function Bdt(e,t,i=0){return uOe(e,t,!0,i)}function Gdt(e,t){return VL(e,dOe(e/2,t,t/2))}function jdt(e,t){const i=t,r=t/2,s=e/2,n=.8*i,o=hOe(s,(e-t)/2-n,Math.sqrt(n*n+r*r)),a=dOe(s,i,r);return VL(e,(l,c)=>Math.max(a(l,c),-o(l,c)))}function cOe(e,t,i){return i&&(t/=Math.SQRT2),VL(e,(r,s)=>{let n=r-.5*e+.25,o=.5*e-s-.75;if(i){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*t})}function uOe(e,t,i,r=0){t-=r,i&&(t*=Math.SQRT2);const s=.5*t;return VL(e,(n,o)=>{let a,l=n-.5*e,c=.5*e-o-1;if(i){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=r/2,a})}function hOe(e,t,i){return(r,s)=>{const n=r-e,o=s-t;return Math.sqrt(n*n+o*o)-i}}function dOe(e,t,i){const r=Math.sqrt(t*t+i*i);return(s,n)=>{const o=Math.abs(s-e)-i,a=n-e+t/2+.75,l=(t*o+i*a)/r,c=-a;return Math.max(l,c)}}function VL(e,t){const i=new Uint8Array(4*e*e);for(let r=0;r<e;r++)for(let s=0;s<e;s++){const n=s+e*r;let o=t(s,r);o=o/e+.5,R$(o,i,4*n)}return i}class S5t extends Nn{constructor(t){super(),this.slicePlaneLocalOrigin=t}}function Hdt(e,t){pOe(e,t,[new Dt("slicePlaneOrigin",(i,r)=>yOe(t,i,r)),new Dt("slicePlaneBasis1",(i,r)=>{var s;return jz(t,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Dt("slicePlaneBasis2",(i,r)=>{var s;return jz(t,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function Qs(e,t){pOe(e,t,[new ql("slicePlaneOrigin",(i,r)=>yOe(t,i,r)),new ql("slicePlaneBasis1",(i,r)=>{var s;return jz(t,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new ql("slicePlaneBasis2",(i,r)=>{var s;return jz(t,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function pOe(e,t,i){if(!t.hasSlicePlane){const o=E`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(o),void e.fragment.code.add(o)}e.extensions.add("GL_OES_standard_derivatives"),t.hasSliceInVertexProgram&&e.vertex.uniforms.add(i),e.fragment.uniforms.add(i);const r=E`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=E`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.hasSliceHighlight?E`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:E`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(r),e.fragment.code.add(r),e.fragment.code.add(n)}function fOe(e,t,i){return e.instancedDoublePrecision?he(qdt,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function mOe(e,t){return _(e)?xe(Hz,t.origin,e):t.origin}function gOe(e,t,i){return e.hasSliceTranslatedView?_(t)?Zl(Wdt,i.camera.viewMatrix,t):i.camera.viewMatrix:null}function yOe(e,t,i){if(M(i.slicePlane))return Hl;const r=fOe(e,t,i),s=mOe(r,i.slicePlane),n=gOe(e,r,i);return _(n)?Xe(Hz,s,n):s}function jz(e,t,i,r){if(M(r)||M(i.slicePlane))return Hl;const s=fOe(e,t,i),n=mOe(s,i.slicePlane),o=gOe(e,s,i);return _(o)?(we(bR,r,n),Xe(Hz,n,o),Xe(bR,bR,o),xe(bR,bR,Hz)):r}const qdt=$(),Hz=$(),bR=$(),Wdt=Ne();function Zdt(e,t){const{vertex:i,fragment:r}=e;t.hasMultipassGeometry&&i.include(gAe),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.code.add(E`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.hasMultipassGeometry?E`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.hasMultipassTerrain&&r.include(ad),t.hasMultipassTerrain&&r.uniforms.add([new oi("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture),new Di("nearFar",(s,n)=>n.camera.nearFar),new Di("inverseViewport",(s,n)=>n.inverseViewport)]),r.include(Zu),r.code.add(E`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.hasMultipassTerrain?E`
          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const Xdt=zi(1,1,0,1),vOe=zi(1,0,1,1);function Bv(e){e.fragment.uniforms.add(new oi("depthTex",(t,i)=>i.highlightDepthTexture)),e.fragment.uniforms.add(new Di("highlightViewportPixelSz",(t,i)=>i.inverseViewport)),e.fragment.constants.add("occludedHighlightFlag","vec4",Xdt).add("unoccludedHighlightFlag","vec4",vOe),e.fragment.code.add(E`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, fragCoord.xy * highlightViewportPixelSz.xy).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}class P6 extends $s{constructor(t,i,r){super(t,"vec4",ar.Pass,(s,n,o)=>s.setUniform4fv(t,i(n,o)),r)}}class ol extends $s{constructor(t,i,r){super(t,"float",ar.Pass,(s,n,o)=>s.setUniform1fv(t,i(n,o)),r)}}class BL extends $s{constructor(t,i){super(t,"mat3",ar.Pass,(r,s,n)=>r.setUniformMatrix3fv(t,i(s,n)))}}class ire extends AO{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=Ze(1,1,1),this.vvSizeMaxSize=Ze(100,100,100),this.vvSizeOffset=Ze(0,0,0),this.vvSizeFactor=Ze(1,1,1),this.vvSizeValue=Ze(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=ls()}}const Qf=8;function bA(e,t){t.hasVvInstancing&&(t.vvSize||t.vvColor)&&e.attributes.add(P.INSTANCEFEATUREATTRIBUTE,"vec4");const i=e.vertex;t.vvSize?(i.uniforms.add(new Dt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new Dt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new Dt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new Dt("vvSizeFactor",r=>r.vvSizeFactor)),i.uniforms.add(new BL("vvSymbolRotationMatrix",r=>r.vvSymbolRotationMatrix)),i.uniforms.add(new Dt("vvSymbolAnchor",r=>r.vvSymbolAnchor)),i.code.add(E`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(E`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?E`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(E`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(i.constants.add("vvColorNumber","int",Qf),t.hasVvInstancing&&i.uniforms.add([new ol("vvColorValues",r=>r.vvColorValues,Qf),new P6("vvColorColors",r=>r.vvColorColors,Qf)]),i.code.add(E`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.hasVvInstancing?E`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):i.code.add(E`vec4 vvColor() { return vec4(1.0); }`)}const qz=.1,Va=.001;function Ydt(e){const t=new mr,i=e.signedDistanceFieldEnabled;if(t.include(Tie),t.include(XMe,e),t.include(Qs,e),e.output===oe.Occlusion)return t.include(Zdt,e),t;const{vertex:r,fragment:s}=t;t.include(Zie),s.include(Zu),s.include(gy),t.include(bA,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),r.uniforms.add([new Ei("viewport",(c,h)=>h.camera.fullViewport),new Di("screenOffset",(c,h)=>Li(_Oe,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new Di("anchorPosition",c=>Wz(c)),new Ei("materialColor",c=>c.color),new lt("pixelRatio",(c,h)=>h.camera.pixelRatio)]),i&&(r.uniforms.add(new Ei("outlineColor",c=>c.outlineColor)),s.uniforms.add([new Ei("outlineColor",c=>Cde(c)?c.outlineColor:Dg),new lt("outlineSize",c=>Cde(c)?c.outlineSize:0)])),e.hasScreenSizePerspective&&(Kht(r),A6(r)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(P.UV0,"vec2"),t.attributes.add(P.COLOR,"vec4"),t.attributes.add(P.SIZE,"vec2"),t.attributes.add(P.AUXPOS2,"vec4"),r.code.add(E`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?E`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:E`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=E`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=e.pixelSnappingEnabled?i?E`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:E`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:E`posProj += quadOffset;`;e.vvColor&&r.uniforms.add([new P6("vvColorColors",c=>c.vvColorColors,Qf),new ol("vvColorValues",c=>c.vvColorValues,Qf)]),r.uniforms.add(new Di("textureCoordinateScaleFactor",c=>_(c.texture)&&_(c.texture.descriptor.textureCoordinateScaleFactor)?c.texture.descriptor.textureCoordinateScaleFactor:pwe)),r.code.add(E`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${E.float(Va)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${E.float(Va)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?E`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new oi("tex",c=>c.texture));const a=e.debugDrawLabelBorder?E`(isBorder > 0.0 ? 0.0 : ${E.float(qz)})`:E.float(qz),l=E`
    ${e.debugDrawLabelBorder?E`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?E`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${E.float(P$)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${E.float(Va)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:E`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?E`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===oe.Alpha&&s.code.add(E`
      void main() {
        ${l}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),e.output===oe.Color&&s.code.add(E`
    void main() {
      ${l}
      ${e.transparencyPassType===Rt.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),e.output===oe.Highlight&&(t.include(Bv),s.code.add(E`
    void main() {
      ${l}
      ${e.binaryHighlightOcclusionEnabled?E`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function Cde(e){return e.outlineColor[3]>0&&e.outlineSize>0}function Wz(e,t=_Oe){return e.textureIsSignedDistanceField?Jdt(e.anchorPosition,e.distanceFieldBoundingBox,t):po(t,e.anchorPosition),t}function Jdt(e,t,i){_(t)?Li(i,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):Li(i,0,0)}const _Oe=Ke(),Qdt=Object.freeze(Object.defineProperty({__proto__:null,build:Ydt,calculateAnchorPosForRendering:Wz},Symbol.toStringTag,{value:"Module"})),ed=ba(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),Kdt=my(ke.ONE,ke.ONE),bOe=my(ke.ZERO,ke.ONE_MINUS_SRC_ALPHA);function Gv(e){return e===Rt.FrontFace?null:e===Rt.Alpha?bOe:Kdt}function I6(e){return e===Rt.FrontFace?jc:null}const $6=5e5,L6={factor:-1,units:-2};function D6(e){return e?L6:null}function ew(e,t=Fr.LESS){return e===Rt.NONE||e===Rt.FrontFace?t:Fr.LEQUAL}class GL extends Lr{initializeConfiguration(t,i){i.spherical=t.viewingMode===tt.Global}initializeProgram(t){const i=GL.shader.get().build(this.configuration);return new Er(t.rctx,i,lr)}_setPipelineState(t){const i=this.configuration,r=t===Rt.NONE,s=t===Rt.FrontFace,n=this.configuration.hasPolygonOffset&&ept,o=(r||s)&&i.output!==oe.Highlight?(i.depthEnabled||i.output===oe.Occlusion)&&jc:null;return ri({blending:i.output===oe.Color||i.output===oe.Alpha||i.output===oe.Highlight?r?tpt:Gv(t):null,depthTest:{func:Fr.LEQUAL},depthWrite:o,colorWrite:xi,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.output===oe.Occlusion?Wt.POINTS:Wt.TRIANGLES}}GL.shader=new Sr(Qdt,()=>import("./HUDMaterial.glsl.41bd5998.js"));const ept={factor:0,units:-4},tpt=my(ke.ONE,ke.ONE_MINUS_SRC_ALPHA);class al extends Xl{}u([Q({constValue:!0})],al.prototype,"hasSliceHighlight",void 0),u([Q({constValue:!1})],al.prototype,"hasSliceInVertexProgram",void 0),u([Q({constValue:!1})],al.prototype,"instancedDoublePrecision",void 0),u([Q({constValue:!1})],al.prototype,"isGround",void 0),u([Q({constValue:ar.Pass})],al.prototype,"pbrTextureBindType",void 0);class yn extends al{constructor(){super(...arguments),this.output=oe.Color,this.screenCenterOffsetUnitsEnabled=Rc.World,this.transparencyPassType=Rt.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([Q({count:oe.COUNT})],yn.prototype,"output",void 0),u([Q({count:Rc.COUNT})],yn.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([Q({count:Rt.COUNT})],yn.prototype,"transparencyPassType",void 0),u([Q()],yn.prototype,"spherical",void 0),u([Q()],yn.prototype,"occlusionTestEnabled",void 0),u([Q()],yn.prototype,"signedDistanceFieldEnabled",void 0),u([Q()],yn.prototype,"vvSize",void 0),u([Q()],yn.prototype,"vvColor",void 0),u([Q()],yn.prototype,"hasVerticalOffset",void 0),u([Q()],yn.prototype,"hasScreenSizePerspective",void 0),u([Q()],yn.prototype,"debugDrawLabelBorder",void 0),u([Q()],yn.prototype,"binaryHighlightOcclusionEnabled",void 0),u([Q()],yn.prototype,"hasSlicePlane",void 0),u([Q()],yn.prototype,"hasPolygonOffset",void 0),u([Q()],yn.prototype,"depthEnabled",void 0),u([Q()],yn.prototype,"pixelSnappingEnabled",void 0),u([Q()],yn.prototype,"isDraped",void 0),u([Q()],yn.prototype,"hasMultipassGeometry",void 0),u([Q()],yn.prototype,"hasMultipassTerrain",void 0),u([Q()],yn.prototype,"cullAboveGround",void 0),u([Q({constValue:!0})],yn.prototype,"hasSliceInVertexProgram",void 0),u([Q({constValue:!1})],yn.prototype,"hasVvInstancing",void 0);class PM extends vy{constructor(t){super(t,new hpt),this.techniqueConfig=new yn}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasVerticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Rc.Screen:Rc.World,this.techniqueConfig.hasPolygonOffset=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,t===oe.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),t===oe.Highlight&&(this.techniqueConfig.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassGeometry=i.multipassGeometry.enabled,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){_(c)?this._intersectDrapedHudGeometry(t,o,a,l,c):this._intersectHudGeometry(t,i,r,s,a,l)}_intersectDrapedHudGeometry(t,i,r,s,n){const o=t.vertexAttributes.get(P.POSITION),a=t.vertexAttributes.get(P.SIZE),l=this.parameters,c=Wz(l);let h=1,p=1;if(_(s)){const m=s(Ode);h=m[0],p=m[5]}h*=t.screenToWorldRatio,p*=t.screenToWorldRatio;const f=cpt*t.screenToWorldRatio;for(let m=0;m<o.data.length/o.size;m++){const g=m*o.size,y=o.data[g],x=o.data[g+1],b=m*a.size;let S;u_[0]=a.data[b]*h,u_[1]=a.data[b+1]*p,l.textureIsSignedDistanceField&&(S=l.outlineSize*t.screenToWorldRatio/2),Ade(i,y,x,u_,f,S,l,c)&&r(n.dist,n.normal,-1,!1)}}_intersectHudGeometry(t,i,r,s,n,o){if(!s.options.selectionMode||!s.options.hud||FL(i))return;const a=this.parameters;let l=1,c=1;if(Cp(Uj,r),_(o)){const S=o(Ode);l=S[0],c=S[5],spt(Uj)}const h=t.vertexAttributes.get(P.POSITION),p=t.vertexAttributes.get(P.SIZE),f=t.vertexAttributes.get(P.NORMAL),m=t.vertexAttributes.get(P.AUXPOS1);Ct(h.size>=3);const g=s.point,y=s.camera,x=Wz(a);l*=y.pixelRatio,c*=y.pixelRatio;const b=this.parameters.centerOffsetUnits==="screen";for(let S=0;S<h.data.length/h.size;S++){const T=S*h.size;he(Ya,h.data[T],h.data[T+1],h.data[T+2]),Xe(Ya,Ya,r);const C=S*p.size;u_[0]=p.data[C]*l,u_[1]=p.data[C+1]*c,Xe(Ya,Ya,y.viewMatrix);const A=S*m.size;if(he(th,m.data[A+0],m.data[A+1],m.data[A+2]),!b&&(Ya[0]+=th[0],Ya[1]+=th[1],th[2]!==0)){const D=th[2];Re(th,Ya),xe(Ya,Ya,fe(th,th,D))}const O=S*f.size;if(he(wR,f.data[O],f.data[O+1],f.data[O+2]),this._normalAndViewAngle(wR,Uj,y,zj),this._applyVerticalOffsetTransformationView(Ya,zj,y,kj),y.applyProjection(Ya,bl),bl[0]>-1){bl[0]=Math.floor(bl[0]),bl[1]=Math.floor(bl[1]),b&&(th[0]||th[1])&&(bl[0]+=th[0],th[1]!==0&&(bl[1]+=Wie(th[1],kj.factorAlignment)),y.unapplyProjection(bl,Ya)),bl[0]+=this.parameters.screenOffset[0],bl[1]+=this.parameters.screenOffset[1],GMe(u_,kj.factor,u_);const D=lpt*y.pixelRatio;let U;if(a.textureIsSignedDistanceField&&(U=a.outlineSize*y.pixelRatio/2),Ade(g,bl[0],bl[1],u_,D,U,a,x)){const k=s.ray;if(Xe(Mde,Ya,Ks(apt,y.viewMatrix)),bl[0]=g[0],bl[1]=g[1],y.unprojectFromRenderScreen(bl,Ya)){const B=$();pe(B,k.direction);const j=1/Ue(B);fe(B,B,j),n(Pr(k.origin,Ya)*j,B,-1,!0,1,Mde)}}}}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return!1;const s=r.get(P.POSITION),n=t.indices.get(P.POSITION);return AAe(s,n,i)}createBufferWriter(){return new ppt(this)}_normalAndViewAngle(t,i,r,s){return Qht(i)&&(i=Cp(opt,i)),Pu(s.normal,t,i),Xe(s.normal,s.normal,r.viewInverseTransposeMatrix),s.cosAngle=Pe(xOe,upt),s}_updateScaleInfo(t,i,r){const s=this.parameters;_(s.screenSizePerspective)?wde(r,i,s.screenSizePerspective,t.factor):(t.factor.scale=1,t.factor.factor=0,t.factor.minPixelSize=0,t.factor.paddingPixels=0),_(s.screenSizePerspectiveAlignment)?wde(r,i,s.screenSizePerspectiveAlignment,t.factorAlignment):(t.factorAlignment.factor=t.factor.factor,t.factorAlignment.scale=t.factor.scale,t.factorAlignment.minPixelSize=t.factor.minPixelSize,t.factorAlignment.paddingPixels=t.factor.paddingPixels)}applyShaderOffsetsView(t,i,r,s,n,o,a){const l=this._normalAndViewAngle(i,r,n,zj);return this._applyVerticalGroundOffsetView(t,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(t,i,r,s,n){return this._applyCenterOffsetNDC(t,i,r,s),_(n)&&pe(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(t,i,r,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return pe(n,t);const c=He(Math.abs(i.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return fe(n,t,l>0?h:1/h),n}_applyVerticalGroundOffsetView(t,i,r,s){const n=Ue(t),o=r.aboveGround?1:-1,a=.5*r.computeRenderPixelSizeAtDist(n),l=fe(Ya,i.normal,o*a);return we(s,t,l),s}_applyVerticalOffsetTransformationView(t,i,r,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Ue(t);this._updateScaleInfo(s,c,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return t}const o=Ue(t),a=Ye(n.screenSizePerspectiveAlignment,n.screenSizePerspective),l=KMe(r,o,n.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(s,o,i.cosAngle),fe(i.normal,i.normal,l),we(t,t,i.normal)}_applyCenterOffsetView(t,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==t&&pe(r,t),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(Re(wR,r),we(r,r,fe(wR,wR,i[2])))),r}_applyCenterOffsetNDC(t,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==t&&pe(s,t),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(t,i,r,s){const n=this.parameters.shaderPolygonOffset;if(t!==s&&pe(s,t),n){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);s[2]-=(a||o)*n}return s}requiresSlot(t){if(t===$e.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:r}=this.parameters;return t===(i?$e.LABEL_MATERIAL:$e.HUD_MATERIAL)||r&&t===$e.OCCLUSION_PIXELS}createGLMaterial(t){return t.output===oe.Color||t.output===oe.Alpha?new ipt(t):t.output===oe.Highlight?new wOe(t):null}calculateRelativeScreenBounds(t,i,r=Qt()){return rpt(this.parameters,t,i,r),r[2]=r[0]+t[0],r[3]=r[1]+t[1],r}}class wOe extends aie{constructor(t){super(F(F({},t),t.material.parameters))}selectProgram(t){return this.ensureTechnique(GL,t)}beginSlot(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(t)}}class ipt extends wOe{_isOcclusionSlot(t){return t.slot===$e.OCCLUSION_PIXELS&&this._material.parameters.occlusionTest&&(this._output===oe.Color||this._output===oe.Alpha)}selectProgram(t){return this.ensureTechnique(GL,t,this._isOcclusionSlot(t)?oe.Occlusion:this._output)}}function rpt(e,t,i,r=npt){return po(r,e.anchorPosition),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i,r}function spt(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=1/Math.sqrt(t*t+i*i+r*r),p=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return e[0]=t*h,e[1]=i*h,e[2]=r*h,e[3]=s*p,e[4]=n*p,e[5]=o*p,e[6]=a*f,e[7]=l*f,e[8]=c*f,e}function Ade(e,t,i,r,s,n,o,a){let l=t-s-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*s,h=i-s-(a[1]>0?r[1]*a[1]:0),p=h+r[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&_(f)&&(l+=r[0]*f[0],h+=r[1]*f[1],c-=r[0]*(1-f[2]),p-=r[1]*(1-f[3]),l-=n,c+=n,h-=n,p+=n),e[0]>l&&e[0]<c&&e[1]>h&&e[1]<p}const kj={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},npt=Ke(),Ya=$(),wR=$(),bl=si(),xOe=$(),Mde=$(),Uj=ls(),opt=ls(),apt=Ne(),th=$(),zj={normal:xOe,cosAngle:0},Ode=Ne(),lpt=1,cpt=2,u_=[0,0],upt=Ze(0,0,1);class hpt extends sAe{constructor(){super(...arguments),this.renderOccluded=rs.Occlude,this.color=[1,1,1,1],this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=er(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=[1,1,1,1],this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.debugDrawLabelBorder=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const dpt=Bs().vec3f(P.POSITION).vec3f(P.NORMAL).vec2f(P.UV0).vec4u8(P.COLOR).vec2f(P.SIZE).vec4f(P.AUXPOS1).vec4f(P.AUXPOS2);class ppt{constructor(t){this.material=t,this.vertexBufferLayout=dpt}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(P.POSITION).length}write(t,i,r,s){O6(i.indices.get(P.POSITION),i.vertexAttributes.get(P.POSITION).data,t.transformation,r.position,s,6),Qie(i.indices.get(P.NORMAL),i.vertexAttributes.get(P.NORMAL).data,t.invTranspTransformation,r.normal,s,6);{const n=i.vertexAttributes.get(P.UV0).data;let o,a,l,c;if(n==null||n.length<4){const m=this.material.parameters;o=0,a=0,l=m.texCoordScale[0],c=m.texCoordScale[1]}else o=n[0],a=n[1],l=n[2],c=n[3];l=Math.min(1.99999,l+1),c=Math.min(1.99999,c+1);const h=i.indices.get(P.POSITION).length,p=r.uv0;let f=s;for(let m=0;m<h;++m)p.set(f,0,o),p.set(f,1,a),f+=1,p.set(f,0,l),p.set(f,1,a),f+=1,p.set(f,0,l),p.set(f,1,c),f+=1,p.set(f,0,l),p.set(f,1,c),f+=1,p.set(f,0,o),p.set(f,1,c),f+=1,p.set(f,0,o),p.set(f,1,a),f+=1}Gz(i.indices.get(P.COLOR),i.vertexAttributes.get(P.COLOR).data,4,r.color,s,6);{const n=i.indices.get(P.SIZE),o=i.vertexAttributes.get(P.SIZE).data,a=n.length,l=r.size;let c=s;for(let h=0;h<a;++h){const p=o[2*n[h]],f=o[2*n[h]+1];for(let m=0;m<6;++m)l.set(c,0,p),l.set(c,1,f),c+=1}}i.indices.get(P.AUXPOS1)&&i.vertexAttributes.get(P.AUXPOS1)&&RM(i.indices.get(P.AUXPOS1),i.vertexAttributes.get(P.AUXPOS1).data,r.auxpos1,s,6),i.indices.get(P.AUXPOS2)&&i.vertexAttributes.get(P.AUXPOS2)&&RM(i.indices.get(P.AUXPOS2),i.vertexAttributes.get(P.AUXPOS2).data,r.auxpos2,s,6)}}const xm=$(),H2=si(),xR=si(),Vj=$(),fpt=Ne(),mpt=fo(),Bj=Do(),gpt=$(),ypt=Qt();class vpt{constructor(){this.aabr=Qt(),this.distance=0,this.culled=!1,this.visible=!1}}class _pt{constructor(t,i,r={}){this.graphics3DGraphic=t,this.slicePlaneEnabled=i,this.info=r}}class bpt{constructor(){this.active=new Map,this.visible=new Map}clear(){this.active.clear(),this.visible.clear()}}class wpt{}class xpt{constructor(){this.sortArray=new ai({allocator:t=>t||new wpt})}}var fu;(function(e){e[e.Idle=0]="Idle",e[e.Process=1]="Process",e[e.Sort=2]="Sort",e[e.Deconflict=3]="Deconflict",e[e.NumStates=4]="NumStates"})(fu||(fu={}));class TOe{constructor(){this.camera=new xr,this.slicePlane=Jb(),this.slicePlaneEnabled=!1}copyFrom(t){this.camera.copyFrom(t.camera),i2(t.slicePlane,this.slicePlane),this.slicePlaneEnabled=t.slicePlaneEnabled}}let ZC=class extends Ee{constructor(){super(...arguments),this._dirty=!1,this._runningViewState=new TOe,this._state=fu.Idle,this.graphics=new bpt,this.iterators=new xpt,this.accBinsNumX=15,this.accBinsNumY=20,this.accBinsSizeX=0,this.accBinsSizeY=0,this.accBins=null,this.accNumTests=0}get dirty(){return this._dirty}get state(){return this._state}destroy(){this.graphics.clear(),this.iterators=null}setDirty(){!this._dirty&&this.graphics.active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==fu.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const e=this._state/fu.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(e){switch(this._state){case fu.Idle:this._startUpdate(),e.madeProgress();case fu.Process:if(this._state=fu.Process,!this._processActiveGraphics(e))return;case fu.Sort:if(this._state=fu.Sort,!this._sortVisibleGraphics(e))return;case fu.Deconflict:if(this._state=fu.Deconflict,!this._deconflictVisibleGraphics(e))return;default:Vht(this,this.graphics.visible),this._state=fu.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach(i=>this.addToActiveGraphics(i)):e.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(e){if(M(e)||e.type!=="object3d")return!1;const t=e.stageObject;return(t?t.geometryRecords.length:0)!==1?!1:t.geometryRecords[0].material instanceof PM}_startUpdate(){Bht(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._runningViewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new vpt,this.graphics.active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._removeFromVisibleGraphics(e),Tpt(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this.graphics.active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_addToVisibleGraphics(e){this.graphics.visible.set(e.graphics3DGraphic.graphic.uid,e)}_removeFromVisibleGraphics(e){this.graphics.visible.delete(e.graphics3DGraphic.graphic.uid)}_processActiveGraphics(e){const t=this._ensureActiveGraphicsIterator(),i=Ks(fpt,this._runningViewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?mpt:null;let s=0;for(_(r)&&(Xe(r,Hl,this._runningViewState.camera.viewMatrix),r[3]=Ri(this.view.spatialReference).radius,s=Owe(r,Hl));!e.done;){e.madeProgress();const n=t.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,s),a.culled?this._removeFromVisibleGraphics(o):this._addToVisibleGraphics(o))}return!1}_sortVisibleGraphics(e){const t=this._ensureSortGraphicsIterator();for(;!e.done;){const i=t.next();if(e.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){const t=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===da.LABEL;for(;!e.done;){e.madeProgress();const r=t.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=(!i||o.isVisible())&&!this._isConflicted(s);a&&this._addToBins(s),n.visible=a,this._setGraphicVisibility(s,a),jht(n,a)}return!1}_resetIterators(){this.iterators.active=null,this.iterators.visible=null,this.iterators.sort=null}_ensureActiveGraphicsIterator(){return this.iterators.active||(this.iterators.active=Rde(this.graphics.active)),this.iterators.active}_resetActiveGraphicsIterator(){this.iterators.active=null}_ensureVisibleGraphicsIterator(){return this.iterators.visible||(this.iterators.visible=Rde(this.graphics.visible)),this.iterators.visible}_resetVisibleGraphicsIterator(){this.iterators.visible=null}_ensureSortGraphicsIterator(){return this.iterators.sort||(this.iterators.sort=Spt(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup)),this.iterators.sort}_resetSortGraphicsIterator(){this.iterators.sort=null}_collectGraphics3DGraphics(e,t,i,r){const s=e.graphics3DGraphic;if(s.destroyed)return;const n=e.info[this.visibilityGroup];if(!s.isVisible(da.GRAPHIC,Bh.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);id(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometryRecords[0].material;if(M(a)){if(a=this._getProjectionInfo(l,t,Apt),a.isOutsideScreen||this._isCulledBySlice(e,xm)||_(i)&&this._isCulledByHorizon(a,i,r))return void(n.culled=!0);!dr.TESTS_DISABLE_OPTIMIZATIONS&&n.visible&&(a.distance*=.7)}this._expandBoundingRect(n,l,c,a)}M(a)?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(e,t,i){const r=this._runningViewState.camera,s=e.stageObject,n=s.geometryRecords[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;Xe(xm,a,r.viewMatrix);const l=n.geometry.vertexAttributes,c=l.get(P.NORMAL).data,h=l.get(P.AUXPOS1).data;return o.applyShaderOffsetsView(xm,c,s.transformation,h,r,i.scaleInfo,xm),_r(H2,xm[0],xm[1],xm[2],1),jh(xR,H2,r.projectionMatrix),fe(i.positionNDC,xR,1/xR[3]),o.applyShaderOffsetsNDC(i.positionNDC,h,r,i.positionNDC,Vj),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(Vj[2]),i.distance=Vj[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),_r(xR,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),jh(H2,xR,t),rL(H2,H2,1/H2[3]),he(i.positionView,xm[0],xm[1],xm[2]),i}_isCulledByHorizon(e,t,i){return pe(Bj.direction,e.positionView),he(Bj.origin,0,0,0),!!Yb(t,Bj,gpt)&&e.distanceWithoutPolygonOffset>i}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&aee(this._runningViewState.slicePlane,t)}_expandBoundingRect(e,t,i,{positionNDC:r,scaleInfo:s}){const n=this._runningViewState.camera,o=t.getScreenSize(Ept);GMe(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=vU(i.calculateRelativeScreenBounds(o,s.factorAlignment.scale,ypt),ui(0,n.fullWidth,.5+.5*r[0]),ui(0,n.fullHeight,.5+.5*r[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(zh(a),nm(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}GT(e.aabr,a,e.aabr)}_isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,i=e.info[this.visibilityGroup];for(let r=Math.floor(i.aabr[0]/this.accBinsSizeX);r<=Math.floor(i.aabr[2]/this.accBinsSizeX);r++)if(!(r<0||r>=this.accBinsNumX))for(let s=Math.floor(i.aabr[1]/this.accBinsSizeY);s<=Math.floor(i.aabr[3]/this.accBinsSizeY);s++){if(s<0||s>=this.accBinsNumY)continue;const n=this.accBins[r][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,hL(l.aabr,i.aabr)))return!0}}return!1}_initBins(e,t){if(this.accBins==null){this.accBins=[];for(let i=0;i<this.accBinsNumX;i++){this.accBins.push([]);const r=this.accBins[this.accBins.length-1];for(let s=0;s<this.accBinsNumY;s++)r.push(new ai)}}else for(let i=0;i<this.accBinsNumX;i++)for(let r=0;r<this.accBinsNumY;r++)this.accBins[i][r].clear();this.accBinsSizeX=e/this.accBinsNumX,this.accBinsSizeY=t/this.accBinsNumY,this.accNumTests=0}_addToBins(e){const t=e.info[this.visibilityGroup],i=Math.floor(t.aabr[0]/this.accBinsSizeX),r=Math.floor(t.aabr[2]/this.accBinsSizeX),s=Math.floor(t.aabr[1]/this.accBinsSizeY),n=Math.floor(t.aabr[3]/this.accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this.accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this.accBinsNumY||this.accBins[o][a].push(e)}_setGraphicVisibility(e,t){const i=e.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(Bh.DECONFLICTION,t,this.visibilityGroup),this.visibilityGroup===da.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,t))}};function Tpt(e,t){const i=e.graphics3DGraphic;i.destroyed||i.clearVisibilityFlag(Bh.DECONFLICTION,t)}function*Rde(e){if(Map.prototype.entries){const t=e.entries();for(let i=t.next();!i.done;i=t.next())yield i.value[1]}else yield*e.values()}function*Spt(e,t,i){t.clear(),e.forEach((s,n)=>{const o=t.pushNew();o.id=n,o.prio=s.info?-s.info[i].distance:Number.MAX_VALUE}),yield;const r=t.iterableSort((s,n)=>n.prio-s.prio);for(let s=r.next();!s.done;s=r.next())yield;t.forAll(s=>{const n=e.get(s.id);n&&(e.delete(s.id),e.set(s.id,n))}),t.clear()}u([d({constructOnly:!0})],ZC.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],ZC.prototype,"updating",null),ZC=u([L("esri.views.3d.layers.graphics.Deconflictor")],ZC);const Ept=Ke();class Cpt{constructor(){this.positionView=$(),this.positionNDC=$(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}get isOutsideScreen(){const t=this.positionNDC;return t[0]<-1||t[1]<-1||t[2]<-1||t[0]>=1||t[1]>=1}}const Apt=new Cpt,Mpt=2e3;let hk=class extends ZC{constructor(){super(...arguments),this.visibilityGroup=da.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return;const t=performance.now();(e.state===Mo.IDLE||t-this._lastDeconfliction>Mpt)&&(super.runTask(e),this.state===fu.Idle&&(this._lastDeconfliction=t))}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelGraphics}};u([d({constructOnly:!0})],hk.prototype,"parent",void 0),hk=u([L("esri.views.3d.layers.graphics.LabelDeconflictor")],hk);let KY=class extends ZC{constructor(){super(...arguments),this._handles=new Nt,this._contexts=new Map,this._viewState=new TOe,this.visibilityGroup=da.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([re(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.state)==null?void 0:t.camera},()=>{this._updateViewState(),this.setDirty()}),re(()=>{var e,t,i;return(i=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground)==null?void 0:i.opacity},(e,t)=>{e!==1&&t!==1||this.setDirty()}),re(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Et)]),this._frameTask=this.view.resourceController.scheduler.registerTask(Ot.GRAPHICS_DECONFLICTOR,this),this._labels=new hk({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const i=!(this._graphicSupportsDeconfliction(t)&&Gj(e));t.setVisibilityFlag(Bh.DECONFLICTION,i,da.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;_(e)&&jwe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=_(e)}_slicePlaneChanged(){Mn(this._contexts,(e,t)=>t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){let t=this._contexts.get(e);return t==null&&(t=new Map,this._contexts.set(e,t),this.setDirty()),{addGraphic:i=>this._addGraphic(e,t,i),removeGraphic:i=>this._removeGraphic(t,i),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,i){const r=i.graphic.uid,s=new _pt(i,e.symbolCreationContext.slicePlaneEnabled);t.set(r,s),Gj(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,t){const i=t.graphic.uid,r=e.get(i);r&&(this.removeFromActiveGraphics(r),this._labels.removeFromActiveGraphics(r),e.delete(i),this.setDirty())}enabledChanged(e,t){const i=Gj(e);i||Opt(e),this.modifyGraphics(t,i)}_slicePlaneEnabledChanged(e,t){const i=e.symbolCreationContext.slicePlaneEnabled;t.forEach(r=>r.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.graphics}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.graphics;if(!t||!t.length)return!1;for(const i of t)if(this.layerSupportsDeconfliction(i))return!0;return!1}};function Gj(e){const t=e.layer;return!(!t||!t.featureReduction||t.featureReduction.type!=="selection")}function Opt(e){const t=e.graphics3DGraphics;t&&t.forEach(i=>i.clearVisibilityFlag(Bh.DECONFLICTION))}KY=u([L("esri.views.3d.layers.graphics.GraphicsDeconflictor")],KY);const rre=(e,t,i)=>[t,i],IM=(e,t,i)=>[t,i,e[2]],sre=(e,t,i)=>[t,i,e[2],e[3]];function Pde(e){return e?{originPosition:e.originPosition==="upper-left"?"upperLeft":e.originPosition==="lower-left"?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:_(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function Rpt({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function Ppt({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function SOe({scale:e,translate:t},i){return i*e[0]+t[0]}function EOe({scale:e,translate:t},i){return t[1]-i*e[1]}function COe(e,t,i){const r=new Array(i.length);if(!i.length)return r;const[s,n]=e.scale;let o=SOe(e,i[0][0]),a=EOe(e,i[0][1]);r[0]=t(i[0],o,a);for(let l=1;l<i.length;l++){const c=i[l];o+=c[0]*s,a-=c[1]*n,r[l]=t(c,o,a)}return r}function AOe(e,t,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=COe(e,t,i[s]);return r}function Ipt(e,t,i,r){return COe(e,i?r?sre:IM:r?IM:rre,t)}function $pt(e,t,i,r){return AOe(e,i?r?sre:IM:r?IM:rre,t)}function Lpt(e,t,i,r){return AOe(e,i?r?sre:IM:r?IM:rre,t)}function E5t(e,t,i,r,s){return t.x=Rpt(e,i.x),t.y=Ppt(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m)),t}function MOe(e,t,i,r,s){return _(i)&&(t.points=Ipt(e,i.points,r,s)),t}function OOe(e,t,i,r,s){return M(i)||(t.x=SOe(e,i.x),t.y=EOe(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m))),t}function ROe(e,t,i,r,s){return _(i)&&(t.rings=Lpt(e,i.rings,r,s)),t}function POe(e,t,i,r,s){return _(i)&&(t.paths=$pt(e,i.paths,r,s)),t}function IOe(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let i=0;i<e.length;i++){const r=e[i],s=t[i];if(r.length!==s.length)return!1;for(let n=0;n<r.length;n++)if(r[n]!==s[n])return!1}return!0}function $Oe(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!IOe(e[i],t[i]))return!1;return!0}function Dpt(e,t){return!!jL(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function Npt(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!jL(e.spatialReference,t.spatialReference)&&$Oe(e.paths,t.paths)}function Fpt(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!jL(e.spatialReference,t.spatialReference)&&$Oe(e.rings,t.rings)}function kpt(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!jL(e.spatialReference,t.spatialReference)&&IOe(e.points,t.points)}function Upt(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!jL(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}function jL(e,t){return e===t||e&&t&&e.equals(t)}function zpt(e,t){if(e===t)return!0;if(M(e)||M(t)||e.type!==t.type)return!1;switch(e.type){case"point":return Dpt(e,t);case"extent":return Upt(e,t);case"polyline":return Npt(e,t);case"polygon":return Fpt(e,t);case"multipoint":return kpt(e,t);case"mesh":return!1;default:return}}function Vpt(e,t){if(e===t)return!0;if(!e||!t)return!1;const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const s of i)if(e[s]!==t[s])return!1;return!0}function C5t(e,t){return e===t||e!=null&&t!=null&&e.objectId===t.objectId&&!!zpt(e.geometry,t.geometry)&&!!Vpt(e.attributes,t.attributes)}class A5t{constructor(t,i,r){this.uid=t,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}}function M5t(e){return _(e.geometry)}class O5t{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function R5t(e){const t=__e.fromJSON(e.geometryType),i=at.fromJSON(e.spatialReference),r=e.transform,s=e.features.map(n=>{const o=Bpt(n,t,i,e.objectIdFieldName),a=o.geometry;if(_(a)&&r)switch(a.type){case"point":o.geometry=OOe(r,a,a,a.hasZ,a.hasM);break;case"multipoint":o.geometry=MOe(r,a,a,a.hasZ,a.hasM);break;case"polygon":o.geometry=ROe(r,a,a,a.hasZ,a.hasM);break;case"polyline":o.geometry=POe(r,a,a,a.hasZ,a.hasM);break;case"extent":case"mesh":o.geometry=a}return o});return{geometryType:t,features:s,spatialReference:i,fields:e.fields?e.fields.map(n=>hO.fromJSON(n)):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function Bpt(e,t,i,r){return{uid:Dc(),objectId:r&&e.attributes?e.attributes[r]:null,attributes:e.attributes,geometry:Gpt(e.geometry,t,i),visible:!0}}function Gpt(e,t,i){if(M(e))return null;switch(t){case"point":{const r=e;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=e;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=e;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=e;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function jv(e,t,i,r){return{x:e,y:t,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function jpt(e){if(M(e))return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(e.hasZ?1:0)+(e.hasM?1:0),s=e.type==="polyline"?e.paths:e.rings;for(const n of s)i+=n.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32*(s.length+1);break}case"multipoint":{const i=2+(e.hasZ?1:0)+(e.hasM?1:0),r=e.points.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=ED(e.vertexAttributes.position),t+=ED(e.vertexAttributes.normal),t+=ED(e.vertexAttributes.uv),t+=ED(e.vertexAttributes.tangent)}return t}function P5t(e){let t=32;return t+=swe(e.attributes),t+=3,t+=8+jpt(e.geometry),t}function Hpt(e){if(M(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function I5t(e){if(M(e))return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function $5t(e,t){switch(Nr(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)UG(t,e.paths[i],e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)UG(t,e.rings[i],e.hasZ);break;case"multipoint":UG(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,e.zmin!=null&&(t[2]=e.zmin),e.zmax!=null&&(t[5]=e.zmax)}}function qpt(e,t){switch(id(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)kG(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)kG(t,e.rings[i]);break;case"multipoint":kG(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function L5t(e,t){return e.objectId!=null?e.objectId:e.attributes&&t?e.attributes[t]:null}In();Qt();function LOe(e){return"declaredClass"in e}function Ide(e){return"declaredClass"in e}function Wpt(e){return"declaredClass"in e}function Zpt(e,t){if(!e)return null;if(Wpt(e))return e;const i=new Ha({layer:t,sourceLayer:t});return i.visible=e.visible,i.symbol=ue(e.symbol),i.attributes=ue(e.attributes),i.geometry=DOe(e.geometry),i}function DOe(e){return M(e)?null:LOe(e)?e:jg(Xpt(e))}function Xpt(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:i,y:r,z:s,m:n}=e;return{x:i,y:r,z:s,m:n,spatialReference:t}}case"polygon":{const{rings:i,hasZ:r,hasM:s}=e;return{rings:$de(i),hasZ:r,hasM:s,spatialReference:t}}case"polyline":{const{paths:i,hasZ:r,hasM:s}=e;return{paths:$de(i),hasZ:r,hasM:s,spatialReference:t}}case"extent":{const{xmin:i,xmax:r,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:h,hasM:p}=e;return{xmin:i,xmax:r,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:h,hasM:p,spatialReference:t}}case"multipoint":{const{points:i,hasZ:r,hasM:s}=e;return{points:FOe(i)?NOe(i):i,hasZ:r,hasM:s,spatialReference:t}}default:return}}function $de(e){return Ypt(e)?e.map(t=>NOe(t)):e}function NOe(e){return e.map(t=>t5e(t))}function Ypt(e){for(const t of e)if(t.length!==0)return FOe(t);return!1}function FOe(e){return e.length&&(Q0e(e[0])||K0e(e[0]))}function Jpt(e,t){if(!e)return null;let i;if(Ide(e)){if(t==null)return e.clone();if(Ide(t))return t.copy(e)}return t!=null?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=null,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=null,i.hasM=!1)):(i=jv(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}const jj=ve.getLogger("esri.layers.support.labelFormatUtils"),Lde={type:"simple",evaluate:()=>null},Qpt={getAttribute:(e,t)=>e.field(t)};async function kOe(e,t,i){if(!e||!e.symbol)return Lde;const r=e.where,s=e6(e),n=r?await Promise.resolve().then(function(){return Ese}):null;let o;if(s.type==="arcade"){const a=await zUe(s.expression,i,t);o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{jj.error(new W("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>Pte(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replace(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=t.get(c);if(!h)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[h.name]):p=a.field(h.name),p==null?"":UOe(p,h)})};if(r){let a;try{a=n.WhereClause.create(r,t)}catch(c){return jj.error(new W("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:c})),Lde}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:Qpt;try{if(a.testFeature(c,h))return l(c)}catch(p){jj.error(new W("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:c,error:p}))}return null}}return o}function UOe(e,t){if(e==null)return"";const i=t.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=e;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const s=+e,n="range"in i?i.range[0]:i.minValue,o="range"in i?i.range[1]:i.maxValue;if(n<=s&&s<=o)return i.name}}let r=e;return t.type==="date"||t.type==="esriFieldTypeDate"?r=Sn(r,HV("short-date")):jV(t)&&(r=Wl(+r)),r||""}var D5t=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",createLabelFunction:kOe,formatField:UOe});function nre(e,t){if(e.type==="point")return h_(e,t,!1);if(LOe(e))switch(e.type){case"extent":return h_(e.center,t,!1);case"polygon":return h_(e.centroid,t,!1);case"polyline":return h_(Dde(e),t,!0);case"mesh":return h_(e.origin,t,!1)}else switch(e.type){case"extent":return h_(Kpt(e),t,!0);case"polygon":return h_(eft(e),t,!0);case"polyline":return h_(Dde(e),t,!0)}}function Dde(e){const t=e.paths[0];if(!t||t.length===0)return null;const i=s_e(t,r_e(t)/2);return jv(i[0],i[1],i[2],e.spatialReference)}function Kpt(e){const t=isFinite(e.zmin);return jv(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function eft(e){const t=e.rings[0];if(!t||t.length===0)return null;const i=o_e(e.rings,e.hasZ);return jv(i[0],i[1],i[2],e.spatialReference)}function h_(e,t,i){const r=i?e:Jpt(e);return t&&e?v8e(e,r,t)?r:null:r}function N5t(e,t,i,r=0){if(e){t||(t=Qt());const s=e;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),_r(t,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),t}return null}function zOe(e,t){for(let i=0;i<e.geometries.length;++i){const r=e.geometries[i].getMutableAttribute(P.AUXPOS1);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[i]))}}function r3(e,t){const i=gB(lp);return _(e)&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),_(t)?i[3]=t:_(e)&&e.length>3&&(i[3]=e[3]),i}function F5t(e,t,i,r,s,n=[0,0,0,0]){for(let o=0;o<3;++o)_(e)&&e[o]!=null?n[o]=e[o]:_(i)&&i[o]!=null?n[o]=i[o]:n[o]=s[o];return _(t)?n[3]=t:_(r)?n[3]=r:n[3]=s[3],n}function Nde(e=Cg,t,i,r=1){const s=new Array(3);if(M(t)||M(i))s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=e[a];let c;const h=l!=null,p=a===0&&!n&&!h,f=i[a];l==="symbol-value"||p?c=f!==0?t[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=r;return Tc(s)}function tft(e){return e.isPrimitive!=null}function N6(e){return tft(e)&&(e=[e.width,e.depth,e.height]),Zz(e)?null:"Symbol sizes may not be negative values"}function Zz(e){if(Array.isArray(e)){for(const t of e)if(!Zz(t))return!1;return!0}return e==null||e>=0}function ift(e,t,i,r=Ne()){const s=e||0,n=t||0,o=i||0;return s!==0&&QA(r,r,-s/180*Math.PI),n!==0&&JA(r,r,n/180*Math.PI),o!==0&&hB(r,r,o/180*Math.PI),r}function ore(e,t){return t.minDemResolution!=null?t.minDemResolution:KV(e)?t.minDemResolutionForPoints:.01*Yze(e)}function are(e,t,i,r,s,n,o,a,l,c,h){const p=uft[h.mode];let f,m,g=0;if($r(e,t,i,r,l.spatialReference,s,a))return p.requiresAlignment(h)?(g=p.applyElevationAlignmentBuffer(r,s,n,o,a,l,c,h),f=n,m=o):(f=r,m=s),$r(f,l.spatialReference,m,n,c.spatialReference,o,a)?g:void 0}function Av(e,t,i,r,s){const n=(kz(e)?e.z:_Me(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const o=Ye(Ag(t,e,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=Ye(Ag(t,e,"ground"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=Ye(Ag(t,e,"scene"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(n,r),a=Ye(Ag(t,e,"ground"),0);return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return i.mode,void(s.z=0)}}function rft(e,t,i,r){return Av(e,t,i,r,XC),XC.z}function HL(e,t,i){return t==null||i==null?e.definedChanged:t==="on-the-ground"&&i==="on-the-ground"?e.staysOnTheGround:t===i||t!=="on-the-ground"&&i!=="on-the-ground"?Is.UPDATE:e.onTheGroundChanged}function Op(e){return e==="relative-to-ground"||e==="relative-to-scene"}function Gb(e){return e!=="absolute-height"}function sft(e,t,i,r,s){Av(t,i,s,r,XC),zOe(e,XC.verticalDistanceToGround);const n=XC.sampledElevation,o=ln(hft,e.transformation);return iF[0]=t.x,iF[1]=t.y,iF[2]=XC.z,nd(t.spatialReference,iF,o,r.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function nft(e,t,i,r,s,n){let o=0;const a=n.spatialReference;t*=3,r*=3;for(let l=0;l<s;++l){const c=e[t+0],h=e[t+1],p=e[t+2],f=Ye(n.getElevation(c,h,p,a,"ground"),0);o+=f,i[r+0]=c,i[r+1]=h,i[r+2]=f,t+=3,r+=3}return o/s}function oft(e,t,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,r*=3;for(let f=0;f<s;++f){const m=e[t+0],g=e[t+1],y=e[t+2],x=Ye(n.getElevation(m,g,y,p,"ground"),0);l+=x,i[r+0]=m,i[r+1]=g,i[r+2]=h==null?y+x+c:x+c,t+=3,r+=3}return l/s}function aft(e,t,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,r*=3;for(let f=0;f<s;++f){const m=e[t+0],g=e[t+1],y=e[t+2],x=Ye(n.getElevation(m,g,y,p,"scene"),0);l+=x,i[r+0]=m,i[r+1]=g,i[r+2]=h==null?y+x+c:x+c,t+=3,r+=3}return l/s}function lft(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return t!==0||i!=null}function cft(e,t,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;t*=3,r*=3;for(let h=0;h<s;++h){const p=e[t+0],f=e[t+1],m=e[t+2];i[r+0]=p,i[r+1]=f,i[r+2]=c==null?m+l:l,t+=3,r+=3}return 0}class qL{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}var Is;(function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"})(Is||(Is={}));const uft={"absolute-height":{applyElevationAlignmentBuffer:cft,requiresAlignment:lft},"on-the-ground":{applyElevationAlignmentBuffer:nft,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:oft,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:aft,requiresAlignment:()=>!0}},hft=Ne(),XC=new qL,iF=$();function VOe(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;let o=0;for(const a of n){const{update:l,averageGeometrySampledElevation:c}=GOe(a,t,i,r);o+=c,l&&s.geometryVertexAttrsUpdated(a)}return o/n.length}function I$(e,t,i,r){const s=e.stageObject,n=t.centerPointInElevationSR;let o=0;s.metadata.usesVerticalDistanceToGround?(Av(n,i,t,r,Ac),zOe(s,Ac.verticalDistanceToGround),o=Ac.sampledElevation):(Av(n,i,t,r,Ac),t.mode!=="absolute-height"&&(o=Ac.sampledElevation));const a=ln(dft,s.transformation),l=he(BOe,a[12],a[13],a[14]);dr.TESTS_DISABLE_OPTIMIZATIONS?(Cc[0]=n.x,Cc[1]=n.y,Cc[2]=Ac.z,nd(n.spatialReference,Cc,a,r.spatialReference)&&(s.transformation=a)):r.setAltitudeOfTransformation(Ac.z,a);const c=lre/r.unitInMeters;return(Math.abs(a[12]-l[0])>=c||Math.abs(a[13]-l[1])>=c||Math.abs(a[14]-l[2])>=c)&&(s.transformation=a),o}const dft=Ne();function pft(e,t,i,r){const s=e.graphics3DSymbolLayer.lodRenderer;if(M(s))return 0;const n=t.centerPointInElevationSR;Av(n,i,t,r,Ac);const o=t.mode!=="absolute-height"?Ac.sampledElevation:0,a=s.instanceData,l=e.instanceIndex,c=mft;a.getGlobalTransform(l,c);const h=he(BOe,c[12],c[13],c[14]);dr.TESTS_DISABLE_OPTIMIZATIONS?(Cc[0]=n.x,Cc[1]=n.y,Cc[2]=Ac.z,nd(n.spatialReference,Cc,c,r.spatialReference)&&a.setGlobalTransform(l,c)):r.setAltitudeOfTransformation(Ac.z,c);const p=lre/r.unitInMeters;return(dr.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(c[12]-h[0])>=p||Math.abs(c[13]-h[1])>=p||Math.abs(c[14]-h[2])>=p)&&a.setGlobalTransform(l,c),o}function fft(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;if(n.length===0)return 0;let o=0,a=null,l=0,c=!1;for(const h of n){const p=h.geometry.vertexAttributes.get(P.POSITION);if(p!==a){const{update:f,averageGeometrySampledElevation:m}=GOe(h,t,i,r);l=m,a=p,c=f}c&&s.geometryVertexAttrsUpdated(h),o+=l}return o/n.length}const lre=.01,Cc=$(),md=$(),q2=$(),mft=Ne(),BOe=$(),Ac=new qL;function GOe(e,t,i,r){let s=!1;const n=i.spatialReference,o=e.geometry,a=e.getShaderTransformation(),l=t.requiresSampledElevationInfo;md[0]=a[12],md[1]=a[13],md[2]=a[14],o.invalidateBoundingInfo();const c=o.getMutableAttribute(P.POSITION),h=c.data,p=o.vertexAttributes.get(P.MAPPOS).data,f=c.size,m=h.length/f,g=new vMe(p,n);let y=0,x=0;for(let b=0;b<m;b++){if(q2[0]=h[y],q2[1]=h[y+1],q2[2]=h[y+2],Av(g,i,t,r,Ac),l&&(x+=Ac.sampledElevation),dr.TESTS_DISABLE_OPTIMIZATIONS)h[y]=g.array[g.offset],h[y+1]=g.array[g.offset+1],h[y+2]=Ac.z,$r(h,n,y,h,r.spatialReference,y,1),h[y]-=md[0],h[y+1]-=md[1],h[y+2]-=md[2],s=!0;else{Cc[0]=h[y]+md[0],Cc[1]=h[y+1]+md[1],Cc[2]=h[y+2]+md[2],r.setAltitude(Cc,Ac.z),h[y]=Cc[0]-md[0],h[y+1]=Cc[1]-md[1],h[y+2]=Cc[2]-md[2];const S=lre/r.unitInMeters;(Math.abs(q2[0]-h[y])>=S||Math.abs(q2[1]-h[y+1])>=S||Math.abs(q2[2]-h[y+2])>=S)&&(s=!0)}y+=f,g.offset+=3}return x/=m,{update:s,averageGeometrySampledElevation:x}}const gft=ve.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function yft(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function k5t(e){const t=e&&e.expression;if(typeof t=="string"){const i=qOe(t);if(i!=null)return{cachedResult:i}}return null}async function U5t(e,t,i){const r=e&&e.expression;if(typeof r!="string")return null;const s=qOe(r);if(s!=null)return{cachedResult:s};const n=await sm(),o=n.arcadeUtils,a=o.createSyntaxTree(r);return o.dependsOnView(a)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(a),context:o.createExecContext(null,{sr:t}),modules:n}}}function jOe(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function cre(e,t){if(e!=null&&!HOe(e)){if(!t||!e.arcade)return void gft.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=DOe(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function vft(e){if(e!=null){if(HOe(e))return e.cachedResult;const t=e.arcade;let i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return typeof i!="number"&&(e.cachedResult=0,i=0),i}return 0}function z5t(e,t=!1){let i=e&&e.featureExpressionInfo;const r=i&&i.expression;return t||r==="0"||(i=null),i}const _ft={cachedResult:0};function HOe(e){return e.cachedResult!=null}function qOe(e){return e==="0"?0:null}class ud{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(t){this._unit=t,this._metersPerElevationInfoUnit=X2e(t)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(t){this._meterUnitOffset=t,this._renderUnitOffset=0}set offsetElevationInfoUnits(t){this._meterUnitOffset=t*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(t){this._renderUnitOffset+=t}geometryZWithOffset(t,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:t+r}calculateOffsetRenderUnits(t){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=vft(r)*this._metersPerElevationInfoUnit),i/t.unitInMeters+this._renderUnitOffset}setFromElevationInfo(t){this.mode=t.mode,this.unit=dKe(t.unit)?t.unit:"meters",this.offsetElevationInfoUnits=Ye(t.offset,0)}updateFeatureExpressionInfoContext(t,i,r){if(M(t))return void(this._featureExpressionInfoContext=null);const s=t&&t.arcade;s&&_(i)&&_(r)?(this._featureExpressionInfoContext=yft(t),cre(this._featureExpressionInfoContext,jOe(s.modules,i,r))):this._featureExpressionInfoContext=t}static fromElevationInfo(t){const i=new ud;return _(t)&&i.setFromElevationInfo(t),i}}var Xt;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"})(Xt||(Xt={}));class _y{constructor(t,i,r,s,n,o,a,l=null){this.graphics3DSymbolLayer=t,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=t,this.stageObject=i}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(t,i){this._stageLayer=i,this._stage=t,t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){const t=this._stage;this._stageLayer&&(t.removeMany(this._uniqueMaterials),t.removeMany(this._uniqueGeometries)),t.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const i=this._stage.renderView.ensureEdgeView();i.hasObject(this.stageObject)&&i.removeObject(this.stageObject),this.stageObject.dispose(),_(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(t,i){if(M(this._edgeState))return;const r=Fde(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==r&&(n.objectTransparency=r,s=!0);s&&this._resetEdgeObject(i),this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[t])}slicePlaneEnabledChanged(t,i){M(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:t},!i),this._edgeState.properties.hasSlicePlane=t)}setVisibility(t){if(this._stage!=null&&this._visible!==t&&(this._visible=t,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),_(this._edgeState))){const i=this._stage.renderView.ensureEdgeView();i.hasObject(this.stageObject)?i.updateObjectVisibility(this.stageObject,t):t&&this._addOrUpdateEdgeObject(i,!1)}}get visible(){return this._visible}alignWithElevation(t,i,r,s){this.elevationAligner!=null&&(_(r)&&cre(this.elevationContext.featureExpressionInfoContext,r),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,t,i),this._resetEdgeObject(s))}getCenterObjectSpace(t=$()){return pe(t,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(t=In()){const i=this.stageObject.boundingVolumeObjectSpace;return c1e(t,i.min),u1e(t,i.max),t}computeAttachmentOrigin(t){if(this.useObjectOriginAsAttachmentOrigin){const i=this.stageObject.transformation;t.render.origin[0]+=i[12],t.render.origin[1]+=i[13],t.render.origin[2]+=i[14],t.render.num++}else for(const i of this.stageObject.geometryRecords)i.computeAttachmentOrigin($y)&&(Xe($y,$y,this.stageObject.transformation),we(t.render.origin,t.render.origin,$y),t.render.num++)}async getProjectedBoundingBox(t,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=bft,l=KV(o)?1:a.length;for(let h=0;h<l;h++){const p=a[h];d_[0]=o[p[0]],d_[1]=o[p[1]],d_[2]=o[p[2]],Xe(d_,d_,this.stageObject.transformation),xw[3*h+0]=d_[0],xw[3*h+1]=d_[1],xw[3*h+2]=d_[2]}if(!t(xw,0,l))return null;Nr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],xw[h+p]),o[p+3]=Math.max(o[p+3],xw[h+p]);c&&r.push({location:xw.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&i.service&&this.elevationContext.mode!=="absolute-height"){Df(o,$y);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(i.useViewElevation)p=Ye(i.service.getElevation($y[0],$y[1],h),0);else try{const f=ore(o,i);p=Ye(await i.service.queryElevation($y[0],$y[1],s,f,h),0)}catch{}l1e(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(t,i){t===Tv.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),t===Tv.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(t){t.removeObject(this.stageObject)}_resetEdgeObject(t){if(M(this._edgeState))return;const i=this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(i,t):i.removeObject(this.stageObject)}_addOrUpdateEdgeObject(t,i){const r=this._edgeState;if(M(r))return;const s=Fde(r.baseMaterial);for(const n of r.edgeMaterials)n.objectTransparency=s;t.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!i).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}}function Fde(e){return e.isVisible?e.parameters.transparent?Xt.TRANSPARENT:Xt.OPAQUE:Xt.INVISIBLE}const xw=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d_=$(),$y=$(),bft=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];var qn;(function(e){e[e.Recreate_Symbol=0]="Recreate_Symbol",e[e.Recreate_Graphics=1]="Recreate_Graphics",e[e.Fast_Update=2]="Fast_Update"})(qn||(qn={}));class ure{constructor(t){this.schedule=t,this._loadStatus=Lh.LOADING,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(t,i){return this._loadStatus===Lh.LOADED?(t&&t(),this._loader):this._loadStatus===Lh.FAILED?(i&&i(this._loadError),this._loader):(M(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Lh.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=Lh.FAILED,!as(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(t,i).catch(()=>{}),this._loader)}abortLoad(){_(this._abortController)?this._abortController=Wn(this._abortController):this._loadStatus===Lh.LOADING&&(this._loadStatus=Lh.FAILED),this._loader=null}}var Lh;(function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"})(Lh||(Lh={}));function wft(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function WOe(e,t){const i=(r,s,n=!1)=>({levels:r.map(o=>{const a=s(o.tesselation);return n&&vu.cgToGIS(a),{components:[{geometry:a,material:t}],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(e){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>vu.createPolySphereGeometry(.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>vu.createBoxGeometry(1));case"cone":return i(Hj,r=>vu.createConeGeometry(1,.5,r,!1),!0);case"inverted-cone":return i(Hj,r=>vu.createConeGeometry(1,.5,r,!0),!0);case"cylinder":return i(Hj,r=>vu.createCylinderGeometry(1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>vu.createTetrahedronGeometry(1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>vu.createDiamondGeometry(1),!0);default:return}}const Hj=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function xft(e){return e.type==="fill"}function Tft(e){return e.type==="extrude"}function Sft(e){return e&&e.enabled&&(Tft(e)||xft(e))&&_(e.edges)}function Eft(e){return e&&e.enabled&&e.edges||null}function ZOe(e,t){return XOe(Eft(e),t)}function XOe(e,t){if(M(e))return null;const i=_(e.color)?yB(Le.toUnitRGBA(e.color)):zi(0,0,0,0),r=$i(e.size),s=$i(e.extensionLength);switch(e.type){case"solid":return YOe(F({color:i,size:r,extensionLength:s},t));case"sketch":return Cft(F({color:i,size:r,extensionLength:s},t));default:return}}function YOe(e){return me(F(F({},Aft),e),{type:"solid"})}function Cft(e){return me(F(F({},Mft),e),{type:"sketch"})}const Aft={color:zi(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Xt.OPAQUE,hasSlicePlane:!1},Mft={color:zi(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Xt.OPAQUE,hasSlicePlane:!1};function rF(e){const t=[];return e.levels.forEach(i=>{i.components.forEach(r=>{t.push(r.material)})}),sL(t)}function Oft(e){const t=new Array;return e.levels.forEach(i=>{i.components.forEach(r=>{r.textures&&t.push(...r.textures)})}),sL(t)}function hre(e){const t=[];return e.components.forEach(i=>{t.push(i.geometry)}),sL(t)}function Rft(e){const t=[];return e.levels.forEach(i=>{i.components.forEach(r=>{t.push(r.geometry)})}),sL(t)}function Pft(e){return hre(e).reduce((t,i)=>t+i.indexCount/3,0)}const dre={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function V5t(e){return e.type==="web-style"?dre:pre(e.symbolLayers.toArray().map(t=>JOe(e,t)))}function pre(e){let t=0,i=0,r=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of e)M(a)||(t+=a.primitivesPerFeature,i+=a.primitivesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:t,primitivesPerCoordinate:i,drawCallsPerFeature:r,estimated:s,memory:o,numComplexities:n}}function B5t(e){const t=pre(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const kde={};function JOe(e,t){const i=QOe(e,t),r=Sft(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:r,estimated:!1,memory:i};case"fill":return e.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:r,estimated:!1,memory:i}:_(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:i}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:i};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:i}:me(F({},Ift(t.resource&&t.resource.primitive||OK)),{memory:i});case"path":{let a=0,l=0;switch(t.profile){case"circle":a=10;break;case"quad":a=4;break;default:return void(t.profile,void 0)}switch(t.join){case"round":l=3;break;case"miter":case"bevel":l=1;break;default:return void(t.join,void 0)}const c=2*a,h=a*l*2;let p=-2*h-c;switch(t.cap){case"none":break;case"butt":case"square":p+=2*(a-1);break;case"round":p+=2*(a*(3-1)*2+a);break;default:return}return{primitivesPerFeature:p,primitivesPerCoordinate:h+c,drawCallsPerFeature:0,estimated:!1,memory:i}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:i};default:return}}function QOe(e,t){const i=e.type==="point-3d";switch(t.type){case"extrude":return t.edges&&t.edges.size>0?rc.EXTRUDE_EDGES:rc.EXTRUDE;case"fill":return _(t.outline)&&t.outline.size>0?rc.FILL_OUTLINE:rc.FILL;case"water":return rc.FILL;case"line":return t.join==="round"?rc.LINE_ROUND:rc.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return rc.PATH_ROUND_CIRCLE;case"quad":return rc.PATH_ROUND_QUAD;default:return void(t.profile,void 0)}case"miter":case"bevel":switch(t.profile){case"circle":return rc.PATH_MITER_CIRCLE;case"quad":return rc.PATH_MITER_QUAD;default:return void(t.profile,void 0)}default:return void(t.join,void 0)}case"object":return i?rc.OBJECT_POINT:rc.OBJECT_POLYGON;case"icon":case"text":return i?rc.ICON_POINT:rc.ICON_POLYGON;default:return}}function Ift(e){let t=kde[e];if(t)return t;const i=WOe(e,null);return t={primitivesPerFeature:hre(i.levels[0]).reduce((r,s)=>r+s.indices.get(P.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},kde[e]=t,t}const rc={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}},sF=ve.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class by extends ure{constructor(t,i,r,s){super(r.schedule),this._context=r,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=sF,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=t,this.symbolLayer=i,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new ud,this.complexity=this.computeComplexity(),this._ignoreDrivers=s.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=Ude(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(t){if(this._ignoreDrivers)return!1;const i=this._drivenProperties,r=Ude(t);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(t,i,r,s){const n=t.projectionSuccess,o="polygons"in t?t.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!i.length||i.length===1&&!i[0].length?l=`${a} (no ${r} were defined)`:Array.isArray(i)&&Array.isArray(i[0])?o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (${r} should be defined as a 2D array)`:l=`${a} (failed to project geometry to view spatial reference)`,l&&sF.warnOncePerTick(l)}_validateGeometry(t,i=null,r=null){if(_(i)&&!i.includes(t.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${t.type}`),!1;if(t.type==="point"){const s=t;if(!isFinite(s.x)||!isFinite(s.y))return sF.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return $ft}_defaultElevationInfoZ(){return Lft}_updateElevationContext(){_(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(t){return t.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(t,i=this.getDefaultElevationInfo(t)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(t){this._elevationInfoOverride=t,this._updateElevationContext()}setGraphicElevationContext(t,i){const r=t.geometry,s=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,i.mode=this.getGeometryElevationMode(r,s),i.offsetMeters=Ye(this._elevationContext.meterUnitOffset,Ye(s.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";n&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=n?_ft:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,t,this._context.layer),i}prepareSymbolLayerPatch(t){}updateGeometry(t,i){return!1}onRemoveGraphic(t){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const t=this._context.layer.opacity;return t==null?1:t}_getCombinedOpacity(t,i=zde){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(_(t)?r*=t.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(t,i=zde){const r=this._getCombinedOpacity(t,i);if(this._drivenProperties.color)return r3(null,r);const s=_(t)?Le.toUnitRGB(t):Cg;return r3(s,r)}_getVertexOpacityAndColor(t,i=null){const r=this._drivenProperties.color?t.color:null,s=this._drivenProperties.opacity?t.opacity:null,n=r3(r,s);return _(i)&&(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return JOe(this.symbol,this.symbolLayer)}globalPropertyChanged(t,i,r){switch(t){case"opacity":return this.layerOpacityChanged(i,r);case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==Is.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(t,i,r){let s=Is.UPDATE;return t.forEach(n=>{const o=i(n);if(_(o)){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else s=Is.RECREATE}),s}applyRendererDiff(t,i){return qn.Recreate_Symbol}getFastUpdateAttrValues(t){if(!this._fastUpdates.enabled)return null;const i=this._fastUpdates.visualVariables,r=i.size?rv(i.size.field,t):0,s=i.color?rv(i.color.field,t):0,n=i.opacity?rv(i.opacity.field,t):0;return zi(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(t){return this._draped==null?(this._draped=t,!0):(t!==this.draped&&sF.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const t=()=>{var i,r,s,n,o,a,l,c,h,p,f,m,g,y,x,b;return{size:(n=(s=(r=(i=this._fastUpdates)==null?void 0:i.visualVariables)==null?void 0:r.size)==null?void 0:s.field)!=null?n:null,color:(c=(l=(a=(o=this._fastUpdates)==null?void 0:o.visualVariables)==null?void 0:a.color)==null?void 0:l.field)!=null?c:null,opacity:(m=(f=(p=(h=this._fastUpdates)==null?void 0:h.visualVariables)==null?void 0:p.opacity)==null?void 0:f.field)!=null?m:null,rotation:(b=(x=(y=(g=this._fastUpdates)==null?void 0:g.visualVariables)==null?void 0:y.rotation)==null?void 0:x.field)!=null?b:null}};return{drivenProperties:this._drivenProperties,getVisVarFields:t}}}function rv(e,t){const i=e!=null?t.attributes[e]:0;return i!=null&&isFinite(i)?i:0}function Ude(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach(i=>{switch(i.type){case"color":if(t.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const s=i.stops[r].color;s&&(t.opacity=!0,s.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}}),t}const $ft={mode:"on-the-ground",offset:0,unit:"meters"},Lft={mode:"absolute-height",offset:0,unit:"meters"},zde={hasIntrinsicColor:!1};class LS{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(t,i,r,s,n,o){this.id=Dc(),this.geometry=t,this.material=i,this.transformation=r,this.instanceParameters=s,this.origin=n,this._shaderTransformation=o,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return _(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(t){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,t):this.geometry.computeAttachmentOrigin(t))&&(Xe(t,t,this.getStaticTransformation()),!0)}}LS.pool=new un(LS);class Xz{constructor(t){this.channel=t,this.id=Dc()}}class Hv extends NL{constructor(t={}){super(),this.type=um.Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=Ne(),this._bvObjectSpace=new Vde,this._bvWorldSpace=new Vde,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=t.castShadow==null||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new KOe),this.transformation=Ne();const{geometries:i,materials:r,transformations:s,origins:n}=t;if(Array.isArray(i)){Ct(r.length===i.length,"Object3D: materials don't match geometries"),Ct(s.length===i.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=i.length,this._geometries.length=i.length;for(let o=0;o<i.length;o++)this._geometries[o]=i[o],this._geometryRecords[o]=LS.pool.acquire(i[o],r[o],ZT(s[o]),{highlights:null,occludees:null,visible:this._visible},n&&n[o])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(t){ln(this._objectTransformation,t),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(t){Ct(this._parentLayer==null||t==null,"Object3D can only be added to a single Layer"),this._parentLayer=t}addGeometry(t,i,r,s,n){r=r||Xn,this._geometries.push(t);const o=LS.pool.acquire(t,i,r,{highlights:null,occludees:null,visible:this._visible},s,n);return this._geometryRecords.push(o),this._hasVolatileTransformation=this._hasVolatileTransformation||_(o.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:o}),this._invalidateBoundingVolume(),o}removeGeometry(t){const i=this._geometryRecords.splice(t,1)[0];return this._hasVolatileTransformation=_(i.shaderTransformation)?this._geometryRecords.some(r=>_(r.shaderTransformation)):this._hasVolatileTransformation,i.dispose(),this._geometries.splice(t,1),this._emit("objectGeometryRemoved",{object:this,record:i}),this._invalidateBoundingVolume(),i}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(t){this._emit("vertexAttrsUpdated",{object:this,record:t}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(t){if(this._visible!==t){this._visible=t;for(const i of this._geometryRecords)i.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const t=new Xz(Tv.MaskOccludee);for(const i of this._geometryRecords)i.instanceParameters.occludees=kY(i.instanceParameters.occludees,t);return this._emit("occlusionChanged",this),t}removeOcclude(t){for(const i of this._geometryRecords)i.instanceParameters.occludees=UY(i.instanceParameters.occludees,t);this._emit("occlusionChanged",this)}highlight(){const t=new Xz(Tv.Highlight);for(const i of this._geometryRecords)i.instanceParameters.highlights=kY(i.instanceParameters.highlights,t);return this._emit("highlightChanged",this),t}removeHighlight(t){for(const i of this._geometryRecords)i.instanceParameters.highlights=UY(i.instanceParameters.highlights,t);this._emit("highlightChanged",this)}getCombinedStaticTransformation(t,i){return As(Ye(i,Ne()),this.transformation,t.getStaticTransformation())}_getCombinedShaderTransformation(t,i){return i=i||Ne(),As(i,this.transformation,t.getShaderTransformation()),i}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s],o=this._geometryRecords[s],a=n.boundingInfo;_(a)&&(this._calculateTransformedBoundingVolume(a,this._bvObjectSpace,o.getShaderTransformation()),this._calculateTransformedBoundingVolume(a,this._bvWorldSpace,this._getCombinedShaderTransformation(o)))}Pn(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),Pn(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const t=$(),i=$(),r=mS(this.transformation);for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s].boundingInfo;if(M(n))continue;const o=this._geometryRecords[s].getShaderTransformation(),a=mS(o);Xe(t,n.getCenter(),o);const l=Pr(t,this._bvObjectSpace.bounds),c=n.getBSRadius()*a;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),Xe(i,t,this.transformation);const h=Pr(i,this._bvWorldSpace.bounds),p=c*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(t,i,r){const s=t.getBBMin(),n=t.getBBMax(),o=Rn(s),a=Rn(n);Xe(o,o,r),Xe(a,a,r);for(let l=0;l<3;++l)i.min[l]=Math.min(i.min[l],o[l],a[l]),i.max[l]=Math.max(i.max[l],o[l],a[l]);for(let l=0;l<3;++l){pe(o,s),pe(a,n),o[l]=n[l],a[l]=s[l],Xe(o,o,r),Xe(a,a,r);for(let c=0;c<3;++c)i.min[c]=Math.min(i.min[c],o[c],a[c]),i.max[c]=Math.max(i.max[c],o[c],a[c])}}_invalidateBoundingVolume(){this._bvDirty=!0,_(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(t,i){_(this._parentLayer)&&this._parentLayer.events.emit(t,i)}get test(){const t=this;return{hasGeometry:i=>t._geometries.includes(i),getGeometryIndex:i=>t._geometries.indexOf(i)}}}class KOe{constructor(){this.min=Ze(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ze(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class Vde extends KOe{constructor(){super(...arguments),this.bounds=fo()}init(){he(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),he(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Cwe(this.bounds)}}const nb=$();function fre(e,t,i,r,s,n,o,a){const l=i?i.length:0,c=e.clippingExtent;if(Go(t,nb,e.elevationProvider.spatialReference),_(c)&&!fK(c,nb))return null;Go(t,nb,e.renderCoordsHelper.spatialReference);const h=e.localOriginFactory.getOrigin(nb),p=new Hv({castShadow:!1,metadata:{layerUid:n,graphicUid:o,usesVerticalDistanceToGround:!0}});for(let f=0;f<l;f++){const m=Xn;p.addGeometry(i[f],r[f],m,h,a)}return{object:p,sampledElevation:sft(p,t,e.elevationProvider,e.renderCoordsHelper,s)}}function $$(e,t,i){const r=e.elevationContext,s=i.spatialReference;Go(t,nb,s),r.centerPointInElevationSR=jv(nb[0],nb[1],t.hasZ?nb[2]:0,s)}function L$(e){switch(e.type){case"point":return e;case"polygon":case"extent":return nre(e);case"polyline":{const t=e.paths[0];if(!t||t.length===0)return null;const i=s_e(t,r_e(t)/2);return jv(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.origin}return null}function G5t(e,t,i,r,s){const n=new Float64Array(3*e.length),o=new Float64Array(n.length);e.forEach((c,h)=>{n[3*h+0]=c[0],n[3*h+1]=c[1],n[3*h+2]=c.length>2?c[2]:0});const a=are(n,t,0,o,0,n,0,n.length/3,i,r,s),l=a!=null;return{numVertices:e.length,position:n,mapPosition:o,projectionSuccess:l,sampledElevation:a}}function Dft(e){const t=new mr;t.include(Tie),t.include(XMe,e),t.include(Qs,e),t.attributes.add(P.UV0,"vec2");const{vertex:i,fragment:r}=t;return i.uniforms.add([new Ei("viewport",(s,n)=>n.camera.fullViewport),new lt("lineSize",(s,n)=>Math.ceil(s.size)*n.camera.pixelRatio),new Di("pixelToNDC",(s,n)=>Li(Gde,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new lt("borderSize",(s,n)=>_(s.borderColor)?n.camera.pixelRatio:0),new Di("screenOffset",(s,n)=>Li(Gde,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))]),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.hasMultipassGeometry&&t.varyings.add("depth","float"),e.hasScreenSizePerspective&&A6(i),i.code.add(E`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?E`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.hasScreenSizePerspective?E`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:E`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?E`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:E`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?E`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:E`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add([new Ei("uColor",s=>Bde(s.color)),new Ei("borderColor",s=>Bde(s.borderColor))]),e.hasMultipassGeometry&&(r.include(gAe,e),r.uniforms.add(new Di("inverseViewport",(s,n)=>n.inverseViewport))),r.code.add(E`
    void main() {
      ${e.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?E`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:E`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function Bde(e){return _(e)?e:Dg}const Gde=Ke(),Nft=Object.freeze(Object.defineProperty({__proto__:null,build:Dft},Symbol.toStringTag,{value:"Module"}));class F6 extends Lr{initializeConfiguration(t,i){i.spherical=t.viewingMode===tt.Global}initializeProgram(t){const i=F6.shader.get().build(this.configuration);return new Er(t.rctx,i,lr)}setPipelineState(t){const i=t?Fr.ALWAYS:Fr.LESS;return this.configuration.depthHudEnabled?ri({depthTest:{func:i},depthWrite:jc}):ri({blending:ba(ke.ONE,ke.SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:xi})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}F6.shader=new Sr(Nft,()=>import("./LineCallout.glsl.1f6c836f.js"));class Fd extends al{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=Rc.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}}u([Q({count:Rc.COUNT})],Fd.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([Q()],Fd.prototype,"spherical",void 0),u([Q()],Fd.prototype,"occlusionTestEnabled",void 0),u([Q()],Fd.prototype,"hasVerticalOffset",void 0),u([Q()],Fd.prototype,"hasScreenSizePerspective",void 0),u([Q()],Fd.prototype,"depthHudEnabled",void 0),u([Q()],Fd.prototype,"depthHudAlignStartEnabled",void 0),u([Q()],Fd.prototype,"hasSlicePlane",void 0),u([Q()],Fd.prototype,"hasMultipassGeometry",void 0),u([Q({constValue:!0})],Fd.prototype,"hasSliceInVertexProgram",void 0),u([Q({constValue:!1})],Fd.prototype,"isDraped",void 0);class LT extends vy{constructor(t){super(t,new kft),this.techniqueConfig=new Fd,this._uniqueMaterialIdentifier=LT.uniqueMaterialIdentifier(this.parameters)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}getPassParameters(){return this.parameters}getConfiguration(t,i){const r=(i==null?void 0:i.slot)!==$e.LINE_CALLOUTS;return this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.hasVerticalOffset=_(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=_(this.parameters.screenSizePerspective),this.techniqueConfig.depthHudEnabled=r,this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Rc.Screen:Rc.World,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasMultipassGeometry=!!i&&i.multipassGeometry.enabled,this.techniqueConfig}intersect(){}requiresSlot(t){switch(t){case $e.LINE_CALLOUTS:case $e.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(t){return t.output===oe.Color?new Fft(t):null}createBufferWriter(){return new zft}validateParameters(t){const i=LT.uniqueMaterialIdentifier(t);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier(t){return JSON.stringify({screenOffset:t.screenOffset||[0,0],centerOffsetUnits:t.centerOffsetUnits||"world"})}}class Fft extends Qb{beginSlot(t){return this.ensureTechnique(F6,t)}}class kft extends AO{constructor(){super(...arguments),this.screenOffset=Sp,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const Uft=Bs().vec3f(P.POSITION).vec3f(P.NORMAL).vec2f(P.UV0).vec4f(P.AUXPOS1),jde=[zl(0,0),zl(1,0),zl(0,1),zl(1,0),zl(1,1),zl(0,1)];class zft{constructor(){this.vertexBufferLayout=Uft}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(P.POSITION).length}write(t,i,r,s){O6(i.indices.get(P.POSITION),i.vertexAttributes.get(P.POSITION).data,t.transformation,r.position,s,6),Qie(i.indices.get(P.NORMAL),i.vertexAttributes.get(P.NORMAL).data,t.invTranspTransformation,r.normal,s,6),RM(i.indices.get(P.AUXPOS1),i.vertexAttributes.get(P.AUXPOS1).data,r.auxpos1,s,6);for(let n=0;n<jde.length;++n)r.uv0.setVec(s+n,jde[n])}}class k6 extends by{constructor(t,i){super(t,null,i,Gft),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new LT(this.materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(t){const i=this.materialParameters;return i.screenOffset=t.screenOffset||Sp,i.centerOffsetUnits=t.centerOffsetUnits||"world",i}get materialParameters(){const t=this.symbol,i=t.callout,r=_(i.color)?Le.toUnitRGBA(i.color):[0,0,0,0];r[3]*=this._getLayerOpacity();const s=$i(i.size||0);let n=null;if(t.verticalOffset){const{screenLength:p,minWorldLength:f,maxWorldLength:m}=t.verticalOffset;n={screenLength:$i(p),minWorldLength:f||0,maxWorldLength:m!=null?m:1/0}}const o=_(i.border)&&_(i.border.color)?Le.toUnitRGBA(i.border.color):null,a=t.symbolLayers.getItemAt(0).type==="object",l=!a,c=a?0:void 0,h=t.type==="label-3d";return{color:r,size:s,verticalOffset:n,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:o,occlusionTest:l,shaderPolygonOffset:c,depthHUDAlignStart:h,hasSlicePlane:this._context.slicePlaneEnabled,renderOccluded:rs.Occlude,__tagStrict:"NoParameters"}}_defaultElevationInfoNoZ(){return Bft}createGraphics3DGraphic(t){const i=t.renderingInfo,r=t.graphic,s=this.setGraphicElevationContext(r,new ud,i.elevationOffset||0),n=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!H1e(l)))return null;const a=nre(r.geometry);return M(a)?null:this._createAs3DShape(a,s,i,r.uid)}layerOpacityChanged(){return M(this._material)||this._material.setParameters(this.materialParameters),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=HL(k6.elevationModeChangeTypes,r,s);return n!==Is.UPDATE||t.forEach(o=>{const a=i(o);_(a)&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return M(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(t,i,r=0){const s=super.setGraphicElevationContext(t,i);return s.addOffsetRenderUnits(r),s}updateGraphicElevationContext(t,i){this.setGraphicElevationContext(t,i.elevationContext,i.metadata.elevationOffset),i.needsElevationUpdates=Op(i.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:dre.memory}}_createVertexData(t){const{translation:i,centerOffset:r}=t,s=i?{size:3,data:[i[0],i[1],i[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0},n=r?{size:4,data:[r[0],r[1],r[2],r[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0};return[[P.POSITION,s],[P.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[P.AUXPOS1,n]]}_getOrCreateMaterial(t){const i=this._perInstanceMaterialParameters(t),r=LT.uniqueMaterialIdentifier(i);if(_(this._material)&&r===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(t.materialCollection){let s=t.materialCollection.get(r);return M(s)&&(s=new LT(i),t.materialCollection.add(r,s)),{material:s,isUnique:!1}}return{material:new LT(i),isUnique:!0}}_createAs3DShape(t,i,r,s){const n=[new vs(this._createVertexData(r),Vft,kc.Point)],o=this._getOrCreateMaterial(r),a=fre(this._context,t,n,[o.material],i,this._context.layer.uid,s);if(a===null)return null;const l=new _y(this,a.object,n,o.isUnique?[o.material]:null,null,I$,i);return l.metadata={elevationOffset:r.elevationOffset||0},l.alignedSampledElevation=a.sampledElevation,l.needsElevationUpdates=Op(i.mode),$$(l,t,this._context.elevationProvider),l}}k6.elevationModeChangeTypes={definedChanged:Is.UPDATE,staysOnTheGround:Is.UPDATE,onTheGroundChanged:Is.RECREATE};const qj=new Uint16Array([0]),Vft=[[P.POSITION,qj],[P.NORMAL,qj],[P.AUXPOS1,qj]],Bft={mode:"relative-to-ground",offset:0},Gft={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},Hde=ve.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function jft(e,t){if(!$K(e))return Hde.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const i=Hft[e.callout.type];return i?new i(e,t):(Hde.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const Hft={line:k6};class qft{constructor(t,i,r){this.graphic=t,this.renderingInfo=i,this.layer=r}}const qde=new un(Array,e=>QV(e,h1e),null,10,5),Wft=Qt();class Zft{constructor(t,i,r,s,n){this.graphic=t,this.graphics3DSymbol=i,this.graphics=r,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=Xft(da._COUNT,Bh._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++i.referenced,this._featureExpressionFeature=n?jOe(n,t,s):null;for(const o of r)_(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(t,i){this._layer=i,this._stage=t,this._forEachSymbolLayerGraphic(r=>{r.initialize(t,i),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(t=>t.destroy()),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.graphics==null}clearLabelGraphics(){this._forEachLabelGraphic(t=>t.destroy()),this._labelGraphics.length=0}addLabelGraphic(t,i,r){this._labelGraphics.push(t),t.initialize(i,r),t.setVisibility(this.isVisible(da.LABEL))}addAuxiliaryGraphic(t){this._auxiliaryGraphics.push(t),this._layer&&(t.initialize(this._stage,this._layer),t.setVisibility(this.isVisible()))}get isDraped(){let t=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(t=!0)}),t}isVisible(t=da.GRAPHIC,i){for(let r=0;r<=t;r++){const s=this._visibilityFlags[r];for(let n=0;n<s.length;++n)if(s[n]===!1&&n!==i)return!1}return!0}hasVisibilityFlag(t,i){return this._visibilityFlags[i][t]!=null}setVisibilityFlag(t,i,r){const s=this.isVisible(r);this._visibilityFlags[r][t]=i;const n=this.isVisible(r);if(s===n)return!1;if(r===da.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(da.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}clearVisibilityFlag(t,i=da.GRAPHIC){return this.setVisibilityFlag(t,void 0,i)}computeExtent(t){if(!this._extent){const i=this.graphic.geometry;if(M(i))return!1;this._extent=Qt(),qpt(i,this._extent);const r=i.spatialReference;if(!r.equals(t)&&!mB(this._extent,r,this._extent,t))return this._extent=null,!1}return!0}getAsOptimizedGeometry(t,i){return _(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===t&&this._optimizedGeometry.hasM===i||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,t,i),this._optimizedGeometry.hasZ=t,this._optimizedGeometry.hasM=i),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(t,i,r){let s=t.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=Uo.fromExtent(s.type==="mesh"?s.extent:s)),bZe(s,i,r)}get usedMemory(){let t=swe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>{const r=i.graphics3DSymbolLayer.complexity;if(M(r))return;const s=i.type==="draped"?r.memory.draped:r.memory;t+=s.bytesPerFeature,s.bytesPerCoordinate&&(t+=Hpt(this.graphic.geometry)*s.bytesPerCoordinate)}),t}computeAttachmentOrigin(){const t={render:{origin:$(),num:0},draped:{origin:Ke(),num:0}};for(const i of this.graphics)M(i)||i.computeAttachmentOrigin(t);return t.render.num&&fe(t.render.origin,t.render.origin,1/t.render.num),t.draped.num&&Oc(t.draped.origin,t.draped.origin,1/t.draped.num),t}async getProjectedBoundingBox(t,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?Nr(n.boundingBox):n.boundingBox=Nr(),n.requiresDrapedElevation=!1,await IB(this.graphics,async o=>{if(M(o))return;const a=o.type==="draped"?i:t,l=qde.acquire(),c=await o.getProjectedBoundingBox(a,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&XA(n.boundingBox,l),qde.release(l)}),Xze(n.boundingBox)||Qq(mK(n.boundingBox,Wft))?n:null}needsElevationUpdates(){for(const t of this.graphics)if(_(t)&&(t.type==="object3d"||t.type==="lod-instance")&&t.needsElevationUpdates)return!0;for(const t of this._labelGraphics)if(t&&t.needsElevationUpdates)return!0;return!1}alignWithElevation(t,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(t,i,this._featureExpressionFeature,r)})}addObjectStateSet(t,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(t,i))}removeObjectState(t){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(t))}_forEachGraphicList(t,i){t.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(t){this._forEachGraphicList(this.graphics,t),this._forEachGraphicList(this._auxiliaryGraphics,t)}_forEachLabelGraphic(t){this._forEachGraphicList(this._labelGraphics,t)}_forEachRenderedGraphic(t){this._forEachSymbolLayerGraphic(t),this._forEachLabelGraphic(t)}}function Xft(e,t){const i=new Array(e);for(let r=0;r<i.length;r++)i[r]=new Array(t);return i}var Wde,Zde,Xde,eRe={exports:{}};Wde=eRe,Zde=function(){function e(z,q,Z){Z=Z||2;var Y,te,se,J,ae,_e,Oe,Be=q&&q.length,Se=Be?q[0]*Z:z.length,Te=t(z,0,Se,Z,!0),Ie=[];if(!Te||Te.next===Te.prev)return Ie;if(Be&&(Te=l(z,q,Te,Z)),z.length>80*Z){Y=se=z[0],te=J=z[1];for(var Ve=Z;Ve<Se;Ve+=Z)(ae=z[Ve])<Y&&(Y=ae),(_e=z[Ve+1])<te&&(te=_e),ae>se&&(se=ae),_e>J&&(J=_e);Oe=(Oe=Math.max(se-Y,J-te))!==0?1/Oe:0}return r(Te,Ie,Z,Y,te,Oe),Ie}function t(z,q,Z,Y,te){var se,J;if(te===le(z,q,Z,Y)>0)for(se=q;se<Z;se+=Y)J=K(se,z[se],z[se+1],J);else for(se=Z-Y;se>=q;se-=Y)J=K(se,z[se],z[se+1],J);if(J&&A(J,J.next)){var ae=J.next;ee(J),J=ae}return J}function i(z,q){if(!z)return z;q||(q=z);var Z,Y=z;do if(Z=!1,Y.steiner||!A(Y,Y.next)&&C(Y.prev,Y,Y.next)!==0)Y=Y.next;else{var te=Y.prev;if(ee(Y),(Y=q=te)===Y.next)break;Z=!0}while(Z||Y!==q);return q}function r(z,q,Z,Y,te,se,J){if(z){!J&&se&&g(z,Y,te,se);for(var ae,_e,Oe=z;z.prev!==z.next;)if(ae=z.prev,_e=z.next,se?n(z,Y,te,se):s(z))q.push(ae.i/Z),q.push(z.i/Z),q.push(_e.i/Z),ee(z),z=_e.next,Oe=_e.next;else if((z=_e)===Oe){J?J===1?r(z=o(i(z),q,Z),q,Z,Y,te,se,2):J===2&&a(z,q,Z,Y,te,se):r(i(z),q,Z,Y,te,se,1);break}}}function s(z){var q=z.prev,Z=z,Y=z.next;if(C(q,Z,Y)>=0)return!1;for(var te=z.next.next;te!==z.prev;){if(S(q.x,q.y,Z.x,Z.y,Y.x,Y.y,te.x,te.y)&&C(te.prev,te,te.next)>=0)return!1;te=te.next}return!0}function n(z,q,Z,Y){var te=z.prev,se=z,J=z.next;if(C(te,se,J)>=0)return!1;for(var ae=te.x<se.x?te.x<J.x?te.x:J.x:se.x<J.x?se.x:J.x,_e=te.y<se.y?te.y<J.y?te.y:J.y:se.y<J.y?se.y:J.y,Oe=te.x>se.x?te.x>J.x?te.x:J.x:se.x>J.x?se.x:J.x,Be=te.y>se.y?te.y>J.y?te.y:J.y:se.y>J.y?se.y:J.y,Se=x(ae,_e,q,Z,Y),Te=x(Oe,Be,q,Z,Y),Ie=z.prevZ,Ve=z.nextZ;Ie&&Ie.z>=Se&&Ve&&Ve.z<=Te;){if(Ie!==z.prev&&Ie!==z.next&&S(te.x,te.y,se.x,se.y,J.x,J.y,Ie.x,Ie.y)&&C(Ie.prev,Ie,Ie.next)>=0||(Ie=Ie.prevZ,Ve!==z.prev&&Ve!==z.next&&S(te.x,te.y,se.x,se.y,J.x,J.y,Ve.x,Ve.y)&&C(Ve.prev,Ve,Ve.next)>=0))return!1;Ve=Ve.nextZ}for(;Ie&&Ie.z>=Se;){if(Ie!==z.prev&&Ie!==z.next&&S(te.x,te.y,se.x,se.y,J.x,J.y,Ie.x,Ie.y)&&C(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.prevZ}for(;Ve&&Ve.z<=Te;){if(Ve!==z.prev&&Ve!==z.next&&S(te.x,te.y,se.x,se.y,J.x,J.y,Ve.x,Ve.y)&&C(Ve.prev,Ve,Ve.next)>=0)return!1;Ve=Ve.nextZ}return!0}function o(z,q,Z){var Y=z;do{var te=Y.prev,se=Y.next.next;!A(te,se)&&O(te,Y,Y.next,se)&&B(te,se)&&B(se,te)&&(q.push(te.i/Z),q.push(Y.i/Z),q.push(se.i/Z),ee(Y),ee(Y.next),Y=z=se),Y=Y.next}while(Y!==z);return i(Y)}function a(z,q,Z,Y,te,se){var J=z;do{for(var ae=J.next.next;ae!==J.prev;){if(J.i!==ae.i&&T(J,ae)){var _e=H(J,ae);return J=i(J,J.next),_e=i(_e,_e.next),r(J,q,Z,Y,te,se),void r(_e,q,Z,Y,te,se)}ae=ae.next}J=J.next}while(J!==z)}function l(z,q,Z,Y){var te,se,J,ae=[];for(te=0,se=q.length;te<se;te++)(J=t(z,q[te]*Y,te<se-1?q[te+1]*Y:z.length,Y,!1))===J.next&&(J.steiner=!0),ae.push(b(J));for(ae.sort(c),te=0;te<ae.length;te++)Z=i(Z=p(ae[te],Z),Z.next);return Z}function c(z,q){return z.x-q.x}function h(z){if(z.next.prev===z)return z;let q=z;for(;;){const Z=q.next;if(Z.prev===q||Z===q||Z===z)break;q=Z}return q}function p(z,q){var Z=f(z,q);if(!Z)return q;var Y=H(Z,z),te=i(Z,Z.next);let se=h(Y);return i(se,se.next),te=h(te),h(q===Z?te:q)}function f(z,q){var Z,Y=q,te=z.x,se=z.y,J=-1/0;do{if(se<=Y.y&&se>=Y.next.y&&Y.next.y!==Y.y){var ae=Y.x+(se-Y.y)*(Y.next.x-Y.x)/(Y.next.y-Y.y);if(ae<=te&&ae>J){if(J=ae,ae===te){if(se===Y.y)return Y;if(se===Y.next.y)return Y.next}Z=Y.x<Y.next.x?Y:Y.next}}Y=Y.next}while(Y!==q);if(!Z)return null;if(te===J)return Z;var _e,Oe=Z,Be=Z.x,Se=Z.y,Te=1/0;Y=Z;do te>=Y.x&&Y.x>=Be&&te!==Y.x&&S(se<Se?te:J,se,Be,Se,se<Se?J:te,se,Y.x,Y.y)&&(_e=Math.abs(se-Y.y)/(te-Y.x),B(Y,z)&&(_e<Te||_e===Te&&(Y.x>Z.x||Y.x===Z.x&&m(Z,Y)))&&(Z=Y,Te=_e)),Y=Y.next;while(Y!==Oe);return Z}function m(z,q){return C(z.prev,z,q.prev)<0&&C(q.next,z,z.next)<0}function g(z,q,Z,Y){var te=z;do te.z===null&&(te.z=x(te.x,te.y,q,Z,Y)),te.prevZ=te.prev,te.nextZ=te.next,te=te.next;while(te!==z);te.prevZ.nextZ=null,te.prevZ=null,y(te)}function y(z){var q,Z,Y,te,se,J,ae,_e,Oe=1;do{for(Z=z,z=null,se=null,J=0;Z;){for(J++,Y=Z,ae=0,q=0;q<Oe&&(ae++,Y=Y.nextZ);q++);for(_e=Oe;ae>0||_e>0&&Y;)ae!==0&&(_e===0||!Y||Z.z<=Y.z)?(te=Z,Z=Z.nextZ,ae--):(te=Y,Y=Y.nextZ,_e--),se?se.nextZ=te:z=te,te.prevZ=se,se=te;Z=Y}se.nextZ=null,Oe*=2}while(J>1);return z}function x(z,q,Z,Y,te){return(z=1431655765&((z=858993459&((z=252645135&((z=16711935&((z=32767*(z-Z)*te)|z<<8))|z<<4))|z<<2))|z<<1))|(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q=32767*(q-Y)*te)|q<<8))|q<<4))|q<<2))|q<<1))<<1}function b(z){var q=z,Z=z;do(q.x<Z.x||q.x===Z.x&&q.y<Z.y)&&(Z=q),q=q.next;while(q!==z);return Z}function S(z,q,Z,Y,te,se,J,ae){return(te-J)*(q-ae)-(z-J)*(se-ae)>=0&&(z-J)*(Y-ae)-(Z-J)*(q-ae)>=0&&(Z-J)*(se-ae)-(te-J)*(Y-ae)>=0}function T(z,q){return z.next.i!==q.i&&z.prev.i!==q.i&&!k(z,q)&&(B(z,q)&&B(q,z)&&j(z,q)&&(C(z.prev,z,q.prev)||C(z,q.prev,q))||A(z,q)&&C(z.prev,z,z.next)>0&&C(q.prev,q,q.next)>0)}function C(z,q,Z){return(q.y-z.y)*(Z.x-q.x)-(q.x-z.x)*(Z.y-q.y)}function A(z,q){return z.x===q.x&&z.y===q.y}function O(z,q,Z,Y){var te=U(C(z,q,Z)),se=U(C(z,q,Y)),J=U(C(Z,Y,z)),ae=U(C(Z,Y,q));return te!==se&&J!==ae||!(te!==0||!D(z,Z,q))||!(se!==0||!D(z,Y,q))||!(J!==0||!D(Z,z,Y))||!(ae!==0||!D(Z,q,Y))}function D(z,q,Z){return q.x<=Math.max(z.x,Z.x)&&q.x>=Math.min(z.x,Z.x)&&q.y<=Math.max(z.y,Z.y)&&q.y>=Math.min(z.y,Z.y)}function U(z){return z>0?1:z<0?-1:0}function k(z,q){var Z=z;do{if(Z.i!==z.i&&Z.next.i!==z.i&&Z.i!==q.i&&Z.next.i!==q.i&&O(Z,Z.next,z,q))return!0;Z=Z.next}while(Z!==z);return!1}function B(z,q){return C(z.prev,z,z.next)<0?C(z,q,z.next)>=0&&C(z,z.prev,q)>=0:C(z,q,z.prev)<0||C(z,z.next,q)<0}function j(z,q){var Z=z,Y=!1,te=(z.x+q.x)/2,se=(z.y+q.y)/2;do Z.y>se!=Z.next.y>se&&Z.next.y!==Z.y&&te<(Z.next.x-Z.x)*(se-Z.y)/(Z.next.y-Z.y)+Z.x&&(Y=!Y),Z=Z.next;while(Z!==z);return Y}function H(z,q){var Z=new ce(z.i,z.x,z.y),Y=new ce(q.i,q.x,q.y),te=z.next,se=q.prev;return z.next=q,q.prev=z,Z.next=te,te.prev=Z,Y.next=Z,Z.prev=Y,se.next=Y,Y.prev=se,Y}function K(z,q,Z,Y){var te=new ce(z,q,Z);return Y?(te.next=Y.next,te.prev=Y,Y.next.prev=te,Y.next=te):(te.prev=te,te.next=te),te}function ee(z){z.next.prev=z.prev,z.prev.next=z.next,z.prevZ&&(z.prevZ.nextZ=z.nextZ),z.nextZ&&(z.nextZ.prevZ=z.prevZ)}function ce(z,q,Z){this.i=z,this.x=q,this.y=Z,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function le(z,q,Z,Y){for(var te=0,se=q,J=Z-Y;se<Z;se+=Y)te+=(z[J]-z[se])*(z[se+1]+z[J+1]),J=se;return te}return e.deviation=function(z,q,Z,Y){var te=q&&q.length,se=te?q[0]*Z:z.length,J=Math.abs(le(z,0,se,Z));if(te)for(var ae=0,_e=q.length;ae<_e;ae++){var Oe=q[ae]*Z,Be=ae<_e-1?q[ae+1]*Z:z.length;J-=Math.abs(le(z,Oe,Be,Z))}var Se=0;for(ae=0;ae<Y.length;ae+=3){var Te=Y[ae]*Z,Ie=Y[ae+1]*Z,Ve=Y[ae+2]*Z;Se+=Math.abs((z[Te]-z[Ve])*(z[Ie+1]-z[Te+1])-(z[Te]-z[Ie])*(z[Ve+1]-z[Te+1]))}return J===0&&Se===0?0:Math.abs((Se-J)/J)},e.flatten=function(z){for(var q=z[0][0].length,Z={vertices:[],holes:[],dimensions:q},Y=0,te=0;te<z.length;te++){for(var se=0;se<z[te].length;se++)for(var J=0;J<q;J++)Z.vertices.push(z[te][se][J]);te>0&&(Y+=z[te-1].length,Z.holes.push(Y))}return Z},e},(Xde=Zde())!==void 0&&(Wde.exports=Xde);const $M=eRe.exports,U6=ve.getLogger("esri.views.3d.support.buffer.math");function WL(e,t,i){if(e.count!==t.count)return void U6.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[4],l=i[5],c=i[6],h=i[8],p=i[9],f=i[10],m=i[12],g=i[13],y=i[14],x=e.typedBuffer,b=e.typedBufferStride,S=t.typedBuffer,T=t.typedBufferStride;for(let C=0;C<r;C++){const A=C*b,O=C*T,D=S[O],U=S[O+1],k=S[O+2];x[A]=s*D+a*U+h*k+m,x[A+1]=n*D+l*U+p*k+g,x[A+2]=o*D+c*U+f*k+y}}function jb(e,t,i){if(e.count!==t.count)return void U6.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=e.typedBuffer,g=e.typedBufferStride,y=t.typedBuffer,x=t.typedBufferStride;for(let b=0;b<r;b++){const S=b*g,T=b*x,C=y[T],A=y[T+1],O=y[T+2];m[S]=s*C+a*A+h*O,m[S+1]=n*C+l*A+p*O,m[S+2]=o*C+c*A+f*O}}function eJ(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2]}}function mre(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const g=1/Math.sqrt(m);r[l]=g*h,r[l+1]=g*p,r[l+2]=g*f}}}function Yft(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:WL,transformMat3:jb,scale:eJ,normalize:mre,shiftRight:Yft},Symbol.toStringTag,{value:"Module"}));function z6(e,t){if(!e||e.symbol)return null;const i=t&&t.renderer;return e&&_(i)&&i.getObservationRenderer?i.getObservationRenderer(e):i}function Jft(e,t){if(_(e.symbol))return e.symbol;const i=z6(e,t);return _(i)&&i.type!=="dot-density"?i.getSymbol(e,t):null}function j5t(e,t){const i=z6(e,t),r=Jft(e,t);if(M(r))return null;const s={renderer:i,symbol:r};if(M(i)||!("visualVariables"in i)||!i.visualVariables)return s;const n=lte(i,e,t),o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function Qft(e,t){if(_(e.symbol))return e.symbol;const i=z6(e,t);return _(i)&&i.getSymbolAsync(e,t)}async function H5t(e,t){const i=z6(e,t),r=await Qft(e,t);if(!r)return null;const s={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return s;const n=lte(i,e,t),o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=Le.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function Kft(e,t=0){const i=e[t];return typeof i=="number"&&isFinite(i)?i:null}function emt(e){for(let t=0;t<3;t++){const i=e[t];if(typeof i=="number")return isFinite(i)?i:0}return 0}function tRe(e,t,i){var A;const r=e.byteLength/(4*t),s=new Uint32Array(e,0,r*t);let n=new Uint32Array(r);const o=(A=i==null?void 0:i.minReduction)!=null?A:0,a=(i==null?void 0:i.originalIndices)||null,l=a?a.length:0,c=(i==null?void 0:i.componentOffsets)||null;let h=0;if(c)for(let O=0;O<c.length-1;O++){const D=c[O+1]-c[O];D>h&&(h=D)}else h=r;const p=Math.floor(1.1*h)+1;(Tm==null||Tm.length<2*p)&&(Tm=new Uint32Array(FA(2*p)));for(let O=0;O<2*p;O++)Tm[O]=0;let f=0;const m=!!c&&!!a,g=m?l:r,y=m?new Uint32Array(l):null,x=1.96;let b=o!==0?Math.ceil(4*x*x/(o*o)*o*(1-o)):g,S=1,T=c?c[1]:g;for(let O=0;O<g;O++){if(O===b){const H=1-f/O;if(H+x*Math.sqrt(H*(1-H)/O)<o)return null;b*=2}if(O===T){for(let H=0;H<2*p;H++)Tm[H]=0;if(a)for(let H=c[S-1];H<c[S];H++)y[H]=n[a[H]];T=c[++S]}const D=m?a[O]:O,U=D*t,k=rmt(s,U,t);let B=k%p,j=f;for(;Tm[2*B+1]!==0;){if(Tm[2*B]===k){const H=Tm[2*B+1]-1;if(tmt(s,U,H*t,t)){j=n[H];break}}B++,B>=p&&(B-=p)}j===f&&(Tm[2*B]=k,Tm[2*B+1]=D+1,f++),n[D]=j}if(o!==0&&1-f/r<o)return null;if(m){for(let O=c[S-1];O<y.length;O++)y[O]=n[a[O]];n=y}const C=new Uint32Array(t*f);f=0;for(let O=0;O<g;O++)n[O]===f&&(imt(s,(m?a[O]:O)*t,C,f*t,t),f++);if(a&&!m){const O=new Uint32Array(l);for(let D=0;D<O.length;D++)O[D]=n[a[D]];n=O}return{buffer:C.buffer,indices:n,uniqueCount:f}}function tmt(e,t,i,r){for(let s=0;s<r;s++)if(e[t+s]!==e[i+s])return!1;return!0}function imt(e,t,i,r,s){for(let n=0;n<s;n++)i[r+n]=e[t+n]}function rmt(e,t,i){let r=0;for(let s=0;s<i;s++)r=e[t+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let Tm=null;function q5t(e){const t=ZL(e.rings,e.hasZ,sy.CCW_IS_HOLE),i=[];let r=0,s=0;for(const a of t.polygons){const l=a.count,c=a.index,h=new Float64Array(t.position.buffer,3*c*t.position.BYTES_PER_ELEMENT,3*l),p=a.holeIndices.map(m=>m-c),f=new Uint32Array($M(h,p,3));i.push({position:h,faces:f}),r+=h.length,s+=f.length}const n=smt(i,r,s),o=tRe(n.position.buffer,6,{originalIndices:n.faces});return n.position=new Float64Array(o.buffer),n.faces=o.indices,n}function smt(e,t,i){if(e.length===1)return e[0];const r=new Float64Array(t),s=new Uint32Array(i);let n=0,o=0,a=0;for(const l of e){for(let c=0;c<l.position.length;c++)r[n++]=l.position[c];for(let c=0;c<l.faces.length;c++)s[o++]=l.faces[c]+a;a=n/3}return{position:r,faces:s}}function ZL(e,t,i){const r=e.length,s=new Array(r),n=new Array(r),o=new Array(r);let a=0,l=0,c=0,h=0;for(let m=0;m<r;++m)h+=e[m].length;const p=new Float64Array(3*h);let f=0;for(let m=r-1;m>=0;m--){const g=e[m],y=i===sy.CCW_IS_HOLE&&nmt(g);if(y&&r!==1)s[a++]=g;else{let x=g.length;for(let S=0;S<a;++S)x+=s[S].length;const b={index:f,pathLengths:new Array(a+1),count:x,holeIndices:new Array(a)};b.pathLengths[0]=g.length,g.length>0&&(o[c++]={index:f,count:g.length}),f=y?nF(g,g.length-1,-1,p,f,g.length,t):nF(g,0,1,p,f,g.length,t);for(let S=0;S<a;++S){const T=s[S];b.holeIndices[S]=f,b.pathLengths[S+1]=T.length,T.length>0&&(o[c++]={index:f,count:T.length}),f=nF(T,0,1,p,f,T.length,t)}a=0,b.count>0&&(n[l++]=b)}}for(let m=0;m<a;++m){const g=s[m];g.length>0&&(o[c++]={index:f,count:g.length}),f=nF(g,0,1,p,f,g.length,t)}return l<r&&(n.length=l),c<r&&(o.length=c),{position:p,polygons:n,outlines:o}}function nF(e,t,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const l=e[t];r[s++]=l[0],r[s++]=l[1],r[s++]=o?l[2]:0,t+=i}return s/3}function nmt(e){return!GV(e,!1,!1)}var sy;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(sy||(sy={}));var s3,tJ;(function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"})(s3||(s3={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(tJ||(tJ={}));var _s,rp,ii,LM,on,No;(function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"})(_s||(_s={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(rp||(rp={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(ii||(ii={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(LM||(LM={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded"}(on||(on={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(No||(No={}));class omt{constructor(t,i){this.vec3=t,this.id=i}}function n3(e,t,i,r){return new omt(Ze(e,t,i),r)}var Fl;(function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded"})(Fl||(Fl={}));class Yde{constructor(t,i){this.index=t,this.renderTargets=i,this._extent=Qt(),this.resolution=0,this.renderLocalOrigin=n3(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new lmt,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(i.renderTargets.length).fill(!1)}get extent(){return this._extent}getValidTexture(t){return this.validTargets[t]?this.renderTargets.getTarget(t).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(t){const i=t===Fl.ColorAndWater?this.renderTargets.getTarget(on.Color):t===Fl.Highlight?this.renderTargets.getTarget(on.Highlight):this.renderTargets.getTarget(on.Occluded);return i?i.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(on.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(on.Color):null}getNormalTexture(t){const i=t===Fl.ColorAndWater?this.renderTargets.getTarget(on.Water):null;return i?i.getTexture():null}draw(t,i){const r=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==on.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=t.drawTarget(this,s,i):this.validTargets[s.type]=!1;return r^this.computeRenderTargetValidityBitfield()?yM.CHANGED:yM.UNCHANGED}computeRenderTargetValidityBitfield(){const t=this.validTargets;return+t[on.Color]|+t[on.ColorNoRasterImage]<<1|+t[on.Highlight]<<2|+t[on.Water]<<3|+t[on.Occluded]<<4}setupGeometryViewsCyclical(t){this.setupGeometryViewsDirect();const i=.001*t.range;if(this._extent[0]-i<=t.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];vU(this._extent,t.range,0,r)}if(this._extent[2]+i>=t.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];vU(this._extent,-t.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,pv(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let t=0;t<this.canvasGeometries.numViews;t++){const i=this.canvasGeometries.extents[t];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}applyViewport(t){t.setViewport(this.index===_s.INNER?0:this.resolution,0,this.resolution,this.resolution)}}function amt(e,t,i){return Math.min(FA(Math.max(e,t)+256),i)}class lmt{constructor(){this.extents=[Qt(),Qt(),Qt()],this.numViews=0}}class iRe{constructor(t,i){this.size=gie(),this._fbo=null,this._fbo=new ss(t,{colorTarget:zs.TEXTURE,depthStencilTarget:Yi.NONE},{target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:gt.LINEAR_MIPMAP_LINEAR,hasMipmap:i,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=ht(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(t,i){this.size[0]=t,this.size[1]=i,this._fbo.resize(this.size[0],this.size[1])}bind(t){t.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var t;(t=this._fbo)==null||t.resize(0,0)}get gpuMemoryUsage(){var t,i;return(i=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?i:0}}class cmt{constructor(t){const i=(r,s,n=!0)=>({type:s,fbo:new iRe(t,n),renderPass:r,valid:!1,lastUsed:1/0});this.renderTargets=[i(rt.MATERIAL,on.Color),i(rt.MATERIAL,on.ColorNoRasterImage),i(rt.MATERIAL_HIGHLIGHT,on.Highlight,!1),i(rt.MATERIAL_NORMAL,on.Water),i(rt.MATERIAL,on.Occluded)]}getTarget(t){return this.renderTargets[t].fbo}dispose(){for(const t of this.renderTargets)t.fbo.dispose()}disposeRenderTargetMemory(){for(const t of this.renderTargets)t.fbo.disposeRenderTargetMemory()}validateUsageForTarget(t,i,r){if(t)i.lastUsed=r;else if(r-i.lastUsed>umt)i.fbo.disposeRenderTargetMemory(),i.lastUsed=1/0;else if(i.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((t,i)=>t+i.fbo.gpuMemoryUsage,0)}}const umt=1e3;class gre{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(t,i){var r;return(r=this._outer.get(t))==null?void 0:r.get(i)}set(t,i,r){const s=this._outer.get(t);s?s.set(i,r):this._outer.set(t,new Map([[i,r]]))}delete(t,i){const r=this._outer.get(t);r&&(r.delete(i),r.size===0&&this._outer.delete(t))}forEach(t){this._outer.forEach((i,r)=>t(i,r))}}class rRe{constructor(t){this._context=t,this._perConstructorInstances=new gre,this._frameCounter=0,this._keepAliveFrameCount=Jde}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(t=>t.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(t,i){const r=i.key;let s=this._perConstructorInstances.get(t,r);if(M(s)){const n=new t(this._context,i,()=>this.release(n));s=new hmt(n),this._perConstructorInstances.set(t,r,s)}return++s.refCount,s.technique}releaseAndAcquire(t,i,r){if(_(r)){if(i.key===r.key)return r;this.release(r)}return this.acquire(t,i)}release(t){if(M(t)||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(t.constructor,t.key);M(i)||(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==Jde&&this._perConstructorInstances.forEach((t,i)=>{t.forEach((r,s)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,s))})})}async reloadAll(){const t=new Array;this._perConstructorInstances.forEach((i,r)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>{l.technique.reload(this._context)}))};t.push(s(i,r))}),await Promise.all(t)}}class hmt{constructor(t){this.technique=t,this.refCount=0,this.refZeroFrame=0}}const Jde=-1,V6=e=>{class t extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){var r;for(const s of(r=this._managedDisposables)!=null?r:[]){const n=this[s];this[s]=null,n&&typeof n.dispose=="function"&&n.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}}return t};class B6 extends V6(class{}){}function Pa(){return(e,t)=>{var i,r;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=(r=(i=e._managedDisposables)==null?void 0:i.slice())!=null?r:[]),e._managedDisposables.unshift(t)}}const dmt=ve.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class sRe{constructor(t,i,r,s){this._textureRepository=t,this._techniqueRepository=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new gre}dispose(){this._textureRepository.dispose()}acquire(t,i){this._ownMaterial(t);let r=this._id2glMaterialRef.get(i,t.id);if(M(r)){const s=t.createGLMaterial({material:t,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});r=new pmt(s),this._id2glMaterialRef.set(i,t.id,r)}return r.ref(),r.glMaterial}release(t,i){const r=this._id2glMaterialRef.get(i,t.id);_(r)&&(r.unref(),r.referenced||(ht(r.glMaterial),this._id2glMaterialRef.delete(i,t.id)))}_ownMaterial(t){_(t.repository)&&t.repository!==this&&dmt.error("Material is already owned by a different material repository"),t.repository=this}}class pmt{constructor(t){this.glMaterial=t,this.refCnt=0}ref(){++this.refCnt}unref(){--this.refCnt,Ct(this.refCnt>=0)}get referenced(){return this.refCnt>0}}const fmt={orderedRepackingEnabled:!1},mmt={rootOrigin:null},gmt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];class DM{constructor(t,i){this._objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new Fs,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),Fs.clearPool(),iJ[0]=null,Tw.prune(),Ix.prune()}add(t,i=t.length){this._objectCount+=i,this._grow(t,i);const r=Fs.acquire();for(let s=0;s<i;s++){const n=t[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}Fs.release(r)}remove(t,i=null){this._objectCount-=t.length;const r=Fs.acquire();for(const s of t){const n=_(i)?i:tM(this._objectToBoundingSphere(s),wmt);cI(n[3])?(r.init(this._root),this._remove(s,n,r)):this._degenerateObjects.delete(s)}Fs.release(r),this._shrink()}update(t,i){if(!cI(i[3])&&this._isDegenerate(t))return;const r=bmt(t);this.remove(r,i),this.add(r)}forEachAlongRay(t,i,r){const s=od(t,i);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(t,i,r,s){const n=od(t,i);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(t){this._forEachNode(this._root,i=>{const r=i.node;return r.terminals.forAll(t),r.residents!==null&&r.residents.forAll(t),!0}),this._degenerateObjects.forEach(t)}forEachDegenerateObject(t){this._degenerateObjects.forEach(t)}findClosest(t,i,r,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=Wj(t,i),h=p=>{if(--n,!s(p))return;const f=this._objectToBoundingSphere(p);if(!rb(r,f))return;const m=P1(t,i,f),g=m-f[3],y=m+f[3];g<o&&(o=g,a=y,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(n<=0||!rb(r,p.bounds)||(fe(gd,c,p.halfSize),we(gd,gd,p.bounds),P1(t,i,gd)>a))return!1;const f=p.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},t,i),l}forEachInDepthRange(t,i,r,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:y=>{r===DM.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,y.near),c=Math.min(c,y.far)):(l=Math.max(l,-y.far),c=Math.min(c,-y.near))}};h.setRange(s);const p=P1(i,r,t),f=Wj(i,r),m=Wj(i,-r),g=y=>{if(!a(y))return;const x=this._objectToBoundingSphere(y),b=x,S=P1(i,r,b)-p,T=S-x[3],C=S+x[3];T>c||C<l||!rb(o,x)||n(y,h)};this._forEachNodeDepthOrdered(this._root,y=>{if(!rb(o,y.bounds)||(fe(gd,f,y.halfSize),we(gd,gd,y.bounds),P1(i,r,gd)-p>c)||(fe(gd,m,y.halfSize),we(gd,gd,y.bounds),P1(i,r,gd)-p<l))return!1;const x=y.node;return x.terminals.forAll(b=>g(b)),x.residents!==null&&x.residents.forAll(b=>g(b)),!0},i,r)}forEachNode(t){this._forEachNode(this._root,i=>t(i.node,i.bounds,i.halfSize))}forEachNeighbor(t,i){const r=Y0(i),s=i,n=o=>{const a=this._objectToBoundingSphere(o),l=Y0(a),c=r+l;uo(a,s)-c*c<=0&&t(o)};this._forEachNode(this._root,o=>{const a=Y0(o.bounds),l=r+a;if(uo(o.bounds,s)-l*l>0)return!1;const c=o.node;return c.terminals.forAll(h=>n(h)),c.residents!==null&&c.residents.forAll(h=>n(h)),!0}),this.forEachDegenerateObject(n)}_intersectsNode(t,i){return oF(i.bounds,2*-i.halfSize,Mh),oF(i.bounds,2*i.halfSize,Oh),fhe(t.origin,t.direction,Mh,Oh)}_intersectsNodeWithOffset(t,i,r){return oF(i.bounds,2*-i.halfSize,Mh),oF(i.bounds,2*i.halfSize,Oh),r.applyToMinMax(Mh,Oh),fhe(t.origin,t.direction,Mh,Oh)}_intersectsObject(t,i){const r=this._objectToBoundingSphere(i);return!(r[3]>0)||YW(r,t)}_intersectsObjectWithOffset(t,i,r){const s=this._objectToBoundingSphere(i);return!(s[3]>0)||YW(r.applyToBoundingSphere(s),t)}_forEachNode(t,i){let r=Fs.acquire().init(t);const s=[r];for(;s.length!==0;){if(r=s.pop(),i(r)&&!r.isLeaf())for(let n=0;n<r.node.children.length;n++)r.node.children[n]&&s.push(Fs.acquire().init(r).advance(n));Fs.release(r)}}_forEachNodeDepthOrdered(t,i,r,s=DM.DepthOrder.FRONT_TO_BACK){let n=Fs.acquire().init(t);const o=[n];for(_mt(r,s,epe);o.length!==0;){if(n=o.pop(),i(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=epe[a];n.node.children[l]&&o.push(Fs.acquire().init(n).advance(l))}Fs.release(n)}}_remove(t,i,r){Tw.clear();const s=r.advanceTo(i,(n,o)=>{Tw.push(n.node),Tw.push(o)})?r.node.terminals:r.node.residents;if(s.removeUnordered(t),s.length===0)for(let n=Tw.length-2;n>=0;n-=2){const o=Tw.data[n],a=Tw.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let i=0;i<t.children.length;i++)if(t.children[i])return!1;return!0}_purge(t,i){return i>=0&&(t.children[i]=null),!!this._nodeIsEmpty(t)&&(t.residents===null&&(t.residents=new ai({shrink:!0})),!0)}_add(t,i){i.advanceTo(this._objectToBoundingSphere(t))?i.node.terminals.push(t):(i.node.residents.push(t),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(t){const i=t.node.residents;t.node.residents=null;for(let r=0;r<i.length;r++){const s=Fs.acquire().init(t);this._add(i.getItemAt(r),s),Fs.release(s)}}_grow(t,i){if(i!==0&&(Qde(t,i,r=>this._objectToBoundingSphere(r),Sm),cI(Sm[3])&&!this._fitsInsideTree(Sm)))if(this._nodeIsEmpty(this._root.node))tM(Sm,this._root.bounds),this._root.halfSize=1.25*Sm[3];else{const r=this._rootBoundsForRootAsSubNode(Sm);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(Sm,r):this._growRootAsSubNode(r),Fs.release(r)}}_rebuildTree(t,i){pe(Xj,i.bounds),Xj[3]=i.halfSize,Qde([t,Xj],2,s=>s,Yj);const r=Fs.acquire().init(this._root);this._root.initFrom(null,Yj,1.25*Yj[3]),this._forEachNode(r,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),Fs.release(r)}_placingRootViolatesMaxDepth(t){const i=Math.log(t.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(t){const i=t[3],r=t;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let a=0;a<3;a++){const l=n[a]-o-(r[a]-i),c=r[a]+i-(n[a]+o),h=Math.max(0,Math.ceil(l/(2*o))),p=Math.max(0,Math.ceil(c/(2*o)))+1,f=2**Math.ceil(Math.log(h+p)*Math.LOG2E);s=Math.max(s,f),aF[a].min=h,aF[a].max=p}for(let a=0;a<3;a++){let l=aF[a].min,c=aF[a].max;const h=(s-(l+c))/2;l+=Math.ceil(h),c+=Math.floor(h);const p=n[a]-o-l*o*2;Zj[a]=p+(c+l)*o}return Zj[3]=s*o*oRe,Fs.acquire().initFrom(null,Zj,s*o,0)}_growRootAsSubNode(t){const i=this._root.node;pe(Sm,this._root.bounds),Sm[3]=this._root.halfSize,this._root.init(t),t.advanceTo(Sm,null,!0),t.node.children=i.children,t.node.residents=i.residents,t.node.terminals=i.terminals}_shrink(){for(;;){const t=this._findShrinkIndex();if(t===-1)break;this._root.advance(t),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let t=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&t==null;)r=s++,t=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(t){return!cI(this._objectToBoundingSphere(t)[3])}_fitsInsideTree(t){const i=this._root.bounds,r=this._root.halfSize;return t[3]<=r&&t[0]>=i[0]-r&&t[0]<=i[0]+r&&t[1]>=i[1]-r&&t[1]<=i[1]+r&&t[2]>=i[2]-r&&t[2]<=i[2]+r}}class Fs{constructor(){this.bounds=fo(),this.halfSize=0,this.initFrom(null,null,0,0)}init(t){return this.initFrom(t.node,t.bounds,t.halfSize,t.depth)}initFrom(t,i,r,s=this.depth){return this.node=_(t)?t:Fs.createEmptyNode(),_(i)&&tM(i,this.bounds),this.halfSize=r,this.depth=s,this}advance(t){let i=this.node.children[t];i||(i=Fs.createEmptyNode(),this.node.children[t]=i),this.node=i,this.halfSize/=2,this.depth++;const r=nRe[t];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.bounds[3]=this.halfSize*oRe,this}advanceTo(t,i,r=!1){for(;;){if(this.isTerminalFor(t))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const s=this._childIndex(t);i&&i(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(t){return t[3]>this.halfSize/2}_childIndex(t){const i=this.bounds;return(i[0]<t[0]?1:0)+(i[1]<t[1]?2:0)+(i[2]<t[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new ai({shrink:!0}),residents:new ai({shrink:!0})}}static acquire(){return Fs._pool.acquire()}static release(t){Fs._pool.release(t)}static clearPool(){Fs._pool.prune()}}function ymt(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function vmt(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function oF(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function Qde(e,t,i,r){if(t===1){const s=i(e[0]);tM(s,r)}else{Mh[0]=1/0,Mh[1]=1/0,Mh[2]=1/0,Oh[0]=-1/0,Oh[1]=-1/0,Oh[2]=-1/0;for(let s=0;s<t;s++){const n=i(e[s]);cI(n[3])&&(ymt(Mh,n),vmt(Oh,n))}Pn(r,Mh,Oh,.5),r[3]=Math.max(Oh[0]-Mh[0],Oh[1]-Mh[1],Oh[2]-Mh[2])/2}}function _mt(e,t,i){if(!Ix.length)for(let r=0;r<8;++r)Ix.push({index:0,distance:0});for(let r=0;r<8;++r){const s=nRe[r];Ix.data[r].index=r,Ix.data[r].distance=P1(e,t,s)}Ix.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=Ix.data[r].index}function Wj(e,t){let i=1/0,r=null;for(let s=0;s<8;++s){const n=P1(e,t,Kde[s]);n<i&&(i=n,r=Kde[s])}return r}function P1(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function cI(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}Fs._pool=new un(Fs),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(DM||(DM={}));const nRe=[Ze(-1,-1,-1),Ze(1,-1,-1),Ze(-1,1,-1),Ze(1,1,-1),Ze(-1,-1,1),Ze(1,-1,1),Ze(-1,1,1),Ze(1,1,1)],Kde=[Ze(-1,-1,-1),Ze(-1,-1,1),Ze(-1,1,-1),Ze(-1,1,1),Ze(1,-1,-1),Ze(1,-1,1),Ze(1,1,-1),Ze(1,1,1)],oRe=Math.sqrt(3),iJ=[null];function bmt(e){return iJ[0]=e,iJ}const Zj=fo(),gd=$(),Mh=$(),Oh=$(),Tw=new ai,wmt=fo(),Sm=fo(),Xj=fo(),Yj=fo(),aF=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],Ix=new ai,epe=[0,0,0,0,0,0,0,0],Vf=DM;class aRe extends NL{constructor(t,i=""){var r,s,n;super(),this.apiLayerUid=i,this.type=um.Layer,this.events=new cs,this.isSliceable=!1,this._objects=new ai,this._stageHandles=new Nt,this.apiLayerUid=i,this.isVisible=(r=t==null?void 0:t.isVisible)!=null?r:!0,this.isPickable=(s=t==null?void 0:t.isPickable)!=null?s:!0,this.updatePolicy=(n=t==null?void 0:t.updatePolicy)!=null?n:gM.ASYNC}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(t){this.detachStage(),this._stage=t;for(const i of gmt)this._stageHandles.add(this.events.on(i,r=>t.handleEvent(i,r)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(t){this._objects.push(t),t.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:t}),_(this._octree)&&this._octree.add([t])}remove(t){this._objects.removeUnordered(t)&&(t.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:t}),_(this._octree)&&this._octree.remove([t]))}addMany(t){this._objects.pushArray(t);for(const i of t)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:t}),_(this._octree)&&this._octree.add(t)}removeMany(t){const i=new Array;if(this._objects.removeUnorderedMany(t,t.length,i),i.length!==0){for(const r of i)r.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),_(this._octree)&&this._octree.remove(i)}}sync(){_(this._stage)&&this.updatePolicy!==gM.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(t,i){_(this._octree)&&this._octree.update(t,i)}getSpatialQueryAccelerator(){return M(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=We(this._octree)}_createOctree(){this._octree=new Vf(t=>t.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)}}function Yz(e){return _(e)&&e.type===um.Layer}class lRe{constructor(t,i){this._material=t,this._repository=i,this._map=new Map}destroy(){this._map.forEach((t,i)=>{_(t)&&this._repository.release(this._material,DS(i))})}load(t,i){this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,DS(i)));const r=this._map.get(i);if(_(r)){if(r.ensureResources(t)===Tu.LOADED)return r;this._repository.requestRender()}return null}}function DS(e){switch(e){case rt.MATERIAL:return oe.Color;case rt.MATERIAL_ALPHA:return oe.Alpha;case rt.MATERIAL_DEPTH:return oe.Depth;case rt.MATERIAL_NORMAL:return oe.Normal;case rt.MATERIAL_DEPTH_SHADOWMAP_ALL:return oe.Shadow;case rt.MATERIAL_HIGHLIGHT:return oe.Highlight;case rt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:case rt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return oe.Shadow}}const tpe=8;function cRe(e,t){const i=e.vertex;i.uniforms.add(new lt("intrinsicWidth",r=>r.width)),t.vvSize?(e.attributes.add(P.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new Dt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new Dt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new Dt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new Dt("vvSizeFactor",r=>r.vvSizeFactor)),i.code.add(E`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(P.SIZE,"float"),i.code.add(E`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(P.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add([new ol("vvOpacityValues",r=>r.vvOpacityValues,tpe),new ol("vvOpacityOpacities",r=>r.vvOpacityOpacities,tpe)]),i.code.add(E`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(E`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add(P.COLORFEATUREATTRIBUTE,"float"),i.constants.add("vvColorNumber","int",Qf),i.uniforms.add(new ol("vvColorValues",r=>r.vvColorValues,Qf)),i.uniforms.add(new P6("vvColorColors",r=>r.vvColorColors,Qf)),i.code.add(E`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add(P.COLOR,"vec4"),i.code.add(E`vec4 getColor(){
return applyOpacity(color);
}`))}function tw(e,t){e.fragment.include(Zu),t.output===oe.Shadow?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(E`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):t.output===oe.Depth&&e.fragment.code.add(E`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}function xmt(e){return M(e)?Dg:e.length===4?e:_r(Tmt,e[0],e[1],e[2],1)}const Tmt=si();function uRe(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?Smt(e,t):Emt(e)}function Smt(e,t){const i=!(t.draped&&t.stipplePreferContinuous),{vertex:r,fragment:s}=e;s.include(Zu),r.uniforms.add(new nr("stipplePatternPixelSize")),t.draped||(ry(r,t),r.uniforms.add(new lt("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),r.code.add(E`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),r.code.add(E`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${Cmt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(E`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(E`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),r.uniforms.add(new lt("pixelRatio",(n,o)=>o.camera.pixelRatio)),r.code.add(E`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?E`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.uniforms.add(new ws("stipplePatternTexture")),s.uniforms.add(new nr("stipplePatternSDFNormalizer")),s.uniforms.add(new nr("stipplePatternTextureSize")),s.uniforms.add(new nr("stipplePatternPixelSizeInv")),s.code.add(E`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),s.code.add(E`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?E`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:E`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?E`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?E`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:E`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?E`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:E`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?(s.uniforms.add(new Ei("stippleOffColor",n=>xmt(n.stippleOffColor))),s.code.add(E`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(E`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function Emt(e){e.fragment.code.add(E`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}const Cmt=E.float(.4);var yp;(function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"})(yp||(yp={}));class Os extends al{constructor(){super(...arguments),this.output=oe.Color,this.capType=yp.BUTT,this.transparencyPassType=Rt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1}}u([Q({count:oe.COUNT})],Os.prototype,"output",void 0),u([Q({count:yp.COUNT})],Os.prototype,"capType",void 0),u([Q({count:Rt.COUNT})],Os.prototype,"transparencyPassType",void 0),u([Q()],Os.prototype,"occluder",void 0),u([Q()],Os.prototype,"hasSlicePlane",void 0),u([Q()],Os.prototype,"hasPolygonOffset",void 0),u([Q()],Os.prototype,"writeDepth",void 0),u([Q()],Os.prototype,"draped",void 0),u([Q()],Os.prototype,"stippleEnabled",void 0),u([Q()],Os.prototype,"stippleOffColorEnabled",void 0),u([Q()],Os.prototype,"stippleScaleWithLineWidth",void 0),u([Q()],Os.prototype,"stipplePreferContinuous",void 0),u([Q()],Os.prototype,"roundJoins",void 0),u([Q()],Os.prototype,"vvSize",void 0),u([Q()],Os.prototype,"vvColor",void 0),u([Q()],Os.prototype,"vvOpacity",void 0),u([Q()],Os.prototype,"falloffEnabled",void 0),u([Q()],Os.prototype,"innerColorEnabled",void 0),u([Q()],Os.prototype,"hasOccludees",void 0),u([Q()],Os.prototype,"hasMultipassTerrain",void 0),u([Q()],Os.prototype,"cullAboveGround",void 0),u([Q()],Os.prototype,"wireframe",void 0),u([Q({constValue:!0})],Os.prototype,"stippleRequiresClamp",void 0),u([Q({constValue:!0})],Os.prototype,"stippleRequiresStretchMeasure",void 0),u([Q({constValue:!0})],Os.prototype,"hasVvInstancing",void 0),u([Q({constValue:!0})],Os.prototype,"hasSliceTranslatedView",void 0);const Jz=1;function Amt(e){const t=new mr,i=e.hasMultipassTerrain&&(e.output===oe.Color||e.output===oe.Alpha);t.include(u6),t.include(cRe,e),t.include(uRe,e),e.output===oe.Depth&&t.include(tw,e),Kh(t,e);const{vertex:r,fragment:s}=t;r.uniforms.add([new Xr("inverseProjectionMatrix",(f,m)=>m.camera.inverseProjectionMatrix),new Di("nearFar",(f,m)=>m.camera.nearFar),new lt("miterLimit",f=>f.join!=="miter"?0:f.miterLimit),new Ei("viewport",(f,m)=>m.camera.fullViewport)]),r.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(P.POSITION,"vec3"),t.attributes.add(P.SUBDIVISIONFACTOR,"float"),t.attributes.add(P.UV0,"vec2"),t.attributes.add(P.AUXPOS1,"vec3"),t.attributes.add(P.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),i&&t.varyings.add("depth","float");const n=e.capType===yp.ROUND,o=e.stippleEnabled&&e.stippleScaleWithLineWidth||n;o&&t.varyings.add("vLineWidth","float");const a=e.stippleEnabled&&e.stippleScaleWithLineWidth;a&&t.varyings.add("vLineSizeInv","float");const l=e.innerColorEnabled||n;l&&t.varyings.add("vLineDistance","float");const c=e.stippleEnabled&&n,h=e.falloffEnabled||c;h&&t.varyings.add("vLineDistanceNorm","float"),n&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),r.code.add(E`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(E`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),r.code.add(E`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${i?"depth = pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),r.uniforms.add(new lt("pixelRatio",(f,m)=>m.camera.pixelRatio)),r.code.add(E`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${o?E`vLineWidth = lineWidth;`:""}
      ${a?E`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),(e.stippleEnabled||n)&&r.code.add(E`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${n?E`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(E`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?r.code.add(E`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?E`min(1.0, subdivisionFactor * ${E.float((Jz+2)/(Jz+1))})`:E`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(E`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const p=e.capType!==yp.BUTT;return r.code.add(E`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${p?E`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(E`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${h||l?E`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${l?E`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${h?E`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),n&&r.code.add(E`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?r.uniforms.add(new lt("worldToScreenRatio",(f,m)=>1/m.screenToPCSRatio)):r.code.add(E`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(E`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?r.code.add(E`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(E`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.code.add(E`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(E`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `),i&&t.include(ld,e),t.include(Qs,e),s.include(gy),s.code.add(E`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?s.code.add(E`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(n&&s.code.add(E`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${E.float(Va)}) {
        discard;
      }
    `),c?s.code.add(E`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${E.float(Va)}, stippleCoverage);
      `):s.code.add(E`float stippleAlpha = getStippleAlpha();`),s.uniforms.add(new Ei("intrinsicColor",f=>f.color)),s.code.add(E`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(s.uniforms.add(new Ei("innerColor",f=>Ye(f.innerColor,f.color))),s.uniforms.add(new lt("innerWidth",(f,m)=>f.innerWidth*m.camera.pixelRatio)),s.code.add(E`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),s.code.add(E`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(s.uniforms.add(new lt("falloff",f=>f.falloff)),s.code.add(E`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),s.code.add(E`
    if (finalColor.a < ${E.float(Va)}) {
      discard;
    }

    ${e.output===oe.Alpha?E`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===oe.Color?E`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===oe.Color&&e.transparencyPassType===Rt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===oe.Highlight?E`gl_FragColor = vec4(1.0);`:""}
    ${e.output===oe.Depth?E`outputDepth(linearDepth);`:""}
  }
  `),t}const Mmt=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:Jz,build:Amt},Symbol.toStringTag,{value:"Module"})),yre={func:Fr.LESS},Qz={func:Fr.ALWAYS},ny={mask:255},hRe={mask:0},Omt=e=>({function:{func:Fr.NOTEQUAL,ref:e,mask:e},operation:{fail:Vs.KEEP,zFail:Vs.KEEP,zPass:Vs.KEEP}}),Rmt=e=>({function:{func:Fr.ALWAYS,ref:e,mask:e},operation:{fail:Vs.KEEP,zFail:Vs.KEEP,zPass:Vs.REPLACE}}),iw={function:{func:Fr.ALWAYS,ref:Fc.OutlineVisualElementMask,mask:Fc.OutlineVisualElementMask},operation:{fail:Vs.KEEP,zFail:Vs.KEEP,zPass:Vs.ZERO}},Hb={function:{func:Fr.ALWAYS,ref:Fc.OutlineVisualElementMask,mask:Fc.OutlineVisualElementMask},operation:{fail:Vs.KEEP,zFail:Vs.KEEP,zPass:Vs.REPLACE}},dRe={function:{func:Fr.EQUAL,ref:Fc.OutlineVisualElementMask,mask:Fc.OutlineVisualElementMask},operation:{fail:Vs.KEEP,zFail:Vs.KEEP,zPass:Vs.KEEP}},pRe={function:{func:Fr.NOTEQUAL,ref:Fc.OutlineVisualElementMask,mask:Fc.OutlineVisualElementMask},operation:{fail:Vs.KEEP,zFail:Vs.KEEP,zPass:Vs.KEEP}},fRe=new Map([[P.POSITION,0],[P.SUBDIVISIONFACTOR,1],[P.UV0,2],[P.AUXPOS1,3],[P.AUXPOS2,4],[P.COLOR,5],[P.COLORFEATUREATTRIBUTE,5],[P.SIZE,6],[P.SIZEFEATUREATTRIBUTE,6],[P.OPACITYFEATUREATTRIBUTE,7]]);class G6 extends Lr{constructor(t,i,r){super(t,i,r),this.stippleTextureRepository=t.stippleTextureRepository}initializeProgram(t){const i=G6.shader.get().build(this.configuration);return new Er(t.rctx,i,fRe)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,i){if(this.program.bindPass(t,i),this.stipplePattern!==t.stipplePattern){const r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.configuration.stippleEnabled){const{pixelSize:r,sdfNormalizer:s,pixels:n}=_(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",s),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",r),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r)}}_makePipelineState(t,i){const r=this.configuration,s=t===Rt.NONE,n=t===Rt.FrontFace;return ri({blending:r.output===oe.Color||r.output===oe.Alpha?s?ed:Gv(t):null,depthTest:{func:ew(t)},depthWrite:s?r.writeDepth&&jc:I6(t),colorWrite:xi,stencilWrite:r.hasOccludees?ny:null,stencilTest:r.hasOccludees?i?Hb:iw:null,polygonOffset:s||n?r.hasPolygonOffset&&ipe:L6})}initializePipeline(){const t=this.configuration;if(t.occluder){const i=t.hasPolygonOffset&&ipe;this._occluderPipelineTransparent=ri({blending:ed,polygonOffset:i,depthTest:Qz,depthWrite:null,colorWrite:xi,stencilWrite:null,stencilTest:pRe}),this._occluderPipelineOpaque=ri({blending:ed,polygonOffset:i,depthTest:Qz,depthWrite:null,colorWrite:xi,stencilWrite:hRe,stencilTest:dRe}),this._occluderPipelineMaskWrite=ri({blending:null,polygonOffset:i,depthTest:yre,depthWrite:null,colorWrite:null,stencilWrite:ny,stencilTest:Hb})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Wt.LINES:Wt.TRIANGLE_STRIP}getPipelineState(t,i){return i?this._occludeePipelineState:this.configuration.occluder?t===$e.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===$e.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,i)}}G6.shader=new Sr(Mmt,()=>import("./RibbonLine.glsl.97473a8e.js"));const ipe={factor:0,units:-4},Pmt=ve.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var pu;(function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(pu||(pu={}));class YC extends vy{constructor(t){super(t,new $mt),this._vertexAttributeLocations=fRe,this.techniqueConfig=new Os,this.layout=this.createLayout()}isClosed(t,i){return mRe(this.parameters,t,i)}getConfiguration(t,i){this.techniqueConfig.output=t,this.techniqueConfig.draped=i.slot===$e.DRAPED_MATERIAL;const r=_(this.parameters.stipplePattern)&&t!==oe.Highlight;return this.techniqueConfig.stippleEnabled=r,this.techniqueConfig.stippleOffColorEnabled=r&&_(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=r&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.roundJoins=this.parameters.join==="round",this.techniqueConfig.capType=this.parameters.cap,this.techniqueConfig.hasPolygonOffset=this.parameters.hasPolygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&_(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=this.parameters.renderOccluded===rs.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig.wireframe=this.parameters.wireframe,this.techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){_(c)?this._intersectDrapedLineGeometry(t,s,c,o,a):this._intersectLineGeometry(t,i,r,s,a)}_intersectDrapedLineGeometry(t,i,r,s,n){if(!i.options.selectionMode)return;const o=t.vertexAttributes.get(P.POSITION).data,a=t.vertexAttributes.get(P.SIZE);let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const g=t.vertexAttributes.get(P.SIZEFEATUREATTRIBUTE).data[0];l*=He(this.parameters.vvSizeOffset[0]+g*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a&&(l*=a.data[0]);const c=s[0],h=s[1],p=(l/2+4)*t.screenToWorldRatio;let f=Number.MAX_VALUE,m=0;for(let g=0;g<o.length-5;g+=3){const y=o[g],x=o[g+1],b=c-y,S=h-x,T=o[g+3]-y,C=o[g+4]-x,A=He((T*b+C*S)/(T*T+C*C),0,1),O=T*A-b,D=C*A-S,U=O*O+D*D;U<f&&(f=U,m=g/3)}f<p*p&&n(r.dist,r.normal,m,!1)}_intersectLineGeometry(t,i,r,s,n){if(!s.options.selectionMode||FL(i))return;if(!SAe(r))return void Pmt.error("intersection assumes a translation-only matrix");const o=t.vertexAttributes,a=o.get(P.POSITION).data;let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const b=o.get(P.SIZEFEATUREATTRIBUTE).data[0];l*=He(this.parameters.vvSizeOffset[0]+b*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o.has(P.SIZE)&&(l*=o.get(P.SIZE).data[0]);const c=s.camera,h=Dmt;po(h,s.point);const p=l*c.pixelRatio/2+4*c.pixelRatio;he(TR[0],h[0]-p,h[1]+p,0),he(TR[1],h[0]+p,h[1]+p,0),he(TR[2],h[0]+p,h[1]-p,0),he(TR[3],h[0]-p,h[1]-p,0);for(let b=0;b<4;b++)if(!c.unprojectFromRenderScreen(TR[b],Ly[b]))return;sl(c.eye,Ly[0],Ly[1],Qj),sl(c.eye,Ly[1],Ly[2],Kj),sl(c.eye,Ly[2],Ly[3],e7),sl(c.eye,Ly[3],Ly[0],t7);let f=Number.MAX_VALUE,m=0;const g=rJ(this.parameters,o,t.indices)?a.length-2:a.length-5;for(let b=0;b<g;b+=3){sc[0]=a[b]+r[12],sc[1]=a[b+1]+r[13],sc[2]=a[b+2]+r[14];const S=(b+3)%a.length;if(nc[0]=a[S]+r[12],nc[1]=a[S+1]+r[13],nc[2]=a[S+2]+r[14],Or(Qj,sc)<0&&Or(Qj,nc)<0||Or(Kj,sc)<0&&Or(Kj,nc)<0||Or(e7,sc)<0&&Or(e7,nc)<0||Or(t7,sc)<0&&Or(t7,nc)<0)continue;if(c.projectToRenderScreen(sc,Ew),c.projectToRenderScreen(nc,Cw),Ew[2]<0&&Cw[2]>0){xe(Em,sc,nc);const C=c.frustum,A=-Or(C[Mr.NEAR],sc)/Pe(Em,C[Mr.NEAR]);fe(Em,Em,A),we(sc,sc,Em),c.projectToRenderScreen(sc,Ew)}else if(Ew[2]>0&&Cw[2]<0){xe(Em,nc,sc);const C=c.frustum,A=-Or(C[Mr.NEAR],nc)/Pe(Em,C[Mr.NEAR]);fe(Em,Em,A),we(nc,nc,Em),c.projectToRenderScreen(nc,Cw)}else if(Ew[2]<0&&Cw[2]<0)continue;Ew[2]=0,Cw[2]=0;const T=tee(XT(Ew,Cw,npe),h);T<f&&(f=T,pe(rpe,sc),pe(spe,nc),m=b/3)}const y=s.rayBegin,x=s.rayEnd;if(f<p*p){let b=Number.MAX_VALUE;if(wwe(XT(rpe,spe,npe),XT(y,x,Nmt),Sw)){xe(Sw,Sw,y);const S=Ue(Sw);fe(Sw,Sw,1/S),b=S/Pr(y,x)}n(b,Sw,m,!1)}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return null;const s=t.indices,n=r.get(P.POSITION);return xie(n,s?s.get(P.POSITION):null,s&&rJ(this.parameters,r,s),i)}createLayout(){const t=Bs().vec3f(P.POSITION).f32(P.SUBDIVISIONFACTOR).vec2f(P.UV0).vec3f(P.AUXPOS1).vec3f(P.AUXPOS2);return this.parameters.vvSizeEnabled?t.f32(P.SIZEFEATUREATTRIBUTE):t.f32(P.SIZE),this.parameters.vvColorEnabled?t.f32(P.COLORFEATUREATTRIBUTE):t.vec4f(P.COLOR),this.parameters.vvOpacityEnabled&&t.f32(P.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new Lmt(this.layout,this.parameters)}requiresSlot(t,i){if(t===$e.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===rs.OccludeAndTransparentStencil)return t===$e.OPAQUE_MATERIAL||t===$e.OCCLUDER_MATERIAL||t===$e.TRANSPARENT_OCCLUDER_MATERIAL;const r=DS(i);return r===oe.Color||r===oe.Alpha?t===(this.parameters.writeDepth?$e.TRANSPARENT_MATERIAL:$e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===$e.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===oe.Color||t.output===oe.Alpha||t.output===oe.Highlight||t.output===oe.Depth?new Imt(t):null}validateParameters(t){t.join!=="miter"&&(t.miterLimit=0)}}class Imt extends Qb{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==oe.Color&&this._output!==oe.Alpha||this._updateOccludeeState(t),this.ensureTechnique(G6,t)}}class $mt extends ire{constructor(){super(...arguments),this.width=0,this.color=lp,this.join="miter",this.cap=yp.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class Lmt{constructor(t,i){this.parameters=i,this.numJoinSubdivisions=0,this.vertexBufferLayout=t;const r=i.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=Jz+r}}_isClosed(t){return rJ(this.parameters,t.vertexAttributes,t.indices)}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){const r=t.indices.get(P.POSITION).length/2+1,s=this._isClosed(t);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this.parameters.wireframe&&(n=2+4*(n-2)),n}write(t,i,r,s){var H;const n=Fmt,o=kmt,a=Umt,l=i.vertexAttributes.get(P.POSITION).data,c=i.indices&&i.indices.get(P.POSITION),h=(H=i.vertexAttributes.get(P.DISTANCETOSTART))==null?void 0:H.data;c&&c.length!==2*(l.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let p=1,f=0;this.parameters.vvSizeEnabled?f=i.vertexAttributes.get(P.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(P.SIZE)&&(p=i.vertexAttributes.get(P.SIZE).data[0]);let m=[1,1,1,1],g=0;this.parameters.vvColorEnabled?g=i.vertexAttributes.get(P.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(P.COLOR)&&(m=i.vertexAttributes.get(P.COLOR).data);let y=0;this.parameters.vvOpacityEnabled&&(y=i.vertexAttributes.get(P.OPACITYFEATUREATTRIBUTE).data[0]);const x=l.length/3,b=t.transformation,S=new Float32Array(r.buffer),T=this.vertexBufferLayout.stride/4;let C=s*T;const A=C;let O=0;const D=h?(K,ee,ce)=>O=h[ce]:(K,ee,ce)=>O+=Pr(K,ee),U=(K,ee,ce,le,z,q,Z)=>{if(S[C++]=ee[0],S[C++]=ee[1],S[C++]=ee[2],S[C++]=le,S[C++]=Z,S[C++]=z,S[C++]=K[0],S[C++]=K[1],S[C++]=K[2],S[C++]=ce[0],S[C++]=ce[1],S[C++]=ce[2],this.parameters.vvSizeEnabled?S[C++]=f:S[C++]=p,this.parameters.vvColorEnabled)S[C++]=g;else{const Y=Math.min(4*q,m.length-4);S[C++]=m[Y+0],S[C++]=m[Y+1],S[C++]=m[Y+2],S[C++]=m[Y+3]}this.parameters.vvOpacityEnabled&&(S[C++]=y)};C+=T,he(o,l[0],l[1],l[2]),b&&Xe(o,o,b);const k=this._isClosed(i);if(k){const K=l.length-3;he(n,l[K],l[K+1],l[K+2]),b&&Xe(n,n,b)}else he(a,l[3],l[4],l[5]),b&&Xe(a,a,b),U(o,o,a,1,pu.LEFT_CAP_START,0,0),U(o,o,a,1,pu.RIGHT_CAP_START,0,0),pe(n,o),pe(o,a);const B=k?0:1,j=k?x:x-1;for(let K=B;K<j;K++){const ee=(K+1)%x*3;he(a,l[ee+0],l[ee+1],l[ee+2]),b&&Xe(a,a,b),D(n,o,K),U(n,o,a,0,pu.LEFT_JOIN_END,K,O),U(n,o,a,0,pu.RIGHT_JOIN_END,K,O);const ce=this.numJoinSubdivisions;for(let le=0;le<ce;++le){const z=(le+1)/(ce+1);U(n,o,a,z,pu.LEFT_JOIN_END,K,O),U(n,o,a,z,pu.RIGHT_JOIN_END,K,O)}U(n,o,a,1,pu.LEFT_JOIN_START,K,O),U(n,o,a,1,pu.RIGHT_JOIN_START,K,O),pe(n,o),pe(o,a)}k?(he(a,l[3],l[4],l[5]),b&&Xe(a,a,b),O=D(n,o,j),U(n,o,a,0,pu.LEFT_JOIN_END,B,O),U(n,o,a,0,pu.RIGHT_JOIN_END,B,O)):(O=D(n,o,j),U(n,o,o,0,pu.LEFT_CAP_END,j,O),U(n,o,o,0,pu.RIGHT_CAP_END,j,O)),Jj(S,A+T,S,A,T),C=Jj(S,C-T,S,C,T),this.parameters.wireframe&&this._addWireframeVertices(r,A,C,T)}_addWireframeVertices(t,i,r,s){const n=new Float32Array(t.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(t.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=Jj(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}}function Jj(e,t,i,r,s){for(let n=0;n<s;n++)i[r++]=e[t++];return r}function rJ(e,t,i){return mRe(e,t.get(P.POSITION).data,i?i.get(P.POSITION):null)}function mRe(e,t,i){return!!e.isClosed&&(i?i.length>2:t.length>6)}const sc=$(),nc=$(),Em=$(),Sw=$(),Dmt=$(),Ew=ko(),Cw=ko(),rpe=$(),spe=$(),npe=dy(),Nmt=dy(),Fmt=$(),kmt=$(),Umt=$(),TR=[ko(),ko(),ko(),ko()],Ly=[$(),$(),$(),$()],Qj=qi(),Kj=qi(),e7=qi(),t7=qi();class vre{constructor(t,i=125e4){this._originSR=t,this._gridSize=i,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+Dc()}getOrigin(t){const i=this._origins.get(this._rootOriginId);if(i==null){const h=mmt.rootOrigin;if(_(h))return this._origins.set(this._rootOriginId,n3(h[0],h[1],h[2],this._rootOriginId)),this.getOrigin(t);const p=n3(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,p),p}const r=this._gridSize,s=Math.round(t[0]/r),n=Math.round(t[1]/r),o=Math.round(t[2]/r),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*r;if(xe(Zo,t,i.vec3),Zo[0]=Math.abs(Zo[0]),Zo[1]=Math.abs(Zo[1]),Zo[2]=Math.abs(Zo[2]),Zo[0]<c&&Zo[1]<c&&Zo[2]<c){if(l){const h=Math.max(...Zo);if(xe(Zo,t,l.vec3),Zo[0]=Math.abs(Zo[0]),Zo[1]=Math.abs(Zo[1]),Zo[2]=Math.abs(Zo[2]),Math.max(...Zo)<h)return l}return i}return l||(l=n3(s*r,n*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(t,i=zi(1,1,0,1)){const r=window.view,s=r._stage,n=i.toString();if(!this._objects.has(n)){this._material=new YC({width:2,color:i}),s.add(this._material);const m=new aRe({isPickable:!1}),g=new Hv({castShadow:!1});s.add(g),m.add(g),s.add(m),this._objects.set(n,g)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Uint16Array(2*(l-1)),p=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m+0]=t[0]+(1&a[m]?p:-p),c[3*m+1]=t[1]+(2&a[m]?p:-p),c[3*m+2]=t[2]+(4&a[m]?p:-p),m>0&&(h[2*m+0]=m-1,h[2*m+1]=m);$r(c,this._originSR,0,c,r.renderSpatialReference,0,l);const f=new vs([[P.POSITION,{size:3,data:c,exclusive:!0}]],[[P.POSITION,h]],kc.Line);s.add(f),o.addGeometry(f,this._material,Xn)}}const Zo=$();class gRe{constructor(t,i,r,s=null){this.rctx=t,this.sliceHelper=s,this.lastFrameCamera=new xr,this.pass=rt.MATERIAL,this.renderOccludedMask=ope,this.bindParameters=new m6(i,r,_(s)?s.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=ope}get isHighlightPass(){return this.pass===rt.MATERIAL_HIGHLIGHT}}class zmt extends gRe{constructor(t,i,r,s,n){super(t,r,s,n),this.offscreenRenderingHelper=i,this.sliceHelper=n}}const ope=rs.Occlude|rs.OccludeAndTransparent|rs.OccludeAndTransparentStencil;var NM;(function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"})(NM||(NM={}));class lF{constructor(){this.camera=new xr,this.lightMat=Ne()}}class _re{constructor(t,i,r=0){this.rctx=t,this.viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=si(),this._cascades=[new lF,new lF,new lF,new lF],this.maxTextureSize=this.rctx.parameters.maxTextureSize,this.snapshotCount=r}get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get cascadeDistances(){return _r(this._usedCascadeDistances,this._cascadeDistances[0],this.numCascades>1?this._cascadeDistances[1]:1/0,this.numCascades>2?this._cascadeDistances[2]:1/0,this.numCascades>3?this._cascadeDistances[3]:1/0)}dispose(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(t){this.maxNumCascades=He(Math.floor(t),1,4)}get maxCascades(){return this.maxNumCascades}set enabled(t){this._enabled=t,t||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&_(this._depthTexture)}get snapshotCount(){return this._snapshots.length}set snapshotCount(t){const i=this._snapshots.length;if(t>i){const r=t-i;this._snapshots.length=t;for(let s=0;s<r;++s)this._snapshots[i+s]=null}else if(t<this.snapshotCount){const r=i-t;for(let s=0;s<r;++s)this._discardSnapshot(t+s);this._snapshots.length=t}}getSnapshot(t){return this.enabled?this._snapshots[t]:null}getCascades(){for(let t=0;t<this.numCascades;++t)r7[t]=this._cascades[t];return r7.length=this.numCascades,r7}start(t,i,r){Ct(this.enabled),this._textureSize=this._computeTextureSize(t.fullWidth,t.fullHeight),this._ensureDepthTexture();const{near:s,far:n}=this._clampNearFar(r);this._computeCascadeDistances(n,s),this._setupMatrices(t,i);const o=t.viewMatrix,a=t.projectionMatrix;for(let l=0;l<this.numCascades;++l)this._constructCascade(l,a,o,i);this.lastOrigin=null,this.clear()}finish(t){Ct(this.enabled),this.rctx.bindFramebuffer(t)}getShadowMapMatrices(t){if(!this.lastOrigin||!Ic(t,this.lastOrigin)){this.lastOrigin=this.lastOrigin||$(),pe(this.lastOrigin,t);for(let i=0;i<this.numCascades;++i){Zl(gpe,this._cascades[i].lightMat,t);for(let r=0;r<16;++r)ype[16*i+r]=gpe[r]}}return ype}takeCascadeSnapshotTo(t,i){Ct(this.enabled);const r=this._ensureSnapshot(i);this._bindFbo();const s=this.rctx,n=s.bindTexture(r,_t.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(At.TEXTURE_2D,0,t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[2],t.camera.viewport[3]),s.bindTexture(n,_t.TEXTURE_UNIT_FOR_UPDATES)}clear(){const t=this.rctx;this._bindFbo(),t.setClearColor(1,1,1,1),t.clearSafe(wr.COLOR_BUFFER_BIT|wr.DEPTH_BUFFER_BIT)}_computeTextureSize(t,i){const r=.5*Math.log(t*t+i*i)*Math.LOG2E,s=.35,n=2**Math.round(r+s);return Math.min(this.maxTextureSize,2*n)}_ensureDepthTexture(){if(_(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const t={target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:gt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new _t(this.rctx,t),this._fbo=new ss(this.rctx,{colorTarget:zs.TEXTURE,depthStencilTarget:Yi.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(t){let i=this._snapshots[t];if(_(i)&&i.descriptor.width===this._textureSize)return i;this._discardSnapshot(t);const r={target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:gt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return i=new _t(this.rctx,r),this._snapshots[t]=i,i}_discardDepthTexture(){this._fbo=ht(this._fbo),this._depthTexture=ht(this._depthTexture)}_discardSnapshot(t){this._snapshots[t]=ht(this._snapshots[t])}_discardAllSnapshots(){for(let t=0;t<this.snapshotCount;++t)this._discardSnapshot(t)}_bindFbo(){const t=this.rctx;t.unbindTexture(this._depthTexture),t.bindFramebuffer(this._fbo)}_constructCascade(t,i,r,s){const n=this._cascades[t],o=-this._cascadeDistances[t],a=-this._cascadeDistances[t+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);Ct(l<c);for(let p=0;p<8;++p){_r(upe,p%4==0||p%4==3?-1:1,p%4==0||p%4==1?-1:1,p<4?l:c,1),jh(cu[p],upe,cpe);for(let f=0;f<3;++f)cu[p][f]/=cu[p][3]}ll(i7,cu[0]),Zl(ape,mpe,i7),n.camera.viewMatrix=ape;for(let p=0;p<8;++p)Xe(cu[p],cu[p],n.camera.viewMatrix);pe(Cm,cu[0]),pe(Am,cu[0]);for(let p=1;p<8;++p)for(let f=0;f<3;++f)Cm[f]=Math.min(Cm[f],cu[p][f]),Am[f]=Math.max(Am[f],cu[p][f]);Cm[2]-=200,Am[2]+=200,n.camera.near=-Am[2],n.camera.far=-Cm[2],this.warp?this._constructTrapezoidalProjection(r,s,n):this._constructOrthogonalProjection(n),As(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const h=this._textureSize/2;n.camera.viewport[0]=t%2==0?0:h,n.camera.viewport[1]=Math.floor(t/2)===0?0:h,n.camera.viewport[2]=h,n.camera.viewport[3]=h}_constructOrthogonalProjection(t){GK(t.camera.projectionMatrix,Cm[0],Am[0],Cm[1],Am[1],t.camera.near,t.camera.far)}_constructTrapezoidalProjection(t,i,r){const s=1/cu[0][3],n=1/cu[4][3];Ct(s<n);let o=s+Math.sqrt(s*n);const a=Math.sin(Yn(t[2]*i[0]+t[6]*i[1]+t[10]*i[2]));o/=a,Bmt(cu,o,a,hpe,dpe,Vmt,ppe,fpe),Gmt(hpe,dpe,ppe,fpe,r.camera.projectionMatrix),r.camera.projectionMatrix[10]=2/(Cm[2]-Am[2]),r.camera.projectionMatrix[14]=-(Cm[2]+Am[2])/(Cm[2]-Am[2])}_setupMatrices(t,i){As(lpe,t.projectionMatrix,t.viewMatrix),Ks(cpe,lpe);const r=this.viewingMode===tt.Global?t.eye:he(i7,0,0,1);pB(mpe,[0,0,0],[-i[0],-i[1],-i[2]],r)}_clampNearFar(t){let{near:i,far:r}=t;return i<2&&(i=2),r<2&&(r=2),i>=r&&(i=2,r=4),{near:i,far:r}}_computeCascadeDistances(t,i){this.numCascades=Math.min(1+Math.floor(oat(t/i,4)),this.maxNumCascades);const r=(t-i)/this.numCascades,s=(t/i)**(1/this.numCascades);let n=i,o=i;for(let a=0;a<this.numCascades+1;++a)this._cascadeDistances[a]=ui(n,o,this.splitSchemeLambda),n*=s,o+=r}get gpuMemoryUsage(){var t,i;return this._snapshots.reduce((r,s)=>r+SS(s),(i=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?i:0)}get test(){const t=this;return{maxNumCascades:this.maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(i){t.splitSchemeLambda=i},get splitSchemeLambda(){return t.splitSchemeLambda},set warp(i){t.warp=i},get warp(){return t.warp}}}}const ape=Ne(),lpe=Ne(),cpe=Ne(),upe=si(),cu=[];for(let e=0;e<8;++e)cu.push(si());const Cm=$(),Am=$(),hpe=Ke(),dpe=Ke(),Vmt=Ke(),ppe=Ke(),fpe=Ke(),mpe=Ne(),i7=$(),r7=[],gpe=Ne(),ype=new Float32Array(64),ih=Ke(),W2=Ke(),Aw=[Ke(),Ke(),Ke(),Ke()],eo=Ke(),s7=Ke(),p_=Ke(),SR=Ke(),Z2=Ke(),X2=Ke(),cF=Ke();function Bmt(e,t,i,r,s,n,o,a){Li(ih,0,0);for(let A=0;A<4;++A)$h(ih,ih,e[A]);Oc(ih,ih,.25),Li(W2,0,0);for(let A=4;A<8;++A)$h(W2,W2,e[A]);Oc(W2,W2,.25),F0(Aw[0],e[4],e[5],.5),F0(Aw[1],e[5],e[6],.5),F0(Aw[2],e[6],e[7],.5),F0(Aw[3],e[7],e[4],.5);let l=0,c=ty(Aw[0],ih);for(let A=1;A<4;++A){const O=ty(Aw[A],ih);O<c&&(c=O,l=A)}Ss(eo,Aw[l],e[l+4]);const h=eo[0];let p,f;eo[0]=-eo[1],eo[1]=h,Ss(s7,W2,ih),ys(s7,eo)<0&&Yte(eo,eo),F0(eo,eo,s7,i),pM(eo,eo),p=f=ys(Ss(p_,e[0],ih),eo);for(let A=1;A<8;++A){const O=ys(Ss(p_,e[A],ih),eo);O<p?p=O:O>f&&(f=O)}po(r,ih),Oc(p_,eo,p-t),$h(r,r,p_);let m=-1,g=1,y=0,x=0;for(let A=0;A<8;++A){Ss(SR,e[A],r),pM(SR,SR);const O=eo[0]*SR[1]-eo[1]*SR[0];O>0?O>m&&(m=O,y=A):O<g&&(g=O,x=A)}N2(m>0,"leftArea"),N2(g<0,"rightArea"),Oc(Z2,eo,p),$h(Z2,Z2,ih),Oc(X2,eo,f),$h(X2,X2,ih),cF[0]=-eo[1],cF[1]=eo[0];const b=AN(r,e[x],X2,$h(p_,X2,cF),1,s),S=AN(r,e[y],X2,p_,1,n),T=AN(r,e[y],Z2,$h(p_,Z2,cF),1,o),C=AN(r,e[x],Z2,p_,1,a);N2(b,"rayRay"),N2(S,"rayRay"),N2(T,"rayRay"),N2(C,"rayRay")}function Pi(e,t){return 3*t+e}const vpe=Ke();function Yc(e,t){return Li(vpe,e[t],e[t+3]),vpe}const oc=Ke(),ft=ls();function Gmt(e,t,i,r,s){Ss(oc,i,r),Oc(oc,oc,.5),ft[0]=oc[0],ft[1]=oc[1],ft[2]=0,ft[3]=oc[1],ft[4]=-oc[0],ft[5]=0,ft[6]=oc[0]*oc[0]+oc[1]*oc[1],ft[7]=oc[0]*oc[1]-oc[1]*oc[0],ft[8]=1,ft[Pi(0,2)]=-ys(Yc(ft,0),e),ft[Pi(1,2)]=-ys(Yc(ft,1),e);let n=ys(Yc(ft,0),i)+ft[Pi(0,2)],o=ys(Yc(ft,1),i)+ft[Pi(1,2)],a=ys(Yc(ft,0),r)+ft[Pi(0,2)],l=ys(Yc(ft,1),r)+ft[Pi(1,2)];n=-(n+a)/(o+l),ft[Pi(0,0)]+=ft[Pi(1,0)]*n,ft[Pi(0,1)]+=ft[Pi(1,1)]*n,ft[Pi(0,2)]+=ft[Pi(1,2)]*n,n=1/(ys(Yc(ft,0),i)+ft[Pi(0,2)]),o=1/(ys(Yc(ft,1),i)+ft[Pi(1,2)]),ft[Pi(0,0)]*=n,ft[Pi(0,1)]*=n,ft[Pi(0,2)]*=n,ft[Pi(1,0)]*=o,ft[Pi(1,1)]*=o,ft[Pi(1,2)]*=o,ft[Pi(2,0)]=ft[Pi(1,0)],ft[Pi(2,1)]=ft[Pi(1,1)],ft[Pi(2,2)]=ft[Pi(1,2)],ft[Pi(1,2)]+=1,n=ys(Yc(ft,1),t)+ft[Pi(1,2)],o=ys(Yc(ft,2),t)+ft[Pi(2,2)],a=ys(Yc(ft,1),i)+ft[Pi(1,2)],l=ys(Yc(ft,2),i)+ft[Pi(2,2)],n=-.5*(n/o+a/l),ft[Pi(1,0)]+=ft[Pi(2,0)]*n,ft[Pi(1,1)]+=ft[Pi(2,1)]*n,ft[Pi(1,2)]+=ft[Pi(2,2)]*n,n=ys(Yc(ft,1),t)+ft[Pi(1,2)],o=ys(Yc(ft,2),t)+ft[Pi(2,2)],a=-o/n,ft[Pi(1,0)]*=a,ft[Pi(1,1)]*=a,ft[Pi(1,2)]*=a,s[0]=ft[0],s[1]=ft[1],s[2]=0,s[3]=ft[2],s[4]=ft[3],s[5]=ft[4],s[6]=0,s[7]=ft[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=ft[6],s[13]=ft[7],s[14]=0,s[15]=ft[8]}class yRe{constructor(){this.adds=new ai,this.removes=new ai,this.updates=new ai({allocator:t=>t||new jmt,deallocator:t=>(t.renderGeometry=null,t)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class jmt{}class Hmt{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var wi;(function(e){var t,i;(t=e.Geometry||(e.Geometry={}))[t.ADD=1]="ADD",t[t.UPDATE=2]="UPDATE",t[t.REMOVE=4]="REMOVE",(i=e.State||(e.State={}))[i.VISIBILITIES=1]="VISIBILITIES",i[i.VERTEXATTRS=2]="VERTEXATTRS",i[i.TRANSFORMATION=4]="TRANSFORMATION",i[i.HIGHLIGHTS=8]="HIGHLIGHTS",i[i.OCCLUDEES=16]="OCCLUDEES"})(wi||(wi={}));function vRe(e){const t=new Map,i=r=>{let s=t.get(r);return s||(s=new Hmt,t.set(r,s)),s};return e.removes.forAll(r=>{n7(r)&&i(r.material).removes.push(r)}),e.adds.forAll(r=>{n7(r)&&i(r.material).adds.push(r)}),e.updates.forAll(r=>{n7(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),t}function n7(e){return e.data.indexCount>=1}function qmt(e){const t=E`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.fragment.code.add(t),e.vertex.code.add(t)}function j6(e,t){t.normalType===ns.Attribute&&(e.attributes.add(P.NORMAL,"vec3"),e.vertex.code.add(E`vec3 normalModel() {
return normal;
}`)),t.normalType===ns.CompressedAttribute&&(e.include(qmt),e.attributes.add(P.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(E`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),t.normalType===ns.ScreenDerivative&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(E`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}var ns;(function(e){e[e.Attribute=0]="Attribute",e[e.CompressedAttribute=1]="CompressedAttribute",e[e.Ground=2]="Ground",e[e.ScreenDerivative=3]="ScreenDerivative",e[e.COUNT=4]="COUNT"})(ns||(ns={}));function H6(e){e.attributes.add(P.POSITION,"vec3"),e.vertex.code.add(E`vec3 positionModel() { return position; }`)}function Kz({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(E`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(E`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function XL(e){return!!ye("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}function wA(e,t){e.include(H6);const i=e.vertex;i.include(Kz,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),i.uniforms.add([new Dt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new Dt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new BL("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new Xr("transformProjFromView",r=>r.transformProjFromView),new u$("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new ql("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new ql("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)]),i.code.add(E`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(E`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?E`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:E`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new Dt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(E`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(E`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class _Re extends Nn{constructor(){super(...arguments),this.transformWorldFromViewTH=$(),this.transformWorldFromViewTL=$(),this.transformViewFromCameraRelativeRS=ls(),this.transformProjFromView=Ne()}}class bRe extends Nn{constructor(){super(...arguments),this.transformWorldFromModelRS=ls(),this.transformWorldFromModelTH=Xi(),this.transformWorldFromModelTL=Xi()}}function q6(e,t){t.normalType===ns.Attribute||t.normalType===ns.CompressedAttribute?(e.include(j6,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add([new u$("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new BL("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)]),e.vertex.code.add(E`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):t.normalType===ns.Ground?(e.include(wA,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(E`
    void forwardNormal() {
      vNormalWorld = ${t.spherical?E`normalize(vPositionWorldCameraRelative);`:E`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(E`void forwardNormal() {}`)}class wRe extends _Re{constructor(){super(...arguments),this.transformNormalViewFromGlobal=ls()}}class xRe extends bRe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=ls(),this.toMapSpace=si()}}class sJ extends xRe{constructor(t=$()){super(),this.origin=t,this.slicePlaneLocalOrigin=this.origin}}function YL(e,t){t.output===oe.Color&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(E`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):t.output===oe.Depth||t.output===oe.Shadow?(e.include(wA,t),e.varyings.add("linearDepth","float"),e.vertex.uniforms.add(new Di("nearFar",(i,r)=>r.camera.nearFar)),e.vertex.code.add(E`void forwardLinearDepth() {
linearDepth = (-vPosition_view.z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):e.vertex.code.add(E`void forwardLinearDepth() {}`)}function ob(e,t){t.spherical?e.vertex.code.add(E`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(E`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(E`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(E`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}class JL extends $s{constructor(t,i){super(t,"int",ar.Pass,(r,s,n)=>r.setUniform1i(t,i(s,n)))}}class TRe extends $s{constructor(t,i,r,s){switch(i){case ar.Pass:return void super(t,"mat4",i,(n,o,a)=>n.setUniformMatrix4fv(t,r(o,a)),s);case ar.Draw:return void super(t,"mat4",i,(n,o,a)=>n.setUniformMatrix4fv(t,r(o,a)),s)}}}class SRe extends Nn{constructor(){super(...arguments),this.origin=$()}}function W6(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new TRe("shadowMapMatrix",ar.Pass,(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),ERe(e))}function NS(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new TRe("shadowMapMatrix",ar.Draw,(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),ERe(e))}function ERe(e){const t=e.fragment;t.include(Zu),t.uniforms.add([new oi("shadowMapTex",(i,r)=>r.shadowMap.depthTexture),new JL("numCascades",(i,r)=>r.shadowMap.numCascades),new Ei("cascadeDistances",(i,r)=>r.shadowMap.cascadeDistances),new lt("depthHalfPixelSz",(i,r)=>.5/r.shadowMap.textureSize)]),t.code.add(E`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)}function Wmt(e){e.fragment.code.add(E`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function Zmt(e){e.fragment.code.add(E`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function Xmt(e){const t=e.fragment.code;t.add(E`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(E`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(E`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function Z6(e,t){const i=e.fragment.code;e.include(u6),t.pbrMode===Gt.Water||t.pbrMode===Gt.WaterOnIntegratedMesh?(i.add(E`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),i.add(E`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(E`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(E`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(E`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):t.pbrMode!==Gt.Normal&&t.pbrMode!==Gt.Schematic||(e.include(Xmt),i.add(E`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(E`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(E`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),i.add(E`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(E`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(E`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function CRe(e,t){e.include(Z6,t),e.include(l6),e.include(Zmt),t.hasCloudsReflections&&e.include(nAe,t),t.hasScreenSpaceReflections&&e.include($ot,t);const i=e.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(E`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add([new lt("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new lt("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(E`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&i.code.add(E`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?i.code.add(E`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):i.code.add(E`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?i.code.add(E`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(E`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(E`return waterRenderedColor;
}`)}function _pe(e){e.fragment.uniforms.add(new ws("texWaveNormal")),e.fragment.uniforms.add(new ws("texWavePerturbation")),e.fragment.uniforms.add([new Ei("waveParams",t=>_r(Ymt,t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset)),new Di("waveDirection",t=>Li(Jmt,t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity))]),e.include(Wmt),e.fragment.code.add(E`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const Ymt=si(),Jmt=Ke();function Qmt(e){const t=new mr,{vertex:i,fragment:r}=t,s=Kh(t,e);return t.include(Ua),t.attributes.add(P.POSITION,"vec3"),t.attributes.add(P.UV0,"vec2"),i.uniforms.add(new Ei("waterColor",n=>n.color)),e.output!==oe.Color&&e.output!==oe.Alpha||(t.include(ob,e),t.include(YL,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),r.uniforms.add(s),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.code.add(E`
      void main(void) {
        if (waterColor.a < ${E.float(Va)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===oe.Color?"forwardLinearDepth();":""}
      }
    `)),t.include(ld,e),e.output===oe.Alpha&&(t.include(Qs,e),r.uniforms.add(new Gl("waterColor")),r.code.add(E`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),e.output===oe.Color&&(t.include(uie,{isGround:!1}),t.include(cie,{pbrMode:Gt.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(_pe),t.include(Qs,e),t.include(NS,e),t.include(CRe,e),r.uniforms.add([new Gl("waterColor"),new Dt("lightingMainDirection",(n,o)=>o.lighting.lightingMainDirection),new Dt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity),new lt("timeElapsed",n=>n.timeElapsed),new Ib("view")]),ry(r,e),r.include(gy),r.code.add(E`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?E`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===Rt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output===oe.Normal&&(t.include(ob,e),t.include(_pe,e),t.include(Qs,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i.code.add(E`
        void main(void) {
          if (waterColor.a < ${E.float(Va)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new lt("timeElapsed",n=>n.timeElapsed)),r.code.add(E`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),e.output===oe.Draped&&(t.varyings.add("vpos","vec3"),i.code.add(E`
        void main(void) {
          if (waterColor.a < ${E.float(Va)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new Gl("waterColor")),r.code.add(E`void main() {
gl_FragColor = waterColor;
}`)),e.output===oe.Highlight&&(t.include(Bv),t.varyings.add("vpos","vec3"),i.code.add(E`
      void main(void) {
        if (waterColor.a < ${E.float(Va)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(Qs,e),r.code.add(E`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const Kmt=Object.freeze(Object.defineProperty({__proto__:null,build:Qmt},Symbol.toStringTag,{value:"Module"}));class X6 extends Lr{constructor(t,i,r){super(t,i,r),this._textureRepository=t.waterTextureRepository}initializeConfiguration(t,i){i.spherical=t.viewingMode===tt.Global,i.doublePrecisionRequiresObfuscation=XL(t.rctx)}initializeProgram(t){const i=X6.shader.get().build(this.configuration);return new Er(t.rctx,i,lr)}bindPass(t,i){this.program.bindPass(t,i),this.configuration.output!==oe.Color&&this.configuration.output!==oe.Normal||this._textureRepository.bind(this.program)}_setPipelineState(t){const i=this.configuration,r=t===Rt.NONE,s=t===Rt.FrontFace;return ri({blending:i.output!==oe.Normal&&i.output!==oe.Highlight&&i.transparent?r?ed:Gv(t):null,depthTest:{func:ew(t)},depthWrite:r?i.writeDepth&&jc:I6(t),colorWrite:xi,polygonOffset:r||s?null:D6(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}X6.shader=new Sr(Kmt,()=>import("./WaterSurface.glsl.d9d85915.js"));class ra extends al{constructor(){super(...arguments),this.output=oe.Color,this.transparencyPassType=Rt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([Q({count:oe.COUNT})],ra.prototype,"output",void 0),u([Q({count:Rt.COUNT})],ra.prototype,"transparencyPassType",void 0),u([Q()],ra.prototype,"spherical",void 0),u([Q()],ra.prototype,"receiveShadows",void 0),u([Q()],ra.prototype,"hasSlicePlane",void 0),u([Q()],ra.prototype,"transparent",void 0),u([Q()],ra.prototype,"enableOffset",void 0),u([Q()],ra.prototype,"writeDepth",void 0),u([Q()],ra.prototype,"hasScreenSpaceReflections",void 0),u([Q()],ra.prototype,"doublePrecisionRequiresObfuscation",void 0),u([Q()],ra.prototype,"hasCloudsReflections",void 0),u([Q()],ra.prototype,"isDraped",void 0),u([Q()],ra.prototype,"hasMultipassTerrain",void 0),u([Q()],ra.prototype,"cullAboveGround",void 0),u([Q({constValue:Gt.Water})],ra.prototype,"pbrMode",void 0),u([Q({constValue:!0})],ra.prototype,"useCustomDTRExponentForWater",void 0),u([Q({constValue:!0})],ra.prototype,"highStepCount",void 0),u([Q({constValue:!1})],ra.prototype,"useFillLights",void 0);class bpe extends Qb{_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}_updateSSRState(t){t.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:t.ssr.enabled})}_updateCloudsReflectionState(t){const i=_(t.clouds.data);i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(t){const i=this._techniqueRepository.constructionContext.waterTextureRepository;return i.resourceState===Tu.NOT_LOADED&&i.loadTextures(t),i.resourceState}beginSlot(t){return this._output===oe.Color&&(this._updateShadowState(t),this._updateSSRState(t),this._updateCloudsReflectionState(t)),this.ensureTechnique(X6,t)}}const egt=Bs().vec3f(P.POSITION),tgt=Bs().vec3f(P.POSITION).vec2f(P.UV0),ARe=Bs().vec3f(P.POSITION).vec4u8(P.COLOR);class Y6{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(P.POSITION).length}write(t,i,r,s){R6(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}class MRe extends vy{constructor(t){super(t,new ORe),this._techniqueConfig=new ra,this.animation=new MAe}getConfiguration(t,i){return this._techniqueConfig.output=t,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._techniqueConfig.hasCloudsReflections=this.parameters.hasCloudsReflections,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=i.transparencyPassType,this._techniqueConfig.enableOffset=i.camera.relativeElevation<$6,this._techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this._techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this._techniqueConfig}update(t){const i=Math.min(t.camera.relativeElevation,t.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<igt;const r=this.animation.advance(t);return this.setParameters({timeElapsed:FQ(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&r}intersect(t,i,r,s,n,o,a){M6(t,i,s,n,o,void 0,a)}requiresSlot(t,i){switch(DS(i)){case oe.Normal:return t===$e.DRAPED_WATER;case oe.Color:if(this.parameters.isDraped)return t===$e.DRAPED_MATERIAL;break;case oe.Highlight:return t===$e.OPAQUE_MATERIAL||t===$e.DRAPED_MATERIAL}let r=$e.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?$e.TRANSPARENT_MATERIAL:$e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),t===r}createGLMaterial(t){if(t.output===oe.Color&&this.parameters.isDraped)return t.output=oe.Draped,new bpe(t);switch(t.output){case oe.Color:case oe.Normal:case oe.Highlight:case oe.Alpha:return new bpe(t)}return null}createBufferWriter(){return new Y6(tgt)}}class ORe extends AO{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=er(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=zi(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}}const igt=35e3;class wpe{constructor(t){this.first=t.from,this.count=t.to-t.from}}class dC{constructor(t=0,i=0){this.from=t,this.to=i}}class rgt extends dC{constructor(t,i,r,s,n,o){super(i,r),this.id=t,this.isVisible=s,this.hasHighlights=n,this.hasOccludees=o}}function xpe(e){return Array.from(e.values()).sort(sgt)}function sgt(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function uF(e,t){if(e.length===0)return void e.push(new wpe(t));const i=e[e.length-1];if(ngt(i,t)){const r=t.from-i.first+t.to-t.from;i.count=r}else e.push(new wpe(t))}function ngt(e,t){return e.first+e.count>=t.from}class ogt{constructor(t,i){this._pool=t,this._size=0,this._buffer=t.newBuffer(nJ(i))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(t){this._resize(this._size+t,!0).dispose()}alloc(t){return this._resize(t,!1)}_resize(t,i){let r;const s=agt(this._buffer.length,this._size,t);if(this._buffer.length!==s){const o=this._pool.newBuffer(s);i&&(o.array.set(this._buffer.array.subarray(0,Math.min(this._size,s))),o.vao.vertexBuffers.geometry.setSubData(o.array,0,0,o.array.byteLength)),r=this._buffer,this._buffer=o}const n=this._size;return this._size=t,r?{dispose:()=>{r.array.fill(0,0,n),this._pool.deleteBuffer(r)},copy:(o,a,l)=>this._buffer.array.set(r.array.subarray(a,l),o),hasNewBuffer:!0}:{dispose:()=>{},copy:(o,a,l)=>{o!==a&&this._buffer.array.copyWithin(o,a,l)},hasNewBuffer:!1}}erase(t,i){this._buffer.array.fill(0,t,i)}}const Tpe=65536;function nJ(e){return Math.ceil(e/Tpe)*Tpe}function agt(e,t,i){return t<=i?e>=i?e:nJ(Math.max(2*e,i)):e<=2*i?e:nJ(i)}class lgt{constructor(t,i,r,s){this.vao=new Ln(t,i,{geometry:r},{geometry:Ci.createVertex(t,Wi.STATIC_DRAW)}),this.array=new Float32Array(s),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const cgt=b5+1;class ugt{constructor(t,i,r){this._rctx=t,this._locations=i,this._layout=r,this._cache=t.newCache(`MergedRenderer pool ${Dc()}`,hgt)}dispose(){this._cache.destroy()}newBuffer(t){const i=t.toString(),r=this._cache.pop(i);if(_(r)){const s=r.pop();return r.length>0&&this._cache.put(i,r,s.array.byteLength*r.length,cgt),s}return new lgt(this._rctx,this._locations,this._layout,t)}deleteBuffer(t){const i=t.array.byteLength,r=t.array.length.toString(),s=this._cache.pop(r);return _(s)?(s.push(t),this._cache.put(r,s,i*s.length,-1)):this._cache.put(r,[t],i,-1),null}}function hgt(e,t){if(t===O0.ALL)return void e.forEach(s=>s.dispose());const i=e.pop(),r=e.length*i.array.byteLength;return i.dispose(),r}class RRe{constructor(t,i,r){this._rctx=t,this._materialRepository=i,this._material=r,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new ai,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new lRe(this._material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._bufferPool=new ugt(t,r.vertexAttributeLocations,Xu(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(t=>t.buffer.dispose()),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof MRe}get rendersOccluded(){return!this.isEmpty&&this._material.renderOccluded!==rs.Occlude}modify(t){this._updateGeometries(t.updates),this._addAndRemoveGeometries(t.adds,t.removes),this._updateRenderCommands()}_addAndRemoveGeometries(t,i){const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=this._dataByOrigin,o=pgt(t,i);o.forEach((a,l)=>{o.delete(l);const c=a.toAdd.reduce((b,S)=>b+r.elementCount(S.data),0);let h=n.get(l);if(h==null)Ct(a.toRemove.length===0),h=new mgt(a.origin,new ogt(this._bufferPool,c*s)),n.set(l,h);else if(a.toAdd.length===0&&h.instances.size===a.toRemove.length)return h.buffer.dispose(),void n.delete(l);let p=0;h.instances.forEach(b=>p+=b.to-b.from);const f=a.toRemove.reduce((b,S)=>b+r.elementCount(S.data),0),m=h.buffer.size,g=(p+c-f)*s,y=ygt;if(g<m/2?this._removeAndRebuild(h,a.toRemove,s,g,y):a.toRemove.length>0&&this._remove(h,a.toRemove,s,y),a.toAdd.length>0){const b=vgt;TAe(b,-a.origin[0],-a.origin[1],-a.origin[2]),this._add(h,a.toAdd,s,b,y)}const x=h.buffer.vao.vertexBuffers.geometry;Cpe(y),y.forAll(({from:b,to:S})=>{if(b<S){const T=h.buffer.array,C=4,A=b*C,O=S*C;x.setSubData(T,A,A,O)}}),y.clear(),h.drawCommandsDirty=!0})}_updateGeometries(t){const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4;for(const s of t){const n=s.renderGeometry,o=this._dataByOrigin.get(n.origin.id),a=o&&o.instances.get(n.id);if(!a)return;const l=s.updateType;if(l&wi.State.VISIBILITIES&&(a.isVisible=n.instanceParameters.visible),l&(wi.State.HIGHLIGHTS|wi.State.VISIBILITIES)){const c=n.instanceParameters.visible;a.hasHighlights=!!n.instanceParameters.highlights&&c}if(l&wi.State.OCCLUDEES&&(a.hasOccludees=!!n.instanceParameters.occludees),l&(wi.State.VERTEXATTRS|wi.State.TRANSFORMATION)){const{array:c,vao:h}=o.buffer;$lt(n,o7,ER),i.write({transformation:o7,invTranspTransformation:ER},n.data,i.vertexBufferLayout.createView(c.buffer),a.from),Ct(a.from+i.elementCount(n.data)===a.to,"material VBO layout has changed"),h.vertexBuffers.geometry.setSubData(c,a.from*r*4,a.from*r*4,a.to*r*4)}o.drawCommandsDirty=!0}}_updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(i=>{i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,Mn(i.instances,r=>(r.isVisible?(r.hasHighlights&&(this._hasHighlights=!0,i.hasHighlights=!0),r.hasOccludees&&(this._hasOccludees=!0,i.hasOccludees=!0)):i.hasHiddenInstances=!0,i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees))});const t=i=>{if(i.drawCommandsDefault=null,i.drawCommandsHighlight=null,i.drawCommandsOccludees=null,i.drawCommandsShadowHighlightRest=null,i.instances.size===0)return;if(!Epe(i)){const s=this._bufferWriter.vertexBufferLayout.stride,n=4*i.buffer.size/s;return void(i.drawCommandsDefault=[{first:0,count:n}])}const r=xpe(i.instances);i.drawCommandsDefault=[],i.drawCommandsHighlight=[],i.drawCommandsOccludees=[],i.drawCommandsShadowHighlightRest=[];for(const s of r)s.isVisible&&(s.hasOccludees?uF(i.drawCommandsOccludees,s):uF(i.drawCommandsDefault,s),s.hasHighlights?uF(i.drawCommandsHighlight,s):uF(i.drawCommandsShadowHighlightRest,s))};this._dataByOrigin.forEach(i=>{i.drawCommandsDirty&&(t(i),i.drawCommandsDirty=!1)})}updateAnimation(t){return this._material.update(t)}requiresSlot(t,i){return t==null||this._material.requiresSlot(t,i)}render(t,i){if(!this.requiresSlot(i.slot,t))return!1;const r=t===rt.MATERIAL_HIGHLIGHT||t===rt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(r&&!this._hasHighlights)return!1;const s=t===rt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,n=!(r||s);if(this._dataByOrigin.forEach(c=>{if(r&&!c.hasHighlights)return;const h=(r?c.drawCommandsHighlight:s&&Epe(c)?c.drawCommandsShadowHighlightRest:c.drawCommandsDefault)||null,p=n&&c.drawCommandsOccludees||null;(_(h)||_(p))&&this._renderCommandData.push(new ggt(c.origin,c.buffer,h,p))}),this._renderCommandData.length===0)return!1;const o=this._rctx,a=this._glMaterials.load(o,t);if(M(a))return this._renderCommandData.clear(),!1;const l=a.beginSlot(i);return o.bindTechnique(l,this._material.parameters,i,!1),this._renderCommandData.forAll(c=>{l.bindDraw(c,i);const{buffer:h,renderCommands:p,occludeeCommands:f}=c;l.ensureAttributeLocations(h.vao),o.bindVAO(h.vao);const m=l.primitiveType;_(p)&&this._renderCommands(o,m,p),_(f)&&(l.bindPipelineState(o,i.slot,!0),this._renderCommands(o,m,f),l.bindPipelineState(o,i.slot,!1))}),this._renderCommandData.clear(),!0}_renderCommands(t,i,r){for(let s=0;s<r.length;s++)t.drawArrays(i,r[s].first,r[s].count)}_removeAndRebuild(t,i,r,s,n){for(const h of i)t.instances.delete(h.id);const o=xpe(t.instances);t.instances.clear();const a=t.buffer.size,l=t.buffer.alloc(s);let c=0;for(const h of o){const p=h.from*r,f=h.to*r;l.copy(c,p,f),h.from=c/r,c+=f-p,h.to=c/r,t.instances.set(h.id,h)}n.push(new dC(0,l.hasNewBuffer?t.buffer.array.length:a)),l.dispose(),t.buffer.erase(c,n.back().to),t.holes.clear()}_remove(t,i,r,s){for(const n of i){const o=n.id,a=t.instances.get(o),l=a.from*r,c=a.to*r;t.buffer.erase(l,c),t.holes.push(new dC(a.from,a.to)),t.instances.delete(o),s.push(new dC(l,c))}Cpe(t.holes)}_add(t,i,r,s,n){if(i.length===0)return;const o=this._bufferWriter;let a=o.vertexBufferLayout.createView(t.buffer.array.buffer);const l=t.holes.length>0;let c=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;for(const p of i){const f=_(p.transformation)?As(o7,s,p.transformation):s;Ks(ER,f);const m=Gc(ER,ER),g=o.elementCount(p.data),y=g*r;let x=fgt(t.holes,g);M(x)&&(x=t.buffer.size/r,t.buffer.grow(y),a=o.vertexBufferLayout.createView(t.buffer.array.buffer)),o.write({transformation:f,invTranspTransformation:m},p.data,a,x);const b=p.instanceParameters.visible,S=!!p.instanceParameters.highlights&&b,T=!!p.instanceParameters.occludees,C=new rgt(p.id,x,x+g,b,S,T);Ct(t.instances.get(p.id)==null),t.instances.set(p.id,C),l?n.push(new dC(C.from*r,C.to*r)):(c=Math.min(C.from,c),h=Math.max(C.to,h))}l||n.push(new dC(c*r,h*r))}get test(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class dgt{constructor(t){this.origin=t,this.toAdd=new Array,this.toRemove=new Array}}function pgt(e,t){const i=new Map;for(const r of e)Spe(i,r,!0);for(const r of t)Spe(i,r,!1);return i}function Spe(e,t,i){const r=t.origin;if(M(r))return;let s=e.get(r.id);s==null&&(s=new dgt(r.vec3),e.set(r.id,s)),i?s.toAdd.push(t):s.toRemove.push(t)}function Epe(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function fgt(e,t){let i;if(!e.some(s=>!(s.to-s.from<t)&&(i=s,!0)))return null;const r=i.from;return i.from+=t,i.from>=i.to&&e.removeUnordered(i),r}function Cpe(e){const t=new Map;e.forAll(r=>t.set(r.from,r));let i=!0;for(;i;)i=!1,e.forEach(r=>{const s=t.get(r.to);s&&(r.to=s.to,t.delete(s.from),e.removeUnordered(s),i=!0)})}class mgt{constructor(t,i){this.origin=t,this.buffer=i,this.instances=new Map,this.holes=new ai({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class ggt extends sJ{constructor(t,i,r,s){super(t),this.buffer=i,this.renderCommands=r,this.occludeeCommands=s}}const ygt=new ai({deallocator:null}),vgt=Ne(),o7=Ne(),ER=Ne();let pg=class extends Ee{constructor(e){super(e),this._pending=new _gt,this._changes=new yRe,this._materialRenderers=new Map,this._sortedMaterialRenderers=new ai,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Mn(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=vRe(this._changes);let t=!1,i=!1,r=!1;return e.forEach((s,n)=>{let o=this._materialRenderers.get(n);if(!o&&s.adds.length>0&&(o=new RRe(this.rctx,this._materialRepository,n),this._materialRenderers.set(n,o),t=!0,i=!0,r=!0),!o)return;const a=i||o.hasHighlights,l=r||o.hasWater;o.modify(s),i=i||a!==o.hasHighlights,r=r||l!==o.hasWater,o.isEmpty&&(this._materialRenderers.delete(n),o.dispose(),t=!0)}),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=Mn(this._materialRenderers,s=>s.hasHighlights)),r&&(this._hasWater=Mn(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,t){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const s of i)this._geometries.set(s.id,s);const r=this._pending.empty;for(const s of i)this._pending.adds.add(s);r&&this.notifyChange("updating"),t===wi.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const i=this._pending.empty,r=this._pending.adds;for(const s of e)r.has(s)?(this._pending.removed.add(s),r.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);i&&!this._pending.empty&&this.notifyChange("updating"),t===wi.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const i=this._changes.updates.length===0;for(const r of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(r),s.updateType=t}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case wi.State.TRANSFORMATION:case wi.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(e);case wi.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:i})=>t=i.updateAnimation(e)||t),t}render(e,t){for(let i=0;i<this._sortedMaterialRenderers.length;i++){const r=this._sortedMaterialRenderers.data[i];r.material.shouldRender(e)&&r.materialRenderer.render(e.pass,t)}}intersect(e,t,i,r,s){return this._geometries.forEach(n=>{if(r&&!r(n))return;this._intersectRenderGeometry(n,i,t,0,e,s);const o=this.rendererContext.longitudeCyclical;o&&(n.boundingSphere[0]-n.boundingSphere[3]<o.min&&this._intersectRenderGeometry(n,i,t,o.range,e,s),n.boundingSphere[0]+n.boundingSphere[3]>o.max&&this._intersectRenderGeometry(n,i,t,-o.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push({material:i,materialRenderer:t})}),this._sortedMaterialRenderers.sort((t,i)=>{const r=i.material.renderPriority-t.material.renderPriority;return r!==0?r:t.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,i,r,s,n){if(!e.instanceParameters.visible)return;let o=0;_(e.transformation)&&(r+=e.transformation[12],o=e.transformation[13]),hF[0]=i[0]-r,hF[1]=i[1]-o,hF[2]=1,dF[0]=i[0]-r,dF[1]=i[1]-o,dF[2]=0,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),s,hF,dF,(a,l,c)=>{bgt(t,c,e.material.renderPriority,n,s,e.layerUid,e.graphicUid)},e.calculateShaderTransformation,t)}_notifyGraphicGeometryChanged(e){if(M(this.drapeSource.notifyGraphicGeometryChanged))return;let t;for(const i of e){const r=i.graphicUid;_(r)&&r!==t&&(this.drapeSource.notifyGraphicGeometryChanged(r),t=r)}}_notifyGraphicVisibilityChanged(e){if(M(this.drapeSource.notifyGraphicVisibilityChanged))return;let t;for(const i of e){const r=i.graphicUid;_(r)&&r!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(r),t=r)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return M(e.origin)&&(e.origin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([d()],pg.prototype,"drapeSource",void 0),u([d()],pg.prototype,"updating",null),u([d()],pg.prototype,"rctx",null),u([d()],pg.prototype,"rendererContext",void 0),u([d()],pg.prototype,"_materialRepository",null),u([d()],pg.prototype,"_localOriginFactory",null),pg=u([L("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],pg);class _gt{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(t){return this.adds.has(t)||this.removes.has(t)||this.removed.has(t)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}function bgt(e,t,i,r,s,n,o){const a={layerUid:n,graphicUid:o,triangleNr:t},l=c=>{c.set(xs.OVERLAY,a,e.dist,e.normal,e.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==Vo.MIN&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===Vo.ALL){const c=Aie(s.ray);l(c),s.results.all.push(c)}}const hF=$(),dF=$();function J6(e){e.fragment.uniforms.add(new Ei("projInfo",(t,i)=>wgt(i))),e.fragment.uniforms.add(new Di("zScale",(t,i)=>PRe(i))),e.fragment.code.add(E`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function wgt(e){const t=e.camera.projectionMatrix;return t[11]===0?_r(Ape,2/(e.camera.fullWidth*t[0]),2/(e.camera.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):_r(Ape,-2/(e.camera.fullWidth*t[0]),-2/(e.camera.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}const Ape=si();function PRe(e){return e.camera.projectionMatrix[11]===0?Li(Mpe,0,1):Li(Mpe,1,0)}const Mpe=Ke();var qb;(function(e){e[e.SSAO=0]="SSAO",e[e.Blur=1]="Blur",e[e.COUNT=2]="COUNT"})(qb||(qb={}));class IRe extends Xl{constructor(){super(...arguments),this.output=qb.SSAO}}u([Q({count:qb.COUNT})],IRe.prototype,"output",void 0);const CR={samples:16,filterRadius:4};function xgt(e){const t=new mr,i=t.fragment;if(t.include(Kb),e.output===qb.Blur){const r=(CR.filterRadius+1)/2,s=1/(2*r*r);i.include(ad),i.uniforms.add([new ws("normalMap"),new ws("depthMap"),new ws("tex"),new tv("blurSize"),new nr("projScale"),new Di("nearFar",(n,o)=>o.camera.nearFar)]),i.code.add(E`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${E.float(s)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),i.code.add(E`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${E.int(CR.filterRadius)}; r <= ${E.int(CR.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `)}return e.output===qb.SSAO&&(i.include(ad),t.include(J6),i.uniforms.add(new ws("normalMap")),i.uniforms.add(new ws("depthMap")),i.uniforms.add(new ws("rnm")),i.uniforms.add(new nr("intensity")),i.uniforms.add(new nr("projScale")),i.uniforms.add(new nr("radius")),i.uniforms.add(new Di("nearFar",(r,s)=>s.camera.nearFar)),i.uniforms.add(new tv("screenSize")),i.uniforms.add(new tv("rnmScale")),i.code.add(E`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),i.code.add(E`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.fragment.uniforms.add(new Di("zScale",(r,s)=>PRe(s))),i.code.add(E`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${E.int(CR.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
          vec2 tcTap = tc / screenSize;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${E.int(CR.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `)),t}const Tgt=Object.freeze(Object.defineProperty({__proto__:null,build:xgt},Symbol.toStringTag,{value:"Module"}));class D$ extends Lr{initializeProgram(t){const i=D$.shader.get().build(this.configuration);return new Er(t.rctx,i,lr)}initializePipeline(){return ri({colorWrite:xi})}}D$.shader=new Sr(Tgt,()=>import("./SSAO.glsl.046a45de.js"));class $Re{constructor(t,i,r){this._techniqueRep=t,this._rctx=i,this._requestRender=r,this._enabled=!1,this._ssaoTechniqueConfig=new IRe,this.quadVAO=null,this._blurSizePx=2,this._attenuation=.5}dispose(){this.quadVAO=ht(this.quadVAO)}disposeOffscreenBuffers(){wt(this._ssaoFBO,t=>t.resize(0,0)),wt(this._blur0FBO,t=>t.resize(0,0)),wt(this._blur1FBO,t=>t.resize(0,0))}set enabled(t){t?this._enable():this._disable()}get enabled(){return this._enabled}get ready(){return this.enabled&&_(this._noiseTexture)&&_(this._ssaoFBO)&&_(this._blur0FBO)&&_(this._blur1FBO)}get colorTexture(){return _(this._blur1FBO)?this._blur1FBO.colorTexture:null}get width(){return _(this._ssaoFBO)?this._ssaoFBO.width:-1}get height(){return _(this._ssaoFBO)?this._ssaoFBO.height:-1}computeSSAO(t,i,r){if(!this.enabled||M(i)||M(r)||M(this._noiseTexture)||M(this._ssaoFBO)||M(this._blur0FBO)||M(this._blur1FBO))return;const s=this._rctx,n=t.camera,o=n.fullViewport,a=o[2],l=o[3],c=a/this._blurSizePx,h=l/this._blurSizePx;this._ssaoFBO.resize(a,l),this._blur0FBO.resize(c,h),this._blur1FBO.resize(c,h);const p=1,f=1,m=a*p,g=l*f;s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,a,l);const y=s.bindTechnique(this._ssaoTechnique,Ope,t);y.setUniform2f("rnmScale",a/this._noiseTexture.descriptor.width,l/this._noiseTexture.descriptor.height);let x=1/n.computeRenderPixelSizeAtDist(1);y.setUniform1f("projScale",x*p),y.setUniform2f("screenSize",m,g);const b=Pr(n.eye,n.center);let S=20*n.computeRenderPixelSizeAtDist(b);S=Math.max(.1,S),y.setUniform1f("radius",S),y.setUniform1f("intensity",4*this._attenuation/S**6),y.bindTexture("rnm",this._noiseTexture),y.bindTexture("normalMap",r),y.bindTexture("depthMap",i),M(this.quadVAO)&&(this.quadVAO=Yl(this._rctx)),s.bindVAO(this.quadVAO),s.drawArrays(Wt.TRIANGLE_STRIP,0,ka(this.quadVAO,"geometry"));const T=s.bindTechnique(this._blurTechnique,Ope,t);T.bindTexture("tex",this._ssaoFBO.colorTexture),T.bindTexture("normalMap",r),T.bindTexture("depthMap",i),s.setViewport(0,0,m/this._blurSizePx,g/this._blurSizePx),s.bindFramebuffer(this._blur0FBO),T.setUniform2f("screenSize",m,g),T.setUniform2f("blurSize",0,this._blurSizePx*p/g),b>5e4&&(x=Math.max(0,x-(b-5e4))),T.setUniform1f("projScale",x),s.drawArrays(Wt.TRIANGLE_STRIP,0,ka(this.quadVAO,"geometry")),T.setUniform2f("blurSize",this._blurSizePx*f/m,0),s.bindFramebuffer(this._blur1FBO),T.bindTexture("tex",this._blur0FBO.colorTexture),s.drawArrays(Wt.TRIANGLE_STRIP,0,ka(this.quadVAO,"geometry")),s.setViewport(o[0],o[1],o[2],o[3])}_selectPrograms(){this._ssaoTechniqueConfig.output=qb.SSAO,this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(D$,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=qb.Blur,this._blurTechnique=this._techniqueRep.releaseAndAcquire(D$,this._ssaoTechniqueConfig,this._blurTechnique)}_enable(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))}_loadResources(t){this._data?t():import("./SSAOHelperData.08f44d75.js").then(i=>{this._data=i,t()})}_initialize(){const t={target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:gt.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:0,height:0},i={colorTarget:zs.TEXTURE,depthStencilTarget:Yi.NONE};lm(this._data.noiseTexture).then(r=>{this._enabled&&(this._ssaoFBO=new ss(this._rctx,i,t),this._blur0FBO=new ss(this._rctx,i,t),this._blur1FBO=new ss(this._rctx,i,t),this._noiseTexture=new _t(this._rctx,{target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,hasMipmap:!0,width:r.width,height:r.height},r),this._requestRender())}),this._selectPrograms()}_disable(){this._enabled=!1,this._noiseTexture=ht(this._noiseTexture),this._blur1FBO=ht(this._blur1FBO),this._blur0FBO=ht(this._blur0FBO),this._ssaoFBO=ht(this._ssaoFBO)}get gpuMemoryUsage(){return(_(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(_(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(_(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}const Ope=new Nn;function Sgt(){const e=new mr;return e.include(Kb),e.fragment.uniforms.add([new ws("tex"),new Gl("uColor")]),e.fragment.code.add(E`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),e}const Egt=Object.freeze(Object.defineProperty({__proto__:null,build:Sgt},Symbol.toStringTag,{value:"Module"}));class QL extends Lr{initializeProgram(t){const i=QL.shader.get().build();return new Er(t.rctx,i,lr)}initializePipeline(){return this.configuration.hasAlpha?ri({blending:ba(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),colorWrite:xi}):ri({colorWrite:xi})}}QL.shader=new Sr(Egt,()=>import("./TextureOnly.glsl.2b4ff63f.js"));class bre extends Xl{constructor(){super(...arguments),this.hasAlpha=!1}}u([Q()],bre.prototype,"hasAlpha",void 0);class LRe{constructor(t){this._rctx=t,this.cache=new Map}dispose(){this.cache.forEach(t=>t.texture=ht(t.texture)),this.cache.clear()}_acquire(t){if(M(t))return null;const i=this._patternId(t),r=this.cache.get(i);if(r)return r.refCount++,r.bind;const s=t.pixelRatio,{encodedData:n,sdfNormalizer:o,pixels:a,paddedPixels:l}=Cgt(t.pattern,s),c=a/s,h={refCount:1,texture:null,bind:p=>(M(h.texture)&&(h.texture=new _t(this._rctx,{width:l,height:1,internalFormat:Qe.RGBA,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE},n)),p.bindTexture("stipplePatternTexture",h.texture),{pixelSize:c,sdfNormalizer:o,pixels:a})};return this.cache.set(i,h),h.bind}release(t){if(M(t))return;const i=this._patternId(t),r=this.cache.get(i);r&&(r.refCount--,r.refCount===0&&(_(r.texture)&&r.texture.dispose(),this.cache.delete(i)))}swap(t,i){const r=this._acquire(i);return this.release(t),r}_patternId(t){return`${t.pattern.join(",")}-r${t.pixelRatio}`}}function Cgt(e,t){const i=e.map(g=>Math.round(g*t)),r=1/t,s=Math.floor(i.reduce((g,y)=>g+y)),n=i.reduce((g,y)=>Math.max(g,y)),o=(Math.floor(.5*(n-1))+.5)*r,a=[];let l=1;for(const g of i){for(let y=0;y<g;y++){const x=l*(Math.min(y,g-1-y)+.5)*r/o*.5+.5;a.push(x)}l=-l}const c=Math.round(i[0]/2),h=[...a.slice(c),...a.slice(0,c)],p=s+2,f=new Uint8Array(4*p);let m=4;for(const g of h)R$(g,f,m),m+=4;return f.copyWithin(0,m-4,m),f.copyWithin(m,4,8),{encodedData:f,sdfNormalizer:o,paddedPixels:p,pixels:s}}var Ru,Na;(function(e){e[e.Standard=0]="Standard",e[e.TransparentToHUDVisibility=1]="TransparentToHUDVisibility",e[e.Transparency=2]="Transparency",e[e.OverlayWithTransparency=3]="OverlayWithTransparency",e[e.COUNT=4]="COUNT"})(Ru||(Ru={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"}(Na||(Na={}));class dk extends Xl{constructor(){super(...arguments),this.function=Ru.Standard,this.alphaMode=Na.None,this.hasOpacityFactor=!1}}u([Q({count:Ru.COUNT})],dk.prototype,"function",void 0),u([Q({count:Na.COUNT})],dk.prototype,"alphaMode",void 0),u([Q()],dk.prototype,"hasOpacityFactor",void 0);let uf=class extends V6(Ee){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new Nt,this._frameTask=hM,this._drapeSourceRenderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers=new ai,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.worldToPCSRatio=1,this.events=new cs,this.longitudeCyclical=null}get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const t=e.waterTextureRepository;this._stippleTextureRepository=new LRe(e.renderingContext),this._shaderTechniqueRepository=new rRe({rctx:this._rctx,viewingMode:tt.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._renderContext=new gRe(this._rctx,new _re(this._rctx,this.view.state.viewingMode),new $Re(this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([re(()=>t.updating,()=>this.events.emit("content-changed"),fi),re(()=>this.spatialReference,i=>this._localOriginFactory=new vre(i),fi),os(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new sRe(e.textureRepository,this._shaderTechniqueRepository,i=>{(i.renderOccluded&eV)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},()=>this.events.emit("content-changed")),this._bindParameters.slot=$e.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=qCe(this._rctx),this._bindParameters.camera=DT,this._bindParameters.transparencyPassType=Rt.NONE,this._bindParameters.lighting.groundLightingFactor=1,this._bindParameters.lighting.globalFactor=0,this._bindParameters.lighting.set([new yie(Ze(1,1,1))]),this._frameTask=this.view.resourceController.scheduler.registerTask(Ot.STAGE,this),this._handles.add(this._frameTask)}dispose(){this._handles.destroy(),this._drapeSourceRenderers.forEach(e=>e.destroy()),this._drapeSourceRenderers.clear(),this._debugTextureTechnique=br(this._debugTextureTechnique),this._debugPatternTexture=ht(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=ht(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=ht(this._shaderTechniqueRepository),this._temporaryFBO=ht(this._temporaryFBO),this._quadVAO=ht(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||this._frameTask.updating||Mn(this._drapeSourceRenderers,e=>e.updating)}get hasOverlays(){return _(this._overlays)&&_(this._overlayRenderTarget)}get gpuMemoryUsage(){return _(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,pg)}createDrapeSourceRenderer(e,t,i){const r=this._drapeSourceRenderers.get(e);_(r)&&r.destroy();const s=new t(me(F({},i),{rendererContext:this,drapeSource:e}));return this._drapeSourceRenderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(re(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(M(e))return;const t=this._drapeSourceRenderers.get(e);M(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._drapeSourceRenderers.delete(e),this._handles.remove(e),t.destroy())}collectUnusedRenderTargetMemory(e){let t=!1;if(_(this._overlayRenderTarget))for(const i of this._overlayRenderTarget.renderTargets){const r=this.overlays[0].validTargets[i.type]||!this.overlays[1].validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(r,i,e)||t}return t}get overlays(){return Ye(this._overlays,[])}ensureDrapeTargets(e){_(this._overlays)&&this._overlays.forEach(t=>{t.hasTargetWithoutRasterImage=z4(e,i=>i.drapeTargetType===tJ.WithoutRasterImage)})}ensureDrapeSources(e){_(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=z4(e,i=>i.drapeSourceType===s3.Features),t.hasDrapedRasterSource=z4(e,i=>i.drapeSourceType===s3.RasterImage)})}ensureOverlays(e,t){M(this._overlays)&&(this._overlayRenderTarget=new cmt(this._rctx),this._overlays=[new Yde(_s.INNER,this._overlayRenderTarget),new Yde(_s.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=ht(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e,t=()=>!0){this._frameTask.processQueue(e),e.done||this._processDrapeSources(e,t)}_processDrapeSources(e,t){let i=!1;for(const[r,s]of this._drapeSourceRenderers){if(e.done)break;(r.destroyed||t(r))&&s.commitChanges()&&(i=!0,e.madeProgress())}this._updateSortedDrapeSourceRenderers(),i&&(_(this._overlays)&&this._drapeSourceRenderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(bO,e=>e.updatePolicy===gM.SYNC)}isEmpty(){if(dr.OVERLAY_DRAW_DEBUG_TEXTURE)return!1;for(const e of this._drapeSourceRenderers.values())if(!e.isEmpty)return!1;return!0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._drapeSourceRenderers.forEach(i=>t=i.updateAnimation(e)||t),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,t,i){const r=e.canvasGeometries;if(r.numViews===0)return!1;this._screenToWorldRatio=i*e.mapUnitsPerPixel;const s=t.renderPass;if(this.isEmpty()||s===rt.MATERIAL_HIGHLIGHT&&!this.hasHighlights||s===rt.MATERIAL_NORMAL&&!this.hasWater||!e.hasSomeSizedView())return!1;const n=t.fbo;if(!n.isValid())return!1;const o=2*e.resolution,a=e.resolution;n.resize(o,a);const l=this._rctx;DT.pixelRatio=e.pixelRatio*i,this._renderContext.pass=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=s===rt.MATERIAL_NORMAL?$e.DRAPED_WATER:$e.DRAPED_MATERIAL,e.applyViewport(this._rctx),n.bind(l),e.index===_s.INNER&&(l.setClearColor(0,0,0,0),l.clearSafe(wr.COLOR_BUFFER_BIT));const c=t.type===on.ColorNoRasterImage?I1.ExcludeRasterImage:t.type===on.Occluded?I1.OccludedOnly:I1.Normal;if(c===I1.OccludedOnly&&(this._renderContext.renderOccludedMask=eV),dr.OVERLAY_DRAW_DEBUG_TEXTURE&&c!==I1.OccludedOnly)for(let h=0;h<r.numViews;h++)this._setViewParameters(r.extents[h],e,DT),this._drawDebugTexture(e.resolution,Mgt[e.index]);return this._drapeSourceRenderers.size>0&&this._sortedDrapeSourceRenderers.forAll(({drapeSource:h,renderer:p})=>{if(c===I1.ExcludeRasterImage&&h.drapeSourceType===s3.RasterImage)return;const{fullOpacity:f}=h,m=_(f)&&f<1&&s===rt.MATERIAL;m&&(this.bindTemporaryFramebuffer(this._rctx,o,a),l.clearSafe(wr.COLOR_BUFFER_BIT));for(let g=0;g<r.numViews;g++)this._setViewParameters(r.extents[g],e,DT),p.render(this._renderContext,this._bindParameters);m&&_(this._temporaryFBO)&&(n.bind(l),this.view._stage.renderView.compositingHelper.composite(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),Na.PremultipliedAlpha,f,Ru.OverlayWithTransparency,e.index))}),l.bindFramebuffer(null),n.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,i){M(this._temporaryFBO)&&(this._temporaryFBO=new iRe(e,!1)),this._temporaryFBO.resize(t,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,i,r){var n,o;let s=0;for(const a of this._drapeSourceRenderers.values())s=(o=(n=a.intersect)==null?void 0:n.call(a,e,t,i,r,s))!=null?o:s}_updateSortedDrapeSourceRenderers(){if(!this._sortedDrapeSourceRenderersDirty||(this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers.clear(),this._drapeSourceRenderers.size===0))return;const e=this.view.map.allLayers;this._drapeSourceRenderers.forEach((t,i)=>{const r=e.indexOf(i.layer);this._sortedDrapeSourceRenderers.push(new Agt(i,t,r<0?1/0:r))}),this._sortedDrapeSourceRenderers.sort((t,i)=>t.index-i.index)}_setViewParameters(e,t,i){i.viewport[0]=i.viewport[1]=0,i.viewport[2]=i.viewport[3]=t.resolution,GK(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),dB(i.viewMatrix,[-e[0],-e[1],0]),this._bindParameters.camera=i}_updateHasWater(){const e=Mn(this._drapeSourceRenderers,t=>t.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=Mn(this._drapeSourceRenderers,t=>t.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=Mn(this._drapeSourceRenderers,t=>t.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e);const i=this._rctx,r=i.bindTechnique(this._debugTextureTechnique);r.setUniform4f("uColor",t[0],t[1],t[2],1),r.bindTexture("tex",this._debugPatternTexture),i.bindVAO(this._quadVAO),i.drawArrays(Wt.TRIANGLE_STRIP,0,ka(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const i=new Uint8Array(e*t*4);let r=0;for(let n=0;n<t;n++)for(let o=0;o<e;o++){const a=Math.floor(o/10),l=Math.floor(n/10);a<2||l<2||10*a>e-20||10*l>t-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&a&&1&l?1&o^1&n?0:255:1&a^1&l?0:128)}this._debugPatternTexture=new _t(this._rctx,{target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:gt.NEAREST,width:e,height:t},i);const s=new bre;s.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(QL,s),this._quadVAO=Yl(this._rctx)}get test(){return{drapeSourceRenderers:this._drapeSourceRenderers,getDrapeSourceRenderer:e=>this._drapeSourceRenderers.get(e)}}};var I1;u([d()],uf.prototype,"_frameTask",void 0),u([d()],uf.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([Pa()],uf.prototype,"_shaderTechniqueRepository",void 0),u([Pa()],uf.prototype,"_stippleTextureRepository",void 0),u([d({constructOnly:!0})],uf.prototype,"view",void 0),u([d()],uf.prototype,"worldToPCSRatio",void 0),u([d()],uf.prototype,"spatialReference",void 0),u([d({type:Boolean,readOnly:!0})],uf.prototype,"updating",null),uf=u([L("esri.views.3d.terrain.OverlayRenderer")],uf),function(e){e[e.Normal=0]="Normal",e[e.OccludedOnly=1]="OccludedOnly",e[e.ExcludeRasterImage=2]="ExcludeRasterImage"}(I1||(I1={}));class Agt{constructor(t,i,r){this.drapeSource=t,this.renderer=i,this.index=r}}const Mgt=[[1,.5,.5],[.5,.5,1]],DT=new xr;DT.near=1,DT.far=1e4,DT.relativeElevation=null;const wre=-2,eV=rs.OccludeAndTransparent;function Rpe(e){const t=[[P.POSITION,e.indices]],i=[[P.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}]];return _(e.attributeData.color)&&(i.push([P.COLOR,{size:4,data:e.attributeData.color,exclusive:!0}]),t.push([P.COLOR,new Uint32Array(e.indices.length)])),_(e.attributeData.uvMapSpace)&&(i.push([P.UVMAPSPACE,{size:4,data:e.attributeData.uvMapSpace,exclusive:!0}]),t.push([P.UVMAPSPACE,e.indices])),_(e.attributeData.boundingRect)&&(i.push([P.BOUNDINGRECT,{size:9,data:e.attributeData.boundingRect,exclusive:!0}]),t.push([P.BOUNDINGRECT,e.indices])),_(e.attributeData.mapPosition)&&(i.push([P.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([P.MAPPOS,e.indices])),new vs(i,t)}function Ppe(e){const t=[[P.POSITION,e.indices],[P.UV0,e.indices]],i=[[P.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}],[P.UV0,{size:2,data:e.attributeData.uv0,exclusive:!0}]];return _(e.attributeData.mapPosition)&&(i.push([P.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([P.MAPPOS,e.indices])),new vs(i,t)}function N$(e){switch(e.type){case"extent":if(e instanceof yi)return Uo.fromExtent(e);break;case"polygon":return e}return null}function xre(e,t,i,r){const s=ZL(e.rings,e.hasZ,sy.CCW_IS_HOLE),n=new Float64Array(s.position.length),o=are(s.position,e.spatialReference,0,n,0,s.position,0,s.position.length/3,t,i,r),a=o!=null;return{position:s.position,mapPosition:n,polygons:FRe(s.polygons,s.position,n),outlines:NRe(s.outlines,s.position,n),projectionSuccess:a,sampledElevation:o}}function DRe(e,t){const i=ZL(e.rings,!1,sy.CCW_IS_HOLE),r=$r(i.position,e.spatialReference,0,i.position,t,0,i.position.length/3);for(let s=2;s<i.position.length;s+=3)i.position[s]=wre;return{position:i.position,polygons:FRe(i.polygons,i.position),outlines:NRe(i.outlines,i.position),projectionSuccess:r}}function NRe(e,t,i){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=o+3*n;r.push({index:s,count:n,position:t.subarray(o,a),mapPosition:i?i.subarray(o,a):void 0})}return r}function FRe(e,t,i){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of e){if(n<=1)continue;const l=3*s,c=l+3*n,h=o.map(p=>p-s);r.push({index:s,count:n,holeIndices:h,pathLengths:a,position:t.subarray(l,c),mapPosition:i?i.subarray(l,c):void 0})}return r}function kRe(e,t){const i=e.fragment;switch(i.code.add(E`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case Cs.None:i.code.add(E`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Cs.View:i.code.add(E`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Cs.WindingOrder:i.code.add(E`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:t.doubleSidedMode;case Cs.COUNT:}}var Cs;(function(e){e[e.None=0]="None",e[e.View=1]="View",e[e.WindingOrder=2]="WindingOrder",e[e.COUNT=3]="COUNT"})(Cs||(Cs={}));function URe(e){e.vertex.code.add(E`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}function zRe(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add(P.MODELORIGINHI,"vec3"),e.attributes.add(P.MODELORIGINLO,"vec3"),e.attributes.add(P.MODEL,"mat3"),e.attributes.add(P.MODELNORMAL,"mat3"));const i=e.vertex;t.instancedDoublePrecision&&(i.include(Kz,t),i.uniforms.add(new ql("viewOriginHi",(r,s)=>Plt(he(pF,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),pF))),i.uniforms.add(new ql("viewOriginLo",(r,s)=>Ilt(he(pF,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),pF)))),i.code.add(E`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),i.code.add(E`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?E`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),i.code.add(E`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),t.output===oe.Normal&&(i.uniforms.add(new Xr("viewNormal",(r,s)=>s.camera.viewInverseTransposeMatrix)),i.code.add(E`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),t.hasVertexTangents&&i.code.add(E`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}const pF=$();var cn;function VRe(e){switch(e){case"multiply":default:return cn.Multiply;case"ignore":return cn.Ignore;case"replace":return cn.Replace;case"tint":return cn.Tint}}function BRe(e,t,i){if(M(e)||t===cn.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=He(Math.round(e[3]*tV),0,tV),s=r===0||t===cn.Tint?0:t===cn.Replace?Ogt:Rgt;i[0]=He(Math.round(e[0]*Y2),0,Y2),i[1]=He(Math.round(e[1]*Y2),0,Y2),i[2]=He(Math.round(e[2]*Y2),0,Y2),i[3]=r+s}(function(e){e[e.Multiply=1]="Multiply",e[e.Ignore=2]="Ignore",e[e.Replace=3]="Replace",e[e.Tint=4]="Tint"})(cn||(cn={}));const Y2=255,tV=85,Ogt=tV,Rgt=2*tV;function GRe(e){e.vertex.code.add(E`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${E.int(cn.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${E.int(cn.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${E.int(cn.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${E.int(cn.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function jRe(e,t){t.hasSymbolColors?(e.include(GRe),e.attributes.add(P.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(E`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new JL("colorMixMode",i=>tOe[i.colorMixMode])),e.vertex.code.add(E`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function u2(e,t){t.hasVertexColors?(e.attributes.add(P.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(E`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(E`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(E`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function Pgt(e){e.fragment.code.add(E`
    #define discardOrAdjustAlpha(color) { if (color.a < ${E.float(Va)}) { discard; } }
  `)}class HRe extends $s{constructor(t,i){super(t,"float",ar.Draw,(r,s,n)=>r.setUniform1f(t,i(s,n)))}}function tS(e,t){qRe(e,t,new lt("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function Igt(e,t){qRe(e,t,new HRe("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function qRe(e,t,i){const r=e.fragment;switch(t.alphaDiscardMode!==Rr.Mask&&t.alphaDiscardMode!==Rr.MaskBlend||r.uniforms.add(i),t.alphaDiscardMode){case Rr.Blend:return e.include(Pgt);case Rr.Opaque:r.code.add(E`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Rr.Mask:r.code.add(E`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Rr.MaskBlend:e.fragment.code.add(E`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function WRe(e,t){const i=e.vertex.code,r=e.fragment.code,s=t.hasModelTransformation;t.output!==oe.Depth&&t.output!==oe.Shadow||(Kh(e,t),e.include(Ua,{linearDepth:!0,hasModelTransformation:s}),e.include(ev,t),e.include(bA,t),e.include(tw,t),e.include(Qs,t),e.vertex.uniforms.add(new Di("nearFar",(n,o)=>o.camera.nearFar)),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add(new oi("tex",n=>n.texture)),i.add(E`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, ${s?"model,":""} vpos, nearFar, depth);
        forwardTextureCoordinates();
      }
    `),e.include(tS,t),r.add(E`
      void main(void) {
        discardBySlice(vpos);
        ${t.hasColorTexture?E`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `)),t.output===oe.Normal&&(Kh(e,t),e.include(Ua,{linearDepth:!1,hasModelTransformation:s}),e.include(j6,t),e.include(q6,t),e.include(ev,t),e.include(bA,t),t.hasColorTexture&&e.fragment.uniforms.add(new oi("tex",n=>n.texture)),e.varyings.add("vPositionView","vec3"),i.add(E`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${t.normalType===ns.Attribute?E`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(Qs,t),e.include(tS,t),r.add(E`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?E`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${t.normalType===ns.ScreenDerivative?E`
            vec3 normal = screenDerivativeNormal(vPositionView);`:E`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `)),t.output===oe.Highlight&&(Kh(e,t),e.include(Ua,{linearDepth:!1,hasModelTransformation:s}),e.include(ev,t),e.include(bA,t),t.hasColorTexture&&e.fragment.uniforms.add(new oi("tex",n=>n.texture)),i.add(E`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(Qs,t),e.include(tS,t),e.include(Bv),r.add(E`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?E`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))}function ZRe(e,t){const i=e.fragment;if(t.hasVertexTangents?(e.attributes.add(P.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===Cs.WindingOrder?i.code.add(E`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(E`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),i.code.add(E`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),t.textureCoordinateType!==Hn.None){e.include(sie,t);const r=t.supportsTextureAtlas;i.uniforms.add(t.pbrTextureBindType===ar.Pass?ik("normalTexture",s=>s.textureNormal,r):JI("normalTexture",s=>s.textureNormal,r)),i.code.add(E`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?"vtc.size = normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}function KL(e,t){const i=e.fragment;t.receiveAmbientOcclusion?(i.uniforms.add([new oi("ssaoTex",(r,s)=>s.ssaoHelper.colorTexture),new Ei("viewportPixelSz",(r,s)=>_r($gt,s.camera.fullViewport[0],s.camera.fullViewport[1],1/s.ssaoHelper.width,1/s.ssaoHelper.height))]),i.code.add(E`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
return texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}`)):i.code.add(E`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)}const $gt=si();function FS(e,t){const i=e.fragment;e.include(KL,t),t.pbrMode!==Gt.Disabled&&e.include(Z6,t),e.include(cie,t),i.constants.add("ambientBoostFactor","float",xO),e.include(u6),i.code.add(E`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===Gt.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),i.uniforms.add(new Dt("lightingMainDirection",(r,s)=>s.lighting.lightingMainDirection)),i.code.add(E`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?E`normalize(vPosWorld)`:E`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),i.uniforms.add([new lt("lightingGlobalFactor",(r,s)=>s.lighting.globalFactor),new Dt("lightingMainIntensity",(r,s)=>s.lighting.mainLight.intensity)]),i.code.add(E`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`),t.pbrMode===Gt.Disabled||t.pbrMode===Gt.WaterOnIntegratedMesh?(e.include(uie,t),i.code.add(E`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`)):t.pbrMode!==Gt.Normal&&t.pbrMode!==Gt.Schematic||(i.code.add(E`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(E`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?i.uniforms.add(new ES("hasFillLights",(r,s)=>s.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(E`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add([new lt("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new lt("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(E`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(E`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode===Gt.Schematic?E`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:E`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `))}function XRe(e,t){const i=E`
  /*
  *  ${t.name}
  *  ${t.output===oe.Color?"RenderOutput: Color":t.output===oe.Depth?"RenderOutput: Depth":t.output===oe.Shadow?"RenderOutput: Shadow":t.output===oe.Normal?"RenderOutput: Normal":t.output===oe.Highlight?"RenderOutput: Highlight":""}
  */
  `;o$()&&(e.fragment.code.add(i),e.vertex.code.add(i))}function F$(e){e.include(gy),e.code.add(E`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${E.int(cn.Multiply)}) {
        return allMixed;
      }
      if (mode == ${E.int(cn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${E.int(cn.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${E.int(cn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${E.int(cn.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function Lgt(e){const t=new mr,i=t.vertex.code,r=t.fragment.code;t.include(XRe,{name:"Default Material Shader",output:e.output});const s=Kh(t,e);return t.include(H6),t.varyings.add("vpos","vec3"),t.include(bA,e),t.include(zRe,e),t.include(WMe,e),e.output!==oe.Color&&e.output!==oe.Alpha||(ry(t.vertex,e),t.include(j6,e),t.include(Ua,{linearDepth:!1,hasModelTransformation:e.hasModelTransformation}),e.normalType===ns.Attribute&&e.offsetBackfaces&&t.include(URe),t.include(ZRe,e),t.include(q6,e),e.instancedColor&&t.attributes.add(P.INSTANCECOLOR,"vec4"),t.varyings.add("localvpos","vec3"),t.include(ev,e),t.include(YL,e),t.include(jRe,e),t.include(u2,e),t.vertex.uniforms.add(new Ei("externalColor",n=>n.externalColor)),t.varyings.add("vcolorExt","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),e.hasModelTransformation&&t.vertex.uniforms.add(new Xr("model",n=>_(n.modelTransformation)?n.modelTransformation:Xn)),i.add(E`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${E.float(Va)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${e.normalType===ns.Attribute?E`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${e.hasModelTransformation?"model,":""} vpos);
          ${e.normalType===ns.Attribute&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `)),e.output===oe.Alpha&&(t.include(Qs,e),t.include(tS,e),t.include(ld,e),t.fragment.uniforms.add([new lt("opacity",n=>n.opacity),new lt("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&t.fragment.uniforms.add(new oi("tex",n=>n.texture)),t.fragment.include(F$),r.add(E`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?E`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:E`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?E`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:E`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===oe.Color&&(t.include(Qs,e),t.include(FS,e),t.include(KL,e),t.include(tS,e),t.include(e.instancedDoublePrecision?W6:NS,e),t.include(ld,e),ry(t.fragment,e),t.fragment.uniforms.add([s,new Dt("ambient",n=>n.ambient),new Dt("diffuse",n=>n.diffuse),new lt("opacity",n=>n.opacity),new lt("layerOpacity",n=>n.layerOpacity),new lt("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new Dt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",xO),e.hasColorTexture&&t.fragment.uniforms.add(new oi("tex",n=>n.texture)),t.include(lie,e),t.include(Z6,e),t.fragment.include(F$),t.include(kRe,e),r.add(E`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?E`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:E`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${e.normalType===ns.ScreenDerivative?E`
                vec3 normal = screenDerivativeNormal(localvpos);`:E`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${e.pbrMode===Gt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?E`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:E`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.hasNormalTexture?E`
                mat3 tangentSpace = ${e.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:E`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${e.spherical?E`normalize(vpos + localOrigin);`:E`vec3(0.0, 0.0, 1.0);`}

        ${e.snowCover?E`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${e.pbrMode===Gt.Normal||e.pbrMode===Gt.Schematic?E`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?E`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:E`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===Rt.Color?E`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),t.include(WRe,e),t}const Dgt=Object.freeze(Object.defineProperty({__proto__:null,build:Lgt},Symbol.toStringTag,{value:"Module"}));class Ngt extends wRe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Ze(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Ir.Back,this.emissiveFactor=Ze(0,0,0),this.instancedDoublePrecision=!1,this.normals="default",this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ze(.2,.2,.2),this.diffuse=Ze(.8,.8,.8),this.externalColor=zi(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=$(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=ls(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=xS.Less,this.textureAlphaMode=Rr.Blend,this.textureAlphaCutoff=qz,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=rs.Occlude}}class Fgt extends xRe{constructor(){super(...arguments),this.origin=$(),this.slicePlaneLocalOrigin=this.origin}}class eD extends Lr{initializeConfiguration(t,i){i.spherical=t.viewingMode===tt.Global,i.doublePrecisionRequiresObfuscation=XL(t.rctx),i.textureCoordinateType=i.hasColorTexture||i.hasMetalnessAndRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?Hn.Default:Hn.None}initializeProgram(t){return this._initializeProgram(t,eD.shader)}_initializeProgram(t,i){const r=i.get().build(this.configuration);return new Er(t.rctx,r,lr)}_convertDepthTestFunction(t){return t===xS.Lequal?Fr.LEQUAL:Fr.LESS}_setPipeline(t,i){const r=this.configuration,s=t===Rt.NONE,n=t===Rt.FrontFace;return ri({blending:r.output!==oe.Color&&r.output!==oe.Alpha||!r.transparent?null:s?ed:Gv(t),culling:kgt(r)&&c6(r.cullFace),depthTest:{func:ew(t,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:s||n?r.writeDepth&&jc:null,colorWrite:xi,stencilWrite:r.hasOccludees?ny:null,stencilTest:r.hasOccludees?i?Hb:iw:null,polygonOffset:s||n?null:D6(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0),this._setPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}function kgt(e){return e.cullFace!==Ir.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}eD.shader=new Sr(Dgt,()=>import("./DefaultMaterial.glsl.d4ac883a.js"));class _i extends al{constructor(){super(...arguments),this.output=oe.Color,this.alphaDiscardMode=Rr.Opaque,this.doubleSidedMode=Cs.None,this.pbrMode=Gt.Disabled,this.cullFace=Ir.None,this.transparencyPassType=Rt.NONE,this.normalType=ns.Attribute,this.textureCoordinateType=Hn.None,this.customDepthTest=xS.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1}}u([Q({count:oe.COUNT})],_i.prototype,"output",void 0),u([Q({count:Rr.COUNT})],_i.prototype,"alphaDiscardMode",void 0),u([Q({count:Cs.COUNT})],_i.prototype,"doubleSidedMode",void 0),u([Q({count:Gt.COUNT})],_i.prototype,"pbrMode",void 0),u([Q({count:Ir.COUNT})],_i.prototype,"cullFace",void 0),u([Q({count:Rt.COUNT})],_i.prototype,"transparencyPassType",void 0),u([Q({count:ns.COUNT})],_i.prototype,"normalType",void 0),u([Q({count:Hn.COUNT})],_i.prototype,"textureCoordinateType",void 0),u([Q({count:xS.COUNT})],_i.prototype,"customDepthTest",void 0),u([Q()],_i.prototype,"spherical",void 0),u([Q()],_i.prototype,"hasVertexColors",void 0),u([Q()],_i.prototype,"hasSymbolColors",void 0),u([Q()],_i.prototype,"hasVerticalOffset",void 0),u([Q()],_i.prototype,"hasSlicePlane",void 0),u([Q()],_i.prototype,"hasSliceHighlight",void 0),u([Q()],_i.prototype,"hasColorTexture",void 0),u([Q()],_i.prototype,"hasMetalnessAndRoughnessTexture",void 0),u([Q()],_i.prototype,"hasEmissionTexture",void 0),u([Q()],_i.prototype,"hasOcclusionTexture",void 0),u([Q()],_i.prototype,"hasNormalTexture",void 0),u([Q()],_i.prototype,"hasScreenSizePerspective",void 0),u([Q()],_i.prototype,"hasVertexTangents",void 0),u([Q()],_i.prototype,"hasOccludees",void 0),u([Q()],_i.prototype,"hasMultipassTerrain",void 0),u([Q()],_i.prototype,"hasModelTransformation",void 0),u([Q()],_i.prototype,"offsetBackfaces",void 0),u([Q()],_i.prototype,"vvSize",void 0),u([Q()],_i.prototype,"vvColor",void 0),u([Q()],_i.prototype,"receiveShadows",void 0),u([Q()],_i.prototype,"receiveAmbientOcclusion",void 0),u([Q()],_i.prototype,"textureAlphaPremultiplied",void 0),u([Q()],_i.prototype,"instanced",void 0),u([Q()],_i.prototype,"instancedColor",void 0),u([Q()],_i.prototype,"instancedDoublePrecision",void 0),u([Q()],_i.prototype,"doublePrecisionRequiresObfuscation",void 0),u([Q()],_i.prototype,"writeDepth",void 0),u([Q()],_i.prototype,"transparent",void 0),u([Q()],_i.prototype,"enableOffset",void 0),u([Q()],_i.prototype,"cullAboveGround",void 0),u([Q()],_i.prototype,"snowCover",void 0),u([Q({constValue:!0})],_i.prototype,"hasVvInstancing",void 0),u([Q({constValue:!1})],_i.prototype,"useCustomDTRExponentForWater",void 0),u([Q({constValue:!1})],_i.prototype,"supportsTextureAtlas",void 0),u([Q({constValue:!0})],_i.prototype,"useFillLights",void 0);function Ugt(e){const t=new mr,i=t.vertex.code,r=t.fragment.code,s=Kh(t,e);return t.include(H6),t.varyings.add("vpos","vec3"),t.include(bA,e),t.include(zRe,e),t.include(WMe,e),e.output!==oe.Color&&e.output!==oe.Alpha||(ry(t.vertex,e),t.include(j6,e),t.include(Ua),e.offsetBackfaces&&t.include(URe),e.instancedColor&&t.attributes.add(P.INSTANCECOLOR,"vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),t.include(ev,e),t.include(YL,e),t.include(jRe,e),t.include(u2,e),t.vertex.uniforms.add(new Ei("externalColor",n=>n.externalColor)),t.varyings.add("vcolorExt","vec4"),i.add(E`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${E.float(Va)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${e.hasMultipassTerrain?E`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),e.output===oe.Alpha&&(t.include(Qs,e),t.include(tS,e),t.include(ld,e),t.fragment.uniforms.add([new lt("opacity",n=>n.opacity),new lt("layerOpacity",n=>n.layerOpacity),new Ib("view")]),e.hasColorTexture&&t.fragment.uniforms.add(new oi("tex",n=>n.texture)),t.fragment.include(F$),r.add(E`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?E`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?E`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:E`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?E`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:E`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===oe.Color&&(t.include(Qs,e),t.include(FS,e),t.include(KL,e),t.include(tS,e),t.include(e.instancedDoublePrecision?W6:NS,e),t.include(ld,e),ry(t.fragment,e),t.fragment.uniforms.add([s,new Dt("ambient",n=>n.ambient),new Dt("diffuse",n=>n.diffuse),new lt("opacity",n=>n.opacity),new lt("layerOpacity",n=>n.layerOpacity),new Ib("view"),new lt("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new Dt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",xO),e.hasColorTexture&&t.fragment.uniforms.add(new oi("tex",n=>n.texture)),t.include(lie,e),t.include(Z6,e),t.fragment.include(F$),t.extensions.add("GL_OES_standard_derivatives"),r.add(E`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?E`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?E`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:E`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${e.pbrMode===Gt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?E`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:E`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.snowCover?E`albedo = mix(albedo, vec3(1), 0.9);`:E``}
        ${E`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * lightingMainIntensity;`}
        ${e.pbrMode===Gt.Normal||e.pbrMode===Gt.Schematic?e.spherical?E`vec3 normalGround = normalize(vpos + localOrigin);`:E`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:E``}
        ${e.pbrMode===Gt.Normal||e.pbrMode===Gt.Schematic?E`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?E`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:E`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===Rt.Color?E`gl_FragColor = premultiplyAlpha(gl_FragColor);`:E``}
      }
    `)),t.include(WRe,e),t}const zgt=Object.freeze(Object.defineProperty({__proto__:null,build:Ugt},Symbol.toStringTag,{value:"Module"}));class Q6 extends eD{initializeConfiguration(t,i){super.initializeConfiguration(t,i),i.hasMetalnessAndRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=ns.Attribute,i.doubleSidedMode=Cs.WindingOrder,i.hasVertexTangents=!1}initializeProgram(t){return this._initializeProgram(t,Q6.shader)}}Q6.shader=new Sr(zgt,()=>import("./RealisticTree.glsl.0d0a0203.js"));class kS extends vy{constructor(t){super(t,Ggt),this.supportsEdges=!0,this.techniqueConfig=new _i,this.vertexBufferLayout=Hgt(this.parameters),this.instanceBufferLayout=t.instanced?YRe(this.parameters):null}isVisibleInPass(t){return t!==rt.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==rt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==rt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;if(!super.isVisible()||t.layerOpacity===0)return!1;const{instanced:i,hasVertexColors:r,hasSymbolColors:s,vvColorEnabled:n}=t,o=_(i)&&i.includes("color"),a=t.colorMixMode==="replace",l=t.opacity>0,c=t.externalColor&&t.externalColor[3]>0;return r&&(o||n||s)?!!a||l:r?a?c:l:o||n||s?!!a||l:a?c:l}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.hasVertexTangents=this.parameters.hasVertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.hasVerticalOffset=_(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=_(this.parameters.screenSizePerspective),this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasSliceHighlight=this.parameters.hasSliceHighlight,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalType=this.parameters.normals==="screenDerivative"?ns.ScreenDerivative:ns.Attribute,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,_(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest),this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.cullFace=this.parameters.hasSlicePlane?Ir.None:this.parameters.cullFace,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig.hasModelTransformation=_(this.parameters.modelTransformation),t!==oe.Color&&t!==oe.Alpha||(this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this.techniqueConfig.doubleSidedMode=Cs.WindingOrder:this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Cs.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Cs.WindingOrder:Cs.None,this.techniqueConfig.instancedColor=_(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!i.ssaoHelper.ready&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Gt.Schematic:Gt.Normal:Gt.Disabled,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.enableOffset=i.camera.relativeElevation<$6,this.techniqueConfig.snowCover=this.hasSnowCover(i)),this.techniqueConfig}hasSnowCover(t){return _(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}intersect(t,i,r,s,n,o,a){if(_(this.parameters.verticalOffset)){const l=s.camera;he(l7,r[12],r[13],r[14]);let c=null;switch(s.viewingMode){case tt.Global:c=Re(Ipe,l7);break;case tt.Local:c=pe(Ipe,Zgt)}let h=0;const p=xe(Xgt,l7,l.eye),f=Ue(p),m=fe(p,p,1/f);let g=null;this.parameters.screenSizePerspective&&(g=Pe(c,m)),h+=KMe(l,f,this.parameters.verticalOffset,g,this.parameters.screenSizePerspective),fe(c,c,h),Pu(a7,c,s.transform.inverseRotation),n=xe(qgt,n,a7),o=xe(Wgt,o,a7)}M6(t,i,s,n,o,NY(s.verticalOffset),a)}requiresSlot(t){return t===(this.parameters.transparent?this.parameters.writeDepth?$e.TRANSPARENT_MATERIAL:$e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:$e.OPAQUE_MATERIAL)||t===$e.DRAPED_MATERIAL}createGLMaterial(t){return t.output===oe.Color||t.output===oe.Alpha||t.output===oe.Depth||t.output===oe.Normal||t.output===oe.Shadow||t.output===oe.Highlight?new Vgt(t):null}createBufferWriter(){return new jgt(this.vertexBufferLayout,this.instanceBufferLayout)}}class Vgt extends aie{constructor(t){super(F(F({},t),t.material.parameters))}_updateParameters(t){const i=this._material.parameters;this.updateTexture(i.textureId);const r=t.camera.viewInverseTransposeMatrix;return he(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?Q6:eD,t)}_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:t.shadowMap.enabled})}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==oe.Color&&this._output!==oe.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this._updateParameters(t)}}class Bgt extends Ngt{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}}const Ggt=new Bgt;class jgt{constructor(t,i){this.vertexBufferLayout=t,this.instanceBufferLayout=i}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(P.POSITION).length}write(t,i,r,s){R6(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}function Hgt(e){const t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,i=Bs().vec3f(P.POSITION).vec3f(P.NORMAL);return e.hasVertexTangents&&i.vec4f(P.TANGENT),t&&i.vec2f(P.UV0),e.hasVertexColors&&i.vec4u8(P.COLOR),e.hasSymbolColors&&i.vec4u8(P.SYMBOLCOLOR),i}function YRe(e){let t=Bs();return t=e.instancedDoublePrecision?t.vec3f(P.MODELORIGINHI).vec3f(P.MODELORIGINLO).mat3f(P.MODEL).mat3f(P.MODELNORMAL):t.mat4f(P.MODEL).mat4f(P.MODELNORMAL),_(e.instanced)&&e.instanced.includes("color")&&(t=t.vec4f(P.INSTANCECOLOR)),_(e.instanced)&&e.instanced.includes("featureAttribute")&&(t=t.vec4f(P.INSTANCEFEATUREATTRIBUTE)),t}const qgt=$(),Wgt=$(),Zgt=Ze(0,0,1),Ipe=$(),a7=$(),l7=$(),Xgt=$(),Ygt=["polygon","extent"];class Jgt extends by{constructor(t,i,r,s){super(t,i,r,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=N6(this._getSymbolSize());if(a)throw new W("graphics3dextrudesymbollayer:invalid-size",a)}const t=Wr(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t),r=Tc(i),s=i[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?Ir.None:Ir.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new kS(o),this._bottomMaterial=new kS(me(F({},o),{cullFace:Ir.Back})),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Ygt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(i,new ud);return this._createAs3DShape(i,t.renderingInfo,r,s,i.uid)}layerOpacityChanged(t,i){const r=Wr(this.symbolLayer,"material","color"),s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();return t.forEach(a=>{const l=i(a);_(l)&&l.layerOpacityChanged(o,this._context.isAsync)}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,Gb)}slicePlaneEnabledChanged(t,i){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),t.forEach(r=>{const s=i(r);_(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}_getExtrusionSize(t){var r;let i;return i=t.size&&this._drivenProperties.size?(r=Kft(t.size,2))!=null?r:0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(t,i){return this._drivenPropertiesChanged(i)?qn.Recreate_Symbol:qn.Recreate_Graphics}_getSymbolSize(){var t;return(t=this.symbolLayer.size)!=null?t:1}_createAs3DShape(t,i,r,s,n){const o=N$(t.geometry);if(M(o))return null;const a=xre(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);if(this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer"),o.rings.length===0||!o.rings.some(ce=>ce.length>0))return null;const l=nre(o);if(M(l))return null;const c=new Array,h=new Array,p=new Array,f=In(),m=Ne(),g=$(),y=this._context.renderCoordsHelper.viewingMode===tt.Global;y||this._context.renderCoordsHelper.worldUpAtPosition(null,g),nd(o.spatialReference,[l.x,l.y,0],m,this._context.renderCoordsHelper.spatialReference);const x=Ne();Ks(x,m);const b=ls();vM(b,x);const{polygons:S,mapPosition:T,position:C}=a,A=C.length/3,O=new Float64Array(3*A*6),D=new Float64Array(3*A*6),U=new Float64Array(3*A*6),k=new Float64Array(1*A*6);let B=0;for(let ce=0;ce<S.length;++ce){const le=S[ce],z=le.count;if(this._context.clippingExtent&&(Nr(f),qh(f,le.mapPosition),!Nf(f,this._context.clippingExtent)))continue;const q=$M(le.mapPosition,le.holeIndices,3);if(q.length===0)continue;const Z=3*z*2+q.length,Y=new Uint32Array(Z),te=new Uint32Array(q.length),se=6*z,J=3*O.BYTES_PER_ELEMENT,ae=new fn(O.buffer,B*J,J,(B+se)*J),_e=3*D.BYTES_PER_ELEMENT,Oe=new fn(D.buffer,B*_e,_e,(B+se)*_e),Be=new Float64Array(U.buffer,3*B*U.BYTES_PER_ELEMENT,3*se),Se=new Float64Array(k.buffer,1*B*k.BYTES_PER_ELEMENT,1*se),Te=this._getExtrusionSize(i);Qgt(C,T,q,le,ae.typedBuffer,Be,Oe.typedBuffer,Se,0,Y,te,Te,g,y),WL(ae,ae,x),jb(Oe,Oe,b),B+=6*z;const Ie=$pe(Y,Y.length-te.length,{positions:ae.typedBuffer,elevation:Be,normals:Oe.typedBuffer,heights:Se},r);c.push(Ie),h.push(this._material),p.push(Xn);const Ve=$pe(te,0,{positions:ae.typedBuffer,elevation:Be,normals:Oe.typedBuffer,heights:Se},r);c.push(Ve),h.push(this._bottomMaterial),p.push(Xn)}if(c.length===0)return null;const j=new Hv({geometries:c,materials:h,transformations:p,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});j.transformation=m;const H=ZOe(this.symbolLayer,{opacity:this._getLayerOpacity()}),K=_(H)?{baseMaterial:this._material,edgeMaterials:[H],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,ee=new _y(this,j,c,null,null,tyt,s,K);return ee.alignedSampledElevation=a.sampledElevation,ee.needsElevationUpdates=Gb(s.mode),ee}}function $pe(e,t,i,r){const s=new Uint32Array(e.length),n=[[P.POSITION,{size:3,data:i.positions,exclusive:!0}],[P.NORMAL,{size:3,data:i.normals,exclusive:!0}],[P.COLOR,{size:4,data:r,exclusive:!0}],[P.SIZE,{size:1,data:i.heights,exclusive:!0}]],o=[[P.POSITION,e],[P.NORMAL,e],[P.COLOR,s]];return i.elevation&&(n.push([P.MAPPOS,{size:3,data:i.elevation}]),o.push([P.MAPPOS,e])),new vs(n,o,kc.Triangle,t)}function Qgt(e,t,i,r,s,n,o,a,l,c,h,p,f,m){const g=i.length/3;let y=0,x=2*r.count;Kgt(e,t,r.index,r.count,i,0,g,s,n,o,a,l,c,h,x,p,f,m),l+=2*r.count,x=0,Lpe(s,n,a,o,y,r.pathLengths[0],r.count,l,c,x,p),l+=4*r.pathLengths[0],x+=2*r.pathLengths[0],y+=r.pathLengths[0];for(let b=1;b<r.pathLengths.length;++b)Lpe(s,n,a,o,y,r.pathLengths[b],r.count,l,c,x,p),l+=4*r.pathLengths[b],x+=2*r.pathLengths[b],y+=r.pathLengths[b]}function Kgt(e,t,i,r,s,n,o,a,l,c,h,p,f,m,g,y,x,b){pe(ac,x);const S=y>0?1:-1;let T=3*i,C=p,A=3*C,O=p+r,D=3*O;for(let B=0;B<r;++B)b&&(ac[0]=e[T+0],ac[1]=e[T+1],ac[2]=e[T+2],Re(ac,ac)),a[A+0]=e[T+0],a[A+1]=e[T+1],a[A+2]=e[T+2],l[A+0]=t[T+0],l[A+1]=t[T+1],l[A+2]=t[T+2],c[A+0]=-S*ac[0],c[A+1]=-S*ac[1],c[A+2]=-S*ac[2],h[C]=0,a[D+0]=e[T+0]+y*ac[0],a[D+1]=e[T+1]+y*ac[1],a[D+2]=e[T+2]+y*ac[2],l[D+0]=t[T+0],l[D+1]=t[T+1],l[D+2]=t[T+2],c[D+0]=S*ac[0],c[D+1]=S*ac[1],c[D+2]=S*ac[2],h[O]=y,A+=3,D+=3,T+=3,C+=1,O+=1;T=3*n,A=0,D=3*g;const U=y<0?zpe:Upe,k=y<0?Upe:zpe;for(let B=0;B<o;++B)m[A+0]=s[T+U[0]],m[A+1]=s[T+U[1]],m[A+2]=s[T+U[2]],f[D+0]=s[T+k[0]]+r,f[D+1]=s[T+k[1]]+r,f[D+2]=s[T+k[2]]+r,A+=3,D+=3,T+=3}function fF(e,t,i,r,s,n,o){r[n]=r[o],o*=3,e[(n*=3)+0]=e[o+0],e[n+1]=e[o+1],e[n+2]=e[o+2],t[n+0]=t[o+0],t[n+1]=t[o+1],t[n+2]=t[o+2],i[n+0]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const AR=$();function Lpe(e,t,i,r,s,n,o,a,l,c,h){let p=s,f=s+1,m=s+o,g=s+o+1,y=a,x=a+1,b=a+2*n,S=a+2*n+1;h<0&&(p=s+o+1,g=s),c*=3;for(let T=0;T<n;++T)T===n-1&&(h>0?(f=s,g=s+o):(f=s,p=s+o)),eyt(e,p,f,m,AR),fF(e,t,r,i,AR,y,p),fF(e,t,r,i,AR,x,f),fF(e,t,r,i,AR,b,m),fF(e,t,r,i,AR,S,g),l[c++]=y,l[c++]=b,l[c++]=S,l[c++]=y,l[c++]=S,l[c++]=x,p++,f++,m++,g++,y+=2,x+=2,b+=2,S+=2}const c7=$(),Dpe=$(),Npe=$(),Fpe=$(),kpe=$();function eyt(e,t,i,r,s){t*=3,i*=3,r*=3,he(c7,e[t++],e[t++],e[t++]),he(Dpe,e[i++],e[i++],e[i++]),he(Npe,e[r++],e[r++],e[r++]),xe(Fpe,Dpe,c7),xe(kpe,Npe,c7),Tt(s,kpe,Fpe),Re(s,s)}const J2=$();function tyt(e,t,i,r){const s=e.stageObject,n=s.geometryRecords,o=n.length,a=t.mode!=="absolute-height";let l=0;const c=s.transformation,h=Ks(Ne(),c);for(let p=0;p<o;p+=2){const f=n[p].geometry,m=f.getMutableAttribute(P.POSITION).data,g=f.vertexAttributes.get(P.SIZE).data,y=f.vertexAttributes.get(P.MAPPOS).data,x=new vMe(y),b=m.length/3;let S=0,T=!1,C=0;const A=i.spatialReference;for(let O=0;O<b;O++){J2[0]=m[S],J2[1]=m[S+1],J2[2]=m[S+2],Av(x,i,t,r,mF),a&&(C+=mF.sampledElevation),dr.TESTS_DISABLE_OPTIMIZATIONS?(he(Jc,x.array[x.offset+0],x.array[x.offset+1],mF.z+g[S/3]),r.toRenderCoords(Jc,A,Jc),Xe(Jc,Jc,h)):(he(Jc,m[S+0],m[S+1],m[S+2]),Xe(Jc,Jc,c),r.setAltitude(Jc,mF.z+g[S/3]),Xe(Jc,Jc,h)),m[S]=Jc[0],m[S+1]=Jc[1],m[S+2]=Jc[2];const D=iyt/r.unitInMeters;(Math.abs(J2[0]-m[S])>=D||Math.abs(J2[1]-m[S+1])>=D||Math.abs(J2[2]-m[S+2])>=D)&&(T=!0),x.offset+=3,S+=3}T&&(f.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[p]),n[p+1].geometry.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[p+1])),l+=C/b}return l/o}const Jc=$(),ac=$(),mF=new qL,Upe=[0,2,1],zpe=[0,1,2],iyt=.01;function ryt(e,t,i,r,s){const n=e.referencesGeometry()&&s?syt(t,r,s):t,o=e.repurposeFeature(n);try{return e.evaluate(me(F({},i),{$feature:o}))}catch(a){return ve.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const u7=new Map;function syt(e,t,i){const{transform:r,hasZ:s,hasM:n}=i;u7.has(t)||u7.set(t,nyt(t));const o=u7.get(t)(e.geometry,r,s,n);return me(F({},e),{geometry:o})}function nyt(e){const t={};switch(e){case"esriGeometryPoint":return(i,r,s,n)=>OOe(r,t,i,s,n);case"esriGeometryPolygon":return(i,r,s,n)=>ROe(r,t,i,s,n);case"esriGeometryPolyline":return(i,r,s,n)=>POe(r,t,i,s,n);case"esriGeometryMultipoint":return(i,r,s,n)=>MOe(r,t,i,s,n);default:return ve.getLogger("esri.views.2d.support.arcadeOnDemand").error(new W("mapview-arcade",`Unable to handle geometryType: ${e}`)),i=>i}}const W5t=1.2,oyt=Dg,ayt=lp;class K6{constructor(t,i,r,s){this.graphics3DSymbolLayer=t,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(t){this.stage=t}setVisibility(t){if(this.stage!=null&&this._visible!==t){if(this._visible=t,t&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,wi.Geometry.ADD);if(t||this._addedToStage){for(const i of this.renderGeometries)i.instanceParameters.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,wi.State.VISIBILITIES)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,wi.Geometry.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(t=$()){return he(t,0,0,0)}getBoundingBoxObjectSpace(t=In()){return Nr(t)}addObjectState(t,i){t===Tv.Highlight&&(this.renderGeometries.forEach(r=>{const s=r.addHighlight();i.addRenderGeometry(r,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,wi.State.HIGHLIGHTS))}removeObjectState(t){this.renderGeometries.forEach(i=>{t.removeRenderGeometry(i)})}removeRenderGeometryObjectState(t,i){t.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,wi.State.HIGHLIGHTS)}computeAttachmentOrigin(t){for(const i of this.renderGeometries)i.computeAttachmentOrigin(Q2)&&(t.draped.origin[0]+=Q2[0],t.draped.origin[1]+=Q2[1],t.draped.num++)}async getProjectedBoundingBox(t,i,r,s,n){Nr(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,t,Vpe,r),Zze(n,Vpe)}if(i){let o;Df(n,Q2);const a=ore(n,i);try{o=await i.service.queryElevation(Q2[0],Q2[1],s,a,"ground")}catch{}_(o)&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(t,i,r,s){if(this.boundingBox)QV(Mm,this.boundingBox);else{const n=t.boundingSphere,o=n[3];Mm[0]=n[0]-o,Mm[1]=n[1]-o,Mm[2]=n[2]-o,Mm[3]=n[0]+o,Mm[4]=n[1]+o,Mm[5]=n[2]+o}return i(Mm,0,2),this.calculateRelativeScreenBounds&&s.push({location:Df(Mm),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),mK(Mm,r)}}const Vpe=Qt(),Mm=In(),Q2=$();class JRe{constructor(t,i,r,s=2048){this.text=t,this._alignment=i,this._parameters=r,this.maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._displayWidth=null,this._heightMetrics=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${t}`,this._lines=t.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._ensureTextWidth()+2*this.backgroundHorizontalPadding)}get displayHeight(){const t=this.lineSpacing*(this._lines.length-1),i=this.lineHeight;return Math.ceil(t+i+2*this.haloSize+this.backgroundTopPadding+this.backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this.firstLineYOffset+this.baselinePosition)}get firstLineYOffset(){return this.backgroundTopPadding+this.haloSize}get heightMetrics(){return this._ensureHeightMetrics()}get lineSpacing(){return(this.lineHeight+this.linePadding)*this._parameters.definition.lineSpacingFactor}get lineHeight(){return this.heightMetrics.lineHeight}get linePadding(){return this.lineHeight*lyt}get baselinePosition(){return this.heightMetrics.baselinePosition}get renderedFontSize(){return this._toRenderUnit(this.fontSize)}get fontSize(){return this._parameters.definition.size}get renderedHaloSize(){return this._toRenderUnit(this.haloSize)}get haloSize(){return this._parameters.haloSize}get backgroundHorizontalPadding(){return this.hasBackground?this._parameters.definition.background.padding[0]:0}get backgroundVerticalPadding(){return this.hasBackground?this._parameters.definition.background.padding[1]:0}get backgroundTopPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingTop)}get backgroundBottomPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingBottom)}get hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(M(this._renderPixelRatio)){const t=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(t,Math.min(this.maxSize/this.displayWidth,this.maxSize/this.displayHeight)):this._renderPixelRatio=t}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case vb.Left:return this.backgroundHorizontalPadding;case vb.Center:return(this.displayWidth-this._lineWidths[t])/2;case vb.Right:return this.displayWidth-this.backgroundHorizontalPadding-this._lineWidths[t]}}render(t,i=0,r=0){t.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,o=this.haloSize,a=this.firstLineYOffset;i+=o,r+=a+this.baselinePosition;const l=this.haloSize>0;l&&this._renderHalo(t,s,n,o,a),this._setFontProperties(t,this.renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],p=this._getLineXOffset(c);l&&(t.globalCompositeOperation="destination-out",t.fillStyle="rgb(0, 0, 0)",this._fillText(t,h,i+p,r),this._renderLineDecoration(t,i+p,r,this._textWidths[c])),t.globalCompositeOperation="source-over",t.fillStyle=this._parameters.textStyle,this._fillText(t,h,i+this._getLineXOffset(c),r),this._renderLineDecoration(t,i+p,r,this._textWidths[c]),r+=this.lineSpacing}if(dr.TEXT_SHOW_BASELINE){t.strokeStyle=Bpe,t.setLineDash([2,2]),t.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h){const p=c+this.baselinePosition;this._drawLine(t,[s,p],[s+this.displayWidth,p]),c+=this.lineSpacing}}if(dr.TEXT_SHOW_BORDER&&(t.strokeStyle=Bpe,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[s,n],[this.displayWidth,this.displayHeight])),this.hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,s,n,c),t.globalCompositeOperation="destination-over",t.fillStyle=this._parameters.backgroundStyle,t.fill()}t.restore()}_renderLineDecoration(t,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this.baselinePosition}const l=n?this.haloSize:0;t.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(a+2*l),t.beginPath(),t.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),t.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),t.stroke()}_roundedRect(t,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=He(s,0,Math.floor(o/2)),t.beginPath(),t.moveTo(i,r+s),t.arcTo(i,r,i+s,r,s),t.lineTo(i+n-s,r),t.arcTo(i+n,r,i+n,r+s,s),t.lineTo(i+n,r+o-s),t.arcTo(i+n,r+o,i+n-s,r+o,s),t.lineTo(i+s,r+o),t.arcTo(i,r+o,i,r+o-s,s),t.closePath()):t.rect(i,r,n,o)}_renderHalo(t,i,r,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=pk(h7,Math.max(o,K2),Math.max(a,K2)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this.renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this.renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let p=n+this.baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,p,this._textWidths[f],!0),p+=this.lineSpacing}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),t.globalAlpha=1}_renderHaloEmulated(t,i,r){r+=this.baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of QRe)this._fillText(t,n,i+o+this.haloSize*a,r+this.haloSize*l);r+=this.lineSpacing}}_renderHaloNative(t,i,r){const s=2*this.haloSize;r+=this.baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const p=1-(l-1)*c+h*c;t.lineWidth=this._toRenderUnit(p*s),this._strokeText(t,o,i+a,r)}r+=this.lineSpacing}}_setFontProperties(t,i){t.font=this._parameters.fontString(i),t.textAlign="left",t.textBaseline="alphabetic"}_ensureTextWidth(){if(_(this._displayWidth))return this._displayWidth;const t=pk(h7,K2,K2).getContext("2d");this._setFontProperties(t,this.fontSize);let i=2*this.haloSize;const r=this._parameters.definition.font;r.style!=="italic"&&r.style!=="oblique"&&r.weight!=="bold"&&r.weight!=="bolder"||(i+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s=0;for(const n of this._lines){const o=t.measureText(n).width,a=o+i;this._textWidths.push(o),this._lineWidths.push(a),s=Math.max(s,a)}return this._displayWidth=s,this._displayWidth}_ensureHeightMetrics(){if(M(this._heightMetrics)){const t=pk(h7,K2,K2).getContext("2d");this._setFontProperties(t,this.fontSize);const i=t.measureText(this.text+cyt),r=this.hasBackground?t.measureText(this._lines[0]):i,s=this._lines.length===1?r:this.hasBackground?t.measureText(this._lines[this._lines.length-1]):i,n=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent;this._heightMetrics={paddingTop:i.actualBoundingBoxAscent-r.actualBoundingBoxAscent,paddingBottom:i.actualBoundingBoxDescent-s.actualBoundingBoxDescent,lineHeight:n,baselinePosition:i.actualBoundingBoxAscent}}return this._heightMetrics}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,i,r,s){t.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(t,i,r,s){t.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(t,i,r){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),t.stroke()}_drawBox(t,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,p=Math.ceil(n+a)-.5;t.beginPath(),t.moveTo(l,h),t.lineTo(c,h),t.lineTo(c,p),t.lineTo(l,p),t.lineTo(l,h),t.stroke()}}const QRe=[];for(let t=0;t<360;t+=360/16)QRe.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);var vb;function pk(e,t,i){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=i,e.canvas}(function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"})(vb||(vb={}));const h7={canvas:null},lyt=.2,K2=512,Bpe="rgb(255, 0, 255, 0.5)",cyt=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})(),uyt={left:0,center:.5,right:1},fk={"bottom-left":er(0,0),bottom:er(.5,0),"bottom-right":er(1,0),left:er(0,.5),center:er(.5,.5),right:er(1,.5),"top-left":er(0,1),top:er(.5,1),"top-right":er(1,1)};function KRe(e){switch(e){case"left":return vb.Left;case"right":return vb.Right;default:return vb.Center}}function Gpe(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function hyt(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function dyt(e,t){switch(t){case"bottom":return e==="left"?"bottom-left":e==="right"?"bottom-right":"bottom";case"center":return e;case"top":return e==="left"?"top-left":e==="right"?"top-right":"top"}}function pyt(e){return e==="middle"?"center":e}var nl,jpe,iV;function MR(e){return e!=null}function eE(e){return typeof e=="number"}function e8(e){return typeof e=="string"}function fyt(e){return e==null||e8(e)}function jn(e,t){e&&e.push(t)}function myt(e,t,i,r=Ne()){const s=e||0,n=t||0,o=i||0;return s!==0&&QA(r,r,-s/180*Math.PI),n!==0&&JA(r,r,n/180*Math.PI),o!==0&&hB(r,r,o/180*Math.PI),r}function f_(e,t,i,r,s){const n=e.minSize,o=e.maxSize;if(e.expression)return jn(s,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const a=r.symbolSize[i];return t.minSize[i]=a,t.maxSize[i]=a,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=nl.DefinedSize,!0}if(MR(e.field))return MR(e.stops)?e.stops.length===2&&eE(e.stops[0].size)&&eE(e.stops[1].size)?(Hpe(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,i),t.type[i]=nl.DefinedSize,!0):(jn(s,"Could not convert size info: stops only supported with 2 elements"),!1):eE(n)&&eE(o)&&MR(e.minDataValue)&&MR(e.maxDataValue)?(Hpe(n,o,e.minDataValue,e.maxDataValue,t,i),t.type[i]=nl.DefinedSize,!0):aM[e.valueUnit]!=null?(t.minSize[i]=-1/0,t.maxSize[i]=1/0,t.offset[i]=0,t.factor[i]=1/aM[e.valueUnit],t.type[i]=nl.DefinedSize,!0):e.valueUnit==="unknown"?(jn(s,"Could not convert size info: proportional size not supported"),!1):(jn(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!MR(e.field)){if(e.stops&&e.stops[0]&&eE(e.stops[0].size))return t.minSize[i]=e.stops[0].size,t.maxSize[i]=e.stops[0].size,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=nl.DefinedSize,!0;if(eE(n))return t.minSize[i]=n,t.maxSize[i]=n,t.offset[i]=n,t.factor[i]=0,t.type[i]=nl.DefinedSize,!0}return jn(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Hpe(e,t,i,r,s,n){const o=Math.abs(r-i)>0?(t-e)/(r-i):0;s.minSize[n]=o>0?e:t,s.maxSize[n]=o>0?t:e,s.offset[n]=e-i*o,s.factor[n]=o}function gyt(e,t,i,r){if(e.normalizationField||e.valueRepresentation)return jn(r,"Could not convert size info: unsupported property"),null;if(!fyt(e.field))return jn(r,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return jn(r,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[nl.Undefined,nl.Undefined,nl.Undefined]};let s;switch(e.axis){case"width":return s=f_(e,t.size,0,i,r),s?t:null;case"height":return s=f_(e,t.size,2,i,r),s?t:null;case"depth":return s=f_(e,t.size,1,i,r),s?t:null;case"width-and-depth":return s=f_(e,t.size,0,i,r),s&&f_(e,t.size,1,i,r),s?t:null;case null:case void 0:case"all":return s=f_(e,t.size,0,i,r),s=s&&f_(e,t.size,1,i,r),s=s&&f_(e,t.size,2,i,r),s?t:null;default:return jn(r,`Could not convert size info: unknown axis "${e.axis}""`),null}}function yyt(e,t,i){for(let s=0;s<3;++s){let n=t.unitInMeters;e.type[s]===nl.DefinedSize&&(n*=t.modelSize[s],e.type[s]=nl.DefinedScale),e.minSize[s]=e.minSize[s]/n,e.maxSize[s]=e.maxSize[s]/n,e.offset[s]=e.offset[s]/n,e.factor[s]=e.factor[s]/n}let r;if(e.type[0]!==nl.Undefined)r=0;else if(e.type[1]!==nl.Undefined)r=1;else{if(e.type[2]===nl.Undefined)return jn(i,"No size axis contains a valid size or scale"),!1;r=2}for(let s=0;s<3;++s)e.type[s]===nl.Undefined&&(e.minSize[s]=e.minSize[r],e.maxSize[s]=e.maxSize[r],e.offset[s]=e.offset[r],e.factor[s]=e.factor[r],e.type[s]=e.type[r]);return!0}function qpe(e,t,i){e[4*t+0]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function vyt(e,t,i){if(e.normalizationField)return jn(i,"Could not convert color info: unsupported property"),null;if(e8(e.field)){if(!e.stops)return jn(i,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return jn(i,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const r=e.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];t.color.values[s]=n.value,qpe(t.color.colors,s,n.color)}}}else{if(!(e.stops&&e.stops.length>=0))return jn(i,"Could not convert color info: no field and no colors/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.color.values[s]=1/0,qpe(t.color.colors,s,r)}}return t}function _yt(e,t,i){if(e.normalizationField)return jn(i,"Could not convert opacity info: unsupported property"),null;if(e8(e.field)){if(!e.stops)return jn(i,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return jn(i,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const r=e.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];t.opacity.values[s]=n.value,t.opacity.opacityValues[s]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return jn(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.opacity.values[s]=1/0,t.opacity.opacityValues[s]=r}}return t}function d7(e,t,i){const r=i===2&&e.rotationType==="arithmetic";t.offset[i]=r?90:0,t.factor[i]=r?-1:1,t.type[i]=1}function byt(e,t,i){if(!e8(e.field))return jn(i,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return jn(i,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return d7(e,t.rotation,0),t;case"roll":return d7(e,t.rotation,1),t;case null:case void 0:case"heading":return d7(e,t.rotation,2),t;default:return jn(i,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}function ePe(e,t,i){if(!e)return null;const r=!t.supportedTypes||!!t.supportedTypes.size,s=!t.supportedTypes||!!t.supportedTypes.color,n=!t.supportedTypes||!!t.supportedTypes.rotation,o=!!t.supportedTypes&&!!t.supportedTypes.opacity,a=e.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return jn(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return r?gyt(c,l,t,i):l;case"color":return s?vyt(c,l,i):l;case"opacity":return o?_yt(c,l,i):null;case"rotation":return n?byt(c,l,i):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&a)||a.size||a.color||a.opacity||a.rotation?a&&a.size&&!yyt(a.size,t,i)?null:a:null}function Tre(e){return e&&e.size!=null}function k$(e,t){if(!e)return{enabled:!1};if(dr.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const i=ePe(e.visualVariables,t);return i?{enabled:!0,visualVariables:i,materialParameters:tPe(i,t),requiresShaderTransformation:Tre(i)}:{enabled:!1}}function U$(e,t,i){if(!t||!e.enabled)return!1;const r=e.visualVariables,s=ePe(t.visualVariables,i);return!!s&&!!(gF(r.size,s.size,"size")&&gF(r.color,s.color,"color")&&gF(r.rotation,s.rotation,"rotation")&&gF(r.opacity,s.opacity,"opacity"))&&(e.visualVariables=s,e.materialParameters=tPe(s,i),e.requiresShaderTransformation=Tre(s),!0)}function gF(e,t,i){if(!!e!=!!t||e&&e.field!==t.field)return!1;if(e&&i==="rotation"){const r=e,s=t;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}function tPe(e,t){const i={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},r=Tre(e);return e&&e.size?(i.vvSizeEnabled=!0,i.vvSizeMinSize=e.size.minSize,i.vvSizeMaxSize=e.size.maxSize,i.vvSizeOffset=e.size.offset,i.vvSizeFactor=e.size.factor):e&&r&&(i.vvSizeValue=t.transformation.scale),e&&r&&(i.vvSymbolAnchor=t.transformation.anchor,i.vvSymbolRotationMatrix=ls(),Yg(o3),myt(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],o3),Cp(i.vvSymbolRotationMatrix,o3)),e&&e.color&&(i.vvColorEnabled=!0,i.vvColorValues=e.color.values,i.vvColorColors=e.color.colors),e&&e.opacity&&(i.vvOpacityEnabled=!0,i.vvOpacityValues=e.opacity.values,i.vvOpacityOpacities=e.opacity.opacityValues),i}(function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"})(nl||(nl={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(jpe||(jpe={})),function(e){const t=Ne(),i=$();function r(n,o,a){if(!n.vvSizeEnabled)return a;ln(t,a);const l=n.vvSymbolRotationMatrix;hy(o3,l[0],l[1],l[2],0,l[3],l[4],l[5],0,l[6],l[7],l[8],0,0,0,0,1),As(t,t,o3);for(let c=0;c<3;++c){const h=n.vvSizeOffset[c]+o[0]*n.vvSizeFactor[c];i[c]=He(h,n.vvSizeMinSize[c],n.vvSizeMaxSize[c])}return uB(t,t,i),Zl(t,t,n.vvSymbolAnchor),t}function s(n,o,a){if(!o.vvSizeEnabled)return he(n,1,1,1);for(let l=0;l<3;++l){const c=o.vvSizeOffset[l]+a[0]*o.vvSizeFactor[l];n[l]=He(c,o.vvSizeMinSize[l],o.vvSizeMaxSize[l])}return n}e.evaluateModelTransform=r,e.evaluateModelTransformScale=s}(iV||(iV={}));const o3=Ne(),oJ=iV.evaluateModelTransform,wyt=iV.evaluateModelTransformScale;class xyt{constructor(){this.visible=!0}}class FM{constructor(t,i,r={}){this.data=t,this.material=i,this.boundingSphere=si(),this.instanceParameters=new xyt,this._transformation=Ne(),this._shaderTransformationDirty=!0,this.layerUid=Ye(r.layerUid,null),this.graphicUid=Ye(r.graphicUid,null),this.id=r.id?r.id:Dc(),this.boundingInfo=Ye(r.boundingInfo,null),this.calculateShaderTransformation=Ye(r.calculateShaderTransformation,null),this.castShadow=!!r.castShadow&&r.castShadow}get transformation(){return this._transformation}updateTransformation(t){t(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(t,i,r=mS(t)){M(this.boundingInfo)||(Xe(i,this.boundingInfo.getCenter(),t),i[3]=this.boundingInfo.getBSRadius()*r)}get hasShaderTransformation(){return _(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return M(this.calculateShaderTransformation)?Ye(this.transformation,Xn):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Ne()),ln(this._shaderTransformation,this.calculateShaderTransformation(Ye(this.transformation,Xn))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(t){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,t)&&(_(this._transformation)&&Xe(t,t,this._transformation),!0);const i=this.indices.get(P.POSITION),r=this.vertexAttributes.get(P.POSITION);return!!CAe(r,i,t)&&(_(this._transformation)&&Xe(t,t,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const t=new Xz(Tv.Highlight),i=this.instanceParameters;return i.highlights=kY(i.highlights,t),t}removeHighlight(t){const i=this.instanceParameters;i.highlights=UY(i.highlights,t)}}const Tyt=Ne(),Wpe=Ze(0,0,1),Syt=16,Eyt=1.5,NT=tre,Cyt=[NT/2,NT/2,1-NT/2,1-NT/2],Ayt=[P$*NT,P$*NT];class z$ extends by{constructor(t,i,r,s){super(t,i,r,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}async doLoad(t){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(_(r))this._prepareResourcesPrimitive(i,r);else{const s=xTe(this.symbol,this.symbolLayer),n=rB(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(i,JSON.parse(n.data),t):await this._prepareResourcesHref(i,s,t)}}_validateOrThrow(){if(this._drivenProperties.size)return;const t=N6(this._getIconSize());if(t)throw new W("graphics3diconsymbollayer:invalid-size",t)}_getIconSize(){const t=this.symbolLayer,i=Math.round(t.size!=null?$i(t.size):Syt);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(t){const i=this._getGraphicHash(t);let r=i===""?null:this._cimSymbolTextures.get(i);if(!r){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,t,"esriGeometryPoint",s,null,null);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:fb.PAD};r=new En(n.imageData,o),this._cimSymbolTextures.set(i,r),this._context.stage.add(r)}return r}_computeSize(t,i){const r=t.width/t.height;return r>1?[i,Math.round(i/r)]:[Math.round(i*r),i]}_prepareMaterialParameters(){const t={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(Myt(i)){const{screenLength:r,minWorldLength:s,maxWorldLength:n}=i.verticalOffset;t.verticalOffset={screenLength:$i(r),minWorldLength:s||0,maxWorldLength:n!=null?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(t.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),t.occlusionTest=!0,t.hasSlicePlane=this._context.slicePlaneEnabled,t}_prepareResourcesPrimitive(t,i){const r=this._getOutlineSize();if(p7(i)&&r===0)throw new Error("Nothing to render");this._outlineSize=r,t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize;const s=this._context.sharedResources.textures.fromData(i,()=>lOe(i));this._texture=s.texture,this._releaseTexture=s,t.textureIsSignedDistanceField=!0,t.distanceFieldBoundingBox=Cyt,t.textureId=this._texture.id;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/NT,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesHref(t,i,r){if(!ye("esri-canvas-svg-support")&&EK(i))throw new W("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize(),t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,t.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.pixelRatio,o=await Hu(this._context.sharedResources.textures.fromUrl(i,n,{signal:r}));if(o.ok===!1)throw cl(o.error),new W("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.params;this._size=this._computeSize(l,s),t.textureId=a.id,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesCIM(t,i,r){const s=new XS({data:i});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await import("./CIMSymbolRasterizer.7baf0e6e.js")).CIMSymbolRasterizer;qt(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const p=h.scaleExpression,f=await VUe(p,this._context.layer.spatialReference,n);a=(m,g,y)=>{const x=ryt(f,m,{$view:y},"esriGeometryPoint",g);return x!==null?x:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];qt(r);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=t,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||O1e}_getOutlineSize(){let t=0;const i=this.symbolLayer;return _(i.outline)&&i.outline.size!=null?Math.max($i(i.outline.size),0):(t=p7(this._getPrimitive())?Eyt:0,Math.max(t,0))}_getOutlineColor(){const t=this._getLayerOpacity(),i=this.symbolLayer,r=Wr(i,"outline","color");if(_(r)){const s=Le.toUnitRGB(r),n=r.a*t;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(p7(this._getPrimitive()))return oyt;const t=M(this._getPrimitive()),i=Wr(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:t})}_getAnchorPos(t,i){return t==="relative"?er((i.x||0)+.5,.5-(i.y||0)):t in fk?fk[t]:fk.center}_createMaterialAndAddToStage(t,i){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=k$(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(t,this._fastUpdates.materialParameters),this._cimLayers){let r=_(t.textureId)?this._cimSymbolMaterials.get(t.textureId):null;return r||(r=new PM(t),this._cimSymbolMaterials.set(Ye(t.textureId,0),r),i.add(r)),r}return this._material=new PM(t),i.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(t=>{t.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(t=>this._context.stage.remove(t)),this._cimSymbolTextures.clear(),this._releaseTexture=br(this._releaseTexture)}_getScaleFactor(t,i){if(this._drivenProperties.size&&t.size){for(let r=0;r<3;r++){const s=t.size[r];s&&s!=="symbol-value"&&s!=="proportional"&&(t.size[r]=$i(s))}if(t.size[0]==="symbol-value")return 1;if(isFinite(+t.size[0]))return+t.size[0]/i;if(isFinite(+t.size[2]))return+t.size[2]/i}return 1}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry))return null;let r,s;if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(i),f=F({textureId:p.id},this._cimMaterialParametersInfo);s=this._createMaterialAndAddToStage(f,this._context.stage),r=[p.params.width,p.params.height]}else r=this._size,s=this._material;const n=L$(i.geometry);if(M(n))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=t.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const p=r[0]>r[1]?r[0]:r[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=[r[0]*l,r[1]*l],h=this.setGraphicElevationContext(i,new ud);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,n,s,a,c,t.layer.uid):this._createAs3DShape(i,n,s,a,c,h,i.uid)}layerOpacityChanged(){const t=this._getFillColor(),i=this._getOutlineColor();return this._forEachMaterial(r=>{r.setParameters({color:t}),r.setParameters({outlineColor:i})}),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=HL(z$.elevationModeChangeTypes,r,s);if(n!==Is.UPDATE)return n;const o=Op(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(t=>{t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!U$(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return qn.Recreate_Symbol;_(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return qn.Fast_Update}_defaultElevationInfoNoZ(){return Oyt}_createAs3DShape(t,i,r,s,n,o,a){const l=this.getFastUpdateAttrValues(t),c=l?m=>oJ(this._fastUpdates.materialParameters,l,m):null,h=[vu.createPointGeometry(Wpe,null,s,n,Ryt,null,l)],p=fre(this._context,i,h,[r],o,this._context.layer.uid,a,c);if(p===null)return null;const f=new _y(this,p.object,h,null,null,I$,o);return f.alignedSampledElevation=p.sampledElevation,f.needsElevationUpdates=Op(o.mode)||o.mode==="absolute-height",f.getScreenSize=this._createScreenSizeGetter(n,c),f.calculateRelativeScreenBounds=m=>r.calculateRelativeScreenBounds(f.getScreenSize(),1,m),$$(f,i,this._context.elevationProvider),f}_createAsOverlay(t,i,r,s,n,o){r.renderPriority=this._renderPriority;const a=si();Go(i,a,this._context.overlaySR),a[2]=wre;const l=this._context.clippingExtent;if(_(l)&&!fK(l,a))return null;const c=this.getFastUpdateAttrValues(t),h=c?g=>oJ(this._fastUpdates.materialParameters,c,g):null,p=vu.createPointGeometry(Wpe,a,s,n,null,null,c),f=new FM(p,r,{layerUid:o,graphicUid:t.uid,calculateShaderTransformation:h});a[3]=0,Lf(f.boundingSphere,a);const m=new K6(this,[f],null,this._context.drapeSourceRenderer);return m.getScreenSize=this._createScreenSizeGetter(n,h),m.calculateRelativeScreenBounds=g=>r.calculateRelativeScreenBounds(m.getScreenSize(),1,g),m}_createScreenSizeGetter(t,i){const r=this._outlineSize+2;if(this._fastUpdates.enabled){const s=t[0]/this._symbolTextureRatio,n=t[1]/this._symbolTextureRatio;return(o=Ke())=>{const a=i(Tyt);return o[0]=a[0]*s+r,o[1]=a[5]*n+r,o}}{const s=t[0]/this._symbolTextureRatio+r,n=t[1]/this._symbolTextureRatio+r;return(o=Ke())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const t=this._size[0]>this._size[1]?this._size[0]:this._size[1],i=Ze(t,t,t),r=Vc(1),s=t*r;return{modelSize:i,symbolSize:Ze(s,s,s),unitInMeters:r,transformation:{anchor:Hl,scale:Cg,rotation:Hl}}}_getGraphicHash(t){let i="";for(const r of this._cimRequiredFields)i+=r+t.attributes[r];return i}_forEachMaterial(t){_(this._material)&&t(this._material),this._cimSymbolMaterials.forEach(t)}test(){return me(F({},super.test()),{material:this._material})}}function Myt(e){return e&&e.type==="point-3d"&&e.hasVisibleVerticalOffset()}function p7(e){return!M(e)&&(e==="cross"||e==="x")}z$.PRIMITIVE_SIZE=Ayt,z$.elevationModeChangeTypes={definedChanged:Is.UPDATE,staysOnTheGround:Is.NONE,onTheGroundChanged:Is.RECREATE};const Oyt={mode:"relative-to-ground",offset:0},Ryt=zi(0,0,0,1);function aJ(e){const t=[],i=[];$yt(e,i,t);const r=i[0][1].data,s=t[0][1].length,n=new Uint16Array(s);return Lyt(e,i,t),Dyt(e,i,t,n),Fyt(e,i,t,n),Nyt(e,i,t,n),kyt(e,i,t,n),Uyt(e,i,t,n),zyt(e,i,t,r),new vs(i,t,kc.Line)}function Pyt(e,t,i,r){const s=e.type==="polygon"?sy.CCW_IS_HOLE:sy.NONE,n=e.type==="polygon"?e.rings:e.paths,{position:o,outlines:a}=ZL(n,e.hasZ,s),l=new Float64Array(o.length),c=are(o,e.spatialReference,0,l,0,o,0,o.length/3,t,i,r),h=c!=null;return{lines:h?iPe(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function iPe(e,t,i){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=o+3*n;r.push({position:t.subarray(o,a),mapPosition:i?i.subarray(o,a):void 0})}return r}function Iyt(e,t){const i=e.type==="polygon"?sy.CCW_IS_HOLE:sy.NONE,r=e.type==="polygon"?e.rings:e.paths,{position:s,outlines:n}=ZL(r,!1,i),o=$r(s,e.spatialReference,0,s,t,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=wre;return{lines:o?iPe(n,s):[],projectionSuccess:o}}function $yt(e,t,i){const{attributeData:{position:r},removeDuplicateStartEnd:s}=e,n=Vyt(r)&&s===US.REMOVE,o=r.length/3-(n?1:0),a=new Uint32Array(2*(o-1)),l=n?OQ(r,0,r.length-3):r;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;t.push([P.POSITION,{size:3,data:l,exclusive:n}]),i.push([P.POSITION,a])}function Lyt(e,t,i){const r=e.attributeData.mapPosition;M(r)||(i.push([P.MAPPOS,i[0][1]]),t.push([P.MAPPOS,{size:3,data:r}]))}function Dyt(e,t,i,r){if(_(e.attributeData.colorFeature))return;const s=e.attributeData.color;t.push([P.COLOR,{size:4,data:Ye(s,ayt)}]),i.push([P.COLOR,r])}function Nyt(e,t,i,r){const s=e.attributeData.colorFeature;M(s)||(t.push([P.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([P.COLOR,r]))}function Fyt(e,t,i,r){if(_(e.attributeData.sizeFeature))return;const s=e.attributeData.size;t.push([P.SIZE,{size:1,data:[Ye(s,1)]}]),i.push([P.SIZE,r])}function kyt(e,t,i,r){const s=e.attributeData.sizeFeature;M(s)||(t.push([P.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([P.SIZEFEATUREATTRIBUTE,r]))}function Uyt(e,t,i,r){const s=e.attributeData.opacityFeature;M(s)||(t.push([P.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([P.OPACITYFEATUREATTRIBUTE,r]))}function zyt(e,t,i,r){if(M(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==tt.Global||!e.overlayInfo.spatialReference.isGeographic)return;const s=new Float64Array(r.length),n=Ri(e.overlayInfo.spatialReference);for(let f=0;f<s.length;f+=3)qK(r,f,s,f,n);const o=r.length/3,a=new Float32Array(o+1);let l=Byt,c=Gyt,h=0,p=0;he(l,s[p++],s[p++],s[p++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(p=0),he(c,s[p++],s[p++],s[p++]),h+=MCe(l,c),a[f]=h,[l,c]=[c,l];t.push([P.DISTANCETOSTART,{size:1,data:a}]),i.push([P.DISTANCETOSTART,i[0][1]])}function Vyt(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}var US;(function(e){e[e.KEEP=0]="KEEP",e[e.REMOVE=1]="REMOVE"})(US||(US={}));const Byt=$(),Gyt=$();function lJ(e){switch(e){case"butt":return yp.BUTT;case"square":return yp.SQUARE;case"round":return yp.ROUND;default:return null}}const rV=64,rPe=rV/2,sPe=rPe/5;function jyt(e,t){return _(t)?Hyt(e,qyt(t.style)):null}function Hyt(e,t){return e.fromData(t,()=>lOe(t,rV,rPe,sPe))}function qyt(e){return e==="diamond"?"kite":e}function Wyt(e){const t=new mr,i=e.hasMultipassTerrain&&(e.output===oe.Color||e.output===oe.Alpha);t.include(cRe,e),e.output===oe.Depth&&t.include(tw,e);const{vertex:r,fragment:s}=t;return s.include(Zu),Kh(t,e),t.attributes.add(P.POSITION,"vec3"),t.attributes.add(P.UV0,"vec2"),t.attributes.add(P.AUXPOS1,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),t.varyings.add("linearDepth","float"),i&&t.varyings.add("depth","float"),r.code.add(E`#define PERPENDICULAR(v) vec2(v.y, -v.x)
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}`),r.uniforms.add([new Di("nearFar",(n,o)=>o.camera.nearFar),new Ei("viewport",(n,o)=>o.camera.fullViewport)]),r.code.add(E`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),r.code.add(E`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
}`),e.draped||(r.uniforms.add(new Xr("inverseProjectionMatrix",(n,o)=>o.camera.inverseProjectionMatrix)),r.code.add(E`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),r.code.add(E`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),r.uniforms.add(new lt("perScreenPixelRatio",(n,o)=>o.camera.perScreenPixelRatio)),r.code.add(E`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${e.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += PERPENDICULAR(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),r.uniforms.add(new lt("pixelRatio",(n,o)=>o.camera.pixelRatio)),r.code.add(E`
    void main(void) {
      float coverage = 1.0;

      // Check for special value of uv0.y which is used by the Renderer when graphics
      // are removed before the VBO is recompacted. If this is the case, then we just
      // project outside of clip space.
      if (uv0.y == 0.0) {
        // Project out of clip space
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      }
      else {
        float lineSize = getSize();
        float lineWidth = max(lineSize, 1.0) * pixelRatio;

        vec4 pos  = view * vec4(position.xyz, 1.0);
        vec4 prev = view * vec4(auxpos1.xyz, 1.0);
        clip(pos, prev);

        vec4 posScreen = projectAndScale(pos);
        vec4 prevScreen = projectAndScale(prev);

        vec2 segment = posScreen.xy - prevScreen.xy;

        // normalize vector along line segment
        float segmentLen = length(segment);
        segment = (segmentLen > 0.001) ? segment / segmentLen : vec2(0.0, 0.0);

        // displace according to position in the texture
        vec2 displacementDirU = PERPENDICULAR(segment);
        vec2 displacementDirV = segment;

        float displacementLen = ${E.float(rV/sPe)} * lineWidth;

        vec4 displacedPosScreen = posScreen;
        displacedPosScreen.xy += uv0.x * displacementDirU * displacementLen + uv0.y * displacementDirV * displacementLen;
  `),e.draped||r.code.add(E`vec3 posRight = inverseProject(posScreen + vec4(displacementDirU.xy, 0.0, 0.0) * lineWidth);
vec3 posLeft = pos.xyz + (pos.xyz - posRight);
pos = toFront(displacedPosScreen, posLeft, posRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`),r.code.add(E`
        ${i?"depth = pos.z;":""}
        linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1] and cancel out perspective correct interpolation
        vUV = (uv0 + 1.0) / 2.0;
        vUV *= displacedPosScreen.w;

        vSize = displacementLen;

        vColor = getColor();
        vColor.a *= coverage;

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&t.include(ld,e),t.include(Qs,e),s.uniforms.add([new Ei("intrinsicColor",n=>n.color),new oi("tex",n=>n.texture)]),s.include(gy),s.code.add(E`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    // Offset texture coordinate s.t. we sample texel centers
    float texelSize = ${E.float(1/rV)};
    vec2 samplePos = vUV * gl_FragCoord.w + vec2(0.5, -0.5) * texelSize;

    // Evaluate sdf
    float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
    float distance = sdf * vSize;

    // Grow by a halfpixel to make sure the line is fully covered by the cross marker
    // (otherwise there will be a halo if they are different colours)
    distance -= 0.5;

    finalColor.a *= clamp(0.5 - distance, 0.0, 1.0);

    if (finalColor.a < ${E.float(Va)}) {
      discard;
    }

    ${e.output===oe.Alpha?E`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===oe.Color?E`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===oe.Color&&e.transparencyPassType===Rt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===oe.Highlight?E`gl_FragColor = vec4(1.0);`:""}
    ${e.output===oe.Depth?E`outputDepth(linearDepth);`:""}
  }
  `),t}const Zyt=Object.freeze(Object.defineProperty({__proto__:null,build:Wyt},Symbol.toStringTag,{value:"Module"})),nPe=new Map([[P.POSITION,0],[P.UV0,2],[P.AUXPOS1,3],[P.SIZE,6],[P.SIZEFEATUREATTRIBUTE,6],[P.COLOR,5],[P.COLORFEATUREATTRIBUTE,5],[P.OPACITYFEATUREATTRIBUTE,7]]);class t8 extends Lr{initializeProgram(t){const i=t8.shader.get().build(this.configuration);return new Er(t.rctx,i,nPe)}_makePipelineState(t,i){const r=this.configuration,s=t===Rt.NONE;return ri({blending:r.output===oe.Color||r.output===oe.Alpha?s?ed:Gv(t):null,depthTest:{func:ew(t)},depthWrite:s?r.writeDepth&&jc:I6(t),colorWrite:xi,stencilWrite:r.hasOccludees?ny:null,stencilTest:r.hasOccludees?i?Hb:iw:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=ri({blending:ed,depthTest:Qz,depthWrite:null,colorWrite:xi,stencilWrite:null,stencilTest:pRe}),this._occluderPipelineOpaque=ri({blending:ed,depthTest:Qz,depthWrite:null,colorWrite:xi,stencilWrite:hRe,stencilTest:dRe}),this._occluderPipelineMaskWrite=ri({blending:null,depthTest:yre,depthWrite:null,colorWrite:null,stencilWrite:ny,stencilTest:Hb})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:this.configuration.occluder?t===$e.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===$e.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,i)}}t8.shader=new Sr(Zyt,()=>import("./LineMarker.glsl.2e06bf03.js"));class Rl extends al{constructor(){super(...arguments),this.output=oe.Color,this.transparencyPassType=Rt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.draped=!1,this.hasCap=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([Q({count:oe.COUNT})],Rl.prototype,"output",void 0),u([Q({count:Rt.COUNT})],Rl.prototype,"transparencyPassType",void 0),u([Q()],Rl.prototype,"occluder",void 0),u([Q()],Rl.prototype,"hasSlicePlane",void 0),u([Q()],Rl.prototype,"writeDepth",void 0),u([Q()],Rl.prototype,"draped",void 0),u([Q()],Rl.prototype,"hasCap",void 0),u([Q()],Rl.prototype,"vvSize",void 0),u([Q()],Rl.prototype,"vvColor",void 0),u([Q()],Rl.prototype,"vvOpacity",void 0),u([Q()],Rl.prototype,"hasOccludees",void 0),u([Q()],Rl.prototype,"hasMultipassTerrain",void 0),u([Q()],Rl.prototype,"cullAboveGround",void 0),u([Q({constValue:!0})],Rl.prototype,"hasVvInstancing",void 0),u([Q({constValue:!0})],Rl.prototype,"hasSliceTranslatedView",void 0);class Xyt extends vy{constructor(t){super(t,new Jyt),this._vertexAttributeLocations=nPe,this.techniqueConfig=new Rl,this.layout=this.createLayout()}dispose(){}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.draped=i.slot===$e.DRAPED_MATERIAL,this.techniqueConfig.hasCap=this.parameters.cap!==yp.BUTT,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.occluder=this.parameters.renderOccluded===rs.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(){}createLayout(){const t=Bs().vec3f(P.POSITION).vec2f(P.UV0).vec3f(P.AUXPOS1);return this.parameters.vvSizeEnabled?t.f32(P.SIZEFEATUREATTRIBUTE):t.f32(P.SIZE),this.parameters.vvColorEnabled?t.f32(P.COLORFEATUREATTRIBUTE):t.vec4f(P.COLOR),this.parameters.vvOpacityEnabled&&t.f32(P.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new Qyt(this.layout,this.parameters)}requiresSlot(t,i){if(t===$e.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===rs.OccludeAndTransparentStencil)return t===$e.OPAQUE_MATERIAL||t===$e.OCCLUDER_MATERIAL||t===$e.TRANSPARENT_OCCLUDER_MATERIAL;const r=DS(i);return r===oe.Color||r===oe.Alpha?t===(this.parameters.writeDepth?$e.TRANSPARENT_MATERIAL:$e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===$e.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===oe.Color||t.output===oe.Alpha||t.output===oe.Highlight||t.output===oe.Depth?new Yyt(t):null}}class Yyt extends aie{_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(t8,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==oe.Color&&this._output!==oe.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class Jyt extends ire{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=yp.BUTT,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}}class Qyt{constructor(t,i){this.vertexBufferLayout=t,this.parameters=i}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(){return this.parameters.placement==="begin-end"?12:6}write(t,i,r,s){const n=i.vertexAttributes.get(P.POSITION).data,o=n.length/3;let a=1,l=0;this.parameters.vvSizeEnabled?l=i.vertexAttributes.get(P.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(P.SIZE)&&(a=i.vertexAttributes.get(P.SIZE).data[0]);let c=[1,1,1,1],h=0;this.parameters.vvColorEnabled?h=i.vertexAttributes.get(P.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(P.COLOR)&&(c=i.vertexAttributes.get(P.COLOR).data);let p=0;this.parameters.vvOpacityEnabled&&(p=i.vertexAttributes.get(P.OPACITYFEATUREATTRIBUTE).data[0]);const f=t.transformation,m=new Float32Array(r.buffer);let g=s*(this.vertexBufferLayout.stride/4);const y=(T,C,A,O)=>{if(m[g++]=T[0],m[g++]=T[1],m[g++]=T[2],m[g++]=A[0],m[g++]=A[1],m[g++]=C[0],m[g++]=C[1],m[g++]=C[2],this.parameters.vvSizeEnabled?m[g++]=l:m[g++]=a,this.parameters.vvColorEnabled)m[g++]=h;else{const D=Math.min(4*O,c.length-4);m[g++]=c[D+0],m[g++]=c[D+1],m[g++]=c[D+2],m[g++]=c[D+3]}this.parameters.vvOpacityEnabled&&(m[g++]=p)};let x;(function(T){T[T.ASCENDING=1]="ASCENDING",T[T.DESCENDING=-1]="DESCENDING"})(x||(x={}));const b=(T,C)=>{const A=he(Kyt,n[3*T],n[3*T+1],n[3*T+2]),O=e0t;let D=T+C;do he(O,n[3*D],n[3*D+1],n[3*D+2]),D+=C;while(sS(A,O)&&D>=0&&D<o);f&&(Xe(A,A,f),Xe(O,O,f)),y(A,O,[-1,-1],T),y(A,O,[1,-1],T),y(A,O,[1,1],T),y(A,O,[-1,-1],T),y(A,O,[1,1],T),y(A,O,[-1,1],T)},S=this.parameters.placement;S!=="begin"&&S!=="begin-end"||b(0,x.ASCENDING),S!=="end"&&S!=="begin-end"||b(o-1,x.DESCENDING)}}const Kyt=$(),e0t=$(),Ja={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},t0t={dash:Ja.dash,"dash-dot":[...Ja.dash,...Ja.dot],dot:Ja.dot,"long-dash":Ja["long-dash"],"long-dash-dot":[...Ja["long-dash"],...Ja.dot],"long-dash-dot-dot":[...Ja["long-dash"],...Ja.dot,...Ja.dot],none:null,"short-dash":Ja["short-dash"],"short-dash-dot":[...Ja["short-dash"],...Ja["short-dot"]],"short-dash-dot-dot":[...Ja["short-dash"],...Ja["short-dot"],...Ja["short-dot"]],"short-dot":Ja["short-dot"],solid:null},i0t=8;function r0t(e,t=2){return M(e)?e:{pattern:e.slice(),pixelRatio:t}}function Z5t(e,t=2){return{pattern:[e,e],pixelRatio:t}}function oPe(e){return _(e)&&e.type==="style"?s0t(e.style):null}function s0t(e){return _(e)?r0t(t0t[e],i0t):null}const n0t=["polyline","polygon","extent"];class i8 extends by{constructor(t,i,r,s){super(t,i,r,s),this._uniformSize=1}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=k$(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size){const t=this.symbolLayer.size!=null?this.symbolLayer.size:Vc(1);if(t<0)throw new W("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=t}this._markerTexture=jyt(this._context.sharedResources.textures,this.symbolLayer.marker)}_getMaterialParameters(t,i=!1){var n;const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:lJ(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:t,stipplePattern:oPe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?F(F({},s),this._fastUpdates.materialParameters):s}get _materialColor(){return wt(this.symbolLayer.material,t=>t.color)}get _markerColor(){return wt(this.symbolLayer.marker,t=>t.color)}get lineMaterial(){return M(this._lineMaterial)&&(this._lineMaterial=new YC(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}get ringMaterial(){return M(this._ringMaterial)&&(this._ringMaterial=new YC(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}get wireframeLineMaterial(){return M(this._wireframeLineMaterial)&&(this._wireframeLineMaterial=new YC(me(F({},this._getMaterialParameters(!1)),{wireframe:!0})),this._context.stage.add(this._wireframeLineMaterial)),this._wireframeLineMaterial}get wireframeRingMaterial(){return M(this._wireframeRingMaterial)&&(this._wireframeRingMaterial=new YC(me(F({},this._getMaterialParameters(!0)),{wireframe:!0})),this._context.stage.add(this._wireframeRingMaterial)),this._wireframeRingMaterial}get markerMaterial(){return M(this._markerMaterial)&&_(this.symbolLayer.marker)&&_(this._markerTexture)&&(this._markerMaterial=new Xyt(me(F({},this._getMaterialParameters(!1,!0)),{placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id})),this._context.stage.add(this._markerMaterial)),this._markerMaterial}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._lineMaterial=null,this._ringMaterial=null,this._wireframeLineMaterial=null,this._wireframeRingMaterial=null,this._markerMaterial=null,this._markerTexture=br(this._markerTexture)}_getDrivenSize(t){return this._drivenProperties.size&&t.size?$i(emt(t.size)):1}_getSizeFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?rv(this._fastUpdates.visualVariables.size.field,t):null}_getDrivenColor(t){const i=zi(1,1,1,1);return this._drivenProperties.color&&t.color&&(i[0]=t.color[0],i[1]=t.color[1],i[2]=t.color[2],t.color.length>0&&(i[3]=t.color[3])),this._drivenProperties.opacity&&t.opacity&&(i[3]=t.opacity),i}_getColorFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?rv(this._fastUpdates.visualVariables.color.field,t):null}_getOpacityFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?rv(this._fastUpdates.visualVariables.opacity.field,t):null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,n0t,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new ud);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(t,this._context.layer.uid):this._createAs3DShape(t,r,i.uid)}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!U$(this._fastUpdates,i,this._vvConvertOptions))return qn.Recreate_Symbol;this._forEachMaterial(s=>s.setParameters(this._fastUpdates.materialParameters))}return qn.Fast_Update}prepareSymbolLayerPatch(t){var n,o;if(t.diff.type!=="partial")return;const i=t.diff.diff,r={};((n=i.size)==null?void 0:n.type)==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),((o=i.cap)==null?void 0:o.type)==="complete"&&(r.cap=lJ(Ye(i.cap.newValue,"butt")),delete i.cap);const s=this._prepareMarkerPatch(t,i);this._prepareMaterialPatch(t,i,s),t.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(r)))}layerOpacityChanged(){return this._forEachMaterial((t,i)=>this._updateMaterialLayerOpacity(t,i)),!0}_forEachMaterial(t){_(this._lineMaterial)&&t(this._lineMaterial),_(this._ringMaterial)&&t(this._ringMaterial),_(this._wireframeLineMaterial)&&t(this._wireframeLineMaterial),_(this._wireframeRingMaterial)&&t(this._wireframeRingMaterial),_(this._markerMaterial)&&t(this._markerMaterial,!0)}_updateMaterialLayerOpacity(t,i=!1){const r=t.parameters.color,s=Wr(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!i?0:this._getCombinedOpacity(s),o=zi(r[0],r[1],r[2],n);t.setParameters({color:o})}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=HL(i8.elevationModeChangeTypes,r,s);if(n!==Is.UPDATE)return n;const o=Op(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){const t={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i.setParameters(t)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(t){switch(t.type){case"extent":if(t instanceof yi)return Uo.fromExtent(t);break;case"polygon":case"polyline":return t}return null}_createAs3DShape(t,i,r){const s=t.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=new Array,c=new Array,h=In(),p=Pyt(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),f=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,o,f,"LineSymbol3DLayer");for(let y=0;y<p.lines.length;y++){const{position:x,mapPosition:b}=p.lines[y];if(_(this._context.clippingExtent)&&(Nr(h),qh(h,b),!Nf(h,this._context.clippingExtent)))continue;const S=this._createGeometry(t,x,b,n.type,a3.ELEVATED);a.push(S),l.push(n.type==="polygon"?this.ringMaterial:this.lineMaterial),c.push(Xn),dr.LINE_WIREFRAMES&&(a.push(S.cloneShallow()),l.push(n.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial),c.push(Xn));const T=this.markerMaterial;_(T)&&(a.push(S.cloneShallow()),l.push(T),c.push(Xn))}if(a.length===0)return null;const m=new Hv({geometries:a,materials:l,transformations:c,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),g=new _y(this,m,a,null,null,fft,i);return g.alignedSampledElevation=p.sampledElevation,g.needsElevationUpdates=Op(i.mode),g}_createGeometry(t,i,r,s,n){const o=s==="polygon"?US.REMOVE:US.KEEP,a=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,l=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return aJ({overlayInfo:n===a3.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:o,uniformSize:this._uniformSize,attributeData:{position:i,mapPosition:r,size:l?null:this._getDrivenSize(t.renderingInfo),color:a?null:this._getDrivenColor(t.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(t.graphic),colorFeature:this._getColorFeatureAttributeData(t.graphic),opacityFeature:this._getOpacityFeatureAttributeData(t.graphic)}})}_createAsOverlay(t,i){const r=t.graphic,s=this._getGeometryAsPolygonOrPolyline(r.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this.ringMaterial:this.lineMaterial;o.renderPriority=this._renderPriority;const a=dr.LINE_WIREFRAMES?s.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial:null,l=this.markerMaterial;_(a)&&(a.renderPriority=this._renderPriority-.001),_(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=In(),p=Nr(),f=Iyt(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,m,"LineSymbol3DLayer");for(const g of f.lines){if(Nr(h),qh(h,g.position),!Nf(h,this._context.clippingExtent))continue;XA(p,h);const y=this._createGeometry(t,g.position,null,s.type,a3.DRAPED),x=S=>{const T=new FM(y,S,{layerUid:i,graphicUid:r.uid});return c.push(T),T};if(_(l)){const S=x(l),T=this.symbolLayer.marker.placement;T!=="begin"&&T!=="begin-end"||qh(h,g.position,0,1),T!=="end"&&T!=="begin-end"||qh(h,g.position,g.position.length-3,1),this._updateBoundingSphere(S,h)}const b=x(o);if(this._updateBoundingSphere(b,h),dr.LINE_WIREFRAMES){const S=x(a);this._updateBoundingSphere(S,h)}}return new K6(this,c,p,this._context.drapeSourceRenderer)}_updateBoundingSphere(t,i){_r(t.boundingSphere,.5*(i[0]+i[3]),.5*(i[1]+i[4]),0,.5*Math.sqrt((i[3]-i[0])*(i[3]-i[0])+(i[4]-i[1])*(i[4]-i[1])))}get _patternHidesLine(){const t=this.symbolLayer.pattern;return _(t)&&t.type==="style"&&t.style==="none"}_computeMaterialWidth(t){return t=Ye(t,Vc(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?$i(1):1:$i(t)}_prepareMaterialPatch(t,i,r){const s=i.material;if(M(s))return void(r.changed&&r.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterial,t));if(s.type==="collection")return;const n=s.type==="complete"?wt(s.newValue,a=>a.color):s.diff.color.type==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);r.useMaterialColor&&this._patchMaterialColor(gB(o),this._markerMaterial,t),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterial,t),delete i.material}_prepareMarkerPatch(t,i){const r=i.marker;if(M(r)||r.type!=="partial"||_(r.diff.style)||_(r.diff.placement)||_(r.diff.color)&&r.diff.color.type!=="complete")return{changed:!1,useMaterialColor:M(this._markerColor)};const s=r.diff.color;if(M(s))return delete i.marker,{changed:!1,useMaterialColor:M(this._markerColor)};const n=s.newValue;return M(n)?(delete i.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterial,t),delete i.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(t,i,r){M(i)||r.symbolLayerStatePatches.push(()=>i.setParameters({color:t}))}}var a3;i8.elevationModeChangeTypes={definedChanged:Is.RECREATE,staysOnTheGround:Is.NONE,onTheGroundChanged:Is.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(a3||(a3={}));const Zpe=2048,o0t=1.5,a0t=8;function l0t(e,t){const{format:i,quality:r,rotation:s,disableDecorations:n}=e||{},o=Sre(e,t.padding),a=_0t(e,{width:t.width-o.left-o.right,height:t.height-o.top-o.bottom}),{width:l,height:c}=v0t(e,a),h=x0t(i),p=A0t[h];return{format:h,quality:He(r!=null?r:p,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function c0t(e,t){const i=l0t(e,t),r=i.area,s=i.width/r.width,n=Sre(i,t.padding),o=n.left+n.right,a=n.top+n.bottom,l=t.width-o,c=t.height-a,h=Math.floor(l*s+o),p=Math.floor(c*s+a),f=e&&e.layers?e.layers:[],m=i.ignoreBackground,g=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:p,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:f,disableDecorations:i.disableDecorations,ignoreBackground:m,ignorePadding:g}}function u0t(e,t,i){const{ctx:r,canvas:s}=aPe(e,i),n=r.getImageData(0,0,e.width,e.height),o=p0t(s,t);return lPe(s),{dataUrl:o,data:n}}function h0t(e,t){const{ctx:i,canvas:r}=aPe(e,t),s=i.getImageData(0,0,e.width,e.height);return lPe(r),s}function aPe(e,t){const i=d0t();t.premultipliedAlpha&&S0t(e),i.width=e.width,i.height=e.height;const r=i.getContext("2d");return r.putImageData(e,0,0),t.flipY&&T0t(r),{ctx:r,canvas:i}}function lPe(e){e.width=0,e.height=0}function d0t(){return M(f7)&&(f7=document.createElement("canvas")),f7}let f7=null;function p0t(e,t){const i=E0t[t.format],r=t.quality/100;return e.toDataURL(i,r)}function m7(e,t,i){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(sV)try{return new ImageData(e,t)}catch{sV=!1}return cPe(e,t,i)}function f0t(e,t,i,r){if(!t||!i)throw new Error("Cannot construct image data without dimensions");if(sV)try{return new ImageData(e,t,i)}catch{sV=!1}const s=cPe(t,i,r);return s.data.set(e,0),s}function m0t(e,t,i,r=0,s=0,n=e.width-r,o=e.height-s,a=!1){const{data:l}=e,{width:c,height:h,data:p}=t,f=n/c,m=o/h,g=Math.ceil(f/2),y=Math.ceil(m/2),x=e.width;for(let b=0;b<h;b++)for(let S=0;S<c;S++){const T=4*(S+(a?h-b-1:b)*c);let C=0,A=0,O=0,D=0,U=0,k=0;const B=(b+.5)*m;for(let j=Math.floor(b*m);j<(b+1)*m;j++){const H=Math.abs(B-(j+.5))/y,K=(S+.5)*f,ee=H*H;for(let ce=Math.floor(S*f);ce<(S+1)*f;ce++){const le=Math.abs(K-(ce+.5))/g,z=Math.sqrt(ee+le*le);if(z>=1)continue;let q=2*z*z*z-3*z*z+1;const Z=4*(r+ce+(s+j)*x);k+=q*l[Z+3],A+=q,!i&&l[Z+3]<255&&(q=q*l[Z+3]/255),O+=q*l[Z],D+=q*l[Z+1],U+=q*l[Z+2],C+=q}}p[T]=O/C,p[T+1]=D/C,p[T+2]=U/C,p[T+3]=k/A}return t}function g0t(e,t,i){if(!t)return e;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=e,a=Sre(e,i),l=a.left+a.right,c=a.top+a.bottom,h=r-l,p=s-c,f=Math.min(a0t,Math.min((Zpe-l)/h,(Zpe-c)/p));return f<o0t?e:me(F({},e),{framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(p*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:r,height:s}})}function cPe(e,t,i){return i||(i=y0t()),i.getContext("2d").createImageData(e,t)}let OR=null,sV=!0;function y0t(){return OR||(OR=document.createElement("canvas"),OR.width=1,OR.height=1),OR}function v0t(e,t){if(!e)return t;const i=e.width,r=e.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return t;const s=t.width/t.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function _0t(e,t){const i={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){e.area.x!=null&&(i.x=Math.floor(e.area.x)),e.area.y!=null&&(i.y=Math.floor(e.area.y));const r=e.area.width!=null?Math.floor(e.area.width):null,s=e.area.height!=null?Math.floor(e.area.height):null;if(i.width=t.width-i.x,i.height=t.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return b0t(w0t(i,e),t)}function b0t(e,t){const i=Math.floor(Math.max(e.x,0)),r=Math.floor(Math.max(e.y,0)),s={x:i,y:r,width:Math.floor(Math.min(e.width,t.width-i)),height:Math.floor(Math.min(e.height,t.height-r))},n=s.width/s.height,o=e.width/e.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function w0t(e,t){if(!t||t.width==null||t.height==null)return e;const i=t.width/t.height,r=e.width/e.height;if(r===i)return e;if(r<i){const n=Math.floor(e.height*i);return e.x-=(n-e.width)/2,e.width=n,e}const s=Math.floor(e.width/i);return e.y-=(s-e.height)/2,e.height=s,e}function Sre(e,t){return!t||e&&e.ignorePadding?M0t:t}function x0t(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return C0t}}function T0t(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}function S0t(e){const t=e.data,i=t.length;for(let r=0;r<i;r+=4){const s=t[r+3];if(s!==255&&s>0){const n=255/s;t[r+0]=t[r+0]*n,t[r+1]=t[r+1]*n,t[r+2]=t[r+2]*n}}}const E0t={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Xpe=98,C0t="png",A0t={png:100,jpg:Xpe,jpeg:Xpe},M0t={top:0,right:0,bottom:0,left:0};var pC;const g7=new WeakMap;let O0t=0,Km=pC=class extends Ce{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,i,r){if(e instanceof HTMLImageElement){const s={type:"image-element",src:mv(e.src,r),crossOrigin:e.crossOrigin};t[i]=s}else if(e instanceof HTMLCanvasElement){const s=e.getContext("2d").getImageData(0,0,e.width,e.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};t[i]=n}else if(e instanceof HTMLVideoElement){const s={type:"video-element",src:mv(e.src,r),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[i]=s}else{const s={type:"image-data",imageData:this._encodeImageData(e)};t[i]=s}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this._decodeImageData(e.imageData),i=document.createElement("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").putImageData(t,0,0),i}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){const i=t.substr(t.length-4,4).toLowerCase(),r=t.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(e){e!=null?this._override("transparent",e):this._clearOverride("transparent")}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(i="")=>`d:${i},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(g7.has(this.data)||g7.set(this.data,++O0t),t(g7.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new pC(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const i=this.clone();return e.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let t="";for(let i=0;i<e.data.length;i++)t+=String.fromCharCode(e.data[i]);return{data:btoa(t),width:e.width,height:e.height}}_decodeImageData(e){const t=atob(e.data),i=new Uint8ClampedArray(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return f0t(i,e.width,e.height)}_imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}static from(e){return typeof e=="string"?new pC({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new pC({data:e}):xb(pC,e)}};u([d({type:String,json:{write:Ab}})],Km.prototype,"url",null),u([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],Km.prototype,"data",null),u([it("data")],Km.prototype,"writeData",null),u([De("data")],Km.prototype,"readData",null),u([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Km.prototype,"transparent",null),u([d({json:{write:!0}})],Km.prototype,"wrap",void 0),u([d({readOnly:!0})],Km.prototype,"contentHash",null),Km=pC=u([L("esri.geometry.support.MeshTexture")],Km);const l3=Km;var cJ;let a0=cJ=class extends Ce{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=_(e)?e.get(this):null;if(i)return i;const r=new cJ(this.clonePropertiesWithDeduplication(t));return _(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return{color:_(this.color)?this.color.clone():null,colorTexture:_(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:_(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};u([d({type:Le,json:{write:!0}})],a0.prototype,"color",void 0),u([d({type:l3,json:{write:!0}})],a0.prototype,"colorTexture",void 0),u([d({type:l3,json:{write:!0}})],a0.prototype,"normalTexture",void 0),u([d({nonNullable:!0,json:{write:!0}})],a0.prototype,"alphaMode",void 0),u([d({nonNullable:!0,json:{write:!0}})],a0.prototype,"alphaCutoff",void 0),u([d({nonNullable:!0,json:{write:!0}})],a0.prototype,"doubleSided",void 0),a0=cJ=u([L("esri.geometry.support.MeshMaterial")],a0);const Ere=a0;var uJ;let l0=uJ=class extends Ere{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=_(e)?e.get(this):null;if(i)return i;const r=new uJ(this.clonePropertiesWithDeduplication(t));return _(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return me(F({},super.clonePropertiesWithDeduplication(e)),{emissiveColor:_(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:_(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:_(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:_(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null})}};u([d({type:Le,json:{write:!0}})],l0.prototype,"emissiveColor",void 0),u([d({type:l3,json:{write:!0}})],l0.prototype,"emissiveTexture",void 0),u([d({type:l3,json:{write:!0}})],l0.prototype,"occlusionTexture",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],l0.prototype,"metallic",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],l0.prototype,"roughness",void 0),u([d({type:l3,json:{write:!0}})],l0.prototype,"metallicRoughnessTexture",void 0),l0=uJ=u([L("esri.geometry.support.MeshMaterialMetallicRoughness")],l0);const uPe=l0;var mk;const tE=ve.getLogger("esri.geometry.support.MeshVertexAttributes");let yd=mk=class extends Ce{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return fC(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},tE)}castPosition(e){return e&&e instanceof Float32Array&&tE.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),fC(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},tE)}castUv(e){return fC(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},tE)}castNormal(e){return fC(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},tE)}castTangent(e){return fC(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},tE)}clone(){const e={position:ue(this.position),uv:ue(this.uv),normal:ue(this.normal),tangent:ue(this.tangent),color:ue(this.color)};return new mk(e)}clonePositional(){const e={position:ue(this.position),normal:ue(this.normal),tangent:ue(this.tangent),uv:this.uv,color:this.color};return new mk(e)}};function y7(e,t,i,r){const{loggerTag:s,stride:n}=t;return e.length%n!=0?(r.error(s,`Invalid array length, expected a multiple of ${n}`),new i([])):e}function fC(e,t,i,r,s){if(!e)return e;if(e instanceof t)return y7(e,r,t,s);for(const n of i)if(e instanceof n)return y7(new t(e),r,t,s);if(Array.isArray(e))return y7(new t(e),r,t,s);{const n=i.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${e.constructor.name}`),new t([])}}function RR(e,t,i){t[i]=R0t(e)}function R0t(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}u([d({json:{write:RR}})],yd.prototype,"color",void 0),u([Jt("color")],yd.prototype,"castColor",null),u([d({nonNullable:!0,json:{write:RR}})],yd.prototype,"position",void 0),u([Jt("position")],yd.prototype,"castPosition",null),u([d({json:{write:RR}})],yd.prototype,"uv",void 0),u([Jt("uv")],yd.prototype,"castUv",null),u([d({json:{write:RR}})],yd.prototype,"normal",void 0),u([Jt("normal")],yd.prototype,"castNormal",null),u([d({json:{write:RR}})],yd.prototype,"tangent",void 0),u([Jt("tangent")],yd.prototype,"castTangent",null),yd=mk=u([L("esri.geometry.support.MeshVertexAttributes")],yd);var uI;const P0t=ve.getLogger("esri.geometry.support.MeshComponent");let c0=uI=class extends Ce{constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(e){return xb(uI,e)}castFaces(e){return fC(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},P0t)}castMaterial(e){return xb(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?uPe:Ere,e)}clone(){return new uI({faces:ue(this.faces),shading:this.shading,material:ue(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const i={faces:ue(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new uI(i)}};u([d({json:{write:!0}})],c0.prototype,"faces",void 0),u([Jt("faces")],c0.prototype,"castFaces",null),u([d({type:Ere,json:{write:!0}})],c0.prototype,"material",void 0),u([Jt("material")],c0.prototype,"castMaterial",null),u([d({type:String,json:{write:!0}})],c0.prototype,"shading",void 0),u([d({type:Boolean})],c0.prototype,"trustSourceNormals",void 0),c0=uI=u([L("esri.geometry.support.MeshComponent")],c0);const I0t=c0,r8=ve.getLogger("esri.geometry.support.meshUtils.normalProjection");function $0t(e,t,i,r,s){return n8(r)?(s8(sv.TO_PCPF,fr.fromTypedArray(e),fn.fromTypedArray(t),fn.fromTypedArray(i),r,fr.fromTypedArray(s)),s):(r8.error("Cannot convert spatial reference to PCPF"),s)}function X5t(e,t,i,r,s){return n8(r)?(s8(sv.FROM_PCPF,fr.fromTypedArray(e),fn.fromTypedArray(t),fn.fromTypedArray(i),r,fr.fromTypedArray(s)),s):(r8.error("Cannot convert to spatial reference from PCPF"),s)}function Y5t(e,t,i){return $r(e,t,0,i,Xg(t),0,e.length/3),i}function J5t(e,t,i){return $r(e,Xg(i),0,t,i,0,e.length/3),t}function L0t(e,t,i){if(M(e))return t;const r=fn.fromTypedArray(e),s=fn.fromTypedArray(t);return WL(s,r,i),t}function D0t(e,t,i){if(M(e))return t;vM(Co,i);const r=fr.fromTypedArray(e),s=fr.fromTypedArray(t);return jb(s,r,Co),mie(Co)||mre(s,s),t}function N0t(e,t,i){if(M(e))return t;vM(Co,i);const r=fr.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),s=fr.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(jb(s,r,Co),mie(Co)||mre(s,s),e!==t)for(let n=3;n<e.length;n+=4)t[n]=e[n];return t}function F0t(e,t,i,r,s){if(!n8(r))return r8.error("Cannot convert spatial reference to PCPF"),s;s8(sv.TO_PCPF,fr.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),fn.fromTypedArray(t),fn.fromTypedArray(i),r,fr.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function Q5t(e,t,i,r,s){if(!n8(r))return r8.error("Cannot convert to spatial reference from PCPF"),s;s8(sv.FROM_PCPF,fr.fromTypedArray(e,16),fn.fromTypedArray(t),fn.fromTypedArray(i),r,fr.fromTypedArray(s,16));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function s8(e,t,i,r,s,n){if(!t)return;const o=i.count,a=Xg(s);if(hPe(s))for(let l=0;l<o;l++)r.getVec(l,yF),t.getVec(l,Om),nd(a,yF,vF,a),Cp(Co,vF),e===sv.FROM_PCPF&&Ap(Co,Co),Pu(Om,Om,Co),n.setVec(l,Om);else for(let l=0;l<o;l++){r.getVec(l,yF),t.getVec(l,Om),nd(a,yF,vF,a),Cp(Co,vF);const c=dU(i.get(l,1));let h=Math.cos(c);e===sv.TO_PCPF&&(h=1/h),Co[0]*=h,Co[1]*=h,Co[2]*=h,Co[3]*=h,Co[4]*=h,Co[5]*=h,e===sv.FROM_PCPF&&Ap(Co,Co),Pu(Om,Om,Co),Re(Om,Om),n.setVec(l,Om)}return n}function n8(e){return hPe(e)||k0t(e)}function hPe(e){return e.isWGS84||Qve(e)||ay(e)||ly(e)}function k0t(e){return e.isWebMercator}var sv;(function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"})(sv||(sv={}));const yF=$(),Om=$(),vF=Ne(),Co=ls();function U0t(e){const t=new mr;t.include(Ua),t.include(u2,e),t.include(uRe,e),Kh(t,e);const{vertex:i,fragment:r}=t;return e.stippleEnabled&&(t.attributes.add(P.UV0,"vec2"),t.attributes.add(P.AUXPOS1,"vec3"),i.uniforms.add(new Ei("viewport",(s,n)=>n.camera.fullViewport))),t.attributes.add(P.POSITION,"vec3"),t.varyings.add("vpos","vec3"),i.code.add(E`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(i.code.add(E`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped?i.uniforms.add(new lt("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):i.code.add(E`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(E`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?i.code.add(E`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):i.code.add(E`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.code.add(E`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),i.code.add(E`}`),e.output===oe.Highlight&&t.include(Bv),t.include(Qs,e),r.uniforms.add(new lt("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),e.hasVertexColors||r.uniforms.add(new Ei("constantColor",s=>s.color)),r.code.add(E`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${E.float(Va)}) {
      discard;
    }

    ${e.output===oe.Color?E`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===oe.Highlight?E`outputHighlight();`:""}
  }
  `),t}const z0t=Object.freeze(Object.defineProperty({__proto__:null,build:U0t},Symbol.toStringTag,{value:"Module"}));class o8 extends Lr{constructor(t,i,r){super(t,i,r),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=t.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==oe.Highlight}initializeProgram(t){const i=o8.shader.get().build(this.configuration);return new Er(t.rctx,i,lr)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,i){if(this.program.bindPass(t,i),this.stipplePattern!==t.stipplePattern){const r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.stippleEnabled){const{pixelSize:r,sdfNormalizer:s,pixels:n}=_(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",s),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",r),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r)}}initializePipeline(){const t=this.configuration,i=ba(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),r=(s,n=null,o=null)=>ri({blending:n,depthTest:yre,depthWrite:o,colorWrite:xi,stencilWrite:t.hasOccludees?ny:null,stencilTest:t.hasOccludees?s?Hb:iw:null});return t.output===oe.Color?(this._occludeePipelineState=r(!0,t.transparent||this.stippleEnabled?i:null,jc),r(!1,t.transparent||this.stippleEnabled?i:null,jc)):r(!1)}get primitiveType(){return Wt.LINES}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}o8.shader=new Sr(z0t,()=>import("./NativeLine.glsl.0e25c958.js"));class ph extends al{constructor(){super(...arguments),this.output=oe.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}u([Q({count:oe.COUNT})],ph.prototype,"output",void 0),u([Q()],ph.prototype,"hasSlicePlane",void 0),u([Q()],ph.prototype,"hasVertexColors",void 0),u([Q()],ph.prototype,"transparent",void 0),u([Q()],ph.prototype,"draped",void 0),u([Q()],ph.prototype,"stippleEnabled",void 0),u([Q()],ph.prototype,"stippleOffColorEnabled",void 0),u([Q()],ph.prototype,"stipplePreferContinuous",void 0),u([Q()],ph.prototype,"hasOccludees",void 0),u([Q({constValue:!1})],ph.prototype,"stippleRequiresClamp",void 0),u([Q({constValue:!1})],ph.prototype,"stippleScaleWithLineWidth",void 0),u([Q({constValue:!1})],ph.prototype,"stippleRequiresStretchMeasure",void 0);const V0t=ve.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var nV;(function(e){e[e.START=0]="START",e[e.END=1]="END"})(nV||(nV={}));class Ype extends vy{constructor(t){super(t,new j0t),this._techniqueConfig=new ph}getConfiguration(t,i){this._techniqueConfig.output=t,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=i.slot===$e.DRAPED_MATERIAL;const r=_(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=r,this._techniqueConfig.stippleOffColorEnabled=r&&_(this.parameters.stippleOffColor),this._techniqueConfig.hasOccludees=this.parameters.hasOccludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){_(c)?ndt(t,s,c,o,1,a):this._intersectLineGeometry(t,i,r,s,a)}_intersectLineGeometry(t,i,r,s,n){if(!s.options.selectionMode||FL(i))return;if(!SAe(r))return void V0t.error("intersection assumes a translation-only matrix");const o=t.vertexAttributes.get(P.POSITION).data,a=s.camera,l=q0t;po(l,s.point);const c=2;he(PR[0],l[0]-c,l[1]+c,0),he(PR[1],l[0]+c,l[1]+c,0),he(PR[2],l[0]+c,l[1]-c,0),he(PR[3],l[0]-c,l[1]-c,0);for(let g=0;g<4;g++)if(!a.unprojectFromRenderScreen(PR[g],Dy[g]))return;sl(a.eye,Dy[0],Dy[1],v7),sl(a.eye,Dy[1],Dy[2],_7),sl(a.eye,Dy[2],Dy[3],b7),sl(a.eye,Dy[3],Dy[0],w7);let h=Number.MAX_VALUE,p=0;for(let g=0;g<o.length-5;g+=3){if(Pl[0]=o[g]+r[12],Pl[1]=o[g+1]+r[13],Pl[2]=o[g+2]+r[14],Il[0]=o[g+3]+r[12],Il[1]=o[g+4]+r[13],Il[2]=o[g+5]+r[14],Or(v7,Pl)<0&&Or(v7,Il)<0||Or(_7,Pl)<0&&Or(_7,Il)<0||Or(b7,Pl)<0&&Or(b7,Il)<0||Or(w7,Pl)<0&&Or(w7,Il)<0)continue;if(a.projectToRenderScreen(Pl,Ow),a.projectToRenderScreen(Il,Rw),Ow[2]<0&&Rw[2]>0){xe(Rm,Pl,Il);const x=a.frustum,b=-Or(x[Mr.NEAR],Pl)/Pe(Rm,x[Mr.NEAR]);fe(Rm,Rm,b),we(Pl,Pl,Rm),a.projectToRenderScreen(Pl,Ow)}else if(Ow[2]>0&&Rw[2]<0){xe(Rm,Il,Pl);const x=a.frustum,b=-Or(x[Mr.NEAR],Il)/Pe(Rm,x[Mr.NEAR]);fe(Rm,Rm,b),we(Il,Il,Rm),a.projectToRenderScreen(Il,Rw)}else if(Ow[2]<0&&Rw[2]<0)continue;Ow[2]=0,Rw[2]=0;const y=tee(XT(Ow,Rw,Kpe),l);y<h&&(h=y,pe(Jpe,Pl),pe(Qpe,Il),p=g/3)}const f=s.rayBegin,m=s.rayEnd;if(h<c*c){let g=Number.MAX_VALUE;if(wwe(XT(Jpe,Qpe,Kpe),XT(f,m,H0t),Mw)){xe(Mw,Mw,f);const y=Ue(Mw);fe(Mw,Mw,1/y),g=y/Pr(f,m)}n(g,Mw,p,!1)}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return!1;const s=r.get(P.POSITION);return xie(s,null,!1,i)}requiresSlot(t){return t===$e.OPAQUE_MATERIAL||t===$e.DRAPED_MATERIAL}createGLMaterial(t){return t.output===oe.Color||t.output===oe.Highlight?new B0t(t):null}createBufferWriter(){const t=this.parameters.hasVertexColors?ARe:egt;return M(this.parameters.stipplePattern)?new Y6(t):new G0t(t.clone().vec3f(P.AUXPOS1).vec2f(P.UV0))}}class B0t extends Qb{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output===oe.Color&&this._updateOccludeeState(t),this.ensureTechnique(o8,t)}}class G0t{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(P.POSITION).length}write(t,i,r,s){R6(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s),this._writeAuxpos1(t,i,r,s),this._writeUV0(t,i,r,s)}_writeAuxpos1(t,i,r,s){const n=r.getField(P.AUXPOS1,fr),o=i.indices.get(P.POSITION),a=i.vertexAttributes.get(P.POSITION).data,l=t.transformation,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let p=0;p<o.length-1;p+=2)for(const f of[1,0]){const m=3*o[p+f],g=a[m],y=a[m+1],x=a[m+2],b=l[0]*g+l[4]*y+l[8]*x+l[12],S=l[1]*g+l[5]*y+l[9]*x+l[13],T=l[2]*g+l[6]*y+l[10]*x+l[14];h[s]=b,h[s+1]=S,h[s+2]=T,s+=c}}_writeUV0(t,i,r,s){var C;const n=r.getField(P.UV0,Mp),o=i.indices.get(P.POSITION),a=i.vertexAttributes.get(P.POSITION).data,l=(C=i.vertexAttributes.get(P.DISTANCETOSTART))==null?void 0:C.data,c=t.transformation,h=n.typedBufferStride,p=n.typedBuffer;let f=0;p[s*=h]=nV.START,p[s+1]=f,s+=h;const m=3*o[0],g=he(Pl,a[m],a[m+1],a[m+2]);c&&Xe(g,g,c);const y=Il,x=o.length-1;let b=1;const S=l?(A,O,D)=>f=l[D]:(A,O,D)=>f+=Pr(A,O);for(let A=1;A<x;A+=2){const O=3*o[A];he(y,a[O],a[O+1],a[O+2]),c&&Xe(y,y,c),S(g,y,b++);for(let D=0;D<2;++D)p[s]=1-D,p[s+1]=f,s+=h;pe(g,y)}const T=3*o[x];he(y,a[T],a[T+1],a[T+2]),c&&Xe(y,y,c),S(g,y,b),p[s]=nV.END,p[s+1]=f}}class j0t extends AO{constructor(){super(...arguments),this.color=lp,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}const Pl=$(),Il=$(),Rm=$(),Mw=$(),Ow=ko(),Rw=ko(),Jpe=$(),Qpe=$(),Kpe=dy(),H0t=dy(),q0t=$(),PR=[ko(),ko(),ko(),ko()],Dy=[$(),$(),$(),$()],v7=qi(),_7=qi(),b7=qi(),w7=qi(),W0t=["mesh"];class Z0t extends by{constructor(t,i,r,s){super(t,i,r,s),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){dr.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Ype({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Ype({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),t=>t.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,W0t,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i,new ud),s=t.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(t,i){const r=this._getLayerOpacity();return this._materials.forEach(s=>{s.material.setParameters({layerOpacity:r});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),t.forEach(s=>{const n=i(s);_(n)&&n.layerOpacityChanged(r,this._context.isAsync)}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,Gb)}slicePlaneEnabledChanged(t,i){return this._materials.forEach(r=>{r.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),t.forEach(r=>{const s=i(r);_(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const t=this._usePBR();return this._materials.forEach(i=>i.material.setParameters({usePBR:t})),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(t){return M(t)?"-":t instanceof Le?t.toHex():t.contentHash}_materialPropertiesDefault(t,i){const r=this._requiresSymbolVertexColors(),s=!!t.vertexAttributes.color,n=!!t.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${i},svc:${r}`}}_materialProperties(t,i,r){const s=this._materialPropertiesDefault(t,r);if(!i.material)return s;const{color:n,colorTexture:o,normalTexture:a,doubleSided:l,alphaCutoff:c,alphaMode:h}=i.material,p=this._colorOrTextureUid(n),f=this._colorOrTextureUid(o),m=this._colorOrTextureUid(a);if(s.color=n,s.colorTexture=o,s.normalTexture=a,s.uid=`${s.uid},cmuid:${p},ctmuid:${f},ntmuid:${m},ds:${l},ac:${c},am:${h}`,i.material instanceof uPe){const{metallic:g,roughness:y,metallicRoughnessTexture:x,emissiveColor:b,emissiveTexture:S,occlusionTexture:T}=i.material,C=this._colorOrTextureUid(x),A=this._colorOrTextureUid(b),O=this._colorOrTextureUid(S),D=this._colorOrTextureUid(T);s.metallic=g,s.roughness=y,s.metallicRoughnessTexture=x,s.emissiveColor=b,s.emissiveTexture=S,s.occlusionTexture=T,s.uid=`${s.uid},mrm:${g},mrr:${y},mrt:${C},emuid:${A},etmuid:${O},otmuid:${D}`}return s}_setInternalColorValueParameters(t,i){i.diffuse=Le.toUnitRGB(t),i.opacity=t.a}_getLoadableTextureResource(t){return t.data?t.data:t.url}_getInternalTextureId(t){const i=this._getInternalTexture(t,Rr.Opaque);return _(i)?i.id:null}_getInternalTexture(t,i){const r=this._getLoadableTextureResource(t);if(!r)return null;const s=`${t.contentHash}/${i}`;let n=this._textures.get(s);return n||(n=new En(r,{mipmap:!0,wrap:this._castTextureWrap(t.wrap),noUnpackFlip:!0,preMultiplyAlpha:i!==Rr.Opaque}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(t="repeat"){if(typeof t=="string"){const i=this._castTextureWrapIndividual(t);return{s:i,t:i}}return{s:this._castTextureWrapIndividual(t.horizontal),t:this._castTextureWrapIndividual(t.vertical)}}_castTextureWrapIndividual(t){switch(t){case"clamp":return $t.CLAMP_TO_EDGE;case"mirror":return $t.MIRRORED_REPEAT;default:return $t.REPEAT}}_setInternalMaterialParameters(t,i){if(_(t.color)&&this._setInternalColorValueParameters(t.color,i),_(t.colorTexture)){const r=this._getInternalTexture(t.colorTexture,i.textureAlphaMode);_(r)?(i.textureId=r.id,i.textureAlphaPremultiplied=!!r.params.preMultiplyAlpha):i.textureId=void 0}_(t.normalTexture)&&(i.normalTextureId=this._getInternalTextureId(t.normalTexture)),_(t.emissiveColor)&&(i.emissiveFactor=Le.toUnitRGB(t.emissiveColor)),_(t.emissiveTexture)&&(i.emissiveTextureId=this._getInternalTextureId(t.emissiveTexture)),_(t.occlusionTexture)&&(i.occlusionTextureId=this._getInternalTextureId(t.occlusionTexture)),_(t.metallicRoughnessTexture)&&(i.metallicRoughnessTextureId=this._getInternalTextureId(t.metallicRoughnessTexture))}_setExternalMaterialParameters(t){const i=this._drivenProperties.color;let r=_(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(i)t.externalColor=lp;else{const s=_(this.symbolLayer.material)?this.symbolLayer.material.color:null;_(s)?t.externalColor=Le.toUnitRGBA(s):(r=null,t.externalColor=lp)}r&&(t.colorMixMode=r),t.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(t){const i=t.vertexAttributes.color;if(M(i))return!1;for(let r=3;r<i.length;r+=4)if(i[r]!==255)return!0;return!1}_getOrCreateMaterial(t,i){var g,y,x;const r=(g=i.material)==null?void 0:g.color,s=(y=i.material)==null?void 0:y.colorTexture,n=(x=i.material)==null?void 0:x.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(t)||_(r)&&r.a<1||_(s)&&s.transparent||o),l=this._materialProperties(t,i,a),c=this._materials.get(l.uid);if(c)return c.material;const h={material:null,isComponentTransparent:a,alphaMode:i.material?i.material.alphaMode:"opaque"},p=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,f={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Hl,diffuse:Cg,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Ir.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p||(f.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),i.material&&(f.doubleSided=i.material.doubleSided,f.cullFace=i.material.doubleSided?Ir.None:Ir.Back,f.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,h),this._setInternalMaterialParameters(l,f);const m=new kS(f);return h.material=m,this._materials.set(l.uid,h),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(t,i){t.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||t.layerOpacity<1||t.opacity<1||t.externalColor&&t.externalColor[3]<1,i.alphaMode==="auto"?t.textureAlphaMode=t.transparent?Rr.MaskBlend:Rr.Opaque:t.textureAlphaMode=i.alphaMode==="opaque"?Rr.Opaque:i.alphaMode==="mask"?Rr.Mask:Rr.Blend}_addDebugNormals(t,i,r,s){const n=i.length,o=t.spatialReference.isGeographic?20015077/180:1,a=.1*Math.max(t.extent.width*o,t.extent.height*o,t.extent.zmax-t.extent.zmin),l=[],c=[],h=[],p=[];for(let g=0;g<n;g++){const y=i[g],x=y.vertexAttributes.get(P.POSITION),b=y.vertexAttributes.get(P.NORMAL),S=y.indices.get(P.POSITION),T=y.indices.get(P.NORMAL),C=x.data,A=b.data;for(let O=0;O<S.length;O++){const D=3*S[O],U=3*T[O];for(let k=0;k<3;k++)l.push(C[D+k]);for(let k=0;k<3;k++)l.push(C[D+k]+A[U+k]*a);if(c.push(c.length),c.push(c.length),O%3==0){this._calculateFaceNormal(C,S,O,sE),this._getFaceVertices(C,S,O,Ta,iE,rE),we(Ta,Ta,iE),we(Ta,Ta,rE),fe(Ta,Ta,1/3);for(let k=0;k<3;k++)h.push(Ta[k]);for(let k=0;k<3;k++)h.push(Ta[k]+sE[k]*a);p.push(p.length),p.push(p.length)}}}const f=new vs([[P.POSITION,{data:l,size:3,exclusive:!0}]],[[P.POSITION,new Uint32Array(c)]],kc.Line);i.push(f),r.push(this._debugVertexNormalMaterial),s.push(ZT(s[0]));const m=new vs([[P.POSITION,{data:h,size:3,exclusive:!0}]],[[P.POSITION,new Uint32Array(p)]],kc.Line);i.push(m),r.push(this._debugFaceNormalMaterial),s.push(ZT(s[0]))}_createAs3DShape(t,i,r,s){const n=t.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,i);if(!o)return null;const{geometries:a,materials:l,transformations:c,objectTransformation:h}=o;dr.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a,l,c);const p=new Hv({geometries:a,materials:l,transformations:c,metadata:{layerUid:this._context.layer.uid,graphicUid:s}});p.transformation=h;const f=this._createEdgeMaterial(),m=_(f)?{baseMaterial:l[0],edgeMaterials:[f],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,g=new _y(this,p,a,null,null,I$,r,m);return g.needsElevationUpdates=Gb(r.mode),g.useObjectOriginAsAttachmentOrigin=!0,g.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(p),g.alignedSampledElevation=I$(g,g.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),g}_getCenterPointInElevationSR(t){const i=jv(0,0,0,this._context.elevationProvider.spatialReference);return Hbe([t.transformation[12],t.transformation[13],t.transformation[14]],this._context.renderCoordsHelper.spatialReference,i),i}_createComponentNormals(t,i,r,s){switch(r.shading||"flat"){case"source":return this._createComponentNormalsSource(t,i,r,s);case"flat":return this._createComponentNormalsFlat(t,s);case"smooth":return this._createComponentNormalsSmooth(t,s);default:return}}_createComponentNormalsSource(t,i,r,s){if(M(i))return this._createComponentNormalsFlat(t,s);let n=!1;if(!r.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(t,s,o,sE);for(let a=0;a<3;a++){const l=3*s[o+a];Ta[0]=i[l+0],Ta[1]=i[l+1],Ta[2]=i[l+2],Pe(sE,Ta)<0&&(i[l+0]=-i[l+0],i[l+1]=-i[l+1],i[l+2]=-i[l+2],n=!0)}}return{normals:i,indices:s,didFlipNormals:n}}_createComponentNormalsFlat(t,i){const r=new Float32Array(i.length),s=new Uint32Array(3*i.length);for(let n=0;n<i.length;n+=3){const o=this._calculateFaceNormal(t,i,n,sE);for(let a=0;a<3;a++)r[n+a]=o[a],s[n+a]=n/3}return{normals:r,indices:s,didFlipNormals:!1}}_createComponentNormalsSmooth(t,i){const r={};for(let o=0;o<i.length;o+=3){const a=this._calculateFaceNormal(t,i,o,sE);for(let l=0;l<3;l++){const c=i[o+l];let h=r[c];h||(h={normal:$(),count:0},r[c]=h),we(h.normal,h.normal,a),h.count++}}const s=new Float32Array(3*i.length),n=new Uint32Array(3*i.length);for(let o=0;o<i.length;o++){const a=r[i[o]];a.count!==1&&(Re(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return{normals:s,indices:n,didFlipNormals:!1}}_getFaceVertices(t,i,r,s,n,o){const a=3*i[r+0],l=3*i[r+1],c=3*i[r+2];s[0]=t[a+0],s[1]=t[a+1],s[2]=t[a+2],n[0]=t[l+0],n[1]=t[l+1],n[2]=t[l+2],o[0]=t[c+0],o[1]=t[c+1],o[2]=t[c+2]}_calculateFaceNormal(t,i,r,s){return this._getFaceVertices(t,i,r,Ta,iE,rE),xe(iE,iE,Ta),xe(rE,rE,Ta),Tt(Ta,iE,rE),Re(s,Ta),s}_getOrCreateComponents(t){return Ye(t.components,X0t)}_createPositionBuffer(t,i){let r=t.vertexAttributes.position;const s=i.reprojection===bh.ECEF?i.transformBeforeProject:null;if(_(s)&&(r=L0t(r,new Float64Array(r.length),s)),i.reprojection===bh.NONE)return i.needsBufferCopy?new Float64Array(r):r;const n=_(s)?r:new Float64Array(r.length);return $r(r,t.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,r.length/3),n}_createNormalBuffer(t,i,r){let s=t.vertexAttributes.normal;if(M(s))return null;const n=r.reprojection===bh.ECEF?r.transformBeforeProject:null;if(_(n)&&(s=D0t(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===bh.NONE)return r.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=_(n)?s:new Float32Array(s.length);return $0t(s,o,i,t.spatialReference,a)}_createTangentBuffer(t,i,r){let s=t.vertexAttributes.tangent;if(M(s))return null;const n=r.reprojection===bh.ECEF?r.transformBeforeProject:null;if(_(n)&&(s=N0t(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===bh.NONE)return r.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=_(n)?s:new Float32Array(s.length);return F0t(s,o,i,t.spatialReference,a)}_createColorBuffer(t){return t.vertexAttributes.color}_createSymbolColorBuffer(t){if(this._requiresSymbolVertexColors()){const i=this._getVertexOpacityAndColor(t),r=VRe(Wr(this.symbolLayer,"material","colorMixMode")),s=new Uint8Array(4);return BRe(i,r,s),s}return null}_createBuffers(t,i){const r=t.vertexAttributes&&t.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=t.vertexAttributes.normal,n=t.vertexAttributes.uv,o=t.vertexAttributes.tangent;if(_(s)&&s.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(_(o)&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(_(n)&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(t),l=this._createPositionBuffer(t,a),c=this._createColorBuffer(t),h=this._createSymbolColorBuffer(i),p=this._createNormalBuffer(t,l,a),f=this._createTangentBuffer(t,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:f,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===bh.NONE&&_(a.objectTransformation)?a.objectTransformation:this._transformOriginLocal(t,l,p,f),geometryTransformation:a.reprojection===bh.NONE&&_(a.geometryTransformation)?a.geometryTransformation:Ne()}}_computeReprojectionInfo(t){const i=_(t.transform),r=i&&t.transform.geographic||this._context.renderCoordsHelper.viewingMode===tt.Local?bh.NONE:bh.ECEF;if(i){if(r===bh.NONE){const n=Ne();return nd(t.spatialReference,t.transform.origin,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:ZT(t.transform.localMatrix),needsBufferCopy:!1}}const s=dB(Ne(),t.transform.origin);return As(s,s,t.transform.localMatrix),{reprojection:r,transformBeforeProject:s,needsBufferCopy:!0}}return{reprojection:r,needsBufferCopy:!0}}_transformOriginLocal(t,i,r,s){const n=this._context.renderCoordsHelper.spatialReference,o=t.anchor;_F[0]=o.x,_F[1]=o.y,_F[2]=o.z;const a=Ne();nd(t.spatialReference,_F,a,n);const l=fn.fromTypedArray(i);if(Ks(efe,a),WL(l,l,efe),_(r)||_(s)){if(Cp(IR,a),Ap(IR,IR),_(r)){const c=fr.fromTypedArray(r);jb(c,c,IR)}if(_(s)){const c=fr.fromTypedArray(s,4*s.BYTES_PER_ELEMENT);jb(c,c,IR)}}return a}_validateFaces(t,i){const r=t.vertexAttributes.position.length/3,s=i.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(r<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(t,i){return i.faces?i.faces:CM(t.vertexAttributes.position.length/3)}_isOutsideClippingArea(t){if(!this._context.clippingExtent)return!1;const i=t.vertexAttributes&&t.vertexAttributes.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference;let s;const n=i.length/3;return t.spatialReference.equals(r)?s=i:(s=new Float64Array(i.length),$r(t.vertexAttributes.position,t.spatialReference,0,s,r,0,n)),Nr(x7),qh(x7,s,0,n),!Nf(x7,this._context.clippingExtent)}_createGeometryInfo(t,i){if(!Jg(t.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(t))return null;const r=this._createBuffers(t,i);if(M(r))return null;const{positionBuffer:s,uvBuffer:n,colorBuffer:o,symbolColorBuffer:a,normalBuffer:l,tangentBuffer:c,objectTransformation:h,geometryTransformation:p}=r,f=this._getOrCreateComponents(t),m=[],g=[],y=[];let x=!1;for(const b of f){if(!this._validateFaces(t,b))return null;const S=this._getOrCreateFaces(t,b);if(S.length===0)continue;const T=this._createComponentNormals(s,l,b,S);T.didFlipNormals&&(x=!0);const C=[[P.POSITION,{size:3,data:s,exclusive:!0}],[P.NORMAL,{size:3,data:T.normals,exclusive:!0}]],A=[[P.POSITION,S],[P.NORMAL,T.indices]];_(o)&&(C.push([P.COLOR,{size:4,data:o,exclusive:!0}]),A.push([P.COLOR,S])),_(a)&&(C.push([P.SYMBOLCOLOR,{size:4,data:a,exclusive:!0}]),A.push([P.SYMBOLCOLOR,new Uint16Array(S.length)])),_(n)&&(C.push([P.UV0,{size:2,data:n,exclusive:!0}]),A.push([P.UV0,S])),_(c)&&(C.push([P.TANGENT,{size:4,data:c,exclusive:!0}]),A.push([P.TANGENT,S]));const O=new vs(C,A);m.push(O),g.push(p),y.push(this._getOrCreateMaterial(t,b))}return x&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:m,transformations:g,materials:y,objectTransformation:h}}_createEdgeMaterial(){const t={opacity:this._getLayerOpacity()};return ZOe(this.symbolLayer,t)}}const _F=$(),Ta=$(),iE=$(),rE=$(),sE=$(),efe=Ne(),IR=ls(),x7=In(),X0t=[new I0t];var bh;(function(e){e[e.NONE=0]="NONE",e[e.ECEF=1]="ECEF"})(bh||(bh={}));class Y0t{constructor(t,i,r,s){this.graphics3DSymbolLayer=t,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(t){const i=this.lodRenderer.instanceData;t!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,t)}destroy(){this.instanceIndex!=null&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(t,i,r){if(this.elevationAligner){cre(this.elevationContext.featureExpressionInfoContext,r);const s=this.elevationAligner(this,this.elevationContext,t,i);_(s)&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(t=$()){return this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Pm),Xe(t,this.lodRenderer.baseBoundingSphere.center,Pm)}getBoundingBoxObjectSpace(t=In()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Pm);const i=this.lodRenderer.baseBoundingBox;Nr(t);for(let r=0;r<8;++r)he(vd,(1&r)==0?i[0]:i[3],(2&r)==0?i[1]:i[4],(4&r)==0?i[2]:i[5]),Xe(vd,vd,Pm),qg(t,vd);return t}computeAttachmentOrigin(t){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Pm),t.render.origin[0]+=Pm[12],t.render.origin[1]+=Pm[13],t.render.origin[2]+=Pm[14],t.render.num++}async getProjectedBoundingBox(t,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=J0t,l=KV(o)?1:a.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Pm);for(let h=0;h<l;h++){const p=a[h];vd[0]=o[p[0]],vd[1]=o[p[1]],vd[2]=o[p[2]],Xe(vd,vd,Pm),Pw[3*h+0]=vd[0],Pw[3*h+1]=vd[1],Pw[3*h+2]=vd[2]}if(!t(Pw,0,l))return null;Nr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],Pw[h+p]),o[p+3]=Math.max(o[p+3],Pw[h+p]);c&&r.push({location:Pw.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&(Df(o,T7),this.elevationContext.mode!=="absolute-height")){let h;const p=ore(o,i);try{h=await i.service.queryElevation(T7[0],T7[1],s,p,"ground")}catch{}_(h)&&l1e(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(t,i){if(t===Tv.Highlight){const r=new Xz(t);this._addHighlightId(r),i.addExternal(s=>{this._removeHighlightId(s)},r)}}removeObjectState(t){this._highlights.forEach(i=>t.remove(i))}_addHighlightId(t){this._highlights.add(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(t){this._highlights.delete(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const Pw=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],vd=$(),T7=$(),J0t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Pm=Ne();function Q0t(e){const t=[];return e.stageResources.geometries.forEach((i,r)=>{const s=e.stageResources.materials[r],n=e.stageResources.textures;t.push({material:s,geometry:i,textures:n})}),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}function K0t(e){return{levels:e.map(t=>Q0t(t))}}function evt(e,t=ivt){const i=Pft(e);return Math.sqrt(i/(t*Math.PI))}function tvt(e){e.levels.forEach(t=>{t.minScreenSpaceRadius||(t.minScreenSpaceRadius=evt(t))})}const ivt=.05;function rvt(e){return e=e||globalThis.location.hostname,svt.some(t=>(e==null?void 0:e.match(t))!=null)}function hJ(e,t){return e&&(t=t||globalThis.location.hostname)?t.match(dPe)!=null||t.match(fPe)!=null?e.replace("static.arcgis.com","staticdev.arcgis.com"):t.match(pPe)!=null||t.match(mPe)!=null?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}const dPe=/^devext.arcgis.com$/,pPe=/^qaext.arcgis.com$/,fPe=/^[\w-]*\.mapsdevext.arcgis.com$/,mPe=/^[\w-]*\.mapsqa.arcgis.com$/,svt=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,dPe,pPe,/^jsapps.esri.com$/,fPe,mPe];function nvt(e,t,i){if(e.count!==t.count)return void U6.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=i[9],g=i[10],y=i[11],x=i[12],b=i[13],S=i[14],T=i[15],C=e.typedBuffer,A=e.typedBufferStride,O=t.typedBuffer,D=t.typedBufferStride;for(let U=0;U<r;U++){const k=U*A,B=U*D,j=O[B],H=O[B+1],K=O[B+2],ee=O[B+3];C[k]=s*j+l*H+f*K+x*ee,C[k+1]=n*j+c*H+m*K+b*ee,C[k+2]=o*j+h*H+g*K+S*ee,C[k+3]=a*j+p*H+y*K+T*ee}}function gPe(e,t,i){if(e.count!==t.count)return void U6.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=e.typedBuffer,g=e.typedBufferStride,y=t.typedBuffer,x=t.typedBufferStride;for(let b=0;b<r;b++){const S=b*g,T=b*x,C=y[T],A=y[T+1],O=y[T+2],D=y[T+3];m[S]=s*C+a*A+h*O,m[S+1]=n*C+l*A+p*O,m[S+2]=o*C+c*A+f*O,m[S+3]=D}}function ovt(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const g=1/Math.sqrt(m);r[l]=g*h,r[l+1]=g*p,r[l+2]=g*f}}}function dJ(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2],s[c+3]=i*o[h+3]}}function avt(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i,s[c+3]=o[h+3]>>i}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:nvt,transformMat3:gPe,normalize:ovt,scale:dJ,shiftRight:avt},Symbol.toStringTag,{value:"Module"}));function lvt(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<9;++p)r[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:lvt},Symbol.toStringTag,{value:"Module"}));function cvt(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<16;++p)r[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:cvt},Symbol.toStringTag,{value:"Module"}));function uvt(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],l+=s,c+=o}function gk(e,t){const i=e.count;t||(t=new e.TypedArrayConstructor(i));for(let r=0;r<i;r++)t[r]=e.get(r);return t}Object.freeze(Object.defineProperty({__proto__:null,copy:uvt,makeDense:gk},Symbol.toStringTag,{value:"Module"}));function yPe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],l+=s,c+=o}function vPe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;if(rat(t.elementType)){const h=sat(t.elementType);if(iat(t.elementType))for(let p=0;p<a;++p)r[l]=Math.max(n[c]/h,-1),r[l+1]=Math.max(n[c+1]/h,-1),l+=s,c+=o;else for(let p=0;p<a;++p)r[l]=n[c]/h,r[l+1]=n[c+1]/h,l+=s,c+=o}else yPe(e,t,i);return e}function hvt(e,t,i,r){var l,c;const s=e.typedBuffer,n=e.typedBufferStride,o=(l=r==null?void 0:r.count)!=null?l:e.count;let a=((c=r==null?void 0:r.dstIndex)!=null?c:0)*n;for(let h=0;h<o;++h)s[a]=t,s[a+1]=i,a+=n}Object.freeze(Object.defineProperty({__proto__:null,copy:yPe,normalizeIntegerBuffer:vPe,fill:hvt},Symbol.toStringTag,{value:"Module"}));function a8(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],l+=s,c+=o}function dvt(e,t,i,r,s){var c,h;const n=e.typedBuffer,o=e.typedBufferStride,a=(c=s==null?void 0:s.count)!=null?c:e.count;let l=((h=s==null?void 0:s.dstIndex)!=null?h:0)*o;for(let p=0;p<a;++p)n[l]=t,n[l+1]=i,n[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:a8,fill:dvt},Symbol.toStringTag,{value:"Module"}));function _Pe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],r[l+3]=n[c+3],l+=s,c+=o}function bPe(e,t,i,r,s,n){var h,p;const o=e.typedBuffer,a=e.typedBufferStride,l=(h=n==null?void 0:n.count)!=null?h:e.count;let c=((p=n==null?void 0:n.dstIndex)!=null?p:0)*a;for(let f=0;f<l;++f)o[c]=t,o[c+1]=i,o[c+2]=r,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:_Pe,fill:bPe},Symbol.toStringTag,{value:"Module"}));function pT(e,t){return new e(new ArrayBuffer(t*e.ElementCount*xAe(e.ElementType)))}class wPe{constructor(t){this.streamDataRequester=t}async loadJSON(t,i){return this._load("json",t,i)}async loadBinary(t,i){return uy(t)?(qt(i),x1e(t)):this._load("binary",t,i)}async loadImage(t,i){return this._load("image",t,i)}async _load(t,i,r){if(M(this.streamDataRequester))return(await Zt(i,{responseType:pvt[t]})).data;const s=await Hu(this.streamDataRequester.request(i,t,r));if(s.ok===!0)return s.value;throw cl(s.error),new W("",`Request for resource failed: ${s.error}`)}}const pvt={image:"image",binary:"array-buffer",json:"json"},fvt=ve.getLogger("esri.views.3d.glTF");class mvt{error(t){throw new W("gltf-loader-error",t)}errorUnsupported(t){throw new W("gltf-loader-unsupported-feature",t)}errorUnsupportedIf(t,i){t&&this.errorUnsupported(i)}assert(t,i){t||this.error(i)}warn(t){fvt.warn(t)}warnUnsupported(t){this.warn("[Unsupported Feature] "+t)}warnUnsupportedIf(t,i){t&&this.warnUnsupported(i)}}function gvt(e={}){return F({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply"},e)}function yvt(e,t={}){return{data:e,parameters:F({wrap:F({s:$t.REPEAT,t:$t.REPEAT},t.wrap),noUnpackFlip:!0,mipmap:!1},t)}}class Wb{constructor(t,i,r=""){this.major=t,this.minor=i,this._context=r}lessThan(t,i){return this.major<t||t===this.major&&this.minor<i}since(t,i){return!this.lessThan(t,i)}validate(t){if(this.major!==t.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new W(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:t})}}clone(){return new Wb(this.major,this.minor,this._context)}static parse(t,i=""){const[r,s]=t.split("."),n=/^\s*\d+\s*$/;if(!r||!r.match||!r.match(n))throw new W((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!s||!s.match||!s.match(n))throw new W((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});const o=parseInt(r,10),a=parseInt(s,10);return new Wb(o,a,i)}}class tfe{constructor(t){this.data=t,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}readUint32(){const t=this.offset4;return this.offset4+=1,this.dataUint32[t]}readUint8Array(t){const i=4*this.offset4;return this.offset4+=t/4,new Uint8Array(this.data,i,t)}remainingBytes(){return this.data.byteLength-4*this.offset4}}var c3,ife;(function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"})(c3||(c3={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(ife||(ife={}));const xPe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},vvt={pbrMetallicRoughness:xPe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},_vt={ESRI_externalColorMixMode:"tint"},rfe=(e={})=>{const t=F(F({},xPe),e.pbrMetallicRoughness),i=bvt(F(F({},_vt),e.extras));return me(F(F({},vvt),e),{pbrMetallicRoughness:t,extras:i})};function bvt(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:e.ESRI_externalColorMixMode,e.ESRI_externalColorMixMode="tint"}return e}const wvt={magFilter:gt.LINEAR,minFilter:gt.LINEAR_MIPMAP_LINEAR,wrapS:$t.REPEAT,wrapT:$t.REPEAT},xvt=e=>F(F({},wvt),e);function Tvt(e){let t,i;return e.replace(/^(.*\/)?([^/]*)$/,(r,s,n)=>(t=s||"",i=n||"","")),{dirPart:t,filePart:i}}const bF={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};class E0{constructor(t,i,r,s,n){this.context=t,this.errorContext=i,this.uri=r,this.json=s,this.glbBuffer=n,this.bufferLoaders=new Map,this.textureLoaders=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=Tvt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.errorUnsupportedIf(s.scenes==null,"Scenes must be defined."),i.errorUnsupportedIf(s.meshes==null,"Meshes must be defined"),i.errorUnsupportedIf(s.nodes==null,"Nodes must be defined."),this._computeNodeParents()}static async load(t,i,r,s){if(uy(r)){const a=rB(r);if(a.mediaType!=="model/gltf-binary")try{const c=JSON.parse(a.isBase64?atob(a.data):a.data);return new E0(t,i,r,c)}catch{}const l=x1e(r);if(E0._isGLBData(l))return this._fromGLBData(t,i,r,l)}if(r.endsWith(".gltf")){const a=await t.loadJSON(r,s);return new E0(t,i,r,a)}const n=await t.loadBinary(r,s);if(E0._isGLBData(n))return this._fromGLBData(t,i,r,n);const o=await t.loadJSON(r,s);return new E0(t,i,r,o)}static _isGLBData(t){const i=new tfe(t);return i.remainingBytes()>=4&&i.readUint32()===bF.MAGIC}static async _fromGLBData(t,i,r,s){const n=await E0._parseGLBData(i,s);return new E0(t,i,r,n.json,n.binaryData)}static async _parseGLBData(t,i){const r=new tfe(i);t.assert(r.remainingBytes()>=12,"GLB binary data is insufficiently large.");const s=r.readUint32(),n=r.readUint32(),o=r.readUint32();t.assert(s===bF.MAGIC,"Magic first 4 bytes do not fit to expected GLB value."),t.assert(i.byteLength>=o,"GLB binary data is smaller than header specifies."),t.errorUnsupportedIf(n!==2,"An unsupported GLB container version was detected. Only version 2 is supported.");let a,l,c=0;for(;r.remainingBytes()>=8;){const h=r.readUint32(),p=r.readUint32();c===0?(t.assert(p===bF.CHUNK_TYPE_JSON,"First GLB chunk must be JSON."),t.assert(h>=0,"No JSON data found."),a=await Ovt(r.readUint8Array(h))):c===1?(t.errorUnsupportedIf(p!==bF.CHUNK_TYPE_BIN,"Second GLB chunk expected to be BIN."),l=r.readUint8Array(h)):t.warnUnsupported("More than 2 GLB chunks detected. Skipping."),c+=1}return a||t.error("No GLB JSON chunk detected."),{json:a,binaryData:l}}async getBuffer(t,i){const r=this.json.buffers[t],s=this.errorContext;if(r.uri==null)return s.assert(this.glbBuffer!=null,"GLB buffer not present"),this.glbBuffer;const n=await this._getBufferLoader(t,i);return s.assert(n.byteLength===r.byteLength,"Buffer byte lengths should match."),n}async _getBufferLoader(t,i){const r=this.bufferLoaders.get(t);if(r)return r;const s=this.json.buffers[t],n=this.context.loadBinary(this._resolveUri(s.uri),i).then(o=>new Uint8Array(o));return this.bufferLoaders.set(t,n),n}async getAccessor(t,i){const r=this.errorContext;r.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");const s=this.json.accessors[t];r.errorUnsupportedIf((s==null?void 0:s.bufferView)==null,"Some accessor does not specify a bufferView."),r.errorUnsupportedIf(s.type in[c3.MAT2,c3.MAT3,c3.MAT4],`AttributeType ${s.type} is not supported`);const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,i),a=Cvt[s.type],l=Avt[s.componentType],c=a*l,h=n.byteStride||c;return{raw:o.buffer,byteStride:h,byteOffset:o.byteOffset+(n.byteOffset||0)+(s.byteOffset||0),entryCount:s.count,isDenselyPacked:h===c,componentCount:a,componentByteSize:l,componentType:s.componentType,min:s.min,max:s.max,normalized:!!s.normalized}}async getIndexData(t,i){if(t.indices==null)return null;const r=await this.getAccessor(t.indices,i);if(r.isDenselyPacked)switch(r.componentType){case St.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case St.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case St.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case St.UNSIGNED_BYTE:return gk(this._wrapAccessor(Ev,r));case St.UNSIGNED_SHORT:return gk(this._wrapAccessor(MS,r));case St.UNSIGNED_INT:return gk(this._wrapAccessor(RS,r))}}async getPositionData(t,i){const r=this.errorContext;r.errorUnsupportedIf(t.attributes.POSITION==null,"No POSITION vertex data found.");const s=await this.getAccessor(t.attributes.POSITION,i);return r.errorUnsupportedIf(s.componentType!==St.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+xF[s.componentType]),r.errorUnsupportedIf(s.componentCount!==3,"POSITION vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(fr,s)}async getNormalData(t,i){const r=this.errorContext;r.assert(t.attributes.NORMAL!=null,"No NORMAL vertex data found.");const s=await this.getAccessor(t.attributes.NORMAL,i);return r.errorUnsupportedIf(s.componentType!==St.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+xF[s.componentType]),r.errorUnsupportedIf(s.componentCount!==3,"NORMAL vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(fr,s)}async getTangentData(t,i){const r=this.errorContext;r.assert(t.attributes.TANGENT!=null,"No TANGENT vertex data found.");const s=await this.getAccessor(t.attributes.TANGENT,i);return r.errorUnsupportedIf(s.componentType!==St.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+xF[s.componentType]),r.errorUnsupportedIf(s.componentCount!==4,"TANGENT vertex attribute must have 4 components, but found "+s.componentCount.toFixed()),new Ho(s.raw,s.byteOffset,s.byteStride,s.byteOffset+s.byteStride*s.entryCount)}async getTextureCoordinates(t,i){const r=this.errorContext;r.assert(t.attributes.TEXCOORD_0!=null,"No TEXCOORD_0 vertex data found.");const s=await this.getAccessor(t.attributes.TEXCOORD_0,i);return r.errorUnsupportedIf(s.componentCount!==2,"TEXCOORD_0 vertex attribute must have 2 components, but found "+s.componentCount.toFixed()),s.componentType===St.FLOAT?this._wrapAccessor(Mp,s):(r.errorUnsupportedIf(!s.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),Mvt(s))}async getVertexColors(t,i){const r=this.errorContext;r.assert(t.attributes.COLOR_0!=null,"No COLOR_0 vertex data found.");const s=await this.getAccessor(t.attributes.COLOR_0,i);if(r.errorUnsupportedIf(s.componentCount!==4&&s.componentCount!==3,"COLOR_0 attribute must have 3 or 4 components, but found "+s.componentCount.toFixed()),s.componentCount===4){if(s.componentType===St.FLOAT)return this._wrapAccessor(Ho,s);if(s.componentType===St.UNSIGNED_BYTE)return this._wrapAccessor(Hc,s);if(s.componentType===St.UNSIGNED_SHORT)return this._wrapAccessor(Nb,s)}else if(s.componentCount===3){if(s.componentType===St.FLOAT)return this._wrapAccessor(fr,s);if(s.componentType===St.UNSIGNED_BYTE)return this._wrapAccessor(Db,s);if(s.componentType===St.UNSIGNED_SHORT)return this._wrapAccessor(OS,s)}r.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+xF[s.componentType])}hasPositions(t){return t.attributes.POSITION!==void 0}hasNormals(t){return t.attributes.NORMAL!==void 0}hasVertexColors(t){return t.attributes.COLOR_0!==void 0}hasTextureCoordinates(t){return t.attributes.TEXCOORD_0!==void 0}hasTangents(t){return t.attributes.TANGENT!==void 0}async getMaterial(t,i,r){let s=this.materialCache.get(t.material);if(!s){const n=t.material!=null?rfe(this.json.materials[t.material]):rfe(),o=n.pbrMetallicRoughness,a=this.hasVertexColors(t),l=this.getTexture(o.baseColorTexture,i),c=this.getTexture(n.normalTexture,i),h=r?this.getTexture(n.occlusionTexture,i):null,p=r?this.getTexture(n.emissiveTexture,i):null,f=r?this.getTexture(o.metallicRoughnessTexture,i):null,m=t.material!=null?t.material:-1;s={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:o.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await l,normalTexture:await c,name:n.name,id:m,occlusionTexture:await h,emissiveTexture:await p,emissiveFactor:n.emissiveFactor,metallicFactor:o.metallicFactor,roughnessFactor:o.roughnessFactor,metallicRoughnessTexture:await f,hasVertexColors:a,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode}}return s}async getTexture(t,i){if(!t)return null;this.errorContext.errorUnsupportedIf((t.texCoord||0)!==0,"Only TEXCOORD with index 0 is supported.");const r=t.index,s=this.errorContext,n=this.json.textures[r],o=xvt(n.sampler!=null?this.json.samplers[n.sampler]:{});s.errorUnsupportedIf(n.source==null,"Source is expected to be defined for a texture.");const a=this.json.images[n.source],l=await this._loadTextureImageData(r,n,i);return $Q(this.textureCache,r,()=>{const c=p=>p===33071||p===33648||p===10497,h=p=>(s.error(`Unexpected TextureSampler WrapMode: ${p}. Using default REPEAT(10497).`),10497);return{data:l,wrapS:c(o.wrapS)?o.wrapS:h(o.wrapS),wrapT:c(o.wrapT)?o.wrapT:h(o.wrapT),minFilter:o.minFilter,name:a.name,id:r}})}getNodeTransform(t){if(t===void 0)return Evt;let i=this.nodeTransformCache.get(t);if(!i){const r=this.getNodeTransform(this._getNodeParent(t)),s=this.json.nodes[t];s.matrix?i=As(Ne(),r,s.matrix):s.translation||s.rotation||s.scale?(i=ZT(r),s.translation&&Zl(i,i,s.translation),s.rotation&&(wF[3]=ZCe(wF,s.rotation),Iu(i,i,wF[3],wF)),s.scale&&uB(i,i,s.scale)):i=r,this.nodeTransformCache.set(t,i)}return i}_wrapAccessor(t,i){return new t(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*(i.entryCount-1)+i.componentByteSize*i.componentCount)}_resolveUri(t){return Wh(t,this.baseUri)}_getNodeParent(t){return this.nodeParentMap.get(t)}_checkVersionSupported(){const t=Wb.parse(this.json.asset.version,"glTF");Svt.validate(t)}_checkRequiredExtensionsSupported(){const t=this.json,i=this.errorContext;t.extensionsRequired&&t.extensionsRequired.length!==0&&i.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+t.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((t,i)=>{t.children&&t.children.forEach(r=>{this.nodeParentMap.set(r,i)})})}async _loadTextureImageData(t,i,r){const s=this.textureLoaders.get(t);if(s)return s;const n=this._createTextureLoader(i,r);return this.textureLoaders.set(t,n),n}async _createTextureLoader(t,i){const r=this.json.images[t.source];if(r.uri)return this.context.loadImage(this._resolveUri(r.uri),i);const s=this.errorContext;s.errorUnsupportedIf(r.bufferView==null,"Image bufferView must be defined."),s.errorUnsupportedIf(r.mimeType==null,"Image mimeType must be defined.");const n=this.json.bufferViews[r.bufferView],o=await this.getBuffer(n.buffer,i);return s.errorUnsupportedIf(n.byteStride!=null,"byteStride not supported for image buffer"),Rvt(new Uint8Array(o.buffer,o.byteOffset+(n.byteOffset||0),n.byteLength),r.mimeType)}}const Svt=new Wb(2,0,"glTF"),Evt=Mbe(Ne(),Math.PI/2),wF=Lv(),Cvt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},Avt={[St.BYTE]:1,[St.UNSIGNED_BYTE]:1,[St.SHORT]:2,[St.UNSIGNED_SHORT]:2,[St.FLOAT]:4,[St.UNSIGNED_INT]:4};function Mvt(e){switch(e.componentType){case St.BYTE:return new PS(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case St.UNSIGNED_BYTE:return new AS(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case St.SHORT:return new IS(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case St.UNSIGNED_SHORT:return new TM(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case St.UNSIGNED_INT:return new SM(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case St.FLOAT:return new Mp(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:return void(e.componentType,void 0)}}async function Ovt(e){return new Promise((t,i)=>{const r=new Blob([e]),s=new FileReader;s.onload=()=>{const n=s.result;t(JSON.parse(n))},s.onerror=n=>{i(n)},s.readAsText(r)})}async function Rvt(e,t){return new Promise((i,r)=>{const s=new Blob([e],{type:t}),n=URL.createObjectURL(s),o=new Image;o.addEventListener("load",()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>i(o),()=>i(o)):i(o)}),o.addEventListener("error",a=>{URL.revokeObjectURL(n),r(a)}),o.src=n})}const xF={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};let Pvt=0;async function TPe(e,t,i={},r=!0){const s=await E0.load(e,yk,t,i),n="gltf_"+Pvt++,o={lods:[],materials:new Map,textures:new Map,meta:Ivt(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await $vt(s,async(c,h,p,f)=>{var k;const m=(k=l.get(p))!=null?k:0;l.set(p,m+1);const g=c.mode!==void 0?c.mode:Wt.TRIANGLES,y=g===Wt.TRIANGLES||g===Wt.TRIANGLE_STRIP||g===Wt.TRIANGLE_FAN?g:null;if(M(y))return void yk.warnUnsupported("Unsupported primitive mode ("+Fvt[g]+"). Skipping primitive.");if(!s.hasPositions(c))return void yk.warn("Skipping primitive without POSITION vertex attribute.");const x=s.getPositionData(c,i),b=s.getMaterial(c,i,r),S=s.hasNormals(c)?s.getNormalData(c,i):null,T=s.hasTangents(c)?s.getTangentData(c,i):null,C=s.hasTextureCoordinates(c)?s.getTextureCoordinates(c,i):null,A=s.hasVertexColors(c)?s.getVertexColors(c,i):null,O=s.getIndexData(c,i),D={transform:ZT(h),attributes:{position:await x,normal:S?await S:null,texCoord0:C?await C:null,color:A?await A:null,tangent:T?await T:null},indices:await O,primitiveType:y,material:Dvt(o,await b,n)};let U=null;_(o.meta)&&_(o.meta.ESRI_lod)&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(U=o.meta.ESRI_lod.thresholds[p]),o.lods[p]=o.lods[p]||{parts:[],name:f,lodThreshold:U},o.lods[p].parts[m]=D});for(const c of o.lods)c.parts=c.parts.filter(h=>!!h);return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{}}}function Ivt(e){const t=e.json;let i=null;return t.nodes.forEach(r=>{const s=r.extras;_(s)&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(i=s)}),i}async function $vt(e,t){const i=e.json,r=i.scenes[i.scene||0].nodes,s=r.length>1,n=[];for(const a of r){const l=i.nodes[a];n.push(o(a,0)),Lvt(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=i.nodes[a],h=e.getNodeTransform(a);if(yk.warnUnsupportedIf(c.weights!=null,"Morph targets are not supported."),c.mesh!=null){const p=i.meshes[c.mesh];for(const f of p.primitives)n.push(t(f,h,l,p.name))}for(const p of c.children||[])n.push(o(p,l))}await Promise.all(n)}function Lvt(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function Dvt(e,t,i){const r=n=>{const o=`${i}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!e.textures.has(o)){const a=yvt(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:Nvt.includes(n.minFilter),noUnpackFlip:!0});e.textures.set(o,a)}return o},s=`${i}_mat_${t.id}_${t.name}`;if(!e.materials.has(s)){const n=gvt({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?r(t.colorTexture):void 0,textureNormal:t.normalTexture?r(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?r(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?r(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?r(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(s,n)}return s}const yk=new mvt,Nvt=[gt.LINEAR_MIPMAP_LINEAR,gt.LINEAR_MIPMAP_NEAREST],Fvt=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"];function kvt(e,t=CM){return typeof e=="number"?t(e):Yk(e)||Jx(e)?new Uint32Array(e):e}function Uvt(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof e=="number"){let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=n,r[s++]=n+1,r[s++]=n+2):(r[s++]=n+1,r[s++]=n,r[s++]=n+2)}else{let s=0;for(let n=0;n<i;n+=1)if(n%2==0){const o=e[n],a=e[n+1],l=e[n+2];r[s++]=o,r[s++]=a,r[s++]=l}else{const o=e[n+1],a=e[n],l=e[n+2];r[s++]=o,r[s++]=a,r[s++]=l}}return r}function zvt(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof e=="number"){let s=0;for(let n=0;n<i;++n)r[s++]=0,r[s++]=n+1,r[s++]=n+2;return r}{const s=e[0];let n=e[1],o=0;for(let a=0;a<i;++a){const l=e[a+2];r[o++]=s,r[o++]=n,r[o++]=l,n=l}return r}}const u0=ve.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function SPe(e,t){const i=await Vvt(e,t);return{resource:i,textures:await qvt(i.textureDefinitions,t)}}async function Vvt(e,t){const i=_(t)&&t.streamDataRequester;if(i)return Bvt(e,i,t);const r=await Hu(Zt(e,t));if(r.ok===!0)return r.value.data;cl(r.error),EPe(r.error)}async function Bvt(e,t,i){const r=await Hu(t.request(e,"json",i));if(r.ok===!0)return r.value;cl(r.error),EPe(r.error.details.url)}function EPe(e){throw new W("",`Request for object resource failed: ${e}`)}function Gvt(e){const t=e.params,i=t.topology;let r=!0;switch(t.vertexAttributes||(u0.warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=t.faces;if(n){if(t.vertexAttributes)for(const o in t.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(u0.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(u0.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(u0.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else u0.warn("Indexed geometries must specify faces"),r=!1;break}default:u0.warn(`Unsupported topology '${i}'`),r=!1}e.params.material||(u0.warn("Geometry requires material"),r=!1);const s=e.params.vertexAttributes;for(const n in s)s[n].values||(u0.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function jvt(e,t){const i=[],r=[],s=[],n=[],o=e.resource,a=Wb.parse(o.version||"1.0","wosr");Zvt.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions,p=e.textures;let f=0;const m=new Map;for(let g=0;g<c.length;g++){const y=c[g];if(!Gvt(y))continue;const x=Wvt(y),b=y.params.vertexAttributes,S=[];for(const k in b){const B=b[k],j=B.values;S.push([k,{data:j,size:B.valuesPerElement,exclusive:!0}])}const T=[];if(y.params.topology!=="PerAttributeArray"){const k=y.params.faces;for(const B in k)T.push([B,new Uint32Array(k[B].values)])}const C=p&&p[x.texture];if(C&&!m.has(x.texture)){const{image:k,params:B}=C,j=new En(k,B);n.push(j),m.set(x.texture,j)}const A=m.get(x.texture),O=A?A.id:void 0;let D=s[x.material]?s[x.material][x.texture]:null;if(!D){const k=h[x.material.substring(x.material.lastIndexOf("/")+1)].params;k.transparency===1&&(k.transparency=0);const B=C&&C.alphaChannelUsage,j=k.transparency>0||B==="transparency"||B==="maskAndTransparency",H=C?CPe(C.alphaChannelUsage):void 0,K={ambient:Tc(k.diffuse),diffuse:Tc(k.diffuse),opacity:1-(k.transparency||0),transparent:j,textureAlphaMode:H,textureAlphaCutoff:.33,textureId:O,initTextureTransparent:!0,doubleSided:!0,cullFace:Ir.None,colorMixMode:k.externalColorMixMode||"tint",textureAlphaPremultiplied:!!C&&!!C.params.preMultiplyAlpha};_(t)&&t.materialParamsMixin&&Object.assign(K,t.materialParamsMixin),D=new kS(K),s[x.material]||(s[x.material]={}),s[x.material][x.texture]=D}r.push(D);const U=new vs(S,T);f+=T.position?T.position.length:0,i.push(U)}return{name:l,stageResources:{textures:n,materials:r,geometries:i},pivotOffset:o.model.pivotOffset,boundingBox:Hvt(i),numberOfVertices:f,lodThreshold:null}}function Hvt(e){const t=Nr();return e.forEach(i=>{const r=i.boundingInfo;_(r)&&(qg(t,r.getBBMin()),qg(t,r.getBBMax()))}),t}async function qvt(e,t){const i=[];for(const n in e){const o=e[n],a=o.images[0].data;if(!a){u0.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:$t.REPEAT,t:$t.REPEAT},preMultiplyAlpha:CPe(h)!==Rr.Opaque},f=_(t)&&t.disableTextures?Promise.resolve(null):lm(l,t);i.push(f.then(m=>({refId:c,image:m,params:p,alphaChannelUsage:h})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function CPe(e){switch(e){case"mask":return Rr.Mask;case"maskAndTransparency":return Rr.MaskBlend;case"none":return Rr.Opaque;default:return Rr.Blend}}function Wvt(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const Zvt=new Wb(1,2,"wosr"),nE=2.1;async function APe(e,t){const i=MPe(hJ(e));if(i.fileType==="wosr"){const l=await(t.cache?t.cache.loadWOSR(i.url,t):SPe(i.url,t)),c=jvt(l,t);return{lods:[c],referenceBoundingBox:c.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:l.remove}}const r=await(t.cache?t.cache.loadGLTF(i.url,t,t.usePBR):TPe(new wPe(t.streamDataRequester),i.url,t,t.usePBR)),s=Wr(r.model.meta,"ESRI_proxyEllipsoid");r.meta.isEsriSymbolResource&&_(s)&&r.meta.uri.includes("/RealisticTrees/")&&Jvt(r,s);const n=r.meta.isEsriSymbolResource?{usePBR:t.usePBR,isSchematic:!1,treeRendering:!!r.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:t.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},o=me(F({},t.materialParamsMixin),{treeRendering:!!r.customMeta.esriTreeRendering});if(i.specifiedLodIndex!=null){const l=vk(r,n,o,i.specifiedLodIndex);let c=l[0].boundingBox;return i.specifiedLodIndex!==0&&(c=vk(r,n,o,0)[0].boundingBox),{lods:l,referenceBoundingBox:c,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1,remove:r.remove}}const a=vk(r,n,o);return{lods:a,referenceBoundingBox:a[0].boundingBox,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1,remove:r.remove}}function MPe(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:t[4]!=null?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function vk(e,t,i,r){const s=e.model,n=ls(),o=new Array,a=new Map,l=new Map;return s.lods.forEach((c,h)=>{if(r!==void 0&&h!==r)return;const p={name:c.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:_(c.lodThreshold)?c.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:Nr()};o.push(p),c.parts.forEach(f=>{const m=f.material+(f.attributes.normal?"_normal":"")+(f.attributes.color?"_color":"")+(f.attributes.texCoord0?"_texCoord0":"")+(f.attributes.tangent?"_tangent":""),g=s.materials.get(f.material),y=_(f.attributes.texCoord0),x=_(f.attributes.normal),b=Xvt(g.alphaMode);if(!a.has(m)){if(y){if(_(g.textureColor)&&!l.has(g.textureColor)){const le=s.textures.get(g.textureColor),z=me(F({},le.parameters),{preMultiplyAlpha:b!==Rr.Opaque});l.set(g.textureColor,new En(le.data,z))}if(_(g.textureNormal)&&!l.has(g.textureNormal)){const le=s.textures.get(g.textureNormal);l.set(g.textureNormal,new En(le.data,le.parameters))}if(_(g.textureOcclusion)&&!l.has(g.textureOcclusion)){const le=s.textures.get(g.textureOcclusion);l.set(g.textureOcclusion,new En(le.data,le.parameters))}if(_(g.textureEmissive)&&!l.has(g.textureEmissive)){const le=s.textures.get(g.textureEmissive);l.set(g.textureEmissive,new En(le.data,le.parameters))}if(_(g.textureMetallicRoughness)&&!l.has(g.textureMetallicRoughness)){const le=s.textures.get(g.textureMetallicRoughness);l.set(g.textureMetallicRoughness,new En(le.data,le.parameters))}}const k=g.color[0]**(1/nE),B=g.color[1]**(1/nE),j=g.color[2]**(1/nE),H=g.emissiveFactor[0]**(1/nE),K=g.emissiveFactor[1]**(1/nE),ee=g.emissiveFactor[2]**(1/nE),ce=_(g.textureColor)&&y?l.get(g.textureColor):null;a.set(m,new kS(F(me(F({},t),{transparent:b===Rr.Blend,customDepthTest:xS.Lequal,textureAlphaMode:b,textureAlphaCutoff:g.alphaCutoff,diffuse:[k,B,j],ambient:[k,B,j],opacity:g.opacity,doubleSided:g.doubleSided,doubleSidedType:"winding-order",cullFace:g.doubleSided?Ir.None:Ir.Back,hasVertexColors:!!f.attributes.color,hasVertexTangents:!!f.attributes.tangent,normals:x?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:_(ce)?ce.id:void 0,colorMixMode:g.colorMixMode,normalTextureId:_(g.textureNormal)&&y?l.get(g.textureNormal).id:void 0,textureAlphaPremultiplied:_(ce)&&!!ce.params.preMultiplyAlpha,occlusionTextureId:_(g.textureOcclusion)&&y?l.get(g.textureOcclusion).id:void 0,emissiveTextureId:_(g.textureEmissive)&&y?l.get(g.textureEmissive).id:void 0,metallicRoughnessTextureId:_(g.textureMetallicRoughness)&&y?l.get(g.textureMetallicRoughness).id:void 0,emissiveFactor:[H,K,ee],mrrFactors:[g.metallicFactor,g.roughnessFactor,t.mrrFactors[2]],isSchematic:!1}),i)))}const S=Yvt(f.indices||f.attributes.position.count,f.primitiveType),T=f.attributes.position.count,C=pT(fr,T);WL(C,f.attributes.position,f.transform);const A=[[P.POSITION,{data:C.typedBuffer,size:C.elementCount,exclusive:!0}]],O=[[P.POSITION,S]];if(_(f.attributes.normal)){const k=pT(fr,T);vM(n,f.transform),jb(k,f.attributes.normal,n),A.push([P.NORMAL,{data:k.typedBuffer,size:k.elementCount,exclusive:!0}]),O.push([P.NORMAL,S])}if(_(f.attributes.tangent)){const k=pT(Ho,T);vM(n,f.transform),gPe(k,f.attributes.tangent,n),A.push([P.TANGENT,{data:k.typedBuffer,size:k.elementCount,exclusive:!0}]),O.push([P.TANGENT,S])}if(_(f.attributes.texCoord0)){const k=pT(Mp,T);vPe(k,f.attributes.texCoord0),A.push([P.UV0,{data:k.typedBuffer,size:k.elementCount,exclusive:!0}]),O.push([P.UV0,S])}if(_(f.attributes.color)){const k=pT(Hc,T);if(f.attributes.color.elementCount===4)f.attributes.color instanceof Ho?dJ(k,f.attributes.color,255):f.attributes.color instanceof Hc?_Pe(k,f.attributes.color):f.attributes.color instanceof Nb&&dJ(k,f.attributes.color,1/256);else{bPe(k,255,255,255,255);const B=new Db(k.buffer,0,4);f.attributes.color instanceof fr?eJ(B,f.attributes.color,255):f.attributes.color instanceof Db?a8(B,f.attributes.color):f.attributes.color instanceof OS&&eJ(B,f.attributes.color,1/256)}A.push([P.COLOR,{data:k.typedBuffer,size:k.elementCount,exclusive:!0}]),O.push([P.COLOR,S])}const D=new vs(A,O);p.stageResources.geometries.push(D),p.stageResources.materials.push(a.get(m)),y&&(_(g.textureColor)&&p.stageResources.textures.push(l.get(g.textureColor)),_(g.textureNormal)&&p.stageResources.textures.push(l.get(g.textureNormal)),_(g.textureOcclusion)&&p.stageResources.textures.push(l.get(g.textureOcclusion)),_(g.textureEmissive)&&p.stageResources.textures.push(l.get(g.textureEmissive)),_(g.textureMetallicRoughness)&&p.stageResources.textures.push(l.get(g.textureMetallicRoughness))),p.numberOfVertices+=T;const U=D.boundingInfo;_(U)&&(qg(p.boundingBox,U.getBBMin()),qg(p.boundingBox,U.getBBMax()))})}),o}function Xvt(e){switch(e){case"BLEND":return Rr.Blend;case"MASK":return Rr.Mask;case"OPAQUE":case null:case void 0:return Rr.Opaque}}function Yvt(e,t){switch(t){case Wt.TRIANGLES:return kvt(e);case Wt.TRIANGLE_STRIP:return Uvt(e);case Wt.TRIANGLE_FAN:return zvt(e)}}function Jvt(e,t){for(let i=0;i<e.model.lods.length;++i){const r=e.model.lods[i];e.customMeta.esriTreeRendering=!0;for(const s of r.parts){const n=s.attributes.normal;if(M(n))return;const o=s.attributes.position,a=o.count,l=$(),c=$(),h=$(),p=pT(Hc,a),f=pT(fr,a),m=Ks(Ne(),s.transform);for(let g=0;g<a;g++){o.getVec(g,c),n.getVec(g,l),Xe(c,c,s.transform),xe(h,c,t.center),Zk(h,h,t.radius);const y=h[2],x=Ue(h),b=Math.min(.45+.55*x*x,1);Zk(h,h,t.radius),Xe(h,h,m),Re(h,h),i+1!==e.model.lods.length&&e.model.lods.length>1&&Pn(h,h,l,y>-1?.2:Math.min(-4*y-3.8,1)),f.setVec(g,h),p.set(g,0,255*b),p.set(g,1,255*b),p.set(g,2,255*b),p.set(g,3,255)}s.attributes.normal=f,s.attributes.color=p}}}var K5t=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",fetch:APe,gltfToEngineResources:vk,parseUrl:MPe}),is;function Qvt(e){let t=Bs().mat4f64(P.LOCALTRANSFORM).mat4f64(P.GLOBALTRANSFORM).vec4f64(P.BOUNDINGSPHERE).vec3f64(P.MODELORIGIN).mat3f(P.MODEL).mat3f(P.MODELNORMAL).vec2f(P.MODELSCALEFACTORS);return e.includes("color")&&(t=t.vec4f(P.COLOR)),e.includes("featureAttribute")&&(t=t.vec4f(P.FEATUREATTRIBUTE)),t=t.u8(P.STATE).u8(P.LODLEVEL).alignTo(8),t}(function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"})(is||(is={}));class Kvt{constructor(t){this.localTransform=t.getField(P.LOCALTRANSFORM,Lb),this.globalTransform=t.getField(P.GLOBALTRANSFORM,Lb),this.modelOrigin=t.getField(P.MODELORIGIN,fn),this.model=t.getField(P.MODEL,cm),this.modelNormal=t.getField(P.MODELNORMAL,cm),this.modelScaleFactors=t.getField(P.MODELSCALEFACTORS,Mp),this.boundingSphere=t.getField(P.BOUNDINGSPHERE,CS),this.color=t.getField(P.COLOR,Ho),this.featureAttribute=t.getField(P.FEATUREATTRIBUTE,Ho),this.state=t.getField(P.STATE,Ev),this.lodLevel=t.getField(P.LODLEVEL,Ev)}}class e_t extends cs{constructor(t,i){super(),this._capacity=0,this._size=0,this._next=0,this._layout=Qvt(t),this._shaderTransformation=i}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const t=this._findSlot();return this._view.state.set(t,is.ALLOCATED),this._size++,this.emit("instance-added",{index:t}),t}removeInstance(t){const i=this._view.state;Ct(t>=0&&t<this._capacity&&i.get(t)&is.ALLOCATED,"invalid instance handle"),this._getStateFlag(t,is.ACTIVE)?this._setStateFlags(t,is.REMOVE):this.freeInstance(t),this.emit("instance-removed",{index:t})}freeInstance(t){const i=this._view.state;Ct(t>=0&&t<this._capacity&&i.get(t)&is.ALLOCATED,"invalid instance handle"),i.set(t,0),this._size--}setLocalTransform(t,i,r=!0){this._view.localTransform.setMat(t,i),r&&this.updateModelTransform(t)}getLocalTransform(t,i){this._view.localTransform.getMat(t,i)}setGlobalTransform(t,i,r=!0){this._view.globalTransform.setMat(t,i),r&&this.updateModelTransform(t)}getGlobalTransform(t,i){this._view.globalTransform.getMat(t,i)}updateModelTransform(t){const i=this._view,r=m_,s=Vp;i.localTransform.getMat(t,sfe),i.globalTransform.getMat(t,S7);const n=As(S7,S7,sfe);he(r,n[12],n[13],n[14]),i.modelOrigin.setVec(t,r),Cp(s,n),i.model.setMat(t,s);const o=pGe(m_,n);o.sort(),i.modelScaleFactors.set(t,0,o[1]),i.modelScaleFactors.set(t,1,o[2]),l2(s,s),Ap(s,s),i.modelNormal.setMat(t,s),this._setStateFlags(t,is.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:t})}getModelTransform(t,i){const r=this._view;r.model.getMat(t,Vp),r.modelOrigin.getVec(t,m_),i[0]=Vp[0],i[1]=Vp[1],i[2]=Vp[2],i[3]=0,i[4]=Vp[3],i[5]=Vp[4],i[6]=Vp[5],i[7]=0,i[8]=Vp[6],i[9]=Vp[7],i[10]=Vp[8],i[11]=0,i[12]=m_[0],i[13]=m_[1],i[14]=m_[2],i[15]=1}applyShaderTransformation(t,i){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i)}getCombinedModelTransform(t,i){return this.getModelTransform(t,i),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i),i}getCombinedLocalTransform(t,i){return this._view.localTransform.getMat(t,i),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i),i}getCombinedMaxScaleFactor(t){let i=this._view.modelScaleFactors.get(t,1);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(m_,this,t);i*=Math.max(r[0],r[1],r[2])}return i}getCombinedMedianScaleFactor(t){let i=this._view.modelScaleFactors.get(t,0);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(m_,this,t);r.sort(),i*=r[1]}return i}getModel(t,i){this._view.model.getMat(t,i)}setFeatureAttribute(t,i){this._view.featureAttribute.setVec(t,i)}getFeatureAttribute(t,i){this._view.featureAttribute.getVec(t,i)}setColor(t,i){this._view.color.setVec(t,i)}getColor(t,i){this._view.color.getVec(t,i)}setVisible(t,i){i!==this.getVisible(t)&&(this._setStateFlag(t,is.VISIBLE,i),this.emit("instance-visibility-changed",{index:t}))}getVisible(t){return this._getStateFlag(t,is.VISIBLE)}setHighlight(t,i){i!==this.getHighlight(t)&&(this._setStateFlag(t,is.HIGHLIGHT,i),this.emit("instance-highlight-changed",{index:t}))}getHighlight(t){return this._getStateFlag(t,is.HIGHLIGHT)}getState(t){return this._view.state.get(t)}getLodLevel(t){return this._view.lodLevel.get(t)}countFlags(t){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&t&&++i;return i}_setStateFlags(t,i){const r=this._view.state;i=r.get(t)|i,r.set(t,i)}_clearStateFlags(t,i){const r=this._view.state;i=r.get(t)&~i,r.set(t,i)}_setStateFlag(t,i,r){r?this._setStateFlags(t,i):this._clearStateFlags(t,i)}_getStateFlag(t,i){return!!(this._view.state.get(t)&i)}_grow(){const t=Math.max(t_t,Math.floor(this._capacity*i_t)),i=this._layout.createBuffer(t);if(this._buffer){const r=new Uint8Array(this._buffer.buffer);new Uint8Array(i.buffer).set(r)}this._capacity=t,this._buffer=i,this._view=new Kvt(this._buffer)}_findSlot(){const t=this._view.state;let i=this._next;for(;t.get(i)&is.ALLOCATED;)i=(i+1)%this._capacity;return this._next=(i+1)%this._capacity,i}}const t_t=1024,i_t=2,m_=$(),Vp=ls(),sfe=Ne(),S7=Ne();class r_t extends Vf{constructor(t,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=fo(),this._tmpMat4=Ne(),this._instanceData=t,this._boundingSphere=i}addInstance(t){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(t,this._tmpMat4);Xe(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*mS(r),i.setVec(t,this._tmpSphere),this.add([t])}removeInstance(t){this.remove([t])}}class s_t{constructor(t,i){this.thresholdScale=1,this._camera=new xr,this._worldSpaceRadius=t,this._thresholds=i.map(r=>r)}updateCamera(t){this._camera.copyFrom(t)}selectLevel(t,i){const r=this._camera.computeScreenPixelSizeAt(t),s=this._worldSpaceRadius*i/r,n=this._thresholds;let o=-1;for(let a=0;a<n.length;++a)s>=n[a]*this.thresholdScale&&(o=a);return o}}class n_t{constructor(t,i){const r=t.renderContext.rctx,{geometry:s,material:n}=i;this._materialRepository=t.materialRep,n.setParameters({instancedDoublePrecision:!0});const o=n.createBufferWriter(),a=o.vertexBufferLayout,l=o.elementCount(s),c=o.allocate(l);o.write({},s,c,0),this.geometry=s,this.material=n,this.glMaterials=new lRe(n,this._materialRepository),this.vertexBufferLayout=a,this.vbo=Ci.createVertex(r,Wi.STATIC_DRAW,c.buffer),this.vao=new Ln(r,lr,{geometry:Xu(a)},{geometry:this.vbo}),this.vertexCount=l}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(t,i,r,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,null,t.transform.transform,t,r,s,(h,p,f,m,g)=>{if(h>=0){if(i!=null&&!i(t.rayBegin,t.rayEnd,h))return;const y={layerUid:o.layerUid,graphicUid:o.graphicUid(n),geometryId:c,triangleNr:f,baseBoundingSphere:a,numLodLevels:l};if((t.results.min.drapedLayerOrder==null||g>=t.results.min.drapedLayerOrder)&&(t.results.min.dist==null||h<t.results.min.dist)&&t.results.min.set(xs.LOD,y,h,p,t.transform.transform,g),t.options.store!==Vo.MIN&&(t.results.max.drapedLayerOrder==null||g>=t.results.max.drapedLayerOrder)&&(t.results.max.dist==null||h>t.results.max.dist)&&t.results.max.set(xs.LOD,y,h,p,t.transform.transform,g),t.options.store===Vo.ALL){const x=Aie(t.results.min.ray);x.set(xs.LOD,y,h,p,t.transform.transform,g),t.results.all.push(x)}}})}}class Cre{constructor(t,i){this.minScreenSpaceRadius=t,this.components=i}static async create(t,i,r){const s=await Promise.allSettled(i.components.map(o=>t.schedule(()=>new n_t(t,o),r))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(o=>o);if(an(r)||n.length!==s.length){n.forEach(o=>o.destroy()),qt(r);for(const o of s)if(o.status==="rejected")throw o.reason}return new Cre(i.minScreenSpaceRadius,n)}destroy(){this.components.forEach(t=>t.destroy())}intersect(t,i,r,s,n,o,a){this.components.forEach(l=>l.intersect(t,i,r,s,n,o,this.boundingSphere,a))}get boundingBox(){if(M(this._boundingBox)){const t=Nr();this.components.forEach(i=>{_(i.boundingInfo)&&(qg(t,i.boundingInfo.bbMin),qg(t,i.boundingInfo.bbMax))}),this._boundingBox=t}return this._boundingBox}get boundingSphere(){if(M(this._boundingSphere)){const t=this.boundingBox,i=$();Df(t,i),this._boundingSphere={center:i,radius:.5*a1e(t)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((t,i)=>t+i.triangleCount,0)}}class o_t{constructor(t,i,r){this._elementSize=i,this._buffer=Ci.createVertex(t,Wi.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(t,i,r,s=0){const n=new Uint8Array(this.array,t*this.elementSize,(i-t)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(t,i){const r=t*this._elementSize,s=i*this._elementSize;this._buffer.setSubData(this._array,r,r,s)}resize(t){const i=t*this._elementSize,r=new ArrayBuffer(i);this._array&&(t>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,t*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=t}}class a_t{constructor(t){this.modelOriginHi=t.getField(P.MODELORIGINHI,fr),this.modelOriginLo=t.getField(P.MODELORIGINLO,fr),this.model=t.getField(P.MODEL,cm),this.modelNormal=t.getField(P.MODELNORMAL,cm),this.color=t.getField(P.INSTANCECOLOR,Ho),this.featureAttribute=t.getField(P.INSTANCEFEATUREATTRIBUTE,Ho)}}class nfe{constructor(t,i){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=t,this._instanceBufferLayout=i,this._elementSize=i.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const t=this._headIndex,i=this._tailIndex;return t>=i?t-i:t+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCylce(){this._captureFirstIndex=!0}beginUpdate(){Ct(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){Ct(this._updating,"not updating"),this.size<c_t*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){Ct(this._updating,"not updating"),this.isFull&&this._grow();const t=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=t,this._captureFirstIndex=!1),this._incrementHead(),Ct(this._headIndex!==this._tailIndex,"invalid pointers"),t}freeTail(){Ct(this._updating,"not updating"),Ct(this.size>0,"invalid size");const t=this._tailIndex===this._firstIndex;this._incrementTail(),t&&(this._firstIndex=this._tailIndex)}_grow(){const t=Math.max(ofe,Math.floor(this._capacity*l_t));this._resize(t)}_shrink(){const t=Math.max(ofe,Math.floor(this._capacity*u_t));this._resize(t)}_resize(t){if(Ct(this._updating,"not updating"),t===this._capacity)return;const i=new o_t(this._rctx,this._elementSize,t);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(i);Ct(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=t,this._buffer=i,this._view=new a_t(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(t){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,t),i-r):r>i?(this._buffer.copyRange(r,this._capacity,t),i>0&&this._buffer.copyRange(0,i,t,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(t=1){this._headIndex=(this._headIndex+t)%this._capacity}_incrementTail(t=1){this._tailIndex=(this._tailIndex+t)%this._capacity}_transferRange(t,i){t<i?this._buffer.transferRange(t,i):t>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(t,this._capacity))}}const ofe=1024,l_t=2,c_t=.3,u_t=.5;let h_t=e=>{const t=e.baseBoundingSphere.radius,i=e.levels.map(r=>r.minScreenSpaceRadius);return new s_t(t,i)};class d_t{constructor(t,i,r,s){this.type=xs.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new xr,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[$e.OPAQUE_MATERIAL,$e.TRANSPARENT_MATERIAL],this.canRender=!0,this._symbol=t,this._optionalFields=i,this._metadata=r,this._instanceBufferLayout=YRe({instancedDoublePrecision:!0,instanced:i}),this._glInstanceBufferLayout=Xu(this._instanceBufferLayout,1),this._instanceData=new e_t(this._optionalFields,s),this._instanceData.on("instance-added",()=>this._requestUpdateCycle()),this._instanceData.on("instance-removed",()=>this._requestUpdateCycle()),this._instanceData.on("instance-transform-changed",n=>{this._requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(n.index)}),this._instanceData.on("instance-visibility-changed",n=>{this._requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(n.index)}),this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0)),this._enableLevelSelection=this._symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(t){this._slicePlane=t}get layerUid(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const t={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(i=>{const r=i.memoryUsage;t.cpu+=r.cpu,t.gpu+=r.gpu}),this._highlightRenderInstanceData.forEach(i=>{const r=i.memoryUsage;t.cpu+=r.cpu,t.gpu+=r.gpu}),t}get renderStats(){const t=this._instanceData.size,i=[];return this._levels.forEach((r,s)=>{const n=this._defaultRenderInstanceData[s],o=this._highlightRenderInstanceData[s],a=n.size+o.size,l=r.triangleCount;i.push({renderedInstances:a,renderedTriangles:a*l,trianglesPerInstance:l})}),{totalInstances:t,renderedInstances:i.reduce((r,s)=>r+s.renderedInstances,0),renderedTriangles:i.reduce((r,s)=>r+s.renderedTriangles,0),levels:i}}async initializeRenderContext(t,i){this._context=t;const r=t.renderContext.rctx,s=await Promise.allSettled(this._symbol.levels.map(o=>(this._defaultRenderInstanceData.push(new nfe(r,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new nfe(r,this._instanceBufferLayout)),Cre.create(t,o,i)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(o=>o);if(an(i)||n.length!==s.length){n.forEach(o=>o.destroy()),qt(i);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=h_t(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(t=>t.destroy()),this._defaultRenderInstanceData.forEach(t=>t.destroy()),this._highlightRenderInstanceData.forEach(t=>t.destroy())}get needsTransparentPass(){return this._levels.some(t=>t.components.some(i=>i.material.requiresSlot($e.TRANSPARENT_MATERIAL)))}get needsHighlight(){return this._highlightRenderInstanceData.some(t=>t.size>0)}prepareRender(t){if(dr.LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const r=t.bindParameters.contentCamera.equals(this._lastCamera);this._lastCamera.copyFrom(t.bindParameters.contentCamera),r||this._requestUpdateCycle()}const i=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this._updateInstances(t.bindParameters.contentCamera,i),this.needsUpdates&&this._context.requestRender()}render(t){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(t.pass))return;t.rctx.bindVAO();const i=t.pass!==rt.MATERIAL_HIGHLIGHT&&t.pass!==rt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,r=t.pass!==rt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT;i&&this._renderComponents(t,this._defaultRenderInstanceData),r&&this._renderComponents(t,this._highlightRenderInstanceData)}intersect(t,i,r,s){if(!this.baseMaterial.isVisible())return;const n=$();xe(n,s,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,cfe),t.transform.set(cfe),Xe(ufe,r,t.transform.inverse),Xe(hfe,s,t.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;Ct(l&is.ACTIVE,"invalid instance state"),Ct(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(t,i,ufe,hfe,a,this._metadata,h)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(o):this.octree.forEachAlongRay(r,n,o)}queryDepthRange(t){return this._queryDepthRangeOctree(t)}notifyShaderTransformationChanged(){this._invalidateOctree()}_requestUpdateCycle(t=!1){this._updateCyclesWithStaticCamera=-1,t&&(this._needFullCycle=!0),this.needsUpdates&&this._context.requestRender()}get needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get octree(){return this._octree||(this._octree=this._buildOctree()),this._octree}_invalidateOctree(){this._octree&&(this._octree.destroy(),this._octree=null)}_buildOctree(){const t=new r_t(this._instanceData,this.baseBoundingSphere),i=this._instanceData,r=i.view?i.view.state:null;for(let s=0;s<this._instanceData.capacity;++s)r.get(s)&is.ACTIVE&&t.addInstance(s);return t}_queryDepthRangeOctree(t){const i=t.eye,r=t.viewForward,s=this.octree.findClosest(r,Vf.DepthOrder.FRONT_TO_BACK,t.frustum),n=this.octree.findClosest(r,Vf.DepthOrder.BACK_TO_FRONT,t.frustum);if(s!=null&&n!=null){this._instanceData.view.boundingSphere.getVec(s,Im),xe(Im,Im,i);const o=Pe(Im,r)-Im[3];this._instanceData.view.boundingSphere.getVec(n,Im),xe(Im,Im,i);const a=Pe(Im,r)+Im[3];return{near:Math.max(t.near,o),far:Math.min(t.far,a)}}return{near:1/0,far:-1/0}}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this.needsUpdates&&this._context.requestRender()}_updateInstances(t,i){const r=this._enableLevelSelection,s=this._levelSelector;s.updateCamera(t),this._defaultRenderInstanceData.forEach(h=>{h.beginUpdate()}),this._highlightRenderInstanceData.forEach(h=>{h.beginUpdate()});const n=this._instanceData,o=this._instanceData.view,a=n.size,l=n.capacity;let c=this._instanceIndex;i=Math.min(a,i);for(let h=0;h<i;++h){c===0&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&is.ALLOCATED)){c=(c+1)%l,i++;continue}const m=o.lodLevel.get(c);if(p&is.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[m].freeTail(),p&is.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[m].freeTail(),p&is.REMOVE)n.freeInstance(c);else if(p&is.VISIBLE){let g=0;r&&(o.modelOrigin.getVec(c,lfe),g=s.selectLevel(lfe,n.getCombinedMedianScaleFactor(c))),f=p&~(is.ACTIVE|is.TRANSFORM_CHANGED),g>=0&&(p&is.HIGHLIGHT?(afe(this._highlightRenderInstanceData[g],o,c),f|=is.HIGHLIGHT_ACTIVE):(afe(this._defaultRenderInstanceData[g],o,c),f|=is.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,g)}else f=p&~(is.ACTIVE|is.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octree){const g=!!(p&is.ACTIVE),y=!!(f&is.ACTIVE);!g&&y?this._octree.addInstance(c):g&&!y?this._octree.removeInstance(c):g&&y&&p&is.TRANSFORM_CHANGED&&(this._octree.removeInstance(c),this._octree.addInstance(c))}c=(c+1)%l}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(h=>{h.endUpdate()}),this._highlightRenderInstanceData.forEach(h=>{h.endUpdate()})}_renderComponents(t,i){this.levels.forEach((r,s)=>{r.components.forEach(n=>{this._renderComponent(t,i[s],n,s)})})}_renderComponent(t,i,r,s){const n=t.bindParameters;if(i.size===0||!r.material.requiresSlot(n.slot))return;const{rctx:o,pass:a}=t,l=r.glMaterials.load(o,a);if(M(l))return;const c=l.beginSlot(n),h=o.bindTechnique(c,r.material.parameters,n);o.bindVAO(r.vao),c.ensureAttributeLocations(r.vao),c.bindDraw(f_t,n),dr.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&t.pass===rt.MATERIAL&&(h.setUniform4fv("externalColor",dfe[Math.min(s,dfe.length-1)]),h.setUniform1i("colorMixMode",tOe.replace));const p=o.capabilities.instancing,f=i.capacity,m=i.headIndex,g=i.tailIndex,y=i.firstIndex,x=this._glInstanceBufferLayout,b=(S,T)=>{Kte(o,lr,i.buffer,x,S),p.drawArraysInstanced(c.primitiveType,0,r.vertexCount,T-S),eie(o,lr,i.buffer,x)};r.material.parameters.transparent&&y!=null?m>g?(Ct(y>=g&&y<=m,"invalid firstIndex"),b(y,m),b(g,y)):m<g&&(y<=m?(Ct(y>=0&&y<=m,"invalid firstIndex"),b(y,m),b(g,f),b(0,y)):(Ct(y>=g&&y<=f,"invalid firstIndex"),b(y,f),b(0,m),b(g,y))):m>g?b(g,m):m<g&&(b(0,m),b(g,f)),o.bindVAO(null)}}function afe(e,t,i){const r=e.allocateHead();p_t(t,i,e.view,r)}function p_t(e,t,i,r){Llt(e.modelOrigin,t,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,e.model,t),i.modelNormal.copyFrom(r,e.modelNormal,t),e.color&&i.color&&i.color.copyFrom(r,e.color,t),e.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,e.featureAttribute,t)}const lfe=$(),Im=si(),cfe=Ne(),ufe=$(),hfe=$(),dfe=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]],f_t=new Fgt;class m_t extends by{constructor(t,i,r,s){super(t,i,r,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this.hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this.hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}getCachedSize(){const[t,i,r]=_(this._resources)?this._resources.symbolSize:[1,1,1];return{width:t,depth:i,height:r}}async doLoad(t){if(!this._drivenProperties.size&&N6(this.symbolLayer))throw new Error;const i=this.symbolLayer;if(this.isPrimitive){const r=i.resource?i.resource.primitive:OK;this._resources=await this._createResourcesForPrimitive(r,t)}else this._resources=await this._createResourcesForUrl(i.resource.href,t);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return _(this._resources)?this._resources.extentPadding:0}get isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return Wr(this._resources,"lodRenderer")}_setMaterialTransparencyParams(t,i=Wr(this.symbolLayer,"material","color")){const r=this._getCombinedOpacity(i),s=r<1||this.needsDrivenTransparentPass;return t.transparent=s,t.opacity=r,t.cullFace=s?Ir.None:Ir.Back,t}async _createResourcesForPrimitive(t,i){if(!wft(t))throw new Error(`Unknown object symbol primitive: ${t}`);const r=this.symbolLayer,s=In(rVe(t)),n=Tc(LD(s)),o=Tc(zG(n,r)),a=Ue(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:Cg,diffuse:Cg,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=h.usePBR;this._setMaterialTransparencyParams(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:b,minWorldLength:S,maxWorldLength:T}=f.verticalOffset;h.verticalOffset={screenLength:$i(b),minWorldLength:S||0,maxWorldLength:T!=null?T:1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=lp;else{const b=_(r.material)&&r.material.color,S=_(b)?Le.toUnitRGBA(b):lp;h.externalColor=S}this._fastUpdates=k$(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,x1)),h.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(h,this._fastUpdates.materialParameters),h.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.instanced.push("color"),this._optionalFields.push("color"));const m=new kS(h),g=WOe(t,m);if(!g)throw new Error(`Unknown object symbol primitive: ${t}`);const y=rF(g).map(b=>({opacity:1,transparent:b.parameters.transparent})),x=await this._createStageResources(g,p);return{lodResources:g,lodRenderer:await this._createLodRenderer(g,i),stageResources:x,symbolSize:o,extentPadding:a,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:y,physicalBasedRenderingEnabled:p,resourceBoundingBox:s,resourceSize:n,pivotOffset:x1}}async _createResourcesForUrl(t,i){const r=["transformation"],s={materialParamsMixin:{instanced:r,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=k$(this._context.renderer,this._fastVisualVariableConvertOptions(x1,x1,x1,x1)),this._fastUpdates.enabled?(Object.assign(s.materialParamsMixin,this._fastUpdates.materialParameters),r.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(r.push("color"),this._optionalFields.push("color"));const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:k,minWorldLength:B,maxWorldLength:j}=n.verticalOffset;s.materialParamsMixin.verticalOffset={screenLength:$i(k),minWorldLength:B||0,maxWorldLength:j!=null?j:1/0},s.materialParamsMixin.castShadows=!1}s.signal=i,s.usePBR=this._context.physicalBasedRenderingEnabled;const o=s.usePBR,a=await APe(t,s),l=a.isEsriSymbolResource,c=a.isWosr;this._addDisposeResource(()=>a.remove());const h=K0t(a.lods);tvt(h),h.levels.sort((k,B)=>k.minScreenSpaceRadius-B.minScreenSpaceRadius),h.levels[0].minScreenSpaceRadius=Math.min(2,h.levels[0].minScreenSpaceRadius);const p=this._context,f=this.symbolLayer.material,m=this._getExternalColorParameters(f),g=Wr(this.symbolLayer,"material","color"),y=this._getCombinedOpacity(g,{hasIntrinsicColor:!0}),x=this.needsDrivenTransparentPass,b=rF(h),S=rF(h).map(k=>({opacity:k.parameters.opacity||1,transparent:k.parameters.transparent}));b.forEach(k=>{const B=k.parameters;k.setParameters(m);const j=B.opacity*y,H=j<1||x||B.transparent;k.setParameters({opacity:j,transparent:H}),p.screenSizePerspectiveEnabled&&k.setParameters({screenSizePerspective:p.sharedResources.screenSizePerspectiveSettings})});const T=a.referenceBoundingBox,C=Tc(LD(T)),A=Tc(h.levels[0].pivotOffset),O=Tc(zG(C,this.symbolLayer)),D=Ue(O);U$(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(T,O,C,A))&&b.forEach(k=>k.setParameters(this._fastUpdates.materialParameters));const U=await this._createStageResources(h,o);return{lodResources:h,lodRenderer:await this._createLodRenderer(h,i),stageResources:U,symbolSize:O,extentPadding:D,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:S,physicalBasedRenderingEnabled:o,resourceBoundingBox:T,resourceSize:C,pivotOffset:A}}_addDisposeResource(t){this._disposeResourceHandles.push(t)}async _createStageResources(t,i){const r=this._context.stage,s=rF(t);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),r.addMany(s),this._addDisposeResource(()=>r.removeMany(s));const n=Oft(t);r.addMany(n),this._addDisposeResource(()=>r.removeMany(n)),await r.load(n);const o=Rft(t);return r.addMany(o),this._addDisposeResource(()=>r.removeMany(o)),{materials:s,textures:n,geometries:o}}async _createLodRenderer(t,i){const r=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:a=>this._instanceIndexToGraphicUid.get(a),notifyGraphicGeometryChanged:a=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(a)),notifyGraphicVisibilityChanged:a=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(a))},n=this._fastUpdates.enabled?{applyTransform:(a,l,c)=>{a.getFeatureAttribute(l,TF),ln(c,oJ(this._fastUpdates.materialParameters,TF,c))},scaleFactor:(a,l,c)=>(l.getFeatureAttribute(c,TF),wyt(a,this._fastUpdates.materialParameters,TF))}:null,o=new d_t(t,this._optionalFields,s,n);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(o)}),await r.addRenderPlugin(o.slots,o,i),o}_getExternalColorParameters(t){const i={};return this._drivenProperties.color?i.externalColor=lp:_(t)&&_(t.color)?i.externalColor=Le.toUnitRGBA(t.color):(i.externalColor=lp,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(t=>t()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry))return null;const r=L$(i.geometry);if(M(r))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const s=this.setGraphicElevationContext(i,new ud),n=t.renderingInfo;return this._createAs3DShape(i,r,n,s,i.uid)}notifyDestroyGraphicLayer(t){this._instanceIndexToGraphicUid.delete(t.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(M(this._resources))return!0;const t=this._drivenProperties.opacity,i=!this.isPrimitive,r=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<r.length;n++){const o=r[n],a=Wr(this.symbolLayer,"material","color"),l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:i})*l.opacity,h=c<1||t||l.transparent;o.setParameters({opacity:c,transparent:h}),this.isPrimitive&&o.setParameters({cullFace:h?Ir.None:Ir.Back})}return!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,Gb)}slicePlaneEnabledChanged(){if(M(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const t of this._resources.stageResources.materials)t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(M(this._resources))return!0;const{stageResources:t,isWosr:i}=this._resources;for(const r of t.materials)this.isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this.hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this.hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(t,i){if(M(this._resources))return qn.Recreate_Symbol;const{stageResources:{materials:r},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in t.diff){if(c!=="visualVariables"||!U$(this._fastUpdates,i,this._fastVisualVariableConvertOptions(n,o,a,l)))return qn.Recreate_Symbol;for(const h of r)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return qn.Fast_Update}computeComplexity(){return M(this._resources)?super.computeComplexity():{primitivesPerFeature:hre(this._resources.lodResources.levels[0]).reduce((t,i)=>t+i.indices.get(P.POSITION).length,0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:QOe(this.symbol,this.symbolLayer)}}_hasLodRenderer(){return _(this._resources)}_createAs3DShape(t,i,r,s,n){if(!this._hasLodRenderer()||M(this._resources))return null;const o=this.getFastUpdateAttrValues(t),a=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?r3(r.color,r.opacity):null,l=this._context.clippingExtent;if(Go(i,oE,this._context.elevationProvider.spatialReference),_(l)&&!fK(l,oE))return null;const c=this._requiresTerrainElevation(s),h=this._computeGlobalTransform(i,s,E7,SF),p=this._computeLocalTransform(this._resources,this.symbolLayer,r,pfe),f=this._resources.lodRenderer.instanceData,m=f.addInstance();this._instanceIndexToGraphicUid.set(m,n),f.setLocalTransform(m,p,!1),f.setGlobalTransform(m,h),o&&f.setFeatureAttribute(m,o),a&&f.setColor(m,a);const g=new Y0t(this,m,pft,s);return c&&(g.alignedSampledElevation=SF.sampledElevation),g.needsElevationUpdates=Gb(s.mode),$$(g,i,this._context.elevationProvider),g}_computeGlobalTransform(t,i,r,s){return Av(t,this._context.elevationProvider,i,this._context.renderCoordsHelper,s),oE[0]=t.x,oE[1]=t.y,oE[2]=s.z,nd(t.spatialReference,oE,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(t,i,r,s){return Yg(s),this._applyObjectRotation(r,!1,s),this._applyObjectRotation(i,!0,s),this._applyObjectScale(t,r,s),this._applyAnchor(t,i,s),s}_applyObjectScale(t,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._drivenProperties.size&&i.size?i.size:t.symbolSize,n=Nde(s,t.symbolSize,t.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||uB(r,r,n)}prepareSymbolLayerPatch(t){if(t.diff.type!=="partial")return;const i=t.diff.diff;this._preparePatchTransform(t,i),this._preparePatchColor(t,i)}updateGeometry(t,i){if(M(this._resources))return!0;const r=i&&L$(i);if(M(r))return!1;const s=this.getGeometryElevationMode(i);return t.elevationContext.mode===s&&(this._computeGlobalTransform(r,t.elevationContext,E7,SF),this._requiresTerrainElevation(t.elevationContext)&&(t.alignedSampledElevation=SF.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(t.instanceIndex,E7,!0),$$(t,r,this._context.elevationProvider),!0)}_preparePatchTransform(t,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||M(this._resources))return;const r=(g,y,x)=>Ye(g!=null&&g.type==="complete"?g.newValue:y,x),s=r(i.heading,this.symbolLayer.heading,0),n=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),h=r(i.anchor,this.symbolLayer.anchor,void 0),p=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:h,anchorPosition:p},m=this._resources;this.loadStatus===Lh.LOADED&&t.symbolLayerStatePatches.push(()=>{m.symbolSize=Tc(zG(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),t.graphics3DGraphicPatches.push((g,y)=>{const x=this._computeLocalTransform(m,f,y,pfe),b=g.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(b,x,!0)})}_preparePatchColor(t,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const s=r.color.newValue,n=_(s)?Le.toUnitRGBA(s):lp;delete r.color;const o=this._resources;M(o)||t.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(t){return t.mode!=="absolute-height"}_applyObjectRotation(t,i,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&i))return ift(t.heading,t.tilt,t.roll,r)}_computeAnchor(t,i,r){const s=$();switch(r.anchor){case"center":pe(s,Df(t)),ll(s,s);break;case"top":{const n=Df(t);he(s,-n[0],-n[1],-t[5]);break}case"bottom":{const n=Df(t);he(s,-n[0],-n[1],-t[2]);break}case"relative":{const n=Df(t),o=LD(t),a=r.anchorPosition,l=a?Ze(a.x,a.y,a.z):Hl;OV(s,o,l),we(s,s,n),ll(s,s);break}default:_(i)?ll(s,i):pe(s,Hl)}return s}_applyAnchor(t,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._computeAnchor(t.resourceBoundingBox,t.pivotOffset,i);s&&Zl(r,r,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(t,i,r,s){const n=_(t)?Tc(LD(t)):Cg,o=_(t)?this._computeAnchor(t,s,this.symbolLayer):Hl,a=this._context.renderCoordsHelper.unitInMeters,l=Nde(_(i)?i:void 0,i,r,a),c=Ze(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:_(i)?i:Cg,unitInMeters:a,transformation:{anchor:o,scale:l,rotation:c}}}}const oE=$(),pfe=Ne(),E7=Ne(),TF=si(),SF=new qL;function g_t(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function y_t(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function Are(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function v_t(e,t){if(e===t){const i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function __t(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*n-s*r;return o?(o=1/o,e[0]=n*o,e[1]=-r*o,e[2]=-s*o,e[3]=i*o,e):null}function b_t(e,t){const i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e}function w_t(e){return e[0]*e[3]-e[2]*e[1]}function OPe(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*a+n*l,e[1]=s*a+o*l,e[2]=r*c+n*h,e[3]=s*c+o*h,e}function x_t(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+n*a,e[1]=s*l+o*a,e[2]=r*-a+n*l,e[3]=s*-a+o*l,e}function T_t(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1];return e[0]=r*a,e[1]=s*a,e[2]=n*l,e[3]=o*l,e}function S_t(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e}function E_t(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function C_t(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function A_t(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)}function M_t(e,t,i,r){return e[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-e[2]*i[1],[e,t,i]}function O_t(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function RPe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function R_t(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function P_t(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=Ut*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Ut*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=Ut*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=Ut*Math.max(1,Math.abs(n),Math.abs(c))}function I_t(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function $_t(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}const L_t=OPe,D_t=RPe;Object.freeze(Object.defineProperty({__proto__:null,copy:g_t,identity:y_t,set:Are,transpose:v_t,invert:__t,adjoint:b_t,determinant:w_t,multiply:OPe,rotate:x_t,scale:T_t,fromRotation:S_t,fromScaling:E_t,str:C_t,frob:A_t,LDU:M_t,add:O_t,subtract:RPe,exactEquals:R_t,equals:P_t,multiplyScalar:I_t,multiplyScalarAndAdd:$_t,mul:L_t,sub:D_t},Symbol.toStringTag,{value:"Module"}));class N_t extends vs{constructor(t,i,r,s,n,o){super(t,i),this.path=r,this.geometrySR=s,this.upVectorAlignment=n,this.stencilWidth=o}}function PPe(e){return"upVectorAlignment"in e}function IPe(){return[1,0,0,1]}function F_t(e){return[e[0],e[1],e[2],e[3]]}function k_t(e,t,i,r){return[e,t,i,r]}function U_t(e,t){return new Float64Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:IPe,clone:F_t,fromValues:k_t,createView:U_t},Symbol.toStringTag,{value:"Module"}));function pJ(){return{up:$(),right:$()}}function z_t(e,t,i){Xe(e.up,t.up,i),Xe(e.right,t.right,i)}function V_t(e,t,i){Li(e,Pe(i,t.right),Pe(i,t.up))}class B_t{constructor(){this.pos=$(),this.posES=$(),this.posGS=$(),this.vRight=$(),this.vLeft=$(),this.frame=pJ(),this.rotationFrame=pJ(),this.rotationRight=Ke(),this.rotationAngle=0,this.miterStretch=IPe()}setFrameFromUpVector(t){pe(this.frame.up,t),we(kd,this.vLeft,this.vRight),Re(kd,kd),fe(hf,this.frame.up,Pe(kd,this.frame.up)),xe(CF,kd,hf),Re(CF,CF),Tt(this.frame.right,CF,this.frame.up)}computeRotationAxisAndAngleFromUpVector(){pe(this.rotationFrame.up,this.frame.up),pe(this.rotationFrame.right,this.frame.right),Li(this.rotationRight,1,0),fe(hf,this.frame.up,Pe(this.frame.up,this.vLeft)),xe(hf,this.vLeft,hf),ll(hf,hf),Re(hf,hf),fe(kd,this.frame.up,Pe(this.frame.up,this.vRight)),xe(kd,this.vRight,kd),Re(kd,kd),Tt(fJ,this.rotationFrame.up,this.vLeft);const t=Math.sign(Pe(fJ,this.vRight));if(this.rotationAngle=t*(Math.PI-Yn(Pe(hf,kd))),Math.abs(this.rotationAngle)>0){const r=qH(Math.cos(.5*this.rotationAngle));Are(this.miterStretch,r-1+1,0,0,1)}const i=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*i))}}class V${constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}addVertex(t,i){return this.vertices.push(TT(t)),this.vertexNormals.push(TT(i)),this.vertices.length-1}addUV(t){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(t),this.uvs.length-1}addPole(t,i=null){return this.poles.push({position:TT(t),normal:i?TT(i):null}),this.poles.length-1}addSegment(t,i=null,r=null){this.vertexIndices.push(t.v0),this.vertexIndices.push(t.v1),i&&(this.uvIndices.push(i.v0),this.uvIndices.push(i.v1)),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.vertexIndices.length/2}hasUV(){return this.uvs!=null}translate(t,i){for(const r of this.vertices)r[0]+=t,r[1]+=i;for(const r of this.poles)r.position[0]+=t,r.position[1]+=i}static circle(t=20){const r=new V$,s={v0:0,v1:0};r.addPole(er(0,0));for(let a=0;a<t;++a){const l=2*a*Math.PI/t,c=Math.cos(l),h=Math.sin(l),p=er(c*.5,h*.5),f=er(c,h);r.addVertex(p,f),r.addUV(a/t)}r.addUV(1);for(let a=0;a<t-1;++a){const l={v0:a,v1:a+1},c=l;r.addSegment(l,c,s)}const n={v0:t-1,v1:0},o={v0:t-1,v1:t};return r.addSegment(n,o,s),r}static rect(){const r=new V$,s=er(.5*-1,.5*-1),n=er(.5*1,.5*-1),o=er(.5*1,.5*1),a=er(.5*-1,.5*1),l=er(0,-1),c=er(1,0),h=er(0,1),p=er(-1,0);r.addUV(0),r.addUV(1),r.addPole(er(0,.5*1),h),r.addPole(er(0,.5*1)),r.addPole(er(0,.5*-1)),r.addPole(er(0,.5*-1),l);const f={v0:0,v1:1};return r.addVertex(s,l),r.addVertex(n,l),r.addSegment({v0:0,v1:1},f,{v0:3,v1:3}),r.addVertex(n,c),r.addVertex(o,c),r.addSegment({v0:2,v1:3},f,{v0:2,v1:1}),r.addVertex(o,h),r.addVertex(a,h),r.addSegment({v0:4,v1:5},f,{v0:0,v1:0}),r.addVertex(a,p),r.addVertex(s,p),r.addSegment({v0:6,v1:7},f,{v0:1,v1:2}),r}}class G_t{constructor(t){this.vertices=[],this.offset=$(),this.xform=Ne(),this.vertices=t;const i=Math.floor((t.length-1)/2);pe(this.offset,this.vertices[i].pos);for(const r of this.vertices)xe(r.pos,r.pos,this.offset);Zl(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const t=this.vertices.length;let i=this.vertices[0];i.index=0,he(i.vLeft,0,0,0),i.vLeftLength=0,xe(i.vRight,this.vertices[1].pos,i.pos),i.vRightLength=Ue(i.vRight),Re(i.vRight,i.vRight);let r=i;for(let s=1;s<t;++s)i=this.vertices[s],i.index=s,pe(i.vLeft,r.vRight),i.vLeftLength=r.vRightLength,s<t-1?(xe(i.vRight,this.vertices[s+1].pos,i.pos),i.vRightLength=Ue(i.vRight),Re(i.vRight,i.vRight)):(pe(i.vRight,i.vLeft),i.vRightLength=i.vLeftLength),r=i}}function j_t(e,t){let i=null;const r=e.vertices.length,s=.99619469809,n=$(),o=$(),a=$(),l=$(),c=$(),h=$(),p=qi();let f=e.vertices[0];pe(o,t),he(n,0,1,0),vu.makeOrthoBasisDirUpFallback(f.vRight,o,n,n,a,o,s),pe(f.frame.up,o),pe(f.frame.right,a),i=f;for(let m=1;m<r;++m){f=e.vertices[m],we(c,f.vLeft,f.vRight);let g=Ue(c);g>0?(g=1/Math.sqrt(g),c[0]=c[0]*g,c[1]=c[1]*g,c[2]=c[2]*g):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),we(h,i.pos,i.frame.up),iM(f.pos,c,p),t2(p,od(h,f.vLeft),l)?(xe(l,l,f.pos),Re(o,l),Tt(a,c,o),Re(a,a)):vu.makeOrthoBasisDirUpFallback(c,i.frame.up,i.frame.right,n,a,o,s),pe(f.frame.up,o),pe(f.frame.right,a),i=f}}class H_t{numProfilesPerJoin(){return 1}extrude(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],!1)}}class C7{constructor(t=.8*Math.PI,i=1){this.cutoffAngle=t,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(t,i,r){const s=Q_t;if(Math.abs(t.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){sd(gfe,.5*-t.rotationAngle+n*t.rotationAngle/this.numBendSubdivisions,t.rotationFrame.up),z_t(s,t.frame,gfe);for(let o=0;o<i.vertices.length;++o)ys(i.vertices[o],t.rotationRight)*t.rotationAngle>=0?r(t.index,s,i.vertices[o],i.vertexNormals[o],!1):(EY(FT,i.vertices[o],t.miterStretch),r(t.index,t.frame,FT,i.vertexNormals[o],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let o=0;o<i.vertices.length;++o){const a=ys(i.vertices[o],t.rotationRight)*t.rotationAngle>=0;EY(FT,i.vertices[o],t.miterStretch),r(t.index,t.frame,FT,i.vertexNormals[o],!a)}}}const q_t={generateUV:!1};class Mre{rebuildConnectingProfileGeometry(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],0,0)}}class ffe extends Mre{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class EF extends Mre{constructor(t,i=0,r=!1){super(),this.profile=t,this.profilePlaneOffset=i,this.flip=r}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],this.profilePlaneOffset,0)}rebuildCapGeometry(t,i){const r=Ore;Li(r,0,0);const s=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)i(t.index,t.frame,this.profile.vertices[n],r,this.profilePlaneOffset,s)}buildTopology(t,i){const r=this.vertexBufferStart+this.profile.vertexIndices[0];for(let s=1;s<this.profile.numSegments;++s){const n=this.profile.vertexIndices[2*s+0],o=this.profile.vertexIndices[2*s+1],a=this.vertexBufferStart+n,l=this.vertexBufferStart+o;this.flip?i(l,a,r):i(r,a,l)}}}class mfe extends Mre{constructor(t){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=t.profile,this.flip=t.flip,this.sign=this.flip?1:-1,this.breakNormals=t.breakNormals,this.numSegments=t.subdivisions}getNumVertices(){let t=0;return t=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(t+=this.profile.vertices.length),t+=this.profile.poles.length,t}getNumIndices(){let t=0;t+=2*this.profile.numSegments*(this.numSegments-1);for(let i=0;i<this.profile.numSegments;++i){const r=this.profile.vertexIndices[2*i+0],s=this.profile.vertexIndices[2*i+1];this.profile.poleIndices[r]===this.profile.poleIndices[s]?t+=1:t+=2}return 3*t}rebuildCapGeometry(t,i){const r=t.frame,s=.5*this.sign,n=FT,o=Ore;Li(o,0,0);for(let a=0;a<this.profile.poles.length;++a){const l=this.profile.poles[a];l.normal?i(t.index,r,l.position,l.normal,s,0):i(t.index,r,l.position,o,s,this.sign)}if(this.breakNormals)for(let a=0;a<this.profile.vertices.length;++a)i(t.index,r,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const l=(1-(a+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),h=Math.cos(l);for(let p=0;p<this.profile.vertices.length;++p){const f=this.profile.poles[this.profile.poleIndices[p]];Ss(n,this.profile.vertices[p],f.position),Oc(n,n,c),f.normal?($h(n,n,f.position),i(t.index,r,n,f.normal,s*h,0)):(pM(o,n),Oc(o,o,c),$h(n,n,f.position),i(t.index,r,n,o,s*h,this.sign*h))}}}buildTopology(t,i){const r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const o=this.profile.vertexIndices[2*n+0],a=this.profile.vertexIndices[2*n+1],l=this.vertexBufferStart+this.profile.poleIndices[o],c=this.vertexBufferStart+this.profile.poleIndices[a];let h=r+o,p=r+a;for(let f=0;f<this.numSegments-1;++f){const m=s+f*this.profile.vertices.length+o,g=s+f*this.profile.vertices.length+a;this.flip?(i(m,p,h),i(p,m,g)):(i(h,p,m),i(g,m,p)),h=m,p=g}this.flip?(i(l,p,h),l!==c&&i(l,c,p)):(i(h,p,l),l!==c&&i(p,c,l))}}}class W_t{constructor(t,i,r,s,n,o=q_t){this.options=o,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=i,this.path=t,this.extruder=r,this.startCap=s,this.endCap=n;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(t,i,r,s,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,n){const o=this.path.vertices[t];this.profileRightAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[0]*o.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[1]*o.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(t,i,r,s,n,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount}emitTriangle(t,i,r){this.vertexIndices[3*this._triangleCount+0]=t,this.vertexIndices[3*this._triangleCount+1]=i,this.vertexIndices[3*this._triangleCount+2]=r,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[t],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[i],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[r],this.normalIndices[3*this._triangleCount+0]=t,this.normalIndices[3*this._triangleCount+1]=i,this.normalIndices[3*this._triangleCount+2]=r,++this._triangleCount}_rebuildGeometry(){const t=(r,s,n,o,a)=>this.emitVertex(r,s,n,o,a),i=(r,s,n,o,a,l)=>this.emitCapVertex(r,s,n,o,a,l);this._extrusionVertexCount=0;for(const r of this.path.vertices)this.originData[3*r.index+0]=r.pos[0],this.originData[3*r.index+1]=r.pos[1],this.originData[3*r.index+2]=r.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,i);for(let r=1;r<this.path.vertices.length-1;++r)this.extruder.extrude(this.path.vertices[r],this.profile,t);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,i),this.startCap.rebuildCapGeometry(this.path.vertices[0],i),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],i),this.profile.hasUV()&&this.options.generateUV)for(let r=0;r<this.profile.uvs.length;++r)this.uvData[2*r+0]=this.profile.uvs[r],this.uvData[2*r+1]=0}buildTopology(){const t=(o,a,l)=>this.emitTriangle(o,a,l);this._triangleCount=0;const i=this.profile.vertices.length,r=this.profile.numSegments,s=this.numExtrusionProfiles-1;let n=3*(2*(r*s));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=i*(this.numExtrusionProfiles-1),n+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(n),this.normalIndices=new Uint32Array(n),this.pathVertexIndices=new Uint32Array(n),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(n));for(let o=0;o<r;++o){const a=this.profile.vertexIndices[2*o],l=this.profile.vertexIndices[2*o+1];for(let c=0;c<s;++c){const h=c*i+a,p=(c+1)*i+l,f=c*i+l;t(h,(c+1)*i+a,p),t(h,p,f)}}this.startCap.buildTopology(this.path.vertices[0],t),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],t)}onPathChanged(){this._rebuildGeometry()}}class $Pe{constructor(t){this.builder=t}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class LPe extends $Pe{constructor(t){super(t),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(t){this.vertexAttributeColor[0]=255*t[0],this.vertexAttributeColor[1]=255*t[1],this.vertexAttributeColor[2]=255*t[2],this.vertexAttributeColor[3]=255*(t.length>3?t[3]:1)}bake(t){this.size=t;for(let i=0;i<this.builder.numVerticesTotal;++i){let r=this.builder.pathVertexData[i];const s=r===0||r===this.builder.path.vertices.length-1;r*=3;const n=X_t;he(n,this.builder.originData[r++],this.builder.originData[r++],this.builder.originData[r]);const o=4*i,a=hf,l=FT,c=kd,h=fJ,p=J_t;let f=0,m=0;if(he(h,this.builder.profileRightAxisData[o],this.builder.profileRightAxisData[o+1],this.builder.profileRightAxisData[o+2]),he(p,this.builder.profileUpAxisData[o],this.builder.profileUpAxisData[o+1],this.builder.profileUpAxisData[o+2]),Li(l,this.builder.profileVertexAndNormalData[o]*t[0],this.builder.profileVertexAndNormalData[o+1]*t[1]),s)Tt(c,p,h),f=this.builder.profileRightAxisData[o+3]*t[0],m=this.builder.profileUpAxisData[o+3];else{const y=Ore,x=Y_t;Li(y,this.builder.profileRightAxisData[o+3],this.builder.profileUpAxisData[o+3]);const b=a6(y);pM(y,y);const S=ys(l,y);if(Math.abs(S)>b){Li(x,-y[1],y[0]);const T=ys(l,x);Oc(y,y,b*Math.sign(S)),Oc(x,x,T),$h(l,y,x)}he(c,0,0,0)}he(a,h[0]*l[0]+p[0]*l[1],h[1]*l[0]+p[1]*l[1],h[2]*l[0]+p[2]*l[1]),this.vertexAttributePosition[3*i+0]=n[0]+a[0]+c[0]*f,this.vertexAttributePosition[3*i+1]=n[1]+a[1]+c[1]*f,this.vertexAttributePosition[3*i+2]=n[2]+a[2]+c[2]*f;const g=FT;Li(g,this.builder.profileVertexAndNormalData[o+2],this.builder.profileVertexAndNormalData[o+3]),this.vertexAttributeNormal[3*i+0]=h[0]*g[0]+p[0]*g[1]+c[0]*m,this.vertexAttributeNormal[3*i+1]=h[1]*g[0]+p[1]*g[1]+c[1]*m,this.vertexAttributeNormal[3*i+2]=h[2]*g[0]+p[2]*g[1]+c[2]*m}}createGeometryData(){const t=[[P.POSITION,this.builder.vertexIndices],[P.NORMAL,this.builder.normalIndices]],i=[[P.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[P.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];if(this.vertexAttributeColor){const r=this.builder.vertexIndices.length;t.push([P.COLOR,new Uint32Array(r)]),i.push([P.COLOR,{size:4,data:this.vertexAttributeColor}])}return{vertexAttributes:i,indices:t}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(t,i,r){const s=this.builder.vertexIndices,n={size:3,data:this.vertexAttributePosition},o=s.length/3;zL(t,i,0,o,s,n,void 0,void 0,r)}}class Z_t extends $Pe{constructor(t,i,r,s){super(t),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=s,this.vvData=null,this.baked=new LPe(t),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=i,this.vvData[4*n+1]=r,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return{vertexAttributes:[[P.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[P.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],[P.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[P.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[P.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[P.POSITION,this.builder.pathVertexIndices],[P.PROFILERIGHT,this.builder.vertexIndices],[P.PROFILEUP,this.builder.vertexIndices],[P.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[P.FEATUREVALUE,this.builder.pathVertexIndices]]}}}const X_t=$(),FT=Ke(),Ore=Ke(),Y_t=Ke(),hf=$(),kd=$(),fJ=$(),J_t=$(),CF=$(),Q_t=pJ(),gfe=Ne(),A7=8;function K_t(e,t){e.attributes.add(P.FEATUREVALUE,"vec4");const i=e.vertex;i.code.add(E`bool isCapVertex() {
return featureValue.w == 1.0;
}`),i.uniforms.add(new Di("size",r=>r.size)),t.vvSize?(i.uniforms.add(new Dt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new Dt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new Dt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new Dt("vvSizeFactor",r=>r.vvSizeFactor)),i.code.add(E`vec2 getSize() {
return size * clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):i.code.add(E`vec2 getSize(){
return size;
}`),t.vvOpacity?(i.constants.add("vvOpacityNumber","int",A7),i.uniforms.add([new ol("vvOpacityValues",r=>r.vvOpacityValues,A7),new ol("vvOpacityOpacities",r=>r.vvOpacityOpacities,A7)]),i.code.add(E`vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):i.code.add(E`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(i.constants.add("vvColorNumber","int",Qf),i.uniforms.add([new ol("vvColorValues",r=>r.vvColorValues,Qf),new P6("vvColorColors",r=>r.vvColorColors,Qf)]),i.code.add(E`vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):i.code.add(E`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(H6),e.attributes.add(P.PROFILERIGHT,"vec4"),e.attributes.add(P.PROFILEUP,"vec4"),e.attributes.add(P.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(E`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(E`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(E`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(E`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class e1t extends ire{constructor(){super(...arguments),this.size=er(1,1)}}function t1t(e){const t=new mr,i=Kh(t,e),{vertex:r,fragment:s}=t;return t.varyings.add("vpos","vec3"),t.include(K_t,e),e.output!==oe.Color&&e.output!==oe.Alpha||(t.include(Ua),t.include(NS,e),t.include(YL,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(E`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${e.output===oe.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),t.include(ld,e),e.output===oe.Alpha&&(t.include(Qs,e),s.uniforms.add(new lt("opacity",n=>n.opacity)),s.code.add(E`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `)),e.output===oe.Color&&(t.include(Qs,e),t.include(FS,e),t.include(KL,e),t.include(NS,e),t.include(kRe,e),ry(s,e),s.uniforms.add([i,new Dt("ambient",n=>n.ambient),new Dt("diffuse",n=>n.diffuse),new Dt("specular",n=>n.specular),new lt("opacity",n=>n.opacity),new lt("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new Dt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),s.constants.add("ambientBoostFactor","float",xO),s.include(gy),s.code.add(E`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===Rt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==oe.Depth&&e.output!==oe.Shadow||(t.include(Ua,{hasModelTransformation:!1,linearDepth:!0}),r.uniforms.add(new Di("nearFar",(n,o)=>o.camera.nearFar)),t.varyings.add("depth","float"),r.code.add(E`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(Qs,e),t.include(tw,e),s.code.add(E`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`)),e.output===oe.Normal&&(t.include(Ua),t.include(ob,e),r.uniforms.add(new Xr("viewNormal",(n,o)=>o.camera.viewInverseTransposeMatrix)),t.varyings.add("vnormal","vec3"),r.code.add(E`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(Qs,e),s.uniforms.add(new Gl("waterColor")),s.code.add(E`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`)),e.output===oe.Highlight&&(t.include(Ua),t.include(ob,e),t.varyings.add("vnormal","vec3"),r.code.add(E`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(Qs,e),t.include(Bv),s.code.add(E`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const i1t=Object.freeze(Object.defineProperty({__proto__:null,build:t1t},Symbol.toStringTag,{value:"Module"})),DPe=new Map([[P.POSITION,0],[P.PROFILERIGHT,1],[P.PROFILEUP,2],[P.PROFILEVERTEXANDNORMAL,3],[P.FEATUREVALUE,4]]);class r1t extends e1t{constructor(){super(...arguments),this.ambient=Ze(.2,.2,.2),this.diffuse=Ze(.8,.8,.8),this.specular=Ze(0,0,0),this.opacity=1}}class l8 extends Lr{initializeConfiguration(t,i){i.spherical=t.viewingMode===tt.Global,i.doublePrecisionRequiresObfuscation=XL(t.rctx)}initializeProgram(t){const i=l8.shader.get().build(this.configuration);return new Er(t.rctx,i,DPe)}_setPipelineState(t){const i=this.configuration,r=t===Rt.NONE,s=t===Rt.FrontFace,n=o=>!o.hasSlicePlane&&!(o.transparent||o.doubleSidedMode===Cs.None);return ri({blending:i.output!==oe.Color&&i.output!==oe.Alpha||!i.transparent?null:r?ed:Gv(t),culling:n(i)&&ICe,depthTest:{func:ew(t)},depthWrite:r||s?jc:null,colorWrite:xi,stencilWrite:i.hasOccludees?ny:null,stencilTest:i.hasOccludees?iw:null,polygonOffset:r||s?null:L6})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}l8.shader=new Sr(i1t,()=>import("./Path.glsl.6495cebc.js"));class To extends al{constructor(){super(...arguments),this.output=oe.Color,this.doubleSidedMode=Cs.None,this.transparencyPassType=Rt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}}u([Q({count:oe.COUNT})],To.prototype,"output",void 0),u([Q({count:Cs.COUNT})],To.prototype,"doubleSidedMode",void 0),u([Q({count:Rt.COUNT})],To.prototype,"transparencyPassType",void 0),u([Q()],To.prototype,"spherical",void 0),u([Q()],To.prototype,"receiveShadows",void 0),u([Q()],To.prototype,"receiveAmbientOcclusion",void 0),u([Q()],To.prototype,"vvSize",void 0),u([Q()],To.prototype,"vvColor",void 0),u([Q()],To.prototype,"vvOpacity",void 0),u([Q()],To.prototype,"hasSlicePlane",void 0),u([Q()],To.prototype,"transparent",void 0),u([Q()],To.prototype,"hasOccludees",void 0),u([Q()],To.prototype,"hasMultipassTerrain",void 0),u([Q()],To.prototype,"cullAboveGround",void 0),u([Q()],To.prototype,"doublePrecisionRequiresObfuscation",void 0),u([Q({constValue:Gt.Disabled})],To.prototype,"pbrMode",void 0),u([Q({constValue:!0})],To.prototype,"hasVvInstancing",void 0),u([Q({constValue:!1})],To.prototype,"useCustomDTRExponentForWater",void 0),u([Q({constValue:!1})],To.prototype,"useFillLights",void 0);class Rre extends vy{constructor(t){super(t,new n1t),this.supportsEdges=!0,this._vertexAttributeLocations=DPe,this._configuration=new To,this.vertexBufferLayout=Rre.getVertexBufferLayout(this.parameters)}getConfiguration(t,i){return this._configuration.output=t,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,t!==oe.Color&&t!==oe.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Cs.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Cs.WindingOrder:Cs.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!i.ssaoHelper.ready&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleInPass(t){return t!==rt.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==rt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==rt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;return!!super.isVisible()&&t.opacity>0}intersect(t,i,r,s,n,o,a){const l=t;if(!PPe(l))return;const c=l.path,h=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const b=this.parameters.vvSizeOffset,S=this.parameters.vvSizeFactor,T=this.parameters.vvSizeMinSize,C=this.parameters.vvSizeMaxSize,A=c.sizeAttributeValue;h[0]*=He(b[0]+A*S[0],T[0],C[0]),h[1]*=He(b[2]+A*S[2],T[2],C[2])}const p=Math.max(h[0],h[1]),f=t.boundingInfo;if(M(f))return void this._intersectTriangles(c,h,n,o,a);const m=dS(f.bbMin[0]-p,f.bbMin[1]-p,f.bbMin[2]-p,f.bbMax[0]+p,f.bbMax[1]+p,f.bbMax[2]+p),g=[o[0]-n[0],o[1]-n[1],o[2]-n[2]],y=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]),x=[y/g[0],y/g[1],y/g[2]];Yie(m,n,x,s.tolerance)&&this._intersectTriangles(c,h,n,o,a)}_intersectTriangles(t,i,r,s,n){t.baked.size&&t.baked.size[0]===i[0]&&t.baked.size[1]===i[1]||t.baked.bake(i),t.baked.intersect(r,s,n)}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return null;const s=r.get(P.POSITION);return xie(s,null,!1,i)}createBufferWriter(){return new o1t(this.vertexBufferLayout)}requiresSlot(t){return t===(this.parameters.transparent?$e.TRANSPARENT_MATERIAL:$e.OPAQUE_MATERIAL)||t===$e.DRAPED_MATERIAL}createGLMaterial(t){return t.output===oe.Color||t.output===oe.Alpha||t.output===oe.Depth||t.output===oe.Normal||t.output===oe.Highlight||t.output===oe.Shadow&&this.parameters.castShadows?new s1t(t):null}static getVertexBufferLayout(t){let i=Bs().vec3f(P.POSITION).vec4f(P.PROFILERIGHT).vec4f(P.PROFILEUP).vec4f(P.PROFILEVERTEXANDNORMAL);return(t.vvColorEnabled||t.vvSizeEnabled||t.vvOpacityEnabled)&&(i=i.vec4f(P.FEATUREVALUE)),i}}class s1t extends Qb{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}_updateShadowState(t){(M(this.technique)||t.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}beginSlot(t){return this._output!==oe.Color&&this._output!==oe.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this.ensureTechnique(l8,t)}}class n1t extends r1t{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}class o1t{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(P.POSITION).length}write(t,i,r,s){const n=o=>{if(i.vertexAttributes.has(o)){const a=i.vertexAttributes.get(o),l=i.indices.get(o);Ct(a.size===4);const c=r.getField(o,Ho);if(!c)throw new Error("unable to acquire view for "+o);RM(l,a.data,c,s)}};n(P.PROFILERIGHT),n(P.PROFILEUP),n(P.PROFILEVERTEXANDNORMAL),this.vertexBufferLayout.hasField(P.FEATUREVALUE)&&n(P.FEATUREVALUE),R6(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}const a1t=["polyline"];class l1t extends by{constructor(t,i,r,s){super(t,i,r,s),this._intrinsicSize=er(1,1),this.upVectorAlignment="path",this.stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const t=_(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,i=_(this.symbolLayer.height)?this.symbolLayer.height:t;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[t,1,i],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=k$(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const r=this.symbolLayer.anchor||"center";this.upVectorAlignment="path",this.symbolLayer.profileRotation==="heading"&&(this.upVectorAlignment="world");const s=this.symbolLayer.profile||"circle";switch(s){case"circle":default:this._profile=V$.circle(p1t);break;case"quad":this._profile=V$.rect()}let n=[0,0];switch(r!=="center"&&(n={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[r],this._profile.translate(n[0],n[1])),this.symbolLayer.join||"simple"){case"round":this._extruder=new C7(0,d1t);break;case"bevel":this._extruder=new C7(0,1);break;case"miter":this._extruder=new C7(.8*Math.PI,1);break;default:this._extruder=new H_t}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new ffe,this._endCap=new ffe;break;case"butt":default:this._startCap=new EF(this._profile,0),this._endCap=new EF(this._profile,0,!0);break;case"square":this._startCap=new EF(this._profile,-.5),this._endCap=new EF(this._profile,.5,!0);break;case"round":{const m=s==="quad";this._startCap=new mfe({profile:this._profile,flip:!1,breakNormals:m,subdivisions:_fe}),this._endCap=new mfe({profile:this._profile,flip:!0,breakNormals:m,subdivisions:_fe});break}}const a=Wr(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(a),c=Tc(l),h=l[3],p=h<1||this.needsDrivenTransparentPass,f={diffuse:c,ambient:c,opacity:h,transparent:p,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||o==="none"?Ir.None:Ir.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(Li(this._intrinsicSize,t,i),!Zz(this._intrinsicSize[0])||!Zz(this._intrinsicSize[1])))throw new W("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||Oc(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const m=me(F(F({},f),this._fastUpdates.materialParameters),{size:awe(this._intrinsicSize)});this._material=new Rre(m)}else f.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new kS(f);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,a1t,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new ud),s=t.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(){const t=Wr(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(t),r=i<1||this.needsDrivenTransparentPass;return this._material.setParameters({opacity:i,transparent:r}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,Gb)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!U$(this._fastUpdates,i,this._vvConvertOptions))return qn.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return qn.Fast_Update}getVertexData(t){let i=0;const r=t.paths,s=[],n=t.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const m of r)i+=m.length;const l=new Float64Array(3*i),c=new Float64Array(3*i),h=new Float64Array(3*i);let p=0;for(const m of r){s.push({index:p,numVertices:m.length});for(const g of m)l[p++]=g[0],l[p++]=g[1],l[p++]=t.hasZ?g[2]:0}let f=!0;return n.equals(o)?this._copyVertices(l,0,c,0,i):f=$r(l,n,0,c,o,0,i),o.equals(a)?this._copyVertices(c,0,h,0,i):$r(c,o,0,h,a,0,i),{pathVertexDataInfos:s,vertexDataGS:l,vertexDataES:c,vertexDataRS:h,projectionSuccess:f,terrainElevation:0}}_copyVertices(t,i,r,s,n){i*=3,s*=3;for(let o=0;o<n;++o)r[s++]=t[i++],r[s++]=t[i++],r[s++]=t[i++]}_createAs3DShape(t,i,r,s){const n=t.geometry,o=new Array,a=new Array,l=new Array,c=n.spatialReference,h=In(),p=this._context.renderCoordsHelper;FPe.spatialReference=c;const f=this.getVertexData(n);if(!f.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(f.pathVertexDataInfos.length>0){for(let m=0;m<f.pathVertexDataInfos.length;++m){const g=f.pathVertexDataInfos[m],y=g.index,x=g.numVertices;if(x<2||_(this._context.clippingExtent)&&(Nr(h),qh(h,f.vertexDataES,3*y,x),!Nf(h,this._context.clippingExtent)))continue;const b=[];for(let U=y;U<y+3*x;){const k=U++,B=U++,j=U++,H=new B_t;he(H.posGS,f.vertexDataGS[k],f.vertexDataGS[B],f.vertexDataGS[j]),he(H.posES,f.vertexDataES[k],f.vertexDataES[B],f.vertexDataES[j]);const K=rft(H.posES,this._context.elevationProvider,r,p);he(cp,f.vertexDataRS[k],f.vertexDataRS[B],f.vertexDataRS[j]),p.setAltitude(cp,K),he(H.pos,cp[0],cp[1],cp[2]),b.push(H)}const S=new G_t(b);NPe(S,this.upVectorAlignment,this._context.renderCoordsHelper);const T=new W_t(S,this._profile,this._extruder,this._startCap,this._endCap);let C=null;if(this._fastUpdates.enabled){const U=this._fastUpdates.visualVariables,k=U.size?rv(U.size.field,t):0,B=U.color?rv(U.color.field,t):0,j=U.opacity?rv(U.opacity.field,t):0;C=new Z_t(T,k,B,j)}else{const U=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(U[0]*=yfe(i.size[0],i.size[2]==="symbol-value"?this.symbolLayer.height||0:i.size[2],this.symbolLayer.width||0),U[1]*=yfe(i.size[2],i.size[0]==="symbol-value"?this.symbolLayer.width||0:i.size[0],this.symbolLayer.height||0));let k=null;this._drivenProperties.color&&(k=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(k=k?[k[0],k[1],k[2],i.opacity]:[1,1,1,i.opacity]);const B=new LPe(T);B.bake(U),k&&B.bakeVertexColors(k),C=B}const{vertexAttributes:A,indices:O}=C.createGeometryData(),D=new N_t(A,O,C,c,this.upVectorAlignment,this.stencilWidth);o.push(D),a.push(this._material),l.push(C.xform)}if(o.length>0){const m={layerUid:this._context.layer.uid,graphicUid:s},g=new Hv({geometries:o,materials:a,transformations:l,metadata:m}),y=new _y(this,g,o,null,null,u1t,r);return y.alignedSampledElevation=f.terrainElevation,y.needsElevationUpdates=Gb(r.mode),y}}else n.paths.length!==0&&n.paths.some(m=>m.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}}function NPe(e,t,i){switch(t){case"world":for(const r of e.vertices)we($m,r.pos,e.offset),i.worldUpAtPosition($m,cp),r.setFrameFromUpVector(cp),r.computeRotationAxisAndAngleFromUpVector();break;case"path":we($m,e.vertices[0].pos,e.offset),i.worldUpAtPosition($m,cp),j_t(e,cp);for(const r of e.vertices){const s=Math.sign(Pe(r.frame.right,r.vRight));Tt(r.rotationFrame.up,r.vRight,r.vLeft),fe(r.rotationFrame.up,r.rotationFrame.up,s),Re(r.rotationFrame.up,r.rotationFrame.up);const n=Pe(r.rotationFrame.up,r.frame.up),o=Pe(r.rotationFrame.up,r.frame.right);if(fe($m,r.frame.up,-o),fe(vfe,r.frame.right,n),we($m,$m,vfe),Re(r.rotationFrame.right,$m),V_t(r.rotationRight,r.frame,r.rotationFrame.right),ll($m,r.vLeft),r.rotationAngle=-s*(Math.PI-Yn(Pe($m,r.vRight))),Math.abs(r.rotationAngle)>0){const l=qH(Math.cos(.5*r.rotationAngle));Are(r.miterStretch,1+(l-1)*r.rotationRight[0]*r.rotationRight[0],(l-1)*r.rotationRight[0]*r.rotationRight[1],(l-1)*r.rotationRight[0]*r.rotationRight[1],1+(l-1)*r.rotationRight[1]*r.rotationRight[1])}const a=Math.PI-r.rotationAngle;r.maxStretchDistance=Math.abs(Math.min(r.vLeftLength,r.vRightLength)*qH(Math.cos(.5*a)))}}}function yfe(e,t,i){switch(e){case"symbol-value":return i;case"proportional":return t;default:return e}}function c1t(e,t,i,r){let s=0;for(const n of e.vertices)Av(n.posES,i,t,r,M7),s+=M7.sampledElevation,we(cp,n.pos,e.offset),r.setAltitude(cp,M7.z),xe(n.pos,cp,e.offset);return e.updatePathVertexInformation(),s/e.vertices.length}function u1t(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;let o=0;h1t.spatialReference=r.spatialReference;for(const a of n){const l=a.geometry;if(!PPe(l))continue;const c=l.path,h=c.builder.path,p=l.geometrySR;FPe.spatialReference=p,o+=c1t(h,t,i,r),l.upVectorAlignment!=="world"&&NPe(h,l.upVectorAlignment,r),c.onPathChanged(),l.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(a)}return o/n.length}const h1t=jv(0,0,0,null),FPe=jv(0,0,0,null),cp=$(),$m=Xi(),vfe=Xi(),M7=new qL,d1t=3,_fe=3,p1t=10;function f1t(e,t,i,r,s=1){if(i.isGeographic&&r===tt.Global){const a=new Float64Array(t.typedBuffer.length),l=3*t.count,c=Ri(i);for(let h=0;h<l;h+=3)qK(t.typedBuffer,h,a,h,c);t=fn.fromTypedArray(a)}Li(Gn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let a=0;a<t.count;a++)t.getVec(a,Cu),Gn[0]=Math.min(Gn[0],Cu[0]),Gn[1]=Math.min(Gn[1],Cu[1]);const n=Gn[0]%s,o=Gn[1]%s;sp[0]=Gn[0]-n,sp[1]=Gn[1]-o;for(let a=0;a<t.count;a++)t.getVec(a,Cu),e.setValues(a,(Cu[0]-sp[0])/s,(Cu[1]-sp[1])/s,sp[0]/s,sp[1]/s)}function kPe(e,t,i,r,s=1){he(Iw,1,0,0),he($w,0,1,0),he(aE,0,0,1),y1t(O7,t),m1t(t,bfe)&&g1t(bfe,Iw,$w,aE,i,O7),Li(Gn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Li(Lw,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let l=0;l<t.count;l++){t.getVec(l,Cu);const c=Pe(Iw,Cu),h=Pe($w,Cu);Gn[0]=Math.min(Gn[0],c),Gn[1]=Math.min(Gn[1],h),Lw[0]=Math.max(Lw[0],c),Lw[1]=Math.max(Lw[1],h)}const n=Pe(aE,O7);P7(g_,Gn[0],Gn[1],n,Iw,$w,aE),P7(Dw,Lw[0],Gn[1],n,Iw,$w,aE),P7(Nw,Gn[0],Lw[1],n,Iw,$w,aE),xe(Dw,Dw,g_),fe(Dw,Dw,.5),xe(Nw,Nw,g_),fe(Nw,Nw,.5),we(g_,g_,Dw),we(g_,g_,Nw);const o=Gn[0]%s,a=Gn[1]%s;sp[0]=Gn[0]-o,sp[1]=Gn[1]-a;for(let l=0;l<t.count;l++){t.getVec(l,Cu),e.setValues(l,(Pe(Iw,Cu)-sp[0])/s,(Pe($w,Cu)-sp[1])/s,sp[0]/s,sp[1]/s);for(let c=0;c<3;c++)r.set(l,c,g_[c]),r.set(l,c+3,Dw[c]),r.set(l,c+6,Nw[c])}}const O7=$(),Cu=$(),bfe=qi(),Iw=$(),$w=$(),aE=$(),Gn=Ke(),Lw=Ke(),sp=Ke(),g_=$(),Dw=$(),Nw=$();function m1t(e,t){const i=e.count-1;return Lwe(e,t,0,Math.floor(i/3),Math.floor(i*(2/3)))}function g1t(e,t,i,r,s,n){_(s)?(s.basisMatrixAtPosition(n,Lm),he(AF,Lm[0],Lm[1],Lm[2]),he(MF,Lm[4],Lm[5],Lm[6]),he(R7,Lm[8],Lm[9],Lm[10])):(he(AF,1,0,0),he(MF,0,1,0),he(R7,0,0,1));const o=e;Pe(o,R7)<0&&fe(o,o,-1),pe(r,o);const a=Pe(o,MF),l=Pe(o,AF);Math.abs(a)<Math.abs(l)?(_T(t,AF,o,-l),Re(t,t),Tt(i,t,o),Re(i,i),fe(i,i,-1)):(_T(i,MF,o,-a),Re(i,i),Tt(t,i,o),Re(t,t))}const Lm=Ne(),AF=$(),MF=$(),R7=$();function y1t(e,t){he(OF,0,0,0);for(let i=0;i<t.count-1;i++)t.getVec(i,Cu),we(OF,OF,Cu);fe(e,OF,1/(t.count-1))}const OF=$();function P7(e,t,i,r,s,n,o){he(e,t*s[0]+i*n[0]+r*o[0],t*s[1]+i*n[1]+r*o[1],t*s[2]+i*n[2]+r*o[2])}function v1t(e){const t=new mr,i=e.output===oe.Depth,r=e.hasMultipassTerrain&&(e.output===oe.Color||e.output===oe.Alpha);Kh(t,e),t.include(Ua,{hasModelTransformation:!1,linearDepth:i}),t.include(u2,e),t.attributes.add(P.POSITION,"vec3"),t.varyings.add("vpos","vec3"),r&&t.varyings.add("depth","float");const{vertex:s,fragment:n}=t;return i&&(t.include(tw,e),s.uniforms.add(new Di("nearFar",(o,a)=>a.camera.nearFar)),t.varyings.add("linearDepth","float")),s.code.add(E`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${i?E`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:E`transformPosition(proj, view, vpos);`}
    }
  `),t.include(Qs,e),r&&t.include(ld,e),n.include(gy),n.uniforms.add(new Ei("eColor",o=>o.color)),e.output===oe.Highlight&&t.include(Bv),n.code.add(E`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${e.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${E.float(Va)}) {
      discard;
    }

    ${e.output===oe.Alpha?E`gl_FragColor = vec4(fColor.a);`:""}

    ${e.output===oe.Color?E`gl_FragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===Rt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${e.output===oe.Highlight?E`outputHighlight();`:""};
    ${e.output===oe.Depth?E`outputDepth(linearDepth);`:""};
  }
  `),t}const _1t=Object.freeze(Object.defineProperty({__proto__:null,build:v1t},Symbol.toStringTag,{value:"Module"}));class c8 extends Lr{initializeProgram(t){const i=c8.shader.get().build(this.configuration);return new Er(t.rctx,i,lr)}_createPipeline(t,i){const r=this.configuration,s=t===Rt.NONE,n=t===Rt.FrontFace;return ri({blending:r.output!==oe.Color&&r.output!==oe.Alpha||!r.transparent?null:s?ed:Gv(t),culling:c6(r.cullFace),depthTest:{func:ew(t)},depthWrite:s||n?r.writeDepth&&jc:null,colorWrite:xi,stencilWrite:r.hasOccludees?ny:null,stencilTest:r.hasOccludees?i?Hb:iw:null,polygonOffset:s||n?r.polygonOffset&&b1t:D6(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}c8.shader=new Sr(_1t,()=>import("./ColorMaterial.glsl.050f218c.js"));const b1t={factor:1,units:1};class fh extends al{constructor(){super(...arguments),this.output=oe.Color,this.cullFace=Ir.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=Rt.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([Q({count:oe.COUNT})],fh.prototype,"output",void 0),u([Q({count:Ir.COUNT})],fh.prototype,"cullFace",void 0),u([Q()],fh.prototype,"hasSlicePlane",void 0),u([Q()],fh.prototype,"hasVertexColors",void 0),u([Q()],fh.prototype,"transparent",void 0),u([Q()],fh.prototype,"polygonOffset",void 0),u([Q()],fh.prototype,"enableOffset",void 0),u([Q()],fh.prototype,"writeDepth",void 0),u([Q()],fh.prototype,"hasOccludees",void 0),u([Q({count:Rt.COUNT})],fh.prototype,"transparencyPassType",void 0),u([Q()],fh.prototype,"hasMultipassTerrain",void 0),u([Q()],fh.prototype,"cullAboveGround",void 0);class wfe extends vy{constructor(t){super(t,new x1t),this.supportsEdges=!0,this._configuration=new fh}getConfiguration(t,i){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<$6,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(t,i,r,s,n,o,a){M6(t,i,s,n,o,void 0,a)}requiresSlot(t,i){return t===$e.DRAPED_MATERIAL?!0:DS(i)===oe.Highlight?t===$e.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?$e.TRANSPARENT_MATERIAL:$e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:$e.OPAQUE_MATERIAL)}createGLMaterial(t){return t.output===oe.Color||t.output===oe.Alpha||t.output===oe.Highlight||t.output===oe.Depth&&this.parameters.writeLinearDepth?new w1t(t):null}createBufferWriter(){return new Y6(ARe)}}class w1t extends Qb{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==oe.Color&&this._output!==oe.Alpha||this._updateOccludeeState(t),this.ensureTechnique(c8,t)}}class x1t extends AO{constructor(){super(...arguments),this.color=Dg,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Ir.None,this.hasOccludees=!1}}var pa;(function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"})(pa||(pa={}));const mJ=.70710678118,xfe=mJ,T1t=.08715574274;function S1t(e){const t=new mr,i=e.hasMultipassTerrain&&(e.output===oe.Color||e.output===oe.Alpha);e.draped||t.extensions.add("GL_OES_standard_derivatives");const r=e.output===oe.Depth,{vertex:s,fragment:n}=t;Kh(t,e),t.include(Ua,{hasModelTransformation:!1,linearDepth:r}),t.include(u2,e),r&&(t.include(tw,e),s.uniforms.add(new Di("nearFar",(a,l)=>l.camera.nearFar)),t.varyings.add("linearDepth","float")),e.draped?s.uniforms.add(new lt("worldToScreenRatio",(a,l)=>1/l.screenToPCSRatio)):t.attributes.add(P.BOUNDINGRECT,"mat3"),t.attributes.add(P.POSITION,"vec3"),t.attributes.add(P.UVMAPSPACE,"vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i&&t.varyings.add("depth","float");const o=e.style===pa.ForwardDiagonal||e.style===pa.BackwardDiagonal||e.style===pa.DiagonalCross;return o&&s.code.add(E`
      const mat2 rotate45 = mat2(${E.float(mJ)}, ${E.float(-xfe)},
                                 ${E.float(xfe)}, ${E.float(mJ)});
    `),e.draped||(ry(s,e),s.uniforms.add(new lt("worldToScreenPerDistanceRatio",(a,l)=>1/l.camera.perScreenPixelRatio)),s.code.add(E`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),s.code.add(E`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),s.code.add(E`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${E.float(T1t)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),s.code.add(E`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${o?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${o?" * rotate45":""};

      ${e.draped?"":E`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${E.float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),s.code.add(E`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${r?E`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:E`transformPosition(proj, view, vpos);`}
    }
  `),t.include(Qs,e),n.include(gy),e.draped&&n.uniforms.add(new lt("texelSize",(a,l)=>1/l.camera.pixelRatio)),e.output===oe.Highlight&&t.include(Bv),i&&t.include(ld,e),e.output!==oe.Highlight&&(n.code.add(E`
      const float lineWidth = ${E.float(e.lineWidth)};
      const float spacing = ${E.float(e.patternSpacing)};
      const float spacingINV = ${E.float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||n.code.add(E`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),n.uniforms.add(new Ei("uColor",a=>a.color)),n.code.add(E`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${e.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${e.output!==oe.Highlight?E`color.a *= ${E1t(e)};`:""}

      if (color.a < ${E.float(Va)}) {
        discard;
      }

      ${e.output===oe.Alpha?E`gl_FragColor = vec4(color.a);`:""}

      ${e.output===oe.Color?E`gl_FragColor = color; ${e.transparencyPassType===Rt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${e.output===oe.Highlight?E`outputHighlight();`:""}
      ${e.output===oe.Depth?E`outputDepth(linearDepth);`:""};
    }
  `),t}function E1t(e){function t(i){return e.draped?E`coverage(vuv.${i}, texelSize)`:E`sample(vuv.${i})`}switch(e.style){case pa.ForwardDiagonal:case pa.Horizontal:return t("y");case pa.BackwardDiagonal:case pa.Vertical:return t("x");case pa.DiagonalCross:case pa.Cross:return E`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}const C1t=Object.freeze(Object.defineProperty({__proto__:null,build:S1t},Symbol.toStringTag,{value:"Module"}));class u8 extends Lr{initializeProgram(t){const i=u8.shader.get().build(this.configuration);return new Er(t.rctx,i,UPe)}_setPipelineState(t,i){const r=this.configuration,s=t===Rt.NONE,n=t===Rt.FrontFace;return ri({blending:r.output===oe.Color||r.output===oe.Alpha?s?ed:Gv(t):null,culling:c6(r.cullFace),depthTest:{func:ew(t)},depthWrite:s?r.writeDepth&&jc:I6(t),colorWrite:xi,stencilWrite:r.hasOccludees?ny:null,stencilTest:r.hasOccludees?i?Hb:iw:null,polygonOffset:s||n?r.polygonOffset&&A1t:D6(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}u8.shader=new Sr(C1t,()=>import("./Pattern.glsl.02f539a9.js"));const A1t={factor:1,units:1};class $l extends al{constructor(){super(...arguments),this.output=oe.Color,this.cullFace=Ir.None,this.transparencyPassType=Rt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([Q({count:oe.COUNT})],$l.prototype,"output",void 0),u([Q({count:Ir.COUNT})],$l.prototype,"cullFace",void 0),u([Q({count:pa.COUNT})],$l.prototype,"style",void 0),u([Q({count:Rt.COUNT})],$l.prototype,"transparencyPassType",void 0),u([Q()],$l.prototype,"hasSlicePlane",void 0),u([Q()],$l.prototype,"hasVertexColors",void 0),u([Q()],$l.prototype,"polygonOffset",void 0),u([Q()],$l.prototype,"writeDepth",void 0),u([Q()],$l.prototype,"hasOccludees",void 0),u([Q()],$l.prototype,"patternSpacing",void 0),u([Q()],$l.prototype,"lineWidth",void 0),u([Q()],$l.prototype,"enableOffset",void 0),u([Q()],$l.prototype,"draped",void 0),u([Q()],$l.prototype,"hasMultipassTerrain",void 0),u([Q()],$l.prototype,"cullAboveGround",void 0);const UPe=new Map([[P.POSITION,0],[P.COLOR,3],[P.UVMAPSPACE,4],[P.BOUNDINGRECT,5]]);class Pre extends vy{constructor(t){super(t,new R1t),this.supportsEdges=!0,this._vertexAttributeLocations=UPe,this.techniqueConfig=new $l}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.style=this.parameters.style,this.techniqueConfig.patternSpacing=this.parameters.patternSpacing,this.techniqueConfig.lineWidth=this.parameters.lineWidth,this.techniqueConfig.draped=this.parameters.draped,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.enableOffset=i.camera.relativeElevation<$6,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(t,i,r,s,n,o,a){M6(t,i,s,n,o,void 0,a)}requiresSlot(t,i){return t===$e.DRAPED_MATERIAL?!0:DS(i)===oe.Highlight?t===$e.OPAQUE_MATERIAL:t===(this.parameters.writeDepth?$e.TRANSPARENT_MATERIAL:$e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)}createGLMaterial(t){return t.output===oe.Color||t.output===oe.Alpha||t.output===oe.Highlight||t.output===oe.Depth&&this.parameters.writeLinearDepth?new M1t(t):null}createBufferWriter(){const t=Bs().vec3f(P.POSITION).vec4u8(P.COLOR).vec4f(P.UVMAPSPACE);return this.parameters.draped||t.mat3f(P.BOUNDINGRECT),new O1t(t)}}class M1t extends Qb{_updateParameters(t){return this.ensureTechnique(u8,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==oe.Color&&this._output!==oe.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class O1t extends Y6{write(t,i,r,s){for(const n of this.vertexBufferLayout.fieldNames){const o=i.vertexAttributes.get(n),a=i.indices.get(n);if(o&&a)switch(n){case P.POSITION:{Ct(o.size===3);const l=r.getField(n,fr);l&&O6(a,o.data,t.transformation,l,s);break}case P.COLOR:{Ct(o.size===3||o.size===4);const l=r.getField(n,Hc);l&&Gz(a,o.data,o.size,l,s);break}case P.UVMAPSPACE:{Ct(o.size===4);const l=r.getField(n,Ho);l&&RM(a,o.data,l,s);break}case P.BOUNDINGRECT:{Ct(o.size===9);const l=r.getField(n,cm);l&&this.writeBoundingRect(a,o.data,t.transformation,l,s);break}}}}writeBoundingRect(t,i,r,s,n){const o=r,a=s.typedBuffer,l=s.typedBufferStride,c=t.length;n*=l;for(let h=0;h<c;++h){const p=9*t[h],f=i[p],m=i[p+1],g=i[p+2];a[n]=o[0]*f+o[4]*m+o[8]*g+o[12],a[n+1]=o[1]*f+o[5]*m+o[9]*g+o[13],a[n+2]=o[2]*f+o[6]*m+o[10]*g+o[14];for(let y=3;y<9;++y)a[n+y]=i[p+y];n+=l}}}class R1t extends AO{constructor(){super(...arguments),this.color=zi(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Ir.None,this.hasOccludees=!1,this.style=pa.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function P1t(e,t,i){return $1t(I1t(e),t,i)}function I1t(e){return e&&e.pattern||null}function $1t(e,t,i){return _(e)?e.style==="none"||e.style==="solid"?(e.style==="none"&&(t.color=zi(0,0,0,0),t.transparent=!0),new wfe(t)):(t.style=L1t(e.style),t.draped=i.isDraped,new Pre(t)):new wfe(t)}function L1t(e){switch(e){case"horizontal":return pa.Horizontal;case"vertical":return pa.Vertical;case"cross":return pa.Cross;case"forward-diagonal":return pa.ForwardDiagonal;case"backward-diagonal":return pa.BackwardDiagonal;case"diagonal-cross":return pa.DiagonalCross;default:return}}function D1t(e){return e.material instanceof Pre&&!e.material.parameters.draped}function N1t(e,t){if(D1t(e)){const i=e.geometry.vertexAttributes,r=i.get(P.POSITION).data,s=i.get(P.UVMAPSPACE).data,n=i.get(P.BOUNDINGRECT).data;kPe(Ho.fromTypedArray(s),fn.fromTypedArray(r),t,$b.fromTypedArray(n))}}function F1t(e,t,i,r){const s=VOe(e,t,i,r),n=e.stageObject.geometryRecords;for(let o=0;o<n.length;o++)N1t(n[o],r);return s}const k1t=["polyline","polygon","extent"];class h8 extends by{constructor(t,i,r,s){super(t,i,r,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(_(this._material))return;const t=Wr(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t);this._material=P1t(this.symbolLayer,{color:i,transparent:i[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof Pre,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const t=this.symbolLayer.outline;if(_(this._outlineMaterial)||!this._isValidOutline(t))return;this._hasOutline=!0;const i=r=>{const s=oPe(t.pattern);return new YC({width:r,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:lJ(t.patternCap||"butt")})};this._outlineMaterial=i($i(t.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(t){return _(t)&&t.size&&t.size>0&&_(t.color)&&(M(t.pattern)||t.pattern.type!=="style"||t.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,k1t,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(i,new ud);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,s)}layerOpacityChanged(){if(_(this._material)){const t=this._material.parameters.color,i=Wr(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(i);this._material.setParameters({color:[t[0],t[1],t[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if(_(this._outlineMaterial)){const t=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[t[0],t[1],t[2],this._getOutlineOpacity()]})}return!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=HL(h8.elevationModeChangeTypes,r,s);if(n!==Is.UPDATE)return n;const o=Op(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){if(_(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),_(this._outlineMaterial)){const t={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(t)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,i,r){const s=N$(t.geometry);if(M(s))return null;to.renderData=xre(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),to.color=i;const n=to.renderData.position.length/3;if(this._needsUV&&(to.uvMapSpace=new Float32Array(4*n),to.boundingRect=new Float64Array(9*n)),to.outNum=0,to.outGeometries=[],to.outTransforms=[],to.outMaterials=[],this._createAs3DShapeFill(to),this._hasOutline&&this._createAs3DShapeOutline(to),this._logGeometryCreationWarnings(to.renderData,s.rings,"rings","FillSymbol3DLayer"),to.outNum===0)return null;this._needsUV&&kPe(Ho.fromTypedArray(to.uvMapSpace),fn.fromTypedArray(to.renderData.position),this._context.renderCoordsHelper,$b.fromTypedArray(to.boundingRect));const o=new Hv({geometries:to.outGeometries,materials:to.outMaterials,transformations:to.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:t.uid}}),a=new _y(this,o,to.outGeometries,null,null,F1t,r);return a.alignedSampledElevation=to.renderData.sampledElevation,a.needsElevationUpdates=Op(r.mode),a}_createAs3DShapeFill(t){const i=t.renderData.polygons;for(const{position:r,mapPosition:s,holeIndices:n,index:o,count:a}of i){if(_(this._context.clippingExtent)&&(Nr(wl),qh(wl,s),!Nf(wl,this._context.clippingExtent)))continue;const l=$M(s,n,3);if(l.length===0)continue;const c=new Uint32Array(l),h=Rpe({indices:c,attributeData:{position:r,color:t.color,mapPosition:s,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*o*t.uvMapSpace.BYTES_PER_ELEMENT,4*a):null,boundingRect:this._needsUV?new Float64Array(t.boundingRect.buffer,9*o*t.boundingRect.BYTES_PER_ELEMENT,9*a):null}});t.outGeometries.push(h),t.outMaterials.push(this._material),t.outTransforms.push(Xn),t.outNum++}}_createAs3DShapeOutline(t){if(!this._hasOutline)return;const i=t.renderData.outlines;for(let r=0;r<i.length;++r){const{mapPosition:s,position:n}=i[r];if(_(this._context.clippingExtent)&&(Nr(wl),qh(wl,s),!Nf(wl,this._context.clippingExtent)))continue;const o=aJ({overlayInfo:null,removeDuplicateStartEnd:US.REMOVE,attributeData:{position:n,mapPosition:s}}),a=o.vertexAttributes.get(P.POSITION);a.data===n&&(a.data=new Float64Array(n)),t.outGeometries.push(o),t.outMaterials.push(this._outlineMaterial),t.outTransforms.push(Xn),t.outNum++}}_createAsOverlay(t,i){const r=N$(t.geometry);if(M(r))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,_(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),Sa.renderData=DRe(r,this._context.overlaySR),Sa.color=i;const s=Sa.renderData.position.length/3;return this._needsUV&&(Sa.uvMapSpace=new Float32Array(4*s)),Sa.outNum=0,Sa.outGeometries=[],Sa.outBoundingBox=Nr(),Sa.layerUid=this._context.layer.uid,Sa.graphicsUid=t.uid,this._createAsOverlayFill(Sa),this._hasOutline&&this._createAsOverlayOutline(Sa),this._logGeometryCreationWarnings(Sa.renderData,r.rings,"rings","FillSymbol3DLayer"),Sa.outNum===0?null:(this._needsUV&&f1t(Ho.fromTypedArray(Sa.uvMapSpace),fn.fromTypedArray(Sa.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode),Sa.outNum>0?new K6(this,Sa.outGeometries,Sa.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayFill(t){const i=t.renderData.polygons;for(const{position:r,holeIndices:s,index:n,count:o}of i){if(Nr(wl),qh(wl,r),!Nf(wl,this._context.clippingExtent))continue;const a=$M(r,s,3);if(a.length===0)continue;XA(t.outBoundingBox,wl);const l=new Uint32Array(a),c=Rpe({indices:l,attributeData:{position:r,color:t.color,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*n*t.uvMapSpace.BYTES_PER_ELEMENT,4*o):null}}),h=new FM(c,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),p=wl;_r(h.boundingSphere,.5*(p[0]+p[3]),.5*(p[1]+p[4]),0,.5*Math.sqrt((p[3]-p[0])*(p[3]-p[0])+(p[4]-p[1])*(p[4]-p[1]))),t.outGeometries.push(h),t.outNum++}}_createAsOverlayOutline(t){if(!this._hasOutline)return;const i=t.renderData.outlines;for(let r=0;r<i.length;++r){const{position:s}=i[r];if(Nr(wl),qh(wl,s),!Nf(wl,this._context.clippingExtent))continue;XA(t.outBoundingBox,wl);const n=aJ({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:US.REMOVE,attributeData:{position:s}}),o=new FM(n,this._outlineMaterial,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),a=wl;_r(o.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),t.outGeometries.push(o),t.outNum++}}_getOutlineOpacity(){const t=Wr(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(_(t)?t.a:0)}_getOutlineColor(){const t=Wr(this.symbolLayer,"outline","color"),i=this._getOutlineOpacity();return r3(_(t)?Le.toUnitRGB(t):null,i)}test(){return me(F({},super.test()),{createAsOverlay:(t,i)=>this._createAsOverlay(t,i),createAs3DShape:(t,i,r)=>this._createAs3DShape(t,i,r)})}}h8.elevationModeChangeTypes={definedChanged:Is.RECREATE,staysOnTheGround:Is.NONE,onTheGroundChanged:Is.RECREATE};const wl=In(),to={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Sa={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},U1t=ve.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters");class d8{constructor(t){this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.textStyle=this._colorToRGBA(t.color),this.haloStyle=this._colorToRGB(t.halo.color),this.backgroundStyle=t.background.color[3]!==0?this._colorToRGBA(t.background.color):null}fontString(t){const i=this.definition.font;return`${i.style} ${i.weight} ${t}px ${i.family}, sans-serif`}_colorToRGB(t){return`rgb(${t.slice(0,3).map(i=>Math.floor(255*i)).toString()})`}_colorToRGBA(t){return`rgba(${t.slice(0,3).map(i=>Math.floor(255*i)).toString()},${t[3]})`}static async fromSymbol(t,i=1){const r=Wr(t,"material","color"),s=Nh(r,Dg,Le.toUnitRGBA),n=Nh(t.size,12,$i),o=t.lineHeight,a=_(t.background)?Le.toUnitRGBA(t.background.color):Dg,l={family:Nh(t.font,"sans-serif",m=>m.family),decoration:Nh(t.font,"none",m=>m.decoration),weight:Nh(t.font,"normal",m=>m.weight),style:Nh(t.font,"normal",m=>m.style)},c=t.halo,h=_(c)&&_(c.color)&&c.size>0?{size:$i(c.size),color:Le.toUnitRGBA(c.color)}:{size:0,color:Dg},p=new d8({color:s,size:n,background:{color:a,padding:_(t.background)?[.65*n,.5*n]:[0,0],borderRadius:_(t.background)?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:i}),f=p.fontString(n);try{await document.fonts.load(f)}catch{U1t.warnOnce(`Failed to preload font '${f}'. Some text symbology may be rendered using the default browser font.`)}return p}}class z1t{constructor(t,i,r){this._renderer=new JRe(t,i,r)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const t=pk(V1t,this._renderer.renderedWidth,this._renderer.renderedHeight),i=t.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new En(t,{wrap:{s:$t.CLAMP_TO_EDGE,t:$t.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:fb.PAD})}}const V1t={canvas:null},B1t=[0,0,1];class G1t extends by{constructor(t,i,r,s){super(t,i,r,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const t=N6(this.symbolLayer.size);if(t)throw new W("graphics3dtextsymbollayer:invalid-size",t)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const t=this._context.graphicsCoreOwner.view.state.pixelRatio;this._textRenderParameters=await d8.fromSymbol(this.symbolLayer,t)}destroy(){super.destroy()}createGraphics3DGraphic(t){const i=t.graphic,r=L$(i.geometry);if(M(r))return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const s=this.symbolLayer.text;if(M(s)||s==="")return null;const n=$K(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(_(n)&&!H1e(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=me(F({},q1t),{verticalOffset:n,horizontalPlacement:this.symbolLayer.horizontalAlignment,verticalPlacement:pyt(this.symbolLayer.verticalAlignment)});return this._createAs3DShape(i,r,s,o)}createLabel(t,i,r,s){const n=t.graphic,o=L$(n.geometry);if(M(o))return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=i.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,i,r,s)}setGraphicElevationContext(t,i,r=0){const s=super.setGraphicElevationContext(t,i);return s.addOffsetRenderUnits(r),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(t,i){return Tfe(t,i,(r,s)=>{this.updateGraphicElevationContext(s,r)}),Is.UPDATE}slicePlaneEnabledChanged(t,i){return Tfe(t,i,r=>{for(const s of r.stageObject.geometryRecords)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}updateGraphicElevationContext(t,i){this.setGraphicElevationContext(t,i.elevationContext,i.metadata.elevationOffset),i.needsElevationUpdates=Op(i.elevationContext.mode)||i.elevationContext.mode==="absolute-height"}_defaultElevationInfoNoZ(){return H1t}_createAs3DShape(t,i,r,s,n,o){const a=this.setGraphicElevationContext(t,new ud,s.elevationOffset),l=Wr(t.geometry,"type")==="polyline",c=t.uid;let h=null,p=null;if(M(o)){const H=KRe(s.horizontalPlacement);h=new z1t(r,H,this._textRenderParameters);let K=null;p=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{_(K)&&K.release()});const ee=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(M(ee)||qu(ee))return p.release(),null;K=ee}const f=j1t(h,s),m={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,debugDrawLabelBorder:s.debugDrawLabelBorder,drawInSecondSlot:!0};if(_(p)&&(m.textureId=p.texture.id),_(o)&&(m.textureId=o.id),_(s.verticalOffset)){const{screenLength:H,minWorldLength:K,maxWorldLength:ee}=s.verticalOffset;m.verticalOffset={screenLength:$i(H),minWorldLength:K||0,maxWorldLength:ee!=null?ee:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:H,screenSizePerspectiveSettingsLabels:K}=this._context.sharedResources;m.screenSizePerspective=K.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=H}let g;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,_(n)){const H=JSON.stringify(m);g=n.get(H),M(g)&&(g=new PM(m),n.add(H,g))}else g=new PM(m);const y=[g],x=s.translation,b=_(h)?[h.displayWidth,h.displayHeight]:[0,0],S=s.centerOffset,T=B1t,C=[0,0],A=[vu.createPointGeometry(T,x,null,b,S,C,null)],O=this._context.layer.uid,D=fre(this._context,i,A,y,a,O,c);if(D===null)return null;const U=new _y(this,D.object,A,M(n)?y:null,p,I$,a);U.alignedSampledElevation=D.sampledElevation,U.needsElevationUpdates=Op(a.mode)||a.mode==="absolute-height";const{displayWidth:k,displayHeight:B}=_(h)?h:s;U.getScreenSize=(H=Ke())=>(H[0]=k,H[1]=B,H);const j={labelText:r,elevationOffset:s.elevationOffset};return U.metadata=j,$$(U,i,this._context.elevationProvider),U}}function Tfe(e,t,i){e&&e.forEach(r=>{const s=t(r);_(s)&&i(s,r.graphic)})}function j1t(e,t){if(t.verticalPlacement==="baseline"){const r=uyt[t.horizontalPlacement],s=_(e)?e.baselineAnchorY:0;return er(r,s)}const i=dyt(t.horizontalPlacement,t.verticalPlacement);return fk[i]}const H1t={mode:"relative-to-ground",offset:0},q1t={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0},W1t={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},Z1t=["polyline","polygon","extent"];class bg extends by{constructor(t,i,r,s){super(t,i,r,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Z1t,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new ud);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(_(this._material))return;const t=new ORe,i=this.symbolLayer.color;_(i)&&(t.color=Le.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});t.color=[t.color[0],t.color[1],t.color[2],r],t.transparent=r<1||this.needsDrivenTransparentPass,t.waveDirection=_(this.symbolLayer.waveDirection)?bg.headingVectorFromAngle(this.symbolLayer.waveDirection):er(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=W1t[s];t.waveStrength=n.waveStrength,t.waveTextureRepeat=n.textureRepeat,t.waveVelocity=n.waveVelocity,t.flowStrength=n.perturbationStrength,t.hasSlicePlane=this._context.slicePlaneEnabled,t.isDraped=this.draped,this._material=new MRe(t),this._context.stage.add(this._material)}layerOpacityChanged(){if(M(this._material))return!0;const t=this._material.parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;return this._material.setParameters({color:[t[0],t[1],t[2],i],transparent:r}),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=HL(bg.elevationModeChangeTypes,r,s);if(n!==Is.UPDATE)return n;const o=Op(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){return _(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,i,r){const s=N$(t.geometry);if(M(s))return null;Qa.renderData=xre(s,this._context.elevationProvider,this._context.renderCoordsHelper,i);const n=Qa.renderData.position.length/3;if(Qa.uvCoords=new Float64Array(2*n),Qa.outNum=0,Qa.outGeometries=[],Qa.outTransforms=[],Qa.outMaterials=[],this._create3DShapeGeometries(Qa),this._logGeometryCreationWarnings(Qa.renderData,s.rings,"rings","WaterSymbol3DLayer"),Qa.outNum===0)return null;this._createUVCoordsFromVertices(Qa.uvCoords,Qa.renderData.mapPosition,n,this._context.elevationProvider.spatialReference);const o=new Hv({geometries:Qa.outGeometries,materials:Qa.outMaterials,transformations:Qa.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),a=new _y(this,o,Qa.outGeometries,null,null,VOe,i);return a.alignedSampledElevation=Qa.renderData.sampledElevation,a.needsElevationUpdates=Op(i.mode),a}_createUVCoordsFromVertices(t,i,r,s){const n=$n(s);id(y_);for(let l=0;l<r;l++)Li(Sfe,i[3*l+0],i[3*l+1]),lA(y_,Sfe);rL(y_,y_,n);const o=y_[0]%bg.unitSizeOfTexture,a=y_[1]%bg.unitSizeOfTexture;RF[0]=y_[0]-o,RF[1]=y_[1]-a;for(let l=0;l<r;l++)t[2*l+0]=(i[3*l+0]*n-RF[0])/bg.unitSizeOfTexture,t[2*l+1]=(i[3*l+1]*n-RF[1])/bg.unitSizeOfTexture}_create3DShapeGeometries(t){const i=t.renderData.polygons,r=t.uvCoords;for(const{count:s,index:n,position:o,mapPosition:a,holeIndices:l}of i){if(_(this._context.clippingExtent)&&(Nr(v_),qh(v_,a),!Nf(v_,this._context.clippingExtent)))continue;const c=$M(a,l,3);if(c.length===0)continue;const h=new Uint32Array(c),p=new Float64Array(r.buffer,2*n*r.BYTES_PER_ELEMENT,2*s),f=Ppe({indices:h,attributeData:{position:o,uv0:p,mapPosition:a}});t.outGeometries.push(f),t.outMaterials.push(this._material),t.outTransforms.push(Xn),t.outNum++}}_createAsOverlay(t){const i=N$(t.geometry);if(M(i))return null;this._material.renderPriority=this._renderPriority,xl.renderData=DRe(i,this._context.overlaySR);const r=xl.renderData.position.length/3;return xl.uvCoords=new Float64Array(2*r),xl.outNum=0,xl.outGeometries=[],xl.outBoundingBox=Nr(),xl.layerUid=this._context.layer.uid,xl.graphicsUid=t.uid,this._createAsOverlayWater(xl),this._logGeometryCreationWarnings(xl.renderData,i.rings,"rings","WaterSymbol3DLayer"),xl.outNum===0?null:(this._createUVCoordsFromVertices(xl.uvCoords,xl.renderData.position,r,this._context.overlaySR),xl.outNum>0?new K6(this,xl.outGeometries,xl.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayWater(t){const i=t.uvCoords,r=t.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of r){if(Nr(v_),qh(v_,s),!Nf(v_,this._context.clippingExtent))continue;XA(t.outBoundingBox,v_);const l=$M(s,n,3);if(l.length===0)continue;const c=new Uint32Array(l),h=new Float64Array(i.buffer,2*o*i.BYTES_PER_ELEMENT,2*a),p=Ppe({indices:c,attributeData:{position:s,uv0:h}}),f=new FM(p,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),m=v_;_r(f.boundingSphere,.5*(m[0]+m[3]),.5*(m[1]+m[4]),0,.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1]))),t.outGeometries.push(f),t.outNum++}}static headingVectorFromAngle(t){const i=Ke(),r=MV(t);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return me(F({},super.test()),{create3DShape:t=>this._createAs3DShape(t.graphic,t.elevationContext,t.graphicUid),ensureMaterial:()=>this.ensureMaterial()})}}bg.unitSizeOfTexture=100,bg.elevationModeChangeTypes={definedChanged:Is.RECREATE,staysOnTheGround:Is.NONE,onTheGroundChanged:Is.RECREATE};const RF=Ke(),y_=Qt(),Sfe=Ke(),v_=In(),Qa={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},xl={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},X1t=ve.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");function Y1t(e,t,i,r){const s=Efe[e.type]&&Efe[e.type][t.type]||J1t[t.type];return s?new s(e,t,i,r):(X1t.error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)}const J1t={icon:z$,object:m_t,line:i8,path:l1t,fill:h8,extrude:Jgt,text:G1t,water:bg},Efe={"mesh-3d":{fill:Z0t}};class Q1t extends ure{constructor(t,i,r){super(i.schedule),this._symbol=t,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}set symbol(t){this._symbol=t;for(let i=0;i<t.symbolLayers.length;i++){const r=this.symbolLayers[i];M(r)||(r.symbol=t,r.symbolLayer=t.symbolLayers.items[i])}}get symbol(){return this._symbol}async doLoad(t){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[];for(let n=0;n<r;n++){const o=i.getItemAt(n);if(o.enabled===!1)continue;PF.renderPriority=1-(1+n)/r,PF.renderPriorityStep=1/r,PF.ignoreDrivers=o._ignoreDrivers;const a=Y1t(this.symbol,o,this._context,PF);s.push(kV(t,()=>{this.symbolLayers[n]=null,a.destroy()})),this.symbolLayers[n]=a}await IB(this.symbolLayers,async(n,o)=>{if(_(n))try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}});for(const n of s)n==null||n.remove();if(s.length=0,qt(t),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(t){const i=this.symbolLayers[t];return _(i)?i.getCachedSize():null}get extentPadding(){return this._extentPadding}createGraphics3DGraphic(t,i){const r=t.graphic,s=new Array(this.symbolLayers.length);for(let o=0;o<this.symbolLayers.length;o++){const a=this.symbolLayers[o];s[o]=_(a)?a.createGraphics3DGraphic(t):null}const n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new Zft(r,i||this,s,t.layer,n)}get complexity(){return pre(this.symbolLayers.map(t=>Wr(t,"complexity")))}globalPropertyChanged(t,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],o=a=>{const l=a.graphics[s];return l instanceof _y?l:null};if(_(n)&&!n.globalPropertyChanged(t,i,o))return!1}return!0}applyRendererDiff(t,i){return this.loadStatus!==Lh.LOADED?qn.Recreate_Symbol:this.symbolLayers.reduce((r,s)=>r!==qn.Recreate_Symbol&&_(s)?Math.min(r,s.applyRendererDiff(t,i)):r,qn.Fast_Update)}prepareSymbolPatch(t){if(this.loadStatus===Lh.FAILED||t.diff.type!=="partial")return;const i=t.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(M(s))return;const o=r[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),t.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&t.graphics3DGraphicPatches.push((l,c)=>{const h=l.graphics[n];_(h)&&a.graphics3DGraphicPatches.forEach(p=>p(h,c))})}})}updateGeometry(t,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(M(s))continue;const n=t.graphics[r];if(M(n)||!s.updateGeometry(n,i))return!1}return!0}onRemoveGraphic(t){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(M(r))continue;const s=t.graphics[i];_(s)&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let t=0,i=0,r=0;return this.symbolLayers.forEach(s=>{M(s)||(s.loadStatus===Lh.LOADING?t++:s.isFastUpdatesEnabled()?r++:i++)}),{loading:t,slow:i,fast:r}}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const t of this.symbolLayers)_(t)&&t.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const PF={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};class K1t extends ure{constructor(t,i,r){super(i),this.symbol=t,this.convert=r,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(t){return _(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(t):null}get symbolLayers(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(t){const i=await this.symbol.fetchSymbol({signal:t});i.id=this.symbol.id,this.graphics3DSymbol=this.convert(i),_(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(t){return _(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(t,this):null}get complexity(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:dre}globalPropertyChanged(t,i){return!!_(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(t,i)}applyRendererDiff(t,i){return _(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(t,i):qn.Recreate_Symbol}prepareSymbolPatch(t){_(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(t)}updateGeometry(t,i){return!!_(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(t,i)}onRemoveGraphic(){}getFastUpdateStatus(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){_(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}}function Ire(e){return e instanceof K1t?e.graphics3DSymbol:e instanceof Q1t?e:null}const B$=ve.getLogger("esri.views.3d.layers.graphics.labelPlacement");function ebt(e){const t=cbt(e);if(M(t))return null;const i=tbt(e,t);if(M(i))return null;const r=i.anchor,s=!!t.hasLabelVerticalOffset;return rbt({anchor:r,verticalOffset:t.verticalOffset,screenOffset:Ke(),centerOffset:zi(0,0,0,-1),centerOffsetUnits:"world",translation:$(),elevationOffset:0,hasLabelVerticalOffset:s},i,e)}function tbt(e,t){if(t.anchor)return t;const i=e.labelClass.labelPlacement,r=Bf[i],s=r||oV(e);return i&&!r&&B$.warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),ibt(s,e)}function $re(e){const t=e.graphics3DGraphic.graphics3DSymbol,i=Ire(t);return _(i)?i.symbol.symbolLayers.getItemAt(0):null}function ibt(e,t){const i=t.graphics3DGraphic.graphic.geometry;if(M(i))return null;if(_(t.disablePlacement))return t.labelClass.labelPlacement?(B$.warnOncePerTick(Cfe(e.placement,t.disablePlacement.logEntityDescription)),oV(t)):e;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return B$.warnOncePerTick(Cfe(e.placement,`'${r}' geometries`)),oV(t);break;case"point":case"mesh":return e}return e}function Cfe(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView.`}function oV(e){const t=e.graphics3DGraphic.graphic.geometry;if(M(t))return null;switch(t.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const i=$re(e);return _(i)&&i.type==="extrude"?Bf["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return Bf["above-center"];default:return}}function rbt(e,t,i){const r=i.graphics3DGraphic.graphic.geometry;if(M(r))return null;switch(r.type){case"point":nbt(e,t,i);break;case"polygon":sbt(e,t,i);break;case"mesh":Lre(e,t,i.graphics3DGraphic.graphics[0])}return e}function sbt(e,t,i){const r=$re(i);if(!M(r))switch(r.type){case"extrude":{const s=i.graphics3DGraphic.graphics[0];_(s)?(s.getBoundingBoxObjectSpace(u3),Df(u3,e.translation),e.translation[2]=Xb(u3)/2):he(e.translation,0,0,0),Lre(e,t,s);break}}}function nbt(e,t,i){const r=$re(i);if(M(r))return;const s=i.graphics3DGraphic.graphics[0];switch(_(s)?s.getCenterObjectSpace(e.translation):he(e.translation,0,0,0),r.type){case"icon":case"text":obt(e,t,i,s);break;case"object":Lre(e,t,s)}}function obt(e,t,i,r){const{graphics3DGraphic:s}=i,n=_(r)?r.getScreenSize():null;if(!s.isDraped&&_(n)){const o=abt(i);$R[0]=n[0]/2*(t.normalizedOffset[0]-o[0]),$R[1]=n[1]/2*(t.normalizedOffset[1]-o[1]),e.screenOffset[0]=$R[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=$R[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=$R[1]}else e.hasLabelVerticalOffset||e.anchor==="center"||(Bf[i.labelClass.labelPlacement]&&B$.warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center")}function abt(e,t=ubt){const{graphics3DGraphic:i}=e,r=i.graphics[0],s=_(r)?r.stageObject.geometryRecords[0].material:null;if(s&&s instanceof PM){const n=s.parameters.anchorPosition;t[0]=2*(n[0]-.5),t[1]=2*(n[1]-.5)}else t[0]=0,t[1]=0;return t}function Lre(e,t,i){const r=_(i)?i.getBoundingBoxObjectSpace(u3):u3,s=Ze(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);e.centerOffset[0]=n/2*t.normalizedOffset[0];const o=e.translation[2],a=s[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=o+a;const l=Ue(s);e.centerOffset[2]=l/2*t.normalizedOffset[2]}function lbt(e){return e==="above-center"}function cbt(e){const t=e.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=e,s=Ire(r.graphics3DSymbol),n=wt(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=Bf[t]||oV(e);return _(n)&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:Afe(n.verticalOffset),anchor:null,normalizedOffset:null}:i&&i.hasVisibleVerticalOffset()&&(M(n)||!n.supportsCallout()||!n.verticalOffset||r.isDraped)?lbt(o.placement)?{placement:"above-center",verticalOffset:Afe(i.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(B$.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function Afe(e){const{screenLength:t,minWorldLength:i,maxWorldLength:r}=e;return{screenLength:t,minWorldLength:i,maxWorldLength:r}}const Bf={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Mfe={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const e in Mfe){const t=Mfe[e],i=Bf[e];t.forEach(r=>{Bf[r]=i})}Object.freeze&&(Object.freeze(Bf),Object.keys(Bf).forEach(e=>{Object.freeze(Bf[e]),Object.freeze(Bf[e].normalizedOffset)}));const $R=[0,0],ubt=[0,0],u3=In();class Ofe{constructor(t){this._stage=t,this._materials=new Map}get(t){return this._materials.get(t)}add(t,i){this._materials.set(t,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}const I7=512,$7=4096,hbt=.85,dbt=.95;let hI=class extends Ee{constructor(e){super(e),this.type=um.Texture,this.id=Dc(),this.events=new cs,this._glTexture=null,this.needsClear=!1,this.elementsToAddOrUpdate=new Map,this.elementsToRemove=new Map,this.elementsToRender=new Map,this.elements=new Map,this.stageObjects=new Map,this.updating=!1}initialize(){this.stage=this.view._stage,this.canvas=this._create2DCanvas(),this.ctx=this.canvas.getContext("2d"),this.stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=ht(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this.atlas.size.width}get height(){return this.atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,flipped:!0,samplingMode:gt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return _(this._glTexture)||(this._glTexture=new _t(e,this._createDescriptor(e),this.canvas),this.frameWorker=this.view.resourceController.scheduler.registerTask(Ot.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this.elements=null,this.elementsToAddOrUpdate=null,this.elementsToRemove=null,this.elementsToRender=null,this.frameWorker=hn(this.frameWorker),this._glTexture&&(this.stage.remove(this),this._glTexture=ht(this._glTexture)),this.canvas.width=0,this.canvas.height=0,this.canvas=null,this.ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",I7.toString()),e.setAttribute("height",I7.toString()),e}_update2DCanvasSize(){this.canvas.setAttribute("width",this.atlas.size.width.toString()),this.canvas.setAttribute("height",this.atlas.size.height.toString())}_createAtlasRegion(e=I7){this.atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,t){let i=Math.max(e,t);return i+=256,i=FA(i),i=Math.min(i,$7),i}_resizeAtlas(e,t){t=t||e;const i=this.atlas;i.size.width=e,i.size.height=t,_(this._glTexture)&&this._glTexture.resize(e,t),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this.atlas;e.cursor.x=LR,e.cursor.y=LR+Rfe,e.lineHeight=0,this.needsClear=!0}_getAtlasUsage(){const e=this.atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this.elementsToRemove.size,t=this.elementsToAddOrUpdate.size,i=this.elements.size;return this._getAtlasUsage()/i*(i+t-e)}_addAtlasElement(e,t,i,r){const s=this.atlas,{renderedWidth:n,renderedHeight:o,displayWidth:a,displayHeight:l}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,e.placement.size.width=n,e.placement.size.height=o,e.placement.size.displayWidth=a,e.placement.size.displayHeight=l,e.placement.uvMinMax=[e.placement.offset.x/s.size.width,1-(e.placement.offset.y+o)/s.size.height,(e.placement.offset.x+n)/s.size.width,1-e.placement.offset.y/s.size.height],s.cursor.x+=i,s.lineHeight=Math.max(s.lineHeight,r),this.elements.set(t,e)}_removeAtlasElement(e){if(e&&this.elements.has(e.textId)){const t=e.placement.offset,i=e.placement.size;this.ctx.clearRect(t.x,t.y,i.width,i.height),this.elements.delete(e.textId)}}_ensureStageObjects(e){const t=this.stageObjects.get(e);if(t)return t;const i=new Set;return this.stageObjects.set(e,i),i}_addStageObject(e,t){this._ensureStageObjects(e).add(t)}_removeStageObject(e,t){const i=this.stageObjects.get(e);i&&i.delete(t)&&(t.geometries[0].vertexAttributes.get(P.SIZE).data=[0,0],t.geometryVertexAttrsUpdated(t.geometryRecords[0]))}_processAddition(e,t){const i=this.atlas,r=e.textId,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+LR,a=n+LR+Rfe;if(i.cursor.x+o<i.size.width&&i.cursor.y+a<i.size.height)this._addAtlasElement(e,r,o,a),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r);else{if(!(i.cursor.y+a+i.lineHeight<i.size.height)){const l=this._getExpectedAtlasUsage(),c=l>hbt&&i.size.width<$7;return c&&this._resizeAtlas(2*i.size.width,2*i.size.height),!t||!c&&l>dbt&&i.size.width===$7?(this._processRemovals(),JC.OK):(this._repack(),JC.REPACK)}i.cursor.x=LR,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,r,o,a),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r)}return JC.OK}_processRemovals(){this.elementsToRemove.forEach((e,t)=>{const i=this.stageObjects.get(t);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this.stageObjects.delete(t)}),this.elementsToRemove.clear()}_repack(){this._processRemovals(),this.elements.forEach((e,t)=>{e.rendered=!1,this.elementsToAddOrUpdate.set(t,e)}),this.elements.clear(),this._resetAtlasCursor(),this.elementsToRender.clear()}_processRenderingRequest(e){this.ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.placement.size.width,e.placement.size.height),e.textRenderer.render(this.ctx,e.placement.offset.x,e.placement.offset.y);const t=this.stageObjects.get(e.textId);t&&t.forEach(i=>{i.geometries[0].vertexAttributes.get(P.UV0).data=new Float32Array(e.placement.uvMinMax),i.geometries[0].vertexAttributes.get(P.SIZE).data=[e.placement.size.displayWidth,e.placement.size.displayHeight],i.geometryVertexAttrsUpdated(i.geometryRecords[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,t=!0){if(!this._glTexture)return;let i=!1;if(Mn(this.elementsToAddOrUpdate,(s,n)=>{const o=this.elements.get(n);if(o&&o.rendered){const a=this.stageObjects.get(n);return a&&a.forEach(l=>{const c=l.geometries[0].vertexAttributes,h=this.elements.get(n);c.get(P.UV0).data=new Float32Array(h.placement.uvMinMax),c.get(P.SIZE).data=new Float32Array([h.placement.size.displayWidth,h.placement.size.displayHeight]),l.geometryVertexAttrsUpdated(l.geometryRecords[0])}),this.elementsToAddOrUpdate.delete(n),!1}return this._processAddition(this.elementsToAddOrUpdate.get(n),t)===JC.REPACK&&(i=!0,!0)}),i)return void this.runTask(bO,!1);let r=!1;this.elementsToRender.size>0&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1),Mn(this.elementsToRender,(s,n)=>(this._processRenderingRequest(s),this.elementsToRender.delete(n),r=!0,e.madeProgress(),e.done)),r&&_(this._glTexture)&&this._glTexture.setData(this.canvas),this.updating=this.elementsToRender.size>0,!this.updating&&fmt.orderedRepackingEnabled&&this.repackOrdered()}addTextTexture(e,t){const i=e.key;this.elementsToAddOrUpdate.has(i)||this.elementsToAddOrUpdate.set(i,{textId:i,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:e,rendered:!1}),this._addStageObject(i,t),this.elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,t){const i=e.key;this.elementsToRemove.set(i,this.elements.get(i)),this._removeStageObject(i,t)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this.elements.size===0)return;const e=[];this.elements.forEach((i,r)=>e.push({element:i,key:r}));let t=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){t=!1;break}if(!t||this.elementsToRemove.size){e.sort((i,r)=>i.key.localeCompare(r.key)),this.elements.clear();for(const{element:i,key:r}of e)this.elements.set(r,i);this._repack(),this.setDirty()}}get test(){const{elements:e,stageObjects:t,elementsToRemove:i,atlas:r}=this,s=this;return{elements:e,stageObjects:t,elementsToRemove:i,atlas:r,_resizeAtlas:(n,o)=>s._resizeAtlas(n,o),run:(n,o)=>s.runTask(n,o)}}};u([d({constructOnly:!0})],hI.prototype,"view",void 0),u([d({type:Boolean})],hI.prototype,"updating",void 0),hI=u([L("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],hI);const LR=2,Rfe=2;var JC;(function(e){e[e.OK=0]="OK",e[e.REPACK=1]="REPACK"})(JC||(JC={}));const Pfe=ve.getLogger("esri.views.3d.layers.graphics.Labeler");let $x=class extends Ee{constructor(){super(...arguments),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Nt,this._handles.add([re(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),re(()=>{var e;return(e=this.view.state)==null?void 0:e.pixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(Ot.LABELER,this)]),this._textTextureAtlas=new hI({view:this.view}),this._hudMaterialCollection=new Ofe(this.view._stage),this._calloutMaterialCollection=new Ofe(this.view._stage)}dispose(){this._handles=We(this._handles),this._textTextureAtlas=ht(this._textTextureAtlas),this._hudMaterialCollection=ht(this._hudMaterialCollection),this._calloutMaterialCollection=ht(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.labels.forEach((t,i)=>{this._labels.set(i,t),t.graphics3DGraphic.setVisibilityFlag(Bh.USER_SETTING,!0,da.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.labels.forEach((t,i)=>{t.graphics3DGraphic.setVisibilityFlag(Bh.USER_SETTING,!1,da.LABEL),this.setLabelGraphicVisibility(t.graphics3DGraphic,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textTextureResources.textRenderers[t._labelIndex];_(i)&&this._textTextureAtlas.addTextTexture(i,t.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textTextureResources.textRenderers[t._labelIndex];_(i)&&this._textTextureAtlas.removeTextTexture(i,t.stageObject)}e.rendered=!1}get running(){var e;return this.view.ready&&(this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.running)}runTask(e){this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e)}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(pbt(t)){if(!Ife(t)){if(fbt(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),L7(t)){this._dirty=!0;continue}if(!Ife(t))continue}Mn(t.labelsToInitialize,(i,r)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(r,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textTextureResources.initialized||!i.visible&&i.hasGraphics3DResources)&&(t.labelsToInitialize.delete(r),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(t=>this._removeLabelTextureFromAtlas(t)),this._labelsToAdd.forEach(t=>this._addLabelTextureToAtlas(t)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const t=e.labelClassAbortController.signal;await e.layer.when(),qt(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,r=i.layer,s=r.labelingInfo&&r.labelingInfo.filter(a=>!!a.symbol);if(!s||s.length===0)return;const n=new Array(s.length);let o=!1;await IB(s,async(a,l)=>{const c=a.symbol,h=Ire(i.getOrCreateGraphics3DSymbol(c));if(M(h))return void Pfe.error("Failed to create Graphics3DSymbol for label");await h.load(),qt(t);let p=null;$K(c)&&c.hasVisibleCallout()&&(p=jft(c,i.symbolCreationContext),await p.load(),qt(t));const f=await Hu(kOe(a,e.layer.fieldsIndex,this.view.spatialReference));if(qt(t),f.ok===!0){const m=await this._createTextRenderParameters(h.symbol);qt(t),n[l]={labelClass:a,labelFunction:f.value,graphics3DSymbol:h,graphics3DCalloutSymbolLayer:p,calloutSymbolLayerIndex:0,textRenderParameters:m}}else Pfe.error(`Label expression failed to evaluate: ${f.error}`),o=!0}),qt(t),o||(e.labelClassContexts=n)}async _createLabelClassContext(e){return e.labelClassPromise||(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(t=>{if(as(t))throw t;e.labelClassContexts=null}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.getItemAt(0);return t&&t.type==="text"?d8.fromSymbol(t,this.view.state.pixelRatio):null}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced,i.graphics3DSymbol=null;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,t&&t.abort(),e.labelClassContexts=[],e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,i,r,s){const n={text:e.text,centerOffset:i.centerOffset,translation:i.translation,elevationOffset:i.elevationOffset,screenOffset:i.screenOffset,centerOffsetUnits:i.centerOffsetUnits,horizontalPlacement:Gpe(i.anchor),verticalPlacement:hyt(i.anchor),verticalOffset:i.verticalOffset,debugDrawLabelBorder:dr.LABELS_SHOW_BORDER,displayWidth:e.displayWidth,displayHeight:e.displayHeight};return __.graphic=t,__.renderingInfo=null,__.layer=r,s.createLabel(__,n,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,i,r,s){const n={symbol:t,translation:r.translation,elevationOffset:r.elevationOffset,screenOffset:r.screenOffset,centerOffset:r.centerOffset,centerOffsetUnits:r.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};return __.graphic=e,__.renderingInfo=n,__.layer=s,i.createGraphics3DGraphic(__)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const{textTextureResources:i}=e,r=e.labelingContext,s=r.labelClassContexts;if(!s||s.length===0||!r.emptySymbolLabelSupported&&t.graphics.length===0)return!1;let n=!1;const o=t.graphic,a=r.layer,l=iZ(r.layer),c=this.view._stage;for(let h=0;h<s.length;h++){const p=i.textRenderers[h],f=i.labelPlacements[h];if(M(p)||M(f))continue;const m=s[h],g=m.graphics3DSymbol,y=g.symbol&&g.symbol.type==="label-3d"?g.symbol:null,x=g.symbolLayers[0];if(!x)continue;x.setElevationInfoOverride(r.elevationInfoOverride);const b=this._createTextSymbolGraphic(p,o,f,a,x);if(!b)return!1;b._labelClass=m.labelClass,b._labelIndex=h,t.addLabelGraphic(b,c,r.stageLayer),t.setVisibilityFlag(Bh.USER_SETTING,l,da.LABEL),t.clearVisibilityFlag(Bh.SCALE_RANGE,da.LABEL),t.setVisibilityFlag(Bh.DECONFLICTION,!1,da.LABEL),n=!0;const S=m.graphics3DCalloutSymbolLayer;if(S&&f.hasLabelVerticalOffset){S.setElevationInfoOverride(r.elevationInfoOverride);const T=this._createLineCalloutGraphic(o,y,S,f,a);_(T)&&(m.calloutSymbolLayerIndex=t.labelGraphics.length,t.addLabelGraphic(T,c,r.stageLayer))}break}return r.scaleVisibility&&n&&r.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelGraphics){if(i._labelClass==null)continue;const r=t[i._labelIndex].graphics3DSymbol.symbolLayers[0];r!=null&&r.onRemoveGraphic(i)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){const{textTextureResources:t}=e;if(t.initialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(!r||r.length===0)return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<r.length;n++){const o=r[n];if(t.textRenderers[n]=null,t.labelPlacements[n]=null,!o.textRenderParameters)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const b=a.needsHydrationToEvaluate()?Zpt(s,i.layer):s;l=a.evaluate(b)}catch{l=null}else l=a.evaluate(s);if(M(l)||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,h=c.symbol&&c.symbol.type==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const p=e.graphics3DGraphic,f=o.labelClass,m=i.disablePlacement,g=ebt({graphics3DGraphic:p,labelSymbol:h,labelClass:f,disablePlacement:m});if(M(g))continue;const y=Gpe(g.anchor),x=KRe(y);t.textRenderers[n]=new JRe(l,x,o.textRenderParameters),t.labelPlacements[n]=g}t.initialized=!0}_destroyTextTextureResources(e){const{textTextureResources:t}=e;t.initialized=!1,t.textRenderers=[],t.labelPlacements=[]}_addGraphic(e,t){const i={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:e,graphics3DGraphic:t,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}},r=t.graphic.uid;e.labels.set(r,i),e.labelsToInitialize.set(r,i),this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const i=t.graphic.uid,r=e.labels.get(i);r&&(this._destroyGraphic(r,i),e.labels.delete(i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of t){const r=e.labels.get(i);r&&(this._removeGraphic(e,r.graphics3DGraphic),this._addGraphic(e,r.graphics3DGraphic))}}_globalPropertyChanged(e,t){for(const i of t.labelClassContexts){const r=new Map;t.labels.forEach(n=>{const o=n.graphics3DGraphic;r.set(o.graphic.uid,o)});const s=n=>n.labelGraphics[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,r,s),i.graphics3DCalloutSymbolLayer){const n=o=>o.labelGraphics[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,r,n)}}}_visibilityInfoChange(e){const t=e.layer.labelsVisible;t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.labels.forEach((t,i)=>{this._destroyGraphic(t,i),t.visible=!1,t.rendered=!1,e.labelsToInitialize.set(i,t)}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,i){const r=i&&i.emptySymbolLabelSupported||!1,s=i&&i.elevationInfoOverride||null,n=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const o=e.layer,a={graphics3DCore:e,layer:o,scaleVisibility:t,emptySymbolLabelSupported:r,elevationInfoOverride:s,disablePlacement:n,active:o.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new aRe({isPickable:!0},o.uid)};return this.view._stage.add(a.stageLayer),this._labelingContexts.push(a),this.setDirty(),{addGraphic:l=>this._addGraphic(a,l),removeGraphic:l=>this._removeGraphic(a,l),featureReductionChange:()=>{},layerLabelsEnabled:()=>iZ(a.layer),labelingInfoChange:l=>this._labelingInfoChange(a,l),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",a),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",a),visibilityInfoChange:()=>this._visibilityInfoChange(a),reset:()=>this._resetLabels(a),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const i=this._labelingContexts.indexOf(t);this._labelingContexts.splice(i,1),t.labels.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic)),this.view._stage.remove(t.stageLayer),t.stageLayer=null,this.setDirty()}setLabelGraphicVisibility(e,t){const i=e.graphic.uid,r=this._labels.get(i);r&&r.visible!==t&&(t&&!r.rendered?(this._labelsToAdd.set(i,r),this._labelsToRemove.delete(i),r.textTextureResources.initialized||r.labelingContext.labelsToInitialize.set(i,r)):!t&&r.rendered&&(this._labelsToRemove.set(i,r),this._labelsToAdd.delete(i)),r.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(t=>L7(t))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((t,i)=>t+(L7(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function pbt(e){return e.active&&iZ(e.layer)}function L7(e){return e.labelClassPromise&&!!e.labelClassAbortController}function Ife(e){return e.labelClassContexts&&e.labelClassContexts.length}function fbt(e){return e.labelClassContexts===null}u([d({constructOnly:!0})],$x.prototype,"view",void 0),u([d({constructOnly:!0})],$x.prototype,"deconflictor",void 0),u([d()],$x.prototype,"_textTextureAtlas",void 0),u([d({type:Boolean,readOnly:!0})],$x.prototype,"updating",null),$x=u([L("esri.views.3d.layers.graphics.Labeler")],$x);const __=new qft(null,null,null);class mbt{constructor(){this.gltfCache=new Map,this.wosrCache=new Map,this.evictHandles=new Nt}loadGLTF(t,i,r){const s=r?`gltfPBR:${t}`:`gltf:${t}`;return this._fromCache(this.gltfCache,s,n=>TPe(new wPe(n.streamDataRequester),t,n,r),i)}loadWOSR(t,i){const r=`wosr:${t}:${i.disableTextures}`;return this._fromCache(this.wosrCache,r,s=>SPe(t,s),i)}destroy(){this.evictHandles.destroy(),this.gltfCache.clear(),this.wosrCache.clear()}get size(){return this.wosrCache.size+this.gltfCache.size}_fromCache(t,i,r,s){return new Promise((n,o)=>{if(an(s))return void o(mi());const a=va(s,()=>{this._remove(t,i),o(mi())}),l=t.get(i);if(l)return this.evictHandles.remove(i),l.refCount++,void l.item.then(n,o);const c=new AbortController,h=me(F({},s),{signal:c.signal}),p={refCount:1,abortController:c,item:r(h).then(f=>(p.abortController=null,f.remove=()=>this._remove(t,i),f))};t.set(i,p),p.item.then(f=>{_(a)&&a.remove(),n(f)},f=>{_(a)&&a.remove(),o(f)})})}_remove(t,i){const r=t.get(i);r&&(r.refCount--,r.refCount===0&&this.evictHandles.add(g5e(()=>{t.delete(i),_(r.abortController)&&r.abortController.abort()},ybt),i))}}const gbt=1e4;let ybt=gbt;class Pf{constructor(t,i,r,s=null){this.lij=[0,0,0],this.extent=Qt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:il.VISIBLE_ON_SURFACE,screenRect:Qt(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(t,i,r,s)}acquire(t,i,r,s){this.tilingScheme=s,this.id=Pf.id(t,i,r),this.lij[0]=t,this.lij[1]=i,this.lij[2]=r,s.getExtent(t,i,r,this.extent),this.resolution=s.resolutionAtLevel(t)}release(){this.tilingScheme=null}getChildren(t){const i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return t?(t[0].acquire(i,r,s,this.tilingScheme),t[1].acquire(i,r+1,s,this.tilingScheme),t[2].acquire(i,r,s+1,this.tilingScheme),t[3].acquire(i,r+1,s+1,this.tilingScheme),t):[new Pf(i,r,s,this.tilingScheme),new Pf(i,r+1,s,this.tilingScheme),new Pf(i,r,s+1,this.tilingScheme),new Pf(i,r+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(t){this.measures.visibility=t.measures.visibility,this.measures.shouldSplit=t.measures.shouldSplit,this.measures.distance=t.measures.distance,pv(t.measures.screenRect,this.measures.screenRect)}static id(t,i,r){return`${t}/${i}/${r}`}}var il;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",e[e.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(il||(il={}));class U1{constructor(t){this.renderCoordsHelper=t,this.frustum=C$(),this._points=jAe(),this.lines=new Array(12),this._origin=$(),this._direction=$(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:$(),endpoint:null}}get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}update(t){HAe(t.viewMatrix,t.projectionMatrix,this.frustum,this._points),pe(this._origin,t.eye),pe(this._direction,t.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(t){for(let i=0;i<this._points.length;i++)pe(this._points[i],t[i]);qAe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(t){return rb(this.frustum,t)}intersectsRay(t){return Ect(this.frustum,t)}intersectsLineSegment(t,i){return Cct(this.frustum,t,i)}intersectsPoint(t){return WAe(this.frustum,t)}_updateLines(){const t=this._points;for(let i=0;i<4;i++){const r=i+4;D7(this.lines[i],t[i],t[r]),D7(this.lines[i+4],t[i],i===3?t[0]:t[i+1]),D7(this.lines[i+8],t[r],i===3?t[4]:t[r+1])}}}function D7(e,t,i){e.origin=t,e.endpoint=i,Rv(e.direction,t,i)}U1.planePointIndices=Mct,U1.nearFarLineIndices=[[mt.NEAR_BOTTOM_LEFT,mt.FAR_BOTTOM_LEFT],[mt.NEAR_BOTTOM_RIGHT,mt.FAR_BOTTOM_RIGHT],[mt.NEAR_TOP_RIGHT,mt.FAR_TOP_RIGHT],[mt.NEAR_TOP_LEFT,mt.FAR_TOP_LEFT]];const zPe=.5*Math.PI,vbt=zPe/Math.PI*180;class _bt{constructor(t){this.renderCoordsHelper=t.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:$(),direction:$()};for(let i=0;i<4;i++)this.extent[i]={origin:$(),direction:$(),cap:{next:null,direction:$()}},this.planes[i]=qi();this.planes[Mr.NEAR]=qi(),this.planes[Mr.FAR]=qi(),this.planesWithoutFar=this.planes.slice(0,5)}update(t,i,r,s=!0){const n=this.extent;this._toRenderBoundingExtent(t,i,r),we(this.center.origin,n[0].origin,n[2].origin),fe(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),s||fe(this.center.direction,this.center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this.renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,Rv(a.cap.direction,a.origin,l.origin),B3(a.direction,a.cap.direction,a.origin,this.planes[o]),s||fe(a.direction,a.direction,-1)}B3(n[0].cap.direction,n[1].cap.direction,n[0].origin,this.planes[Mr.NEAR]),s?KW(this.planes[Mr.NEAR],this.planes[Mr.FAR]):(bB(this.planes[Mr.FAR],this.planes[Mr.NEAR]),KW(this.planes[Mr.NEAR],this.planes[Mr.NEAR])),this.maxSpan=Math.max(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3])),this.maxSpanSpatialReference=i,this.minGlobalAltitude=.9*Ri(this.maxSpanSpatialReference).radius}isVisibleInFrustum(t,i,r=!1){if(t==null)return!1;if(this.renderCoordsHelper.viewingMode===tt.Global){const n=this.maxSpanSpatialReference.isGeographic?vbt:zPe*i;if(this.maxSpan>n)return!0;if(t.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(t)}if(this.maxSpan===0){const n=this.extent[0];return!(r||!t.intersectsRay(od(n.origin,n.direction)))}for(let n=0;n<this.extent.length;n++){const o=this.extent[n];if(!r&&t.intersectsRay(od(o.origin,o.direction))||t.intersectsLineSegment(XT(o.origin,o.cap.next,wbt),o.cap.direction))return!0}const s=r?this.planes:this.planesWithoutFar;for(let n=0;n<t.lines.length;n++){const o=t.lines[n];if(ilt(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(t,i,r){dK(t,Bp),Bp[2]=r,nd(i,Bp,N7,this.renderCoordsHelper.spatialReference),Ks($fe,N7),Nr(Qc);for(const{x0:n,x1:o,y0:a,y1:l}of bbt)for(let c=0;c<5;c++){const h=c/4;Bp[0]=ui(t[n],t[o],h),Bp[1]=ui(t[a],t[l],h),Bp[2]=r,Zn(Bp,i,Bp,this.renderCoordsHelper.spatialReference),Xe(Bp,Bp,$fe),qg(Qc,Bp)}he(this.extent[0].origin,Qc[0],Qc[1],Qc[2]),he(this.extent[1].origin,Qc[3],Qc[1],Qc[2]),he(this.extent[2].origin,Qc[3],Qc[4],Qc[2]),he(this.extent[3].origin,Qc[0],Qc[4],Qc[2]);for(let n=0;n<4;++n)Xe(this.extent[n].origin,this.extent[n].origin,N7)}_toRenderBoundingExtentLocal(t,i,r){mB(t,i,Ny,this.renderCoordsHelper.spatialReference),he(this.extent[0].origin,Ny[0],Ny[1],r),he(this.extent[1].origin,Ny[2],Ny[1],r),he(this.extent[2].origin,Ny[2],Ny[3],r),he(this.extent[3].origin,Ny[0],Ny[3],r)}_toRenderBoundingExtent(t,i,r){switch(this.renderCoordsHelper.viewingMode){case tt.Global:this._toRenderBoundingExtentGlobal(t,i,r);break;case tt.Local:this._toRenderBoundingExtentLocal(t,i,r);break;default:this.renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(t){if(Or(t.planes[Mr.NEAR],this.center.origin)<0&&Pe(this.center.direction,t.direction)<0)return!0;for(let i=0;i<4;i++){const r=this.extent[i];if(Or(t.planes[Mr.NEAR],r.origin)<0&&Pe(r.direction,t.direction)<0)return!0}return!1}}const bbt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Bp=$(),N7=Ne(),$fe=Ne(),Qc=In(),Ny=Qt(),wbt=dy();class xbt{constructor(t){this.renderCoordsHelper=t,this.surfaceElevation=0,this.cache=new Map,this.frustum=new U1(t),this.extendedFrustum=new U1(t),this.intersector=new _bt({renderCoordsHelper:t}),this.renderCoordsHelper=t}begin(t,i){this.surfaceElevation=i,this.aboveGround=this.renderCoordsHelper.getAltitude(t.eye)>i,this.frustum.update(t),this._shortenFrustumFarPlane(this.frustum),this._updateExtendedFrustum(t)}end(){this.cache.clear()}calculate(t){if(this.allTilesInvisible)return il.INVISIBLE;const i=this.renderCoordsHelper.viewingMode===tt.Global&&t.lij[0]>=Tbt&&t.lij[0]<Sbt,r=this._getOrCalculateSingleTileVisibility(t,!i);return r!==il.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(t):r}_shortenFrustumFarPlane(t){const i=U1.nearFarLineIndices,r=t.mutablePoints;for(const s of i){const[n,o]=s,a=r[n],l=r[o];xe(rh,l,a),fe(rh,rh,Cbt),we(r[o],a,rh)}t.updatePoints(r)}_calculateAggregatedChildrenVisibility(t){let i=il.INVISIBLE;const r=this.cache.get(t.id);if(r!=null)return r;const s=Ffe.acquire();t.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==il.INVISIBLE&&(i=o,o===il.VISIBLE_ON_SURFACE))break}return Ffe.release(s),this.cache.set(t.id,i),i}_getOrCalculateSingleTileVisibility(t,i){const r=this.cache.get(t.id);if(r!=null)return r;const s=this._calculateSingleTileVisibility(t);return i&&this.cache.set(t.id,s),s}_calculateSingleTileVisibility(t){return!this.aboveGround&&this.renderCoordsHelper.viewingMode===tt.Global&&t.lij[0]<Ebt?this._calculateSingleTileVisibilitySided(t,!1)===il.INVISIBLE?this._calculateSingleTileVisibilitySided(t,!0):void 0:this._calculateSingleTileVisibilitySided(t,this.aboveGround)}_calculateSingleTileVisibilitySided(t,i){this.intersector.update(t.extent,t.tilingScheme.spatialReference,this.surfaceElevation,i);const r=Ri(t.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,r)?this.intersector.isVisibleInFrustum(this.frustum,r,!0)?il.VISIBLE_ON_SURFACE:il.VISIBLE_WHEN_EXTENDED:il.INVISIBLE}_updateExtendedFrustum(t){this.extendedFrustum.update(t),this._shortenFrustumFarPlane(this.extendedFrustum);const i=this.renderCoordsHelper.worldUpAtPosition(t.eye,rh);this.aboveGround||ll(i,i);const r=Yn(-Pe(i,t.viewForward));if(this.allTilesInvisible=r>(Math.PI+t.fovY)/2,this.allTilesInvisible||(this.hasExtendedFrustum=r>t.fovY/2,!this.hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this.extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this.renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this.renderCoordsHelper.worldUpAtPosition(l,rh),a){case mt.FAR_BOTTOM_LEFT:case mt.FAR_TOP_LEFT:case mt.NEAR_BOTTOM_LEFT:case mt.NEAR_TOP_LEFT:eZ(this.extendedFrustum.planes[Mr.LEFT],rh,rh);break;case mt.FAR_BOTTOM_RIGHT:case mt.FAR_TOP_RIGHT:case mt.NEAR_BOTTOM_RIGHT:case mt.NEAR_TOP_RIGHT:eZ(this.extendedFrustum.planes[Mr.RIGHT],rh,rh)}fe(rh,rh,s.direction),this.renderCoordsHelper.intersectInfiniteManifold(od(l,rh),s.zWithMargin,l)}}if(this.extendedFrustum.updatePoints(n),sl(n[mt.NEAR_BOTTOM_LEFT],n[mt.NEAR_BOTTOM_RIGHT],n[mt.NEAR_TOP_RIGHT],Dfe),sl(n[mt.NEAR_BOTTOM_RIGHT],n[mt.NEAR_TOP_RIGHT],n[mt.NEAR_TOP_LEFT],Nfe),Pe(Dfe,Nfe)<0){const o=this.extendedFrustum.mutablePoints;this.aboveGround?[o[mt.NEAR_BOTTOM_LEFT],o[mt.NEAR_BOTTOM_RIGHT]]=[o[mt.NEAR_BOTTOM_RIGHT],o[mt.NEAR_BOTTOM_LEFT]]:[o[mt.NEAR_TOP_LEFT],o[mt.NEAR_TOP_RIGHT]]=[o[mt.NEAR_TOP_RIGHT],o[mt.NEAR_TOP_LEFT]],this.extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this.aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const t=this.surfaceElevation-Lfe;return{zWithMargin:t,pointIndices:U1.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>t}}_extendedFrustumParametersBelowSurface(){const t=this.surfaceElevation+Lfe;return{zWithMargin:t,pointIndices:U1.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<t}}}const Tbt=2,Sbt=6,Ebt=12,Cbt=.95,Lfe=1,rh=$(),Dfe=qi(),Nfe=qi(),Ffe=new un(Array,e=>{e.length!==4&&(e[0]=new Pf,e[1]=new Pf,e[2]=new Pf,e[3]=new Pf)},e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release()});class Abt{constructor(t){this.camera=new xr,this.focusOnMap=[0,0],this.screenRect=Qt(),this.tileSize=t.tileSize,this.renderCoordsHelper=t.renderCoordsHelper,this.tilingScheme=t.tilingScheme,this.visibility=new xbt(t.renderCoordsHelper)}begin(t,i,r){this.camera.copyFrom(t),this.surfaceElevation=r,this.focusOnMap[0]=i.x,this.focusOnMap[1]=i.y,uK(0,0,t.fullWidth,t.fullHeight,this.screenRect),this.visibility.begin(this.camera,r)}end(){this.visibility.end()}updateTile(t){t.measures.visibility=this.visibility.calculate(t),t.measures.distance=Hze(t.extent,this.focusOnMap),t.measures.visibility!==il.INVISIBLE&&this._updateScreenMeasure(t)}_updateScreenMeasure(t){const i=Mbt,r=1<<i,s=t.measures.screenRect;id(s);let n=0;const o=t.lij[0]+i,a=t.lij[1]<<i,l=t.lij[2]<<i,c=this._tileSizeWithBias(t),h=c*c;for(let p=0;p<r;p++)for(let f=0;f<r;f++)if(n+=this._computeScreenArea(t,o,a+p,l+f,s),n>h)return void(t.measures.shouldSplit=!0);t.measures.shouldSplit=!1}_tileSizeWithBias(t){return t.measures.visibility===il.VISIBLE_WHEN_EXTENDED?this.tileSize*Obt:this.tileSize}_computeScreenArea(t,i,r,s,n){const o=t.measures.visibility===il.VISIBLE_WHEN_EXTENDED;this._projectToScreen(i,r,s,o,b_),id(F7);for(let a=0;a<4;a++)lA(F7,b_[a]);return GT(n,F7,n),ghe(b_[0],b_[1],b_[2])+ghe(b_[0],b_[2],b_[3])}_projectToScreen(t,i,r,s,n){this.tilingScheme.ensureMaxLod(t),this.tilingScheme.getExtent(t,i,r,DR),this._toRenderCoords(DR,0,3,w_[0]),this._toRenderCoords(DR,2,3,w_[1]),this._toRenderCoords(DR,2,1,w_[2]),this._toRenderCoords(DR,0,1,w_[3]),s&&(this._projectToPlane(w_,this.camera.frustum[Mr.NEAR]),this._projectToPlane(w_,this.camera.frustum[Mr.TOP]),this._projectToPlane(w_,this.camera.frustum[Mr.BOTTOM]));for(let o=0;o<4;o++)this.camera.projectToRenderScreen(w_[o],kfe),this.camera.renderToScreen(kfe,n[o])}_projectToPlane(t,i){for(let s=0;s<4;s++)FR[s]=Or(i,t[s]);const r=Math.max(FR[0],FR[1],FR[2],FR[3]);if(r>0){const s=fe(NR,i,-r);for(let n=0;n<4;n++)we(t[n],t[n],s)}}_toRenderCoords(t,i,r,s){return NR[0]=t[i],NR[1]=t[r],NR[2]=this.surfaceElevation,this.renderCoordsHelper.toRenderCoords(NR,this.tilingScheme.spatialReference,s),s}}const F7=Qt(),Mbt=2,Obt=5,b_=[Ts(),Ts(),Ts(),Ts()],DR=Qt(),NR=$(),w_=[$(),$(),$(),$()],FR=[0,0,0,0],kfe=ko();function ekt(e,t,i){if(M(e)||M(i))return!1;let r=!0;return Bn[0]=e.xmin!=null?e.xmin:0,Bn[1]=e.ymin!=null?e.ymin:0,Bn[2]=e.zmin!=null?e.zmin:0,r=r&&$r(Bn,e.spatialReference,0,t,i,0,1),Bn[0]=e.xmax!=null?e.xmax:0,Bn[1]=e.ymax!=null?e.ymax:0,Bn[2]=e.zmax!=null?e.zmax:0,r=r&&$r(Bn,e.spatialReference,0,t,i,3,1),e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.zmin==null&&(t[2]=-1/0),e.xmax==null&&(t[3]=1/0),e.ymax==null&&(t[4]=1/0),e.zmax==null&&(t[5]=1/0),r}function VPe(e,t,i){if(M(e)||M(i))return!1;let r=!0;return Bn[0]=e.xmin!=null?e.xmin:0,Bn[1]=e.ymin!=null?e.ymin:0,Bn[2]=e.zmin!=null?e.zmin:0,r=r&&$r(Bn,e.spatialReference,0,Bn,i,0,1),t[0]=Bn[0],t[1]=Bn[1],Bn[0]=e.xmax!=null?e.xmax:0,Bn[1]=e.ymax!=null?e.ymax:0,Bn[2]=e.zmax!=null?e.zmax:0,r=r&&$r(Bn,e.spatialReference,0,Bn,i,0,1),t[2]=Bn[0],t[3]=Bn[1],e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.xmax==null&&(t[2]=1/0),e.ymax==null&&(t[3]=1/0),r}const Bn=$(),Rbt=ve.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");let oa=class extends Ee{constructor(e){super(e),this.tiles=new nt,this.tileSize=512,this._idToTile=new Map,this._handles=new Nt,this._clients=new Set,this._dirty=!1,this._newTiles=new ai}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(_(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void Rbt.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||_(t)&&e&&t.equals(e))return;const i=_(e)?e.clone():null;this._set("filterExtent",i),this._setDirty()}get filterExtentRect(){if(M(this.filterExtent)||!this.tilingScheme)return null;const e=Qt();return VPe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get rootTileIds(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}initialize(){this._handles.add([re(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Ui),re(()=>{var e,t,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(t=this.viewState)==null?void 0:t.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),fi)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(Ot.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=hn(this._frameWorker),this._handles=We(this._handles)}addClient(){const e=Ibt();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(bO))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),_(this._frameWorker)&&(this._frameWorker.priority=Ot.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&_(this._frameWorker)&&(this._frameWorker.priority=Ot.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new Abt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){return this.rootTileIds.map(e=>new Pf(e[0],e[1],e[2],this.tilingScheme))}_purgeHorizonTiles(e){e.sort((t,i)=>{const r=t.measures.screenRect,s=i.measures.screenRect;return r[1]+r[3]-(s[1]+s[3])}),id(IF);for(let t=0;t<e.length;t++)if(GT(IF,e.data[t].measures.screenRect,IF),nm(IF)>$bt)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(this._pendingTiles){for(;this._pendingTiles.length>0&&!e.done;){const t=this._pendingTiles.pop();e.madeProgress(),this.filterExtentRect&&!hL(this.filterExtentRect,t.extent)||(this._tileMeasurements.updateTile(t),t.measures.visibility!==il.INVISIBLE&&(t.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(t.lij[0]+1),this._pendingTiles.push(...t.getChildren())):this._newTiles.push(t)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(e){for(const r of this.tiles.items)r.used=!1;const t=e.filter(r=>{const s=this._idToTile.get(r.id);return s?(s.copyMeasurementsFrom(r),s.used=!0):this._idToTile.set(r.id,r),!s}),i=this.tiles.items.filter(r=>!r.used&&(this._idToTile.delete(r.id),!0));this.tiles.removeMany(i),this.tiles.addMany(t),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===il.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};u([d({constructOnly:!0})],oa.prototype,"scheduler",void 0),u([d({constructOnly:!0})],oa.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],oa.prototype,"tilingSchemeOwner",void 0),u([d({constructOnly:!0})],oa.prototype,"cameraOnSurface",void 0),u([d({constructOnly:!0})],oa.prototype,"focus",void 0),u([d({constructOnly:!0})],oa.prototype,"viewState",void 0),u([d({constructOnly:!0})],oa.prototype,"terrain",void 0),u([d()],oa.prototype,"tiles",void 0),u([d()],oa.prototype,"tileSize",void 0),u([d({readOnly:!0})],oa.prototype,"tilingScheme",null),u([d()],oa.prototype,"filterExtent",null),u([d({readOnly:!0})],oa.prototype,"filterExtentRect",null),u([d({readOnly:!0})],oa.prototype,"rootTileIds",null),u([d({value:!1})],oa.prototype,"suspended",null),u([d({readOnly:!0})],oa.prototype,"updating",null),oa=u([L("esri.views.3d.layers.support.FeatureTileTree3D")],oa);let Pbt=0;function Ibt(){return Pbt++}const IF=Qt(),$bt=10;let sa=class extends Ee{constructor(){super(...arguments),this._propertiesPool=new wv({camera:xr},this),this._lastSeenCameraProjectionValues=new xr,this.events=new cs,this.viewingMode=tt.Global,this._cameraChanged=!1,this.updateQueue=new Array,this.processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new n0({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new wv({camera:xr},this)}createInitialCamera(){if(this.viewingMode===tt.Global){const e=Ri(this.spatialReference).radius;this.camera=new xr(Ze(4*e,0,0),Ze(e,0,0),Ze(0,0,1))}else this.camera=new xr(Ze(0,0,100),Ze(0,0,0),Ze(0,1,0))}get animation(){return this.cameraController instanceof A$&&_(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==_d&&_d.copyFrom(e),_d.computeUp(this.viewingMode),Ufe.camera=_d,this.events.emit("before-camera-change",Ufe);const t=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,_d)&&(this._lastSeenCameraProjectionValues.copyFrom(_d),zfe.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",zfe)),(!t||!t.equals(_d))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(_d)),this._cameraChanged=!t||!t.almostEquals(_d),this._cameraChanged)){const i=Nve(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return _(this._contentCamera)?this._contentCamera:this.camera}set contentCamera(e){this._contentCamera=_(e)?e.clone():null}get fixedContentCamera(){return _(this._contentCamera)}get isGlobal(){return this.viewingMode===tt.Global}get isLocal(){return this.viewingMode===tt.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.own(re(()=>e.state,t=>{t!==bs.Finished&&t!==bs.Stopped||(this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i)))},Ui)),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=bs.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==bs.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this.updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this.updateQueue.length===0||this.processingUpdates)return;this.processingUpdates=!0;const e=this.updateQueue.shift();_d.copyFrom(this._get("camera")),e(_d),this.camera=_d,this.processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[Vt.TOP]!==t.padding[Vt.TOP]||e.padding[Vt.RIGHT]!==t.padding[Vt.RIGHT]||e.padding[Vt.BOTTOM]!==t.padding[Vt.BOTTOM]||e.padding[Vt.LEFT]!==t.padding[Vt.LEFT]}};u([d({readOnly:!0,type:dM})],sa.prototype,"animation",null),u([d({type:xr})],sa.prototype,"camera",null),u([d()],sa.prototype,"pixelRatio",null),u([d({})],sa.prototype,"_contentCamera",void 0),u([d({type:xr})],sa.prototype,"contentCamera",null),u([d({readOnly:!0})],sa.prototype,"fixedContentCamera",null),u([d({readOnly:!0})],sa.prototype,"constraints",void 0),u([d({readOnly:!0})],sa.prototype,"events",void 0),u([d({readOnly:!0})],sa.prototype,"isGlobal",null),u([d({readOnly:!0})],sa.prototype,"isLocal",null),u([d({readOnly:!0})],sa.prototype,"viewingMode",void 0),u([d({readOnly:!0})],sa.prototype,"spatialReference",void 0),u([d({readOnly:!0})],sa.prototype,"navigating",null),u([d({readOnly:!0})],sa.prototype,"stationary",null),u([d()],sa.prototype,"_cameraChanged",void 0),u([d()],sa.prototype,"cameraController",null),sa=u([L("esri.views.3d.state.ViewState")],sa);const Lbt=sa,_d=new xr,Ufe={camera:null},zfe={camera:null};function Dbt(e,t,i){return e===tt.Global?new Fbt(i):new Nbt(t,i)}class Nbt{constructor(t,i){this.elevationProvider=t,this._referenceEllipsoid=Ri(i),this.unitInMeters=$n(i,this._referenceEllipsoid.metersPerDegree)}compute(t,i,r,s,n){n||(n={near:0,far:0});let o=t[2]*this.unitInMeters;const a=o,l=o-s,c=this.elevationProvider?this.elevationProvider.elevationBounds:null;c&&(o=l>=0?a-this.unitInMeters*c.min:this.unitInMeters*c.max-a);const h={x:(r=_(r)?r:new yi({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},p=Math.max(h.x,h.y,h.z);xe(Fw,i,t),lE[0]=Fw[0]>0?r.xmax:r.xmin,lE[1]=Fw[1]>0?r.ymax:r.ymin,lE[2]=Fw[2]>0?p/2:-p/2,xe(lE,lE,t),Re(Fw,Fw);const f=1.1*Pe(lE,Fw)*this.unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),y=g*zbt*this.unitInMeters,x=g*Vbt*this.unitInMeters;let b=He((o-x)/(y-x),0,1);b*=b*b;let S=ui(m,f,b);return S*=Math.max(Math.log(Math.abs(l)),1),S=Math.min(S,Math.max(34064e4,p)),S/=this.unitInMeters,BPe(S,kbt,this.unitInMeters,n)}}class Fbt{constructor(t){this._referenceEllipsoid=Ri(t)}compute(t,i,r,s,n){n||(n={near:0,far:0});const o=Ue(t)-this._referenceEllipsoid.radius,a=this._referenceEllipsoid.radius+Math.min(0,s),l=Math.abs(o-s),c=Math.max(l,Math.abs(o));return BPe(1.2*Math.sqrt(c*(c+2*a)),He(2e4-(Math.log(c)-7.983)/9.011*19e3,1e3,2e4),1,n)}}function BPe(e,t,i,r){const s=Ubt/i;return e/t>s?(r.far=e,r.near=r.far/t):(r.near=s,r.far=r.near*t),r}const kbt=2e4,Ubt=2,zbt=.001,Vbt=1e-4,lE=$(),Fw=$();let _k=class extends Ee{constructor(e){super(e),this.handles=new Nt}initialize(){this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;$Ae(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>{TO(this.view,e,pp.EYE_AND_CENTER)})}};u([d({constructOnly:!0})],_k.prototype,"view",void 0),_k=u([L("esri.views.3d.state.ElevationCollisionConstraint")],_k);let dI=class extends Ee{constructor(e){super(e),this._handles=new Nt,this.nearFarHeuristic=Dbt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this._handles.add([re(()=>{var e,t,i,r;return[(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.near,(r=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:r.far]},()=>this._clipDistanceNearFarChanged()),re(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e.camera)),re(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Ui),re(()=>{var e,t,i,r;return[(t=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:t.min,(r=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:r.max]},()=>this._updateAltitude(),Ui),re(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.max},()=>this._updateTiltMax(),Ui),re(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.mode},()=>this._updateTilt(),Ui),re(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),Ui),re(()=>{var e,t,i,r,s,n;return[(i=(t=(e=this.view.map)==null?void 0:e.ground)==null?void 0:t.navigationConstraint)==null?void 0:i.type,(n=(s=(r=this.view.state)==null?void 0:r.constraints)==null?void 0:s.collision)==null?void 0:n.enabled]},()=>this._updateCollision(),Ui)]),this.view.state.isLocal&&this._handles.add(re(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Et)),this._updateNearFar(),this.view.state.viewingMode!==tt.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new _k({view:this.view}))}destroy(){this._handles=We(this._handles),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var t;const e=(t=this.view.constraints)==null?void 0:t.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>(this._updateCameraNearFarManual(i,e),!0))}_updateNearFar(){this.view.state.updateCamera(e=>(this._updateCameraNearFar(e),!0))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;(t?t.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,b6(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){var r,s,n;const e=(n=(s=(r=this.view.map)==null?void 0:r.ground)==null?void 0:s.navigationConstraint)==null?void 0:n.type,t=!e||e==="stay-above",i=this.view.state.constraints.collision;if(t!==i.enabled){i.enabled=t,t&&this._reapplyConstraints(jr.COLLISION);const o=this.view.constraints&&this.view.constraints.tilt;o&&o.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==tt.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(Yt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const t=this.view.state.constraints;if(t.tilt){const i=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(Vu(i))}}_updateLocalSurfaceDistance(e){if(M(e))return;let t=Math.max(e.width,e.height);if(t<=0)return;e.hasZ&&(t=Math.max(t,e.zmax-e.zmin));const i=this.view.state,r=3*t/Math.atan(i.camera.fov/2);r!==i.constraints.distance&&(i.constraints.distance=r)}_reapplyConstraints(e=jr.ALL){this.view.state.updateCamera(t=>Js(this.view,t,{selection:e,interactionType:ni.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:zo.TUMBLE}))}};u([d({constructOnly:!0})],dI.prototype,"view",void 0),u([d({readOnly:!0})],dI.prototype,"surfaceCollisionConstraint",void 0),dI=u([L("esri.views.3d.state.ConstraintsManager")],dI);let QC=class extends $T{constructor(e){super(e),this.handles=new Nt}set desiredCamera(e){this._set("desiredCamera",e.clone())}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=bs.Running,this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){$Ae(this.view,this.desiredCamera,e.extent,e.spatialReference)&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),TO(this.view,e,pp.EYE_AND_CENTER)||this.constraintEnabled||(this.state=bs.Stopped)})}};u([d({constructOnly:!0})],QC.prototype,"view",void 0),u([d({constructOnly:!0})],QC.prototype,"desiredCamera",null),QC=u([L("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],QC);const Bbt=.66;function GPe(e){return 360-VV.normalize(e)}function p8(e){return VV.normalize(360-e)}function $F(e){return _(e)&&e.resolver&&e.resolver.reject(),null}function Gbt(e,t){return _(e)&&e.resolver&&e.resolver.resolve(t),t}function jPe(e,t,i,r=null){if(!t)return $F(r);const s=e.spatialReference||at.WGS84;if(_(t.camera)){const c=HS(t.camera.position,s);if(M(c))return $F(r);const h=t.camera.clone();return h.position=c,Gbt(r,h)}if(M(t.targetGeometry))return $F(r);const n=t.get("targetGeometry.spatialReference");if(n&&!Ig(n,s))return $F(r);const o=OM(e,e.state.camera);let a=za.ADJUST;if(t.rotation!=null&&(o.heading=GPe(t.rotation),a=za.LOCKED),i!=null&&(o.tilt=i),t.targetGeometry.type==="point"){const c=t.targetGeometry;let h;const p=t.targetGeometry.clone();return h=t.scale!=null?Hie(e,t.scale,c.latitude):e.state.camera.distance,EMe(e,p,h,o,a,r)}const l=t.targetGeometry.extent;return KI(e,l,o.heading,o.tilt,a,r)}function jbt(e,t,i=null){return M(i)&&(i=new xp),Fre(e,null,t.clone(),i)}async function Hbt(e,t,i){const r=twt(e,t);if(!r)throw new W("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new ju({fov:e.camera.fov}),n=new xp({camera:s});if(r.target instanceof xp)return kw(await Zbt(e,r.target,r,i,n));if(r.target instanceof ju)return kw(qPe(e,r.target,n));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof yi){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return kw(o||c?await gJ(e,r,r.target.center,s,i,n):await Qbt(e,r,r.target,s,i,n))}const a={boundingBox:Nr(),hasZ:!1,screenSpaceObjects:[]},l=o?qbt(e,r):void 0;if(await HPe(e,r.target,l,a),isFinite(a.boundingBox[0])){let c;if(Df(a.boundingBox,Ys),Rh.x=Ys[0],Rh.y=Ys[1],Rh.z=Ys[2],Rh.spatialReference=e.spatialReference,isFinite(Rh.z)&&a.hasZ?c=KV(a.boundingBox):(Rh.z=void 0,c=qze(mK(a.boundingBox,rwt))),o||c)return kw(await gJ(e,r,Rh,s,i,n));const h=iwt(e,a.screenSpaceObjects);return kw(await ewt(e,r,Rh,a.boundingBox,h,s,i,n))}return r.position?kw(Ybt(e,r,s,n)):kw(await Jbt(e,r,s,i,n))}function Dre(e,t){return t.scale==null&&t.zoom!=null?MMe(e,t.zoom):t.scale}function qbt(e,t){return tht(e,Dre(e,t))}function Nre(e,t){let i=!1;return t.heading!=null?(e.heading=t.heading,i=!0):t.rotation!=null&&(e.heading=GPe(t.rotation),i=!0),t.tilt!=null&&(e.tilt=t.tilt,i=!0),t.fov!=null&&(e.fov=t.fov),i}function Fre(e,t,i,r){const s=e.spatialReference||at.WGS84;return t=_(t)?t:S0(e,i),M(t)||(r.targetGeometry=Ob(t.center,e.renderSpatialReference,s),r.scale=OMe(e,t),r.rotation=p8(i.heading),r.camera=i),r}function aV(e,t,i){if(!t)return;if(!Ig(t.spatialReference,e.spatialReference))throw new W("viewpointutils:incompatible-spatialreference",`Spatial reference (${t.spatialReference?t.spatialReference.wkid:"unknown"}) is incompatible with the view (${e.spatialReference.wkid})`,{geometry:t});const r=[];if(!t.hasZ&&e.basemapTerrain){let o;switch(t.type){case"point":o=t;break;case"multipoint":case"polyline":o=t.extent.center;break;case"mesh":o=t.origin;break;case"extent":o=t.center;break;case"polygon":o=t.centroid}o&&Ig(o,e.basemapTerrain.spatialReference)?Ys[2]=Ye(Ag(e.elevationProvider,o),0):Ys[2]=0}(0,swt[t.type])(t,o=>{r.push(o[0],o[1],o[2])},Ys);const s=r.length/3;if(s===0)return;const n=new Array(r.length);if($r(r,t.spatialReference,0,n,e.spatialReference,0,s)){t.hasZ&&(i.hasZ=!0);for(let o=0;o<n.length;o+=3)t.hasZ?(Ys[0]=n[o+0],Ys[1]=n[o+1],Ys[2]=n[o+2]):(Ys[0]=n[o+0],Ys[1]=n[o+1]),qg(i.boundingBox,Ys)}}async function Wbt(e,t,i,r){const s=await Hu(e.whenViewForGraphic(t));if(s.ok===!1||M(s.value)||!("whenGraphicBounds"in s.value))return void aV(e,t.geometry,r);const n=s.value,o=await Hu(n.whenGraphicBounds(t,{minDemResolution:i}));if(o.ok===!1)return void aV(e,t.geometry,r);const{screenSpaceObjects:a,boundingBox:l}=o.value;XA(r.boundingBox,l),a&&a.forEach(c=>{r.screenSpaceObjects.push(c)}),isFinite(l[2])&&(r.hasZ=!0)}async function HPe(e,t,i,r){if(Array.isArray(t)&&t.length===2){const s=t[0],n=t[1];if(typeof s=="number"&&typeof n=="number")return Rh.x=s,Rh.y=n,Rh.z=void 0,Rh.spatialReference=e.spatialReference.isGeographic?e.spatialReference:at.WGS84,void aV(e,Rh,r)}t&&typeof t.map=="function"?await Us(t.map(s=>HPe(e,s,i,r))):t instanceof Gu?aV(e,t,r):t instanceof Ha&&await Wbt(e,t,i,r)}async function Zbt(e,t,i,r,s){if(_(t.camera))return qPe(e,t.camera,s);s.scale=t.scale,s.rotation=t.rotation,s.targetGeometry=_(t.targetGeometry)?t.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=p8(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=Dre(e,i);n!=null&&(s.scale=n);const o=new CO(r);return jPe(e,s,i.tilt,o),s.camera=await o.resolver.promise,s}function qPe(e,t,i){const r=e.spatialReference,s=HS(t.position,r);return M(s)?null:((t=t.clone()).fov=e.camera.fov,t.position=s,Fre(e,null,t,i))}function Xbt(e,t,i,r,s,n){const o=e.renderSpatialReference;return Go(i.position,DF,o),Go(t,k7,o),n.targetGeometry=new dt(t),s.position=new dt(i.position),xe(lV,k7,DF),T6(e,DF,lV,r.up,s),n.scale=$S(e,Pr(DF,k7),n.targetGeometry.latitude),n.rotation=p8(s.heading),n.camera=s,n}async function gJ(e,t,i,r,s,n){if(M(i))throw new W("createfromcenter","invalid point");n.targetGeometry=i.clone();const o=c2(e);if(t.position)return Xbt(e,n.targetGeometry,t,o,r,n);if(t.zoomFactor){const l=o.distance/t.zoomFactor,c=fe(Ys,o.viewForward,-l);o.eye=we(Ys,o.center,c),n.scale=$S(e,l,i.latitude)}OM(e,o,r);const a=Nre(r,t)?za.LOCKED:za.ADJUST;if(!t.zoomFactor){n.scale=Dre(e,t),n.scale==null&&(Go(i,Ys,e.renderSpatialReference),WAe(o.frustum,Ys)?n.scale=$S(e,Pr(o.eye,Ys),i.latitude):n.scale=OMe(e,o));const l=new CO(s);SMe(e,n.targetGeometry,n.scale,r,a,l),n.camera=await l.resolver.promise}return n}function Ybt(e,t,i,r){const s=c2(e);return pe(lV,s.viewForward),T6(e,s.eye,lV,s.up,U7),i.position=new dt(t.position),i.heading=t.heading!=null?t.heading:U7.heading,i.tilt=t.tilt!=null?t.tilt:U7.tilt,Fre(e,null,i,r)}async function Jbt(e,t,i,r,s){const n=c2(e);return gJ(e,t,Ob(n.center,e.renderSpatialReference,e.spatialReference),i,r,s)}async function Qbt(e,t,i,r,s,n){n.targetGeometry=i.clone();const o=c2(e);OM(e,o,r);const a=Nre(r,t)?za.LOCKED:za.ADJUST,l=new CO(s);return KI(e,i,r.heading,r.tilt,a,l),n.camera=await l.resolver.promise,n}function Kbt(e,t,i,r,s){let n=0;i.hasZ?n=i.z:e.basemapTerrain&&(n=Ag(e.elevationProvider,i)),he(Ys,i.x,i.y,n),nd(e.spatialReference,Ys,Vfe,e.renderSpatialReference),Cp(LF,Vfe),Ap(LF,LF),Nr(kR);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){const y=o[g];let x=r[y[2]];isFinite(x)||(x=n),he(Ys,r[y[0]],r[y[1]],x),Zn(Ys,e.spatialReference,Ys,e.renderSpatialReference),qg(kR,Pu(Ys,Ys,LF))}const a=YS(kR),l=Xb(kR),c=JS(kR),h=1/Math.tan(t.fovX/2),p=1/Math.tan(t.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,m=.5*l*p+.5*Math.max(a,c);return Math.max(f,m)/s}async function ewt(e,t,i,r,s,n,o,a){a.targetGeometry=i.clone();const l=c2(e),c=Kbt(e,l,i,r,s);OM(e,l,n);const h=Nre(n,t)?za.LOCKED:za.ADJUST;a.scale=$S(e,c,a.targetGeometry.latitude);const p=new CO(o);return SMe(e,a.targetGeometry,a.scale,n,h,p),a.camera=await p.resolver.promise,a}function twt(e,t){if(!t||!e.spatialReference)return null;const i={target:null};if("declaredClass"in t||Array.isArray(t))i.target=t;else{for(const r in t)i[r]=t[r];t.center&&!i.target&&(i.target=t.center)}return i}function kw(e){return e&&_(e.camera)&&(e.rotation=p8(e.camera.heading)),e}function iwt(e,t){const i=Bbt;if(!t.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;s++){const n=t[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(e.width,e.height)*2}const Ys=$(),Vfe=Ne(),LF=ls(),kR=In(),rwt=Qt(),lV=$(),DF=$(),k7=$(),U7={heading:0,tilt:0},Rh=new dt,swt={point(e,t,i){i[0]=e.x,i[1]=e.y,e.hasZ&&(i[2]=e.z),t(i)},polygon(e,t,i){const r=e.hasZ;for(let s=0;s<e.rings.length;s++){const n=e.rings[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),t(i)}},polyline(e,t,i){const r=e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),t(i)}},multipoint(e,t,i){const r=e.points,s=e.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),t(i)},extent(e,t,i){e.hasZ?(t(he(i,e.xmin,e.ymin,e.zmin)),t(he(i,e.xmax,e.ymin,e.zmin)),t(he(i,e.xmin,e.ymax,e.zmin)),t(he(i,e.xmax,e.ymax,e.zmin)),t(he(i,e.xmin,e.ymin,e.zmax)),t(he(i,e.xmax,e.ymin,e.zmax)),t(he(i,e.xmin,e.ymax,e.zmax)),t(he(i,e.xmax,e.ymax,e.zmax))):(t(he(i,e.xmin,e.ymin,i[2])),t(he(i,e.xmax,e.ymin,i[2])),t(he(i,e.xmin,e.ymax,i[2])),t(he(i,e.xmax,e.ymax,i[2])))},mesh(e,t,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(r)for(let s=0;s<r.length;s+=3)t(he(i,r[s+0],r[s+1],r[s+2]))}};class nwt{constructor(t,i,r){this.target=t,this.options=i,this.view=r,this.state="pending",this.abortController=null,this.animationController=null,this.promise=new Promise((s,n)=>{this.resolveCallback=s,this.rejectCallback=n;const o=new AbortController;_(this.options.signal)&&va(this.options.signal,()=>{this.abort()}),this.abortController=o,this.waitForReady()})}then(t,i){return this.promise.then(t,i)}catch(t){return this.promise.catch(t)}resolve(t){return this.state="finished",this.resolveCallback(t)}reject(t){return this.state="finished",this.rejectCallback(t)}abort(t=!1){switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":this.reject(mi());break;case"wait-for-animation-finish":!t&&_(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),this.reject(mi())}}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await gv(()=>this.view.ready,this.abortController.signal)}catch(t){return this.reject(t)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this._getAnimationController():null,Hbt(this.view,this.target,this.abortController.signal).then(t=>{if(this.state==="finished")return;const i=this._getCameraFromViewpoint(t);if(!M(i))if(this.options.animate){if(M(this.animationController))return;this.startAnimation(i,this.animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},t=>{this.reject(t)}))}_getCameraFromViewpoint(t){const i=!!(this.target instanceof xp&&this.target.camera||this.target instanceof ju),r=t.camera;if(M(r))return null;if(!this.view.stateManager.isCompatible(r)){const n=r.position,o=n&&n.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference.wkid;return this.reject(new W("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:r})),null}const s=S0(this.view,r);return M(s)?(this.reject(new W("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:t,camera:s,isFullySpecified:i}}startAnimation(t,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(M(r))return void this.reject(new W("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(t.viewpoint,"running"),!i.active||M(i.viewAnimation)||i.viewAnimation.target!==t.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;t.isFullySpecified?(s=new QC({view:this.view,desiredCamera:t.camera}),TO(this.view,t.camera,pp.EYE_AND_CENTER)):Js(this.view,t.camera),i.begin(t.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof j0&&_(a.viewAnimation)&&a.viewAnimation.target===t.viewpoint&&(this.view.state.cameraController=s):_(i.viewAnimation)&&i.viewAnimation.target===t.viewpoint&&i.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(!M(this.view.state))switch(i.state){case bs.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case bs.Ready:case bs.Rejected:case bs.Running:case bs.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};r.when(n,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let t,i=null;const r=this.view.state.cameraController;return r instanceof j0&&(r.updateStateFromViewAnimation(),r.active&&(t=r,i=t.viewAnimation)),t!=null||(t=new j0({view:this.view,mode:"animation"}),i=t.viewAnimation,this.view.state.switchCameraController(t))?t:(_(i)&&i.stop(),this.reject(new W("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}const bd=ve.getLogger("esri.views.3d.state.ViewStateManager");let ro=class extends Ee{constructor(e){super(e),this.propertiesPool=new wv({frustum:U1},this),this.handles=new Nt,this.cameraSetByUser=!1,this.gotoOperation=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._maximumPixelRatioOverride=null,this.test={contentCameraResetState:new Map,setDevicePixelRatio:t=>this._devicePixelRatioOverride=t,setMaximumPixelRatio:t=>this._maximumPixelRatioOverride=t}}get camera(){const e=this._get("camera");if(!this.ready)return e;const t=OM(this.view,this.view.state.camera);return t&&e&&t.equals(e)?e:t}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(S0(this.view,e),{applyConstraints:!1})||bd.error("#camera=","Invalid camera",e),this.view.elevationProvider.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=OM(this.view,this.view.state.contentCamera);return t&&e&&t.equals(e)?e:t}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=S0(this.view,e);M(t)?this.view.state.contentCamera=null:(this._updateElevation(t),this.view.state.contentCamera=t)}installContentCameraReset(e){if(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,i=this.view.state.camera.distance**2,r=Tc(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.handles.add([re(()=>this.contentCamera,()=>{e.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),re(()=>this.zoom,n=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(n-t)/2),Math.abs(n-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)}),re(()=>this.view.state.camera,n=>{const o=uo(r,n.center);this.test.contentCameraResetState.set("camera.center",o/i),o>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],"contentCameraReset"),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():bd.error("#center=","Invalid center",e):bd.error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):bd.error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=Yut(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return _(t)?t:this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||bd.error("#extent=","Invalid extent",e):bd.error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):bd.error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this.propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return $S(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||bd.error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,i=e.pixelRatio,r=this._get("padding"),s=Math.round(t[Vt.TOP]/i),n=Math.round(t[Vt.RIGHT]/i),o=Math.round(t[Vt.BOTTOM]/i),a=Math.round(t[Vt.LEFT]/i);return r!=null&&r.top===s&&r.right===n&&r.bottom===o&&r.left===a?r:{top:s,right:n,bottom:o,left:a}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,NF),this.view.state.updateCamera(t=>t.padding=NF))}_paddingToArray(e,t,i){e?_r(i,e.top||0,e.right||0,e.bottom||0,e.left||0):_r(i,0,0,0,0);for(let r=0;r<4;r++)i[r]=Math.round(i[r]*t)}get screenCenter(){const e=this.padding;return bp((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?jbt(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||bd.error("#viewpoint=","Invalid viewpoint",e);else{const t=_(e.camera)?e.camera.position:e.targetGeometry,i=_(t)&&t.spatialReference;bd.error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(i?i.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e)}else bd.error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?AMe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||bd.error("#zoom=","Invalid zoom",e)}get maximumPixelRatio(){if(_(this._maximumPixelRatioOverride))return this._maximumPixelRatioOverride;let e=1/0;const{maximumPixelRatio:t,maximumRenderResolution:i}=this.view.qualitySettings;if(t!=null&&(e=Math.min(e,t)),i!=null){const r=i/Math.max(this.view.width,this.view.height);e=Math.min(e,r)}return e}get _devicePixelRatio(){return M(this._devicePixelRatioOverride)?Math.min(this._windowDevicePixelRatio,this.maximumPixelRatio):this._devicePixelRatioOverride}initialize(){this.handles.add([os(()=>this.view.state.events,"before-camera-change",e=>this._updateElevation(e.camera))]),re(()=>this.view.state.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.handles.add(aS({prepare:()=>this._prepareFrame()})),this.handles.add(re(()=>this.view.state.cameraController,()=>{this.cameraSetByUser=!0,this.handles.remove(FF)})),this.handles.add(os(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale")))}destroy(){this.deinit(),this.handles&&(this.handles.destroy(),this.handles=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)}init(){this.constraintsManager=new dI({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this.cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this.cameraSetByUser){const t=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;t&&this.isCompatible(t)?this._setInitialView(t):this.view.state.viewingMode===tt.Local&&this.handles.add(Jn(()=>this.view.basemapTerrain.ready,()=>{this.handles.remove(FF),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),FF)}}deinit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove(FF),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))}async goTo(e,t){const i=F({animate:!0},t);return _(this.gotoOperation)&&this.gotoOperation.abort(i.animate),this.gotoOperation=new nwt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this.gotoOperation}debugSetCameraOnContent(){this.setStateCamera(c2(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,i=t&&this.view.state.cameraController;i&&(t.updateCamera(r=>{i.stepController(e,r)}),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){_(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:i,overrides:r}of lwt){const s=e.has(i),n=this._isOverridden(i);!s&&n&&t.push({name:i,value:this._get(i)}),this._clearOverride(i),(s||n)&&r.forEach(o=>e.add(o))}return t}_setInitialView(e){if(M(e)||this.cameraSetByUser)return;if(e instanceof ju)return void this.setStateCamera(S0(this.view,e),{applyConstraints:!1});if(e instanceof xp){if(e.targetGeometry instanceof yi){const s=KI(this.view,e.targetGeometry,0,.5,za.LOCKED);return void(_(s)&&this.setStateCamera(S0(this.view,s),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},r=this._viewpointToCamera(e);return void this.setStateCamera(r,i)}const t=KI(this.view,e,0,.5,za.LOCKED);_(t)&&this.setStateCamera(S0(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&awt.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!M(e)&&(e instanceof xp?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof ju?this.isCompatible(e.position):e.spatialReference&&Ig(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=cwt){return this.cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,i=x_){const{heading:r,tilt:s}=this._getPreservingHeadingTilt(),n=O$(this.view,r,s,e,t,za.ADJUST);return M(n)?null:(i.copyFrom(this.view.state.camera),i.eye=n.eye,i.center=n.center,i.up=n.up,i)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:t,tilt:i}=this._getPreservingHeadingTilt(),r=KI(this.view,e,t,i,za.ADJUST,uwt);return _(r)?S0(this.view,r):null}_scaleToCamera(e){if(e==null)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.renderLocation,r=t.location.latitude,s=Hie(this.view,e,r);return this._centerPointAtDistanceToCamera(i,s)}_zoomToCamera(e){return this._scaleToCamera(MMe(this.view,e))}_viewpointToCamera(e){return S0(this.view,jPe(this.view,e))}setStateCamera(e,t){return!(M(e)||!this.view.state.stopActiveCameraController())&&(this.cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{t.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),t.applyConstraints&&Js(this.view,i)}),t.applyConstraints||(this.view.state.cameraController=new QC({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._devicePixelRatio,r=Math.round(e.clientWidth*i),s=Math.round(e.clientHeight*i);if(r!==0&&s!==0&&(t.width===r&&t.height===s||(t.width=r,t.height=s),this.view.state)){const n=this.view.state.camera;n.fullWidth===r&&n.fullHeight===s&&n.pixelRatio===i||(x_.copyFrom(n),x_.pixelRatio!==i&&(this._paddingToArray(this.padding,i,NF),x_.padding=NF),x_.fullWidth=r,x_.fullHeight=s,x_.pixelRatio=i,this.view.state.camera=x_)}}_updateElevation(e){const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=this.view.renderCoordsHelper.getAltitude(e.eye),r=t?b6(this.view,e.eye):0;e.relativeElevation=i-r}};u([d({type:ju,dependsOn:["view.state.camera","ready"]})],ro.prototype,"camera",null),u([d({type:ju,dependsOn:["view.state.contentCamera","ready"]})],ro.prototype,"contentCamera",null),u([d({type:dt})],ro.prototype,"center",null),u([d({type:yi})],ro.prototype,"extent",null),u([d({readOnly:!0})],ro.prototype,"frustum",null),u([d({readOnly:!0})],ro.prototype,"hasInitialView",null),u([d({readOnly:!0,type:Boolean})],ro.prototype,"ready",void 0),u([d({type:Number})],ro.prototype,"scale",null),u([d()],ro.prototype,"padding",null),u([d({readOnly:!0})],ro.prototype,"screenCenter",null),u([d({constructOnly:!0})],ro.prototype,"view",void 0),u([d({type:xp})],ro.prototype,"viewpoint",null),u([d({type:Number})],ro.prototype,"zoom",null),u([d()],ro.prototype,"maximumPixelRatio",null),u([d()],ro.prototype,"_devicePixelRatio",null),u([d()],ro.prototype,"_windowDevicePixelRatio",void 0),u([d()],ro.prototype,"_devicePixelRatioOverride",void 0),u([d()],ro.prototype,"_maximumPixelRatioOverride",void 0),ro=u([L("esri.views.3d.state.ViewStateManager")],ro);const owt=ro,awt=["camera","viewpoint","extent","scale","center","zoom"],lwt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],cwt={heading:0,tilt:0},uwt=new ju,x_=new xr,NF=si(),FF="pending-initial-view";class hwt{constructor(t,i,r){this.viewingMode=t,this._forEachLayer=i,this.view=r,this.externalIntersectionHandlers=new ai,this.tolerance=AM,this.tmpRay=Do(),this.tmpRegion=Qt(),this.validateHUDIntersector=cd(this.viewingMode),this.validateHUDIntersector.options.hud=!1}intersectScreen(t,i,r){return this.intersectRay(this._getPickRay(t,this.tmpRay),Bfe(this.viewingMode),i,r)}intersectScreenFreePointFallback(t,i,r){return this.intersectRayFreePointFallback(this._getPickRay(t,this.tmpRay),i,r)}intersectRayFreePointFallback(t,i,r){return this.intersectRay(t,Bfe(this.viewingMode),i,r)||this._intersectRayFreePointLocal(t,i)}intersectRay(t,i,r,s){return i.options.selectionMode=!1,i.options.store=Vo.MIN,this.computeIntersection(t,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(t,i,r=.5,s=.5){return t.getRenderCenter(zF,r,s),zF[0]+=.0466,zF[1]-=.0123,kie(t,zF,i)}intersectIntersectorScreen(t,i,r){this.computeIntersection(this._getPickRay(t,this.tmpRay),i,r)}intersectToolIntersectorScreen(t,i,r){const s=this._getPickRay(t,this.tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(t,i,r){i.options.selectionMode=!0,this.computeIntersection(t,i,r);const s=i.results.min;!!this.view.basemapTerrain&&this.view.basemapTerrain.opaque||yy(s)&&s.intersector!==xs.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(t,i,r))}setTolerance(t=AM){this.tolerance=t}addIntersectionHandler(t){this.externalIntersectionHandlers.push(t),this.externalIntersectionHandlers.sort((i,r)=>i.type===xs.TERRAIN?1:r.type===xs.TERRAIN?-1:0)}removeIntersectionHandler(t){this.externalIntersectionHandlers.removeUnordered(t)!=null&&this.externalIntersectionHandlers.sort((i,r)=>i.type===xs.TERRAIN?1:r.type===xs.TERRAIN?-1:0)}_getPickRay(t,i){const r=this.view.state.camera;return YAe(r,t,i)}_intersectRayFreePointLocal(t,i){if(this.viewingMode!==tt.Local||M(t))return!1;const r=this.view.renderDataExtent;if(M(r))return we(i,t.origin,Re(Je.get(),t.direction)),!0;const s={x:r.xmax-r.xmin,y:r.ymax-r.ymin,z:8*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},n=Math.max(s.x,s.y,s.z);if(n===0)return we(i,t.origin,Re(Je.get(),t.direction)),!0;const o=this.view.state.camera,a=Math.max(0,r.xmin-o.eye[0],o.eye[0]-r.xmax),l=Math.max(0,r.ymin-o.eye[1],o.eye[1]-r.ymax),c=Math.sqrt(a*a+l*l),h=Math.abs(o.relativeElevation)+Number.MIN_VALUE,p=Math.max(0,Math.log(n/h))**2;let f=n/Math.max(1,p);f=Math.max(f,Math.min(c,n));const m=fe(Je.get(),t.direction,f/Ue(t.direction));return we(i,t.origin,m),!0}intersectElevationFromScreen(t,i,r=0,s=null){return this._intersectElevation(this._getPickRay(t,this.tmpRay),i,r,s)}_intersectElevation(t,i,r=0,s=null){if(M(t))return null;const n=_(i)?i.mode:"absolute-height",o=_(i)?Ye(i.offset,0):0,a=n!=="on-the-ground"?o+r:0,l=a/this.view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this.view.renderCoordsHelper.intersectInfiniteManifold(t,a,UF)){const S=this.view.computeMapPointFromVec3d(UF);return S.z-=o,S}return null}const c=this.view.state.camera,h=Je.get();c.projectToRenderScreen(t.origin,h);const p=new Gfe(null,this._forEachLayer),f=this.view.slicePlane,m=_(f)?Nhe(f):null,g=cd(this.viewingMode);g.options.store=Vo.MIN,g.options.verticalOffset=l;const y=t.origin,x=we(Je.get(),y,t.direction);g.reset(y,x,c),g.point=h;const b=_(s)?"type"in s&&s.type==="graphics"?S=>S.metadata.layerUid!==s.uid:S=>S.metadata.graphicUid!==s.uid:null;switch(n){case"relative-to-scene":{const S=T=>(M(b)||b(T))&&T.metadata&&T.metadata.isElevationSource;g.intersect(p.layers,h,this.tolerance,null,S),this.externalIntersectionHandlers.forAll(T=>{if(T.type===xs.I3S||T.type===xs.TERRAIN){const C=T.slicePlaneEnabled?m:null;T.intersect(g,C,g.rayBegin,g.rayEnd,h)}})}break;case"on-the-ground":case"relative-to-ground":this.externalIntersectionHandlers.forAll(S=>{if(S.isGround){const T=S.slicePlaneEnabled?m:null;S.intersect(g,T,g.rayBegin,g.rayEnd,h)}})}if(g.results.min.getIntersectionPoint(UF)){const S=this.view.computeMapPointFromVec3d(UF);return S.z=r,S}return null}computeIntersection(t,i,r){if(M(t))return;const s=this.view.state.camera,n=Je.get();s.projectToRenderScreen(t.origin,n);const o=new Gfe(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const a=t.origin,l=we(Je.get(),t.origin,t.direction);i.reset(a,l,s),i.intersect(o.layers,n,this.tolerance);const c=this.view.slicePlane,h=_(c)?Nhe(c):null;i.intersect(o.sliceableLayers,n,this.tolerance,h);const p=r&&(r.requiresGroundFeedback||r.enableDraped);this.externalIntersectionHandlers.forAll(m=>{if(i.options.isFiltered=!o.filterLayerUid(m.layerUid),m.isGround&&p||!i.options.isFiltered){const g=m.slicePlaneEnabled?h:null;m.intersect(i,g,a,l,n)}});const f=Je.get();if(r&&r.enableDraped&&i.results.ground.getIntersectionPoint(f)){const m=this.view.basemapTerrain,g=m.overlayManager.renderer,y=this.view.renderCoordsHelper.spatialReference,x=Je.get();this.view.renderCoordsHelper.fromRenderCoords(f,x,m.spatialReference),x[2]=Ye(this.view.elevationProvider.getElevation(f[0],f[1],f[2],y,"ground"),0),g.intersect(i,x,i.results.ground,b=>o.filterRenderGeometry(b))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(t){const i=t.results.hud;pv(this.tmpRegion,eW);const r=this.view.state.camera,s=[],n=this.tmpRegion,o=b=>{const S=new pwt(b);r.projectToRenderScreen(b.target.center,S.screenPoint),S.screenPoint[0]=Math.floor(S.screenPoint[0]),S.screenPoint[1]=Math.floor(S.screenPoint[1]),s.push(S),lA(n,S.screenPoint)};t.sortResults(i.all),_(i.min.dist)&&o(i.min);for(const b of i.all)i.min.target.object!==b.target.object&&i.max.target.object!==b.target.object&&o(b);if(_(i.max.dist)&&i.max.target.object!==i.min.target.object&&o(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-pI),h=Math.max(0,n[1]-pI),p=Math.min(zh(n)+2*pI,a-c),f=Math.min(nm(n)+2*pI,l-h),m=new Uint8Array(p*f*4);this.view._stage.renderView.readHUDVisibility(c,h,p,f,m);let g=!0;const y=M(t.results.max.dist);let x=0;for(const b of s)for(const S of dwt)if(m[4*(Math.min(b.screenPoint[0]+S[0],a)-n[0]+(Math.min(b.screenPoint[1]+S[1],l)-n[1])*p)]){g&&(t.results.min.copy(b.result),g=!1),y&&t.results.max.copy(b.result),t.options.store===Vo.ALL&&t.results.all.splice(x++,0,b.result);break}}}const pI=1,dwt=(()=>{const e=[],t=pI;for(let i=-t;i<=t;i++)for(let r=-t;r<=t;r++)e.push([r+t,i+t]);return e})();class pwt{constructor(t){this.result=t,this.screenPoint=ko()}}let kF;function Bfe(e){return kF&&kF.viewingMode===e||(kF=cd(e)),kF}class Gfe{constructor(t,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=t==null?void 0:t.include,this.exclude=t==null?void 0:t.exclude,i(r=>{r.isPickable&&this.filterLayerUid(r.apiLayerUid)&&(r.isSliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(t){const{include:i,exclude:r}=this;return M(t)?i==null&&r==null:(i==null||i.has(t))&&(r==null||!r.has(t))}filterRenderGeometry(t){return this.filterLayerUid(t.layerUid)}}function jfe(e){return typeof e=="object"&&"intersect"in e}const UF=$(),zF=ko();class tkt{constructor(t,i){this.spatialReference=t,this.view=i}getElevation(t,i,r){return this.view.elevationProvider.getElevation(t,i,0,this.spatialReference,r)}async queryElevation(t,i,r,s,n){return this.view.elevationProvider.queryElevation(t,i,0,this.spatialReference,n,r,s)}}class fwt{constructor(t,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions=me(F({},s),{ignoreInvisibleLayers:!0}),this._frameTask=t.registerTask(Ot.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(t,i,r,s=0){return new Promise((n,o)=>{const a={x:t,y:i,minDemResolution:s,result:{resolve:n,reject:o},signal:r};this._queries.push(a),va(r,()=>{MQ(this._queries,a),o(mi())})})}get running(){return this._queries.length>0}runTask(){const t=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return void t.forEach(c=>c.result.reject());const r=t.map(c=>[c.x,c.y]),s=t.reduce((c,h)=>Math.min(c,h.minDemResolution),1/0),n=new Wf({points:r,spatialReference:this.spatialReference}),o=t.length>1&&t.some(c=>!!c.signal)?new AbortController:null,a=_(o)?o.signal:t[0].signal;if(_(o)){let c=0;t.forEach(h=>va(h.signal,()=>{c++,h.result.reject(mi()),c===t.length&&o.abort()}))}const l=me(F({},this._queryOptions),{minDemResolution:s,signal:a});i.queryElevation(n,l).then(c=>{t.forEach((h,p)=>{_(h.signal)&&h.signal.aborted?h.result.reject(mi()):h.result.resolve(c.geometry.points[p][2])})}).catch(c=>{t.forEach(h=>h.result.reject(c))})}get test(){const t=this;return{update:()=>t._queries.length>0&&t.runTask()}}}let fI=class extends cs.EventedMixin(Ee){constructor(e){super(e),this.im=new Array,this.ground=new Array,this.scene=new Array,this.handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQuery=We(this._elevationQuery)}get elevationQuery(){return M(this._elevationQuery)&&(this._elevationQuery=new fwt(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQuery}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,t,i,r,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const o=this.lastElevationQuery;if(e===o.x&&t===o.y&&i===o.z&&r.equals(o.spatialReference)&&s===o.queryContext)return o.result}let n=null;return n=VF(n,this.im,e,t,i,r,s),M(n)&&(n=VF(n,this.ground,e,t,i,r,s)),s==="scene"&&(n=VF(n,this.scene,e,t,i,r,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:i,spatialReference:r,queryContext:s,result:n}),n}queryElevation(e,t,i,r,s,n=null,o=0){const a=rm();return this.elevationQuery.queryElevation(e,t,n,o).then(l=>{s==="scene"&&(l=VF(l,this.scene,e,t,i,r,s)),a.resolve(l)}).catch(l=>{as(l)?a.reject(l):a.resolve(this.getElevation(e,t,i,r,s))}),a.promise}register(e,t){this.handles.set(t,t.on("elevation-change",i=>this.emit("elevation-change",i))),this[e].push(t)}unregister(e){this.handles.has(e)&&(this.handles.get(e).remove(),this.handles.delete(e));for(const t of[this.im,this.ground,this.scene]){const i=t.indexOf(e);i>-1&&t.splice(i,1)}}};function VF(e,t,i,r,s,n,o){for(const a of t){const l=a.getElevation(i,r,s,n,o);_(l)&&(e=_(e)?Math.max(l,e):l)}return e}u([d({constructOnly:!0})],fI.prototype,"view",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],fI.prototype,"spatialReference",void 0),fI=u([L("esri.views.3d.support.CombinedElevationProvider")],fI);class ab{static isValidProfile(t){return t in ab.profiles}static getDefaultProfile(){return ye("trident")||ye("esri-iPhone")?"low":"medium"}static apply(t,i){const r=ab.profiles[t];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxTotalNumberOfPrimitives=r.graphics3D.maxTotalNumberOfPrimitives,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable;{const s=i.sceneService["3dObject"],n=r.sceneService["3dObject"];s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration}i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumRenderResolution=r.maximumRenderResolution,i.maximumPixelRatio=r.maximumPixelRatio}}function Hfe(){const e=!!ye("esri-mobile"),t=!!ye("ios");return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!ye("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?600:750,additionalCacheMemory:e?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!ye("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:e?null:4096,maximumPixelRatio:e?1:null}}}ab.debug={reset(){const e=Hfe();for(const t in e)ab.profiles[t]=e[t]}},function(e){e.profiles=Hfe()}(ab||(ab={}));const bk=ab;function kre(){return new Float32Array(4)}function mwt(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Rp(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function gwt(e,t){return new Float32Array(e,t,4)}function WPe(){return kre()}function ZPe(){return Rp(1,1,1,1)}function XPe(){return Rp(1,0,0,0)}function YPe(){return Rp(0,1,0,0)}function JPe(){return Rp(0,0,1,0)}function QPe(){return Rp(0,0,0,1)}const ywt=WPe(),vwt=ZPe(),_wt=XPe(),bwt=YPe(),wwt=JPe(),xwt=QPe();Object.freeze(Object.defineProperty({__proto__:null,create:kre,clone:mwt,fromValues:Rp,createView:gwt,zeros:WPe,ones:ZPe,unitX:XPe,unitY:YPe,unitZ:JPe,unitW:QPe,ZEROS:ywt,ONES:vwt,UNIT_X:_wt,UNIT_Y:bwt,UNIT_Z:wwt,UNIT_W:xwt},Symbol.toStringTag,{value:"Module"}));let eg=class extends Ee{constructor(){super(...arguments),this.color=new Le([0,255,255]),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=new Le([0,0,0]),this.shadowDifference=.2}static toEngineOptions(e){const t=Le.toUnitRGBA(e.color),i=_(e.haloColor)?Le.toUnitRGBA(e.haloColor):t,r=Le.toUnitRGBA(e.shadowColor);return{color:Rp(t[0],t[1],t[2],t[3]),haloColor:Rp(i[0],i[1],i[2],i[3]),haloOpacity:e.haloOpacity,haloOpacityOccluded:.25*e.haloOpacity,fillOpacity:e.fillOpacity,fillOpacityOccluded:.25*e.fillOpacity,shadowOpacity:e.shadowOpacity,shadowColor:zi(r[0],r[1],r[2],r[3]),occludedShadowOpacity:e.shadowOpacity*(1-e.shadowDifference)}}};u([d({type:Le})],eg.prototype,"color",void 0),u([d({type:Le})],eg.prototype,"haloColor",void 0),u([d()],eg.prototype,"haloOpacity",void 0),u([d()],eg.prototype,"fillOpacity",void 0),u([d()],eg.prototype,"shadowOpacity",void 0),u([d({type:Le})],eg.prototype,"shadowColor",void 0),u([d()],eg.prototype,"shadowDifference",void 0),eg=u([L("esri.views.3d.support.HighlightOptions")],eg);const yJ=eg;function Twt(e,t,i){const r=w_e(t);return e.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}let Lx=class extends Ce{constructor(e){super(e),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(r=>r.toJSON()),t=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:tO(t),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};u([d()],Lx.prototype,"geometries",void 0),u([d({json:{read:{source:"outSR"}}})],Lx.prototype,"outSpatialReference",void 0),u([d()],Lx.prototype,"transformation",void 0),u([d()],Lx.prototype,"transformForward",void 0),Lx=u([L("esri.rest.support.ProjectParameters")],Lx);const Ure=Lx,Swt=dn(Ure);async function KPe(e,t,i){t=Swt(t);const r=NTe(e),s=F(me(F({},r.query),{f:"json"}),t.toJSON()),n=t.outSpatialReference,o=tO(t.geometries[0]),a=pWe(s,i);return Zt(r.path+"/project",a).then(({data:{geometries:l}})=>Twt(l,o,n))}async function zre(e=null,t){var s,n;if(or.geometryServiceUrl)return or.geometryServiceUrl;if(!e)throw new W("internal:geometry-service-url-not-configured");let i;i="portal"in e?e.portal||Bo.getDefault():e,await i.load({signal:t});const r=(n=(s=i.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!r)throw new W("internal:geometry-service-url-not-configured");return r}async function Ewt(e,t,i=null,r){const s=await zre(i,r),n=new Ure;n.geometries=[e],n.outSpatialReference=t;const o=await KPe(s,n,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new W("internal:geometry-service-projection-failed")}var Cwt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getGeometryServiceURL:zre,projectGeometry:Ewt});class Awt{constructor(t,i){this.spatialReference=i,this.unitInMeters=$n(this.spatialReference,Ri(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=zre(t&&t.get("portalItem")).catch(()=>{throw new W("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(t){const i=await this._geometryServiceURLPromise;let r,s=!0;Array.isArray(t[0])&&typeof t[0]!="number"?r=t:(r=[t],s=!1);const n=r.map(l=>l instanceof dt?l:new dt(l,this.spatialReference)),o=new Ure({geometries:n,outSpatialReference:at.WGS84}),a=(await KPe(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0);return s?a:a[0]}}let fg=class extends Ee{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1}};u([d()],fg.prototype,"minTotalNumberOfFeatures",void 0),u([d()],fg.prototype,"maxTotalNumberOfFeatures",void 0),u([d()],fg.prototype,"maxTotalNumberOfPrimitives",void 0),u([d()],fg.prototype,"snapshotAvailable",void 0),u([d()],fg.prototype,"polygonLodFactor",void 0),u([d()],fg.prototype,"polylineLodFactor",void 0),fg=u([L("esri.views.3d.support.QualitySettings.Graphics3DSettings")],fg);let kg=class extends Ee{constructor(){super(...arguments),this.lodFactor=1}};u([d()],kg.prototype,"lodFactor",void 0),kg=u([L("esri.views.3d.support.QualitySettings.LoDFactorSettings")],kg);let cV=class extends kg{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};cV=u([L("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],cV);let C0=class extends Ee{constructor(){super(...arguments),this["3dObject"]=new cV,this.point=new kg,this.integratedMesh=new kg,this.pointCloud=new kg,this.uncompressedTextureDownsamplingEnabled=!1}};u([d({type:cV})],C0.prototype,"3dObject",void 0),u([d({type:kg})],C0.prototype,"point",void 0),u([d({type:kg})],C0.prototype,"integratedMesh",void 0),u([d({type:kg})],C0.prototype,"pointCloud",void 0),u([d()],C0.prototype,"uncompressedTextureDownsamplingEnabled",void 0),C0=u([L("esri.views.3d.support.QualitySettings.SceneServiceSettings")],C0);let $1=class extends Ee{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=500}};u([d()],$1.prototype,"lodBias",void 0),u([d()],$1.prototype,"angledSplitBias",void 0),u([d()],$1.prototype,"reduceTileLevelDifferences",void 0),u([d()],$1.prototype,"textureFadeDuration",void 0),$1=u([L("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],$1);let KC=class extends Ee{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([d()],KC.prototype,"pixelRatio",void 0),u([d()],KC.prototype,"maxTotalNumberOfFeatures",void 0),KC=u([L("esri.views.3d.support.QualitySettings.HeatmapSettings")],KC);let dc=class extends Ee{constructor(){super(...arguments),this.graphics3D=new fg,this.sceneService=new C0,this.tiledSurface=new $1,this.heatmap=new KC,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0}};u([d({type:fg})],dc.prototype,"graphics3D",void 0),u([d({type:C0})],dc.prototype,"sceneService",void 0),u([d({type:$1})],dc.prototype,"tiledSurface",void 0),u([d({type:KC})],dc.prototype,"heatmap",void 0),u([d()],dc.prototype,"antialiasingEnabled",void 0),u([d()],dc.prototype,"physicallyBasedRenderingEnabled",void 0),u([d()],dc.prototype,"highQualityTransparency",void 0),u([d()],dc.prototype,"memoryLimit",void 0),u([d()],dc.prototype,"additionalCacheMemory",void 0),u([d()],dc.prototype,"frameRate",void 0),u([d()],dc.prototype,"maximumRenderResolution",void 0),u([d()],dc.prototype,"maximumPixelRatio",void 0),dc=u([L("esri.views.3d.support.QualitySettings.QualitySettings")],dc);const qfe=dc;class uV{constructor(t,i,r,s){this.viewingMode=t,this.spatialReference=i,this.unitInMeters=r,this.coordinateSystem=s,this._coordinateSystem=VGe(s)}set extent(t){t&&BGe(this.coordinateSystem,t,this.coordinateSystem)}getAltitude(t){return YGe(this.coordinateSystem,t)}setAltitude(t,i,r=t){return Xwe(this.coordinateSystem,r,i,t)}setAltitudeOfTransformation(t,i){JGe(this.coordinateSystem,i,t,i)}worldUpAtPosition(t,i){return qGe(this.coordinateSystem,t,i)}worldBasisAtPosition(t,i,r){return WGe(this.coordinateSystem,t,i,r)}basisMatrixAtPosition(t,i){const r=this.worldBasisAtPosition(t,Jh.X,Je.get()),s=this.worldBasisAtPosition(t,Jh.Y,Je.get()),n=this.worldBasisAtPosition(t,Jh.Z,Je.get());return hy(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}intersectManifoldClosestSilhouette(t,i,r){return QG(this.coordinateSystem,i,this._coordinateSystem),XGe(this._coordinateSystem,t,r),r}intersectManifold(t,i,r){QG(this.coordinateSystem,i,this._coordinateSystem);const s=Je.get();return ZGe(this._coordinateSystem,t,s)?pe(r,s):null}intersectInfiniteManifold(t,i,r){if(this.viewingMode===tt.Global)return this.intersectManifold(t,i,r);QG(this.coordinateSystem,i,this._coordinateSystem);const s=this._coordinateSystem.value,n=Je.get();return t2(s.plane,t,n)?pe(r,n):null}toRenderCoords(t,i,r){return kz(t)?Go(t,i,this.spatialReference):Zn(t,i,r,this.spatialReference)}fromRenderCoords(t,i,r=null){return kz(i)?(_(r)&&(i.spatialReference=r),Hbe(t,this.spatialReference,i)):i instanceof at?Ob(t,this.spatialReference,i):Zn(t,this.spatialReference,i,r)?i:null}static create(t,i){switch(t){case tt.Local:return new uV(tt.Local,i,$n(i),HGe());case tt.Global:return new uV(tt.Global,i,1,jGe(i))}}static renderUnitScaleFactor(t,i){return Wfe(t)/Wfe(i)}}function Wfe(e){if(Uz(e,tt.Global))return 1;const t=Ywe(!1,e);return $n(t)}var Sg;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.BASEMAP=1]="BASEMAP",e[e.I3S_INDEX=2]="I3S_INDEX",e[e.I3S_DATA=3]="I3S_DATA",e[e.SYMBOLOGY=4]="SYMBOLOGY"})(Sg||(Sg={}));const Mwt=(()=>{const e=new Array;return e[Sg.ELEVATION]=10,e[Sg.BASEMAP]=10,e[Sg.I3S_INDEX]=10,e[Sg.I3S_DATA]=10,e[Sg.SYMBOLOGY]=5,e})(),Owt=30;function eIe(e){return typeof e.getUsedMemory=="function"}const Rwt=ve.getLogger("esri.views.3d.support.MemoryController");function Pwt(e){return new pc({view:e})}const BF=1,z7=1,Iwt=.75,$wt=.6,Zfe=1.3;let pc=class extends Ee{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new Iee,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(BF),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,t){return new xqe(e,this._cacheStorage,t)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<$wt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(BF);else if(e)(this._memoryPredicted>1.1*z7||this._memoryUsed>z7)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/Zfe),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>z7)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/Zfe),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<Iwt&&this._quality<BF){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),BF))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,t=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const i=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderView.edgeView;_(i)&&(e+=i.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(o=>{if(eIe(o)){const a=o.ignoresMemoryFactor()?this._quality:1;e+=o.getUsedMemory()*a,t+=o.getUnloadedMemory()*a}});const r=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&r){this._warnMemoryUsage=e;const o=l=>(l/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",a=Math.round(100*this._quality);Rwt.warn(`Memory Limit exceeded! Limit: ${o(s)} Current: ${o(e)} Projected: ${o(e+t)} Quality: ${a}%`)}this._memoryUsed=e/s,this._memoryPredicted=(e+t)/s;const n=s-e;this._cacheStorage.maxSize=Math.max(0,n+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=e._numQualityChanges;return e._numQualityChanges=0,t}}}};u([d({constructOnly:!0})],pc.prototype,"view",void 0),u([d()],pc.prototype,"maxMemory",null),u([d()],pc.prototype,"additionalCacheMemory",null),u([d()],pc.prototype,"memoryFactor",null),u([d()],pc.prototype,"updating",null),u([d()],pc.prototype,"usedMemory",null),u([d()],pc.prototype,"_quality",void 0),u([d()],pc.prototype,"_memoryUsed",void 0),u([d()],pc.prototype,"_updating",void 0),u([d()],pc.prototype,"_stableQuality",void 0),u([d()],pc.prototype,"_maxMemory",void 0),u([d()],pc.prototype,"_additionalCacheMemory",void 0),pc=u([L("esri.views.3d.support.MemoryController")],pc);class Lwt{constructor(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0}}class Dwt{constructor(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new Nwt}}class Nwt{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class Fwt{constructor(t,i,r,s){this._workerFunc=t,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new Dwt(n))}hasQuota(t){const i=this._clients[t];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(t){const i=this._clients[t.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,(r,s)=>this._taskCallback(r,s))):i.tasks.push(t))}cancel(t){this._taskFinished(t),t._cancelled=!0}destroy(){this._clients.length=0}_taskFinished(t){const i=this._clients[t.client];this._totalNumWorkers--,i.numWorkers--,i.statistics.requests++,i.statistics.size+=t.size||0,i.statistics.duration+=t.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,Ct(i.numWorkers>=0),this._next()}_next(){for(const t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(const t of this._clients)if(t&&this._processQueue(t))return}_processQueue(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return t.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(t,i){t._cancelled||(this._callbackFunc(t,i),this._taskFinished(t))}getStatsForType(t){const i=this._clients[t];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){const t=this;return{set workerFunc(i){t._workerFunc=i}}}}let wk=class extends Ee{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,i){this._loadQueue=new Fwt((r,s)=>this._startLoading(r,s),(r,s)=>this._doneLoadingCB(r,s),e,t),i&&(this._frameTask=i.registerTask(Ot.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=hn(this._frameTask),this._tasks.forEach(e=>Wn(e.abortController)),this._loadQueue=We(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,i,r={}){const s=rm();s.__signal=_(r)?r.signal:null;const n=this._createOrUpdateTask(e,t,i,r,s);return va(r,()=>this._cancelRequest(n,s)),s.promise}_createTask(e,t,i,r,s,n){const o=new zwt(e,t,i,r,s);return this._updateTask(o,n),this._tasks.set(s,o),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){PV(e.resolvers,t),t.reject(mi()),e.resolvers.length===0&&(e.status===Hd.DOWNLOADING&&(e.status=Hd.CANCELLED,this._loadQueue.cancel(e),e.abortController.abort(),e.request=null,e.abortController=null),e.status=Hd.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,i,r,s){const n=Vwt(_(r)&&r.uid||e,t,i),o=this._tasks.get(n);return o?(this._updateTask(o,s),o):this._createTask(e,r,t,i,n,s)}_doneLoadingCB(e,t){this._loadQueue&&(Ct(e.status===Hd.DOWNLOADING),e.status=Hd.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();qt(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==Hd.DOWNLOADED&&(t.err=t.err||mi()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!as(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const r of e.resolvers)if(t)as(t)?r.reject(t):r.reject(new W("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--i;const s=i<=0?e.result:ue(e.result);r.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,t){if(e.status===Hd.CANCELLED)return!1;let i,r;switch(e.startTime=performance.now(),e.status=Hd.DOWNLOADING,e.docType){case"binary":r="array-buffer",i=0;break;case"image":r="image";break;case"image+type":r="array-buffer";break;default:r="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=Zt(e.url,me(F({},e.options),{responseType:r,timeout:i,signal:s}));let n=()=>{};const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},a=l=>{e.status===Hd.DOWNLOADING&&t(e,l),n()};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,h=Uwt(c);if(r="image",e.size=c.byteLength,h==="unknown")return e.request=Zt(e.url,{responseType:r,timeout:i,signal:s}),void e.request.then(m=>o(m.data),a);const p=new Blob([c],{type:h}),f=window.URL.createObjectURL(p);n=()=>window.URL.revokeObjectURL(f),e.request=Zt(f,{responseType:r,timeout:i,signal:s}),e.request.then(m=>o(new f8(m.data,h,n)),a)},a),!0)}get test(){return{loadQueue:this._loadQueue}}};u([d({readOnly:!0})],wk.prototype,"updating",void 0),wk=u([L("esri.views.3d.support.StreamDataLoader")],wk);const kwt={numRetries:0};function Uwt(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return t[0]===137&&t[1]===80?"image/png":t[0]===71&&t[1]===73?"image/gif":t[0]===66&&t[1]===77?"image/bmp":t[0]===255&&t[1]===216?"image/jpeg":"unknown"}class f8{constructor(t,i,r){this.image=t,this.type=i,this.release=r}get isOpaque(){return this.type==="image/jpeg"}}class zwt extends Lwt{constructor(t,i,r,s,n){super(s),this.url=t,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=Hd.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=kwt.numRetries}}function Vwt(e,t,i){return`${e}:${t}:${i}`}var Hd;(function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"})(Hd||(Hd={}));let GF=class extends Ee{constructor(){super(...arguments),this.updating=!1}};function Bwt(e){return new vJ.ResourceController({view:e})}var vJ;u([d({readOnly:!0})],GF.prototype,"updating",void 0),GF=u([L("esri.views.3d.support.ResourceController")],GF),function(e){let t=class extends GF{constructor(){super(...arguments),this._scheduler=null,this._memoryController=null,this._streamDataLoader=null,this._scheduleTask=hM,this._cameraChangeTime=0,this._handles=new Nt,this._frameTask=null,this._state=Mo.IDLE}initialize(){this._cameraChangeTime=performance.now(),this._scheduler=frt(),this._memoryController=Pwt(this.view),this._streamDataLoader=new wk,this._streamDataLoader.setup(Owt,Mwt,this._scheduler),this._handles.add([re(()=>{var r;return(r=this.view.state)==null?void 0:r.camera},(r,s)=>this._cameraChangedHandler(r,s),Ui),re(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=aS({update:r=>this._frame(r)}),this._scheduleTask=this._scheduler.registerTask(Ot.RESOURCE_CONTROLLER)}destroy(){this._handles=We(this._handles),this._scheduleTask.remove(),this._frameTask=hn(this._frameTask),this._streamDataLoader=We(this._streamDataLoader),this._memoryController=We(this._memoryController),this._scheduler=We(this._scheduler)}get updating(){var r,s,n;return!!(((r=this._memoryController)==null?void 0:r.updating)||((s=this._streamDataLoader)==null?void 0:s.updating)||((n=this._scheduleTask)==null?void 0:n.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}schedule(r,s,n){return this._scheduleTask.schedule(r,s,n)}createStreamDataRequester(r){const s=this._streamDataLoader;return{request:(n,o,a)=>s.request(n,o,r,a),get busy(){return!s.hasDownloadSlots(r)}}}_frame(r){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(FQ(r.deltaTime)),!this._scheduler)||(this._updateState(),this._scheduler.state=this._state,this._scheduler.updateBudget(r)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_cameraChangedHandler(r,s){r&&s&&r.almostEquals(s)||(this._cameraChangeTime=performance.now(),this._updateState(),this._scheduler.state=this._state)}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}_updateState(){this.view.animation?this._state=Mo.ANIMATING:this.view.interacting?this._state=Mo.INTERACTING:(this._state===Mo.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=i?this._state=Mo.INTERACTING:this._state=Mo.IDLE)}get test(){return{getQueueStats:r=>this._streamDataLoader.test.loadQueue.getStatsForType(r),state:this._state}}};u([d({constructOnly:!0})],t.prototype,"view",void 0),u([d()],t.prototype,"_scheduler",void 0),u([d()],t.prototype,"_memoryController",void 0),u([d()],t.prototype,"_streamDataLoader",void 0),u([d()],t.prototype,"_scheduleTask",void 0),u([d({readOnly:!0})],t.prototype,"updating",null),t=u([L("esri.views.3d.support.ResourceController")],t),e.ResourceController=t;const i=300}(vJ||(vJ={}));function Gwt(e){return"performanceInfo"in e}const cE=$(),jwt=$(),Fy=$(),ky=$();function Hwt(e,t,i=0){const r=e.extent;if(M(r))return!1;if(i===0)return o1e(r,t);const s=Math.min(r[2]-r[0],r[3]-r[1]);return jze(r,t,i*s)}function jF(e,t,i,r){pe(cE,i),cE[r]=t[r];const s=xe(cE,cE,t),n=xe(jwt,e,t),o=Pe(n,s),a=Pe(s,s);let l;l=o<=0?t:a<=o?i:we(cE,t,fe(s,s,o/a));const c=xe(cE,e,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function qwt(e,t,i){const r=e.extent;if(M(r))return 0;Fy[0]=r[0],Fy[1]=r[1],Fy[2]=i,ky[0]=r[2],ky[1]=r[3],ky[2]=i;let s=1/0,n=1/0;return t[0]<Fy[0]?s=jF(t,Fy,ky,0):t[0]>ky[0]&&(s=jF(t,ky,Fy,0)),t[1]<Fy[1]?n=jF(t,Fy,ky,1):t[1]>ky[1]&&(n=jF(t,ky,Fy,1)),Math.min(s,n)}function Wwt(e,t,i){if(M(e))return Zte();if(e.spatialReference.isGeographic&&!fS(e.spatialReference))return new W("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=ms.checkUnsupported(e);if(_(r))return r;if(M(i))return new W("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=Zwt(e,i);if(s)return s;const n=e.spatialReference;return _(t)&&!(n.equals(t)||t.isWGS84&&n.isWebMercator)?new W("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function Zwt(e,t){const i=e.lods,r=i[0].resolution*2**i[0].level,s=[r*e.size[0],r*e.size[1]],n=[e.origin.x,e.origin.y],o=hK(t),a=Qt();ms.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>UC){const c=i[0].scale*2**i[0].level;let h=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*c/r;const p=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**p)*10**p,new W("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:UC})}return null}const Xwt=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:Hwt,tiltToExtentEdge:qwt,checkIfTileInfoSupportedForViewSR:Wwt},Symbol.toStringTag,{value:"Module"}));function Ywt(){return!0}function Jwt(){return 0}function Qwt(e,t){if(M(e))return Zte();const i=e.lods.length-1,r=e.spatialReference,s=fS(r)||ay(r)||ly(r);if(r.isWebMercator){if(!ms.makeWebMercatorAuxiliarySphere(i).compatibleWith(e))return new W("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new W("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!ms.makeGCSWithTileSize(e.spatialReference,e.size[0],i).compatibleWith(e))return e.spatialReference.isWGS84?new W("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new W("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return _(t)&&!e.spatialReference.equals(t)?new W("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const Kwt=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:Ywt,tiltToExtentEdge:Jwt,checkIfTileInfoSupportedForViewSR:Qwt},Symbol.toStringTag,{value:"Module"})),ext={[tt.Global]:Kwt,[tt.Local]:Xwt};function _g(e,t){e||console.warn("Terrain: "+t)}function _J(e){return m8(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function hV(e){return(e==null?void 0:e.type)==="imagery-tile"||(e==null?void 0:e.type)==="wcs"}function m8(e){return(e==null?void 0:e.type)==="imagery-tile-3d"}function Vre(e){return(e==null?void 0:e.type)==="tile-3d"}function G$(e){return(e==null?void 0:e.type)==="vector-tile-3d"}function tIe(e){return(e==null?void 0:e.type)==="wmts-3d"}function bJ(e){return(e==null?void 0:e.type)==="elevation-3d"}function iIe(e){return(e==null?void 0:e.type)==="group"}function dV(e){return e&&(Vre(e)||tIe(e)||m8(e)||G$(e))}function wJ(e){return e&&(Vre(e)||m8(e)||G$(e)||tIe(e))}function j$(e){return wJ(e)||bJ(e)}function ikt(e){switch(e.type){case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"line-of-sight":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return e.type,!1}}function txt(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return _(t)&&"type"in t&&t.type==="raster-tile"}function ixt(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return _(t)&&"type"in t&&t.type==="vector-tile"}function rxt(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return _(t)&&"type"in t&&t.type==="tile-texture"}function sxt(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return t instanceof HTMLImageElement||t instanceof f8||t instanceof HTMLCanvasElement||t instanceof ImageData}function xA(e){return _(e)&&"release"in e&&e.release(),null}function Xfe(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function Bre(e,t,i,r){return ext[r].checkIfTileInfoSupportedForViewSR(e,i,t)}function g8(e,t,i){let r=null,s=null;if((e==null?void 0:e.type)==="wmts"){const n=nxt(e,t,i);r=n.tileInfo,s=n.fullExtent}else{s=hV(e)?e.getCompatibleFullExtent(t):e.fullExtent;const n=i===tt.Local;if(hV(e))r=e.getCompatibleTileInfo(t,s,n);else if((e==null?void 0:e.type)==="vector-tile"){const o=n&&!oxt(t)||axt.force512VTL,a=e.tileInfo.spatialReference.isGeographic;r=o?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,a?1:2)}else r=e.tileInfo}return _(r)&&_(s)&&Bre(r,s,t,i)==null?{tileInfo:r,fullExtent:s}:null}function nxt(e,t,i){const r=QGe(e);if(_(r)){if(!nt.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>Bre(n.tileInfo,n.fullExtent,t,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function oxt(e){return e.isWGS84||e.isWebMercator||Qve(e)||!O3(e)}const axt={force512VTL:!1};function pV(e){return e===ii.NORTH_EAST?ii.SOUTH_WEST:e===ii.NORTH_WEST?ii.SOUTH_EAST:e===ii.SOUTH_WEST?ii.NORTH_EAST:ii.NORTH_WEST}function xk(e){return e===ii.NORTH?ii.SOUTH:e===ii.EAST?ii.WEST:e===ii.SOUTH?ii.NORTH:ii.EAST}function lxt(e){return e===ii.NORTH_WEST||e===ii.SOUTH_WEST}function cxt(e){return e===ii.NORTH_WEST||e===ii.NORTH_EAST}function Yfe(e){return e===ii.NORTH_WEST||e===ii.WEST||e===ii.SOUTH_WEST}function Jfe(e){return e===ii.NORTH_EAST||e===ii.EAST||e===ii.SOUTH_EAST}function Qfe(e){return e===ii.SOUTH_EAST||e===ii.SOUTH||e===ii.SOUTH_WEST}function Kfe(e){return e===ii.NORTH_EAST||e===ii.NORTH||e===ii.NORTH_WEST}const z1=[ii.NORTH,ii.EAST,ii.SOUTH,ii.WEST],fV=[ii.NORTH_EAST,ii.SOUTH_EAST,ii.SOUTH_WEST,ii.NORTH_WEST];class uxt{constructor(t,i){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=t.layer,this.memory=j$(t)?i.basemapTerrain.getUsedMemoryForLayerView(t):t.getUsedMemory(),Gwt(t)){const r=t.performanceInfo;this.displayedNumberOfFeatures=r.displayedNumberOfFeatures,this.maximumNumberOfFeatures=r.maximumNumberOfFeatures,this.totalNumberOfFeatures=r.totalNumberOfFeatures}}}class hxt{constructor(t){this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array;const i=t.resourceController.memoryController;this.totalMemory=i.maxMemory*Rb.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=i.memoryFactor,this.load=t.resourceController.scheduler.load,this.terrainMemory=t.basemapTerrain?t.basemapTerrain.getUsedMemory():0;const r=t._stage&&t._stage.renderView&&t._stage.renderView.edgeView;this.edgesMemory=_(r)?r.usedMemory:0,t.allLayerViews.items.forEach(s=>{(eIe(s)||j$(s))&&this.layerPerformanceInfos.push(new uxt(s,t))}),this.layerPerformanceInfos.sort((s,n)=>n.memory-s.memory)}}class dxt extends zC{constructor(t,i,r,s){super(i,s),this._streamDataRequester=t,this._parameters=r}async fromUrl(t,i,r){qt(r);const s=_(r)&&r.signal,n=this.makeUid(t,i);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(t,"image",{uid:n,signal:a.signal});o={referenceCount:0,texture:null,textureAsync:null,abortController:a},this._textureRequests.set(n,o),o.textureAsync=l.then(async c=>{const h=this._createTexture(t,c,i);return o.texture=h,o.abortController=null,this._stage.add(h),await this._stage.load(h),{uid:n,texture:h,release:()=>this._release(n)}},c=>{throw o.abortController=null,c})}return o.referenceCount++,new Promise((a,l)=>{va(s,()=>{l(mi())}),o.textureAsync.then(a,l)}).catch(a=>{throw this._release(n),a})}_createTexture(t,i,r){const s=me(F({},this._parameters),{powerOfTwoResizeMode:fb.PAD});if(EK(t)){if(r||i.width===0&&i.height===0){const n=i.width?i.height/i.width:1;r=r||64,n>1?(i.width=Math.round(r/n),i.height=r):(i.width=r,i.height=Math.round(r*n))}this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(s.preMultiplyAlpha=!1)}return s.width=i.width,s.height=i.height,new En(i,s)}}class pxt{constructor(t){this.textures=null,this.streamDataRequester=null,this.graphicsOwners=[],this.screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this.viewState=t.viewState,this.view=t.view,this.pointsOfInterest=t.pointsOfInterest,this.objectResourceCache=t.objectResourceCache,this.streamDataRequester=t.resourceController.createStreamDataRequester(Sg.SYMBOLOGY),this.textures=new dxt(this.streamDataRequester,t.view._stage,{preMultiplyAlpha:!0,wrap:{s:$t.CLAMP_TO_EDGE,t:$t.CLAMP_TO_EDGE}},t.resourceController.scheduler);const i=Ri(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=zMe(t.viewingMode,i),this.screenSizePerspectiveSettingsLabels=Hht(t.viewingMode,i)}destroy(){this.textures.destroy(),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(t){if(!t)return Fo();this.graphicsOwners.push(t);const i=re(()=>{var r;return(r=t.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Fo(()=>{i.remove(),PV(this.graphicsOwners,t),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const t=this.graphicsOwners.some(i=>{var r;return((r=i.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(t&&!this.screenSizePerspectiveHandles){this.screenSizePerspectiveHandles=new Nt;const i=()=>this._updateScreenSizePerspectiveSettings();this.screenSizePerspectiveHandles.add([re(()=>this.pointsOfInterest.centerOnSurfaceInfrequent.distance,i,Ui),this.viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else!t&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)}_updateScreenSizePerspectiveSettings(){const t=this.pointsOfInterest;HF.distance=t.centerOnSurfaceInfrequent.distance,HF.fovY=this.viewState.camera.fovY,this.screenSizePerspectiveSettings.update(HF),this.screenSizePerspectiveSettingsLabels.update(HF),this.view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this.screenSizePerspectiveHandles}}}const HF={distance:0,fovY:0};class c1{constructor(t,i,r=""){this.graphics=t,this._symbol=new W1({symbolLayers:[new q1({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new QS({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})]})}show(t,i){if(M(i))return;this.hide();const r=new dt({x:t[0],y:t[1],z:t[2],spatialReference:i});this._graphic=new Ha({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){_(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}}let V1=class extends Ee{constructor(e){super(e),this.handles=new Nt}destroy(){this.handles.destroy()}};u([d({constructOnly:!0})],V1.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],V1.prototype,"surface",void 0),u([d({constructOnly:!0})],V1.prototype,"state",void 0),V1=u([L("esri.views.3d.support.PointOfInterest")],V1);const fxt=Array;let wh=class extends V1{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new wv({location:dt,renderLocation:fxt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.cameraName="camera",this.renderLocation=$(),this.tmpPoint=new dt}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(os(()=>{var t,i;return(i=(t=this.map)==null?void 0:t.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=Pr(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return $S(i,t,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return void this._updateSurfaceAltitude(0);this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);let e=new AbortController;this.map.ground.queryElevation(this.tmpPoint,{signal:e.signal,cache:this.cache}).then(t=>this._updateSurfaceAltitude(t.geometry.z)).catch(t=>{as(t)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===e&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),e=null}),this._pendingElevationQueryController=e}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(V7,this._estimatedSurfaceAltitude,this._camera.eye),Ic(this._get("renderLocation"),V7)||this._set("renderLocation",pe(this._propertiesPool.get("renderLocation"),V7))}};u([d({constructOnly:!0})],wh.prototype,"scheduler",void 0),u([d({constructOnly:!0})],wh.prototype,"cache",void 0),u([d({constructOnly:!0})],wh.prototype,"task",void 0),u([d({constructOnly:!0})],wh.prototype,"cameraName",void 0),u([d({readOnly:!0})],wh.prototype,"location",null),u([d({constructOnly:!0})],wh.prototype,"map",void 0),u([d({readOnly:!0})],wh.prototype,"renderLocation",void 0),u([d({readOnly:!0})],wh.prototype,"scale",null),u([d({readOnly:!0})],wh.prototype,"updating",null),wh=u([L("esri.views.3d.support.CameraOnSurface")],wh);const V7=$(),mxt=Array;let mu=class extends V1{constructor(e){super(e),this._propertiesPool=new wv({location:dt,renderLocation:mxt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.cameraName="camera",this.distance=0,this.renderLocation=$(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=hn(this._frameWorker),this._propertiesPool=We(this._propertiesPool)}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1}_updateRenderLocation(){const e=yxt;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&i&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const r=vxt;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,r)&&(pe(e,r),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=Pr(this._camera.eye,e):(fe(e,this._camera.viewForward,this._get("distance")),we(e,e,this._camera.eye)),Ic(this._get("renderLocation"),e)||this._set("renderLocation",pe(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,t))return!1;if(this.state.isGlobal){const r=Ri(this.renderCoordsHelper.spatialReference).radius,s=r+e,n=Vl(i.eye),o=n<s*s,a=Pr(i.eye,t);if(o&&a>r/4){const l=s-Math.sqrt(n);return fe(t,i.viewForward,l),we(t,t,i.eye),!0}}else{const r=this.surface.ready?this.surface.extent:null;_(r)&&mB(r,this.surface.spatialReference,UR,this.renderCoordsHelper.spatialReference)&&(t[0]=He(t[0],UR[0],UR[2]),t[1]=He(t[1],UR[1],UR[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(dr.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,r=Pr(i,e),s=Pr(i,t);if(Math.abs(s-r)/r>gxt)return!0}return!1}};u([d({constructOnly:!0})],mu.prototype,"scheduler",void 0),u([d({constructOnly:!0})],mu.prototype,"task",void 0),u([d({constructOnly:!0})],mu.prototype,"cameraName",void 0),u([d()],mu.prototype,"distance",void 0),u([d({constructOnly:!0})],mu.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([d({readOnly:!0})],mu.prototype,"location",null),u([d({readOnly:!0})],mu.prototype,"renderLocation",void 0),u([d()],mu.prototype,"updating",void 0),mu=u([L("esri.views.3d.support.CenterOnSurface")],mu);const gxt=.05,yxt=$(),vxt=$(),UR=Qt();class _xt{constructor(t){this.handles=new Nt,this.events=new cs,this.contentLayerViews=t.contentLayerViews,this.handles.add(this.contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_layerViewsChanged(t){t.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this.handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),t.removed.forEach(i=>this.handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",bxt)}}const bxt={},wxt=Array;let tg=class extends V1{constructor(e){super(e),this._propertiesPool=new wv({location:dt,renderLocation:wxt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([re(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),re(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(Ot.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool.destroy(),this._propertiesPool=null}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,r=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(t,eme);const s=Math.max(0,(Math.acos(Pe(eme,r.viewForward))-.5*Math.PI)*(r.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!sS(e,t)){const l=this._propertiesPool.get("renderLocation");pe(l,t),this._set("renderLocation",l)}return}const n=1-He(s/(.5*Math.PI),0,1),o=n*n*n;this._calculateScreenHorizontalEdgeOnSurface(tme);const a=this._propertiesPool.get("renderLocation");Pn(a,t,tme,o),e&&sS(e,a)||this._set("renderLocation",a)}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,i=t.getRenderCenter(ko());if(i[1]=t.aboveGround?t.padding[Vt.BOTTOM]:t.fullHeight-t.padding[Vt.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const r=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(i,zR)){xe(zR,zR,t.eye);const s=Re(zR,zR);if(this.renderCoordsHelper.intersectManifold(od(t.eye,s),r,e))return e}return this.renderCoordsHelper.setAltitude(e,r,t.eye)}updateRenderLocation(){this._dirty=!0}};u([d()],tg.prototype,"_dirty",void 0),u([d({constructOnly:!0})],tg.prototype,"scheduler",void 0),u([d({constructOnly:!0})],tg.prototype,"centerOnSurface",void 0),u([d({constructOnly:!0})],tg.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([d({readOnly:!0})],tg.prototype,"updating",null),u([d({readOnly:!0})],tg.prototype,"location",null),u([d({readOnly:!0})],tg.prototype,"renderLocation",void 0),tg=u([L("esri.views.3d.support.CenterOnSurface")],tg);const eme=$(),zR=$(),tme=$();let h0=class extends Ee{constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Nt}get renderLocation(){if(!this.location)return null;const e=$();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}initialize(){this.view.state.isLocal&&(this._handles.add([re(()=>{var e,t;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(t=this.surfaceView)==null?void 0:t.extent]},()=>this._update()),os(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||M(this.surfaceView.extent)||!this.surfaceView.spatialReference)return void this._set("location",null);const e=dK(this.surfaceView.extent),t=new dt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{as(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",t)}};u([d({constructOnly:!0})],h0.prototype,"view",void 0),u([d({constructOnly:!0})],h0.prototype,"cache",void 0),u([d({readOnly:!0,aliasOf:"view.map.ground"})],h0.prototype,"surface",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain"})],h0.prototype,"surfaceView",void 0),u([d({readOnly:!0})],h0.prototype,"location",void 0),u([d({readOnly:!0})],h0.prototype,"renderLocation",null),h0=u([L("esri.views.3d.terrain.StableSurfaceCenter")],h0);let d0=class extends Ee{constructor(){super(...arguments),this.handles=new Nt,this._tileGeometryUpdateExtent=id(),this._tileGeometryUpdateSpatialReference=null,this.events=new cs,this.updating=!1}initialize(){this.handles.add([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(Ot.SURFACE_GEOMETRY_UPDATES,this)])}destroy(){this.handles=We(this.handles)}get running(){return this.updating}runTask(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",xxt),id(this._tileGeometryUpdateExtent),this._set("updating",!1))}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,GT(this._tileGeometryUpdateExtent,e.tile.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const i=this.centerOnSurfaces[t];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,t){const i=this.state.camera.eye,r=Txt,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,Uw,t),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,zw,t),Uw[0]<zw[0]?(r[0]=Uw[0],r[2]=zw[0]):(r[0]=zw[0],r[2]=Uw[0]),Uw[1]<zw[1]?(r[1]=Uw[1],r[3]=zw[1]):(r[1]=zw[1],r[3]=Uw[1]),hL(r,e)}};u([d({constructOnly:!0})],d0.prototype,"state",void 0),u([d({constructOnly:!0})],d0.prototype,"centerOnSurfaces",void 0),u([d({constructOnly:!0})],d0.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],d0.prototype,"scheduler",void 0),u([d({constructOnly:!0})],d0.prototype,"surface",void 0),u([d({readOnly:!0})],d0.prototype,"updating",void 0),d0=u([L("esri.views.3d.support.SurfaceGeometryUpdates")],d0);const xxt={},Uw=$(),zw=$(),Txt=id();let tl=class extends Ee{constructor(e){super(e),this._handles=new Nt,this._tmpRay=Do(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new wv({renderPointOfView:Sxt},this),this.renderPointOfView=$(),this._pois=new Array,this._debugCenters=new Map}initialize(){var c;const{state:e,basemapTerrain:t,renderCoordsHelper:i,map:r}=this.view;this._surfaceIntersector=cd(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Vo.MIN,this._contentIntersector=cd(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),n=this.view.resourceController.scheduler,o=(c=this.view.basemapTerrain)==null?void 0:c.elevationQueryCache,a={state:e,scheduler:n,surface:t,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new mu(me(F({},a),{task:Ot.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s}))),this._set("centerOnSurfaceFrequent",new mu(me(F({},a),{task:Ot.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s}))),this._set("contentCenterOnSurface",new mu(me(F({},a),{task:Ot.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s,cameraName:"contentCamera"}))),this._set("centerOnContent",new mu(me(F({},a),{task:Ot.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}))),this._set("cameraOnSurface",new wh(me(F({},a),{cache:o,task:Ot.POINT_OF_INTEREST_INFREQUENT,map:r}))),this._set("contentCameraOnSurface",new wh(me(F({},a),{cache:o,task:Ot.POINT_OF_INTEREST_INFREQUENT,map:r,cameraName:"contentCamera"}))),this._set("surfaceGeometryUpdates",new d0(me(F({},a),{centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}))),this._set("contentGeometryUpdates",new _xt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new h0({cache:o,view:this.view})),this._set("focus",new tg({state:e,scheduler:n,surface:t,renderCoordsHelper:i,centerOnSurface:this.contentCenterOnSurface,estimateSurfaceIntersectionAtRenderPoint:(h,p)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);const l=this.view.graphics;this._debugCenters.set(this.centerOnContent,new c1(l,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new c1(l,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new c1(l,"red","CenterOnSurface")),this._debugCenters.set(this.contentCenterOnSurface,new c1(l,"red","ContentCenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new c1(l,"blue","CameraOnSurface")),this._debugCenters.set(this.contentCameraOnSurface,new c1(l,"blue","ContentCameraOnSurface")),this._debugCenters.set(this.focus,new c1(l,"green","Focus")),this._handles.add([re(()=>e.camera,h=>this._cameraChanged(h),Ui),re(()=>t.extent,()=>this._updateCenterPointsOfInterest()),Jn(()=>!t.updating,()=>this._updateCenterPointsOfInterest(),Ui),os(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),os(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Jn(()=>dr.SHOW_POI,h=>this._setDebug(h),Et)]),this._cameraChanged(this.view.state.camera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)==null?void 0:e.updating)&&!this._pois.some(t=>t.updating))}get centerRay(){return this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1),this._centerRay}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this.centerRay;return M(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,uE,Cxt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(uE):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this.centerRay;if(M(e))return this._surfaceAltitudeAtCenter;const t=e.origin,i=we(uE,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.camera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,i),this._surfaceIntersector.results.min.getIntersectionPoint(uE)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(uE)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,i){const r=kie(t,e,Ext);if(M(r))return null;const s=r.origin,n=we(uE,r.origin,r.direction);return this._surfaceIntersector.resetWithRay(r,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,n),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;Ic(this.renderPointOfView,t)||this._set("renderPointOfView",pe(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(t=>t.hide()),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(re(()=>t.renderLocation,i=>this._debugCenters.get(t).show(i,t.renderCoordsHelper.spatialReference),Et),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([d({readOnly:!0})],tl.prototype,"centerOnContent",void 0),u([d({readOnly:!0})],tl.prototype,"centerOnSurfaceFrequent",void 0),u([d({readOnly:!0})],tl.prototype,"centerOnSurfaceInfrequent",void 0),u([d({readOnly:!0})],tl.prototype,"contentCenterOnSurface",void 0),u([d({readOnly:!0})],tl.prototype,"cameraOnSurface",void 0),u([d({readOnly:!0})],tl.prototype,"contentCameraOnSurface",void 0),u([d({readOnly:!0})],tl.prototype,"focus",void 0),u([d({readOnly:!0})],tl.prototype,"renderPointOfView",void 0),u([d({readOnly:!0})],tl.prototype,"surfaceOrigin",void 0),u([d({readOnly:!0})],tl.prototype,"contentGeometryUpdates",void 0),u([d({readOnly:!0})],tl.prototype,"surfaceGeometryUpdates",void 0),u([d({constructOnly:!0})],tl.prototype,"view",void 0),u([d({readOnly:!0})],tl.prototype,"updating",null),tl=u([L("esri.views.3d.support.PointsOfInterest")],tl);const Sxt=Array,uE=$(),Ext=Do(),Cxt={exclude:new Set([Rf])};class rIe{constructor(t){this.store=t}destroy(){this.store.destroy()}get(t){return this.store.get(t)}put(t,i){this.store.put(t,i,i.values.byteLength+256)}}const Axt=ve.getLogger("esri.core.workers.WorkerHandle");class sIe{constructor(t,i,r,s,n={}){this._mainMethod=i,this._transferLists=r,this._listeners=[],this._promise=pbe(t,me(F({},n),{schedule:s})).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>Axt.error(`Failed to initialize ${t} worker: ${o}`))}on(t,i){const r={removed:!1,eventName:t,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),Fo(()=>{r.removed=!0,MQ(this._listeners,r),this._thread&&_(r.threadHandle)&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(t,i){return this.invokeMethod(this._mainMethod,t,i)}invokeMethod(t,i,r){if(this._thread){const s=this._transferLists[t],n=s?s(i):[];return this._thread.invoke(t,i,{transferList:n,signal:r})}return this._promise?this._promise.then(()=>(qt(r),this.invokeMethod(t,i,r))):Promise.reject(null)}broadcast(t,i){return this._thread?Promise.all(this._thread.broadcast(i,t)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(t,i)):Promise.reject()}get promise(){return this._promise}_connectListener(t){this._thread&&this._thread.on(t.eventName,t.callback).then(i=>{t.removed||(t.threadHandle=i)})}}class ime extends sIe{constructor(t=null){super("LercWorker","_decode",{_decode:i=>[i.buffer]},t,{strategy:"dedicated"}),this.schedule=t,this.ref=0}decode(t,i,r){return t&&t.byteLength!==0?this.invoke({buffer:t,options:i},r):Promise.resolve(null)}release(){--this.ref<=0&&(h3.forEach((t,i)=>{t===this&&h3.delete(i)}),this.destroy())}}const h3=new Map;function Mxt(e=null){let t=h3.get(e);return t||(_(e)?(t=new ime(i=>e.schedule(i)),h3.set(e,t)):(t=new ime,h3.set(null,t))),++t.ref,t}function nv(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function nIe(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Oxt(e,t,i,r,s,n,o,a,l){const c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function Rxt(e,t){return new Float32Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:nv,clone:nIe,fromValues:Oxt,createView:Rxt},Symbol.toStringTag,{value:"Module"}));var rme,Su,sme,nme,ome;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.FILL_VERTEX=1]="FILL_VERTEX",e[e.FILL_DD_VERTEX=2]="FILL_DD_VERTEX",e[e.FILL_INDEX=3]="FILL_INDEX",e[e.OUTLINE_VERTEX=4]="OUTLINE_VERTEX",e[e.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX",e[e.OUTLINE_INDEX=6]="OUTLINE_INDEX",e[e.LINE_VERTEX=7]="LINE_VERTEX",e[e.LINE_DD_VERTEX=8]="LINE_DD_VERTEX",e[e.LINE_INDEX=9]="LINE_INDEX",e[e.ICON_VERTEX=10]="ICON_VERTEX",e[e.ICON_DD_VERTEX=11]="ICON_DD_VERTEX",e[e.ICON_INDEX=12]="ICON_INDEX",e[e.TEXT_VERTEX=13]="TEXT_VERTEX",e[e.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX",e[e.TEXT_INDEX=15]="TEXT_INDEX",e[e.CIRCLE_VERTEX=16]="CIRCLE_VERTEX",e[e.CIRCLE_INDEX=17]="CIRCLE_INDEX"})(rme||(rme={})),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(Su||(Su={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.OPAQUE=1]="OPAQUE",e[e.TRANSLUCENT=2]="TRANSLUCENT",e[e.SYMBOLS=3]="SYMBOLS",e[e.HITTEST=4]="HITTEST"}(sme||(sme={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(nme||(nme={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(ome||(ome={}));class Pxt{constructor(t){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t}}class rkt{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}function skt(e,t,i,r,s,n){const o=i-s;if(o>=0)return(t>>o)+(r-(n<<o))*(e>>o);const a=-o;return t-(n-(r<<a))*(e>>a)<<a}class nkt{constructor(t,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(t/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(t,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(t,i,r,s){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function Ixt(e,t,i,r,s,n){const o=t[r++];for(let a=0;a<o;a++){const l=new Pxt(n);l.xTile=t[r++],l.yTile=t[r++],l.hash=t[r++],l.priority=t[r++];const c=t[r++];for(let f=0;f<c;f++){const m=t[r++],g=t[r++],y=t[r++],x=t[r++],b=!!t[r++],S=t[r++],T=i[r++],C=i[r++],A=t[r++],O=t[r++];l.colliders.push({xTile:m,yTile:g,dxPixels:y,dyPixels:x,hard:b,partIndex:S,width:A,height:O,minLod:T,maxLod:C})}const h=e[r++];for(let f=0;f<h;f++)l.textVertexRanges.push([e[r++],e[r++]]);const p=e[r++];for(let f=0;f<p;f++)l.iconVertexRanges.push([e[r++],e[r++]]);s.push(l)}return r}function okt(e,t,i){for(const[r,s]of e.symbols)$xt(e,t,i,s,r)}function $xt(e,t,i,r,s){const n=e.layerData.get(s);if(n.type===Su.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let p=c;p<c+h;p+=4)n.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let p=c;p<c+h;p+=4)n.textOpacity[p/4]=l}n.lastOpacityUpdate=t,n.opacityChanged=!0}}class y8{constructor(t,i){this.layerUIDs=[],this.isDestroyed=!1,this.data=t,this.memoryUsed=t.byteLength;let r=1;const s=new Uint32Array(t);this.layerUIDs=[];const n=s[r++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return M(this.data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(t){M(this.data)||(this.doPrepareForRendering(t,this.data,this.bufferDataOffset),this.data=null)}}class Lxt extends y8{constructor(t,i){super(t,i),this.type=Su.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){_(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),_(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),_(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.lineVertexBuffer=Ci.createVertex(t,Wi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.lineIndexBuffer=Ci.createIndex(t,Wi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new Ln(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class Dxt extends y8{constructor(t,i){super(t,i),this.type=Su.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){_(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),_(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),_(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,_(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),_(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),_(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.fillVertexBuffer=Ci.createVertex(t,Wi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.fillIndexBuffer=Ci.createIndex(t,Wi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.outlineVertexBuffer=Ci.createVertex(t,Wi.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.outlineIndexBuffer=Ci.createIndex(t,Wi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c;const h=this.layer,p=h.fillMaterial,f=h.outlineMaterial;this.fillVertexArrayObject=new Ln(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new Ln(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class Nxt extends y8{constructor(t,i,r){super(t,i),this.type=Su.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(t),n=new Int32Array(t),o=new Float32Array(t);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let f=0;f<l;f++){const m=s[a++],g=s[a++],y=s[a++];this.iconPerPageElementsMap.set(m,[g,y])}const c=s[a++];for(let f=0;f<c;f++){const m=s[a++],g=s[a++],y=s[a++];this.glyphPerPageElementsMap.set(m,[g,y])}const h=s[a++],p=s[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(p),a=Ixt(s,n,o,a,this.symbols,r),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let t=0;for(const[i,r]of this.iconPerPageElementsMap)t+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)t+=r[1];return t/3}doDestroy(){_(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),_(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),_(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),_(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,_(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),_(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),_(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),_(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const t=this.iconOpacity,i=this.iconOpacityBuffer;t.length>0&&t.byteLength===i.size&&i.setSubData(t);const r=this.textOpacity,s=this.textOpacityBuffer;r.length>0&&r.byteLength===s.size&&s.setSubData(r)}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.iconVertexBuffer=Ci.createVertex(t,Wi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.iconIndexBuffer=Ci.createIndex(t,Wi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.textVertexBuffer=Ci.createVertex(t,Wi.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.textIndexBuffer=Ci.createIndex(t,Wi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c,this.iconOpacityBuffer=Ci.createVertex(t,Wi.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=Ci.createVertex(t,Wi.STATIC_DRAW,this.textOpacity.buffer);const h=this.layer,p=h.iconMaterial,f=h.textMaterial;this.iconVertexArrayObject=new Ln(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new Ln(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class Fxt extends y8{constructor(t,i){super(t,i),this.type=Su.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){_(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),_(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),_(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.circleVertexBuffer=Ci.createVertex(t,Wi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.circleIndexBuffer=Ci.createIndex(t,Wi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new Ln(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}const akt=!0,lkt=32,ame=200,kxt=1/ye("mapview-transitions-duration");class Uxt extends cs{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this.requestRender())}get stage(){return this._stage}set stage(t){if(this._stage===t)return;const i=this._stage;this._stage=t,t?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return M(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=rm(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=rm(),this.requestRender()),this._fadeOutResolver.promise}beforeRender(t){this.updateTransitionProperties(t.deltaTime,t.state.scale)}afterRender(t){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t){}processRender(t){this.stage&&this.computedVisible&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(t,i){if(this.fadeTransitionEnabled){const r=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===r)this.computedVisible=this.visible;else{const n=t*kxt;this.computedOpacity=s>r?Math.max(r,s-n):Math.min(r,s+n),this.computedVisible=this.computedOpacity>0;const o=r===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}class wg{constructor(t,i,r,s){this.set(t,i,r,s)}static getId(t,i,r,s){return typeof t=="object"?`${t.level}/${t.row}/${t.col}/${t.world}`:`${t}/${i}/${r}/${s}`}get key(){return this}get id(){return this.toString()}set id(t){this.set(t)}get hash(){const t=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|t<<8|r}acquire(t,i,r,s){this.set(t,i,r,s)}contains(t){const i=t.level-this.level;return this.row===t.row>>i&&this.col===t.col>>i&&this.world===t.world}equals(t){return this.level===t.level&&this.row===t.row&&this.col===t.col&&this.world===t.world}clone(){return new wg(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(t,i,r,s){if(t==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof t=="object")this.level=t.level||0,this.row=t.row||0,this.col=t.col||0,this.world=t.world||0;else if(typeof t=="string"){const[n,o,a,l]=t.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+t,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new wg(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const t=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new wg(t,i,r,s),new wg(t,i,r+1,s),new wg(t,i+1,r,s),new wg(t,i+1,r+1,s)]}compareRowMajor(t){return this.row<t.row?-1:this.row>t.row?1:this.col<t.col?-1:this.col>t.col?1:0}}wg.pool=new un(wg,null,null,25,50);class zxt extends Uxt{constructor(t,i,r,s,n,o=s,a=n){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new wg(t),this.x=i,this.y=r,this.width=s,this.height=n,this.rangeX=o,this.rangeY=a}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(t,i){const r=i/(t.resolution*t.pixelRatio),s=this.transforms.tileMat3,[n,o]=t.toScreenNoRotation([0,0],[this.x,this.y]),a=this.width/this.rangeX*r,l=this.height/this.rangeY*r;hie(s,a,0,0,0,l,0,n,o,1),d6(this.transforms.dvs,t.displayViewMat3,s)}}class d3 extends zxt{constructor(t,i,r,s,n,o,a=null){super(t,i,r,s,n,4096,4096),this._memCache=a,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=o,this.id=t.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<ame}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<ame)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(t){this.changeDataImpl(t),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(t){let i=!1;for(const r of t)if(this.layerData.has(r)){const s=this.layerData.get(r);this._memoryUsedByLayerData-=s.memoryUsed,s.type===Su.SYMBOL&&this.symbols.has(r)&&(this.symbols.delete(r),i=!0),s.destroy(),this.layerData.delete(r),this.layerCount--}_(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(oIe.delete(this),d3._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(t){let i=!1;if(t){const{bucketsWithData:r,emptyBuckets:s}=t,n=this._createRenderBuckets(r);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===Su.SYMBOL&&(this.symbols.set(o,a.symbols),i=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;_(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[r,s]of this.layerData)s.type===Su.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(t){this.stage={context:t,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(t,i){super.setTransform(t,i);const r=i/(t.resolution*t.pixelRatio),s=this.width/this.rangeX*r,n=this.height/this.rangeY*r,o=[0,0];t.toScreen(o,[this.x,this.y]);const a=this.transforms.tileUnitsToPixels;die(a),Sz(a,a,o),pie(a,a,Math.PI*t.rotation/180),fie(a,a,[s,n,1])}_createTransforms(){return{dvs:nv(),tileMat3:nv(),tileUnitsToPixels:nv()}}static _destroyRenderBuckets(t){if(!t)return;const i=new Set;t.forEach(r=>{i.has(r)||(r.destroy(),i.add(r))}),t.clear()}_createRenderBuckets(t){const i=new Map,r=new Map;for(const s of t){const n=this._deserializeBucket(s,r);for(const o of n.layerUIDs)i.set(o,n)}return i}_deserializeBucket(t,i){let r=i.get(t);if(r)return r;switch(new Uint32Array(t)[0]){case Su.FILL:r=new Dxt(t,this.styleRepository);break;case Su.LINE:r=new Lxt(t,this.styleRepository);break;case Su.SYMBOL:r=new Nxt(t,this.styleRepository,this);break;case Su.CIRCLE:r=new Fxt(t,this.styleRepository)}return i.set(t,r),r}_deleteLayerData(t){if(!this.layerData.has(t))return;const i=this.layerData.get(t);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(t),this.layerCount--}}const oIe=new Map;function Vxt(){oIe.forEach((e,t)=>{console.log(`
${t.key}:`),e[0].forEach(i=>console.log(i)),console.log("========"),e[1].forEach(i=>console.log(i))})}const ckt={value:.5,readOnly:!0},Bxt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};class Gre{constructor(t=0,i=0){this.min=t,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(t){this.min=t.min,this.max=t.max,this.level=t.level,this.hasNoDataValues=t.hasNoDataValues}}class Gxt{constructor(t,i,r){this.type="elevation",this.samplerData=null,this.level=t[0],this.i=t[1],this.j=t[2],this.extent=i;const s=r.noDataValue,n=r.values;let o=1/0,a=-1/0,l=!0,c=!1;for(let h=0;h<n.length;h++){const p=n[h];p!==s?(o=p<o?p:o,a=p>a?p:a,l=!1):c=!0}l&&(o=0,a=0),a=a>-3e38?a:0,this.samplerData={pixelData:r.values,width:r.width,height:r.height,noDataValue:s,safeWidth:.99999999*(r.width-1),dx:(r.width-1)/(i[2]-i[0]),dy:(r.width-1)/(i[3]-i[1]),x0:i[0],y1:i[3]},this.bounds=[o,a],this.hasNoDataValues=c}release(){this.samplerData=null,this.bounds=null}computeMinMaxValue(t,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=t-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.width,h=this.samplerData.pixelData,p=.5*i$;let f=(c-1)/o,m=(r-this.j*o)*f,g=(i-this.i*o)*f;if(f<1){const y=Math.floor(m),x=Math.floor(g),b=y+x*c,S=h[b],T=h[b+1],C=h[b+c],A=h[b+c+1];if(S+T+C+A<p){const O=m-y,D=g-x,U=HD(S,T,C,A,O,D),k=HD(S,T,C,A,O+f,D),B=HD(S,T,C,A,O,D+f),j=HD(S,T,C,A,O+f,D+f);return s.min=Math.min(U,k,B,j),s.max=Math.max(U,k,B,j),s}m=y,g=x,f=1}else m=Math.floor(m),g=Math.floor(g),f=Math.ceil(f);for(let y=m;y<=m+f;y++)for(let x=g;x<=g+f;x++){const b=h[y+x*c];b<p?(a=Math.min(a,b),l=Math.max(l,b)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}}function aIe(e,t,i){if(M(i))return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=He(r.dy*(r.y1-t),0,s),o=He(r.dx*(e-r.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=r.width,h=a*c+l,p=r.pixelData,f=p[h],m=p[h+1],g=h+c,y=p[g],x=p[g+1];if(f+y+m+x<.5*i$){n-=a,o-=l;const b=f+(m-f)*o;return b+(y+(x-y)*o-b)*n}}return null}function qr(e,t,i){const r=aIe(e,t,i);return _(r)?r:0}let Gd=class extends Ee{constructor(e){super(e),this._handles=new Nt}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles.destroy(),this._handles=null}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(t=>{const i=t.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const r=lIe(i.fullExtent,this.viewSpatialReference);_(r)&&e.push(hK(r))}}),e}};function jxt(e,t){return e===tt.Global?new xJ(t):new TJ(t)}u([d({readOnly:!0})],Gd.prototype,"layerViewsExtent",null),u([d({readOnly:!0})],Gd.prototype,"tiledLayersExtent",null),u([d({readOnly:!0})],Gd.prototype,"stencilEnabledExtents",null),u([d()],Gd.prototype,"viewSpatialReference",void 0),u([d()],Gd.prototype,"tilingScheme",void 0),u([d()],Gd.prototype,"defaultTiledLayersExtent",void 0),u([d({constructOnly:!0})],Gd.prototype,"layers",void 0),u([d({constructOnly:!0})],Gd.prototype,"layerViews",void 0),Gd=u([L("esri.views.3d.terrain.ExtentHelper")],Gd);let xJ=class extends Gd{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?KEe:$it}};xJ=u([L("esri.views.3d.terrain.ExtentHelperGlobal")],xJ);let TJ=class extends Gd{_computeLayerViewsExtent(){const e=id(),t=this.viewSpatialReference;this.layerViews.forEach(s=>{const n=s.layer;if(s.isResolved()&&(n.type!=="graphics"||!n.internal)){const o=lIe("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,t);GT(e,o,e)}});const i=Qq(e)?e:null,r=this._get("layerViewsExtent");return jT(i,r)?r:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,i=id();this.layers.forEach(n=>{if(n.loaded&&UI(n)){const o=g8(n,t,tt.Local);if(M(o))return;const{tileInfo:a,fullExtent:l}=o;_(a)&&_(l)&&(hV(n)||e.compatibleWith(a)&&l.spatialReference.equals(e.spatialReference))&&GT(i,l,i)}}),GT(i,this.defaultTiledLayersExtent,i);const r=Qq(i)?i:null,s=this._get("tiledLayersExtent");return jT(r,s)?s:r}};function lIe(e,t){return _(e)&&!e.spatialReference.equals(t)?Bbe(e,e.spatialReference,t):e}TJ=u([L("esri.views.3d.terrain.ExtentHelperLocal")],TJ);var gi;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"})(gi||(gi={}));const Dx=[gi.ELEVATION,gi.MAP];function cIe(){var t;const e=(t=globalThis.require)==null?void 0:t.modules;if(e){const i=Object.keys(e);for(const r of i)r.search(".glsl")!==-1&&delete e[r]}}const Hxt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let T_,fc=class extends Ee{constructor(e){super(e),this._handles=new Nt,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=ye("esri-mobile")?2048:4096,this._animationTimeLast=0}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||dr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return _(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Ri(this._spatialReference).metersPerDegree:1}get view(){return this.surface.view}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}initialize(){const e=this.view;this.renderer=new uf({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=cd(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",t=>{var i;return(i=e._stage)==null?void 0:i.renderView.setRenderParameters({hasOverlayWater:t})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),re(()=>{var t,i,r;return[(t=e.pointsOfInterest)==null?void 0:t.renderPointOfView,(r=(i=e.pointsOfInterest)==null?void 0:i.centerOnSurfaceFrequent)==null?void 0:r.location]},()=>this.setPlacementDirty()),re(()=>{var t;return(t=e.state)==null?void 0:t.pixelRatio},()=>this.setPlacementDirty(),Ui),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),aS({preRender:t=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(t),this._drawOverlayTextures(this.renderer.overlays,An.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),e.resourceController.scheduler.registerTask(Ot.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",t=>{this._updateOverlays(t,An.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,An.BACKGROUND,t)})])}destroy(){this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null),_(T_)&&(T_.hide(),T_=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this.view.renderSpatialReference;_(e)&&_(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new Tb(-20037508342787e-6,20037508342787e-6):new Tb(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,t,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const r=this.renderer.createDrapeSourceRenderer(e,t,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),r}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,pg)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&_(e.setDrapingExtent)&&_(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this.view._stage)==null||e.renderView.setRenderParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(){this._updateOverlays(this.view.state.camera,An.UPDATE)}_updateOverlays(e,t){if(!this._spatialReference)return;const i=amt(e.fullWidth,e.fullHeight,this._maxResolution);this._computeOverlayExtents(e,i,Uy);const r=zh(Uy.inner)/zh(Uy.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this._updateOverlay(_s.INNER,Uy.inner,i,1*Uy.pixelRatioAdjustment,Uy.mapUnitsPerPixel),n=this._updateOverlay(_s.OUTER,Uy.outer,i,r*Uy.pixelRatioAdjustment,Uy.mapUnitsPerPixel);s!==mg.EXTENT&&n!==mg.EXTENT||(this._drapeSources.forEach(o=>this._updateDrapeSourceExtent(o)),this.surface.updateTileOverlayParams(t)),s===mg.NONE&&n===mg.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1}_updateOverlay(e,t,i,r,s){if(this.renderer.overlays.length===0)return mg.NONE;const n=this.renderer.overlays[e],o=n.mapUnitsPerPixel;if(n.mapUnitsPerPixel=s,n.pixelRatio=r,qxt(t,n.extent)&&i===n.resolution)return o===s?mg.NONE:mg.RERENDER_ONLY;pv(n.extent,t),n.resolution=i;const a=dK(n.extent);return n.renderLocalOrigin=n3(a[0],a[1],0,"OV_"+this._latestOriginId++),mg.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[_s.INNER],r=this.renderer.overlays[_s.OUTER],s=i5(e.extent,this.surface.extent,lme);this._rectInsideRect(i.extent,s)||this._rectanglesOverlap(s,i.extent)||this._rectanglesOverlap(s,r.extent)?(this._setTileOverlayData(s,_s.INNER,t),this._setTileOverlayData(s,_s.OUTER,t)):(this._clearTileOverlayData(_s.INNER,t),this._clearTileOverlayData(_s.OUTER,t))}else this._clearTileOverlayData(_s.INNER,t),this._clearTileOverlayData(_s.OUTER,t)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const t=this.renderer.overlays[_s.INNER],i=this.renderer.overlays[_s.OUTER],r=this._pointIsInExtent(e,t.extent)?t:i;return(r.extent[2]-r.extent[0])/r.resolution}_setTileOverlayData(e,t,i){if(this.renderer.overlays.length===0)return;const r=this.renderer.overlays[t].extent,s=zh(r),n=nm(r);let o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(r[0],o);const a=this._longitudeCyclical.minimalMonotonic(r[0],e[2]);o>a&&(o=a-(e[2]-e[0]))}i.setScale(t,zh(e)/s,nm(e)/n),i.setOffset(t,(o-r[0])/s,(e[1]-r[1])/n)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){cIe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask()}_dispatchAnimationUpdate(e){const t=e.time-this._animationTimeLast;(t>=this.surface.view._stage.renderView.animationTimestep||_(this.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)&&(this.renderer.updateAnimation({dt:t,forcedTime:this.forcedAnimationTime,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e.time)}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this.setPlacementDirty()}_intersectGroundFromView(e,t,i,r){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,Zxt,t,i);if(M(s))return!1;const n=s.origin,o=we(qF,s.origin,s.direction);return this._groundIntersector.reset(n,o,e),this._groundIntersector.intersect([],null),this.view.basemapTerrain.intersect(this._groundIntersector,null,n,o),this._groundIntersector.results.min.getIntersectionPoint(r)}_findHorizonBasedPointOfInterest(e,t){let i=.5;const r=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),n=this.view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,a=He(n.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+o,e.aboveGround?s-o:1/0),l=e.aboveGround;if(this.view.viewingMode==="global"){const c=qF;aO(vB(_B,Ri(this.view.spatialReference).radius+a),od(e.eye,e.viewForward),c),xe(c,c,e.eye);const h=Sb.normalize(tGe(e.viewForward,c,e.viewRight))/e.fovY+.5,p=h<=0||h>=1?.5:r;i=l?p*h:h+p*(1-h)}else{const c=.5*Math.PI-Math.acos(-e.viewForward[2]),h=Math.tan(c),p=zi(0,h,1,0),f=jh(p,p,e.projectionMatrix)[1],m=He(.5+.5*f,0,1);i=m===1||m===0?.5:l?m*r:1-(1-m)*r}return!!this._intersectGroundFromView(e,.5,i,t)&&xQ(t,e.eye)<n.distance*n.distance}_computeOverlayExtents(e,t,i){const r=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=$();this._findHorizonBasedPointOfInterest(e,s)||pe(s,r);const n=Math.max(.1,Pr(e.eye,s)),o=zb(this.view.renderCoordsHelper,r,e.eye),a=Math.PI/2-Math.abs(o-Math.PI/2);dr.OVERLAY_SHOW_CENTER?(M(T_)&&(T_=new c1(this.view.graphics,"red")),T_.show(s,this._renderSR)):_(T_)&&T_.hide(),this._overlaySREqualsRenderSR||Zn(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&_(this._spatialReference)&&this._spatialReference.isGeographic,h=c&&_(this._spatialReference)?1/Ri(this._spatialReference).metersPerDegree:1,p=e.perRenderPixelRatio*n*h;i.mapUnitsPerPixel=p/this._worldToPCSRatio;let f=t*p/2,m=!1,g=c?90:1/0;this._isSpherical&&_(l)&&_(this._spatialReference)&&(this._spatialReference.isWebMercator?(f/=Math.cos(dU(s[1])),g=l[3]):(m=!0,f/=Ri(this._spatialReference).metersPerDegree,g=90),f>=g&&(f=g,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let y=1;m&&(y=1/Math.max(.2,Math.cos(Math.abs(Yt(s[1])))),f*y>180&&(y=180/f),i.mapUnitsPerPixel*=y);const x=Math.log(2)/12;f=Math.exp(Math.round(Math.log(f)/x)*x);const b=f*y,S=32,T=.5*t/(S*b),C=.5*t/(S*f);s[0]=Math.round(s[0]*T)/T,s[1]=Math.round(s[1]*C)/C;const A=i.inner;A[0]=s[0]-b,A[1]=s[1]-f,A[2]=s[0]+b,A[3]=s[1]+f,this._isSpherical&&this._shiftExtentToFitBounds(A,1/0,g);const O=i.outer;if(6*b>zh(l))pv(O,l);else if(a<=.25*Math.PI)O[0]=A[0]-b,O[1]=A[1]-f,O[2]=A[2]+b,O[3]=A[3]+f;else{Zn(e.eye,this._renderSR,qF,this._spatialReference),Ss(Vw,s,qF);let U=-Math.atan2(Vw[1],Vw[0])+.125*Math.PI;U<0&&(U+=2*Math.PI);const k=Math.floor(U/(.25*Math.PI));rL(Vw,Hxt[k],2*f),Vw[0]*=y,Vw[2]*=y,SQ(O,A,Vw)}if(this._isSpherical)O[0]=this._longitudeCyclical.clamp(O[0]),O[2]=this._longitudeCyclical.clamp(O[2]),O[1]=Math.max(O[1],-g),O[3]=Math.min(O[3],g);else{const U=i5(A,l,lme),k=i5(O,l,Wxt);yU(U,k)&&(O[2]=O[0],O[3]=O[1])}const D=Math.abs(A[2]-A[0])/t;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,D),i.pixelRatioAdjustment=i.mapUnitsPerPixel/D}_drawOverlayTextures(e,t,i=this.view.state.camera){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const r=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[_s.INNER],i),n=this._drawOverlay(e[_s.OUTER],i);s!==yM.CHANGED&&n!==yM.CHANGED||this.surface.updateTileOverlayParams(An.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),r?(this.surface.requestRender(t),t===An.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(An.BACKGROUND)}_drawOverlay(e,t){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,t.pixelRatio)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,t){return!M(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):hL(e,t))}_rectInsideRect(e,t){return!M(t)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:yU(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const i=e.x,r=e.y;return i>t[0]&&i<t[2]&&r>t[1]&&r<t[3]}_shiftExtentToFitBounds(e,t,i){let r=0,s=0;e[0]<-t?r=e[0]+t:e[2]>t&&(r=t-e[2]),e[1]<-i?s=e[1]+i:e[3]>i&&(s=i-e[3]),vU(e,r,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask()}}};function qxt(e,t){const r=dr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=r&&Math.abs(t[1]-e[1])<=r&&Math.abs(t[2]-e[2])<=r&&Math.abs(t[3]-e[3])<=r}u([d()],fc.prototype,"_spatialReference",void 0),u([d({readOnly:!0})],fc.prototype,"running",null),u([d()],fc.prototype,"_placementDirty",void 0),u([d()],fc.prototype,"_contentUpdated",void 0),u([d()],fc.prototype,"_isSpherical",null),u([d()],fc.prototype,"_worldToPCSRatio",null),u([d()],fc.prototype,"renderer",void 0),u([d({constructOnly:!0})],fc.prototype,"surface",void 0),u([d({readOnly:!0,aliasOf:"surface.suspended"})],fc.prototype,"suspended",void 0),u([d({readOnly:!0})],fc.prototype,"updating",null),u([d({type:Boolean})],fc.prototype,"hasHighlights",null),u([d({type:Boolean})],fc.prototype,"rendersOccluded",null),fc=u([L("esri.views.3d.terrain.OverlayManager")],fc);const Vw=si(),qF=$(),Uy={inner:Qt(),outer:Qt(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},lme=Qt(),Wxt=Qt(),Zxt=Do();var mg;(function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"})(mg||(mg={}));class H${constructor(t,i){this._factoryCallback=t,this._lengthCallback=i,this._pool=new Map}acquire(t){if(!H$.test.disabled){const i=this._pool.get(t);if(i&&i.length!==0)return i.pop()}try{return this._factoryCallback(t)}catch(i){const r=window.performance&&window.performance.memory;let s="";throw r&&(s=`
  totalJSHeapSize: ${r.totalJSHeapSize}, usedJSHeapSize: ${r.usedJSHeapSize}, jsHeapSizeLimit: ${r.jsHeapSizeLimit}`),console.log("Array allocation of size "+t+" failed: "+i+s),i}}release(t){if(H$.test.disabled)return;const i=this._lengthCallback(t);let r=this._pool.get(i);r||(r=new ai({shrink:!0}),this._pool.set(i,r)),r.push(t)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}H$.test={disabled:!1};class Xxt{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=Nr(),this.indexCount=0,this.numVerticesPerSide=0,this.uvOffsetAndScale=si(),this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}}class cme{constructor(t,i,r,s,n){this._buf=t,this._localOrigin=i,this.offset0=r,this.stride=s,this.count=n}getVertexOffset(t){return 0<=t&&t<this.count,this.offset0+this.stride*t}getVertex(t,i){const r=this.getVertexOffset(i)*qd;t[0]=this._buf[r+0]+this._localOrigin[0],t[1]=this._buf[r+1]+this._localOrigin[1],t[2]=this._buf[r+2]+this._localOrigin[2]}getVertexZ(t){const i=this.getVertexOffset(t)*qd;return this._buf[i+2]+this._localOrigin[2]}setVertex(t,i,r,s){const n=this.getVertexOffset(t)*qd;this._buf[n+0]=i[0]-this._localOrigin[0],this._buf[n+1]=i[1]-this._localOrigin[1],this._buf[n+2]=i[2]-this._localOrigin[2],this._buf[n+3]=r,this._buf[n+4]=s}getNormal(t,i){const r=this.getVertexOffset(i)*qd;t[0]=this._buf[r+5],t[1]=this._buf[r+6],t[2]=this._buf[r+7]}setVertexRawXYZUV(t,i,r,s,n,o){const a=this.getVertexOffset(t)*qd;this._buf[a+0]=i,this._buf[a+1]=r,this._buf[a+2]=s,this._buf[a+3]=n,this._buf[a+4]=o}setVertexRawXYZUVN(t,i,r,s,n,o,a,l,c){const h=this.getVertexOffset(t)*qd;this._buf[h+0]=i,this._buf[h+1]=r,this._buf[h+2]=s,this._buf[h+3]=n,this._buf[h+4]=o,this._buf[h+5]=a,this._buf[h+6]=l,this._buf[h+7]=c}setVertexRawNormal(t,i,r,s){const n=this.getVertexOffset(t)*qd;this._buf[n+5]=i,this._buf[n+6]=r,this._buf[n+7]=s}getVertexRawNormal(t,i){const r=this.getVertexOffset(i)*qd;t[0]=this._buf[r+5],t[1]=this._buf[r+6],t[2]=this._buf[r+7]}}const Yxt=Bs().vec3f(P.POSITION).vec2f(P.UV0).vec3f(P.NORMAL),jre=new H$(e=>Yxt.createBuffer(e),e=>e.count);function Jxt(){jre.clear()}function uIe(e){return jre.acquire(e)}function Qxt(e){jre.release(e.vertexAttributes),e.vertexAttributes=null,e.indices=null}class Kxt{constructor(){this.sinLonLUT=new Array(aY+1),this.cosLonLUT=new Array(aY+1)}update(t,i){const r=i[0],s=i[2];for(let n=0;n<=t;n++){const o=n/t,a=r*(1-o)+s*o;this.sinLonLUT[n]=Math.sin(a),this.cosLonLUT[n]=Math.cos(a)}}}class WF{constructor(){this.elevation=0,this.normal=[0,0,1],this.cornerTiles=[null,null,null,null]}}class eTt{constructor(){this.edgeNeighbours=[null,null,null,null],this.cornerNeighborData=[new WF,new WF,new WF,new WF],this.edgeResolutions=[1,1,1,1],this.modifiedEdgeResolutions=[!1,!1,!1,!1]}}class tTt{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new eTt}}class TA{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=We(this._current),this._next=We(this._next),this._waiting=We(this._waiting),this._delayed=We(this._delayed)}get current(){if(M(this._current))return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let t=TA.test.fadeMoment;if(_(this._delayed)&&(t=t||performance.now(),t>=this._delayedTime&&(this._push(this._delayed,ov.Immediate),this._delayed=null)),_(this._next)){t=t||performance.now();const i=this._fadeDuration,r=_(this._current)&&this._next.texture===this._current.texture,s=this._next.type!==No.FADING,n=t-this._fadeStart>=i;(r||s||n)&&(We(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}get next(){return this._next}get fadeFactor(){if(M(this._next))return 1;const t=TA.test.fadeMoment||performance.now(),i=Math.max(0,t-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return _(this._next)||_(this._delayed)}push(t,i=ov.Immediate){this._delayed=We(this._delayed),this._push(t,i)}_push(t,i){if(this._isFadingEnabled||this.clear(),M(this._current))return void(this._current=t);const r=TA.test.fadeMoment||performance.now();return i!==ov.Immediate?(this._delayed=t,void(this._delayedTime=r+i)):M(this._next)?(this._next=t,void(this._fadeStart=this._alignFadeStart(r))):void(M(t)||(We(this._waiting),this._waiting=t))}get _fadeDuration(){return M(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(t){const i=this._getFadeDuration();return t+i-t%i}get _isFadingEnabled(){return this._getFadeDuration()>0}}var ov;TA.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}(ov||(ov={}));class hIe{constructor(){this._queue=new ai,this._last=null,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(t){this._queue.clear(),this._queue.push(t),this._last=null}reset(t=null){this._queue.clear(),_(t)&&this._queue.pushArray(t),this._last=null}skipSubtree(){this._last=null}next(){return this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children),this._last=this._queue.pop(),this._last}}class iTt{constructor(){this.q=new ai}get done(){return this.q.length===0}reset(t){if(this.q.clear(),!M(t)){this.q.pushArray(t);for(let i=0;i<this.q.length;++i){const r=this.q.data[i];r.isLeaf||this.q.pushArray(r.children)}}}next(){return this.q.pop()}}function p3(e,t,i){if(M(t)||M(t.fullExtent))return!1;const r=t.fullExtent,s=e.extent;if(i){if(s[0]<r.xmin||s[1]<r.ymin||s[2]>r.xmax||s[3]>r.ymax)return!1}else if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=e.surface.tilingScheme.levels[e.level].scale;return!(t.minScale>0&&n>1.00000001*t.minScale)&&!(t.maxScale>0&&n<.99999999*t.maxScale)}function dIe(e,t){return e.lij[0]-t.lij[0]||e.lij[1]-t.lij[1]||e.lij[2]-t.lij[2]}function pIe(e,t){t.sort((i,r)=>fIe(i,r,e))}function fIe(e,t,i){const r=e.screenDepth,s=t.screenDepth;return r<s?-i:r>s?i:dIe(e,t)}function rTt(e,t){const i=new Map;e.forAll(r=>i.set(r.lij,r.distanceToSquared(t))),e.sort((r,s)=>i.get(r.lij)-i.get(s.lij)||dIe(r,s))}function sTt(e,t,i){let r=1,s=0,n=0;for(;e!==t;)if(r*=.5,s*=.5,n*=.5,1&e.lij[2]&&(s+=.5),(1&e.lij[1])==0&&(n+=.5),(e=e.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(t,s,n,r)}function nTt(e){for(let t=0;t<e.length;t++){const i=e[t],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i&&n.loadable)return!0}}return!1}function ukt(e,t){if(!e||!t||e[0]===t[0])return!1;const i=e[0]<t[0],r=i?e:t,s=i?t:e,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}class Hre{get updating(){return!!this._tileRequested}init(t,i,r,s){this.tile=t,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=t.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(t){t!==this._suspended&&(this._suspended=t,t?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const t=this._findAncestorWithData();return this._setUpsampleTile(t),this._requestNext()}dataArrived(t){this._setUpsampleTile(t),this._tileRequested=null,t===this.tile?this.tile.updateRenderData(this._layerClass,No.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const t=this._findNextDownload();if(this._tileRequested){if(t===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return _(t)?t.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=t):this._agentDone(),!!this._tileRequested}_findNextDownload(){const t=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(t,i),s=_J(r),{minLevel:n,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?p3:()=>!0;let h=this.tile;const p=h.level;let f;const m=this._tileLayerInfo.upsampleInfo,g=_(m)?m.tile.level:-1,y=!!_(m)&&g-p>=a,x=Wr(s,"tilemapCache");for(;h&&c(h,s,!1)&&h.level>=n;){const b=h.level,S=p-b,T=h.layerInfo[i][t];if(T.data&&S>=a){(!y||b>g)&&this._setUpsampleTile(h),T.dataInvalidated&&(f=h);break}if((M(x)||x.getAvailability(h.lij[0],h.lij[1],h.lij[2])!=="unavailable")&&b<=o&&!T.data&&!T.dataMissing&&((M(f)||h.level===n||b%QEe==0||p-f.level<a)&&(f=h),S>=l))break;h=h.parent}return _(f)&&p-f.level<a&&this._tileLayerInfo.upsampleInfo&&(f=null),f}_findAncestorWithData(){const t=this.tile.vlevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(t-s.level>=i)return s;r=s}return r}_setUpsampleTile(t){this._tileLayerInfo.setUpsampleInfo(this.tile,t),this.tile.updateRenderData(this._layerClass,No.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class oTt extends Hre{get _desiredMinLevelDelta(){throw ume}get _progressiveLevelModulo(){throw ume}dispose(){}}const ume=new Error("Abstract method called on TileAgent"),Kc=new oTt;class mIe extends Hre{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return H5(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}class gIe extends Hre{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return QEe}}var iS,zS;(function(e){e[e.Stretch=0]="Stretch",e[e.Lut=1]="Lut",e[e.Hillshade=2]="Hillshade",e[e.COUNT=3]="COUNT"})(iS||(iS={})),function(e){e[e.Noop=0]="Noop",e[e.PerBand=1]="PerBand",e[e.COUNT=2]="COUNT"}(zS||(zS={}));var hme,qe;(function(e){e[e.OneMinusSourceAlpha=0]="OneMinusSourceAlpha",e[e.SourceAlpha=1]="SourceAlpha",e[e.COUNT=2]="COUNT"})(hme||(hme={})),function(e){e[e.Normal=0]="Normal",e[e.Average=1]="Average",e[e.Lighten=2]="Lighten",e[e.Lighter=3]="Lighter",e[e.Plus=4]="Plus",e[e.Screen=5]="Screen",e[e.ColorDodge=6]="ColorDodge",e[e.Darken=7]="Darken",e[e.Multiply=8]="Multiply",e[e.ColorBurn=9]="ColorBurn",e[e.Overlay=10]="Overlay",e[e.SoftLight=11]="SoftLight",e[e.HardLight=12]="HardLight",e[e.VividLight=13]="VividLight",e[e.Hue=14]="Hue",e[e.Saturation=15]="Saturation",e[e.Luminosity=16]="Luminosity",e[e.Color=17]="Color",e[e.DestinationOver=18]="DestinationOver",e[e.DestinationAtop=19]="DestinationAtop",e[e.DestinationIn=20]="DestinationIn",e[e.DestinationOut=21]="DestinationOut",e[e.SourceAtop=22]="SourceAtop",e[e.SourceIn=23]="SourceIn",e[e.SourceOut=24]="SourceOut",e[e.Xor=25]="Xor",e[e.Difference=26]="Difference",e[e.Exclusion=27]="Exclusion",e[e.Minus=28]="Minus",e[e.Invert=29]="Invert",e[e.Reflect=30]="Reflect",e[e.COUNT=31]="COUNT"}(qe||(qe={}));const Tk={normal:qe.Normal,average:qe.Average,lighten:qe.Lighten,lighter:qe.Lighter,screen:qe.Screen,plus:qe.Plus,"color-dodge":qe.ColorDodge,darken:qe.Darken,multiply:qe.Multiply,"color-burn":qe.ColorBurn,overlay:qe.Overlay,"soft-light":qe.SoftLight,"hard-light":qe.HardLight,"vivid-light":qe.VividLight,hue:qe.Hue,saturation:qe.Saturation,luminosity:qe.Luminosity,color:qe.Color,difference:qe.Difference,exclusion:qe.Exclusion,minus:qe.Minus,invert:qe.Invert,reflect:qe.Reflect,"destination-over":qe.DestinationOver,"destination-atop":qe.DestinationAtop,"destination-in":qe.DestinationIn,"destination-out":qe.DestinationOut,"source-atop":qe.SourceAtop,"source-in":qe.SourceIn,"source-out":qe.SourceOut,xor:qe.Xor};function aTt(e){return e===qe.DestinationOver||e===qe.DestinationAtop||e===qe.DestinationIn||e===qe.DestinationOut||e===qe.SourceAtop||e===qe.SourceIn||e===qe.SourceOut||e===qe.Xor}function lTt(e){e.fragment.uniforms.add([new oi("u_colormap",t=>t.u_colormap),new lt("u_colormapOffset",t=>t.colormap.u_colormapOffset),new lt("u_colormapMaxIndex",t=>t.colormap.u_colormapMaxIndex),new lt("u_opacity",t=>t.common.u_opacity)]),e.fragment.code.add(E`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
result = texture2D(u_colormap, clrPosition);
}
return result;
}`)}function cTt(e){e.fragment.uniforms.add(new oi("u_transformGrid",t=>t.u_transformGrid)),e.fragment.uniforms.add(new Di("u_transformSpacing",t=>t.common.u_transformSpacing)),e.fragment.uniforms.add(new Di("u_transformGridSize",t=>t.common.u_transformGridSize)),e.fragment.uniforms.add(new Di("u_targetImageSize",t=>t.common.u_targetImageSize)),e.fragment.code.add(E`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)}class yIe extends Nn{constructor(){super(...arguments),this.scale=1,this.offset=Sp}}function vIe(e){e.attributes.add(P.POSITION,"vec2"),e.attributes.add(P.UV0,"vec2"),e.vertex.uniforms.add(new lt("scale",t=>t.scale)),e.vertex.uniforms.add(new Di("offset",t=>t.offset)),e.varyings.add("uv","vec2"),e.varyings.add("vuv","vec2"),e.vertex.code.add(E`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}class uTt extends yIe{constructor(t,i,r){super(),this.common=t,this.u_image=i,this.u_transformGrid=r}}function hTt(e){e.include(cTt),e.fragment.uniforms.add([new oi("u_image",t=>t.u_image),new ES("u_flipY",t=>t.common.u_flipY),new ES("u_applyTransform",t=>t.common.u_applyTransform)]),e.fragment.code.add(E`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}function qre(e){e.code.add(E`
    float lineFactorAtPosition(float value) {
      float pos = value * ${E.float(257)};
      if(pos < 0.5 || pos > ${E.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec4 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec4(vec3(1.0, 0.972, 0.918) * line, 1.0);
    }`)}var Ba;(function(e){e[e.LayerOnly=0]="LayerOnly",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.COUNT=3]="COUNT"})(Ba||(Ba={}));function _Ie(e,t){const i=t.blendMode;i!==qe.Normal&&(i===qe.Reflect&&e.code.add(E`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==qe.ColorDodge&&i!==qe.VividLight||e.code.add(E`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==qe.ColorBurn&&i!==qe.VividLight||e.code.add(E`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===qe.Overlay&&e.code.add(E`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===qe.HardLight&&e.code.add(E`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===qe.SoftLight&&e.code.add(E`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===qe.VividLight&&e.code.add(E`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==qe.Hue&&i!==qe.Saturation&&i!==qe.Color&&i!==qe.Luminosity||(e.code.add(E`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==qe.Hue&&i!==qe.Saturation||e.code.add(E`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),e.code.add(E`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===qe.Multiply?E`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===qe.Average?E`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===qe.Lighten?E`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===qe.Darken?E`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===qe.Lighter?E`return vec4(cl * ol + cb * ob, ol + ob);`:i===qe.Plus?E`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===qe.Minus?E`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===qe.Screen?E`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===qe.Difference?E`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===qe.Invert?E`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===qe.DestinationOver?E`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===qe.DestinationAtop?E`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===qe.DestinationOut?E`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===qe.SourceAtop?E`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===qe.SourceOut?E`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===qe.Xor?E`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===qe.DestinationIn?E`return vec4(cb * ob * ol, ol * ob);`:i===qe.SourceIn?E`return vec4(cl * ol * ob, ol * ob);`:i===qe.Hue?E`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===qe.Saturation?E`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===qe.Color?E`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===qe.Luminosity?E`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===qe.Exclusion?E`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===qe.Reflect?E`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===qe.ColorDodge?E`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===qe.ColorBurn?E`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===qe.Overlay?E`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===qe.SoftLight?E`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===qe.HardLight?E`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===qe.VividLight?E`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:E``}
    }
  `))}var ma,lo;function dTt(e){const t=new mr,i=e.output===ma.GridOnly,r=e.output===ma.GridComposite,s=r||i,n=e.output===ma.ColorOnly,o=e.output===ma.ColorComposite,a=o||n,l=r||o;if(t.include(vIe),a&&t.fragment.uniforms.add(new Dt("backgroundColor",m=>m.backgroundColor)),e.baseOpacityMode!==lo.One&&t.fragment.uniforms.add(new lt("baseOpacity",m=>m.baseOpacity)),s&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(qre)),i||n)return t.fragment.code.add(E`
    void main() {
      gl_FragColor = ${n?E`vec4(backgroundColor, 1.0)`:E`gridColor(uv)`};
    }
  `),t;const c=e.blendMode!==qe.Normal,h=e.baseOpacityMode===lo.OnBaseLayer,p=e.baseOpacityMode===lo.OnBackground||e.baseOpacityMode===lo.OnBaseLayer,f=e.premultipliedSource;return t.fragment.uniforms.add(new oi("tex",m=>m.texture)),t.fragment.uniforms.add(new lt("opacity",m=>m.opacity)),(c||h||f)&&(t.fragment.uniforms.add(new oi("fboColor",m=>m.fboTexture)),t.fragment.uniforms.add(new lt("tileSize",m=>_(m.fboTexture)?m.fboTexture.descriptor.width:1))),t.fragment.include(_Ie,e),t.fragment.code.add(E`
    void main() {
      ${l||h||f?E`
      vec4 bgColor = ${o?E`vec4(backgroundColor, 1.0)`:r?E`gridColor(uv)`:E`texture2D(fboColor, gl_FragCoord.xy / tileSize)`};
      ${p?E`bgColor *= baseOpacity;`:""}`:""}
      vec4 colorLayer = texture2D(tex, uv);
      ${c?E`
          vec4 fboTex = ${l?E`bgColor;`:E`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${h?" * baseOpacity":""};`}
          vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
          gl_FragColor = applyBlendMode(colorLayer.rgb, colorLayer.a * opacity, Cb, fboTex.a);`:E`
          vec4 pmColorLayer = vec4(colorLayer.xyz, 1.0);
          float composeAlpha = colorLayer.a * opacity;
          gl_FragColor = ${f?E`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`:l||h?E`mix(bgColor, pmColorLayer, composeAlpha);`:E`pmColorLayer * composeAlpha;`}`}
    }
  `),t}(function(e){e[e.Composite=0]="Composite",e[e.ColorOnly=1]="ColorOnly",e[e.GridOnly=2]="GridOnly",e[e.ColorComposite=3]="ColorComposite",e[e.GridComposite=4]="GridComposite",e[e.COUNT=5]="COUNT"})(ma||(ma={})),function(e){e[e.One=0]="One",e[e.OnBackground=1]="OnBackground",e[e.OnBaseLayer=2]="OnBaseLayer",e[e.COUNT=3]="COUNT"}(lo||(lo={}));const pTt=Object.freeze(Object.defineProperty({__proto__:null,get BlendLayersOutput(){return ma},get BaseOpacityMode(){return lo},build:dTt},Symbol.toStringTag,{value:"Module"}));class v8 extends uTt{constructor(t,i,r,s,n,o){super(t,s,n),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=Hl,this.fboTexture=null,this.baseOpacity=1}}class fTt extends v8{}class mTt extends v8{}function gTt(e){const t=new mr;t.include(vIe),t.include(hTt),t.include(lTt),e.tileBlendInput===Ba.GridComposite&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(qre));const i=e.tileBlendInput===Ba.ColorComposite;i&&t.fragment.uniforms.add(new Dt("backgroundColor",a=>a.backgroundColor)),e.baseOpacityMode!==lo.One&&t.fragment.uniforms.add(new lt("baseOpacity",a=>a.baseOpacity));const r=e.baseOpacityMode===lo.OnBaseLayer,s=e.baseOpacityMode===lo.OnBackground||e.baseOpacityMode===lo.OnBaseLayer,n=e.blendMode!==qe.Normal;t.fragment.include(_Ie,e);const o=e.tileBlendInput!==Ba.LayerOnly;return(n&&!o||r)&&(t.fragment.uniforms.add(new oi("fboColor",a=>a.fboTexture)),t.fragment.uniforms.add(new lt("tileSize",a=>_(a.fboTexture)?a.fboTexture.descriptor.width:1))),t.fragment.code.add(E`
    vec4 applyBackgroundBlend(vec4 layerColor) {
      ${o||r?E`
          vec4 bgColor = ${r?E`texture2D(fboColor, gl_FragCoord.xy / tileSize)`:i?E`vec4(backgroundColor, 1.0)`:E`gridColor(vuv)`};
          ${s?E`bgColor *= baseOpacity;`:""}`:""}
      ${n?E`
            vec3 pmColorLayer = layerColor.rgb * layerColor.a;
            vec4 fboTex = ${o?E`bgColor;`:E`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${r?" * baseOpacity":""};`}
            vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
            return applyBlendMode(pmColorLayer.rgb, layerColor.a * u_opacity, Cb, fboTex.a);`:o||r?E`
            float composeAlpha = layerColor.a * u_opacity;
            vec4 pmColorLayer = vec4(layerColor.rgb, 1.0);
            return mix(bgColor, pmColorLayer, composeAlpha);`:E`
            return layerColor * layerColor.a * u_opacity;`}
    }
  `),e.colorizerType===iS.Stretch?vTt(t,e):e.colorizerType===iS.Lut?yTt(t):e.colorizerType===iS.Hillshade&&_Tt(t,e),t}function yTt(e){e.fragment.code.add(E`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function vTt(e,t){e.fragment.uniforms.add([new JL("u_bandCount",r=>r.symbolizer.u_bandCount),new ol("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new ol("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new ol("u_factor",r=>r.symbolizer.u_factor,3),new lt("u_minOutput",r=>r.symbolizer.u_minOutput),new lt("u_maxOutput",r=>r.symbolizer.u_maxOutput),new ES("u_useGamma",r=>r.symbolizer.u_useGamma),new ol("u_gamma",r=>r.symbolizer.u_gamma,3),new ol("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new lt("u_opacity",r=>r.common.u_opacity)]),e.fragment.code.add(E`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=t.applyColormap?E`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:E`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;e.fragment.code.add(E`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${t.stretchType===zS.Noop?E`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:E`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function _Tt(e,t){const i=e.fragment;i.uniforms.add([new oi("u_image",s=>s.u_image),new JL("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new ol("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new ol("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new ol("u_cosZs",s=>s.symbolizer.u_cosZs,6),new ol("u_weights",s=>s.symbolizer.u_weights,6),new Di("u_factor",s=>s.symbolizer.u_factor),new lt("u_minValue",s=>s.symbolizer.u_minValue),new lt("u_maxValue",s=>s.symbolizer.u_maxValue),new Di("u_srcImageSize",s=>s.common.u_srcImageSize)]),i.include(gy),i.code.add(E`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec3 hsv = rgb2hsv(colormap(vec4(val, val, val, 1.0), false).rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),i.code.add(E`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=t.applyColormap?E`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:E`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(E`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const bTt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerUniforms:v8,ColorizerStretchUniforms:fTt,ColorizerHillshadeUniforms:mTt,build:gTt},Symbol.toStringTag,{value:"Module"}));function wTt(e,t,i="nearest",r=!1){var c;const s=!(r&&t.pixelType==="u8"),n=s?kt.FLOAT:kt.UNSIGNED_BYTE,o=t.pixels==null||t.pixels.length===0?null:s?t.getAsRGBAFloat():t.getAsRGBA(),a=(c=e.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l={width:t.width,height:t.height,target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,internalFormat:e.type===Ii.WEBGL2&&s?Mt.RGBA32F:Qe.RGBA,samplingMode:!a||i!=="bilinear"&&i!=="cubic"?gt.NEAREST:gt.LINEAR,dataType:n,wrapMode:$t.CLAMP_TO_EDGE,flipped:!1};return new _t(e,l,o)}function xTt(e,t){const{spacing:i,offsets:r,coefficients:s,size:[n,o]}=t,a=i[0]>1,l={width:a?4*n:n,height:o,target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,internalFormat:e.type===Ii.WEBGL2?Mt.RGBA32F:Qe.RGBA,dataType:kt.FLOAT,samplingMode:gt.NEAREST,wrapMode:$t.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(a?n*o*16:2*r.length);if(a)for(let h=0,p=0;h<s.length;h++)c[p++]=s[h],h%3==2&&(c[p++]=1);else for(let h=0;h<o;h++)for(let p=0;p<n;p++){const f=4*(h*n+p),m=2*(p*o+h);c[f]=r[m],c[f+1]=r[m+1],c[f+3]=r[m]===-1?0:1}return new _t(e,l,c)}function dme(e,t){const i={width:t.length/4,height:1,target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,internalFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:gt.NEAREST,wrapMode:$t.CLAMP_TO_EDGE,flipped:!1};return new _t(e,i,t)}function TTt(e,t,i,r=1,s=!0){return{u_flipY:s,u_applyTransform:!!e,u_opacity:r,u_transformSpacing:e?e.spacing:Sp,u_transformGridSize:e?e.size:Sp,u_targetImageSize:t,u_srcImageSize:i}}function STt(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function ETt(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function CTt(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}const pme={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class ATt{constructor(t,i,r=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=t,this.source=i,this.width=r||i.width,this.height=s||i.height}get source(){return this._source}set source(t){this._source=t,this._rasterTexture=ht(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?me(F({},pme),{maxCutOff:[1,1,1],factor:[1,1,1]}):this._symbolizerParameters||pme}set symbolizerParameters(t){this._symbolizerParameters=t}get bandIds(){return this._bandIds}set bandIds(t){_(t)&&t.length>0?this._bandIds&&t.every((i,r)=>!!this._bandIds[r]&&i===this._bandIds[r])||(this._bandIds=t,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(t){if(this._interpolation=t,_(this._rasterTexture)){const i=this._getRasterTextureInterpolation(t);this._rasterTexture.setSamplingMode(i==="bilinear"?gt.LINEAR:gt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(t){this._transformGrid=t,this._transformGridTexture=ht(this._transformGridTexture),this._memoryUsed=null}bind(t){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((M(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(t,this.bandIds),_(this._rasterTexture)&&(this._updateColormapTexture(t),this.transformGrid&&M(this._transformGridTexture)&&(this._transformGridTexture=xTt(t,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:t,transformGrid:i,width:r,height:s,opacity:n}=this,o=TTt(i,[r,s],[this.source.width,this.source.height],n),a=STt(t.colormap,t.colormapOffset),l=this.symbolizerParameters.type==="stretch"?ETt(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?CTt(this.symbolizerParameters):null;return new v8(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(M(this._memoryUsed)){const t=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=t.map(i=>_(i)?i.descriptor.width*i.descriptor.height*4:0).reduce((i,r)=>i+r,0)}return this._memoryUsed}release(){return this._rasterTexture=ht(this._rasterTexture),this._transformGridTexture=ht(this._transformGridTexture),this._colormapTexture=ht(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(t,i){const r=this.source?this.source.extractBands(i):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture=ht(this._rasterTexture));const s=M(i)&&M(this.bandIds)||_(i)&&_(this.bandIds)&&i.join("")===this.bandIds.join("");if(_(this._rasterTexture)&&s)return;this._rasterTexture=ht(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=wTt(t,r,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(t){return this.symbolizerParameters.type==="lut"||t==="nearest"||t==="majority"?"nearest":"bilinear"}_updateColormapTexture(t){const i=this._colormap,r=this.symbolizerParameters.colormap;return r?i?r.length!==i.length||r.some((s,n)=>s!==i[n])?(this._colormapTexture=ht(this._colormapTexture),this._colormapTexture=dme(t,r),void(this._colormap=r)):void 0:(this._colormapTexture=dme(t,r),void(this._colormap=r)):(this._colormapTexture=ht(this._colormapTexture),void(this._colormap=null))}}class Sk{constructor(){this.waitingAgents=new ai,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(t){const i=B7.acquire();return i._init(t),i}release(){this.dispose(),Ek.delete(this),B7.release(this)}dispose(){this.loadingAgent=ht(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=xA(this._data)}static prune(){B7.prune(0)}_init(t){this.waitingAgents.clear(),this._data=xA(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=t,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Wn(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){_(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(t,i){if(t===i||M(i))this._unsetUpsampleInfo();else{if(M(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),sTt(t,i,this._upsampleInfo)}}get data(){return this._data}set data(t){xA(this._data),this._data=t}}const B7=new un(Sk,null,()=>{}),Ek=new Map;function MTt(){Ek.size>0&&(console.log(`${Ek.size} live TilePerLayerInfo allocations:`),Ek.forEach(e=>console.log(e,`
`)))}class mC{constructor(t){this._texture=t,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}}var It;(function(e){e[e.NONE=0]="NONE",e[e.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",e[e.SPLIT=2]="SPLIT",e[e.VSPLITMERGE=4]="VSPLITMERGE",e[e.MERGE=8]="MERGE",e[e.RENDERDATA=16]="RENDERDATA",e[e.GEOMETRY=32]="GEOMETRY",e[e.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",e[e.TEXTURE_FADING=128]="TEXTURE_FADING"})(It||(It={}));const G7=$(),hE=$(),Xo=$(),OTt=.1;class RTt{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}class Wre{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this._dirty=!0,this._previouslyRendered=!1,this.extent=Qt(),this._elevationBounds=Ke(),this.layerInfo=[[],[]],this.extentInRadians=Qt(),this.centerAtSeaLevel=$(),this._center=[$(),fo(),$()],this.up=bQ(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemory=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0}static prune(){Zre.prune(0),Xre.prune(0),Sk.prune()}get isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Dl.MIDDLE][3]}get screenDepth(){return this._screenDepth}get visible(){return this._dirty&&this.computeVisibility(),this._visible}computeVisibility(){this._dirty=!1;const t=this._intersectsClippingArea&&this._isVisible(this.surface.frustum);return t!==this._visible&&(this._visible=t,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension()),this._visible}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const t=!!this.renderData;return t!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=t,this._surface.renderer.setNeedsRender()),t}get shouldLoad(){if(!this.loadable)return!1;if(this._surface.lodSnapping===LM.ON){const t=this.level-this._surface.snapLevel;if(t===0)return!0;if(t===1)return!1}return this.isLeaf}init(t,i,r){this.lij[0]=t[0],this.lij[1]=t[1],this.lij[2]=t[2],this.ellipsoid=Ri(r.tilingScheme.spatialReference),r.tilingScheme.getExtent(t[0],t[1],t[2],this.extent),r.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,r.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Dl.MIDDLE][3]=0,this.vlevel=t?t[0]:0,i&&i.elevationBounds?po(this._elevationBounds,i.elevationBounds):Li(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=i,this.unsetChildren(),this._surface=r,this.updateVisibility();for(const s of Dx){const n=r.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=Sk.acquire(this._surface.upsampleInfoPool),s===gi.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(r.tilingScheme.pixelSize,aY)}release(){_g(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const t of Dx){for(const i of this.layerInfo[t])i.release();this.layerInfo[t].length=0}this._parent=null,this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this.isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this.isCached){this.setMemoryDirty();const t=this.cachedMemory;t>0&&this._surface.upsampleMapCache.put(this.key,this,t)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this.isCached?0:this._mapTileMemory)}get cachedMemory(){return this.isCached?this.mapTileMemory:0}get mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[gi.MAP].reduce((t,i)=>t+(i instanceof d3?i.memoryUsage:0),this._mapTileMemory)}get cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(_(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemory=0;let t=0;for(const{data:r}of this.layerInfo[gi.MAP])r instanceof d3?t+=this._getTerrainDataMemory(r):this._mapTileMemory+=this._getTerrainDataMemory(r);const i=this.cpuImageMemorySize;for(const r of this.layerInfo[gi.ELEVATION])this._usedMemory+=r.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=SS(this.renderData.textureDescriptor)),this.isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemory+t),this._usedMemory}getUsedMemoryForLayer(t,i){const r=this.layerInfo[t][i];return(r==null?void 0:r.data)?t===gi.MAP?this.isCached?0:this._getTerrainDataMemory(r.data):t===gi.ELEVATION?this.cpuImageMemorySize:0:0}_getTerrainDataMemory(t){return t instanceof mC?SS(t.texture):t instanceof HTMLImageElement||t instanceof f8?this.cpuImageMemorySize:t instanceof d3||t instanceof ATt?t.memoryUsage:0}updateScreenDepth(t){const i=this._center[Dl.MIDDLE],r=t,s=i[0],n=i[1],o=i[2],a=r[2]*s+r[6]*n+r[10]*o+r[14];this._screenDepth=a<0?0:a/(r[3]*s+r[7]*n+r[11]*o+r[15])}shouldSplit(t,i,r){if(_(t.frustum)&&(!this._intersectsClippingArea||!this._isVisible(t.frustum)))return It.NONE;const s=this.level;xe(G7,this._center[Dl.MIDDLE],i);let n=Vl(G7),o=Dl.MIDDLE;xe(hE,this._center[Dl.TOP],i);const a=Vl(hE);a<n&&(n=a,o=Dl.TOP),xe(hE,this._center[Dl.BOTTOM],i);const l=Vl(hE);if(l<n&&(n=l,o=Dl.BOTTOM),this._edgeLen2>n&&s<t.maxLod)return It.SPLIT;const c=Math.sqrt(n),h=t.fovX*c*2,p=this._edgeLen/h,f=()=>{const x=s+Math.ceil(-Math.log2(t.relativeWidthLimit/p));return x!==this.vlevel?(this.vlevel=x,It.VSPLITMERGE):It.NONE_HIT_MAXLOD};if(r===LM.ON&&this._surface.snapLevel-s===1)return s>=t.maxLod?f():It.SPLIT;const m=Pe(this.up,G7),g=this._elevationBounds[1]-this._elevationBounds[0],y=g/this.edgeLen;if(t.aboveGround&&m>0&&y<.001&&m/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-y>0)return It.NONE;if(p<t.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,It.VSPLITMERGE):It.NONE;if(s>=t.maxLod)return f();if(s>6){xe(hE,this._center[o],i),fe(Xo,this.up,m),xe(Xo,Xo,hE);const x=Vl(Xo);if(x>this.radius*this.radius){fe(Xo,Xo,this.radius/Math.sqrt(x)),we(Xo,Xo,this._center[o]),xe(Xo,i,Xo);const b=Math.min(1,(Math.abs(Pe(Xo,this.up))+.5*g+this._curvatureHeight)/Ue(Xo)),S=OTt/t.angledSplitBias,T=t.fovY*c*2;if(b*(this._edgeLen/T)<S*t.relativeHeightLimit)return It.NONE}}return It.SPLIT}setChildren(t,i,r,s){_g(!!(t&&i&&r&&s),"Null child passed"),this._children[0]=t,this._children[1]=i,this._children[2]=r,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var t,i;return(i=(t=this.renderData)==null?void 0:t.hasGeometry)!=null?i:!1}prepareToLoad(t){this.refMapData();for(const i of Dx)this._createOrUpdateAgents(0,i);t.updateTileGeometryState(this)}load(t){this.prepareToLoad(t),this.loadPrepared(t)}loadPrepared(t){t.loadTile(this)}unload(t){t.unloadTile(this);for(const i of Dx){const r=this.layerInfo[i];for(const s of r)s.loadingAgent&&s.loadingAgent!==Kc&&(ZF(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(It.GEOMETRY),this.resetPendingUpdate(It.TEXTURE_NOFADING),this.resetPendingUpdate(It.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const t=this.layerInfo[gi.MAP];for(const i of t)i.loadingAgent&&i.loadingAgent!==Kc&&(ZF(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(t){if(jT(t,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;_(t)?(this._intersectsClippingArea=this.intersectsExtent(t),this._isWithinClippingArea=this._isWithinExtent(t)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=t,this.updateVisibility();const s=r&&this._isWithinClippingArea,n=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(It.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(t,i){return this.layerInfo[i][t]}hasLayerData(t,i){const r=this.layerInfo[i][t];return!(!r||!r.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const t of Dx){const i=this.layerInfo[t];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==Kc&&r.loadingAgent.updating)return!0}return!1}_isSuspended(t){return!!this.hasPendingUpdate(It.SPLIT)||t!==gi.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(t){return(this._pendingUpdates&t)===t}setPendingUpdate(t){this._pendingUpdates|=t,t===It.SPLIT||t===It.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(t){return!!this.hasPendingUpdate(t)&&(this._pendingUpdates&=~t,!0)}requestLayerData(t,i,r){const s=this.layerInfo[i][t];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,t),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,t),r.dataArrived(this),!0;if(s.requestPromise)return!0;Wn(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,t,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(t){return this.lij[0]===t[0]&&this.lij[1]===t[1]&&this.lij[2]===t[2]}findByLij(t){return this.hasLij(t)?this:this.isLeaf?null:this._children[0].findByLij(t)||this._children[1].findByLij(t)||this._children[2].findByLij(t)||this._children[3].findByLij(t)||null}distanceToSquared(t){return Vl(xe(Xo,this._center[Dl.MIDDLE],t))}containsPoint(t){const i=this.extent;return t[0]>=i[0]&&t[1]>=i[1]&&t[0]<=i[2]&&t[1]<=i[3]}unrequestLayerData(t,i,r){const s=this.layerInfo[i][t],n=s.waitingAgents,o=n.removeUnordered(r)!=null;_g(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(t,i,r){const s=this.layerInfo[i][t];s.data=r,s.dataInvalidated=!1,s.waitingAgents.forAll(n=>n.dataArrived(this)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(t,i,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${i}/${t} error ${r}`);const s=this.layerInfo[i][t];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(t,i){switch(t){case gi.MAP:return this._updateTexture(i);case gi.ELEVATION:return this._updateGeometry()}}_updateTexture(t){this.renderData&&(this.resetPendingUpdate(t===No.FADING?It.TEXTURE_NOFADING:It.TEXTURE_FADING),this.setPendingUpdate(t===No.FADING?It.TEXTURE_FADING:It.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(It.GEOMETRY);for(const t of this.layerInfo[gi.ELEVATION])t.pendingUpdates|=It.GEOMETRY}invalidateLayerData(t,i){this.layerInfo[i][t].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const t=this._elevationBounds;Li(t,Number.MAX_VALUE,-Number.MAX_VALUE);const i=this.layerInfo[gi.ELEVATION];let r=!0;for(const s of i)_(s.elevationBounds)&&(t[0]=Math.min(t[0],s.elevationBounds.min),t[1]=Math.max(t[1],s.elevationBounds.max),s.elevationBounds.hasNoDataValues||(r=!1));r&&(t[0]=Math.min(t[0],0),t[1]=Math.max(t[1],0)),this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const t=this._elevationBounds,i=.5*(t[0]+t[1]);fe(Xo,this.up,i),we(this._center[Dl.MIDDLE],this.centerAtSeaLevel,Xo),fe(Xo,this.up,t[0]),we(this._center[Dl.TOP],this.centerAtSeaLevel,Xo),fe(Xo,this.up,t[1]),we(this._center[Dl.BOTTOM],this.centerAtSeaLevel,Xo)}findElevationBoundsForLayer(t,i){const r=this.layerInfo[gi.ELEVATION][t];if(_(r.elevationBounds)&&r.elevationBounds.level>=i)return;const s=this._surface.layerViewByIndex(t,gi.ELEVATION),n=_J(s);if(!p3(this,n,!1))return;const o=ITt;let a=!1;if(r.data){const l=r.data;o.min=l.bounds[0],o.max=l.bounds[1],o.hasNoDataValues=l.hasNoDataValues,o.level=this.level,a=!0}else{let l,c,h=0;for(let p=this._parent;p&&(!c||h<H5(this.level))&&(h=this.vlevel-p.level,l=c||l,c=p.layerInfo[gi.ELEVATION][t].data,!(!c&&l&&h>=H5(this.level)));p=p.parent);c=c||l,c&&(c.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],o),o.min!==1/0&&(o.level=c.level,a=!0))}a&&(M(r.elevationBounds)&&(r.elevationBounds=new Gre),r.elevationBounds.copyFrom(o))}modifyLayers(t,i,r){const s=this.layerInfo[r];for(const a of s)a.loadingAgent&&a.loadingAgent!==Kc&&(ZF(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)t[a]===void 0&&s[a].release();const n=new Array(...s),o=i.length;s.length=o;for(let a=0;a<o;a++){const l=i[a];s[a]=l>-1?n[l]:Sk.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(t){this.renderData&&(this._createOrUpdateAgents(0,t),this.updateRenderData(t,No.FADING))}updateAgents(t){if(this.renderData){const i=this.layerInfo[t];for(const r of i)r.loadingAgent===Kc&&(r.loadingAgent=null);this._createOrUpdateAgents(0,t)}}updateAgentSuspension(){for(const t of Dx){const i=this._isSuspended(t);for(const r of this.layerInfo[t])r.loadingAgent&&r.loadingAgent!==Kc&&(r.loadingAgent.setSuspension(i),r.loadingAgent===Kc&&this.updateRenderData(t,No.FADING))}}removeLayerAgent(t,i){const r=this.layerInfo[i][t];r.loadingAgent&&r.loadingAgent!==Kc&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(t,i){const r=this.layerInfo[i][t];r.loadingAgent=Kc,!r.data&&M(r.upsampleInfo)&&this._createOrUpdateAgents(t+1,i)}_createOrUpdateAgents(t,i){const r=this.layerInfo[i];if(r.length===0)return;const s=(()=>{for(let o=t;o<r.length;++o){const a=this._surface.layerViewByIndex(o,i);if(dV(a)&&a.layer.blendMode!=="normal")return!0}return!1})(),n=this._isSuspended(i);for(let o=t;o<r.length;++o){const a=r[o];let l=!1;const c=this._surface.layerViewByIndex(o,i),h=_J(c);if(a.loadingAgent?p3(this,h,!1)?(a.loadingAgent!==Kc&&a.loadingAgent.setSuspension(n),a.loadingAgent!==Kc&&(l=a.loadingAgent.update())):a.dispose():p3(this,h,!1)&&(a.loadingAgent=PTt(this,o,i,n),l=a.loadingAgent.startLoading(),l?a.loadingAgent===Kc&&this.setPendingUpdate(It.GEOMETRY):(ZF(a.loadingAgent),a.loadingAgent=Kc)),a.loadingAgent===Kc&&this.updateRenderData(i,No.FADING),!s&&l&&c.isOpaque)return}}_isWithinExtent(t){const i=this.extent;return i[0]>=t[0]&&t[2]>=i[2]&&i[1]>=t[1]&&t[3]>=i[3]}intersectsExtent(t){const i=this.extent;return i[2]>=t[0]&&t[2]>=i[0]&&i[3]>=t[1]&&t[3]>=i[1]}getElevationBasedVerticesPerSide(t){const i=this.vlevel-this.level,r=Math.max(this.level-t,H5(this.level)-i);return He(1+(this.maxTesselation>>r),2,this.maxTesselation+1)}get test(){return{cachedMemory:this.cachedMemory}}_findLIJ(t,i){if(!t)return null;const r=this.surface.rootTiles;if(_(r)){for(const s of r)if($Tt(s,t)){let n=s,o=t[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!i(n);){const a=t[1]>>o&1,l=t[2]>>o&1;n=n.children[2*a+l],o--}return i(n)?n:null}}return null}findNeighborTile(t,i){const r=this.lij,s=this.getNeighborLIJ(r,t);return s?LTt(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(t,i){const r=t===ii.NORTH_EAST?1:t===ii.NORTH_WEST?0:t===ii.SOUTH_WEST?2:3;let s=this;for(;!(s.isLeaf||i&&i(s));)s=s.children[r];return s}findNeighborCornerTileExact(t,i){var r;return(r=this.findNeighborTile(t,s=>i(s)||s.level===this.level))==null?void 0:r.findCorner(pV(t),i)}forAllSubtreeOnSide(t,i){const r=t===ii.NORTH?[0,1]:t===ii.NORTH_EAST?[1]:t===ii.EAST?[1,3]:t===ii.SOUTH_EAST?[3]:t===ii.SOUTH?[2,3]:t===ii.SOUTH_WEST?[2]:t===ii.WEST?[0,2]:[0],s=n=>{i(n)||n.isLeaf||r.forEach(o=>s(n.children[o]))};s(this)}forallNeighbors(t){fV.forEach(i=>this.findNeighborCornerTileExact(i,t)),z1.forEach(i=>{var r;return(r=this.findNeighborTile(i,s=>s.level===this.level||t(s)))==null?void 0:r.forAllSubtreeOnSide(xk(i),t)})}getNeighborEdgeStartVertexIndex(t,i){const r=i!=null?i:this.findNeighborTile(z1[t],h=>h.isLoaded);if(!r||!this.isLoaded||!r.isLoaded)return 0;const s=this.level-r.level;if(s===0)return 0;const n=2**s,o=(1&t)==1,a=o?0:1,l=r.lij[a+1]*n,c=this.lij[a+1]-l;return o?n-1-c:c}_updateNeighborsWithChangedEdgeResolution(){for(let t=0;t<4;++t)if(this.renderData.geometryState.neighborData.modifiedEdgeResolutions[t]){const i=z1[t],r=this.findNeighborTile(i,s=>s.isLoaded||s.level===this.level);if(!r)continue;if(!r.isLoaded){r.isLeaf;const s=(t+2)%4,n=xk(i);r.forAllSubtreeOnSide(n,o=>o.isLoaded?(o.updateEdgeAfterResolutionChange(s),!0):(o.isLeaf,!1))}this.renderData.geometryState.neighborData.modifiedEdgeResolutions[t]=!1}}updateNeighborDataAndGeometryIfNeeded(){this.isLoaded&&this.renderData.updateNeighborDataAndGeometryIfNeeded()}updateNeighborsAfterGeometryChange(t=this.level){this.forEachLoadedNeighbor(i=>this._updateNeighbor(i)),z1.forEach(i=>{var r;(r=this.findNeighborTile(i,s=>s.isLoaded&&s.level<t))==null||r.updateNeighborsWithChangedEdgeResolution()})}updateNeighborsWithChangedEdgeResolution(){this.isLoaded&&this._updateNeighborsWithChangedEdgeResolution()}updateEdgeAfterResolutionChange(t){this.renderData.updateEdgeAfterResolutionChange(t)}forEachLoadedNeighbor(t){const i=this.level,r=s=>s.level===i||s.isLoaded;z1.forEach((s,n)=>{var l,c;const o=this.findNeighborTile(s,r);o!=null&&o!==this&&o.forAllSubtreeOnSide(xk(s),h=>!!h.isLoaded&&(t(h),!0));const a=(c=(l=this.renderData)==null?void 0:l.geometryState)==null?void 0:c.neighborData;a&&(a.modifiedEdgeResolutions[n]=!1)}),fV.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,r))==null?void 0:o.findCorner(pV(s),a=>a.isLoaded);!n||DTt(this,n,s),(n==null?void 0:n.isLoaded)&&t(n)})}_updateNeighbor(t){(t==null?void 0:t.isLoaded)&&t.updateNeighborDataAndGeometryIfNeeded()}getNeighborLIJ(t,i){const r=Kfe(i)?-1:Qfe(i)?1:0,s=Yfe(i)?-1:Jfe(i)?1:0,n=[t[0],t[1]+r,t[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(t){return!t||t[1]<0||t[1]>=2**t[0]?null:this.surface.wrapEastWest(t)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+Ut>=this.surface.extent[1]}compareLIJs(t){const i=this.lij,r=i[0],s=t[0];if(r===s)return[i,t];const n=r-s;if(n<0){const o=2**-n;return[[s,i[1]*o,i[2]*o],t]}{const o=2**n;return[i,[r,t[1]*o,t[2]*o]]}}checkGeometryWaterproofness(){}shouldHaveNeighbor(t){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(Kfe(t)&&i[3]+s>=r[3]||Qfe(t)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&Yfe(t)&&i[0]-s<=r[0])&&!(!n&&Jfe(t)&&i[2]+s>=r[2])}}function PTt(e,t,i,r){const s=i===gi.ELEVATION?Xre.acquire():Zre.acquire();return s.init(e,t,i,r),s}function ZF(e){e.dispose(),e instanceof mIe?Xre.release(e):e instanceof gIe&&Zre.release(e)}const Zre=new un(gIe),Xre=new un(mIe),ITt=new Gre;var Dl;function $Tt(e,t){const i=e.level,r=t[0];if(i>r)return!1;const s=r-i,n=Math.floor(t[1]/2**s),o=Math.floor(t[2]/2**s);return n===e.lij[1]&&o===e.lij[2]}function LTt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function j7(e,t,i){return Math.abs(e-t)<=i}function DTt(e,t,i){return!M(e)&&!M(t)&&t!==e&&(e.level>=t.level?fme(e,t,i):fme(t,e,pV(i)))}function fme(e,t,i){e.level>=t.level;const r=lxt(i),s=cxt(i),n=e.extent,o=t.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=j7(a[0],l[0],c)||e.surface.isGlobal&&j7(a[0],-l[0],c),p=j7(a[1],l[1],c);return h&&p?!0:e.level===t.level||!h&&!p?!1:h?mme(o[1],o[3],n[1],n[3],c):mme(o[0],o[2],n[0],n[2],c)}function mme(e,t,i,r,s=Ut){return e-s<=i&&i<=r&&r<=t+s}(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(Dl||(Dl={}));class NTt{constructor(){this._scales=[-1,-1,-1,-1],this._offsets=[-1,-1,-1,-1]}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(t,i,r){this._scales[2*t]=i,this._scales[2*t+1]=r}setOffset(t,i,r){this._offsets[2*t]=i,this._offsets[2*t+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}}class H0{constructor(){this.geometryInfo=new Xxt,this.intersectionData=null,this.geometryState=null,this._textureRef=new TA(()=>this.tile.surface.textureFadeDuration),this.overlay=new NTt,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get tile(){return this._tile}init(t){this._tile=t,this.clear();const i=this.geometryInfo;i.indices=null,i.vertexAttributes=null,Nr(i.boundingBox),i.indexCount=0,i.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new tTt,this.localOrigin=null,this.overlay.clear()}clear(){this._releaseGeometry(),this.releaseTexture(),this._textureRef.clear()}updateGeometryIfChanged(t,i){const r=this.updateGeometryStateAndPrepareForGeometryGeneration(i);return this._hasGeometry=!0,this.updateNeighborDataAndGeometryIfNeeded(r,t)}updateNeighborDataAndGeometryIfNeeded(t=!1,i=this.vao.context){const r=this._updateNeighborData(),s=t||this._geometryStateChangedSinceLastUpdate||r;return s&&(this._updateGeometry(i),this._geometryStateChangedSinceLastUpdate=!1),s}_calculateEdgeResolution(t,i){var c;const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const h=r.surface.extent;if(_(h)&&(t===0&&r.extent[3]>h[3]||t===1&&r.extent[2]>h[2]||t===2&&r.extent[1]<h[1]||t===3&&r.extent[0]<h[0]))return s}const n=r.level,o=z1[t],a=i||r.findNeighborTile(o,h=>h.isLoaded||h.level===n);if(!a||a.isLeaf&&!a.isLoaded)return M((c=r.surface)==null?void 0:c.rootTiles)||r.surface.updatingRootTiles||r.shouldHaveNeighbor(o),s;if(a.isLoaded){const h=a,p=h.renderData.geometryState,f=n-h.level;if(f===0){const y=p.numVerticesPerSide-1;return Math.max(y,s)}const m=2**f,g=p.neighborData.edgeResolutions[(t+2)%4]/m;return Math.max(1,g)}a.isLeaf;let l=s;return a.forAllSubtreeOnSide(xk(o),h=>h===r||(h.isLoaded?(l=Math.max(l,2**(h.level-n)),!0):(h.isLeaf,!1))),l}_updateNeighborData(){const t=this.tile,i=c=>c.isLoaded||c.level===t.level,r=c=>c.isLoaded,s=[null,null,null,null],n=[null,null,null,null];(()=>{for(let c=0;c<4;++c){const h=t.findNeighborTile(z1[c],i);s[c]=h,n[c]=(h==null?void 0:h.isLoaded)?h:null}})();const o=[null,null,null,null];(()=>{for(let c=0;c<4;++c)o[c]=t.findNeighborTile(fV[c],r)})();const a=this.geometryState.neighborData;let l=!1;return(()=>{for(let c=0;c<4;++c){const h=a.edgeResolutions[c],p=s[c],f=this._calculateEdgeResolution(c,p);a.edgeResolutions[c]=f,h!==f&&(l=!0,this._edgeResolutionChanged=!0,p&&p!==t&&!p.isLoaded&&p.level===t.level&&(a.modifiedEdgeResolutions[c]=!0))}})(),(()=>{const c=(f,m)=>{var b,S;const g=f.reduce((T,C)=>{var A;return Math.min(T,(A=C==null?void 0:C.level)!=null?A:1/0)},1/0);for(let T=0;T<4;++T){const C=f[(T+3)%4],A=f[T];if(C&&C.level<t.level&&C===A){const O=C,D=(1&T)==1,U=(t.getNeighborEdgeStartVertexIndex(T,O)+(m===0||m===1&&!D||m===3&&D?1:0))/2**(t.level-O.level),k=D?m===0||m===1?O.extent[0]:O.extent[2]:ui(O.extent[0],O.extent[2],U),B=D?ui(O.extent[1],O.extent[3],U):m===0||m===3?O.extent[1]:O.extent[3];return qr(k,B,O.renderData.geometryState.samplerData)}}let y=0,x=0;for(let T=0;T<4;++T){const C=f[T];if(C&&C.level===g){const A=T===0||T===1,O=T===0||T===3,D=C.extent;x+=qr(D[A?0:2],D[O?1:3],(S=(b=C.renderData)==null?void 0:b.geometryState)==null?void 0:S.samplerData),y++}}return y?x/y:0},h=a.cornerNeighborData,p=(f,m)=>{var b;const g=h[f],y=g.cornerTiles;for(let S=0;S<4;++S){const T=fV[S],C=(b=m[S])==null?void 0:b.findCorner(pV(T),A=>(A==null?void 0:A.isLoaded)||A===t);y[S]=C}const x=c(y,f);return g.elevation!==x&&(g.elevation=x,!0)};for(let f=0;f<4;++f){const m=o[f],g=n[f],y=[m,n[(f+1)%4],t,g],x=y.map((b,S)=>y[(S+4-f)%4]);p(f,x)&&(this._cornerElevationChanged=!0,l=!0)}})(),(()=>{var p;const c=(f,m)=>{if(!(f==null?void 0:f.isLoaded)||f.lij[0]>t.lij[0])return null;const g=f.renderData.geometryState;return{neighborSamplerData:g.samplerData,neighborEdgeOverlapResolution:g.neighborData.edgeResolutions[m+2],version:g.samplerDataVersion,neighborVerticesPerSide:g.numVerticesPerSide,neighborTile:f}},h=a.edgeNeighbours;for(let f=0;f<4;++f){const m=n[f];m&&(m==null||m.isLoaded,(m==null?void 0:m.lij[0])<=t.lij[0],void 0);const g=h[f],y=g==null?void 0:g.version,x=c(m,f),b=(p=x==null?void 0:x.version)!=null?p:null,S=g!=null!=(x!=null),T=g&&x&&y!==b,C=g&&x&&(g==null?void 0:g.neighborTile)!==(x==null?void 0:x.neighborTile),A=S||T||C;this._edgeNeighborChanged||(this._edgeNeighborChanged=A),l||(l=A),!A&&y||(h[f]=x)}})(),l}updateEdgeAfterResolutionChange(t){var n,o;const i=this._calculateEdgeResolution(t),r=this.geometryState.neighborData.edgeResolutions,s=r[t];((o=(n=this.geometryState.neighborData.edgeNeighbours[t])==null?void 0:n.neighborTile.level)!=null?o:0)<=this.tile.level,i!==s&&(r[t]=i,this._edgeResolutionChanged=!0,H0.deferTileNeighborUpdate?H0.neighborTilesToUpdate.add(this.tile):this._updateGeometry(this.vao.context))}_updateGeometry(t){this.intersectionData=null;const i=this.tile,r=i.lij,s=H0.updatedGeometryTiles.get(r)||0;H0.updatedGeometryTiles.set(r,s+1);const n=this._vao,o=this.geometryInfo.vertexAttributes,a=!n||!o||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._edgeResolutionChanged,l=!a&&this._edgeNeighborChanged,c=!l&&this._cornerElevationChanged;this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,a?(this._releaseGeometry(),this._createGeometry(t)):l?i.updateEdgeElevations():c?i.updateCornerElevations():console.warn("Update for no reason?")}releaseGeometry(){return this._releaseGeometry()}get hasGeometry(){return this._hasGeometry}ensureTexture(t,i){return _(this._texture)&&this._texture.descriptor.width!==t&&this.releaseTexture(),M(this._texture)&&(this._texture=i(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){_(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}updateGeometryStateAndPrepareForGeometryGeneration(t){const i=this._getElevationInfo(),r=i.samplerData?this.tile.getElevationBasedVerticesPerSide(i.maxTileLevel):this.tile.getDefaultVerticesPerRowOnLevel(),s=Math.max(r,5);let n=this.tile.clippingArea;this.tile.intersectsClippingArea&&!this.tile.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;return o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),i.changed&&(this._samplerDataChanged=!0,o.samplerData=i.samplerData,o.samplerDataVersion++,a=!0),wb(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0),o.wireframe!==t&&(this._wireframeChanged=!0,o.wireframe=t,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),this._hasGeometry=!0,a}_createGeometry(t){this.tile.createGeometry();const i=this.geometryInfo.vertexAttributes,r=this.geometryInfo.indices,s=t.gl;this._vao=new Ln(t,lr,{geometry:Xu(i.layout)},{geometry:Ci.createVertex(t,s.STATIC_DRAW,i.buffer)},Ci.createIndex(t,s.STATIC_DRAW,r)),this._hasGeometry=!0}_releaseGeometry(){return this._hasGeometry=!1,!!this._vao&&(this._vao.dispose(),this._vao=null,Qxt(this.geometryInfo),!0)}get vao(){return this._vao}setTextureReference(t,i=ov.Immediate){_(t)&&t.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(t,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const t=this.geometryState.samplerData,i=this.tile.layerInfo[gi.ELEVATION],r=i.length;let s=new Array(r),n=0,o=0,a=!1;for(let l=0;l<r;l++){const c=i[l];if(_(c.upsampleInfo)){const h=c.upsampleInfo.tile,p=h.layerInfo[gi.ELEVATION][l].data,f=p&&p.samplerData;t&&t[n]===f||(a=!0),s[n++]=f,o=Math.max(o,h.lij[0])}else if(c.data){const h=this.tile.surface.layerViewByIndex(l,gi.ELEVATION);if(p3(this.tile,h.layer,!1)){const p=c.data;t&&t[n]===p.samplerData||(a=!0),s[n++]=p.samplerData,o=this.tile.level}}}return _(t)&&t.length!==n&&(a=!0),n>0?s.length=n:s=null,{changed:a,samplerData:s,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){const t=Nh(this.intersectionData,0,i=>i.estimatedMemoryUsage);return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength+t}get textureDescriptor(){return _(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){}}H0.updatedGeometryTiles=new Map,H0.deferTileNeighborUpdate=!1,H0.neighborTilesToUpdate=new Set;const FTt=65536;function kTt(e,t){const i=e.tile,{extent:r,extentInRadians:s,surface:n}=i,o=e.localOrigin,a=e.geometryState,l=n.isWebMercator,c=n.shadingEnabled,h=a.numVerticesPerSide,p=h-1,f=(h-2)**2,m=l&&(t===rp.HAS_SOUTH_POLE||t===rp.HAS_BOTH_POLES),g=l&&(t===rp.HAS_NORTH_POLE||t===rp.HAS_BOTH_POLES),y=6,x=((m?1:0)+(g?1:0))*y*(p+1),b=a.neighborData,S=b.edgeResolutions.reduce((se,J)=>se+J+1,0),T=uIe(f+x+S),C=e.geometryInfo;C.numVerticesPerSide=a.numVerticesPerSide,C.vertexAttributes=T,_r(C.uvOffsetAndScale,0,0,1,1);const A=T.position.typedBuffer,O=T.uv0.typedBuffer,D=T.normal.typedBuffer,U=C.boundingBox;Nr(U);const k=o[0],B=o[1],j=o[2];Bw.update(p,s);let H=0;const K=a.samplerData,ee=i.ellipsoid.radius,ce=Jre(e),le=h-2,z=r[0],q=r[2],Z=r[1],Y=r[3];(()=>{for(let se=1;se<=le;se++){const J=se/p,ae=Z*(1-J)+Y*J,_e=ce(J),Oe=Math.cos(_e),Be=Math.sin(_e);for(let Se=1;Se<=le;Se++){const Te=Se/p,Ie=z*(1-Te)+q*Te,Ve=Bw.sinLonLUT[Se],Ni=Bw.cosLonLUT[Se],Fi=ee+qr(Ie,ae,K),hi=Ni*Oe*Fi-k,Vi=Ve*Oe*Fi-B,di=Be*Fi-j;av(hi,Vi,di,U);const ki=qd*H;A[ki+0]=hi,A[ki+1]=Vi,A[ki+2]=di,O[ki+0]=Te,O[ki+1]=J,++H}}})(),c&&(()=>{const se=Se=>(xe(lv,Se,H7),Tt(kM,lv,_b),Tt(UM,kM,lv),UM),J=T.position,ae=T.normal;H=0;const _e=Se=>{J.getVec(Se,Lu),we(Xs,Xs,se(Lu))},Oe=(Se,Te)=>{{const Ie=Se/p,Ve=z*(1-Ie)+q*Ie,Ni=Bw.sinLonLUT[Se],Fi=Bw.cosLonLUT[Se],hi=Te/p,Vi=Z*(1-hi)+Y*hi,di=ce(hi),ki=Math.cos(di),kr=Math.sin(di),us=ee+qr(Ve,Vi,K);he(Lu,Fi*ki*us-k,Ni*ki*us-B,kr*us-j)}we(Xs,Xs,se(Lu))},Be=(Se,Te,Ie)=>{Se>1&&Te>1&&Se<le&&Te<le?_e(H+Ie):Oe(Se,Te)};for(let Se=1;Se<=le;Se++)for(let Te=1;Te<=le;Te++)J.getVec(H,H7),we(Eg,H7,e.localOrigin),Re(_b,Eg),he(Xs,0,0,0),Be(Te-1,Se,-1),Be(Te+1,Se,1),Be(Te,Se-1,-le),Be(Te,Se+1,+le),Re(Xs,Xs),ae.setVec(H,Xs),++H})(),H=f,wIe(e,f),AIe(e),H=f+S;const te=[];(()=>{const se=(J,ae)=>{const _e=ae*h;av(-k,-B,J*ee-j,U),te.push({connectedRowOffset:_e,connectedOuterEdgeOffset:J===1?0:2,rowOffset:H,latitudeResolution:y});const Oe=OIe(J===-1?Z:Y,ee),Be=J*Math.PI/2-Oe,Se=.99*(J===1?1:-1),Te=ee+0;for(let Ie=1;Ie<=y;++Ie){const Ve=Oe+Be*(Ie/y),Ni=Math.cos(Ve),Fi=Math.sin(Ve);for(let hi=0;hi<=p;hi++){const Vi=hi/p,di=Bw.sinLonLUT[hi],ki=Bw.cosLonLUT[hi]*Ni*Te-k,kr=di*Ni*Te-B,us=Fi*Te-j;av(ki,kr,us,U);const ot=qd*H;if(A[ot+0]=ki,A[ot+1]=kr,A[ot+2]=us,O[ot+0]=Vi,O[ot+1]=Se,c){const cr=1/Math.sqrt(ki*ki+kr*kr+us*us);D[ot+0]=cr*ki,D[ot+1]=cr*kr,D[ot+2]=cr*us}++H}}};m&&se(-1,0),g&&se(1,p)})(),bIe(C,a.numVerticesPerSide,te,[0,h-1],[0,h-1],a.wireframe),e.intersectionData=null;for(let se=0;se<4;++se)C.outerEdges[se].count,b.edgeResolutions[se]+1}function UTt(e,t){const i=e.tile,r=i.extent,s=e.localOrigin,n=e.geometryState,o=i.surface,a=o.isWebMercatorOnPlateeCarree,l=o.shadingEnabled,c=r[0],h=r[1],p=r[2]-c,f=r[3]-h,m=n.clippingArea,g=_(m)?Math.max(0,(m[0]-r[0])/p):0,y=_(m)?Math.max(0,(m[1]-r[1])/f):0,x=_(m)?Math.min(1,(m[2]-r[0])/p):1,b=_(m)?Math.min(1,(m[3]-r[1])/f):1,S=x-g,T=b-y,C=S>0?1/S:1,A=T>0?1/T:1,O=-g*C,D=-y*A,U=n.numVerticesPerSide,k=U-1,B=(U-2)**2+n.neighborData.edgeResolutions.reduce((Oe,Be)=>Oe+Be+1,0),j=uIe(B),H=j.position.typedBuffer,K=j.uv0.typedBuffer,ee=j.normal.typedBuffer,ce=e.geometryInfo,le=ce.boundingBox;Nr(le);let z=0;const q=i.ellipsoid.radius,Z=n.samplerData,Y=_(m)?m:$Ie,te=uK(Math.max(r[0],Y[0]),Math.max(r[1],Y[1]),Math.min(r[2],Y[2]),Math.min(r[3],Y[3])),se=s[0],J=s[1],ae=s[2],_e=tD(a,q,t);(()=>{for(let Oe=1;Oe<=k-1;Oe++){const Be=Oe/k,Se=D+Be*A,Te=He(h+Be*f,te[1],te[3]),Ie=He(Se,0,1),Ve=_e(Te)-J,Ni=p/k;for(let Fi=1;Fi<=k-1;Fi++){const hi=Fi/k,Vi=O+hi*C,di=He(c+hi*p,te[0],te[2]),ki=He(Vi,0,1),kr=qr(di,Te,Z),us=di*t-se,ot=kr-ae;av(us,Ve,ot,le);const cr=qd*z;if(H[cr+0]=us,H[cr+1]=Ve,H[cr+2]=ot,K[cr+0]=ki,K[cr+1]=Ie,l){const en=qr(di+Ni,Te,Z),mo=qr(di-Ni,Te,Z),Fn=qr(di,Te+Ni,Z),gl=.25*(mo-en),yl=.25*(qr(di,Te-Ni,Z)-Fn),Qn=Ni,hd=Math.sqrt(gl*gl+yl*yl+Qn*Qn);ee[cr+0]=gl/hd,ee[cr+1]=yl/hd,ee[cr+2]=Qn/hd}++z}}})(),ce.numVerticesPerSide=n.numVerticesPerSide,ce.vertexAttributes=j,_r(e.geometryInfo.uvOffsetAndScale,g,y,x-g,b-y),wIe(e,z),xIe(e,t),z=B,bIe(ce,n.numVerticesPerSide,[],[0,U-1],[0,U-1],n.wireframe),e.intersectionData=null}function bIe(e,t,i,r,s,n){const o=t-1,a=e.vertexAttributes.count,l=2*(Math.min(t-2,r[1])-Math.max(1,r[0]))*(Math.min(t-2,s[1])-Math.max(1,s[0])),c=z1.map((b,S)=>S===0&&s[1]<t-2||S===1&&r[1]<t-2||S===2&&s[0]>1||S===3&&r[0]>1),h=3*(l+e.outerEdges.reduce((b,S,T)=>b+(c[T]?0:o-2+S.count-1),0)+i.reduce((b,S)=>b+o*(2*(S.latitudeResolution-1)+1),0))*(n?2:1),p=new(a>FTt?Uint32Array:Uint16Array)(h);let f=0;const m=n?(b,S,T)=>{p[f++]=b,p[f++]=S,p[f++]=S,p[f++]=T,p[f++]=T,p[f++]=b}:(b,S,T)=>{p[f++]=b,p[f++]=S,p[f++]=T},g=t-2,y=o-2;(()=>{for(let b=Math.max(s[0],1)-1;b<Math.min(s[1],t-2)-1;++b)for(let S=Math.max(r[0],1)-1;S<Math.min(r[1],t-2)-1;++S){const T=b*g+S,C=T+1,A=C+g,O=A-1;m(T,C,A),m(A,O,T)}})(),(()=>{for(let b=0;b<4;++b){if(c[b])continue;const S=e.outerEdges[b],T=e.innerEdges[b];let C=0,A=0;const O=S.count,D=T.count;S.count;const U=b===1||b===2?(k,B,j)=>m(k,B,j):(k,B,j)=>m(k,j,B);for(;C<O-1||A<D-1;){const k=T.getVertexOffset(A),B=S.getVertexOffset(C),j=C<O-1,H=A<D-1,K=j?0+o*(C+.5)/(O-1):0,ee=H?1+y*(A+.5)/(D-1):0;j&&(!H||K<=ee)?(++C,U(k,B,S.getVertexOffset(C))):(++A,U(k,B,T.getVertexOffset(A)))}}})();const x=b=>{let S=e.outerEdges[b.connectedOuterEdgeOffset].offset0;for(let T=0;T<b.latitudeResolution;++T){const C=T===0?b.rowOffset:S+t;for(let A=0;A<o;A++)m(S,S+1,C+A),T<b.latitudeResolution-1&&m(S+1,C+A+1,C+A),++S;S=C}};i.forEach(x),e.indices=p,e.indexCount=h}function wIe(e,t){const i=e.localOrigin,r=e.geometryInfo,s=e.geometryState.neighborData.edgeResolutions,n=r.numVerticesPerSide-2,o=r.vertexAttributes.position.typedBuffer;let a=t;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?n-1:0)*n+(l===1?n-1:0),p=(c?0:1)*n+(c?1:0);r.innerEdges[l]=new cme(o,i,h,p,n)}{const c=a,h=s[l]+1;r.outerEdges[l]=new cme(o,i,c,1,h),a+=h}}}function zTt(e){var r,s;SIe(e),RIe(e);const t=e.vao,i=e.geometryInfo.vertexAttributes;(s=(r=t==null?void 0:t.vertexBuffers)==null?void 0:r.geometry)==null||s.setSubData(i.position.typedBuffer)}function VTt(e){AIe(e),Yre(e)}function BTt(e,t){EIe(e,t),PIe(e,t),Yre(e)}function GTt(e,t){xIe(e,t),Yre(e)}function xIe(e,t){EIe(e,t),YTt(e,t),PIe(e,t)}function TIe(e,t,i,r,s){const n=Math.cos(i),o=Math.sin(i),a=Math.sin(t),l=Math.cos(t),c=s+r;e[0]=l*n*c,e[1]=a*n*c,e[2]=o*c}function jTt(e,t,i,r,s,n){const o=s[i===0?1:3];TIe(e,s[t===0?0:2],o,r,n)}function HTt(e,t){return(Math.PI/2-2*Math.atan(Math.exp(-e/t)))*t}function qTt(e,t){return e*t}function tD(e,t,i){return e?r=>HTt(r,t):r=>qTt(r,i)}function WTt(e,t,i,r,s,n,o){const a=t===0?s[0]:s[2],l=i===0?s[1]:s[3],c=r;e[0]=a*n,e[1]=o(l),e[2]=c}function ZTt(e,t){const i=e.geometryState,r=e.tile,s=r.extent,n=Ye(i.clippingArea,s),o=e.geometryInfo,a=o.boundingBox,l=o.outerEdges,c=i.neighborData.cornerNeighborData,h=o.uvOffsetAndScale[0],p=o.uvOffsetAndScale[1],f=o.uvOffsetAndScale[2],m=o.uvOffsetAndScale[3],g=f>0?1/f:1,y=m>0?1/m:1,x=-h*g,b=-p*y,S=r.surface.isWebMercatorOnPlateeCarree,T=tD(S,S?r.ellipsoid.radius:0,t),C=i.samplerData,A=i.neighborData.edgeNeighbours,O=e.localOrigin,D=(U,k,B,j,H)=>{const K=s[0]*(1-j)+s[2]*j,ee=s[1]*(1-H)+s[3]*H,ce=He(K,n[0],n[2]),le=He(ee,n[1],n[3]),z=[le===s[3],ce===s[2],le===s[1],ce===s[0]],q=!z[3]&&!z[1]||!z[0]&&!z[2],Z=q?z[0]&&_(A[0])?A[0]:z[1]&&_(A[1])?A[1]:z[2]&&_(A[2])?A[2]:z[3]&&_(A[3])?A[3]:null:null,Y=q?Z?Z.neighborTile.level===r.level?.5*(qr(ce,le,C)+qr(ce,le,Z.neighborSamplerData)):qr(ce,le,Z.neighborSamplerData):qr(ce,le,C):c[B].elevation,te=ce*t-O[0],se=T(le)-O[1],J=Y-O[2];av(te,se,J,a);const ae=He(x+j*g,0,1),_e=He(b+H*y,0,1);U.setVertexRawXYZUV(k,te,se,J,ae,_e)};for(let U=0;U<4;++U){const k=l[U];D(k,0,U===0?3:U===1?1:2,U===1?1:0,U===0?1:0);const B=U===2?1:U===3?3:0,j=U===3?0:1,H=U===2?0:1;D(k,k.count-1,B,j,H)}}function SIe(e){CIe(e,(t,i,r,s)=>jTt(t,i,r,s,e.tile.extentInRadians,e.tile.ellipsoid.radius))}function EIe(e,t){const i=e.tile;_(i.renderData.geometryState.clippingArea)?ZTt(e,t):CIe(e,(r,s,n,o)=>WTt(r,s,n,o,e.tile.extent,t,tD(i.surface.isWebMercatorOnPlateeCarree,i.ellipsoid.radius,t)))}function CIe(e,t){const i=e.geometryInfo,r=i.outerEdges,s=e.geometryState.neighborData.cornerNeighborData,n=i.boundingBox,o=e.localOrigin,a=(l,c,h,p,f)=>{t(S_,h,p,s[c].elevation);for(let m=0;m<3;++m)S_[m]-=o[m];av(S_[0],S_[1],S_[2],n),l.setVertexRawXYZUV(f,S_[0],S_[1],S_[2],h,p)};for(let l=0;l<4;++l){const c=r[l];a(c,l===0?3:l===1?1:2,l===1?1:0,l===0?1:0,0),a(c,l===2?1:l===3?3:0,l===3?0:1,l===2?0:1,c.count-1)}}function Yre(e){var r,s;const t=e.vao,i=e.geometryInfo.vertexAttributes;(s=(r=t==null?void 0:t.vertexBuffers)==null?void 0:r.geometry)==null||s.setSubData(i.position.typedBuffer)}function AIe(e){SIe(e);for(let t=0;t<4;++t)XTt(e,t);RIe(e)}function XTt(e,t){var m2,nw,g2;const i=e.geometryState,r=i.neighborData,s=e.tile;s.level;const n=s.extent,o=n[2]-n[0],a=n[3]-n[1],l=s.extentInRadians,c=l[0];l[1];const h=l[2];l[3];const p=s.ellipsoid.radius,f=Jre(e),m=Bi=>{if(!Bi)return 0;const qo=y,go=x?0:1,vl=Bi.lij[go+1]*k,wy=s.lij[go+1]-vl;return(x?k-1-wy:wy)*qo},g=r.edgeNeighbours[t],y=r.edgeResolutions[t],x=t===1||t===3,b=t===1?1:0,S=t===0?1:0,T=n[0]+b*o,C=n[1]+S*a,A=c*(1-b)+h*b,O=f(S),D=g==null?void 0:g.neighborTile,U=s.level-((m2=D==null?void 0:D.level)!=null?m2:s.level),k=2**U,B=y*k,j=m(D),H=D==null?void 0:D.extent,K=(t+2)%4,ee=i.samplerData,ce=(g2=(nw=D==null?void 0:D.renderData)==null?void 0:nw.geometryState)==null?void 0:g2.samplerData,le=D&&U===0,z=(Bi,qo,go,vl)=>.5*(qr(Bi,qo,ce)+qr(go,vl,ee)),q=(Bi,qo)=>qr(Bi,qo,ce),Z=le?z:q;let Y=H?K===1?H[2]:H[0]:T,te=H?K===0?H[3]:H[1]:C;const se=(Bi,qo,go)=>{const vl=(j+Bi)/B;return te=H[1]*(1-vl)+H[3]*vl,Z(Y,te,qo,go)},J=(Bi,qo,go)=>{const vl=(j+Bi)/B;return Y=H[0]*(1-vl)+H[2]*vl,Z(Y,te,qo,go)},ae=D?x?se:J:(Bi,qo,go)=>qr(qo,go,ee),_e=(Bi,qo,go)=>ae(Bi,qo,go);let Oe=b,Be=T,Se=A,Te=S,Ie=C,Ve=O,Ni=Math.sin(Se),Fi=Math.cos(Se),hi=Math.cos(Ve),Vi=Math.sin(Ve);const di=x?()=>f(Te):()=>O,ki=x?Bi=>{Te=Bi,Ie=n[1]*(1-Bi)+n[3]*Bi,Ve=di(),hi=Math.cos(Ve),Vi=Math.sin(Ve)}:Bi=>{Oe=Bi,Be=n[0]*(1-Bi)+n[2]*Bi,Se=c*(1-Oe)+h*Oe,Ni=Math.sin(Se),Fi=Math.cos(Se)},kr=e.geometryInfo,us=kr.boundingBox,ot=kr.vertexAttributes,cr=ot.position.typedBuffer,en=ot.uv0.typedBuffer,mo=ot.normal.typedBuffer,Fn=kr.outerEdges[t];let gl=Fn.getVertexOffset(1);const yl=y+1,Qn=e.localOrigin,hd=Qn[0],RO=Qn[1],h2=Qn[2],d2=s.surface.shadingEnabled,p2=t===1?-1:t===3?1:0,f2=t===0?-1:t===2?1:0,sw=o/y,PO=p2*sw,IO=f2*sw,$O=p2*(1/y),LO=f2*(1/y),qv=Bi=>{zu(lv,Bi,Eg),Tt(kM,lv,_b),Tt(UM,kM,lv),we(Xs,Xs,UM)};for(let Bi=1;Bi<yl-1;++Bi){ki(Bi/y);const qo=_e(Bi,Be,Ie),go=p+qo,vl=Fi*hi*go,wy=Ni*hi*go,Wv=Vi*go,Zv=vl-hd,y2=wy-RO,v2=Wv-h2;av(Zv,y2,v2,us);const dd=qd*gl;if(cr[dd+0]=Zv,cr[dd+1]=y2,cr[dd+2]=v2,en[dd+0]=Oe,en[dd+1]=Te,d2){he(Xs,0,0,0),he(Eg,vl,wy,Wv),Re(_b,Eg);const ge=(Ur,Xv)=>{const Jl=qr(Be+Ur*PO,Ie+Ur*IO,Xv),xy=p+Jl,xt=Oe+Ur*$O,mm=c*(1-xt)+h*xt,kn=Math.sin(mm),Ty=Math.cos(mm),_2=f(Te+Ur*LO),Yu=Math.sin(_2),ow=Math.cos(_2),b2=Ze(Ty*ow*xy,kn*ow*xy,Yu*xy);qv(b2)};D&&ge(-1,ce),D&&!le||ge(1,ee),mo[dd+0]=Xs[0],mo[dd+1]=Xs[1],mo[dd+2]=Xs[2]}++gl}if(d2)for(let Bi=1;Bi<yl-1;++Bi)Fn.getVertexRawNormal(Xs,Bi),Fn.getVertex(Eg,Bi),Re(_b,Eg),Fn.getVertex(Lu,Bi-1),qv(Lu),Fn.getVertex(Lu,Bi+1),qv(Lu),Re(Xs,Xs),Fn.setVertexRawNormal(Bi,Xs[0],Xs[1],Xs[2])}function YTt(e,t){const i=e.geometryState.clippingArea,r=e.tile.extent,s=_(i)&&(r[0]<i[0]||r[2]>i[2]||r[1]<i[1]||r[3]>i[3])?QTt:JTt;for(let n=0;n<4;++n)s(e,n,t)}function MIe(e,t,i,r,s,n,o){return o===s?!e||t?(a,l)=>qr(a,l,i):null:o===n&&e?(a,l)=>qr(a,l,r):null}function mV(e,t,i,r){if(t!==e)return()=>0;const s=t?3:2,n=t?1:0,o=r(s,n),a=r(n,s),l=(o!=null?1:0)+(a!=null?1:0),c=t?i:0,h=t?0:i;return(p,f,m)=>((o!=null?-(o(p+c,f+h)-m):0)+(a!=null?+(a(p-c,f-h)-m):0))/l}function JTt(e,t,i){const r=e.geometryState.neighborData,s=r.edgeNeighbours,n=e.tile,o=n.level,a=n.surface,l=a.shadingEnabled,c=s[t],h=r.edgeResolutions[t],p=h,f=n.extent,m=e.geometryState,g=p+1,y=c,x=e.localOrigin,b=m.samplerData,S=(J,ae)=>qr(J,ae,b),T=(J,ae)=>.5*(qr(J,ae,y.neighborSamplerData)+qr(J,ae,b)),C=(J,ae)=>qr(J,ae,y.neighborSamplerData),A=(y==null?void 0:y.neighborTile.level)===o,O=A?T:C,D=_(y)?O:S,U=e.geometryInfo,k=U.outerEdges[t],B=tD(a.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,i),j=U.boundingBox,H=t===1||t===3,K=t===1?f[2]:f[0],ee=t===0?f[3]:f[1],ce=t===1?1:0,le=t===0?1:0,z=(f[2]-f[0])/h,q=y==null?void 0:y.neighborSamplerData,Z=_(y),Y=(J,ae)=>MIe(Z,A,b,q,J,ae,t),te=mV(H,!0,z,Y),se=mV(H,!1,z,Y);for(let J=1;J<g-1;++J){const ae=J/p,_e=H?K:f[0]*(1-ae)+f[2]*ae,Oe=H?f[1]*(1-ae)+f[3]*ae:ee,Be=H?ce:ae,Se=H?ae:le,Te=D(_e,Oe),Ie=_e*i-x[0],Ve=B(Oe)-x[1],Ni=Te-x[2];if(av(Ie,Ve,Ni,j),l){const Fi=te(_e,Oe,Te),hi=se(_e,Oe,Te),Vi=z;k.setVertexRawXYZUVN(J,Ie,Ve,Ni,Be,Se,Fi,hi,Vi)}else k.setVertexRawXYZUV(J,Ie,Ve,Ni,Be,Se)}if(l){const J=H?0:1,ae=H?1:0;for(let _e=1;_e<g-1;++_e){k.getNormal(SA,_e);const Oe=k.getVertexZ(_e-1)-k.getVertexZ(_e+1),Be=SA[0]+.5*J*Oe,Se=SA[1]+.5*ae*Oe,Te=2*z,Ie=1/Math.sqrt(Be*Be+Se*Se+Te*Te);k.setVertexRawNormal(_e,Ie*Be,Ie*Se,Ie*Te)}}}function QTt(e,t,i){const r=e.geometryState.neighborData,s=r.edgeNeighbours,n=e.tile,o=n.level,a=n.surface,l=a.shadingEnabled,c=s[t],h=r.edgeResolutions[t],p=h,f=n.extent,m=e.geometryState,g=Ye(m.clippingArea,$Ie),y=e.geometryInfo,x=y.uvOffsetAndScale[0],b=y.uvOffsetAndScale[1],S=x+y.uvOffsetAndScale[2],T=b+y.uvOffsetAndScale[3],C=S>x?1/(S-x):1,A=T>b?1/(T-b):1,O=-x*C,D=-b*A,U=p+1,k=[f[3]>g[3],f[2]>g[2],f[1]<g[1],f[0]<g[0]],B=c,j=m.samplerData,H=(hi,Vi)=>qr(hi,Vi,j),K=(B==null?void 0:B.neighborTile.level)===o,ee=(hi,Vi)=>{const di=qr(hi,Vi,B.neighborSamplerData);return K?.5*(di+qr(hi,Vi,j)):di},ce=H,le=_(B)?ee:H,z=k[t]?ce:le,q=y.outerEdges[t],Z=y.boundingBox,Y=t===1||t===3,te=He(t===1?f[2]:f[0],g[0],g[2]),se=He(t===0?f[3]:f[1],g[1],g[3]),J=t===1?1:0,ae=t===0?1:0,_e=e.localOrigin,Oe=tD(a.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,i),Be=(f[2]-f[0])/h,Se=B==null?void 0:B.neighborSamplerData,Te=_(B),Ie=(B==null?void 0:B.neighborTile.level)===o,Ve=(hi,Vi)=>MIe(Te,Ie,j,Se,hi,Vi,t),Ni=mV(Y,!0,Be,Ve),Fi=mV(Y,!1,Be,Ve);for(let hi=1;hi<U-1;++hi){const Vi=hi/p,di=Y?te:He(f[0]*(1-Vi)+f[2]*Vi,g[0],g[2]),ki=Y?He(f[1]*(1-Vi)+f[3]*Vi,g[1],g[3]):se,kr=Y?J:He(O+Vi*C,0,1),us=Y?He(D+Vi*A,0,1):ae,ot=z(di,ki),cr=di*i-_e[0],en=Oe(ki)-_e[1],mo=ot-_e[2];if(av(cr,en,mo,Z),l){const Fn=Ni(di,ki,ot),gl=Fi(di,ki,ot),yl=Be;q.setVertexRawXYZUVN(hi,cr,en,mo,kr,us,Fn,gl,yl)}else q.setVertexRawXYZUV(hi,cr,en,mo,kr,us)}if(l){const hi=Y?0:1,Vi=Y?1:0;for(let di=1;di<U-1;++di){q.getNormal(SA,di);const ki=q.getVertexZ(di-1)-q.getVertexZ(di+1),kr=SA[0]+.5*hi*ki,us=SA[1]+.5*Vi*ki,ot=2*Be,cr=1/Math.sqrt(kr*kr+us*us+ot*ot);q.setVertexRawNormal(di,cr*kr,cr*us,cr*ot)}}}function OIe(e,t){return Math.PI/2-2*Math.atan(Math.exp(-e/t))}function KTt(e,t,i,r){return OIe(e+r*(t-e),i)}function eSt(e,t,i){return e*(1-i)+t*i}function Jre(e){const t=e.tile;if(t.surface.isWebMercator){const r=t.extent,s=t.ellipsoid.radius;return n=>KTt(r[1],r[3],s,n)}const i=t.extentInRadians;return r=>eSt(i[1],i[3],r)}function RIe(e){e.tile.surface.shadingEnabled&&IIe(e,(t,i,r,s,n,o,a)=>tSt(i,t,r,s,n,o,a))}function PIe(e,t){e.tile.surface.shadingEnabled&&IIe(e,(i,r,s,n,o,a,l)=>iSt(sSt(e,t),i,s,o,a,l))}function tSt(e,t,i,r,s,n,o){rSt(e,Lu,s,n,o),zu(lv,Lu,i),Tt(kM,lv,r),Tt(t,kM,lv)}function iSt(e,t,i,r,s,n){e(Lu,r,s,n);const o=Lu[0]-i[0],a=Lu[1]-i[1],l=Lu[2]-i[2];t[0]=-o*l,t[1]=-a*l,t[2]=o*o+a*a}function rSt(e,t,i,r,s){const n=Jre(e),o=e.tile,a=o.extent;wP(a,i,r,1);const l=(i-a[0])/(a[2]-a[0]),c=(r-a[1])/(a[3]-a[1]),h=o.extentInRadians;TIe(t,h[0]*(1-l)+h[2]*l,n(c),s,o.ellipsoid.radius)}function sSt(e,t){return e.tile.surface.isWebMercatorOnPlateeCarree?(i,r,s,n)=>oSt(t,e.tile.ellipsoid.radius,i,r,s,n):(i,r,s,n)=>nSt(t,i,r,s,n)}function nSt(e,t,i,r,s){t[0]=i*e,t[1]=r*e,t[2]=s}function oSt(e,t,i,r,s,n){i[0]=r*e,i[1]=(Math.PI/2-2*Math.atan(Math.exp(-s/t)))*t,i[2]=n}function IIe(e,t){var o;if(!e.tile.surface.shadingEnabled)return;const i=e.geometryState.neighborData.cornerNeighborData,r=e.tile,s=r.extent,n=((o=e.tile.surface.view)==null?void 0:o.viewingMode)==="local";n&&he(_b,0,0,1);{const a=(y,x,b,S)=>{t(UM,y.renderData,Eg,_b,x,b,S),we(Xs,Xs,UM)},c=(y,x,b,S,T,C)=>{const A=C===1?T.extent[0]:C===3?T.extent[2]:y,O=C===0?T.extent[1]:C===2?T.extent[3]:x,D=A+dE[b][0]*S,U=O+dE[b][1]*S;wP(T.extent,D,U,1);const k=qr(D,U,T.renderData.geometryState.samplerData);a(T,D,U,k)},h=(y,x,b)=>y.extent[x===0||x===1?2:0]+b,p=(y,x,b)=>y.extent[x===0||x===3?3:1]+b,f=(y,x,b,S)=>{const T=h(b,S,dE[y][0]*x),C=p(b,S,dE[y][1]*x);wP(b.extent,T,C,1);const A=qr(T,C,b.renderData.geometryState.samplerData);a(b,T,C,A)},m=(y,x,b,S,T,C)=>{const A=dE[y][0]*x,O=dE[y][1]*x,D=h(b,S,A),U=p(b,S,O),k=h(T,C,A),B=p(T,C,O);wP(b.extent,D,U,1),wP(T.extent,k,B,1);const j=qr(D,U,b.renderData.geometryState.samplerData),H=qr(k,B,T.renderData.geometryState.samplerData);a(b,D,U,.5*(j+H))},g=y=>{const x=y===0||y===1?s[2]:s[0],b=y===0||y===3?s[3]:s[1],S=i[y].cornerTiles,T=S.reduce((C,A)=>{var O;return Math.min(C,(O=A==null?void 0:A.level)!=null?O:1/0)},1/0);for(let C=0;C<4;++C){const A=S[C];E_[C]=(A==null?void 0:A.level)===T?A:null}for(let C=0;C<4;++C){const A=E_[(C+3)%4],O=E_[C];if(A!=null&&A!==r&&A===O){const D=A,U=(C+2)%4,k=D.renderData.geometryState.neighborData.edgeResolutions[U],B=Math.max(k,2**(r.level-D.level)),j=(D.extent[2]-D.extent[0])/B,H=(C+0)%4,K=(C+1)%4;return c(x,b,(C+3)%4,j,D,C),c(x,b,H,j,D,C),c(x,b,K,j,D,C),Xs}}{E_.some(A=>(A==null?void 0:A.isLoaded)||A===r);const C=E_.reduce((A,O)=>O?O.extent[2]-O.extent[0]:A,0)/E_.reduce((A,O)=>{var D;return Math.max(A,(D=O==null?void 0:O.renderData.geometryState.numVerticesPerSide)!=null?D:1)},1);for(let A=0;A<4;++A){const O=E_[(A+3)%4],D=E_[(A+0)%4];if(!O&&!D)continue;const U=A===0?1:A===1?2:A===2?3:0,k=A===0?2:A===1?3:A===2?0:1;O&&D?m(A,C,O,U,D,k):f(A,C,O!=null?O:D,O?U:k)}}return Xs};for(let y=0;y<4;++y){const x=e.geometryInfo.outerEdges[y],b=y===1||y===2?0:x.count-1;x.getVertex(Eg,b),n||Re(_b,Eg),he(Xs,0,0,0);const S=g(y);Re(q7[y],S)}}{const a=(c,h,p,f,m)=>{c.setVertexRawNormal(m,h,p,f)},l=e.geometryInfo.outerEdges;for(let c=0;c<4;++c){const h=l[c];{const p=q7[c===0?3:c===1?1:2];a(h,p[0],p[1],p[2],0)}{const p=q7[c===2?1:c===3?3:0];a(h,p[0],p[1],p[2],h.count-1)}}}}function av(e,t,i,r){e<r[0]?r[0]=e:e>r[3]&&(r[3]=e),t<r[1]?r[1]=t:t>r[4]&&(r[4]=t),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}const dE=[[0,1],[1,0],[0,-1],[-1,0]],Bw=new Kxt,$Ie=uK(-1/0,-1/0,1/0,1/0),S_=$(),Lu=$(),lv=$(),kM=$(),UM=$(),Eg=$(),H7=$(),_b=$(),Xs=$(),SA=$(),q7=[$(),$(),$(),$()],E_=[null,null,null,null];class aSt extends Wre{constructor(t,i,r){super(),this.horizontalScaleFactor=1,this.extentInRenderSR=Qt(),t!==void 0&&this.init(t,i,r)}init(t,i,r){super.init(t,i,r);const s=r.view.renderSpatialReference,n=r.spatialReference,o=_(s)&&P3(s)&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this.horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this.extentInRenderSR,c=this.extent;if(a){const h=Ze(c[0],c[1],0);Zn(h,at.WebMercator,h,at.PlateCarree);const p=Ze(c[2],c[3],0);Zn(p,at.WebMercator,p,at.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=p[0],l[3]=p[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const t=this.extentInRenderSR,i=.5*(t[2]-t[0]),r=.5*(t[3]-t[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[Dl.MIDDLE][3]=o}_isVisible(t){return Act(t,this._aabb())}_aabb(){const t=this.extentInRenderSR;return Qze(t[0],t[1],this.elevationBounds[0],t[2],t[3],this.elevationBounds[1])}intersectsRay(t,i,r,s){return XF[0]=1/i[0],XF[1]=1/i[1],XF[2]=1/i[2],Jie(this._aabb(),t,XF,r,s)}createGeometry(){UTt(this.renderData,this.horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerRowOnLevel(){return this.level<9?3:2}updateCornerElevations(){BTt(this.renderData,this.horizontalScaleFactor)}updateEdgeElevations(){GTt(this.renderData,this.horizontalScaleFactor)}}const XF=$();var q$;(function(e){e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT",e[e.NONE=0]="NONE",e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(q$||(q$={}));class lSt extends Wre{constructor(t,i,r){super(),this.obb=new Array(8);for(let s=0;s<8;s++)this.obb[s]=$();t!==void 0&&this.init(t,i,r)}init(t,i,r){super.init(t,i,r);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=t[0],h=ui(o,l,.5),p=ui(n,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(f)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),ZO(this.centerAtSeaLevel,p,h,this.ellipsoid.radius);const m=Tc(this.centerAtSeaLevel);Re(m,m),this.up=m,this._updateOBB(),this.updateRadiusAndCenter()}updateRadiusAndCenter(){if(this.lij[0]===0)he(this._center[_f.MIDDLE],0,0,0),he(this._center[_f.TOP],0,0,0),he(this._center[_f.BOTTOM],0,0,0),this.ellipsoid||(this.ellipsoid=Ri(this.surface.spatialReference)),this._center[_f.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const t=Math.max(uo(this._center[_f.MIDDLE],this.obb[0]),uo(this._center[_f.MIDDLE],this.obb[1]));this._center[_f.MIDDLE][3]=Math.sqrt(t)}}_isVisible(t){if(!rb(t,this._center[_f.MIDDLE]))return!1;if(this.lij[0]<10)return!0;const i=this.obb;for(let r=0;r<Cv.NUM;r++){const s=r===Mr.NEAR,n=t[r];s&&(VR[0]=n[0],VR[1]=n[1],VR[2]=n[2],VR[3]=n[3]-this.surface.view.state.camera.near);const o=s?VR:n;let a;for(a=0;a<8;a++){const l=i[a];if(o[0]*l[0]+o[1]*l[1]+o[2]*l[2]+o[3]<0)break}if(a===8)return!1}return!0}computeElevationBounds(){super.computeElevationBounds(),this._updateOBB()}createGeometry(){const t=this._getPatchType(this.lij[1],this.lij[0]);kTt(this.renderData,t),this.setMemoryDirty()}_updateOBB(){const t=this.extentInRadians,i=this.obb;for(let r=0;r<2;r++){const s=this.elevationBounds[r];let n=4*r;ZO(i[n++],t[0],t[1],this.ellipsoid.radius+s),ZO(i[n++],t[0],t[3],this.ellipsoid.radius+s),ZO(i[n++],t[2],t[3],this.ellipsoid.radius+s),ZO(i[n++],t[2],t[1],this.ellipsoid.radius+s)}if(this.surface.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case rp.HAS_NORTH_POLE:he(i[1],0,0,this.ellipsoid.radius),he(i[2],0,0,this.ellipsoid.radius),he(i[5],0,0,this.ellipsoid.radius),he(i[6],0,0,this.ellipsoid.radius);break;case rp.HAS_SOUTH_POLE:he(i[0],0,0,-this.ellipsoid.radius),he(i[3],0,0,-this.ellipsoid.radius),he(i[4],0,0,-this.ellipsoid.radius),he(i[7],0,0,-this.ellipsoid.radius)}}_getPatchType(t,i){return t===(1<<i)-1?t===0?rp.HAS_BOTH_POLES:rp.HAS_SOUTH_POLE:t===0?rp.HAS_NORTH_POLE:rp.REGULAR}intersectsRay(t,i,r,s){const n=this._center[_f.MIDDLE],o=n[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-t[0],c=n[1]-t[1],h=n[2]-t[2],p=(l*i[0]+c*i[1]+h*i[2])/a,f=i[0]*p-l,m=i[1]*p-c,g=i[2]*p-h;return f*f+m*m+g*g<o*o}getDefaultVerticesPerRowOnLevel(){return this.level<gme.length?gme[this.level]+1:2}updateCornerElevations(){zTt(this.renderData)}updateEdgeElevations(){VTt(this.renderData)}}const gme=[128,64,32,16,16,8,8,4],VR=qi();var _f;(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(_f||(_f={}));class cSt{constructor(){this.extent=si(),this.minLevel=0,this.maxLevel=0,this.callback=null}}class uSt{constructor(){this._queries=new ai({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new ai({initialSize:30}),this._queryPool=new un(cSt)}queryVisibleLevelRange(t,i,r,s){const n=this._queryPool.acquire();Lf(n.extent,t),n.minLevel=i||-Number.MAX_VALUE,n.maxLevel=r!=null?r:Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n)}hasPendingQueries(){return this._queryQueue.length!==0}prepareQueries(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const t=this._queryQueue.pop();this._queries.push(t)}this._queriesInvPtr=this._queries.length}processQueries(){for(let t=0;t<this._queries.length;t++){const i=this._queries.data[t];this._queryPool.release(i),i.callback(t>=this._queriesInvPtr),i.callback=null}this._queries.clear()}scaleQueriesForTile(t){const i=t.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=t.extent[2]&&n[2]>=t.extent[0]&&n[1]<=t.extent[3]&&n[3]>=t.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}}class Qre extends Xl{constructor(){super(...arguments),this.blendMode=qe.Normal}}u([Q({count:qe.COUNT})],Qre.prototype,"blendMode",void 0);class hSt extends yIe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.blendMode=qe.Normal,this.backgroundColor=Hl}}class _8 extends Lr{initializeProgram(t){const i=_8.shader.get().build(this.configuration);return new Er(t.rctx,i,lr)}initializePipeline(){return ri({blending:my(ke.ONE,ke.ONE_MINUS_SRC_ALPHA),colorWrite:xi})}}_8.shader=new Sr(pTt,()=>import("./BlendLayers.glsl.e87fe4d3.js"));class Ck extends Qre{constructor(){super(...arguments),this.output=ma.Composite,this.baseOpacityMode=lo.One,this.premultipliedSource=!1}}u([Q({count:ma.COUNT})],Ck.prototype,"output",void 0),u([Q({count:lo.COUNT})],Ck.prototype,"baseOpacityMode",void 0),u([Q()],Ck.prototype,"premultipliedSource",void 0);class W7{constructor(t,i,r,s,n,o){this.texture=t,this.type=i,t.retain(),this.offsetAndScale=zi(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=Ze(s,o,n)}destroy(){this.texture.release()}}function Ak(){return[1,0,0,1,0,0]}function dSt(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function pSt(e,t,i,r,s,n){return[e,t,i,r,s,n]}function fSt(e,t){return new Float64Array(e,t,6)}Object.freeze(Object.defineProperty({__proto__:null,create:Ak,clone:dSt,fromValues:pSt,createView:fSt},Symbol.toStringTag,{value:"Module"}));function mSt(e){return e instanceof Float32Array&&e.length>=2}function gSt(e){return Array.isArray(e)&&e.length>=2}function Z7(e){return mSt(e)||gSt(e)}const ySt=96,vSt=39.37;function Kre(e,t){return t.type?Li(e,t.x,t.y):po(e,t)}function _St(e){return $n(e)}function bSt(e,t){const i=e.targetGeometry,r=t.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}const wSt=function(){const e=Ke();return function(t,i,r){const s=i.targetGeometry;Kre(e,s);const n=.5*b8(i);return t.xmin=e[0]-n*r[0],t.ymin=e[1]-n*r[1],t.xmax=e[0]+n*r[0],t.ymax=e[1]+n*r[1],t.spatialReference=s.spatialReference,t}}();function b8(e){return e.scale*xSt(e.targetGeometry)}function xSt(e){return _(e)&&ja(e.spatialReference)?1/(_St(e.spatialReference)*vSt*ySt):1}function TSt(e){return MV(e.rotation)||0}const ese=function(){const e=Ke(),t=Ke(),i=Ke();return function(r,s,n,o,a,l){return Yte(e,s),Oc(t,n,.5*l),Li(i,1/o*l,-1/o*l),Bte(r,t),a&&i6(r,r,a),Vte(r,r,i),r6(r,r,e),r}}(),SSt=function(){const e=Ke();return function(t,i,r,s){const n=b8(i),o=TSt(i);return Kre(e,i.targetGeometry),ese(t,e,r,n,o,s)}}(),ESt=function(){const e=Ke();return function(t,i,r,s){const n=b8(i);return Kre(e,i.targetGeometry),ese(t,e,r,n,0,s)}}();function CSt(e){const t=X0(e);return t?t.valid[1]-t.valid[0]:0}function ASt(e,t){return Math.round(CSt(e)/t)}var SJ;const zy=[0,0];let u1=SJ=class extends Ce{constructor(e){super(e),this._viewpoint2D={center:Ke(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new yi,this.id=0,this.inverseTransform=Ak(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=Ak(),this.transformNoRotation=Ak(),this.displayMat3=nv(),this.displayViewMat3=nv(),this.viewMat3=nv(),this.viewMat2d=mz(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}copy(e){const t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=bSt(i,e.viewpoint),this._set("size",po(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new SJ({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return Z7(t)?Mx(e,t,this.inverseTransform):(zy[0]=t,zy[1]=i,Mx(e,zy,this.inverseTransform))}toScreen(e,t,i){return Z7(t)?Mx(e,t,this.transform):(zy[0]=t,zy[1]=i,Mx(e,zy,this.transform))}toScreenNoRotation(e,t,i){return Z7(t)?Mx(e,t,this.transformNoRotation):(zy[0]=t,zy[1]=i,Mx(e,zy,this.transformNoRotation))}getScreenTransform(e,t){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return ese(e,i,s,t,0,r),e}_update(){const{center:e,spatialReference:t,scale:i,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new xp({targetGeometry:new dt(e[0],e[1],t),scale:i,rotation:r});if(this._set("viewpoint",o),!n||!t||!i)return;this.resolution=b8(o),this.rotation=r,this.scale=i,this.spatialReference=t,po(this.center,e);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;hie(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=die(this.viewMat3),h=zl(n[0]/2,n[1]/2),p=zl(-n[0]/2,-n[1]/2),f=MV(r);Sz(c,c,h),pie(c,c,f),Sz(c,c,p),d6(this.displayViewMat3,this.displayMat3,c);const m=Bte(this.viewMat2d,h);return i6(m,m,f),r6(m,m,p),wSt(this.extent,o,n),SSt(this.transform,o,n,s),$Ee(this.inverseTransform,this.transform),ESt(this.transformNoRotation,o,n,s),this.worldScreenWidth=ASt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([d({readOnly:!0})],u1.prototype,"id",void 0),u([d({value:1,json:{write:!0}})],u1.prototype,"pixelRatio",null),u([d({json:{write:!0}})],u1.prototype,"size",null),u([d()],u1.prototype,"spatialReference",void 0),u([d({type:xp,json:{write:!0}})],u1.prototype,"viewpoint",null),u1=SJ=u([L("esri.views.2d.ViewState")],u1);const MSt=u1,OSt=.125;class RSt{constructor(){this._renderParams={context:null,drawPhase:1,state:new MSt({viewpoint:new xp({targetGeometry:new dt(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}dispose(){this._renderParams=null}render(t,i,r,s,n,o,a,l,c,h){const p=o.adjustLevel(i[0]),f=this._renderParams;f.context=t,f.painter=s,f.glyphMosaic=s.glyphMosaic,f.spriteMosaic=s.spriteMosaic,f.pixelRatio=h,f.displayLevel=p,f.requiredLevel=p;const m=o.getScale(i[0]),[g,y]=o.getShift(i,a*m),x=OSt*a*m/c,b=r.transforms.dvs;b[0]=x,b[4]=-x,b[6]=-1-g-l[0]*a*2,b[7]=1+y+(1-l[1])*a*2-2,f.state.size[0]=c,f.state.size[1]=c,r.stage||r.attachWithContext(t),r.triangleCount=0,s.drawTile(f,r,n)}}class w8 extends Lr{initializeProgram(t){const i=w8.shader.get().build(this.configuration);return new Er(t.rctx,i,lr)}initializePipeline(){return ri({blending:my(ke.ONE,ke.ONE_MINUS_SRC_ALPHA),colorWrite:xi})}}w8.shader=new Sr(bTt,()=>import("./RasterColorizer.glsl.be63bf28.js"));class gC extends Qre{constructor(){super(...arguments),this.colorizerType=iS.Stretch,this.stretchType=zS.Noop,this.tileBlendInput=Ba.LayerOnly,this.baseOpacityMode=lo.One,this.applyColormap=!0}}u([Q({count:iS.COUNT})],gC.prototype,"colorizerType",void 0),u([Q({count:zS.COUNT})],gC.prototype,"stretchType",void 0),u([Q({count:Ba.COUNT})],gC.prototype,"tileBlendInput",void 0),u([Q({count:lo.COUNT})],gC.prototype,"baseOpacityMode",void 0),u([Q()],gC.prototype,"applyColormap",void 0);class yme{constructor(t){this._rctx=t,this._pools=new Map}acquire(t){return this._getPool(t).acquire()}clear(){this._pools.forEach(t=>t.destroy()),this._pools.clear()}_getPool(t){let i=this._pools.get(t);if(!i){const r=vme.bind(vme,this._rctx,{colorTarget:zs.TEXTURE,depthStencilTarget:Yi.DEPTH_RENDER_BUFFER,width:t,height:t},s=>this._getPool(s.width).release(s));i=new un(r,null,()=>{}),this._pools.set(t,i)}return i}}class vme extends ss{constructor(t,i,r){super(t,i),this.release=()=>r(this)}}const PSt=ve.getLogger("esri.views.3d.terrain");class ISt{constructor(t,i){this._rctx=t,this._techniqueRepository=i,this._fboPools=[],this._doubleBufferFbo=[],this._vectorTileHelper=new RSt,this._bindParameters=new m6(null,null,null),this._blendLayersTechniqueConfig=new Ck,this._poolToWrite=0,this._vaoQuad=Yl(this._rctx,$L),this._fboPools.push(new yme(this._rctx)),this._fboPools.push(new yme(this._rctx))}dispose(){this._fboPools.forEach(t=>{t.clear(),t=null}),this._fboPools=null,this._doubleBufferFbo.forEach(t=>ht(t)),this._vaoQuad=ht(this._vaoQuad),this._vectorTileHelper=ht(this._vectorTileHelper),this._backgroundTechnique=br(this._backgroundTechnique),this._applyOpacityTechnique=br(this._applyOpacityTechnique),this._blendLayersTechnique=br(this._blendLayersTechnique)}_getBlendLayersTechnique(t,i,r,s=!1){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=t,this._blendLayersTechniqueConfig.baseOpacityMode=r?i===ma.Composite?lo.OnBaseLayer:lo.OnBackground:lo.One,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(_8,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(t,i){const r=this._getBlendLayersTechnique(qe.Normal,i,!1),s=this._rctx.bindTechnique(r,t,this._bindParameters);this._render(s)}_render(t){this._rctx.bindVAO(this._vaoQuad),t.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Wt.TRIANGLE_STRIP,0,ka(this._vaoQuad,"geometry"))}drawRasterData(t,i,r=!1){if(M(i.texture))return;const s=i.baseOpacity<1;i.blendMode!==qe.Normal||s||r?(i.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):i.fboTexture=null;const n=this._getBlendLayersTechnique(i.blendMode,t,s,r),o=this._rctx.bindTechnique(n,i,this._bindParameters);this._render(o)}drawImageryTileData(t,i,r){const s=t.sourceLayerInfo.data;if(!s.source)return;t.tile.surface.layerViewByIndex(t.layerIndex,gi.MAP).ensureSymbolizerParameters(s);const n=r.baseOpacity<1;r.blendMode!==qe.Normal||n?(r.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):r.fboTexture=null;const o=this._getRasterColorizerTechnique(s,i,r.blendMode,n),a=this._rctx.bindTechnique(o);if(!s.bind(this._rctx))return;s.opacity=r.opacity;const l=s.getUniforms();l.scale=t.scale,l.offset=t.offset,l.backgroundColor=r.backgroundColor,l.fboTexture=r.fboTexture,l.baseOpacity=r.baseOpacity,o.bindPass(l,null),this._render(a)}_getRasterColorizerTechnique(t,i,r,s){const n=t.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return M(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new gC,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.tileBlendInput=i===ma.ColorComposite?Ba.ColorComposite:i===ma.GridComposite?Ba.GridComposite:Ba.LayerOnly,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s?i===ma.Composite?lo.OnBaseLayer:lo.OnBackground:lo.One,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.stretchType=t.hasStretchTypeNone()?zS.Noop:zS.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(w8,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(t,i,r,s,n,o,a){const l=this._rctx,c=i.sourceLayerInfo.data,h=i.tile.surface.layerViewByIndex(i.layerIndex,gi.MAP),p=t.baseOpacity<1||t.opacity<1||t.blendMode!==qe.Normal||a!==ma.Composite;let f;this._getBlendLayersTechnique(t.blendMode,a,t.baseOpacity<1,p).bindPipelineState(l),p?(f=this._acquire(n),l.bindFramebuffer(f),l.setClearColor(0,0,0,0),l.clearSafe(wr.COLOR_BUFFER_BIT|wr.DEPTH_BUFFER_BIT)):o&&l.clearSafe(wr.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(l,i.sourceLod,c,h.painter,h.layer.styleRepository,h.schemaHelper,Math.round(1/i.scale),i.offset,s,r)}catch(m){PSt.warnOnce("A render call containing vector tiles did not resolve correctly.",m)}return!_(f)||(l.bindFramebuffer(this._currentFBO),t.texture=f.colorTexture,t.offset=Sp,t.scale=1,this.drawRasterData(a,t,p),f.release(),o)}copyFBOToTexture(t){const i=this._rctx,r=i.bindTexture(t.texture,_t.TEXTURE_UNIT_FOR_UPDATES),s=t.descriptor;i.gl.copyTexImage2D(At.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),t.generateMipmap(),i.bindTexture(r,_t.TEXTURE_UNIT_FOR_UPDATES)}_initFBO(t,i){this._rctx.bindFramebuffer(t),this._rctx.setViewport(0,0,i,i),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(wr.COLOR_BUFFER_BIT|wr.DEPTH_BUFFER_BIT)}_acquire(t){return this._fboPools[this._poolToWrite].acquire(t)}bindPool(t,i){this._poolToWrite=t,this._doubleBufferFbo[t]==null&&(this._doubleBufferFbo[t]=this._acquire(i),this._initFBO(this._doubleBufferFbo[t],i))}_switchPool(t){this._releaseCurrentFBO(),this._doubleBufferFbo[this._poolToWrite]=null,this._poolToWrite=this._poolToWrite===0?1:0,this.bindPool(this._poolToWrite,t)}get _currentFBO(){return this._doubleBufferFbo[this._poolToWrite]}_releaseCurrentFBO(){this._doubleBufferFbo[this._poolToWrite].release(),this._doubleBufferFbo[this._poolToWrite]=null}releasePool(){this._rctx.bindFramebuffer(null),this._releaseCurrentFBO()}cleanupFBOPool(t,i){t===this._lastPixelRatio&&i===this._lastNumLayers||(this._fboPools.forEach(r=>r.clear()),this._lastPixelRatio=t,this._lastNumLayers=i)}}class $St{constructor(t,i,r){this._rctx=t,this.tileSize=i,this._techniqueRepository=r,this._passParameters=new hSt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._numTexturedLayer=0,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new ISt(this._rctx,this._techniqueRepository),this._blackTex=new mC(rnt(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=ht(this._composition),this._backgroundTexture=br(this._backgroundTexture),this._blackTex=br(this._blackTex)}get backgroundIsGrid(){return M(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(t,i){if(!t.renderData)return;const r=t.surface,s=r.baseOpacity;this._numTexturedLayer=0;let n=0,o=this.tileSize,a=!1;const l=r.view.state.pixelRatio;let c=!1;const h=t.layerInfo[gi.MAP];let p=h.length,f=0;for(;f<h.length;f++){const y=r.layerViewByIndex(f,gi.MAP),x=y.fullOpacity;if(Y7[f]=x,Kwe(y.layer)&&p>=h.length&&(p=f),x===0){h[f].pendingUpdates&=~(It.TEXTURE_NOFADING&It.TEXTURE_FADING);continue}++n;const b=X7(t,f);if(b){if(h[f].pendingUpdates&=~(It.TEXTURE_NOFADING&It.TEXTURE_FADING),dV(y)){const S=iIe(y.layer.parent)?"normal":y.layer.blendMode;_me[f]=S;const T=S!=="normal";T&&(c=T,a=!1)}G$(y)?o=Math.max(o,this.tileSize*l):s===1&&x===1&&(y.isOpaque||this._dataToTexture(b)&&b.sourceLayerInfo.data.descriptor.isOpaque)&&(a=!0),++this._numTexturedLayer}}this._composition.cleanupFBOPool(l,h.length),o=LSt(o);const m=o/this.tileSize,g=f-1;this._ensureBackgroundTexture(this.tileSize),this._numTexturedLayer!==0?this._numTexturedLayer===1&&!c&&this._useLayerTexture(t,g,p,Y7[g])||this._composeMapLayers(t,i,g,p,Y7,_me,o,m,!a||c):this._useBackgroundTexture(t,n)}_ensureBackgroundTexture(t){M(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(t),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bindPool(0,t),this._passParameters.offset=Sp,this._passParameters.scale=1,this._passParameters.opacity=1,this._passParameters.blendMode=qe.Normal,_(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,_(this.backgroundColor)?ma.ColorOnly:ma.GridOnly),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.releasePool(),this._backgroundDirty=!1)}_useBackgroundTexture(t,i){let r=ov.Immediate;(t.surface.view.layerViewManager.updating||i>0)&&(r=ov.Delayed),this._backgroundTexture&&M(t.renderData.textureReference)&&(r=ov.Immediate),t.renderData.setTextureReference(_(this._backgroundTexture)?new W7(this._backgroundTexture,No.FADING,bme,t.surface.baseOpacity,1,0):null,r)}_useLayerTexture(t,i,r,s){const n=i<r,o=n?1:t.surface.baseOpacity,a=n?t.surface.baseOpacity:1,l=X7(t,i);return!!this._dataToTexture(l)&&(t.renderData.setTextureReference(new W7(l.sourceLayerInfo.data,No.FADING,l,o,s,a)),!0)}_composeMapLayers(t,i,r,s,n,o,a,l,c){this._composition.bindPool(0,a);const h=t.surface.baseOpacity;let p=!1,f=gt.LINEAR_MIPMAP_LINEAR,m=!1,g=0;for(let x=r;x>=0;x--){const b=X7(t,x);if(!b||n[x]===0)continue;const S=x<s&&h<1&&!p;this._passParameters.baseOpacity=S?h:1,S&&(p=!0);const T=g===0,C=c&&T?this.backgroundIsGrid?ma.GridComposite:ma.ColorComposite:ma.Composite;ixt(b)?(this._passParameters.opacity=n[x],this._passParameters.blendMode=Tk[o[x]],m=this._composition.drawVectorData(this._passParameters,b,l,this.tileSize,a,m,C)):txt(b)?(this._passParameters.opacity=n[x],this._passParameters.blendMode=Tk[o[x]],this._composition.drawImageryTileData(b,C,this._passParameters),this._hasNearestInterpolation(b)&&(f=gt.NEAREST)):this._dataToTexture(b)&&(this._passParameters.texture=b.sourceLayerInfo.data.texture,this._passParameters.offset=b.offset,this._passParameters.scale=b.scale,this._passParameters.opacity=n[x],this._passParameters.blendMode=Tk[o[x]],this._composition.drawRasterData(C,this._passParameters)),g++}const y=t.renderData.ensureTexture(a,()=>this._buildTexture(a,f));this._composition.copyFBOToTexture(y),this._composition.releasePool(),t.renderData.setTextureReference(new W7(y,i,bme,p?1:h,1,0))}_hasNearestInterpolation(t){const i=t.sourceLayerInfo.data;return!!i.source&&i.interpolation==="nearest"}_dataToTexture(t){return sxt(t)&&this._rasterDataToTexture(t),rxt(t)}_rasterDataToTexture(t){const i=t.sourceLayerInfo;i.data=this._buildTexture(i.data),t.tile.setMemoryDirty()}setBackground(t){this._backgroundColor!==t&&(this._backgroundColor=t,this._backgroundDirty=!0)}_buildTexture(t,i=gt.LINEAR_MIPMAP_LINEAR){if(M(t))return null;const r={target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:i,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},s=this._rctx;let n;if(typeof t=="number")r.width=r.height=t,n=new mC(new _t(s,r));else if(t instanceof f8)r.isOpaque=t.isOpaque,n=new mC(new _t(s,r,t.image)),t.release();else try{n=new mC(new _t(s,r,t))}catch{n=new mC(HCe(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,_t.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,_t.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}}function LSt(e){const t=FA(e),i=t*t,r=e*e;if(i===r)return e;const s=t/2;return i-r<r-s*s?t:s}function X7(e,t){sh.layerIndex=t;const i=e.layerInfo[gi.MAP][t];if(_(i.data))return Li(sh.offset,0,0),sh.tile=e,sh.scale=1,sh.sourceLod=e.lij,sh.sourceLayerInfo=i,sh;const r=i.upsampleInfo;if(_(r)){const s=r.tile.layerInfo[gi.MAP][t];return sh.tile=r.tile,po(sh.offset,r.offset),sh.scale=r.scale,sh.sourceLod=r.tile.lij,sh.sourceLayerInfo=s,sh}return null}const Y7=new Array,_me=new Array,sh={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},bme={offset:[0,0],scale:1},LIe=200,J7=40,DSt=.8,NSt=10,mI=1e-6;function FSt(e,t,i){const r=t,s=i;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=e[a];if(r[a]<l){if(s[a]<=mI)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-mI){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=e[a+3];if(r[a]>l){if(s[a]>=-mI)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]>=mI){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}class wme{constructor(t,i,r,s,n){this.aabb=t,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}}class zM{constructor(t,i,r,s){this.globalTriangleVertexIndices=t,this.firstTriangleIndex=i,this.positionAttribute=s,this.rayDirection=$(),this.bspNodeTree=new Array,this.vertexPositionBuffer=s.data,this.vertexPositionStride=s.stride;const n=r-i,o=n<=DIe?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=BSt(t,i,r,s.data,s.stride),l=He(Math.log2(n/J7),2,NSt),c=(h,p,f)=>{const m=zSt(o,a,h,p),g=p-h;if(g<=J7){const C=new wme(m,void 0,0,h,p);return this.bspNodeTree.push(C),C}const{axis:y,midValue:x}=VSt(m),b=USt(o,a,h,p,y,x),S=(C,A)=>{if(f>l)return;const O=A-C;return O<J7||O>=DSt*g?void 0:c(C,A,f+1)},T=new wme(m,y,x,b.next,b.mid);return this.bspNodeTree.push(T),T.leftNode=S(h,b.next),T.rightNode=S(b.mid,p),T};c(0,n,0),this.triangleVertexIndices=GSt(o,t,i,r)}}intersectRayTriangleRange(t,i){{if(t>=i)return;const r=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this.rayOrigin,a=o[0],l=o[1],c=o[2],h=this.rayDirection,p=h[0],f=h[1],m=h[2];for(let g=t,y=3*t;g<i;++g){const x=r[y]*n,b=s[x],S=s[x+1],T=s[x+2],C=r[y+1]*n,A=s[C],O=s[C+1],D=s[C+2],U=r[y+2]*n,k=s[U],B=s[U+1],j=s[U+2];y+=3;const H=A-b,K=O-S,ee=D-T,ce=k-b,le=B-S,z=j-T,q=f*z-le*m,Z=m*ce-z*p,Y=p*le-ce*f,te=H*q+K*Z+ee*Y;if(Math.abs(te)<=Number.EPSILON)continue;const se=a-b,J=l-S,ae=c-T,_e=se*q+J*Z+ae*Y;if(te>0){if(_e<0||_e>te)continue}else if(_e>0||_e<te)continue;const Oe=J*ee-K*ae,Be=ae*H-ee*se,Se=se*K-H*J,Te=p*Oe+f*Be+m*Se;if(te>0){if(Te<0||_e+Te>te)continue}else if(Te>0||_e+Te<te)continue;const Ie=(ce*Oe+le*Be+z*Se)/te;if(Ie>=0){const Ve=this.indices[g]+this.firstTriangleIndex,Ni=Xie(H,K,ee,ce,le,z,kSt);this.callback(Ie,Ni,Ve,!1)}}}zM.numFacesTested+=i-t}intersectRay(t,i){zM.numFacesTested=0;const r=Ze(t.r0[0],t.r0[1],t.r0[2]),s=Ze(t.r1[0],t.r1[1],t.r1[2]),n=s[0]-r[0],o=s[1]-r[1],a=s[2]-r[2];if(n*n+o*o+a*a<mI)return;this.rayOrigin=r;const l=this.rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this.callback=i;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(t,i,r){const s=this.rayOrigin,n=this.rayDirection;if(!FSt(t.aabb,s,n))return;const o=t.axis,a=t.d;if(s[o]<a||n[o]<0){const l=i,c=t.midStartIndex;if(l<c){const h=t.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(t.midStartIndex,t.rightStartIndex),s[o]>a||n[o]>0){const l=t.rightStartIndex,c=r;if(l<c){const h=t.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}zM.numFacesTested=0;const kSt=$(),pE=[1/0,1/0,1/0],fE=[-1/0,-1/0,-1/0];function USt(e,t,i,r,s,n){let o=i,a=r;for(;o<a;){const c=e[o];t[6*c+s+3]<=n?++o:(--a,e[o]=e[a],e[a]=c)}let l=o;for(a=r;l<a;){const c=e[a-1];t[6*c+s]>=n?--a:(e[a-1]=e[l],e[l]=c,++l)}return{next:o,mid:l}}function zSt(e,t,i,r){if(r<=i)return dS(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*e[i];for(let n=0;n<3;++n)pE[n]=t[s+0+n],fE[n]=t[s+3+n]}for(let s=i+1;s<r;++s){const n=6*e[s];for(let o=0;o<3;++o)pE[o]=Math.min(pE[o],t[n+0+o]),fE[o]=Math.max(fE[o],t[n+3+o])}return dS(pE[0],pE[1],pE[2],fE[0],fE[1],fE[2])}function VSt(e){const t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2],s=t>i?t>r?0:i>r?1:2:i>r?1:r>t?2:0;return{axis:s,midValue:(e[s]+e[s+3])/2}}function BSt(e,t,i,r,s){const n=i-t,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+t),c=e[l+0]*s,h=e[l+1]*s,p=e[l+2]*s;for(let f=0;f<3;++f){const m=r[c+f],g=r[h+f],y=r[p+f];o[6*a+f]=Math.min(m,g,y),o[6*a+3+f]=Math.max(m,g,y)}}return o}function GSt(e,t,i,r){const s=r-i;let n=0;for(let a=i;a<r;++a)for(let l=0;l<3;++l)n=Math.max(t[3*a+l],n);const o=n<=DIe?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(e[a]+i);for(let c=0;c<3;++c){const h=t[l+c];o[3*a+c]=h}}return o}const DIe=65535;class tse extends wRe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=$(),this.origin=this.slicePlaneLocalOrigin}}var Gh,ua;(function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight"})(Gh||(Gh={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.Depth=2]="Depth",e[e.Normal=3]="Normal"}(ua||(ua={}));class jSt extends tse{constructor(){super(...arguments),this.identifier=Gh.Material,this.transparent=!1,this.integratedMesh=!1}}class HSt extends tse{constructor(){super(...arguments),this.identifier=Gh.ShadowMap}}class qSt extends tse{constructor(){super(...arguments),this.identifier=Gh.Highlight}}class gV extends $s{constructor(t,i){super(t,"vec4",ar.Draw,(r,s,n)=>r.setUniform4fv(t,i(s,n)))}}var cv;(function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"})(cv||(cv={}));class WSt extends Nn{constructor(){super(...arguments),this.overlayOpacity=1}}function xme(e,t){e.vertex.uniforms.add([new Gl("overlayTexOffset"),new Gl("overlayTexScale")]),e.fragment.uniforms.add([new lt("overlayOpacity",i=>i.overlayOpacity),new oi("ovColorTex",(i,r)=>r.overlays.length===0?null:r.overlays[_s.INNER].getColorTexture(i.overlaySource))]),NIe(e,t)}function ZSt(e,t){const{vertex:i,fragment:r}=e;i.uniforms.add([new gV("overlayTexOffset",(s,n)=>XSt(s,n)),new gV("overlayTexScale",(s,n)=>YSt(s,n))]),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new oi("ovColorTex",(s,n)=>EJ(s,n))),NIe(e,t)}function NIe(e,t){e.extensions.add("GL_OES_standard_derivatives"),t.pbrMode!==Gt.Water&&t.pbrMode!==Gt.WaterOnIntegratedMesh||e.include(CRe,t);const{vertex:i,fragment:r}=e;e.varyings.add("vtcOverlay","vec4"),i.code.add(E`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(E`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(E`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),t.pbrMode!==Gt.Water&&t.pbrMode!==Gt.WaterOnIntegratedMesh||(r.uniforms.add([new Dt("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new Dt("lightingMainIntensity",(s,n)=>n.lighting.mainLight.intensity)]),r.code.add(E`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function EJ(e,t){return t.overlays.length===0?null:e.identifier===Gh.Material&&e.subPass===ua.Color?t.overlays[_s.INNER].getColorTextureNoRasterImage():e.identifier===Gh.Highlight?t.overlays[_s.INNER].getValidTexture(on.Highlight):null}function XSt(e,t){for(const i of t.overlays){const{index:r,extent:s}=i;n1e(s)>0&&(EA[2*r]=e.toMapSpace[0]/zh(s)-s[0]/zh(s),EA[2*r+1]=e.toMapSpace[1]/nm(s)-s[1]/nm(s))}return EA}function YSt(e,t){for(const i of t.overlays){const{index:r,extent:s}=i;n1e(s)>0&&(EA[2*r]=e.toMapSpace[2]/zh(s),EA[2*r+1]=e.toMapSpace[3]/nm(s))}return EA}const EA=si();function JSt(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),t.spherical?e.vertex.code.add(E`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(E`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(E`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function QSt(e,t){e.varyings.add("vtc","vec2"),e.vertex.uniforms.add(new Gl("texOffsetAndScale")),e.fragment.uniforms.add(new ws("tex")),e.fragment.uniforms.add(new Lc("textureOpacities"));const i=t.textureFadingEnabled&&!t.renderOccluded;i&&(e.vertex.uniforms.add(new Gl("nextTexOffsetAndScale")),e.varyings.add("nvtc","vec2"),e.fragment.uniforms.add(new ws("texNext")),e.fragment.uniforms.add(new Lc("nextTexOpacities")),e.fragment.uniforms.add(new nr("fadeFactor")));const r=t.tileBlendInput===Ba.ColorComposite,s=t.tileBlendInput===Ba.GridComposite;s&&e.fragment.include(qre),r&&e.fragment.uniforms.add(new Lc("backgroundColor")),e.vertex.code.add(E`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${i?E`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:E``}
  }`),e.fragment.code.add(E`
    vec4 applyBaseOpacity(vec4 _color, vec3 _opacities) {
      return _opacities.z <= 0.0 ? _color : _color * _opacities.x;
    }

    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${s||r?E`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = ${r?E`vec4(backgroundColor, 1.0)`:E`gridColor(uv)`} * opacities.y;
              float alpha = opacities.z * color.a;
              return mix(bg, color, alpha) * opacities.x;`:E`return color;`}
    }`),i?e.fragment.code.add(E`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):e.fragment.code.add(E`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}class FIe extends WSt{}function KSt(e){const t=new mr;t.include(XRe,{name:"Terrain Shader",output:e.output}),t.attributes.add(P.POSITION,"vec3"),t.attributes.add(P.UV0,"vec2"),t.attributes.add(P.NORMAL,"vec3");const{vertex:i,fragment:r}=t;if(i.uniforms.add([new Xr("proj",(s,n)=>n.camera.projectionMatrix),new QY("view",(s,n)=>Zl(Tme,n.camera.viewMatrix,s.origin)),new ql("origin",s=>s.origin)]),r.uniforms.add(new ql("origin",s=>s.origin)),e.output===oe.Color){t.include(Ua),t.include(ob,e),t.include(QSt,e),t.include(FS,e);const s=e.overlayMode!==cv.Disabled,n=e.overlayMode===cv.EnabledWithWater;s&&t.include(xme,me(F({},e),{pbrMode:Gt.Water})),n&&t.include(JSt,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),(e.atmosphere||e.screenSizePerspective)&&i.uniforms.add(new Xr("viewNormal",(a,l)=>l.camera.viewInverseTransposeMatrix));const o=e.receiveShadows&&!e.renderOccluded;o&&t.varyings.add("linearDepth","float"),e.tileBorders&&t.varyings.add("vuv","vec2"),e.atmosphere&&(i.uniforms.add(new Dt("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection)),t.varyings.add("wnormal","vec3"),t.varyings.add("wlight","vec3")),e.screenSizePerspective&&(t.varyings.add("screenSizeDistanceToCamera","float"),t.varyings.add("screenSizeCosAngle","float")),i.code.add(E`
      void main(void) {
        vpos = position;
        vnormal = ${e.shading?E`normal`:E`getLocalUp(vpos, origin)`};
        vec2 uv = uv0;
        ${e.atmosphere?E`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${e.tileBorders?E`vuv = uv;`:""}
        ${e.screenSizePerspective?E`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${o?E`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${s?E`setOverlayVTC(uv);`:""}
        ${n?E`forwardVertexTangent(vnormal);`:E``}
      }
    `),t.extensions.add("GL_OES_standard_derivatives"),t.extensions.add("GL_EXT_shader_texture_lod"),t.include(Qs,e),t.include(FS,e),t.include(KL,e),t.include(NS,e),r.uniforms.add([new ql("cameraPosition",(a,l)=>xe(Q7,l.camera.eye,a.origin)),new Dt("viewDirection",(a,l)=>Re(Q7,he(Q7,l.camera.viewMatrix[12],l.camera.viewMatrix[13],l.camera.viewMatrix[14]))),new lt("lightingGlobalFactor",(a,l)=>l.lighting.globalFactor),new Dt("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection),new Dt("lightingMainIntensity",(a,l)=>l.lighting.mainLight.intensity)]),r.constants.add("ambientBoostFactor","float",xO),n&&r.uniforms.add([new oi("ovWaterTex",(a,l)=>l.overlays.length===0?null:l.overlays[_s.INNER].getNormalTexture(a.overlaySource)),new QY("view",(a,l)=>Zl(Tme,l.camera.viewMatrix,a.origin))]),r.code.add(E`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),r.code.add(E`
      void main() {
        ${o?E`float shadow = readShadowMap(vpos, linearDepth);`:E`float shadow = 0.0;`}
        vec3 normal = normalize(vnormal);
        float vndl = dot(normal, lightingMainDirection);
        float ssao = evaluateAmbientOcclusionInverse();
        vec4 tileColor = getTileColor();
        ${s?E`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${e.atmosphere?E`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${e.atmosphere?E`atm + tileColor.rgb;`:E`tileColor.rgb;`}

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl${e.shading?"":E`*2.5`}, 0.0, 1.0));

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor ${e.shading?"":E`* lightingGlobalFactor`};

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${n?E`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + origin);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${e.screenSizePerspective?E`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${e.tileBorders?E`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}return e.output!==oe.Depth&&e.output!==oe.Shadow||(t.include(Ua,{hasModelTransformation:!1,linearDepth:!0}),t.include(tw,{output:e.output}),t.include(ob,e),t.varyings.add("linearDepth","float"),i.uniforms.add(new Di("nearFar",(s,n)=>n.camera.nearFar)),i.code.add(E`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(E`void main() {
outputDepth(linearDepth);
}`)),e.output===oe.Normal&&(t.include(Ua),t.include(ob,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),i.uniforms.add(new Xr("viewNormal",(s,n)=>n.camera.viewInverseTransposeMatrix)),i.code.add(E`
        void main(void) {
          vec3 normal = ${e.shading?E`normal`:E`getLocalUp(position, origin)`};
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
          vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
        }
    `),r.code.add(E`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`)),e.output===oe.Highlight&&(t.include(Ua),t.include(ob,e),t.include(xme,e),i.code.add(E`void main() {
setOverlayVTC(uv0);
gl_Position = transformPosition(proj, view, position);
}`),t.include(Bv),r.code.add(E`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`)),t}const Tme=Ne(),Q7=$(),e2t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:FIe,build:KSt},Symbol.toStringTag,{value:"Module"}));class x8 extends Lr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(t,i){i.spherical=t.viewingMode===tt.Global}initializeProgram(t){const i=x8.shader.get().build(this.configuration);return new Er(t.rctx,i,lr)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(t){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return ri({blending:i.renderOccluded?my(ke.ONE,ke.ONE_MINUS_SRC_ALPHA):null,culling:r&&Jte,depthTest:!i.renderOccluded&&{func:Fr.LESS},depthWrite:!i.renderOccluded&&jc,colorWrite:xi,stencilTest:t?Omt(Fc.IntegratedMeshMaskExcluded):null})}getPipelineState(t,i){return this.useStencil?this._stencilPipelineState:super.getPipelineState(t,i)}}x8.shader=new Sr(e2t,()=>import("./Terrain.glsl.c39a21fd.js"));class vn extends al{constructor(){super(...arguments),this.output=oe.Color,this.overlayMode=cv.Disabled,this.tileBlendInput=Ba.LayerOnly,this.spherical=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.tileBorders=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.shading=ye("enable-feature:terrain-shading")}}u([Q({count:oe.COUNT})],vn.prototype,"output",void 0),u([Q({count:cv.COUNT})],vn.prototype,"overlayMode",void 0),u([Q({count:Ba.COUNT})],vn.prototype,"tileBlendInput",void 0),u([Q()],vn.prototype,"spherical",void 0),u([Q()],vn.prototype,"atmosphere",void 0),u([Q()],vn.prototype,"receiveShadows",void 0),u([Q()],vn.prototype,"hasSlicePlane",void 0),u([Q()],vn.prototype,"backfaceCullingEnabled",void 0),u([Q()],vn.prototype,"stencilEnabled",void 0),u([Q()],vn.prototype,"textureFadingEnabled",void 0),u([Q()],vn.prototype,"renderOccluded",void 0),u([Q()],vn.prototype,"hasScreenSpaceReflections",void 0),u([Q()],vn.prototype,"hasCloudsReflections",void 0),u([Q()],vn.prototype,"tileBorders",void 0),u([Q()],vn.prototype,"screenSizePerspective",void 0),u([Q()],vn.prototype,"receiveAmbientOcclusion",void 0),u([Q()],vn.prototype,"shading",void 0),u([Q({constValue:!0})],vn.prototype,"isGround",void 0),u([Q({constValue:Gt.Disabled})],vn.prototype,"pbrMode",void 0),u([Q({constValue:!1})],vn.prototype,"highStepCount",void 0),u([Q({constValue:!1})],vn.prototype,"useCustomDTRExponentForWater",void 0),u([Q({constValue:!1})],vn.prototype,"useFillLights",void 0);const K7=7,t2t=10,eH=In(),YF=si();let mh=class extends Ee{constructor(e){super(e),this.type=xs.TERRAIN,this.isGround=!0,this.tileSize=256,this._techniqueConfiguration=new vn,this._passParameters=new FIe,this.rctx=null,this._isTransparent=!1,this._scaleRangeQueries=new uSt,this.renderDataPool=new un(H0),this._patchGroups=new Map,this.patchGroupsDirty=!0,this.tileIterator=new hIe,this.highestVisibleLODTile=null,this.visible=!0,this._opaque=!0,this._velvetOverground=!0,this._castShadows=!0,this.emptyTex=null,this.tileRenderer=null,this.stencilEnabledLayerExtents=[],this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=rs.Occlude}get isGlobal(){return this.stage.viewingMode===tt.Global}get shadingEnabled(){var e;return(e=this._techniqueConfiguration)==null?void 0:e.shading}initialize(){const e=[$e.OPAQUE_TERRAIN,$e.TRANSPARENT_TERRAIN,$e.OCCLUDED_TERRAIN];this.stage.addRenderPlugin(e,this)}destroy(){this.stage.removeRenderPlugin(this),Jxt()}get canRender(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setNeedsRender()}set opaque(e){this._opaque!==e&&(this._opaque=e,this.setNeedsRender())}get opaque(){return this._opaque&&!this._techniqueConfiguration.hasSlicePlane}get needsLinearDepth(){return this.overlayRenderer.hasWater}set isTransparent(e){this._isTransparent!==e&&(this._isTransparent=e,this.setNeedsRender())}get isTransparent(){return this._isTransparent}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this.setNeedsRender()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return Rf}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}toggleShading(){this._techniqueConfiguration.shading=!this._techniqueConfiguration.shading,this.setNeedsRender()}setRootTiles(e){this._rootTiles=e,this.setNeedsRender()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?eV:rs.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this.stencilEnabledLayerExtents=e,this.setNeedsRender()}setTileSize(e){this.tileSize=e,_(this.tileRenderer)&&(this.tileRenderer.tileSize=e),this.setNeedsRender()}_prepareTileForLoading(e){e.renderData||(e.renderData=this.renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometry(e),this.updateTileTexture(e,It.TEXTURE_FADING)}queryVisibleLevelRange(e,t,i,r){this._scaleRangeQueries.queryVisibleLevelRange(e,t,i,r),this.setNeedsRender()}updateTileTexture(e,t){_(this.tileRenderer)&&(this.tileRenderer.updateTileTexture(e,t===It.TEXTURE_FADING?No.FADING:No.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){this._prepareTileForLoading(e),e.renderData.updateGeometryStateAndPrepareForGeometryGeneration(this.wireframe)}updateTileGeometry(e){for(const t of e.layerInfo[gi.ELEVATION])t.pendingUpdates&=~It.GEOMETRY;e.resetPendingUpdate(It.GEOMETRY),e.renderData.updateGeometryIfChanged(this.rctx,this.wireframe)&&this.setNeedsRender()}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this.renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setNeedsRender())}_getLocalOriginOfTile(e){const t=t2t-K7,i=Math.max(0,Math.floor((e.level-t)/K7)*K7);if(this.isGlobal&&i===0)return Hl;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this.visible=e,this.setNeedsRender()}getStats(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numOriginsRendered:this.numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.allTiles.forAll(t=>{t.isLoaded&&(this.updateTileGeometry(t),t.updateNeighborsAfterGeometryChange())}),this.setNeedsRender())}setNeedsRender(e=An.UPDATE){this.patchGroupsDirty=!0,this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this.rctx=e.renderContext.rctx,this._techniqueRepository=e.shaderTechniqueRepository,this.tileRenderer=new $St(this.rctx,this.tileSize,this._techniqueRepository),this.updateTileBackground(),this.emptyTex=HCe(this.rctx)}uninitializeRenderContext(){this.emptyTex=ht(this.emptyTex),this.tileRenderer=ht(this.tileRenderer)}intersect(e,t,i,r){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&!this._opaque)return;const s=r2t,n=s2t;xe(s,r,i),he(n,1/s[0],1/s[1],1/s[2]);const o=e.results.min,a=e.results.max,l=e.results.ground,c=e.options.store===Vo.MIN,h=!!e.results.ground.target,p=Rlt(e.verticalOffset),f=e.tolerance;let m,g=c&&_(o.dist)?o.dist:1/0;const y=b=>{const S=b.renderData;if(!(S==null?void 0:S.vao))return;const T=S.geometryInfo;QV(eH,T.boundingBox);const C=S.localOrigin;_(p)&&(p.localOrigin=C,p.applyToAabb(eH));const A=eH;if(mE[0]=i[0]-C[0],mE[1]=i[1]-C[1],mE[2]=i[2]-C[2],!Jie(A,mE,n,f,g))return;const O=(K,ee,ce)=>{K.set(this.type,b,ee,ce,Xn),g=c&&_(o.dist)?o.dist:1/0},D=(K,ee)=>{if(_(ee)&&K>=0&&(e.options.backfacesTerrain||Pe(ee,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||t==null||t(i,r,K))){if((l.dist==null||K<l.dist)&&O(l,K,ee),e.options.isFiltered)return;e.options.store===Vo.ALL&&(M(m)?(m=Aie(e.ray),O(m,K,ee),e.results.all.push(m)):K<m.dist&&O(m,K,ee)),(o.dist==null||K<o.dist)&&O(o,K,ee),e.options.store!==Vo.MIN&&(a.dist==null||K>a.dist)&&O(a,K,ee)}},U=n2t;xe(U,r,C);const k=T.indices,B=T.vertexAttributes,j={data:B.getField(P.POSITION,fr).typedBuffer,size:3,stride:B.stride/4},H=T.indexCount/3;if(M(p)&&H>LIe){const K=b.renderData;M(K.intersectionData)&&(K.intersectionData=new zM(k,0,H,j)),K.intersectionData.intersectRay({r0:mE,r1:U},D)}else zL(mE,U,0,H,k,j,null,p,D)},x=this._rootTiles;_(x)&&(()=>{const b=this.tileIterator;b.reset(x);const S=e.options.invisibleTerrain;for(;!b.done;){const T=b.next();!(T.visible||S&&T.intersectsClippingArea)||!_(p)&&!T.intersectsRay(i,s,f,g)||h&&this._useStencilForTile(T)?b.skipSubtree():y(T)}})()}prepareTechnique(e){if(e.bindParameters.slot===$e.OCCLUDED_TERRAIN){if((e.renderOccludedMask&eV)==0)return null}else{const t=this.opaque?$e.OPAQUE_TERRAIN:$e.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==t)return null}switch(e.pass){case rt.MATERIAL:{this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=_(e.bindParameters.clouds.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.ready,this._techniqueConfiguration.overlayMode=this.overlayRenderer.isEmpty()?cv.Disabled:this.overlayRenderer.hasWater?cv.EnabledWithWater:cv.Enabled;const t=e.bindParameters.slot===$e.OCCLUDED_TERRAIN?Fl.Occluded:Fl.ColorAndWater;return this._updateTechnique(oe.Color,t===Fl.Occluded)}case rt.MATERIAL_DEPTH_SHADOWMAP_ALL:case rt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(oe.Shadow,!1)):null;case rt.MATERIAL_DEPTH:return this.isTransparent&&this.overlayRenderer.isEmpty()?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(oe.Depth,!1));case rt.MATERIAL_NORMAL:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(oe.Normal,!1);case rt.MATERIAL_HIGHLIGHT:return this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(oe.Highlight,!1)):null}return null}render(e,t){const i=e.pass,r=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),t.useStencil=!1,i){case rt.MATERIAL:{const s=e.bindParameters.slot===$e.OCCLUDED_TERRAIN?Fl.Occluded:Fl.ColorAndWater;this._renderMaterialPass(e,t,s);break}case rt.MATERIAL_DEPTH_SHADOWMAP_ALL:case rt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:this._castShadows&&r&&this._renderAuxiliaryPass(e,t,Fl.None);break;case rt.MATERIAL_DEPTH:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(e,t,Fl.None);break;case rt.MATERIAL_NORMAL:this._renderAuxiliaryPass(e,t,Fl.None);break;case rt.MATERIAL_HIGHLIGHT:this.needsHighlight&&(this._renderAuxiliaryPass(e,t,Fl.Highlight),e.rctx.clearSafe(wr.DEPTH_BUFFER_BIT))}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()}_renderMaterialPass(e,t,i){const{rctx:r}=e;this._passParameters.overlaySource=i,r.bindTechnique(t,this._passParameters,e.bindParameters),this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this._scaleRangeQueries.prepareQueries(),this.opaque?this._renderPatchGroups(e,t,i):e.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(e,t,i),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._scaleRangeQueries.processQueries()}_renderAuxiliaryPass(e,t,i){const r=e.rctx;this._passParameters.overlaySource=i,r.bindTechnique(t,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,t,i)}updateTileBackground(e=null){if(M(this.tileRenderer))return;const t=this.tileRenderer;let i=null;if(_(e)){const r=Le.toUnitRGBA(e);i=Ze(r[0]||0,r[1]||0,r[2]||0)}t.setBackground(i),this.allTiles.forAll(r=>t.updateTileTexture(r,No.FADING)),this._techniqueConfiguration.tileBlendInput=t.backgroundIsGrid?Ba.GridComposite:_(t.backgroundColor)?Ba.ColorComposite:Ba.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this.patchGroupsDirty){if(this.highestVisibleLODTile=null,this._rebuildPatchGroups(),this.renderOrder!==q$.NONE){const e=Array.from(this._patchGroups.values());e.forEach(t=>pIe(this.renderOrder,t)),e.sort((t,i)=>fIe(t[0],i[0],this.renderOrder)),this._patchGroups=new Map(e.map(t=>[t[0].renderData.localOrigin,t]))}this.patchGroupsDirty=!1}}_rebuildPatchGroups(){var t;const e=this._rootTiles;if(!M(e)){(t=e[0])==null||t.surface.checkAllTileWaterproofness(),this._patchGroups.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const t=this.tileIterator;for(t.resetOne(e);!t.done;){const i=t.next(),r=i.renderData;if(!r||i.visible)if(i.rendered){if(r){const s=this._patchGroups.get(r.localOrigin)||new Array;this._patchGroups.set(r.localOrigin,s),s.push(i),(!this.highestVisibleLODTile||i.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=i),t.skipSubtree()}}else this.numTilesCulled++;else this.numTilesCulled++,t.skipSubtree()}}_useStencilForTile(e){for(const t of this.stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,i){const r=this.stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(s=>{const n=s[0].renderData.localOrigin;t.program.bindDraw(new sJ(n),e.bindParameters);for(let o=0;o<s.length;o++)this._renderPatch(e,t,s[o],Wt.TRIANGLES,r,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,t,i){const r=e.rctx,s=e.bindParameters.camera,n=t.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const h=zMe(this.stage.viewingMode,this.ellipsoidRadius),p=this.pointsOfInterest.centerOnSurfaceFrequent.distance;h.update({distance:p,fovY:s.fovY})}const o=this.stencilEnabledLayerExtents.length>0,a=i===Fl.Occluded;a&&(n.bindTexture("tex",this.emptyTex),n.setUniform1f("blend",1),n.setUniform4fv("texOffsetAndScale",Dg));const l=_(this.tileRenderer)&&_(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:Hl;this._techniqueConfiguration.tileBlendInput===Ba.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?Wt.LINES:Wt.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this.emptyTex),this._patchGroups.forEach(h=>{const p=h[0].renderData.localOrigin;t.program.bindDraw(new sJ(p),e.bindParameters),this.numOriginsRendered++;for(let f=0;f<h.length;f++){const m=h[f],g=m.renderData.textureReference;if(!M(g)){if(!a){this._scaleRangeQueries.scaleQueriesForTile(m),Sme(m.renderData.geometryInfo.uvOffsetAndScale,g.offsetAndScale,YF),n.setUniform4fv("texOffsetAndScale",YF),n.bindTexture("tex",g.texture.texture);const y=m.renderData.textureFadeFactor,x=y<1?m.renderData.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&_(x)&&y<1?(Sme(m.renderData.geometryInfo.uvOffsetAndScale,x.offsetAndScale,YF),n.setUniform1f("fadeFactor",y),n.setUniform4fv("nextTexOffsetAndScale",YF),n.setUniform3fv("nextTexOpacities",x.opacities),n.bindTexture("texNext",x.texture.texture)):n.setUniform1f("fadeFactor",1),m.renderData.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",g.opacities)}this._renderPatch(e,t,m,c,o,i),m.renderOrder=this.numTilesRendered,this.numTilesRendered++}}}),r.bindVAO(null)}_renderPatch(e,t,i,r,s,n){const o=i.renderData,a=o.vao,l=a.indexBuffer;if(M(l))return;const c=t.program;n!==Fl.None&&this._bindOverlayPatchData(c,o.overlay),s&&(t.useStencil=this._useStencilForTile(i),t.bindPipelineState(e.rctx,e.bindParameters.slot));const h=o.geometryInfo.indexCount;e.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),e.rctx.drawElements(r,h,l.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_updateTechnique(e,t){return this._techniqueConfiguration.output=e,e===oe.Color&&(this._techniqueConfiguration.atmosphere=this.isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=t,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(x8,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this.tileRenderer}}};u([d({constructOnly:!0})],mh.prototype,"overlayRenderer",void 0),u([d({constructOnly:!0})],mh.prototype,"stage",void 0),u([d({readOnly:!0})],mh.prototype,"isGlobal",null),u([d({constructOnly:!0})],mh.prototype,"allTiles",void 0),u([d({constructOnly:!0})],mh.prototype,"ellipsoidRadius",void 0),u([d({value:!1})],mh.prototype,"renderingDisabled",null),u([d()],mh.prototype,"renderPatchBorders",null),u([d()],mh.prototype,"cullBackFaces",null),u([d({value:q$.FRONT_TO_BACK})],mh.prototype,"renderOrder",null),u([d()],mh.prototype,"wireframe",null),mh=u([L("esri.views.3d.terrain.TerrainRenderer")],mh);const i2t=mh;function Sme(e,t,i){i[0]=e[0]*t[2]+t[0],i[1]=e[1]*t[3]+t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3]}const r2t=$(),s2t=$(),mE=$(),n2t=$();class o2t{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}let ig=class extends Ee{constructor(e){super(e),this._handles=new Nt}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(re(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=We(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(t=>!(!UI(t)||t.isRejected())&&!(t.isFulfilled()&&!a2t(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!((t==null?void 0:t.type)==="vector-tile"||hV(t)))),e)if(e.isResolved()){const t=g8(e,this.viewSpatialReference,this.viewingMode);if(_(t)){const i=new ms(t.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===tt.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=ms.makeWebMercatorAuxiliarySphere(t):fS(e.spatialReference)&&(e=ms.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(re(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===tt.Global){const e=this.extentHelper.viewSpatialReference,t=fS(e)||ay(e)||ly(e);e.isWebMercator?this.tilingScheme=ms.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=ms.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;_(e)&&!jT(e,this.extent)&&(this.tilingScheme=ms.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function a2t(e,t,i){return _(g8(e,t,i))}u([d()],ig.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],ig.prototype,"extent",void 0),u([d({value:!1})],ig.prototype,"tilingSchemeLocked",void 0),u([d({constructOnly:!0})],ig.prototype,"viewSpatialReference",void 0),u([d({constructOnly:!0})],ig.prototype,"layers",void 0),u([d({constructOnly:!0})],ig.prototype,"extentHelper",void 0),u([d({constructOnly:!0})],ig.prototype,"viewingMode",void 0),ig=u([L("esri.views.3d.terrain.TilingSchemeLogic")],ig);class l2t{constructor(){this.offset=Ke(),this.scale=0,this.tile=null}init(t,i,r,s){this.tile=t,this.offset[0]=i,this.offset[1]=r,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}const Gp=ve.getLogger("esri.views.3d.terrain.TerrainSurface"),c2t=.25;let Si=class extends cs.EventedMixin(Ee){constructor(e){var t,i;super(e),this._elevationBounds=new Gre,this._iteratorPool=new un(hIe,r=>r.remove=()=>this._iteratorPool.release(r)),this._postorderIterator=new iTt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visible=!1,this._usedMemory=null,this._performanceInfo=new o2t,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=$(),this._eyePosSurfaceSR=$(),this._splitLimits=new RTt,this._snapLevel=1/0,this._frustum=C$(),this._viewProjectionMatrix=Ne(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Nt,this._watchUpdatingTracking=new Lg,this._frameTask=hM,this._allTiles=new ai,this._upsampleInfoPool=new un(l2t),this._rootTilesExtent=Qt(),this._maxNumUpdating=1,this.maxTextureScale=1.2,this.backgroundColor=null,this._updatingRootTiles=!1,this.deferTileNeighborUpdate=!1,this.neighborTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._layerViewsDirty=!1,this._isGlobal=!((i=(t=e.view)==null?void 0:t.state)==null?void 0:i.isLocal)}initialize(){this._lercDecoder=Mxt(this.view.resourceController),this._tilePool=this.view.state.isLocal?new un(aSt):new un(lSt);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",s=>s.unloadMapData()),this._elevationQueryCache=new rIe(e.newCache("elevation-query")),this._set("overlayManager",new fc({surface:this})),this._handles.add([re(()=>this.overlayManager.hasHighlights,s=>this._renderer.setNeedsHighlight(s)),re(()=>this.overlayManager.rendersOccluded,s=>this._renderer.setRenderOccludedOverlay(s))],"overlayManager"),this._renderer=new i2t({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:Ri(this.view.spatialReference).radius,stage:this.view._stage,allTiles:this._allTiles}),this._handles.add([re(()=>this.baseOpacity,s=>{this._handleLayerViewChanges(),this._updateBaseOpacity(s)},fi),re(()=>this.hasCompositeBlendMode,()=>{this._updateBaseOpacity(this.baseOpacity)},fi),re(()=>this.renderingDisabled,()=>this._updateTransparentTerrain(),Ui),re(()=>this.backgroundColor,s=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(s)},fi),re(()=>this.view.pointsOfInterest,s=>{this._renderer.pointsOfInterest=s,this._watchUpdatingTracking.removeAll(),s&&this._watchUpdatingTracking.add(()=>s.focus.renderLocation,()=>()=>this._allTilesSorted=!1)}),re(()=>dr.TERRAIN_TILE_TREE_SHOW_TILES,s=>{s&&!this._treeDebugger?import("./TerrainTileTree3DDebugger.99b00296.js").then(({TerrainTileTree3DDebugger:n})=>{!this._treeDebugger&&dr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new n({view:this.view}))}):s||(this._treeDebugger=We(this._treeDebugger))},Et)]),this._extentHelper=jxt(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});const t=this.view.defaultsFromMap?new bS({getCollections:()=>{var s,n,o;return(o=(n=(s=this.view)==null?void 0:s.defaultsFromMap)==null?void 0:n.mapCollections)==null?void 0:o.map(({layers:a})=>a)},getChildrenFunction:s=>s&&"layers"in s?s.layers:null}):this.view.map.allLayers,i=new ig({layers:t,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",i),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Sg.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Sg.BASEMAP);const r=this.view.resourceController.scheduler;this._frameTask=r.registerTask(Ot.TERRAIN_SURFACE,this),this._handles.add([re(()=>this._extentHelper.stencilEnabledExtents,s=>this._renderer.setStencilEnabledLayerExtents(s),Et),re(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Ui),re(()=>this.extent,()=>this._updateRootTiles(),Et),this.view.on("resize",()=>this._viewChangeUpdate()),re(()=>{var o,a;const s=this.view,n=s.state;return[this.lodBias,this.lodSnapping,(a=(o=s.resourceController)==null?void 0:o.memoryController)==null?void 0:a.memoryFactor,n.camera,n.contentCamera,n.fixedContentCamera]},()=>this._viewChangeUpdate(),fi),re(()=>{var s,n;return(n=(s=this.view.qualitySettings)==null?void 0:s.tiledSurface)==null?void 0:n.textureFadeDuration},s=>this._renderer.textureFadingEnabled=s>0,Et),re(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Ui)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=br(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=We(this._upsampleMapCache),this._elevationQueryCache=We(this._elevationQueryCache),this._set("tilingSchemeLogic",We(this.tilingSchemeLogic)),this._extentHelper=We(this._extentHelper),this._basemapLayerViewHandles.forEach((e,t)=>this._unregisterTiledLayerView(t)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",We(this.overlayManager)),this._tilePool=We(this._tilePool),Wre.prune(),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),this._renderer=We(this._renderer),this._iteratorPool=We(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=We(this._upsampleInfoPool),Vxt(),MTt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var t,i;const e=(i=(t=this.view.pointsOfInterest)==null?void 0:t.contentCameraOnSurface)==null?void 0:i.scale;if(e){const r=this.view.state.contentCamera;let s=T6(this.view,r.eye,r.viewForward,r.up).tilt;s>90&&(s=180-s);const n=2*(s/90)**2,o=AMe(this.view,e)-n;Math.abs(this._snapLevel-o)>c2t&&(Math.round(o)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=o)}return Math.round(this._snapLevel)}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?LM.ON:LM.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if(M(t)||M(e))return null;const i=Qt(),r=VPe(t,i,e)?i:null,s=this._get("extent");return jT(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=i5(this.groundExtent,this._userClippingExtent,Qt()),t=this._get("extent");return jT(e,t)?t:e}get groundExtent(){return _(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||this._asyncWorkItems>0||!this._allTilesSorted||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get viewingMode(){return this.view.state.viewingMode}get ready(){return _(this.rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get spatialReference(){var e,t;return(t=(e=this.tilingScheme)==null?void 0:e.spatialReference)!=null?t:null}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._updateTransparentTerrain()}_updateTransparentTerrain(){var t,i;const e=!this.renderingDisabled&&!this.opaque;(i=(t=this.view)==null?void 0:t._stage)==null||i.renderView.setRenderParameters({transparentTerrain:e})}set velvetOverground(e){e!==this.velvetOverground&&(this._renderer.velvetOverground=e),this._set("velvetOverground",e)}set visible(e){e!==this._visible&&(this._visible=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}intersect(e,t,i,r){this._renderer.intersect(e,t,i,r)}getElevation(e,t,i,r){const s=this.getTileWithElevation(e,t,i,r,Ea);return M(s)?null:aIe(Ea[0],Ea[1],s.renderData.geometryState.samplerData)}getTileWithElevation(e,t,i,r,s=Ea){var o;const n=this.rootTiles;if(M(n)||!n.length||n[0].layerInfo[gi.ELEVATION].length===0)return null;if(s[0]=e,s[1]=t,s[2]=i,!Zn(s,r,s,(o=this.tilingScheme)==null?void 0:o.spatialReference))return Gp.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let a of n){if(!a.containsPoint(s))continue;for(;a&&!a.rendered&&!a.isLeaf;){let c=0;s[0]>.5*(a.extent[0]+a.extent[2])&&(c+=1),s[1]<.5*(a.extent[1]+a.extent[3])&&(c+=2),a=a.children[c]}const l=a.renderData;return(l?l.geometryState.samplerData:null)?a:null}return null}get elevationBounds(){return this._elevationBounds}getScale(e){if(this.tilingScheme){if(!Go(e,Ea,this.spatialReference))return Gp.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this.rootTiles;if(_(t)){for(let i of t)if(i==null?void 0:i.containsPoint(Ea)){for(;!i.isLeaf&&!i.rendered;){let r=0;Ea[0]>i.children[0].extent[2]&&(r+=1),Ea[1]<i.children[0].extent[1]&&(r+=2),i=i.children[r]}return this._getLodBiasCorrectedScale(i.level)}}}return 1e100}getSphereElevationBounds(e,t,i,r,s){var c;if(Ea[0]=e,Ea[1]=t,Ea[2]=i,Ea[3]=r,!Zn(Ea,s,Ea,(c=this.tilingScheme)==null?void 0:c.spatialReference))return Gp.error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let n=1/0,o=-1/0;const a=h=>{if(h&&woe(h.extent,Ea))if(h.isLeaf||h.rendered)n=Math.min(n,h.elevationBounds[0]),o=Math.max(o,h.elevationBounds[1]);else for(const p of h.children)a(p)},l=this.rootTiles;if(_(l))for(const h of l)a(h);return{min:n,max:o}}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!Go(e,Ea,this.spatialReference))return Gp.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Ea[3]=t;let i=null;const r=n=>{if(n&&woe(n.extent,Ea))if(n.isLeaf||n.rendered){const o=this._getLodBiasCorrectedScale(n.level);i=i==null?o:Math.min(i,o)}else for(const o of n.children)r(o)},s=this.rootTiles;if(_(s))for(const n of s)r(n);return i}queryVisibleScaleRange(e,t,i,r){const s=t?this.tilingScheme.levelAtScale(t):0,n=i?this.tilingScheme.levelAtScale(i):1/0,o=this.lodBias;this._renderer.queryVisibleLevelRange(e,s+o,n+o,r)}_updateBaseOpacity(e){const t=this._renderer.opaque;this._renderer.opaque=e>=1&&!this.hasCompositeBlendMode,this._renderer.isTransparent=this._allSurfaceLayersTransparent();const i=t!==this._renderer.opaque;i&&this._updateTransparentTerrain(),this._updateTileTextures(i?No.UNFADED:No.IMMEDIATE)}_updateTilingScheme(){var t,i;const e=this.tilingSchemeLogic.tilingScheme;e!==this.tilingScheme&&(_g(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((i=(t=this.view)==null?void 0:t.state)==null?void 0:i.isLocal),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles()))}_acquireTile(e,t,i,r){const s=this._tilePool.acquire();return JF[0]=e,JF[1]=t,JF[2]=i,s.init(JF,r,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const i=d2t;let r=t.rootTilesInExtent(e,i,5*UC);if(_(this.rootTiles)){if(r.length>UC)return void Gp.warn(Lit);const s=this.rootTiles.map(o=>o.lij),n=H4e(s,r,Eme);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this.rootTiles.filter(a=>!(n.removed.findIndex(l=>Eme(l,a.lij))>-1)||(this._purgeTile(a,!0),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>UC&&(Gp.warn(Dit),r=t.rootTilesInExtent(e,i,UC)),this._setRootTiles(r.map(s=>this._newRootTile(s)));jT(i,this._rootTilesExtent)||(this._rootTilesExtent=Qt(i)),this.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._allTiles.forEach(s=>{s.isLoaded&&this._prepareToLoadTile(s)}),this._allTiles.forAll(s=>{s.isLoaded&&(this._updateTileGeometry(s),this._updateTileNeighborsAfterGeometryChange(s))}),this._updatingRootTiles=!1,this.checkAllTileWaterproofness()}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===It.SPLIT&&t.setPendingUpdate(It.SPLIT),this._loadTile(t),this.deferTileNeighborUpdate||t.checkGeometryWaterproofness(),t}_setRootTiles(e){if(this._set("rootTiles",e),this._allTiles.clear(),_(e)){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this.rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this.rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(It.GEOMETRY)&&this._updateTileGeometry(e)}_updateTilesVisibility(e){if(M(e))return;const t=nTt(e);let i=t?this._elevationBounds.min:1/0,r=t?this._elevationBounds.max:-1/0;const s=this.view.state.fixedContentCamera,n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(e);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(It.GEOMETRY)&&this._updateTileGeometry(l),l.setPendingUpdate(It.RENDERDATA);const c=l.computeVisibility();s||c?(l.updateScreenDepth(o),l.renderData&&(i=Math.min(l.elevationBounds[0],i),r=Math.max(l.elevationBounds[1],r))):a.skipSubtree()}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,isFinite(i)&&isFinite(r)&&(this._elevationBounds.min===i&&this._elevationBounds.max===r||(this._elevationBounds.min=i,this._elevationBounds.max=r,this.emit("elevation-bounds-change",null)))}_updateViewDependentParameters(){const e=this.view.state.camera,t=this.view.state.contentCamera,i=Math.tan(.5*t.fovX),r=Math.tan(.5*t.fovY),s=this.tilingScheme.pixelSize,n=2**-this.lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(M(this._splitLimits.frustum)&&(this._splitLimits.frustum=C$()),Rz(this._splitLimits.frustum,t.frustum)):this._splitLimits.frustum=null,Rz(this._frustum,e.frustum),As(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),pe(this._eyePosRenderSR,t.eye),Zn(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(kIe(e)?(this._loadChildren(e),this.deferTileNeighborUpdate||(this._checkTileNeighborsWaterproofness(e),e.children.forEach(t=>t.checkGeometryWaterproofness()))):h2t(e)&&this._loadParent(e))}_updateTileGeometry(e){e.updateVisibility(),this._renderer.updateTileGeometry(e),this._updateTileNeighborsAfterGeometryChange(e),this._elevationUpdate(e),this._usedMemory=null,this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e)}_updateTileNeighborsAfterGeometryChange(e,t){if(this.deferTileNeighborUpdate){const i=this.neighborTilesToUpdate;e.forEachLoadedNeighbor(r=>{i.add(r)})}else e.updateNeighborsAfterGeometryChange(t)}_updateTileTexture(e,t){const i=e.resetPendingUpdate(It.TEXTURE_FADING)?It.TEXTURE_FADING:!!e.resetPendingUpdate(It.TEXTURE_NOFADING)&&It.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,t.madeProgress())}_elevationUpdate(e){QF.spatialReference=this.spatialReference,QF.tile=e,QF.extent=e.extent,this.emit("elevation-change",QF)}get running(){return this.updating&&this.ready&&!this.suspended}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateTileStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),e.run(()=>this._updateElevation(e)),e.run(()=>this._updateTextures(e)),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),e.done?this.requestUpdate():this._usedMemory=this._recalculateUsedMemory(),this.notifyChange("updatingProgressValue")}_updateTileStatus(e){if(!this._viewChanged||!this.rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();for(t.reset(this.rootTiles);!t.done;){const i=t.next();if(i.loadable){const r=i.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(r===It.SPLIT){i.resetPendingUpdate(It.MERGE),i.isLeaf&&(i.setPendingUpdate(It.SPLIT),t.skipSubtree());continue}i.resetPendingUpdate(It.SPLIT)&&i.updateAgentSuspension(),r===It.VSPLITMERGE&&i.updateAgents(gi.ELEVATION)}if(t.skipSubtree(),!i.isLeaf){i.setPendingUpdate(It.MERGE),i.resetPendingUpdate(It.SPLIT);const r=this._iteratorPool.acquire();r.resetOne(i);for(let s=r.next();!r.done;s=r.next())this._updateClippingStatus(s),s.updateVisibility(),s.loadable&&s.updateScreenDepth(this._viewProjectionMatrix);r.remove()}}t.remove(),this.requestUpdate(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(rTt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_prepareBatchTileGeometryUpdate(){this.neighborTilesToUpdate.size,this.deferTileNeighborUpdate=!0}_batchUpdateUpdatedTileNeighbors(){this.deferTileNeighborUpdate=!1;const e=this.neighborTilesToUpdate;(()=>{const t=()=>{for(const i of e)i.updateNeighborsWithChangedEdgeResolution()};(()=>{for(const i of e)i.updateNeighborDataAndGeometryIfNeeded()})(),t(),e.clear()})()}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate(),this._prepareBatchTileGeometryUpdate();let i=!1;for(;!e.done;){i=!0;let r=!1;const s=!this._allTiles.some(n=>{if(n.resetPendingUpdate(It.MERGE)){if(!t)return n.setPendingUpdate(It.MERGE),e.done;this._mergeTile(n),r=!0,e.madeProgress()}else n.resetPendingUpdate(It.SPLIT)&&(this._splitTile(n),r=!0,e.madeProgress());return!e.done&&n.resetPendingUpdate(It.RENDERDATA)&&(this._updateRenderData(n),e.madeProgress()),e.done});if(r&&(this._allTilesSorted=!1,this._allTilesDirty=!0),s){if(!r)break;this._updateTilesVisibility(this.rootTiles)}else this._allTilesDirty=!0}i||(this._allTilesDirty=!0),this._batchUpdateUpdatedTileNeighbors(),this._sortTiles(e)}_updateElevation(e){return this._prepareBatchTileGeometryUpdate(),this._allTiles.some(t=>(t.resetPendingUpdate(It.GEOMETRY)&&(this._updateTileGeometry(t),this._updateTileTexture(t,e),e.madeProgress()),e.done)),this._batchUpdateUpdatedTileNeighbors(),e.hasProgressed}_updateTextures(e){return this._allTiles.some(t=>(this._updateTileTexture(t,e),e.done)),e.hasProgressed}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(An.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*Pit}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,i=He(e-this.lodBias,0,t.length-1),r=i-Math.floor(i);return t[Math.floor(i)].scale*(1-r)+t[Math.ceil(i)].scale*r}_removeAllTiles(){_(this.rootTiles)&&(this.rootTiles.forEach(e=>this._purgeTile(e,!1)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.visible=!1}_purgeDescendantTiles(e){if(e.isLeaf)return!1;let t=!1;for(let i=0;i<4;++i)t=this._purgeTile(e.children[i],!1)||t;return e.unsetChildren(),t}_purgeTile(e,t){const i=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),t&&this._updateTileNeighborsAfterGeometryChange(e),this._tilePool.release(e),i}_unloadTile(e){this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e),e.unload(this._renderer)}_splitTile(e){_g(e.isLeaf,"tile that is already split should not be split again!");const t=e.level+1,i=2*e.lij[1],r=2*e.lij[2];e.setChildren(this._createTile(t,i,r,e),this._createTile(t,i,r+1,e),this._createTile(t,i+1,r,e),this._createTile(t,i+1,r+1,e)),e.setPendingUpdate(It.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,this._emitTileScaleChange(e,t),++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){KF.spatialReference=this.spatialReference,KF.extent=e.extent,KF.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",KF)}_createTile(e,t,i,r){_g(!!r,"_createTile sanity check");const s=this._acquireTile(e,t,i,r);return s.updateClippingStatus(this.extent),s.loadable&&(s.updateScreenDepth(this._viewProjectionMatrix),s.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===It.SPLIT&&s.setPendingUpdate(It.SPLIT)),s}_mergeTile(e){_g(!e.hasPendingUpdate(It.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(_g(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._updateTileNeighborsAfterGeometryChange(e),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e)),this._allTilesDirty=!0,++this._performanceInfo.numMerged,this._emitTileScaleChange(e)}_checkTileAndNeighborsWaterproofness(e){e.checkGeometryWaterproofness(),this._checkTileNeighborsWaterproofness(e)}_checkTileNeighborsWaterproofness(e){}_loadChildren(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e),_g(e.rendered,"parent should be rendered"),this._unloadTile(e);const t=e.children;t.forEach(i=>this._prepareToLoadTile(i)),t.forEach(i=>this._loadTilePrepared(i)),this._updateTileNeighborsAfterGeometryChange(e,e.level+1),this.deferTileNeighborUpdate||(t.forEach(i=>i.updateNeighborsWithChangedEdgeResolution()),t.forEach(i=>i.checkGeometryWaterproofness()),this._checkTileNeighborsWaterproofness(e))}_loadParent(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e);const t=e.parent;this._unloadChildren(t),this._loadTile(t),this._updateTileNeighborsAfterGeometryChange(t),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(t)}_unloadChildren(e){if(!e.isLeaf)for(let t=0;t<4;++t){const i=e.children[t];this._unloadChildren(i),this._unloadTile(i)}}_postLoadTile(e){e.setPendingUpdate(It.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e),this._elevationUpdate(e)}_loadTile(e){e.load(this._renderer),this._postLoadTile(e)}_loadTilePrepared(e){e.loadPrepared(this._renderer),this._postLoadTile(e)}_prepareToLoadTile(e){e.prepareToLoad(this._renderer)}_elevationDataArrived(e,t,i){const r=new Gxt(e.lij,e.extent,i);e.dataArrived(t,gi.ELEVATION,r);const s=[e],n=e.level,o=this._iteratorPool.acquire();for(o.reset(s);!o.done;){const a=o.next();a.findElevationBoundsForLayer(t,n),a.computeElevationBounds()}o.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=bO){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const i=new Set;let r=-1;for(const s of this.view.allLayerViews.items)if(i.add(s.uid),j$(s))if(this._basemapLayerViewHandles.has(s.uid)){const n=this._layerClassFromLayerView(s),o=this._getLayerIdxByUID(n,s.uid);_(o)&&((o<r||M(r))&&(t=!0),r=o)}else this._registerTiledLayerView(s),s.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach((s,n)=>{i.has(n)||(this._unregisterTiledLayerView(n),t=!0)}),t&&this._updateTiledLayers(),this._renderer.isTransparent=this._allSurfaceLayersTransparent(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),e.madeProgress()}_allSurfaceLayersTransparent(){var t,i;let e=((i=(t=this.view.map)==null?void 0:t.ground)==null?void 0:i.opacity)===0;for(const r of this.view.allLayerViews.items)if(wJ(r)&&!Kwe(r.layer)&&r.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if(dV(e)){const t=iIe(e.layer.parent)?"normal":e.layer.blendMode;if(aTt(Tk[t]))return!0}return!1}_layerClassFromLayerView(e){return bJ(e)?gi.ELEVATION:gi.MAP}_registerTiledLayerView(e){const t=[],i=this._layerClassFromLayerView(e);t.push(re(()=>e.suspended,()=>this._updateTiledLayers())),t.push(re(()=>e.fullOpacity,()=>this._updateTileTextures(No.UNFADED))),t.push(re(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),dV(e)&&t.push(re(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(No.UNFADED)})),e.on("data-changed",()=>{const r=this._getLayerIdxByUID(i,e.uid);_(r)&&this._invalidateLayerData(r,i)}),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(let i=0;i<t.length;i++)t[i].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let i=null;e.forEach(r=>{if(!r.layer||r.suspended||!j$(r)||!r.fullExtent)return;const s=this._layerClassFromLayerView(r);if(s===gi.MAP){const n=r.displayLevelRange.maxLevel;n!==1/0&&(i===null||n>i)&&(i=n)}t[s].push(r)});for(const r of Dx){const s=this._layerViews[r],n=t[r];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[r].clear();for(let h=0;h<o;h++){const p=n[h].uid;this._layerIndexByUid[r].set(p,h);const f=s.indexOf(n[h]);l[h]=f,h!==f&&(a=!0),f>-1&&(c[f]=h)}if(a){const h=this._postorderIterator;for(h.reset(this.rootTiles);!h.done;)h.next().modifyLayers(c,l,r);this._layerViews[r]=n,this._restartAllAgents(r),this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this.rootTiles);!t.done;){const i=t.next();i.restartAgents(e),e===gi.ELEVATION&&i.computeElevationBounds()}}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(t=>{t.updateAgents(gi.MAP),e===No.IMMEDIATE?this.renderer.updateTileTexture(t,It.TEXTURE_NOFADING):t.updateRenderData(gi.MAP,e)}),this._renderer.isTransparent=this._allSurfaceLayersTransparent()}_invalidateLayerData(e,t){this._allTiles.forAll(i=>i.removeLayerAgent(e,t)),this._allTiles.forAll(i=>i.invalidateLayerData(e,t))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=An.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,t,i,r){const s=this.layerViewByIndex(t,i),n=s.layer;return!n.tilemapCache||G$(s)?this._requestTileData(e,i,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],me(F({},r),{timeout:6e3})).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,as(o)||this._dataMissing(e,i,s,{notInTilemap:!0}),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,s,r),r.signal)))}_requestTileData(e,t,i,r){return t===gi.ELEVATION?bJ(i)?this._requestElevationTileData(e,i,r):Promise.reject():wJ(i)?this._requestMapTileData(e,i,r):Promise.reject()}_requestElevationTileData(e,t,i){++this._asyncWorkItems;const r=o=>{if(an(i))return;const a=this._layerIndexByUid[gi.ELEVATION].get(t.uid);a!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,a,o)):Gp.warn("TerrainSurface: received data from unknown layer %d %s",gi.ELEVATION,e.lij.toString())},s=o=>{as(o)||(this._dataMissing(e,gi.ELEVATION,t,o),this.requestUpdate())};if(Xfe(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:i$,signal:i.signal}).then(o=>{if(!an(i))return this._frameTask.schedule(()=>r(o),i.signal,s);Gp.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const n=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(n,"binary",i).then(o=>this._lercDecoder.decode(o,{noDataValue:i$},i.signal)).then(o=>{o?r({values:o.pixelData,width:o.width,height:o.height,noDataValue:o.noDataValue,minValue:o.minValue,maxValue:o.maxValue}):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,t,i){++this._asyncWorkItems;const r=(c,h)=>{--this._asyncWorkItems,xA(h),an(i)||(this._dataMissing(e,gi.MAP,t,c),this.requestUpdate())},s=c=>h=>r(h,c),n=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),an(i)?xA(c):this._mapTileDataArrived(e,t,c)},i.signal,s(c)).catch(s(c)),o=(c,h=null)=>this._frameTask.schedule(()=>r(c,h));if(G$(t)){const c=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(c[0],c[1],c[2],i).then(n,o)}if(m8(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(n,o);if(Vre(t)&&Xfe(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(c=>{if(an(i))return Gp.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(mi());n(c)},o);let a=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);MKe(t.layer)&&t.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${t.layer.refreshTimestamp}`);const l=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,i).then(n,o)}_mapTileDataArrived(e,t,i){const r=this._getLayerIdxByUID(gi.MAP,t.uid);_(r)?e.dataArrived(r,gi.MAP,i):(xA(i),Gp.warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,t){return this._layerIndexByUid[e].get(t)}_dataMissing(e,t,i,r){const s=this._getLayerIdxByUID(t,i.uid);_(s)?e.dataMissing(s,t,r):Gp.warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(t=>{t.renderData&&this.overlayManager.setTileParameters(t)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(t=>{t.isLeaf&&e.numLeaves++;const i=t.level;t.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(M(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),_(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,t)=>e+t.usedMemory,0):null}getUsedMemoryForLayerView(e){let t=0;const i=this._layerClassFromLayerView(e),r=this._getLayerIdxByUID(i,e.uid);return _(r)&&this._allTiles.forAll(s=>t+=s.getUsedMemoryForLayer(i,r)),t}getTile(e){if(M(e)||M(this.rootTiles))return null;const t=e.split("/").map(o=>+o);if(t[0]===0)return this.rootTiles.find(o=>o.lij[1]===t[1]&&o.lij[2]===t[2]);const i=2**t[0],r=Math.floor(t[1]/i),s=Math.floor(t[2]/i);let n;if(this.rootTiles.some(o=>o.lij[1]===r&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<t[0]-1;for(;n.lij[0]<t[0];){let a=t[1]&o?2:0;if((t[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return _g(n.lij[0]===t[0]&&n.lij[1]===t[1]&&n.lij[2]===t[2],"not the right tile?"),n}return null}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{_(e.rootTiles)&&(e._mergeTile(e.rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){tH.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&tH.push(i)});const t=tH.toArray();return pIe(e.renderOrder,t),t},lockTilingScheme(t,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(t)}}}checkAllTileWaterproofness(){}get isGlobal(){return this._isGlobal}get shadingEnabled(){return this._renderer.shadingEnabled}get isWebMercator(){var e;return!!((e=this.tilingScheme)==null?void 0:e.spatialReference.isWebMercator)}get isWebMercatorOnPlateeCarree(){var e;return this.isWebMercator&&P3((e=this.view)==null?void 0:e.renderSpatialReference)}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const t=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<t)return e;if(!this.isGlobal)return null;const r=(i+(i<0?t:0))%t;return[e[0],e[1],r]}};u([d()],Si.prototype,"_renderer",void 0),u([d()],Si.prototype,"_hasPendingUpdates",void 0),u([d()],Si.prototype,"_asyncWorkItems",void 0),u([d()],Si.prototype,"_allTilesDirty",void 0),u([d()],Si.prototype,"_allTilesSorted",void 0),u([d()],Si.prototype,"_viewChanged",void 0),u([d({readOnly:!0})],Si.prototype,"_watchUpdatingTracking",void 0),u([d()],Si.prototype,"_frameTask",void 0),u([d({readOnly:!0})],Si.prototype,"snapLevel",null),u([d({readOnly:!0})],Si.prototype,"lodSnapping",null),u([d({constructOnly:!0})],Si.prototype,"view",void 0),u([d()],Si.prototype,"_userClippingExtent",null),u([d()],Si.prototype,"_rootTilesExtent",void 0),u([d({readOnly:!0})],Si.prototype,"extent",null),u([d({readOnly:!0})],Si.prototype,"groundExtent",null),u([d({readOnly:!0})],Si.prototype,"_tilingSchemeExtent",null),u([d({readOnly:!0})],Si.prototype,"updating",null),u([d(Bxt)],Si.prototype,"updatingProgress",void 0),u([d({readOnly:!0})],Si.prototype,"updatingProgressValue",null),u([d()],Si.prototype,"_maxNumUpdating",void 0),u([d({aliasOf:"view.map.ground.opacity"})],Si.prototype,"baseOpacity",void 0),u([d()],Si.prototype,"hasCompositeBlendMode",void 0),u([d({readOnly:!0})],Si.prototype,"overlayManager",void 0),u([d({readOnly:!0})],Si.prototype,"viewingMode",null),u([d()],Si.prototype,"maxTextureScale",void 0),u([d({readOnly:!0})],Si.prototype,"ready",null),u([d({value:q$.FRONT_TO_BACK})],Si.prototype,"renderOrder",null),u([d({readOnly:!0})],Si.prototype,"rootTiles",void 0),u([d({readOnly:!0})],Si.prototype,"spatialReference",null),u([d({type:Le,aliasOf:"view.map.ground.surfaceColor"})],Si.prototype,"backgroundColor",void 0),u([d({value:!1})],Si.prototype,"slicePlaneEnabled",null),u([d({readOnly:!0})],Si.prototype,"tilingScheme",void 0),u([d({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],Si.prototype,"tilingSchemeLocked",void 0),u([d({readOnly:!0})],Si.prototype,"tilingSchemeLogic",void 0),u([d({value:!0})],Si.prototype,"velvetOverground",null),u([ze("_renderer.wireframe")],Si.prototype,"wireframe",void 0),u([d({value:!1})],Si.prototype,"suspended",null),u([d({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],Si.prototype,"textureFadeDuration",void 0),u([d()],Si.prototype,"_layerViewsDirty",void 0),u([ze("_renderer.renderPatchBorders")],Si.prototype,"renderPatchBorders",void 0),u([ze("_renderer.renderingDisabled")],Si.prototype,"renderingDisabled",void 0),Si=u([L("esri.views.3d.terrain.TerrainSurface")],Si);const u2t=Si;function Eme(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function kIe(e){return!e.isLeaf&&(e.children.some(t=>t.shouldLoad)||e.children.some(t=>kIe(t)))}function h2t(e){return e.isLeaf&&e.parent&&e.parent.shouldLoad}const Ea=si(),d2t=Qt(),JF=[0,0,0],tH=new ai,QF={spatialReference:null,tile:null,extent:null,context:"ground"},KF={spatialReference:null,extent:null,scale:0};let gI=class extends Ee{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commit(e){this.dirty=!1,this._dirtyGeomRecords.forEach((t,i)=>this.commitLayer(i,e))}commitLayer(e,t){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((r,s)=>{const n=this._ensureGeomRecord(e,s);r.forEach((o,a)=>{const l=o[0],c=o[1],h=o[2];let p=!1;if(c&wi.Geometry.UPDATE){const f=n.get(a);if(f){const m=f[1];if(h&wi.State.TRANSFORMATION){const g=this.model.getObject(s);this.model.updateRenderGeometryTransformation(g,l,m)&&(p=!0)}p||t.updates.push({renderGeometry:m,updateType:h})}else Ct(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(c&wi.Geometry.REMOVE||p){const f=n.get(a);f?(t.removes.push(f[1]),n.delete(a),f[0].disposed&&LS.pool.release(f[0])):c===wi.Geometry.REMOVE&&Ct(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(c&wi.Geometry.ADD||p){const f=this.model.getObject(s);if(_(f)){const m=this.model.getRenderGeometry(f,l),g=[l,m];t.adds.push(m),n.set(a,g)}}}),n.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e))}getResidentRenderGeometries(e,t){const i=this._residentGeomRecords.get(e);i&&i.forEach(r=>r.forEach(s=>t.push(s[1])))}_objectStateChanged(e,t){for(const i of t.geometryRecords)this._updateOrCreateDirtyRecord(t,i,null,wi.Geometry.UPDATE,0,0,wi.Geometry.UPDATE,wi.Geometry.ADD|wi.Geometry.REMOVE,e)}visibilityChanged(e){this._objectStateChanged(wi.State.VISIBILITIES,e)}highlightChanged(e){this._objectStateChanged(wi.State.HIGHLIGHTS,e)}occlusionChanged(e){this._objectStateChanged(wi.State.OCCLUDEES,e)}vertexAttrsUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.record,null,wi.Geometry.UPDATE,0,0,wi.Geometry.UPDATE,wi.Geometry.ADD|wi.Geometry.REMOVE,wi.State.VERTEXATTRS)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const i=e.id;for(const r of t.geometryRecords)this._objectGeometryAdded(t,r,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const i=e.id;for(const r of t.geometryRecords)this._objectGeometryRemoved(t,r,i)}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach((i,r)=>{const s=this.model.getObject(r);s&&s.hasVolativeTransformation()&&i.forEach(n=>{n[1].shaderTransformationChanged()})})}objectTransformation(e){const t=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(t,i).forEach(r=>{this._updateOrCreateDirtyRecord(e,r[0],t,wi.Geometry.UPDATE,0,0,wi.Geometry.UPDATE,wi.Geometry.ADD|wi.Geometry.REMOVE,wi.State.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.record)}_objectGeometryAdded(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,wi.Geometry.ADD,wi.Geometry.REMOVE,0,0,0)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.record)}_objectGeometryRemoved(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,wi.Geometry.REMOVE,wi.Geometry.ADD,wi.Geometry.UPDATE,0,0)}_updateOrCreateDirtyRecord(e,t,i,r,s,n,o,a,l){i=Ye(i,this._getParentLayerId(e));const c=e.id,h=t.id,p=this._ensureDirtyRecord(i,c),f=p.get(h);if(f){const m=f[1];m&s?(p.delete(h),f[0].disposed&&LS.pool.release(f[0])):m&n?(f[1]=r,f[2]=l):m&o?f[2]|=l:m&a||Ct(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")}else p.set(h,[t,r,l]);this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}get _hasDirtyGeometryRecords(){return Mn(this._dirtyGeomRecords,e=>Mn(e,t=>t&&t.size>0))}_ensureDirtyRecord(e,t){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}_getParentLayerId(e){return _(e.parentLayer)?e.parentLayer.id:ike}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach((i,r)=>{i.forEach((s,n)=>{t.length>0&&(t+=`
`),t+=r+"."+n;const o=[];s.forEach(a=>{const l=a[1];o[l]||(o[l]=[]),o[l].push(a[0].geometry.id)});for(let a=0;a<o.length;a++)if(o[a]){t+=" "+e[a-1]+": ";for(let l=0;l<o[a].length;l++)t+=o[a][l]+", "}})}),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((t,i)=>t+i.size,0)}}}};u([d({constructOnly:!0})],gI.prototype,"model",void 0),u([d()],gI.prototype,"dirty",void 0),gI=u([L("esri.views.3d.webgl-engine.lib.ModelDirtySet")],gI);const p2t=gI;let Mk=class extends Ee{constructor(){super(...arguments),this.dirtySet=new p2t({model:this}),this._content=new Map,this._originFactory=new vre(null,75e4)}getObject(e){return this._content.get(e)}add(e){const t=e.id;Ct(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),Yz(e)&&this.dirtySet.layerAdded(e)}remove(e){Ct(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),Yz(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const t of e)_(t)&&(Ct(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)Ct(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(i=>{i.type===e&&t(i)})}getRenderGeometry(e,t){const{geometry:i,material:r,id:s,shaderTransformation:n,origin:o,instanceParameters:a}=t,l=new FM(i,r,{id:s,boundingInfo:i.boundingInfo,calculateShaderTransformation:n,castShadow:e.castShadow});return l.updateTransformation(c=>e.getCombinedStaticTransformation(t,c)),l.origin=o||this._originFactory.getOrigin(l.boundingSphere),l.instanceParameters=a,l}updateRenderGeometryTransformation(e,t,i){if(M(e))return!1;i.updateTransformation(s=>e.getCombinedStaticTransformation(t,s));const r=this._originFactory.getOrigin(i.boundingSphere);return i.origin!==r}getStats(){const e={},t=Array.from(this._content.values());for(let i=0;i<um.COUNT;++i)e[i]=t.filter(r=>r.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([d({constructOnly:!0})],Mk.prototype,"dirtySet",void 0),Mk=u([L("esri.views.3d.webgl-engine.parts.Model")],Mk);function UIe(){const e=new Float32Array(4);return e[3]=1,e}function zIe(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function f2t(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function VIe(e,t){return new Float32Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:UIe,clone:zIe,fromValues:f2t,createView:VIe},Symbol.toStringTag,{value:"Module"}));const Zs=!0,kT={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function ise(e,t,i){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,i+kT.identifierOffset,kT.identifierLength)),version:t.getUint16(i+kT.versionOffset,Zs),checksum:t.getUint32(i+kT.checksumOffset,Zs)}}const uu={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function m2t(e,t){return{sizeLo:e.getUint32(t+uu.sizeLo,Zs),sizeHi:e.getUint32(t+uu.sizeHi,Zs),minX:e.getFloat64(t+uu.minX,Zs),minY:e.getFloat64(t+uu.minY,Zs),minZ:e.getFloat64(t+uu.minZ,Zs),maxX:e.getFloat64(t+uu.maxX,Zs),maxY:e.getFloat64(t+uu.maxY,Zs),maxZ:e.getFloat64(t+uu.maxZ,Zs),errorX:e.getFloat64(t+uu.errorX,Zs),errorY:e.getFloat64(t+uu.errorY,Zs),errorZ:e.getFloat64(t+uu.errorZ,Zs),count:e.getUint32(t+uu.count,Zs),reserved:e.getUint32(t+uu.reserved,Zs)}}function hkt(e){const t=new DataView(e,0);let i=0;const{identifier:r,version:s}=ise(e,t,i);if(i+=kT.byteCount,r!=="LEPCC     ")throw new W("lepcc-decode-error","Bad identifier");if(s>1)throw new W("lepcc-decode-error","Unknown version");const n=m2t(t,i);if(i+=uu.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new W("lepcc-decode-error","Bad size");const o=new Float64Array(3*n.count),a=[],l=[],c=[],h=[];if(i=e4(e,i,a),i=e4(e,i,l),i=e4(e,i,c),i=e4(e,i,h),i!==e.byteLength)throw new W("lepcc-decode-error","Bad length");let p=0,f=0;for(let m=0;m<a.length;m++){f+=a[m];let g=0;for(let y=0;y<l[m];y++){g+=c[p];const x=h[p];o[3*p]=Math.min(n.maxX,n.minX+2*n.errorX*g),o[3*p+1]=Math.min(n.maxY,n.minY+2*n.errorY*f),o[3*p+2]=Math.min(n.maxZ,n.minZ+2*n.errorZ*x),p++}}return{errorX:n.errorX,errorY:n.errorY,errorZ:n.errorZ,result:o}}function e4(e,t,i){const r=[];t=CJ(e,t,r);const s=[];for(let n=0;n<r.length;n++){s.length=0,t=CJ(e,t,s);for(let o=0;o<s.length;o++)i.push(s[o]+r[n])}return t}function CJ(e,t,i){const r=new DataView(e,t),s=r.getUint8(0),n=31&s,o=!!(32&s),a=(192&s)>>6;let l=0;if(a===0)l=r.getUint32(1,Zs),t+=5;else if(a===1)l=r.getUint16(1,Zs),t+=3;else{if(a!==2)throw new W("lepcc-decode-error","Bad count type");l=r.getUint8(1),t+=2}if(o)throw new W("lepcc-decode-error","LUT not implemented");const c=Math.ceil(l*n/8),h=new Uint8Array(e,t,c);let p=0,f=0,m=0;const g=-1>>>32-n;for(let y=0;y<l;y++){for(;f<n;)p|=h[m]<<f,f+=8,m+=1;i[y]=p&g,p>>>=n,f-=n,f+n>32&&(p|=h[m-1]>>8-f)}return t+m}const Nx={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function g2t(e,t){return{sizeLo:e.getUint32(t+Nx.sizeLo,Zs),sizeHi:e.getUint32(t+Nx.sizeHi,Zs),count:e.getUint32(t+Nx.count,Zs),colorMapCount:e.getUint16(t+Nx.colorMapCount,Zs),lookupMethod:e.getUint8(t+Nx.lookupMethod),compressionMethod:e.getUint8(t+Nx.compressionMethod)}}function y2t(e){const t=new DataView(e,0);let i=0;const{identifier:r,version:s}=ise(e,t,i);if(i+=kT.byteCount,r!=="ClusterRGB")throw new W("lepcc-decode-error","Bad identifier");if(s>1)throw new W("lepcc-decode-error","Unknown version");const n=g2t(t,i);if(i+=Nx.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new W("lepcc-decode-error","Bad size");if((n.lookupMethod===2||n.lookupMethod===1)&&n.compressionMethod===0){if(3*n.colorMapCount+n.count+i!==e.byteLength||n.colorMapCount>256)throw new W("lepcc-decode-error","Bad count");const o=new Uint8Array(e,i,3*n.colorMapCount),a=new Uint8Array(e,i+3*n.colorMapCount,n.count),l=new Uint8Array(3*n.count);for(let c=0;c<n.count;c++){const h=a[c];l[3*c]=o[3*h],l[3*c+1]=o[3*h+1],l[3*c+2]=o[3*h+2]}return l}if(n.lookupMethod===0&&n.compressionMethod===0){if(3*n.count+i!==e.byteLength||n.colorMapCount!==0)throw new W("lepcc-decode-error","Bad count");return new Uint8Array(e,i).slice()}if(n.lookupMethod<=2&&n.compressionMethod===1){if(i+3!==e.byteLength||n.colorMapCount!==1)throw new W("lepcc-decode-error","Bad count");const o=t.getUint8(i),a=t.getUint8(i+1),l=t.getUint8(i+2),c=new Uint8Array(3*n.count);for(let h=0;h<n.count;h++)c[3*h]=o,c[3*h+1]=a,c[3*h+2]=l;return c}throw new W("lepcc-decode-error","Bad method "+n.lookupMethod+","+n.compressionMethod)}const Fx={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function v2t(e,t){return{sizeLo:e.getUint32(t+Fx.sizeLo,Zs),sizeHi:e.getUint32(t+Fx.sizeHi,Zs),count:e.getUint32(t+Fx.count,Zs),scaleFactor:e.getUint16(t+Fx.scaleFactor,Zs),bitsPerPoint:e.getUint8(t+Fx.bitsPerPoint),reserved:e.getUint8(t+Fx.reserved)}}function _2t(e){const t=new DataView(e,0);let i=0;const{identifier:r,version:s}=ise(e,t,i);if(i+=kT.byteCount,r!=="Intensity ")throw new W("lepcc-decode-error","Bad identifier");if(s>1)throw new W("lepcc-decode-error","Unknown version");const n=v2t(t,i);if(i+=Fx.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new W("lepcc-decode-error","Bad size");const o=new Uint16Array(n.count);if(n.bitsPerPoint===8){if(n.count+i!==e.byteLength)throw new W("lepcc-decode-error","Bad size");const a=new Uint8Array(e,i,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else if(n.bitsPerPoint===16){if(2*n.count+i!==e.byteLength)throw new W("lepcc-decode-error","Bad size");const a=new Uint16Array(e,i,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else{const a=[];if(CJ(e,i,a)!==e.byteLength)throw new W("lepcc-decode-error","Bad size");for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}return o}const AJ=ve.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function b2t(e,t,i){let r="",s=0;for(;s<i;){const n=e[t+s];if(n<128)r+=String.fromCharCode(n),s++;else if(n>=192&&n<224){if(s+1>=i)throw new W("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const o=(31&n)<<6|63&e[t+s+1];r+=String.fromCharCode(o),s+=2}else if(n>=224&&n<240){if(s+2>=i)throw new W("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(15&n)<<12|(63&e[t+s+1])<<6|63&e[t+s+2];r+=String.fromCharCode(o),s+=3}else{if(!(n>=240&&n<248))throw new W("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(s+3>=i)throw new W("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(7&n)<<18|(63&e[t+s+1])<<12|(63&e[t+s+2])<<6|63&e[t+s+3];if(o>=65536){const a=55296+(o-65536>>10),l=56320+(1023&o);r+=String.fromCharCode(a,l)}else r+=String.fromCharCode(o);s+=4}}}return r}function BIe(e,t){const i={byteOffset:0,byteCount:0,fields:Object.create(null)};let r=0;for(let s=0;s<t.length;s++){const n=t[s],o=n.valueType||n.type,a=M2t[o];i.fields[n.property]=a(e,r),r+=T8[o].BYTES_PER_ELEMENT}return i.byteCount=r,i}function w2t(e,t,i){const r=[];let s,n,o=0;for(n=0;n<e;n+=1){if(s=t[n],s>0){if(r.push(b2t(i,o,s-1)),i[o+s-1]!==0)throw new W("string-array-error","Invalid string array: missing null termination.")}else r.push(null);o+=s}return r}function Cme(e,t){return new T8[t.valueType](e,t.byteOffset,t.count*t.valuesPerElement)}function x2t(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function T2t(e,t,i){const r=t.header!=null?BIe(e,t.header):{byteOffset:0,byteCount:0,fields:{count:i}},s={header:r,byteOffset:r.byteCount,byteCount:0,entries:Object.create(null)};let n=r.byteCount;for(let o=0;o<t.ordering.length;o++){const a=t.ordering[o],l=ue(t[a]);if(l.count=r.fields.count,l.valueType==="String"){if(l.byteOffset=n,l.byteCount=r.fields[a+"ByteCount"],l.encoding!=="UTF-8")throw new W("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding})}else{if(!jIe(l.valueType))throw new W("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const c=Ok(l.valueType);n+=n%c!=0?c-n%c:0,l.byteOffset=n,l.byteCount=c*l.valuesPerElement*l.count}}n+=l.byteCount,s.entries[a]=l}return s.byteCount=n-s.byteOffset,s}function GIe(e,t,i){if(t!==e&&AJ.error(`Invalid ${i} buffer size
 expected: ${e}, actual: ${t})`),t<e)throw new W("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function S2t(e){return{isDraco:!1,isLegacy:!1,color:e.color!=null,normal:e.normal!=null,uv0:e.uv0!=null,uvRegion:e.uvRegion!=null,featureIndex:e.faceRange!=null&&e.featureId!=null}}function dkt(e,t){const i=BIe(e,t&&t.header);let r=i.byteCount;const s={isDraco:!1,header:i,byteOffset:i.byteCount,byteCount:0,vertexAttributes:{}},n=i.fields,o=n.vertexCount!=null?n.vertexCount:n.count;for(const c of t.ordering){if(!t.vertexAttributes[c])continue;const h=me(F({},t.vertexAttributes[c]),{byteOffset:r,count:o}),p=Ame[c]?Ame[c]:"_"+c;s.vertexAttributes[p]=h,r+=Ok(h.valueType)*h.valuesPerElement*o}const a=n.faceCount;if(t.faces&&a){s.faces={};for(const c of t.ordering){if(!t.faces[c])continue;const h=me(F({},t.faces[c]),{byteOffset:r,count:a});s.faces[c]=h,r+=Ok(h.valueType)*h.valuesPerElement*a}}const l=n.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&l){s.featureAttributes={};for(const c of t.featureAttributeOrder){if(!t.featureAttributes[c])continue;const h=me(F({},t.featureAttributes[c]),{byteOffset:r,count:l});s.featureAttributes[c]=h,r+=(h.valueType==="UInt64"?8:Ok(h.valueType))*h.valuesPerElement*l}}return GIe(r,e.byteLength,"geometry"),s.byteCount=r-s.byteOffset,s}function pkt(e,t){return!e||!e.compressedAttributes||e.compressedAttributes.encoding!=="draco"?e?S2t(e):E2t(t):C2t(e.compressedAttributes.attributes)}function E2t(e){const t={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const i of e.ordering)if(e.vertexAttributes[i])switch(i){case"position":break;case"normal":t.normal=!0;break;case"color":t.color=!0;break;case"uv0":t.uv0=!0;break;case"region":t.uvRegion=!0}return e.featureAttributes&&e.featureAttributeOrder&&(t.featureIndex=!0),t}function C2t(e){const t={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const i of e)switch(i){case"position":break;case"normal":t.normal=!0;break;case"uv0":t.uv0=!0;break;case"color":t.color=!0;break;case"uv-region":t.uvRegion=!0;break;case"feature-index":t.featureIndex=!0}return t}const Ame={position:P.POSITION,normal:P.NORMAL,color:P.COLOR,uv0:P.UV0,region:P.UVREGION};function A2t(e,t,i){if(e.encoding==="lepcc-rgb")return y2t(t);if(e.encoding==="lepcc-intensity")return _2t(t);if(e.encoding!=null&&e.encoding!=="")throw new W("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(AJ.warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),e.ordering[0]==="ObjectIds"&&e.hasOwnProperty("objectIds")&&(AJ.warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");const r=T2t(t,e,i);GIe(r.byteOffset+r.byteCount,t.byteLength,"attribute");const s=r.entries.attributeValues||r.entries.objectIds;if(s){if(s.valueType==="String"){const n=r.entries.attributeByteCounts,o=Cme(t,n),a=x2t(t,s);return w2t(n.count,o,a)}return Cme(t,s)}throw new W("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const T8={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},M2t={Float32:(e,t)=>new DataView(e,0).getFloat32(t,!0),Float64:(e,t)=>new DataView(e,0).getFloat64(t,!0),UInt8:(e,t)=>new DataView(e,0).getUint8(t),Int8:(e,t)=>new DataView(e,0).getInt8(t),UInt16:(e,t)=>new DataView(e,0).getUint16(t,!0),Int16:(e,t)=>new DataView(e,0).getInt16(t,!0),UInt32:(e,t)=>new DataView(e,0).getUint32(t,!0),Int32:(e,t)=>new DataView(e,0).getInt32(t,!0)};function jIe(e){return T8.hasOwnProperty(e)}function Ok(e){return jIe(e)?T8[e].BYTES_PER_ELEMENT:0}function O2t(e,t,i,r){const s=R2t(e,t,i),n=Ne();return nd(i,s,n,r),n}const HIe=1,Mme=5-HIe;function R2t(e,t,i){const r=$(),s=e[3],n=2**(Math.ceil(Math.log(s)*Math.LOG2E/Mme)*Mme+HIe);if(i.isGeographic){const l=n/Ri(i).radius*180/Math.PI,c=Math.round(e[1]/l),h=Math.max(-90,Math.min(90,c*l)),p=l/Math.cos((Math.abs(h)-l/2)/180*Math.PI),f=Math.round(e[0]/p)*p;r[0]=f,r[1]=h}else{const l=Math.round(e[0]/n),c=Math.round(e[1]/n);r[0]=l*n,r[1]=c*n}const o=e[2]+t,a=Math.round(o/n);return r[2]=a*n,r}const VM=1e-6,BR=[0,0,0],t4=[0,0,0];function P2t(e,t){const{data:i,size:r}=e,s=i.length/r;if(s<=0)return;const n=new z2t(e);Rk(BR,n.minProj,n.maxProj),fT(BR,BR,.5),np(t4,n.maxProj,n.minProj);const o=MJ(t4),a=new V2t;a.quality=o,s<14&&(e={data:new Float64Array(n.buffer,112,42),size:3});const l=[0,0,0],c=[0,0,0],h=[0,0,0],p=[0,0,0],f=[0,0,0],m=[0,0,0],g=[0,0,0];switch(I2t(n,e,g,l,c,h,p,f,m,a)){case 1:return void Ime(BR,t4,t);case 2:return void U2t(e,p,t)}$2t(e,g,l,c,h,p,f,m,a),qIe(e,a.b0,a.b1,a.b2,AA,MA);const y=[0,0,0];np(y,MA,AA),a.quality=MJ(y),a.quality<o?WIe(a.b0,a.b1,a.b2,AA,MA,y,t):Ime(BR,t4,t)}function I2t(e,t,i,r,s,n,o,a,l,c){return L2t(e,r,s),OJ(r,s)<VM?1:(np(o,r,s),Ia(o,o),D2t(t,r,o,n)<VM?2:(np(a,s,n),Ia(a,a),np(l,n,r),Ia(l,l),op(i,a,o),Ia(i,i),kx(t,i,o,a,l,c),0))}const GR=[0,0,0],jR=[0,0,0],wd=[0,0,0],xd=[0,0,0],Td=[0,0,0],C_=[0,0,0],A_=[0,0,0],M_=[0,0,0];function $2t(e,t,i,r,s,n,o,a,l){N2t(e,t,i,GR,jR),GR[0]!==void 0&&(np(wd,GR,i),Ia(wd,wd),np(xd,GR,r),Ia(xd,xd),np(Td,GR,s),Ia(Td,Td),op(C_,xd,n),Ia(C_,C_),op(A_,Td,o),Ia(A_,A_),op(M_,wd,a),Ia(M_,M_),kx(e,C_,n,xd,wd,l),kx(e,A_,o,Td,xd,l),kx(e,M_,a,wd,Td,l)),jR[0]!==void 0&&(np(wd,jR,i),Ia(wd,wd),np(xd,jR,r),Ia(xd,xd),np(Td,jR,s),Ia(Td,Td),op(C_,xd,n),Ia(C_,C_),op(A_,Td,o),Ia(A_,A_),op(M_,wd,a),Ia(M_,M_),kx(e,C_,n,xd,wd,l),kx(e,A_,o,Td,xd,l),kx(e,M_,a,wd,Td,l))}function L2t(e,t,i){let r=OJ(e.maxVert[0],e.minVert[0]),s=0;for(let n=1;n<7;++n){const o=OJ(e.maxVert[n],e.minVert[n]);o>r&&(r=o,s=n)}Du(t,e.minVert[s]),Du(i,e.maxVert[s])}const Sd=[0,0,0];function D2t(e,t,i,r){const{data:s,size:n}=e;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){Sd[0]=s[l]-t[0],Sd[1]=s[l+1]-t[1],Sd[2]=s[l+2]-t[2];const c=i[0]*Sd[0]+i[1]*Sd[1]+i[2]*Sd[2],h=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],p=Sd[0]*Sd[0]+Sd[1]*Sd[1]+Sd[2]*Sd[2]-c*c/h;p>o&&(o=p,a=l)}return Du(r,s,a),o}const oo=[0,0];function N2t(e,t,i,r,s){k2t(e,t,oo,s,r);const n=XIe(i,t);oo[1]-VM<=n&&(r[0]=void 0),oo[0]+VM>=n&&(s[0]=void 0)}const Ome=[0,0,0],Rme=[0,0,0],Pme=[0,0,0],gE=[0,0,0],yE=[0,0,0],i4=[0,0,0];function kx(e,t,i,r,s,n){if(ZIe(t)<VM)return;op(Ome,i,t),op(Rme,r,t),op(Pme,s,t),CA(e,t,oo),yE[1]=oo[0],gE[1]=oo[1],i4[1]=gE[1]-yE[1];const o=[i,r,s],a=[Ome,Rme,Pme];for(let l=0;l<3;++l){CA(e,o[l],oo),yE[0]=oo[0],gE[0]=oo[1],CA(e,a[l],oo),yE[2]=oo[0],gE[2]=oo[1],i4[0]=gE[0]-yE[0],i4[2]=gE[2]-yE[2];const c=MJ(i4);c<n.quality&&(Du(n.b0,o[l]),Du(n.b1,t),Du(n.b2,a[l]),n.quality=c)}}const F2t=[0,0,0];function CA(e,t,i){const{data:r,size:s}=e;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const o=r[n]*t[0]+r[n+1]*t[1]+r[n+2]*t[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function k2t(e,t,i,r,s){const{data:n,size:o}=e;Du(r,n),Du(s,r),i[0]=XIe(F2t,t),i[1]=i[0];for(let a=o;a<n.length;a+=o){const l=n[a]*t[0]+n[a+1]*t[1]+n[a+2]*t[2];l<i[0]&&(i[0]=l,Du(r,n,a)),l>i[1]&&(i[1]=l,Du(s,n,a))}}function Ime(e,t,i){Du(i.center,e),fT(i.halfSize,t,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const Vy=[0,0,0],vE=[0,0,0],HR=[0,0,0],AA=[0,0,0],MA=[0,0,0],$me=[0,0,0];function U2t(e,t,i){Du(Vy,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?Vy[0]=0:Math.abs(t[1])>Math.abs(t[2])?Vy[1]=0:Vy[2]=0,ZIe(Vy)<VM&&(Vy[0]=Vy[1]=Vy[2]=1),op(vE,t,Vy),Ia(vE,vE),op(HR,t,vE),Ia(HR,HR),qIe(e,t,vE,HR,AA,MA),np($me,MA,AA),WIe(t,vE,HR,AA,MA,$me,i)}function qIe(e,t,i,r,s,n){CA(e,t,oo),s[0]=oo[0],n[0]=oo[1],CA(e,i,oo),s[1]=oo[0],n[1]=oo[1],CA(e,r,oo),s[2]=oo[0],n[2]=oo[1]}const r4=[0,0,0],Dm=[1,0,0,0,1,0,0,0,1],_E=[0,0,0];function WIe(e,t,i,r,s,n,o){Dm[0]=e[0],Dm[1]=e[1],Dm[2]=e[2],Dm[3]=t[0],Dm[4]=t[1],Dm[5]=t[2],Dm[6]=i[0],Dm[7]=i[1],Dm[8]=i[2],B2t(o.quaternion,Dm),Rk(_E,r,s),fT(_E,_E,.5),fT(o.center,e,_E[0]),fT(r4,t,_E[1]),Rk(o.center,o.center,r4),fT(r4,i,_E[2]),Rk(o.center,o.center,r4),fT(o.halfSize,n,.5)}const nh=7;class z2t{constructor(t){this.minVert=new Array(nh),this.maxVert=new Array(nh);const i=64*nh;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,nh),r+=8*nh,this.maxProj=new Float64Array(this.buffer,r,nh),r+=8*nh;for(let l=0;l<nh;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<nh;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<nh;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(nh),n=new Array(nh),{data:o,size:a}=t;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<nh;++l){let c=s[l];Du(this.minVert[l],o,c),c=n[l],Du(this.maxVert[l],o,c)}}}class V2t{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function MJ(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function Rk(e,t,i){e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2]}function np(e,t,i){e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2]}function fT(e,t,i){e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}function Du(e,t,i=0){e[0]=t[i+0],e[1]=t[i+1],e[2]=t[i+2]}function op(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o}function Ia(e,t){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(i>0){const r=1/Math.sqrt(i);e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}}function ZIe(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function OJ(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function XIe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function B2t(e,t){const i=t[0]+t[4]+t[8];if(i>0){let r=Math.sqrt(i+1);e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r}else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let o=Math.sqrt(t[3*r+r]-t[3*s+s]-t[3*n+n]+1);e[r]=.5*o,o=.5/o,e[3]=(t[3*s+n]-t[3*n+s])*o,e[s]=(t[3*s+r]+t[3*r+s])*o,e[n]=(t[3*n+r]+t[3*r+n])*o}}const f3=Lv(),UT=$(),G2t=$(),j2t=ls();class fkt{constructor(t){const o=t*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(t);for(let a=0;a<t;a++)this.obbs[a]={center:_Q(this.buffer,56*a+0),halfSize:QCe(this.buffer,56*a+24),quaternion:VIe(this.buffer,56*a+36)}}}function rse(e=[0,0,0],t=[-1,-1,-1],i=[0,0,0,1]){return{center:Rn(e),halfSize:Tz(t),quaternion:zIe(i)}}function Lme(e){return rse(e.center,e.halfSize,e.quaternion)}function mkt(e,t){pe(t.center,e.center),pe(t.halfSize,e.halfSize),LL(t.quaternion,e.quaternion)}function YIe(e,t){return t=t||rse(),P2t(e,t),t}function Ux(e,t){const i=Or(t,e.center),r=S8(e,t);return i>r?1:i<-r?-1:0}function gkt(e,t){t||(t=In());const i=p6(j2t,e.quaternion),r=e.halfSize[0]*Math.abs(i[0])+e.halfSize[1]*Math.abs(i[3])+e.halfSize[2]*Math.abs(i[6]),s=e.halfSize[0]*Math.abs(i[1])+e.halfSize[1]*Math.abs(i[4])+e.halfSize[2]*Math.abs(i[7]),n=e.halfSize[0]*Math.abs(i[2])+e.halfSize[1]*Math.abs(i[5])+e.halfSize[2]*Math.abs(i[8]);return t[0]=e.center[0]-r,t[1]=e.center[1]-s,t[2]=e.center[2]-n,t[3]=e.center[0]+r,t[4]=e.center[1]+s,t[5]=e.center[2]+n,t}function ykt(e,t){return Or(t,e.center)-S8(e,t)}function vkt(e,t){return Or(t,e.center)+S8(e,t)}function _kt(e,t){return Ux(e,t[0])<=0&&Ux(e,t[1])<=0&&Ux(e,t[2])<=0&&Ux(e,t[3])<=0&&Ux(e,t[4])<=0&&Ux(e,t[5])<=0}function bkt(e,t,i,r=0){Sv(f3,e.quaternion),xe(UT,t,e.center);const s=Xh(UT,UT,f3),n=Xh(G2t,i,f3);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(r+e.halfSize[l]-s[l])/n[l],h=(-r-e.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(s[l]>e.halfSize[l]+r||s[l]<-e.halfSize[l]-r)return!1;return o<=a}(()=>{const e=new Int8Array(162);let t=0;const i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),e})();function S8(e,t){Sv(f3,e.quaternion),Xh(UT,t,f3);const i=e.halfSize;return Math.abs(UT[0]*i[0])+Math.abs(UT[1]*i[1])+Math.abs(UT[2]*i[2])}function JIe(e,t){for(let i=0;i<8;++i){const r=t[i];r[0]=1&i?-e.halfSize[0]:e.halfSize[0],r[1]=2&i?-e.halfSize[1]:e.halfSize[1],r[2]=4&i?-e.halfSize[2]:e.halfSize[2],Xh(r,r,e.quaternion),we(r,r,e.center)}}function H2t(e){return TQ(e.halfSize)}function QIe(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function wkt(e){var t;if(ye("disable-feature:i3s-draco")||!e)return!1;for(const i of e)for(const r of i.geometryBuffers)if(((t=r.compressedAttributes)==null?void 0:t.encoding)==="draco")return!0;return!1}function xkt(e,t,i,r,s,n){const o=t!==r;s.traverse(i,a=>{let l=a.mbs;return o&&(l=q2t,C8e(a.mbs,r,l,t)),W2t(e,l)!==zT.OUTSIDE&&(n(a),!0)})}function Tkt(e,t,i){let r=0,s=0;for(let n=0;n<t.length&&r<e.length;n++)e[r]===t[n]&&(i(n)&&(e[s]=e[r],s++),r++);e.length=s}function Skt(e,t,i){let r=0,s=0;for(;r<i.length;)j0e(e,i[r])>=0===t&&(i[s]=i[r],s++),r++;i.length=s}const qR=Qt();function Ekt(e,t){if(t.rotationScale[1]===0&&t.rotationScale[2]===0&&t.rotationScale[3]===0&&t.rotationScale[5]===0&&t.rotationScale[6]===0&&t.rotationScale[7]===0)return qR[0]=(e[0]-t.position[0])/t.rotationScale[0],qR[1]=(e[1]-t.position[1])/t.rotationScale[4],qR[2]=(e[2]-t.position[0])/t.rotationScale[0],qR[3]=(e[3]-t.position[1])/t.rotationScale[4],qR}const q2t=si();var zT;function W2t(e,t){const i=t[0],r=t[1],s=t[3],n=e[0]-i,o=i-e[2],a=e[1]-r,l=r-e[3],c=Math.max(n,o,0),h=Math.max(a,l,0),p=c*c+h*h;return p>s*s?zT.OUTSIDE:p>0?zT.INTERSECTS_CENTER_OUTSIDE:-Math.max(n,o,a,l)>s?zT.INSIDE:zT.INTERSECTS_CENTER_INSIDE}function Z2t(e,t,i){const r=[],s=i&&i.missingFields,n=i&&i.originalFields;for(const o of e){const a=o.toLowerCase();let l=!1;for(const c of t)if(a===c.name.toLowerCase()){r.push(c.name),l=!0,n&&n.push(o);break}!l&&s&&s.push(o)}return r}async function Ckt(e,t,i,r,s){if(t.length===0)return[];const n=e.attributeStorageInfo;if(_(e.associatedLayer))try{return await Y2t(e.associatedLayer,t,i,r)}catch(o){if(e.associatedLayer.loaded)throw o}if(n){const o=X2t(t,i,s);if(M(o))throw new W("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const a=e.parsedUrl.path,l=await Promise.all(o.map(c=>J2t(a,n,c.node,c.indices,r).then(h=>{for(let p=0;p<c.graphics.length;p++){const f=c.graphics[p],m=h[p];if(f.attributes)for(const g in f.attributes)g in m||(m[g]=f.attributes[g]);f.attributes=m}return c.graphics})));return q0e(l)}throw new W("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function X2t(e,t,i){const r=new Map,s=[],n=i();for(const o of e){const a=o.attributes[t];for(let l=0;l<n.length;l++){const c=n[l],h=c.featureIds.indexOf(a);if(h>=0){let p=r.get(c.node);p||(p={node:c.node,indices:[],graphics:[]},s.push(p),r.set(c.node,p)),p.indices.push(h),p.graphics.push(o);for(let f=l;f>0;f--)n[f]=n[f-1];n[0]=c;break}}}return s}async function Y2t(e,t,i,r){t.sort((l,c)=>l.attributes[i]-c.attributes[i]);const s=t.map(l=>l.attributes[i]),n=[],o=Z2t(r,e.fields,{originalFields:n}),a=await KIe(e,s,o);for(let l=0;l<t.length;l++){const c=t[l],h=a[l],p={};if(c.attributes)for(const f in c.attributes)p[f]=c.attributes[f];for(let f=0;f<n.length;f++)p[n[f]]=h[o[f]];c.attributes=p}return t}function KIe(e,t,i){const r=e.capabilities.query.maxRecordCount;if(r!=null&&t.length>r){const n=G0e(t,r);return Promise.all(n.map(o=>KIe(e,o,i))).then(q0e)}const s=new Ou({objectIds:t,outFields:i,orderByFields:[e.objectIdField]});return e.queryFeatures(s).then(n=>{if(n&&n.features&&n.features.length===t.length)return n.features.map(o=>o.attributes);throw new W("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function J2t(e,t,i,r,s){const n=[];for(const o of t)if(o&&s.includes(o.name)){const a=`${e}/nodes/${i.resources.attributes}/attributes/${o.key}/0`;n.push({url:a,storageInfo:o})}return Us(n.map(o=>Zt(o.url,{responseType:"array-buffer"}).then(a=>A2t(o.storageInfo,a.data)))).then(o=>{const a=[];for(const l of r){const c={};for(let h=0;h<o.length;h++)o[h].value!=null&&(c[n[h].storageInfo.name]=eEt(o[h].value,l));a.push(c)}return a})}(function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",e[e.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",e[e.INSIDE=3]="INSIDE"})(zT||(zT={}));const Q2t=-32768,K2t=-(2**31);function eEt(e,t){if(!e)return null;const i=e[t];return Y0e(e)?i===Q2t?null:i:J0e(e)?i===K2t?null:i:i!=i?null:i}function tEt(e){const t=e.store.indexCRS||e.store.geographicCRS,i=t===void 0?e.store.indexWKT:void 0;if(i){if(!e.spatialReference)throw new W("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(i!==e.spatialReference.wkt)throw new W("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const r=t?new at(QIe(t)):e.spatialReference;return r.equals(e.spatialReference)?e.spatialReference:r}function iEt(e){const t=e.store.vertexCRS||e.store.projectedCRS,i=t===void 0?e.store.vertexWKT:void 0;if(i){if(!e.spatialReference)throw new W("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(i!==e.spatialReference.wkt)throw new W("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const r=t?new at(QIe(t)):e.spatialReference;return r.equals(e.spatialReference)?e.spatialReference:r}function Akt(e,t){return M(t)?"@null":t===Xg(t)?"@ECEF":e.equals(t)?"":t.wkid!=null?"@"+t.wkid:null}function RJ(e,t,i){if(!Jg(e,t))throw new W("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(i==="local"&&!rEt(e,t))throw new W("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function rEt(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}function sEt(e,t,i){const r=tEt(e),s=iEt(e);RJ(r,t,i),RJ(s,t,i)}function nEt(e){return(e.geometryType==null||e.geometryType==="triangles")&&(e.topology==null||e.topology==="PerAttributeArray")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function Mkt(e){if(e.store==null||e.store.defaultGeometrySchema==null||!nEt(e.store.defaultGeometrySchema))throw new W("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function Okt(e,t){sEt(e,t.spatialReference,t.viewingMode)}function oEt(e){return e.geometryType!=null&&e.geometryType==="points"&&(e.topology==null||e.topology==="PerAttributeArray")&&(e.encoding==null||e.encoding===""||e.encoding==="lepcc-xyz")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function Rkt(e){if(e.store==null||e.store.defaultGeometrySchema==null||!oEt(e.store.defaultGeometrySchema))throw new W("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function Pkt(e,t){RJ(e.spatialReference,t.spatialReference,t.viewingMode)}function aEt(e){return e.type==="simple"||e.type==="class-breaks"||e.type==="unique-value"}function lEt(e){return e.type==="mesh-3d"}function Ikt(e){if(e==null||!aEt(e)||(e.type==="unique-value"||e.type==="class-breaks")&&e.defaultSymbol==null)return!0;const t=e.getSymbols();if(t.length===0)return!0;for(const i of t){if(!lEt(i)||i.symbolLayers.length===0)return!0;for(const r of i.symbolLayers.items)if(r.type!=="fill"||M(r.material)||M(r.material.color)||r.material.colorMixMode!=="replace")return!0}return!1}const $kt=YOe({color:[0,0,0,0],opacity:0});class cEt{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function Lkt(e){const t=new cEt;let i=!1,r=!1;for(const s of e.symbolLayers.items)if(s.type==="fill"&&s.enabled){const n=s.material,o=s.edges;if(_(n)&&!i){const a=n.color,l=VRe(n.colorMixMode);_(a)?t.material={color:[a.r/255,a.g/255,a.b/255],alpha:a.a,colorMixMode:l}:t.material={color:[1,1,1],alpha:1,colorMixMode:cn.Multiply},t.castShadows=s.castShadows,i=!0}_(o)&&!r&&(t.edgeMaterial=XOe(o,{}),r=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:cn.Multiply}),t}function Dkt(e,t){return(0|e)+(0|t)|0}function uEt(e,t,i,r,s=0){r===Xg(r)?t.isGeographic?yEt(e,i,t,s):gEt(e,i,t,s):t.isWGS84&&(r.isWebMercator||P3(r))?dEt(t,e,r,i,s):t.isWebMercator&&P3(r)?mEt(t,e,r,i,s):e===i?(i.center[2]+=s,$r(i.center,t,0,i.center,r,0,1)):(he(i.center,e.center[0],e.center[1],e.center[2]+s),$r(i.center,t,0,i.center,r,0,1),LL(i.quaternion,e.quaternion),pe(i.halfSize,e.halfSize))}function hEt(e,t,i,r,s){if(LL(s.quaternion,e.quaternion),r===tt.Global){Sv(s4,e.quaternion),Xh(O_,e.center,s4),jH(bE,O_),P0e(wE,bE,e.halfSize),zu(wE,bE,wE);const n=Ue(wE);we(wE,bE,e.halfSize);const o=Ue(wE);if(n<i)pe(s.center,e.center),he(O_,i,i,i),we(s.halfSize,e.halfSize,O_);else{const a=o>0?1+t/o:1,l=n>0?1+i/n:1,c=(l+a)/2,h=(l-a)/2;fe(s.halfSize,bE,h),_T(s.halfSize,s.halfSize,e.halfSize,c),fe(s.center,bE,c),_T(s.center,s.center,e.halfSize,h),R0e(O_,O_),OV(s.center,s.center,O_),Xh(s.center,s.center,s.quaternion)}}else{const n=he(O_,0,0,1);_T(s.center,e.center,n,(i+t)/2),Sv(s4,e.quaternion),Xh(n,n,s4),jH(n,n),_T(s.halfSize,e.halfSize,n,(i-t)/2)}return s}const O_=$(),bE=$(),wE=$(),s4=Lv();function dEt(e,t,i,r,s){pe(B1,t.center),B1[2]+=s;const n=Xg(i);$r(B1,e,0,B1,n,0,1),e3e(n,t,B1,i,r)}const Pk=new Float64Array(24),pEt={data:Pk,size:3},Dme=$(),B1=$(),fEt=ls();function mEt(e,t,i,r,s){pe(B1,t.center),B1[2]+=s,e3e(e,t,B1,i,r)}function e3e(e,t,i,r,s){const n=p6(fEt,t.quaternion);for(let o=0;o<8;++o){for(let a=0;a<3;++a)Dme[a]=t.halfSize[a]*((o&1<<a)!=0?-1:1);for(let a=0;a<3;++a){let l=i[a];for(let c=0;c<3;++c)l+=Dme[c]*n[3*c+a];Pk[3*o+a]=l}}$r(Pk,e,0,Pk,r,0,8),YIe(pEt,s)}function gEt(e,t,i,r){JIe(e,PJ),he(t.center,e.center[0],e.center[1],e.center[2]+r),nd(i,t.center,oh,Xg(i)),he(t.center,oh[12],oh[13],oh[14]);const s=2*Math.sqrt(1+oh[0]+oh[5]+oh[10]);A0[0]=(oh[6]-oh[9])/s,A0[1]=(oh[8]-oh[2])/s,A0[2]=(oh[1]-oh[4])/s,A0[3]=.25*s,tie(t.quaternion,A0,e.quaternion),Sv(A0,t.quaternion);let n=0,o=0,a=0;for(const l of PJ)l[2]+=r,$r(l,i,0,l,Xg(i),0,1),zu(Hi,l,t.center),Xh(Hi,Hi,A0),n=Math.max(n,Math.abs(Hi[0])),o=Math.max(o,Math.abs(Hi[1])),a=Math.max(a,Math.abs(Hi[2]));he(t.halfSize,n,o,a)}function yEt(e,t,i,r){const s=Ri(i),n=1+Math.max(0,r)/(s.radius+e.center[2]);he(t.center,e.center[0],e.center[1],e.center[2]+r),$r(t.center,i,0,t.center,Xg(i),0,1),LL(t.quaternion,e.quaternion),Sv(A0,e.quaternion),he(Hi,0,0,1),Xh(Hi,Hi,A0),he(Hi,e.halfSize[0]*Math.abs(Hi[0]),e.halfSize[1]*Math.abs(Hi[1]),e.halfSize[2]*Math.abs(Hi[2])),fe(Hi,Hi,s.inverseFlattening),we(t.halfSize,e.halfSize,Hi),fe(t.halfSize,t.halfSize,n)}function Nkt(e,t,i,r,s,n){if(!n||n.length===0||M(t))return null;const o=O2t(e.mbs,s,i,t);let a;Ks(o4,o);const l=()=>{if(!a)if(a=PJ,id(n4),_(e.serviceObb)){uEt(e.serviceObb,i,Nme,t,s),JIe(Nme,a);for(const m of a)Xe(m,m,o4),lA(n4,m)}else{const m=e.mbs,g=m[3];Zn(m,i,Hi,t),Xe(Hi,Hi,o4),Hi[2]+=s;for(let y=0;y<8;++y){const x=1&y?g:-g,b=2&y?g:-g,S=4&y?g:-g,T=a[y];pe(T,[Hi[0]+x,Hi[1]+b,Hi[2]+S]),lA(n4,T)}}};let c=1/0,h=-1/0;const p=m=>{if(m.type!=="replace")return;const g=m.geometry;if(!g.hasZ)return;id(iH);const y=g.spatialReference||r,x=g.rings.reduce((b,S)=>S.reduce((T,C)=>(Zn(C,y,Hi,t),Xe(Hi,Hi,o4),lA(iH,Hi),Math.min(Hi[2],T)),b),1/0);l(),hL(n4,iH)&&(c=Math.min(c,x),h=Math.max(h,x))};if(n.forEach(m=>p(m)),c===1/0)return null;const f=(m,g,y)=>{Xe(Hi,y,o),m[g+0]=Hi[0],m[g+1]=Hi[1],m[g+2]=Hi[2],g+=24,y[2]=c,Xe(Hi,y,o),m[g+0]=Hi[0],m[g+1]=Hi[1],m[g+2]=Hi[2],g+=24,y[2]=h,Xe(Hi,y,o),m[g+0]=Hi[0],m[g+1]=Hi[1],m[g+2]=Hi[2]};for(let m=0;m<8;++m)f(Fme.data,3*m,a[m]);return YIe(Fme)}function Fkt(e){return _(e)&&e.halfSize[0]>=0}function kkt(e){return e[3]>=0}function Ukt(e){_(e)&&(e.halfSize[0]=-1)}function zkt(e){_(e)&&(e[3]=-1)}const oh=Ne(),A0=UIe(),PJ=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],iH=Qt(),n4=Qt(),Nme=rse(),Hi=[0,0,0],Fme={data:new Array(72),size:3},o4=Ne();class vEt{constructor(t){this._totalCount=t,this._indexRanges=[0,t]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const t=this._indexRanges;let i=0;for(let r=0;r<t.length;r+=2)i+=t[r+1];return i}reset(t){t==="all"||t.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=_Et(t)}forEachComponent(t){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let o=s;o<n;o++)if(!t(o))return!1}return!0}forEachComponentRange(t){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!t(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(t){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],o=n+r[s+1],a=t[n],l=t[o];i[s]=a,i[s+1]=l-a}return i}}function _Et(e){const t=new Array;if(e.length===0)return t;let i=e[0],r=1;for(let s=1;s<e.length;s++){const n=e[s];i+r===n?r+=1:(t.push(i),t.push(r),i=n,r=1)}return t.push(i),t.push(r),t}class bEt extends B6{constructor(t,i){super(),this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=OQ(i);const r=this.count;this.visibility=new vEt(r),this.materialDataBuffer=t.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}dispose(){super.dispose();for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])}get count(){return this.offsets.length-1}get geometryRanges(){return M(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return M(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return M(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((M(this.cachedHighlightRanges)||M(this.cachedDefaultRanges))&&_(this.highlightCounts)){const{highlightRanges:t,defaultRanges:i}=wEt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=t,this.cachedDefaultRanges=i}}}function wEt(e,t,i){const r=[],s=[];let n=i.length,o=i.length;return t.forEachComponent(a=>(e[a]>0?(n!==a-1&&(r.length&&r.push(i[n+1]-r[r.length-1]),r.push(i[a])),n=a):(o!==a-1&&(s.length&&s.push(i[o+1]-s[s.length-1]),s.push(i[a])),o=a),!0)),r.length&&r.push(i[n+1]-r[r.length-1]),s.length&&s.push(i[o+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}class IJ extends B6{constructor(){super(...arguments),this.visible=OA.Hidden}}var OA;u([Pa()],IJ.prototype,"renderable",void 0),u([Pa()],IJ.prototype,"components",void 0),function(e){e[e.Hidden=0]="Hidden",e[e.Visible=1]="Visible"}(OA||(OA={}));function xEt(e,t,i,r){if(i>=t)return e;e==null&&(e=TEt());const s=e.isVisibleBit;let n=e.data;const o=i3e(n),a=i/o|0,l=i-o*a,c=(t-1)/o|0,h=n,p=r===s;if(!(i<h.length*o)&&p){const m=a+1,g=Math.ceil(h.length*1.5),y=c+1;let x=Math.max(m,g);x=Math.min(x,y),n=new Uint32Array(x),n.set(h)}return a<n.length&&(n[a]=EEt(n[a],l,p)),e.data=n,e}function t3e(e,t){if(e==null)return!0;const{isVisibleBit:i,data:r}=e,s=i3e(r);return t<r.length*s?SEt(i,r,t,s):!e.isVisibleBit}function TEt(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}function SEt(e,t,i,r){const s=i/r|0,n=i-s*r;return CEt(t[s],n)===e}function i3e(e){return e.BYTES_PER_ELEMENT*8}function EEt(e,t,i){return e&~(1<<t)|(i?1:0)<<t}function CEt(e,t){return(e&1<<t)!=0}class AEt{constructor(t,i){this._indices=_(t.indices)?t.indices:CM(t.positions.length/3),this._positions=new fr(t.positions),this._components=i,this._componentIntersectionData=new Array(i.count)}getComponentAabb(t,i){if(_(this._perComponentAabbs)){for(let r=0;r<6;r++)i[r]=this._perComponentAabbs[6*t+r];return i}return this._computePerComponentAabbs(),this.getComponentAabb(t,i)}getComponentPositions(t,i){i.indices=this._indices,i.data=this._positions.typedBuffer,i.stride=this._positions.typedBufferStride,i.startIndex=this._components.offsets[t],i.endIndex=this._components.offsets[t+1]}intersect(t,i,r,s,n,o,a){const l={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},c=this._indices,h=this._components.offsets,p=QMe(t,i,MEt),f=t[2],m=i[2];this._components.visibility.forEachComponent(g=>{if(!t3e(this._components.pickability,g))return!0;const y=this.getComponentAabb(g,OEt);if(_(o)){const C=o[g];_(n)?n.componentOffset=C:(t[2]=f-C,i[2]=m-C)}if(_(n)&&n.applyToAabb(y),!Yie(y,t,p,r))return!0;const x=h[g]/3,b=h[g+1]/3,S=(C,A,O)=>{a(g,C,Pu(A,A,s),O)},T=b-x;return M(n)&&T>LIe?(this._componentIntersectionData[g]==null&&(this._componentIntersectionData[g]=new zM(this._indices,x,b,l)),this._componentIntersectionData[g].intersectRay({r0:t,r1:i},S)):zL(t,i,x,b,c,l,void 0,n,S),!0})}_computePerComponentAabbs(){const t=this._components.count;this._perComponentAabbs=new Float32Array(6*t);const i=this._indices,r=this._positions.typedBuffer,s=this._positions.typedBufferStride,n=this._components.offsets;let o=0;for(let a=0;a<t;a++){const l=n[a],c=n[a+1];let h=1/0,p=1/0,f=1/0,m=-1/0,g=-1/0,y=-1/0;for(let x=l;x<c;x++){const b=i[x]*s,S=r[b],T=r[b+1],C=r[b+2];h=Math.min(h,S),p=Math.min(p,T),f=Math.min(f,C),m=Math.max(m,S),g=Math.max(g,T),y=Math.max(y,C)}this._perComponentAabbs[o++]=h,this._perComponentAabbs[o++]=p,this._perComponentAabbs[o++]=f,this._perComponentAabbs[o++]=m,this._perComponentAabbs[o++]=g,this._perComponentAabbs[o++]=y}}get positions(){return this._positions}get indices(){return this._indices}}const MEt=$(),OEt=In();class REt{constructor(t,i,r){this.material=t,this.geometry=i,this.meta=r}dispose(){this.material.dispose(),this.geometry.dispose()}}class r3e extends B6{constructor(t,i,r,s){super(),this.primitiveType=i,this.parameters=r,this.indexed=s,this.vao=t}}u([Pa()],r3e.prototype,"vao",void 0);function PEt(e,t){return{near:e,far:t}}function iD(e){return e?W$(e,1/0,-1/0):PEt(1/0,-1/0)}function W$(e,t,i){return e.near=t,e.far=i,e}function BM(e,t,i=e){return i.near=Math.min(e.near,t.near),i.far=Math.max(e.far,t.far),i}function a4(e,t){return e.near<=t&&t<=e.far}const $J={near:0,far:0};function IEt(e,t){const i=iD(),{eye:r,frustum:s,viewForward:n}=e;t.forAll(o=>{const a=_(o.offsetObb)?o.offsetObb:o.obb,l=Pe(zu(gh,a.center,r),n),c=S8(a,n);if(a4(i,l-c)&&a4(i,l+c))return;const h=FEt(a,s);if(h===-1)return;if(h===0)return By.far=l+c,By.near=l-c,void BM(i,By);const p=l4.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<l4.length;o++){const a=l4.data[o];if(a4(i,a.near)&&a4(i,a.far))continue;By.far=a.far,By.near=1/0,NEt(_(a.object.offsetObb)?a.object.offsetObb:a.object.obb,r,$Et,c=>{let h=LEt;for(let p=0;p<s3e&&c.length>0;p++){if((a.mask&1<<p)==0)continue;DEt(s[p],c,h);const f=c;c=h,h=f}for(let p=0;p<c.length;p+=3){he(bc,c.data[p+0],c.data[p+1],c.data[p+2]);const f=Pe(zu(bc,bc,r),n);By.near=Math.min(By.near,f)}})===0&&(By.near=0),BM(i,By)}return l4.length=0,i}const l4=new ai({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=null,e)}),By=iD(),bc=$(),Gw=$(),$Et=new ai({deallocator:null}),LEt=new ai({deallocator:null});function DEt(e,t,i){i.length=0;const r=t.length-3;rH(bc,t,r);const s=Or(e,bc);s<=0&&(i.push(bc[0]),i.push(bc[1]),i.push(bc[2]));let n=0,o=s;for(;n<r;n+=3){rH(Gw,t,n);const a=Or(e,Gw);o*a<0&&(Pn(bc,Gw,bc,a/(a-o)),wc(i,bc)),a<=0&&wc(i,Gw),o=a,pe(bc,Gw)}o*s<0&&(rH(Gw,t,r),Pn(bc,Gw,bc,s/(s-o)),wc(i,bc))}function rH(e,t,i){return he(e,t.data[i+0],t.data[i+1],t.data[i+2])}function wc(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function NEt(e,t,i,r){Sv(Ume,e.quaternion),zu(gh,t,e.center),Xh(gh,gh,Ume);const s=8*((gh[0]<-e.halfSize[0]?-1:gh[0]>e.halfSize[0]?1:0)+3*(gh[1]<-e.halfSize[1]?-1:gh[1]>e.halfSize[1]?1:0)+9*(gh[2]<-e.halfSize[2]?-1:gh[2]>e.halfSize[2]?1:0)+13),n=kme[s];if(n===0)return n;p6(c4,e.quaternion),fie(c4,c4,e.halfSize);const o=(a,l)=>{const c=kme[s+l+1];return he(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),Pu(a,a,c4),we(a,e.center,a)};return i.length=0,wc(i,o(sH,0)),wc(i,o(zme,1)),wc(i,o(gh,2)),wc(i,o(Vme,3)),r(i),n===1||(i.length=0,wc(i,sH),wc(i,Vme),wc(i,o(gh,4)),wc(i,o(Bme,5)),r(i),n===2||(i.length=0,wc(i,sH),wc(i,Bme),wc(i,o(gh,6)),wc(i,zme),r(i))),n}const kme=(()=>{const e=new Int8Array(216);let t=0;const i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),e})(),s3e=4;function FEt(e,t){let i=0;for(let r=0;r<s3e;r++){const s=Ux(e,t[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const c4=ls(),Ume=Lv(),gh=$(),sH=$(),zme=$(),Vme=$(),Bme=$();class kEt{constructor(t){this._objects=t}submit(t,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(t,i,r))}queryShadowCasterDepthRange(t){return this._objects.visibleObjects.length?IEt(t,this._objects.visibleObjects):null}}function UEt(e){const t=Bs().vec3f(P.POSITION);return e.normals&&t.vec2i16(P.NORMALCOMPRESSED,{glNormalized:!0}),e.textureCoordinates===Hn.Default?t.vec2f(P.UV0):e.textureCoordinates===Hn.Atlas&&(t.vec2f(P.UV0),t.vec4u16(P.UVREGION,{glNormalized:!0})),e.colors&&t.vec4u8(P.COLOR,{glNormalized:!0}),t.alignTo(4)}class zEt extends $s{constructor(t,i){super(t,"int",ar.Draw,(r,s,n)=>r.setUniform1i(t,i(s,n)))}}var Kf;(function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"})(Kf||(Kf={}));const sse=429496.7296;function n3e(e,t){R$(e/sse*.5+.5,t)}function VEt(e,t){switch(t.componentData){case Kf.Varying:return BEt(e);case Kf.Uniform:return GEt(e);case Kf.COUNT:return;default:t.componentData}}function BEt(e){const{vertex:t,fragment:i}=e;t.include(Zu),t.uniforms.add([new ws("componentColorTex"),new tv("componentColorTexInvDim")]),e.attributes.add(P.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4"),e.include(GRe),t.constants.add("elevationScale","float",2*sse),t.code.add(E`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex * 2.0 + 0.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return texture2D(componentColorTex, indexCoord);
}
float readElevationOffset() {
float normalizedIndex = (componentIndex * 2.0 + 1.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return (rgba2float(texture2D(componentColorTex, indexCoord)) - 0.5) * elevationScale;
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),i.code.add(E`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`)}function GEt(e){const{vertex:t,fragment:i}=e;t.uniforms.add(new gV("externalColor",r=>r.componentParameters.externalColor)),i.uniforms.add(new zEt("externalColorMixMode",r=>r.componentParameters.externalColorMixMode)),e.varyings.add("vExternalColor","vec4"),t.code.add(E`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),i.code.add(E`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}var up;function jEt(e,t){const i=e.vertex;switch(i.code.add(E`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),t.vertexDiscardMode){case up.None:i.code.add(E`#define vertexDiscardByOpacity(_opacity_) {}`);break;case up.Opaque:i.code.add(E`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case up.Transparent:i.code.add(E`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(up||(up={}));var Ug;function Vkt(e){return e&&ay(e)?Ug.Mars:e&&ly(e)?Ug.Moon:Ug.Earth}(function(e){e[e.Earth=1]="Earth",e[e.Mars=2]="Mars",e[e.Moon=3]="Moon",e[e.COUNT=4]="COUNT"})(Ug||(Ug={}));var Gme,Uh;(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(Gme||(Gme={})),function(e){e[e.None=0]="None",e[e.NoOverlay=1]="NoOverlay",e[e.ColorOverlay=2]="ColorOverlay",e[e.ColorOverlayWithWater=3]="ColorOverlayWithWater",e[e.COUNT=4]="COUNT"}(Uh||(Uh={}));class Oi extends Xl{constructor(){super(...arguments),this.output=oe.Color,this.textureCoordinateType=Hn.None,this.componentData=Kf.Uniform,this.cullFace=Ir.Back,this.vertexDiscardMode=up.None,this.doubleSidedMode=Cs.WindingOrder,this.alphaDiscardMode=Rr.Opaque,this.integratedMeshMode=Uh.None,this.transparencyPassType=Rt.NONE,this.ellipsoidMode=Ug.Earth,this.pbrMode=Gt.Disabled,this.normalType=ns.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.isGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1}}u([Q({count:oe.COUNT})],Oi.prototype,"output",void 0),u([Q({count:Hn.COUNT})],Oi.prototype,"textureCoordinateType",void 0),u([Q({count:Kf.COUNT})],Oi.prototype,"componentData",void 0),u([Q({count:Ir.COUNT})],Oi.prototype,"cullFace",void 0),u([Q({count:up.COUNT})],Oi.prototype,"vertexDiscardMode",void 0),u([Q({count:Cs.COUNT})],Oi.prototype,"doubleSidedMode",void 0),u([Q({count:Rr.COUNT})],Oi.prototype,"alphaDiscardMode",void 0),u([Q({count:Uh.COUNT})],Oi.prototype,"integratedMeshMode",void 0),u([Q({count:Rt.COUNT})],Oi.prototype,"transparencyPassType",void 0),u([Q({count:Ug.COUNT})],Oi.prototype,"ellipsoidMode",void 0),u([Q({count:Gt.COUNT})],Oi.prototype,"pbrMode",void 0),u([Q({count:ns.COUNT})],Oi.prototype,"normalType",void 0),u([Q()],Oi.prototype,"spherical",void 0),u([Q()],Oi.prototype,"doublePrecisionRequiresObfuscation",void 0),u([Q()],Oi.prototype,"hasVertexColors",void 0),u([Q()],Oi.prototype,"hasNormals",void 0),u([Q()],Oi.prototype,"hasSlicePlane",void 0),u([Q()],Oi.prototype,"hasBaseColorTexture",void 0),u([Q()],Oi.prototype,"receiveAmbientOcclusion",void 0),u([Q()],Oi.prototype,"receiveShadows",void 0),u([Q()],Oi.prototype,"blendingEnabled",void 0),u([Q()],Oi.prototype,"hasScreenSpaceReflections",void 0),u([Q()],Oi.prototype,"hasPolygonOffset",void 0),u([Q()],Oi.prototype,"hasMetalnessAndRoughnessTexture",void 0),u([Q()],Oi.prototype,"hasEmissionTexture",void 0),u([Q()],Oi.prototype,"hasOcclusionTexture",void 0),u([Q()],Oi.prototype,"hasNormalTexture",void 0),u([Q()],Oi.prototype,"hasOccludees",void 0),u([Q()],Oi.prototype,"hasMultipassTerrain",void 0),u([Q()],Oi.prototype,"cullAboveGround",void 0),u([Q()],Oi.prototype,"isGround",void 0),u([Q()],Oi.prototype,"hasCloudsReflections",void 0),u([Q()],Oi.prototype,"snowCover",void 0),u([Q({constValue:ar.Draw})],Oi.prototype,"pbrTextureBindType",void 0),u([Q({constValue:!0})],Oi.prototype,"hasSliceHighlight",void 0),u([Q({constValue:!1})],Oi.prototype,"hasSliceInVertexProgram",void 0),u([Q({constValue:!1})],Oi.prototype,"useCustomDTRExponentForWater",void 0),u([Q({constValue:!1})],Oi.prototype,"hasVertexTangents",void 0),u([Q({constValue:!0})],Oi.prototype,"supportsTextureAtlas",void 0),u([Q({constValue:!1})],Oi.prototype,"highStepCount",void 0),u([Q({constValue:!1})],Oi.prototype,"instancedDoublePrecision",void 0),u([Q({constValue:!0})],Oi.prototype,"useFillLights",void 0);function jme(e,t){e.include(u2,t),e.fragment.include(F$);const i=e.fragment;i.uniforms.add(new gV("baseColor",r=>r.baseColor)),i.uniforms.add(new HRe("objectOpacity",r=>r.objectOpacity)),t.hasVertexColors?i.code.add(E`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(E`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(E`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Hme(e,t){const i=e.fragment;switch(t.doubleSidedMode){case Cs.None:i.code.add(E`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Cs.View:e.include(wA,t),i.code.add(E`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Cs.WindingOrder:i.code.add(E`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:t.doubleSidedMode;case Cs.COUNT:}switch(t.normalType){case ns.Attribute:case ns.CompressedAttribute:e.include(q6,t),i.code.add(E`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case ns.ScreenDerivative:e.extensions.add("GL_OES_standard_derivatives"),e.include(wA,t),i.code.add(E`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case ns.Ground:t.spherical?(e.include(wA,t),i.code.add(E`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(E`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),e.extensions.add("GL_OES_standard_derivatives"),i.code.add(E`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:t.normalType;case ns.COUNT:}}function HEt(e,t){const i=e.fragment;if(t.hasBaseColorTexture){e.include(sie,t);const r=t.textureCoordinateType===Hn.Atlas;i.uniforms.add(JI("baseColorTexture",s=>s.texture,r)),r?(e.include(rAe),i.code.add(E`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, baseColorTextureSize, vuv0, vuvRegion);
}`)):i.code.add(E`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else i.code.add(E`vec4 readBaseColorTexture() { return vec4(1.0); }`)}const o3e=new Map([[P.POSITION,0],[P.NORMAL,1],[P.NORMALCOMPRESSED,1],[P.COLOR,2],[P.UV0,3],[P.UVREGION,4],[P.COMPONENTINDEX,5]]);function qEt(e){const t=new mr;t.include(wA,e),t.include(q6,e),t.include(u2,e),t.include(ev,e),t.include(YL,e),t.include(VEt,e),t.include(Igt,e),t.include(Hdt,e),t.include(HEt,e),t.include(jEt,e);const{vertex:i,fragment:r}=t;r.uniforms.add(new Ib("view")),e.pbrMode!==Gt.Normal&&e.pbrMode!==Gt.Schematic||(t.include(lie,e),e.hasNormalTexture&&t.include(ZRe,e)),e.output===oe.Shadow&&e.componentData===Kf.Varying?i.code.add(E`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(E`#define discardShadows(castShadows) {}`);const s=e.integratedMeshMode===Uh.ColorOverlay||e.integratedMeshMode===Uh.ColorOverlayWithWater,n=s&&e.output===oe.Color&&e.pbrMode===Gt.WaterOnIntegratedMesh;return s&&(t.include(FS,e),t.include(ZSt,e),e.spherical?i.code.add(E`
      const float invEllipsoidRadius = ${E.float(1/(e.ellipsoidMode===Ug.Earth?Qi.radius:e.ellipsoidMode===Ug.Mars?Pg.radius:dv.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(E`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),n&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3")),i.code.add(E`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${E.float(Va)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${n?e.spherical?E`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:E`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${s?E`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),e.output===oe.Alpha&&(r.include(ad),t.include(ld,e),t.include(jme,e),s&&r.uniforms.add(new oi("ovColorTex",(o,a)=>EJ(o,a))),r.code.add(E`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?E`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?E`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),e.output===oe.Color&&(r.include(ad),t.include(ld,e),t.include(jme,e),t.include(Hme,e),t.include(FS,e),e.receiveShadows?(t.include(W6,e),r.code.add(E`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(E`float evaluateShadow() { return 0.0; }`),s&&r.uniforms.add(new oi("ovColorTex",(o,a)=>EJ(o,a))),r.code.add(E`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?E`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?E`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),e.pbrMode===Gt.Normal||e.pbrMode===Gt.Schematic?(r.uniforms.add(new Dt("lightingMainIntensity",(o,a)=>a.lighting.mainLight.intensity)),r.code.add(E`
        ${e.pbrMode===Gt.Normal?E`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),e.hasNormalTexture?r.code.add(E`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(E`vec3 shadingNormal = normalVertex;`),r.code.add(E`${e.spherical?E`vec3 normalGround = normalize(positionWorld());`:E`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(E`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${e.snowCover?E`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${s?E` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(e.receiveShadows?r.code.add(E`float shadow = evaluateShadow();`):e.spherical?(r.uniforms.add(new lt("lightingGlobalFactor",(o,a)=>a.lighting.globalFactor)),r.code.add(E`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(E`float shadow = 0.0;`),n&&r.uniforms.add(new oi("ovNormalTex",(o,a)=>nse(a))),e.snowCover&&(t.extensions.add("GL_OES_standard_derivatives"),r.code.add(E`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),r.code.add(E`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${s?E` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${n?E`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(E`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${e.transparencyPassType===Rt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==oe.Depth&&e.output!==oe.Shadow||(t.include(tw,e),r.code.add(E`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),e.output===oe.Normal&&(t.include(Hme,e),r.code.add(E`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${e.normalType===ns.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),e.output===oe.Highlight&&(t.include(Bv),r.code.add(E`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?E`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),t}function nse(e){return e.overlays.length===0?null:e.overlays[_s.INNER].getValidTexture(on.Water)}const WEt=Object.freeze(Object.defineProperty({__proto__:null,attributeLocations:o3e,build:qEt,getOverlayNormalTexture:nse},Symbol.toStringTag,{value:"Module"}));class E8 extends Lr{bindDraw(t,i){const r=this.program;r.bindDraw(t,i),r.rebindTextures(),t.componentParameters.type===Kf.Varying&&t.componentParameters.texture.bind(r,"componentColorTex","componentColorTexInvDim")}initializeConfiguration(t,i){i.spherical=t.viewingMode===tt.Global,i.doublePrecisionRequiresObfuscation=XL(t.rctx)}initializeProgram(t){const i=E8.shader.get(),r=i.build(this.configuration);return new Er(t.rctx,r,i.attributeLocations)}_setPipelineState(t){const i=this.configuration,r=i.integratedMeshMode!==Uh.None,s=t===Rt.NONE,n=t===Rt.FrontFace;return ri({blending:i.output!==oe.Color&&i.output!==oe.Alpha||!i.blendingEnabled?null:s?ed:Gv(t),culling:c6(i.cullFace),depthTest:{func:ew(t)},depthWrite:s||n?jc:null,colorWrite:xi,stencilWrite:r||i.hasOccludees?ny:null,stencilTest:r?Rmt(Fc.IntegratedMeshMaskExcluded):i.hasOccludees?iw:null,polygonOffset:s||n?i.hasPolygonOffset?{factor:2,units:2}:null:L6})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}E8.shader=new Sr(WEt,()=>import("./ComponentShader.glsl.3b34b220.js"));class ZEt extends Nn{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const t of this._parameterBlocks)this[t]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const t of this._parameterBlocks)if(this[t].dirty)return!0;return!1}}class ose{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function Rs(e={}){return(t,i)=>{var s;const r=(s=t._parameterCount)!=null?s:0;if(t._parameterCount=r+1,e.vectorOps){const n=e.vectorOps;Object.defineProperty(t,i,{get(){return this[r]},set(o){const a=this[r];if(a==null)this[r]=o;else{if(n.equals(a,o))return;n.copy(a,o)}this._setDirty()}})}else Object.defineProperty(t,i,{get(){return this[r]},set(n){this[r]!==n&&(e.dispose&&this[r]&&this[r].dispose(),this[r]=n,this._setDirty())}})}}function qme(){return(e,t)=>{var r;const i=(r=e._parameterCount)!=null?r:0;e._parameterCount=i+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(i),Object.defineProperty(e,t,{get(){return this[i]},set(s){this[i]!==s&&(this[i]=s,this._setDirty())}})}}class C8{constructor(t){this._low=Xi(),this._high=Xi(),t&&this.set(t)}get low(){return this._low}get high(){return this._high}set(t){const i=this._low,r=this._high;pe(i,t),zu(r,t,i)}setElements(t,i,r){he(Wme,t,i,r),this.set(Wme)}get(t){return we(t,this._low,this._high)}getLowScaled(t){return fe(t,this._low,1)}}const Wme=$();class So extends ZEt{constructor(t,i){super(),this.toMapSpace=i,this.baseColor=Rp(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Ki(1,1,.5),this.emissiveFactor=Ki(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new Ik,this.componentParameters=new m3,this.textureAlphaCutoff=qz,this.alphaDiscardMode=Rr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Ug.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new Oi;const r=new C8(t.position),s=nIe(t.rotationScale);l2(s,s),this.transformNormalGlobalFromModel=Ap(s,s),this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=t.rotationScale}dispose(){this._technique=br(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return _(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return _(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return _(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return _(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return _(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(t,i,r,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetalnessAndRoughnessTexture=_(this.metallicRoughnessTexture),n.hasEmissionTexture=_(this.emissionTexture),n.hasOcclusionTexture=_(this.occlusionTexture),n.hasNormalTexture=_(this.normalTexture),n.transparencyPassType=i.identifier===Gh.Material&&r.transparencyPassType!=null?r.transparencyPassType:Rt.NONE,n.hasMultipassTerrain=i.identifier===Gh.Material&&r.multipassTerrain!=null&&r.multipassTerrain.enabled,n.cullAboveGround=i.identifier===Gh.Material&&r.multipassTerrain!=null&&r.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?Cs.View:Cs.None,n.hasBaseColorTexture=_(this.baseColorTexture);const o=this._computeWhichMaterialPass();n.blendingEnabled=o===Ll.Transparent||o===Ll.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?JEt(r)?nse(r)?Uh.ColorOverlayWithWater:Uh.ColorOverlay:Uh.NoOverlay:Uh.None,n.isGround=this.isIntegratedMesh,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&M(this.baseColorTexture);return n.pbrMode=n.integratedMeshMode===Uh.ColorOverlayWithWater?Gt.WaterOnIntegratedMesh:this.usePBR?a?Gt.Schematic:Gt.Normal:Gt.Disabled,n.normalType=n.integratedMeshMode===Uh.None?n.hasNormals?ns.CompressedAttribute:ns.ScreenDerivative:ns.Ground,n.hasSlicePlane=_(r.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,i.identifier===Gh.ShadowMap?(n.output=oe.Shadow,n.vertexDiscardMode=up.None):i.identifier===Gh.Highlight?(n.output=oe.Highlight,n.vertexDiscardMode=up.None):(this._computeWhichMaterialPass()===Ll.OpaqueAndTransparent?n.vertexDiscardMode=i.transparent?up.Opaque:up.Transparent:n.vertexDiscardMode=up.None,n.output=XEt(i.subPass),i.subPass===ua.Alpha&&(n.hasOccludees=r.hasOccludees),i.subPass===ua.Color?(n.receiveAmbientOcclusion=r.ssaoHelper.ready,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.hasScreenSpaceReflections=r.ssr.enabled,n.hasCloudsReflections=_(r.clouds.data)):(n.receiveAmbientOcclusion=!1,n.receiveShadows=!1),n.snowCover=this.hasSnowCover(r)),this._technique=t.releaseAndAcquire(E8,n,this._technique),this._setClean(),this._technique}hasSnowCover(t){return _(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}submit(t,i,r){if(this.objectOpacity===0)return;const s=r.renderable.geometry,n=r.components,o=r.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Ll.Opaque:t.materialOpaque.submitDraw(this,s,a,o);break;case Ll.Transparent:t.materialTransparent.submitDraw(this,s,a,o);break;case Ll.OpaqueAndTransparent:t.materialOpaque.submitDraw(this,s,a,o),t.materialTransparent.submitDraw(this,s,a,o);break;case Ll.IntegratedMesh:t.materialIntegratedMesh.submitDraw(this,s,a,o),YEt(i)&&t.highlightIntegratedMesh.submitDraw(this,s,a,o)}const h=this.componentParameters.castShadows!==ao.None;h&&t.shadowMap.submitDraw(this,s,a,o),_(l)&&(t.highlight.submitDraw(this,s,l,o),h&&t.highlightShadowMap.submitDraw(this,s,l,o)),h&&_(c)&&t.defaultShadowMap.submitDraw(this,s,c,o)}get attributeLocations(){return o3e}_computeWhichMaterialPass(){return this.isIntegratedMesh?Ll.IntegratedMesh:this.objectOpacity<1?Ll.Transparent:this.componentParameters.opaqueOverride===ao.All?Ll.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Rr.Blend||this.alphaDiscardMode===Rr.MaskBlend?Ll.Transparent:this.componentParameters.transparent===ao.None?Ll.Opaque:this.componentParameters.transparent===ao.All?Ll.Transparent:Ll.OpaqueAndTransparent}}var Zme,Ll,ao;u([Rs({vectorOps:U0e})],So.prototype,"baseColor",void 0),u([Rs()],So.prototype,"usePBR",void 0),u([Rs()],So.prototype,"hasParametersFromSource",void 0),u([Rs({vectorOps:Dne})],So.prototype,"mrrFactors",void 0),u([Rs({vectorOps:Dne})],So.prototype,"emissiveFactor",void 0),u([Rs({dispose:!0})],So.prototype,"baseColorTexture",void 0),u([Rs({dispose:!0})],So.prototype,"metallicRoughnessTexture",void 0),u([Rs({dispose:!0})],So.prototype,"emissionTexture",void 0),u([Rs({dispose:!0})],So.prototype,"occlusionTexture",void 0),u([Rs({dispose:!0})],So.prototype,"normalTexture",void 0),u([Rs()],So.prototype,"objectOpacity",void 0),u([qme()],So.prototype,"commonMaterialParameters",void 0),u([qme()],So.prototype,"componentParameters",void 0),u([Rs()],So.prototype,"textureAlphaCutoff",void 0),u([Rs()],So.prototype,"alphaDiscardMode",void 0),u([Rs()],So.prototype,"isIntegratedMesh",void 0),u([Rs()],So.prototype,"polygonOffsetEnabled",void 0),u([Rs()],So.prototype,"ellipsoidMode",void 0),u([Rs()],So.prototype,"hasOccludees",void 0),function(e){e[e.VERTEX=0]="VERTEX",e[e.GROUND=1]="GROUND",e[e.SCREEN_DERIVATIVE=2]="SCREEN_DERIVATIVE"}(Zme||(Zme={})),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.OpaqueAndTransparent=2]="OpaqueAndTransparent",e[e.IntegratedMesh=3]="IntegratedMesh"}(Ll||(Ll={}));class Ik extends ose{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Ir.Back,this.hasSlicePlane=!0}}u([Rs()],Ik.prototype,"doubleSided",void 0),u([Rs()],Ik.prototype,"cullFace",void 0),u([Rs()],Ik.prototype,"hasSlicePlane",void 0);class m3 extends ose{constructor(){super(...arguments),this.externalColor=Rp(1,1,1,1),this.externalColorMixMode=cn.Multiply,this.castShadows=ao.All}get transparent(){return this.externalColor[3]<1?ao.All:ao.None}get opaqueOverride(){return this.externalColorMixMode===cn.Replace&&this.externalColor[3]===1?ao.All:ao.None}get visible(){return this.externalColor[3]>0?ao.All:ao.None}get type(){return Kf.Uniform}}u([Rs({vectorOps:U0e})],m3.prototype,"externalColor",void 0),u([Rs()],m3.prototype,"externalColorMixMode",void 0),u([Rs()],m3.prototype,"castShadows",void 0),function(e){e[e.All=0]="All",e[e.Some=1]="Some",e[e.None=2]="None"}(ao||(ao={}));class yI extends ose{constructor(){super(...arguments),this.texture=null,this.transparent=ao.None,this.opaqueOverride=ao.None,this.castShadows=ao.None}get type(){return Kf.Varying}}function XEt(e){switch(e){case ua.Color:return oe.Color;case ua.Alpha:return oe.Alpha;case ua.Depth:return oe.Depth;case ua.Normal:return oe.Normal}}function YEt(e){return e.overlays.length!==0&&_(e.overlays[_s.INNER].getValidTexture(on.Highlight))}function JEt(e){return e.overlays.length!==0&&_(e.overlays[_s.INNER].getColorTextureNoRasterImage())}u([Rs()],yI.prototype,"texture",void 0),u([Rs()],yI.prototype,"transparent",void 0),u([Rs()],yI.prototype,"opaqueOverride",void 0),u([Rs()],yI.prototype,"castShadows",void 0);const Z$=Bs().vec3f(P.POSITION).u16(P.COMPONENTINDEX).u16(P.U16PADDING),a3e=Bs().vec2u8(P.SIDENESS),Xme=Xu(a3e),l3e=Bs().vec3f(P.POSITION0).vec3f(P.POSITION1).u16(P.COMPONENTINDEX).u8(P.VARIANTOFFSET,{glNormalized:!0}).u8(P.VARIANTSTROKE).u8(P.VARIANTEXTENSION,{glNormalized:!0}).u8(P.U8PADDING,{glPadding:!0}).u16(P.U16PADDING,{glPadding:!0}),LJ=l3e.clone().vec3f(P.NORMAL),DJ=l3e.clone().vec3f(P.NORMALA).vec3f(P.NORMALB),NJ=new Map([[P.POSITION0,0],[P.POSITION1,1],[P.COMPONENTINDEX,2],[P.VARIANTOFFSET,3],[P.VARIANTSTROKE,4],[P.VARIANTEXTENSION,5],[P.NORMAL,6],[P.NORMALA,6],[P.NORMALB,7],[P.SIDENESS,8]]);function Yme(e,t,i){const r=t/3,s=new Uint32Array(i+1),n=new Uint32Array(i+1),o=(b,S)=>{b<S?s[b+1]++:n[S+1]++};for(let b=0;b<r;b++){const S=e[3*b],T=e[3*b+1],C=e[3*b+2];o(S,T),o(T,C),o(C,S)}let a=0,l=0;for(let b=0;b<i;b++){const S=s[b+1],T=n[b+1];s[b+1]=a,n[b+1]=l,a+=S,l+=T}const c=new Uint32Array(6*r),h=s[i],p=(b,S,T)=>{if(b<S){const C=s[b+1]++;c[2*C]=S,c[2*C+1]=T}else{const C=n[S+1]++;c[2*h+2*C]=b,c[2*h+2*C+1]=T}};for(let b=0;b<r;b++){const S=e[3*b],T=e[3*b+1],C=e[3*b+2];p(S,T,b),p(T,C,b),p(C,S,b)}const f=(b,S)=>{const T=2*b,C=S-b;for(let A=1;A<C;A++){const O=c[T+2*A],D=c[T+2*A+1];let U=A-1;for(;U>=0&&c[T+2*U]>O;U--)c[T+2*U+2]=c[T+2*U],c[T+2*U+3]=c[T+2*U+1];c[T+2*U+2]=O,c[T+2*U+3]=D}};for(let b=0;b<i;b++)f(s[b],s[b+1]),f(h+n[b],h+n[b+1]);const m=new Int32Array(3*r),g=(b,S)=>b===e[3*S]?0:b===e[3*S+1]?1:b===e[3*S+2]?2:-1,y=(b,S)=>{const T=g(b,S);m[3*S+T]=-1},x=(b,S,T,C)=>{const A=g(b,S);m[3*S+A]=C;const O=g(T,C);m[3*C+O]=S};for(let b=0;b<i;b++){let S=s[b];const T=s[b+1];let C=n[b];const A=n[b+1];for(;S<T&&C<A;){const O=c[2*S],D=c[2*h+2*C];O===D?(x(b,c[2*S+1],D,c[2*h+2*C+1]),S++,C++):O<D?(y(b,c[2*S+1]),S++):(y(D,c[2*h+2*C+1]),C++)}for(;S<T;)y(b,c[2*S+1]),S++;for(;C<A;)y(c[2*h+2*C],c[2*h+2*C+1]),C++}return m}function yV(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:QEt(e.layout)}}function u4(e){return KEt(e.layout).createView(e.buffer)}function QEt(e){const t=new Array;return e.fields.forEach((i,r)=>{const s=me(F({},i),{constructor:c3e(i.constructor)});t.push([r,s])}),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}function KEt(e){const t=Bs();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach(i=>t.fields.set(i[0],me(F({},i[1]),{constructor:tCt(i[1].constructor)}))),t}const eCt=[DL,Mp,fr,Ho,cm,bM,wM,xM,fn,CS,$b,Lb,Ev,AS,Db,Hc,MS,TM,OS,Nb,RS,SM,p$,f$,EM,PS,m$,g$,y$,IS,v$,_$,b$,w$,x$,T$];function c3e(e){return`${e.ElementType}_${e.ElementCount}`}function tCt(e){return u3e.get(e)}const u3e=new Map;eCt.forEach(e=>u3e.set(c3e(e),e));class h3e{updateSettings(t){this.settings=t,this.edgeHashFunction=t.reducedPrecision?rCt:iCt}write(t,i,r){const s=this.edgeHashFunction(r);d4.seed=s;const n=d4.getIntRange(0,255),o=d4.getIntRange(0,this.settings.variants-1),a=.7,l=d4.getFloat(),c=255*(.5*sCt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1),t.componentIndex.set(i,r.componentIndex),t.variantOffset.set(i,n),t.variantStroke.set(i,o),t.variantExtension.set(i,c)}trim(t,i){return t.slice(0,i)}}const ase=new Float32Array(6),vV=new Uint32Array(ase.buffer),lb=new Uint32Array(1);function iCt(e){const t=ase;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],lb[0]=5381;for(let i=0;i<vV.length;i++)lb[0]=31*lb[0]+vV[i];return lb[0]}function rCt(e){const t=ase;t[0]=xE(e.position0[0]),t[1]=xE(e.position0[1]),t[2]=xE(e.position0[2]),t[3]=xE(e.position1[0]),t[4]=xE(e.position1[1]),t[5]=xE(e.position1[2]),lb[0]=5381;for(let i=0;i<vV.length;i++)lb[0]=31*lb[0]+vV[i];return lb[0]}const Jme=1e4;function xE(e){return Math.round(e*Jme)/Jme}function sCt(e,t){const i=e<0?-1:1;return Math.abs(e)**t*i}class _V{constructor(){this.commonWriter=new h3e}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return LJ.createBuffer(t)}write(t,i,r){this.commonWriter.write(t,i,r),we(h4,r.faceNormal0,r.faceNormal1),Re(h4,h4),t.normal.setVec(i,h4)}trim(t,i){return this.commonWriter.trim(t,i)}}_V.Layout=LJ,_V.glLayout=Xu(LJ,1);class bV{constructor(){this.commonWriter=new h3e}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return DJ.createBuffer(t)}write(t,i,r){this.commonWriter.write(t,i,r),t.normalA.setVec(i,r.faceNormal0),t.normalB.setVec(i,r.faceNormal1)}trim(t,i){return this.commonWriter.trim(t,i)}}bV.Layout=DJ,bV.glLayout=Xu(DJ,1);const h4=$(),d4=new ep,zx=-1;var wV;function FJ(e,t,i,r=uCt){const s=e.vertices.position,n=e.vertices.componentIndex,o=Yt(r.anglePlanar),a=Yt(r.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=kJ.edge,p=h.position0,f=h.position1,m=h.faceNormal0,g=h.faceNormal1,y=cCt(e),x=lCt(e),b=x.length/4,S=t.allocate(b);let T=0;const C=b,A=i.allocate(C);let O=0,D=0,U=0;const k=X4e(0,b),B=new Float32Array(b);Q4e(B,(ce,le,z)=>{s.getVec(x[4*le+0],p),s.getVec(x[4*le+1],f),z[le]=Pr(p,f)}),k.sort((ce,le)=>B[le]-B[ce]);const j=new Array,H=new Array;for(let ce=0;ce<b;ce++){const le=k[ce],z=B[le],q=x[4*le+0],Z=x[4*le+1],Y=x[4*le+2],te=x[4*le+3],se=te===zx;if(s.getVec(q,p),s.getVec(Z,f),se)he(m,y[3*Y+0],y[3*Y+1],y[3*Y+2]),pe(g,m),h.componentIndex=n.get(q),h.cosAngle=Pe(m,g);else{if(he(m,y[3*Y+0],y[3*Y+1],y[3*Y+2]),he(g,y[3*te+0],y[3*te+1],y[3*te+2]),h.componentIndex=n.get(q),h.cosAngle=Pe(m,g),oCt(h,c))continue;h.cosAngle<-.9999&&pe(g,m)}D+=z,U++,se||nCt(h,l)?(t.write(S,T++,h),j.push(z)):aCt(h,o)&&(i.write(A,O++,h),H.push(z))}const K=new Float32Array(j.reverse()),ee=new Float32Array(H.reverse());return{regular:{instancesData:t.trim(S,T),lodInfo:{lengths:K}},silhouette:{instancesData:i.trim(A,O),lodInfo:{lengths:ee}},averageEdgeLength:D/U}}function nCt(e,t){return e.cosAngle<t}function oCt(e,t){return e.cosAngle>t}function aCt(e,t){const i=Yn(e.cosAngle),r=kJ.fwd,s=kJ.ortho;return Rv(r,e.position1,e.position0),i*(Pe(Tt(s,e.faceNormal0,e.faceNormal1),r)>0?-1:1)>t}function lCt(e){const t=e.faces.length/3,i=e.faces,r=e.neighbors;let s=0;for(let a=0;a<t;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],f=i[3*a+1],m=i[3*a+2];s+=l===zx||p<f?1:0,s+=c===zx||f<m?1:0,s+=h===zx||m<p?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<t;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],f=i[3*a+1],m=i[3*a+2];(l===zx||p<f)&&(n[o++]=p,n[o++]=f,n[o++]=a,n[o++]=l),(c===zx||f<m)&&(n[o++]=f,n[o++]=m,n[o++]=a,n[o++]=c),(h===zx||m<p)&&(n[o++]=m,n[o++]=p,n[o++]=a,n[o++]=h)}return n}function cCt(e){const t=e.faces.length/3,i=e.vertices.position,r=e.faces,s=nH.v0,n=nH.v1,o=nH.v2,a=new Float32Array(3*t);for(let l=0;l<t;l++){const c=r[3*l+0],h=r[3*l+1],p=r[3*l+2];i.getVec(c,s),i.getVec(h,n),i.getVec(p,o),xe(n,n,s),xe(o,o,s),Tt(s,n,o),Re(s,s),a[3*l+0]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH"})(wV||(wV={}));const kJ={edge:{position0:$(),position1:$(),faceNormal0:$(),faceNormal1:$(),componentIndex:0,cosAngle:0},ortho:$(),fwd:$()},nH={v0:$(),v1:$(),v2:$()},uCt={anglePlanar:4,angleSignificantEdge:35};class d3e{async extract(t){const i=oH(t),r=lse(i),s=[i.data.buffer];return{result:hCt(r,s),transferList:s}}async extractComponentsEdgeLocations(t){const i=oH(t),r=UJ(i.data,i.skipDeduplicate,i.indices,i.indicesLength),s=FJ(r,mCt,ege),n=[];return{result:yV(s.regular.instancesData,n),transferList:n}}async extractEdgeLocations(t){const i=oH(t),r=UJ(i.data,i.skipDeduplicate,i.indices,i.indicesLength),s=FJ(r,fCt,ege),n=[];return{result:yV(s.regular.instancesData,n),transferList:n}}}function lse(e){const t=UJ(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return Qme.updateSettings(e.writerSettings),Kme.updateSettings(e.writerSettings),FJ(t,Qme,Kme)}function oH(e){return{data:Z$.createView(e.dataBuffer),indices:e.indicesType==="Uint32Array"?new Uint32Array(e.indicesBuffer):e.indicesType==="Uint16Array"?new Uint16Array(e.indicesBuffer):void 0,indicesLength:e.indicesLength,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}}function hCt(e,t){return t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:yV(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:yV(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}}function UJ(e,t,i,r){if(t)return{faces:i,facesLength:r,neighbors:Yme(i,r,e.count),vertices:e};const s=tRe(e.buffer,e.stride/4,{originalIndices:i,originalIndicesLength:r}),n=Yme(s.indices,r,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:Z$.createView(s.buffer)}}const Qme=new _V,Kme=new bV;class dCt{allocate(t){return p3e.createBuffer(t)}trim(t,i){return t.slice(0,i)}write(t,i,r){t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1)}}class pCt{allocate(t){return cse.createBuffer(t)}trim(t,i){return t.slice(0,i)}write(t,i,r){t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1),t.componentIndex.set(i,r.componentIndex)}}const fCt=new dCt,mCt=new pCt,ege={allocate:()=>null,write:()=>{},trim:()=>null},p3e=Bs().vec3f(P.POSITION0).vec3f(P.POSITION1),cse=Bs().vec3f(P.POSITION0).vec3f(P.POSITION1).u16(P.COMPONENTINDEX).u16(P.U16PADDING,{glPadding:!0});function gCt(){return new d3e}var yCt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",EdgeProcessingWorker:d3e,default:gCt,extract:lse,extractComponentsEdgeLocationsLayout:cse,extractEdgeLocationsLayout:p3e});class vCt{constructor(t){this.maxCount=t,this._nextIndex=0,this.recycledIndices=[]}get activeCount(){return this._nextIndex-this.recycledIndices.length}get availableCount(){return this.recycledIndices.length+this.maxCount-this._nextIndex}acquire(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(t){this.recycledIndices.push(t)}}class _Ct{constructor(t,i=1){this.rctx=t,this.fieldCount=i,this.textureWidth=4096,this.dirty=!0,this.texture=new _t(this.rctx,{target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:gt.NEAREST,wrapMode:$t.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this.data=new Hc(new ArrayBuffer(4*this.textureWidth))}dispose(){this.texture.dispose(),this.texture=void 0,this.data=void 0}setData(t,i,r,s,n,o){const a=t*this.fieldCount+i;this.dirty=!0,this.data.set(a,0,r),this.data.set(a,1,s),this.data.set(a,2,n),this.data.set(a,3,o)}setDataElement(t,i,r,s){const n=t*this.fieldCount+i;this.dirty=!0,this.data.set(n,r,s)}resizeToFit(t){const i=t*this.fieldCount;if(i>=this.data.count){const r=Math.ceil((i+1)/this.textureWidth)*this.textureWidth,s=new Hc(new ArrayBuffer(4*r));s.typedBuffer.set(this.data.typedBuffer),this.data=s}}updateTexture(){if(!this.dirty)return;const t=this.texture.descriptor.width,i=this.texture.descriptor.height;this.data.count>t*i&&this.texture.resize(t,this.data.count/t),this.texture.setData(this.data.typedBuffer),this.dirty=!1}bind(t,i,r){t.bindTexture(i,this.texture),t.setUniform2f(r,1/this.texture.descriptor.width,1/this.texture.descriptor.height)}}const f3e=65536;class bCt{constructor(t,i=1){this.textureBuffer=new _Ct(t,i),this.indexManager=new vCt(f3e)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this.indexManager.availableCount}get activeCount(){return this.indexManager.activeCount}acquireIndex(){const t=this.indexManager.acquire();return this.textureBuffer.resizeToFit(t),t}releaseIndex(t){this.indexManager.release(t)}}class m3e{constructor(t,i=1){this.rctx=t,this.fieldCount=i,this.buffers=[]}garbageCollect(){this.buffers=this.buffers.filter(t=>t.activeCount!==0||(t.dispose(),!1))}destroy(){this.buffers.forEach(t=>t.dispose()),this.buffers=[]}getBuffer(t){for(const r of this.buffers)if(r.availableCount>=t)return r;if(t>f3e)return null;const i=new bCt(this.rctx,this.fieldCount);return this.buffers.push(i),i}updateTextures(){for(const t of this.buffers)t.textureBuffer.updateTexture()}}const tge=ve.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class wCt{constructor(t,i){this._renderManager=t,this._viewingMode=i,this._objects=[new ai,new ai],this._renderSubmit=new kEt(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new m3e(t.rctx,2)}dispose(){Ct(this._objects[OA.Hidden].length===0&&this._objects[OA.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(t){const i=new IJ;return i.toMapSpace=t.toMapSpace,i.transform=t.transform,i.obb=Lme(t.obb),i.components=new bEt(this._componentBufferManager,t.geometry.componentOffsets),i.renderable=this._createRenderable(t,i.components),i.intersectionGeometry=new AEt(t.geometry.positionData,i.components),this._objects[i.visible].push(i),i}destroyObject(t){const i=t;this._objects[i.visible].removeUnordered(i),i.dispose(),this._notifyDirty()}setObjectVisibility(t,i){const r=t;i!==r.visible&&(this._objects[r.visible].removeUnordered(r),this._objects[i].push(r),r.visible=i,this._notifyDirty())}preSubmit(t){const i=t.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=uo(i,r.obb.center))}getMaterial(t){return t.renderable.material}updateMaterial(t,i){const r=t.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(t,i){const r=t;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(t,i){return t.components.visibility.forEachComponent(i)}getComponentCount(t){const i=t,r=i.components.visibility.componentCount();return{visible:r,invisible:i.components.count-r}}setComponentData(t,i){const r=t,s=r.renderable.material,n=r.components,o=n.materialDataBuffer,a=n.materialDataIndices,l={castShadows:!0,pickable:!0,externalColor:kre(),externalColorMixMode:cn.Multiply,elevationOffset:0},c=o.textureBuffer,h=new Uint8Array(4),p=new Uint32Array(h.buffer);let f=0,m=0,g=0,y=n.verticalOffsets,x=1/0,b=-1/0,S=!1,T=!1,C=0;for(let A=0;A<n.count;A++)i(A,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===cn.Replace&&l.externalColor[3]===1),g+=+l.castShadows,BRe(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[A],0,h[0],h[1],h[2],h[3]),S||(S=A>0&&C!==p[0]),C=p[0],T||(T=l.elevationOffset!==0),T&&M(y)&&(y=new Array(A).fill(0)),_(y)&&(y[A]=l.elevationOffset),x=Math.min(x,l.elevationOffset),b=Math.max(b,l.elevationOffset),n3e(l.elevationOffset,h),c.setData(a[A],1,h[0],h[1],h[2],h[3]),l.pickable!==t3e(n.pickability,A)&&(n.pickability=xEt(n.pickability,n.count,A,l.pickable));n.verticalOffsets=T?y:null,r.offsetObb=T?hEt(r.obb,x,b,this._viewingMode,_(r.offsetObb)?r.offsetObb:Lme(r.obb)):null,S||T?(s.componentParameters=new yI,s.componentParameters.castShadows=aH(g,n.count),s.componentParameters.transparent=aH(f,n.count),s.componentParameters.opaqueOverride=aH(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new m3,s.componentParameters.castShadows=l.castShadows?ao.All:ao.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(t,i,r,s=!1){t.intersectionGeometry.getComponentAabb(i,r);const n=t,o=n.components.verticalOffsets;if(s||M(o))return r;const a=o[i];if(this._viewingMode===tt.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=Olt(a);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(t){return t.obb}getObjectTransform(t){return t.transform}getComponentPositions(t,i,r){return t.intersectionGeometry.getComponentPositions(i,r)}intersect(t,i,r,s,n,o){const a=t;_(n)&&(n.localOrigin=a.transform.position);const l=l2(ige,a.transform.rotationScale);zu(p4,i,a.transform.position),zu(f4,r,a.transform.position),Pu(p4,p4,l),Pu(f4,f4,l);const c=Ap(ige,l);return a.intersectionGeometry.intersect(p4,f4,s,c,n,a.components.verticalOffsets,o)}addEdges(t,i,r,s){const n=t,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return i.addComponentObject(t,n.transform,{center:n.obb.center,radius:H2t(n.obb)},a,o,l,r,s)}async extractEdgeInformation(t,i,r){const s=t,n=s.components.visibility;if(n.allInvisible())return{buffer:cse.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=Z$.createBuffer(a.count);a8(c.position,a),jb(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,p=this._computeVisibilityIndices(o,n,l,h);return{origin:Rn(s.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(t,i,r){let s=0;for(let n=0;n<r.length-1;n++){const o=r[n],a=r[n+1];for(let l=o;l<a;l++){const c=i?i[l]:l;t.set(c,s)}s++}}_computeVisibilityIndices(t,i,r,s){if(t&&i.allVisible())return t;let n=0;i.forEachComponentRange((l,c)=>(n+=r[c]-r[l],!0));const o=(t==null?void 0:t.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return i.forEachComponentRange((l,c)=>{const h=r[l],p=r[c];for(let f=h;f<p;f++)o[a++]=t?t[f]:f;return!0}),o}addComponentHighlight(t,i){const r=t.components;M(r.highlightCounts)&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(t,i){const r=t.components;if(M(r.highlightCounts))return void tge.warn("Removing non-existing highlight.");const s=r.highlightCounts[i],n=r.highlightCounts[r.count];if(s!==0){if(s>1)return r.highlightCounts[i]=s-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),n===1?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else tge.warn("Removing non-existing highlight.")}clearHighlights(t){const i=t.components;_(i.highlightCounts)&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(t){return t.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[OA.Visible]}_createRenderable(t,i){const r=this._renderManager.rctx,s=t.geometry,n=s.vertices.layoutParameters,o=Ci.createVertex(r,Wi.STATIC_DRAW,s.vertices.data),a=wt(s.indices,y=>Ci.createIndex(r,Wi.STATIC_DRAW,y)),l=Xu(UEt(n)),c=new Uint16Array(s.vertices.count);for(let y=0;y<i.count;y++){const x=i.offsets[y],b=i.offsets[y+1],S=i.materialDataIndices[y];if(_(s.indices))for(let T=x;T<b;T++)c[s.indices[T]]=S;else for(let T=x;T<b;T++)c[T]=S}const h=Ci.createVertex(r,Wi.STATIC_DRAW,c.buffer),p=new So(t.transform,t.toMapSpace),f=new Ln(r,p.attributeLocations,{data:l,componentIndices:xCt},{data:o,componentIndices:h},a),m=new r3e(f,Wt.TRIANGLES,n,_(a)),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteSize+h.byteSize+(_(a)?a.byteSize:0)};return new REt(p,m,g)}_notifyDirty(){this._renderManager.notifyDirty()}}const xCt=Xu(Bs().u16(P.COMPONENTINDEX));function aH(e,t){return e===t?ao.All:e===0?ao.None:ao.Some}const ige=nv(),p4=$(),f4=$();class g3e extends Nn{constructor(){super(...arguments),this.overlayIndex=0,this.opacity=1}}function TCt(e){const t=new mr;t.include(Kb);const i=t.fragment;switch(e.function){case Ru.Standard:i.uniforms.add(new oi("tex",r=>r.texture)),e.hasOpacityFactor?(i.uniforms.add(new lt("opacity",r=>r.opacity)),i.code.add(E`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):i.code.add(E`void main() {
gl_FragColor = texture2D(tex, uv);
}`);break;case Ru.OverlayWithTransparency:i.uniforms.add(new oi("tex",r=>r.texture)),i.uniforms.add(new JL("overlayIdx",r=>r.overlayIndex)),e.hasOpacityFactor&&i.uniforms.add(new lt("opacity",r=>r.opacity)),i.code.add(E`
        void main() {
          vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
          gl_FragColor = texture2D(tex, overlayUV) ${e.hasOpacityFactor?"* opacity":""};
        }`);break;case Ru.TransparentToHUDVisibility:i.uniforms.add(new oi("tex",r=>r.texture)),i.code.add(E`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);break;case Ru.Transparency:i.uniforms.add([new oi("colorTexture",r=>r.colorTexture),new oi("alphaTexture",r=>r.alphaTexture),new oi("frontFaceTexture",r=>r.frontFaceTexture)]),i.code.add(E`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);break;case Ru.COUNT:break;default:e.function}return t}const SCt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:g3e,build:TCt},Symbol.toStringTag,{value:"Module"}));class X$ extends Lr{initializeProgram(t){const i=X$.shader.get().build(this.configuration);return new Er(t.rctx,i,lr)}initializePipeline(){if(this.configuration.function===Ru.TransparentToHUDVisibility)return ri({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case Na.None:return ri({colorWrite:xi});case Na.Alpha:return ri({blending:ba(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),colorWrite:xi});default:return ri({blending:my(ke.ONE,ke.ONE_MINUS_SRC_ALPHA),colorWrite:xi})}}}X$.shader=new Sr(SCt,()=>import("./Compositing.glsl.cbd4a3ec.js"));class ECt{constructor(t,i){this._rctx=t,this._techniqueRepository=i,this._configuration=new dk,this._passParameters=new g3e}dispose(){this._vao=ht(this._vao)}compositeTransparent(t,i,r,s,n=1){this._configuration.alphaMode=Na.Alpha,this._configuration.function=Ru.Transparency,this._configuration.hasOpacityFactor=n!==1,this._passParameters.colorTexture=i,this._passParameters.alphaTexture=r,this._passParameters.frontFaceTexture=s;const o=this._rctx,a=this._techniqueRepository.acquire(X$,this._configuration);o.bindTechnique(a,this._passParameters,t);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays(Wt.TRIANGLE_STRIP,0,ka(l,"geometry")),a.release()}composite(t,i,r=Na.None,s=1,n=Ru.Standard,o=_s.INNER){const a=this._rctx;this._configuration.alphaMode=r,this._configuration.function=n,this._configuration.hasOpacityFactor=s!==1,this._passParameters.overlayIndex=o,this._passParameters.texture=i,this._passParameters.opacity=s;const l=this._techniqueRepository.acquire(X$,this._configuration);a.bindTechnique(l,this._passParameters,t);const c=this._ensureVAO();a.bindVAO(c),a.drawArrays(Wt.TRIANGLE_STRIP,0,ka(c,"geometry")),l.release()}_ensureVAO(){return M(this._vao)&&(this._vao=Yl(this._rctx)),this._vao}}const CCt=1e4,zJ=100,ACt=500,MCt=500,OCt=.1;function RCt(e,t,i){return Kie(t,e)*(i[1]-i[0])+i[0]}function PCt(e,t,i){if(t.size<CCt)return UCt.compute(e,t);const r=iD();return i.forAll(s=>{s.isVisible&&BM(r,ICt(e,s))}),r}function ICt(e,t){if(!t.isVisible)return;const i=iD(),r=t.getSpatialQueryAccelerator();return _(r)?$Ct(i,e,r):LCt(i,e,t.objects),i}function $Ct(e,t,i){const r=t.eye,s=t.viewForward,n=t.frustum,o=l=>l.isVisible,a=i.objectCount;if(a<ACt)W$(Jd,t.near,Math.min(e.near,t.far)),i.forEachInDepthRange(r,s,Vf.DepthOrder.FRONT_TO_BACK,Jd,(l,c)=>{VJ(e,t,l),Jd.far=e.near,c.setRange(Jd)},n,o),W$(Jd,Math.max(e.far,t.near),t.far),i.forEachInDepthRange(r,s,Vf.DepthOrder.BACK_TO_FRONT,Jd,(l,c)=>{VJ(e,t,l),Jd.near=e.far,c.setRange(Jd)},n,o);else{const l=Math.max(Math.min(a,MCt),Math.ceil(a*OCt)),c=i.findClosest(s,Vf.DepthOrder.FRONT_TO_BACK,n,o,l),h=i.findClosest(s,Vf.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(rge(e,t,c.boundingVolumeWorldSpace.bounds),rge(e,t,h.boundingVolumeWorldSpace.bounds))}}function LCt(e,t,i){TE.clear(),i.forAll(r=>{r.isVisible&&r.geometryRecords.length!==0&&TE.add(r)}),TE.empty||(TE.sort(t),W$(Jd,t.near,Math.min(e.near,t.far)),TE.forEachInDepthRange(Jd,Vf.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<e.near&&VJ(e,t,r)}),W$(Jd,Math.max(e.far,t.near),t.far),TE.forEachInDepthRange(Jd,Vf.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{e.far=Math.max(e.far,n)}))}function VJ(e,t,i){if(!i.isVisible||!rb(t.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=kCt;i.geometryRecords.forEach(n=>{As(s,r,n.getShaderTransformation());const o=mS(s);y3e(e,t,n.geometry.boundingInfo,s,o)})}function y3e(e,t,i,r,s){if(M(i))return;const n=t.eye,o=t.viewForward;Xe($a,i.center,r);const a=o[0]*($a[0]-n[0])+o[1]*($a[1]-n[1])+o[2]*($a[2]-n[2]);if($a[3]=i.radius*s,!(a-$a[3]>e.near&&a+$a[3]<e.far)&&rb(t.frustum,$a))if(i.radius>zJ&&i.getChildren()){const l=i.getChildren();for(let c=0;c<8;++c)l[c]&&y3e(e,t,l[c],r,s)}else BJ.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function rge(e,t,i){const r=t.eye,s=t.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];e.near=Math.min(e.near,n-i[3]),e.far=Math.max(e.far,n+i[3])}class DCt{constructor(){this._items=new ai({allocator:t=>t||{obj:null,distance:0,near:0,far:0},deallocator:t=>(t.obj=null,t.distance=0,t.near=0,t.far=0,t)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(t){this._items.pushNew().obj=t}sort(t){const i=t.eye,r=t.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(t,i,r){if(i===Vf.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.obj,n.near,n.far)}}}class NCt{constructor(){this.view=Ne(),this.viewProj=Ne(),this.frustum=C$(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}compute(t,i){this._reset(),ln(this.view,t.viewMatrix),As(this.viewProj,t.projectionMatrix,this.view),Rz(this.frustum,t.frustum);const r=this.view,s=r[2],n=r[6],o=r[10],a=r[14],l=this.range;let c=0;if(i.forEach(m=>{if(!m.instanceParameters.visible||!m.castShadow)return;let g;m.hasShaderTransformation?(m.computeBoundingSphere(m.getShaderTransformation(),$a,1),g=$a):g=m.boundingSphere;const y=s*g[0]+n*g[1]+o*g[2]+a,x=y-g[3],b=y+g[3];this.geometries[c]=m,this.near[c]=-b,this.far[c]=-x,++c}),this.geometries.length===0)return l;for(let m=0;m<this.geometries.length;++m)this.near[m]>l.far&&(l.far=this.near[m]),this.near[m]>2&&this.far[m]<l.near&&(l.near=this.far[m]);const h=this.looseRange;h.near=Math.max(.5*l.near,2),h.far=2*l.far;let p=0,f=0;for(let m=0;m<this.geometries.length;++m)this.near[m]<l.near&&(this.near[m]>=h.near?l.near=this.near[m]:this.nearCandidates[p++]=m),this.far[m]>l.far&&(this.far[m]<=h.far?l.far=this.far[m]:this.farCandidates[f++]=m);if(this.nearCandidates.length===0&&this.farCandidates.length===0)return l;this.nearCandidates.sort((m,g)=>this.near[m]<this.near[g]?-1:this.near[m]>this.near[g]?1:0),this.farCandidates.sort((m,g)=>this.far[m]<this.far[g]?1:this.far[m]>this.far[g]?-1:0);for(let m=0;m<this.nearCandidates.length;++m){const g=this.nearCandidates[m];if(this.near[g]<l.near){const y=this.geometries[g],x=y.boundingInfo;this._includeNearBoundingInfoRec(x,y.getShaderTransformation())}}for(let m=0;m<this.farCandidates.length;++m){const g=this.farCandidates[m];if(this.far[g]>l.far){const y=this.geometries[g],x=y.boundingInfo;this._includeFarBoundingInfoRec(x,y.getShaderTransformation())}}return l}_reset(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE}_includeNearBoundingInfoRec(t,i){if(M(t))return;const r=t.getCenter();Xe($a,r,i);const s=mS(i),n=$a[0],o=$a[1],a=$a[2],l=t.getBSRadius()*s,c=this.frustum;if(c[0][0]*n+c[0][1]*o+c[0][2]*a+c[0][3]>l||c[1][0]*n+c[1][1]*o+c[1][2]*a+c[1][3]>l||c[2][0]*n+c[2][1]*o+c[2][2]*a+c[2][3]>l||c[3][0]*n+c[3][1]*o+c[3][2]*a+c[3][3]>l)return;const h=this.view[2]*n+this.view[6]*o+this.view[10]*a+this.view[14],p=h+l;if(!(-(h-l)<2||-p>=this.range.near))if(-p>this.looseRange.near)this.range.near=-p;else{if(l>zJ){const f=t.getChildren();if(f!==void 0){for(let m=0;m<8;++m)f[m]!==void 0&&this._includeNearBoundingInfoRec(f[m],i);return}}BJ.unionDepthRangeWithAABB(this.range,this.viewProj,i,t.getBBMin(),t.getBBMax())}}_includeFarBoundingInfoRec(t,i){if(M(t))return;let r=t.getBSRadius();const s=t.getCenter();Xe($a,s,i);const n=mS(i),o=$a[0],a=$a[1],l=$a[2];r*=n;const c=this.frustum;if(c[0][0]*o+c[0][1]*a+c[0][2]*l+c[0][3]>r||c[1][0]*o+c[1][1]*a+c[1][2]*l+c[1][3]>r||c[2][0]*o+c[2][1]*a+c[2][2]*l+c[2][3]>r||c[3][0]*o+c[3][1]*a+c[3][2]*l+c[3][3]>r)return;const h=this.view[2]*o+this.view[6]*a+this.view[10]*l+this.view[14]-r;if(!(-h<=this.range.far))if(-h<this.looseRange.far)this.range.far=-h;else{if(r>zJ){const p=t.getChildren();if(p!==void 0){for(let f=0;f<8;++f)p[f]!==void 0&&this._includeFarBoundingInfoRec(p[f],i);return}}BJ.unionDepthRangeWithAABB(this.range,this.viewProj,i,t.getBBMin(),t.getBBMax())}}}class FCt{constructor(){this.modelViewProj=Ne(),this.clipPosition=[si(),si(),si(),si(),si(),si(),si(),si()]}unionDepthRangeWithAABB(t,i,r,s,n){const o=this.modelViewProj;As(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this.clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],p=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*p+o[8]*f+o[12],c[1]=o[1]*h+o[5]*p+o[9]*f+o[13],c[2]=o[2]*h+o[6]*p+o[10]*f+o[14],c[3]=o[3]*h+o[7]*p+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this.clipPosition[lH[l][0]],h=this.clipPosition[lH[l][1]],p=this.clipPosition[lH[l][2]],f=this._clipTriangle(c,h,p);let m=!0;for(let g=0;g<f.length;++g)if(f[g][3]>=2){m=!1;break}if(!m){a=!0;for(let g=0;g<f.length;++g){const y=f[g][3];y<t.near&&(t.near=y),y>t.far&&(t.far=y)}}}return a}_inside(t,i){return i===0?t[0]>=-t[3]:i===1?t[1]>=-t[3]:i===2?t[0]<=t[3]:i===3?t[1]<=t[3]:void Ct(!1)}_intersect(t,i,r){let s=0;return r===0?s=(-t[3]-t[0])/(i[0]-t[0]+i[3]-t[3]):r===1?s=(-t[3]-t[1])/(i[1]-t[1]+i[3]-t[3]):r===2?s=(t[3]-t[0])/(i[0]-t[0]-i[3]+t[3]):r===3&&(s=(t[3]-t[1])/(i[1]-t[1]-i[3]+t[3])),RV(si(),t,i,s)}_clipTriangle(t,i,r){let s=[t,i,r];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}}const lH=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],$a=fo(),kCt=Ne(),Jd=iD(),TE=new DCt,UCt=new NCt,BJ=new FCt;class zCt extends Nn{constructor(){super(...arguments),this.maskEnabled=!1,this.overlayEnabled=!1}}function VCt(){const e=new mr;return e.attributes.add(P.POSITION,"vec2"),e.vertex.uniforms.add(new Gl("drawPosition")),e.varyings.add("vUV","vec2"),e.vertex.code.add(E`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),e.fragment.uniforms.add(new ws("textureInput")),e.fragment.uniforms.add(new ws("textureMask")),e.fragment.uniforms.add(new ws("textureOverlay")),e.fragment.uniforms.add(new ES("maskEnabled",t=>t.maskEnabled)),e.fragment.uniforms.add(new ES("overlayEnabled",t=>t.overlayEnabled)),e.fragment.code.add(E`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),e}async function BCt(e){const t=import("./mask-svg.d736db49.js"),i=import("./overlay-svg.ddc1dd43.js"),r=lm((await t).default,{signal:e}),s=lm((await i).default,{signal:e}),n={mask:await r,overlay:await s};return qt(e),n}let yC=class extends Ee{constructor(){super(...arguments),this._handles=new Nt,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new zCt,this.events=new cs,this.attributeLocations=new Map([[P.POSITION,0]]),this.tmpScreenPoint=Ts(),this.tmpRenderPoint=Rze()}get updating(){return M(this._imageSources)&&_(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const t=()=>{this._updateResourceLoading(),this.events.emit("request-render")};_(this._magnifier)&&this._handles.add(re(()=>wt(this._magnifier,i=>i.version),t)),t()}get enabled(){return _(this._validMagnifier)}get _validMagnifier(){return _(this._magnifier)&&this._magnifier.visible&&_(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get factor(){return _(this._magnifier)&&this._magnifier.factor||1}dispose(){this._magnifier=null,this._handles.destroy(),_(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,t){const i=this._validMagnifier;if(M(i))return;const r=t.camera.pixelRatio,s=Math.ceil(r*i.size);if(this._updateResources(e,s),M(this._resources))return;this._passParameters.maskEnabled=i.maskEnabled,this._passParameters.overlayEnabled=i.overlayEnabled;const n=this._resources.program;e.useProgram(n),n.bindPass(this._passParameters,t);const o=this._resources.textures,a=Math.ceil(1/this.factor*s);o.input.resize(a,a);const l=t.camera.fullWidth,c=t.camera.fullHeight;L0(i.position,this.tmpScreenPoint);const h=t.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint),p=.5*a,f=.5*a;h[0]=He(h[0],p,l-p-1),h[1]=He(h[1],f,c-f-1);const m=Math.floor(h[0]-p),g=Math.floor(h[1]-f);n.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,g,a,a,0);const y=i.offset.x*r,x=i.offset.y*r,b=(h[0]+y)/l*2-1,S=(h[1]-x)/c*2-1,T=s/l*2,C=s/c*2;e.bindVAO(this._resources.vao),n.bindTexture("textureOverlay",o.overlay),n.bindTexture("textureMask",o.mask),n.setUniform4f("drawPosition",b,S,T,C),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Wt.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(M(e))return;const t=e.maskUrl,i=e.overlayUrl;!_(this._imageLoadTask)||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),_(this._imageSources)||_(this._imageLoadTask)||(this._imageLoadTask={maskUrl:t,overlayUrl:i,task:Pv(async r=>{const s=M(t)||M(i)?BCt(r):null,n=_(t)?lm(t,{signal:r}):s.then(a=>a.mask),o=_(i)?lm(i,{signal:r}):s.then(a=>a.overlay);this._imageSources={mask:await n,overlay:await o},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,t){if(!this.enabled)return void this._disposeResources();if(_(this._resources)){if(this._resources.textures.size!==t){const r=this._createTextureResources(e,t);if(M(r))return void this._disposeResources();this._disposeTextureResources(this._resources.textures),this._resources.textures=r}return}const i=this._createTextureResources(e,t);M(i)||(this._resources={textures:i,program:this._createProgram(e),vao:Yl(e,Qte,this.attributeLocations,0,1),pipelineState:ri({blending:my(ke.ONE,ke.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:xi})})}_disposeResources(){M(this._resources)||(this._disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,t){if(M(this._imageSources))return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const i=new _t(e,{target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,internalFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:gt.LINEAR,flipped:!0,preMultiplyAlpha:!EK(this._imageSources.overlay.src)||!e.driverTest.svgAlwaysPremultipliesAlpha},this._imageSources.overlay),r=new _t(e,{target:At.TEXTURE_2D,pixelFormat:Qe.ALPHA,internalFormat:Qe.ALPHA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:gt.LINEAR,flipped:!0},this._imageSources.mask);return{input:new _t(e,{target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,internalFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:gt.LINEAR,flipped:!1}),mask:r,overlay:i,size:t}}_createProgram(e){return new Er(e,VCt(),this.attributeLocations)}};u([d()],yC.prototype,"_imageSources",void 0),u([d()],yC.prototype,"_imageLoadTask",void 0),u([d({readOnly:!0})],yC.prototype,"updating",null),yC=u([L("esri/views/3d/webgl-engine/lib/MagnifierHelper")],yC);const GCt=.5,jCt=1e3/30;var Y$;(function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"})(Y$||(Y$={}));class R_{constructor(t,i,r=Y$.FrontToBack){this._rctx=t,this._techniqueRepository=i,this._sorting=r,this._draws=new ai({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(t,i,r,s){const n=this._draws.pushNew();n.geometry=i,n.geometryRanges=r,n.material=t,n.depthSquaredHint=s,n.indexType=i.indexed?i.vao.indexBuffer.indexType:0}dispatch(t,i){const r=this._rctx;this._previouslyBoundDraw.clear();let s=null;const n=this._draws.map(a=>a.material.prepareTechnique(this._techniqueRepository,t,i,a.geometry.parameters)),o=this._draws.length;for(let a=0;a<o;a++){const l=n[a];l===s&&l.configuration.transparencyPassType===Rt.NONE||(r.bindTechnique(l,t,i),s=l);const c=this._draws.data[a],h=c.geometry;r.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.bindDraw(c.material,i),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,f=p.length;if(c.indexType!==0){const m=$k.get(c.indexType);for(let g=0;g<f;g+=2){const y=p[g],x=p[g+1];r.drawElements(h.primitiveType,x,c.indexType,y*m)}}else for(let m=0;m<f;m+=2){const g=p[m],y=p[m+1];r.drawArrays(h.primitiveType,g,y)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const t=this._sorting===Y$.FrontToBack?1:-1;this._draws.sort((i,r)=>{const s=t*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.size-r.geometry.vao.size})}get count(){return this._draws.length}}const $k=new Map;$k.set(St.UNSIGNED_BYTE,1),$k.set(St.UNSIGNED_SHORT,2),$k.set(St.UNSIGNED_INT,4);class HCt{constructor(t,i){this.rctx=t,this.shaderTechniqueRepository=i,this.canRender=!0,this._materialPassParameters=new jSt,this._shadowPassParameters=new HSt,this._highlightPassParameters=new qSt,this._systems=new Set,this._passes={materialOpaque:new R_(t,i),materialTransparent:new R_(t,i,Y$.BackToFront),materialIntegratedMesh:new R_(t,i),shadowMap:new R_(t,i),highlight:new R_(t,i),highlightIntegratedMesh:new R_(t,i),highlightShadowMap:new R_(t,i),defaultShadowMap:new R_(t,i)}}register(t){this._systems.add(t)}prepareRender(t){if(this._systems.size!==0){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,t.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(t){if(this._systems.size!==0)switch(this._configure(t),t.bindParameters.slot){case $e.OPAQUE_MATERIAL:switch(t.pass){case rt.MATERIAL:return this._materialPassParameters.subPass=ua.Color,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case rt.MATERIAL_DEPTH:return this._materialPassParameters.subPass=ua.Depth,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case rt.MATERIAL_NORMAL:return this._materialPassParameters.subPass=ua.Normal,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case rt.MATERIAL_HIGHLIGHT:return this._passes.highlight.dispatch(this._highlightPassParameters,t.bindParameters);case rt.MATERIAL_DEPTH_SHADOWMAP_ALL:return this._passes.shadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case rt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case rt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,t.bindParameters)}return;case $e.TRANSPARENT_MATERIAL:switch(t.pass){case rt.MATERIAL:return this._materialPassParameters.subPass=ua.Color,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case rt.MATERIAL_ALPHA:return this._materialPassParameters.subPass=ua.Alpha,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case rt.MATERIAL_DEPTH:return this._materialPassParameters.subPass=ua.Depth,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case rt.MATERIAL_NORMAL:return this._materialPassParameters.subPass=ua.Normal,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters)}return;case $e.INTEGRATED_MESH:switch(t.pass){case rt.MATERIAL:return this._materialPassParameters.subPass=ua.Color,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case rt.MATERIAL_DEPTH:return this._materialPassParameters.subPass=ua.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case rt.MATERIAL_NORMAL:return this._materialPassParameters.subPass=ua.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case rt.MATERIAL_HIGHLIGHT:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,t.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[$e.OPAQUE_MATERIAL,$e.TRANSPARENT_MATERIAL,$e.INTEGRATED_MESH]}initializeRenderContext(t){this._context=t}uninitializeRenderContext(){}queryDepthRange(t){const i={near:1/0,far:-1/0};return this._systems.forEach(r=>{const s=r.queryShadowCasterDepthRange(t);_(s)&&BM(i,s,i)}),i}_configure(t){const i=t.pass===rt.MATERIAL_DEPTH_SHADOWMAP_ALL||t.pass===rt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||t.pass===rt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT?this._shadowPassParameters:t.pass===rt.MATERIAL_HIGHLIGHT?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(t,i)}_updateParameters(t,i){const r=t.bindParameters.camera,s=r.viewInverseTransposeMatrix;he(cH,s[3],s[7],s[11]),uH.set(cH),pe(i.transformWorldFromViewTH,uH.high),pe(i.transformWorldFromViewTL,uH.low),pe(i.slicePlaneLocalOrigin,cH),Cp(i.transformViewFromCameraRelativeRS,r.viewMatrix),ln(i.transformProjFromView,r.projectionMatrix),i.identifier===Gh.Material&&(this._materialPassParameters.transparent=t.bindParameters.slot===$e.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=t.bindParameters.slot===$e.INTEGRATED_MESH,Ap(sge,i.transformViewFromCameraRelativeRS),l2(i.transformNormalViewFromGlobal,sge))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}}const cH=$(),sge=ls(),uH=new C8,qCt=8.6,WCt=.4;function ZCt(){const e=new mr,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(P.POSITION,"vec2"),e.varyings.add("uv","vec2"),e.attributes.add(P.UV0,"vec2"),t.uniforms.add(new oi("coverageTex",n=>n.coverageTexture)),r.add(E`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new oi("tex",n=>n.blurColorTexture)),i.uniforms.add(new oi("origin",n=>n.highlightColorTexture)),i.uniforms.add(new Ei("uColor",n=>n.color)),i.uniforms.add(new Ei("haloColor",n=>n.haloColor)),i.uniforms.add(new Ei("opacities",n=>_r(XCt,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),i.constants.add("outlineSize","float",qCt),i.constants.add("blurSize","float",WCt),s.add(E`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),e}const XCt=si(),YCt=Object.freeze(Object.defineProperty({__proto__:null,build:ZCt},Symbol.toStringTag,{value:"Module"}));class A8 extends Lr{initializeProgram(t){const i=A8.shader.get().build();return new Er(t.rctx,i,lr)}initializePipeline(){return ri({blending:ba(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),colorWrite:xi})}}A8.shader=new Sr(YCt,()=>import("./HighlightApply.glsl.8e837dc6.js"));class v3e extends Nn{constructor(){super(...arguments),this.blurSize=Ke()}}function JCt(){const e=new mr,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(P.POSITION,"vec2"),e.attributes.add(P.UV0,"vec2"),e.varyings.add("blurCoordinate","vec3"),t.uniforms.add(new oi("coverageTex",n=>n.coverageTexture)),i.uniforms.add(new nie("blurSize",n=>n.blurSize)),r.add(E`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),i.uniforms.add(new oie("tex",n=>n.blurInputTexture)),s.add(E`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),e}const QCt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:v3e,build:JCt},Symbol.toStringTag,{value:"Module"}));class M8 extends Lr{initializeProgram(t){const i=M8.shader.get().build();return new Er(t.rctx,i,lr)}initializePipeline(){return ri({colorWrite:xi})}}M8.shader=new Sr(QCt,()=>import("./HighlightBlur.glsl.a2234704.js"));class _3e extends Nn{constructor(){super(...arguments),this.invFramebufferDim=Ke()}}function KCt(){const e=new mr,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(P.POSITION,"vec2"),r.add(E`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),i.uniforms.add(new oie("tex",n=>n.inputTexture)),i.uniforms.add(new nie("invFramebufferDim",n=>n.invFramebufferDim)),s.add(E`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),e}const eAt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:_3e,build:KCt},Symbol.toStringTag,{value:"Module"}));class O8 extends Lr{initializeProgram(t){const i=O8.shader.get().build();return new Er(t.rctx,i,lr)}initializePipeline(){return ri({colorWrite:xi})}}O8.shader=new Sr(eAt,()=>import("./HighlightDownsample.glsl.5c88c7c3.js"));class nge extends Nn{constructor(){super(...arguments),this.color=Rp(1,0,1,1),this.haloColor=Rp(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=zi(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}}const tAt=32;class iAt{constructor(t,i){this._techniqueRep=t,this._rctx=i,this.viewportToRestore=si(),this._passParameters=new nge,this._downsampleDrawParameters=new _3e,this._blurDrawParameters=new v3e,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this.quadVAO)return;this.quadVAO=Yl(this._rctx);const t={colorTarget:zs.TEXTURE,depthStencilTarget:Yi.NONE,width:0,height:0},i={target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:gt.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:0,height:0};this.blur0Fbo=new ss(this._rctx,t,i),this.blur1Fbo=new ss(this._rctx,t,i);const r=new Xl;this._blurTechnique=this._techniqueRep.acquire(M8,r),this._downsampleTechnique=this._techniqueRep.acquire(O8,r),this._applyTechnique=this._techniqueRep.acquire(A8,r)}dispose(){if(this._blurTechnique=br(this._blurTechnique),this._downsampleTechnique=br(this._downsampleTechnique),this._applyTechnique=br(this._applyTechnique),this._grid.coverageMipmap)for(let t=1;t<this._grid.coverageMipmap.length;t++)this._grid.coverageMipmap[t].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null),this.blur0Fbo=ht(this.blur0Fbo),this.blur1Fbo=ht(this.blur1Fbo)}setDefaultOptions(t){this._passParameters=F(F({},new nge),t)}render(t,i,r){this._passParameters.highlightColorTexture=i.colorTexture,this._assertResources();const s=t.camera;Lf(this.viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this.blur0Fbo.resize(l,c),this.blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this.quadVAO);let p=null;this._gridUpdateResources(i,tAt),this._gridComputeMipmap(t),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const f=h.bindTechnique(this._blurTechnique,this._passParameters,t);h.bindVAO(p),h.bindFramebuffer(this.blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(wr.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=i.colorTexture,Li(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,t),h.drawArrays(this._blurTechnique.primitiveType,0,ka(p,"geometry")),h.bindFramebuffer(this.blur1Fbo),h.clear(wr.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this.blur0Fbo.colorTexture,Li(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,t),h.drawArrays(this._blurTechnique.primitiveType,0,ka(p,"geometry")),h.bindFramebuffer(r),h.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),this._passParameters.blurColorTexture=this.blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,t),h.drawArrays(this._applyTechnique.primitiveType,0,ka(p,"geometry")),h.bindVAO(null)}_gridUpdateResources(t,i){const r=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[t],n=!0),s.viewportWidth===t.width&&s.viewportHeight===t.height||(n=!0,s.viewportWidth=t.width,s.viewportHeight=t.height),s.coverageMipmap[0]=t,s.cellPixelSize!==i&&(s.cellPixelSize=i,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h={target:At.TEXTURE_2D,pixelFormat:Qe.RGB,dataType:kt.UNSIGNED_SHORT_5_6_5,samplingMode:gt.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},p={colorTarget:zs.TEXTURE,depthStencilTarget:Yi.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};s.coverageMipmap[l+1]=new ss(r,p,h)}}const o=Math.ceil(t.height/s.cellPixelSize),a=Math.ceil(t.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,p=1/a,f=6,m=4,g=new Float32Array(f*m*l*c);let y=0;for(let x=0;x<l;x++)for(let b=0;b<c;b++)g[y+0]=(b-.5)*p*2-1,g[y+1]=(x-.5)*h*2-1,g[y+2]=b*p,g[y+3]=x*h,g[y+4]=(b+.5)*p*2-1,g[y+5]=(x-.5)*h*2-1,g[y+6]=b*p,g[y+7]=x*h,g[y+8]=(b-.5)*p*2-1,g[y+9]=(x+.5)*h*2-1,g[y+10]=b*p,g[y+11]=x*h,g[y+12]=(b-.5)*p*2-1,g[y+13]=(x+.5)*h*2-1,g[y+14]=b*p,g[y+15]=x*h,g[y+16]=(b+.5)*p*2-1,g[y+17]=(x-.5)*h*2-1,g[y+18]=b*p,g[y+19]=x*h,g[y+20]=(b+.5)*p*2-1,g[y+21]=(x+.5)*h*2-1,g[y+22]=b*p,g[y+23]=x*h,y+=f*m;s.vao&&s.vao.dispose(!0),s.vao=new Ln(r,lr,{geometry:$L},{geometry:Ci.createVertex(r,Wi.STATIC_DRAW,g)})}}_gridComputeMipmap(t){const i=this._rctx,r=this._grid,s=i.bindTechnique(this._downsampleTechnique,this._passParameters,t);i.bindVAO(this.quadVAO);for(let n=0;n<r.mipmapLevels;n++){i.bindFramebuffer(r.coverageMipmap[n+1]);const o=r.coverageMipmap[n+1].width,a=r.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=r.coverageMipmap[n].colorTexture,Li(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,t),i.setViewport(0,0,o,a),i.drawArrays(Wt.TRIANGLE_STRIP,0,ka(this.quadVAO,"geometry"))}}get gpuMemoryUsage(){let t=(_(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(_(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const i of this._grid.coverageMipmap)t+=i.gpuMemoryUsage;return t}get test(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}const rAt={dataType:kt.UNSIGNED_BYTE,internalFormat:Qe.RGBA},sAt={};class nAt{constructor(t){this.rctx=t,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=t.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(t=>t.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(t=>t.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(t=>t.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(t=>t.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(t){const i=t.id;this._activeTargets.has(i)&&(this._activeTargets.delete(i),this._disposeWithFramebuffers(this._depthTextures,i),this._disposeWithFramebuffers(this._depthBuffers,i),this._disposeWithFramebuffers(this._colorTextures,i))}_disposeWithFramebuffers(t,i){const r=t.get(i);r&&(this._framebuffers.forEach((s,n)=>{s.colorAttachment!==r&&s.depthStencilAttachment!==r||(s.detachAll(),s.dispose(),this._framebuffers.delete(n))}),r.dispose(),t.delete(i))}getDepthTexture(t,i){if(!this.depthTextureSupported)return null;let r=this._depthTextures.get(t.id);return!r||r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=null),r||(r=new _t(this.rctx,{target:At.TEXTURE_2D,pixelFormat:Qe.DEPTH_STENCIL,dataType:kt.UNSIGNED_INT_24_8,samplingMode:gt.NEAREST,wrapMode:$t.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._depthTextures.set(t.id,r),this._activeTargets.add(t.id)),r}getAllocatedDepthTexture(t){return this._depthTextures.get(t.id)}getDepthBuffer(t,i){if(this.depthTextureSupported)return null;let r=this._depthBuffers.get(t.id);return r?r.descriptor.width===i.width&&r.descriptor.height===i.height||r.resize(i.width,i.height):(r=new hC(this.rctx,F({internalFormat:Ul.DEPTH_STENCIL},i)),this._depthBuffers.set(t.id,r),this._activeTargets.add(t.id)),r}getColorTexture(t,i){let r=this._colorTextures.get(t.id);return r&&(r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=null)),r||(r=new _t(this.rctx,{target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,internalFormat:t.internalFormat,dataType:t.dataType,samplingMode:t.samplingMode!=null?t.samplingMode:gt.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._colorTextures.set(t.id,r),this._activeTargets.add(t.id)),r}getAllocatedColorTexture(t){return this._colorTextures.get(t.id)}registerDepthTarget(t={}){return F(F({id:Dc()},sAt),t)}registerColorTarget(t={}){return F(F({id:Dc()},rAt),t)}getFramebuffer(t,i,r){const s=this._getKey(i,r);let n=this._framebuffers.get(s);const o=this.getColorTexture(i,t);if(this.depthTextureSupported){const l=r?this.getDepthTexture(r,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o||n.depthStencilTexture!==l)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilTexture(l)),n):(n=_(r)?new ss(this.rctx,{colorTarget:zs.TEXTURE,depthStencilTarget:Yi.DEPTH_STENCIL_TEXTURE},o,l):new ss(this.rctx,{colorTarget:zs.TEXTURE,depthStencilTarget:Yi.NONE},o),this._framebuffers.set(s,n),n)}const a=r?this.getDepthBuffer(r,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilBuffer(a)),n):(n=new ss(this.rctx,{colorTarget:zs.TEXTURE,depthStencilTarget:r?Yi.DEPTH_STENCIL_RENDER_BUFFER:Yi.NONE},o,a),this._framebuffers.set(s,n),n)}_getKey(t,i){return`${t.id}_${i?i.id:"X"}_${t.name}${i?"_"+i.name:""}`}get gpuMemoryUsage(){let t=0;const i=new Set,r=s=>{i.has(s)||(i.add(s),t+=SS(s))};return this._depthTextures.forEach(r),this._colorTextures.forEach(r),this._depthBuffers.forEach(r),t}}class oAt{constructor(t,i){this._rctx=t,this._compositingHelper=i,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._needLastFrameColorTexture=!1,this._background={type:"color",color:[0,0,0,1]};const r=t.type===Ii.WEBGL2;this._renderTargetHelper=new nAt(t);const s=this._renderTargetHelper;this.mainColorTargets=[s.registerColorTarget({name:"mainColorTarget0"}),s.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=s.registerColorTarget({name:"frontFaceTarget"});const n=o=>s.registerColorTarget({name:o,dataType:kt.FLOAT,internalFormat:r?Mt.RGBA32F:Qe.RGBA,samplingMode:gt.NEAREST});this.colorFloatTarget=n("colorFloatTarget"),this.alphaFloatTarget=n("alphaFloatTarget"),this.mainDepth=s.registerDepthTarget({name:"mainDepth"}),this.linearDepth=s.registerColorTarget({name:"linearDepth",samplingMode:gt.NEAREST}),this.terrainLinearDepth=s.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=s.registerColorTarget({name:"geometryLinearDepth"}),this.normal=s.registerColorTarget({name:"normal"}),this.highlight=s.registerColorTarget({name:"highlight",internalFormat:r?Mt.RGBA4:Qe.RGBA,dataType:kt.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=s.registerColorTarget({name:"hudVisibility",internalFormat:r?Mt.RGBA4:Qe.RGBA,dataType:kt.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=s.registerColorTarget({name:"tmpColor"}),this.tmpDepth=s.registerDepthTarget({name:"tmpDepth"}),this.hudColor=s.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(t){this._background=t}get background(){return this._background}get currentColorTarget(){return this.mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this.mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(t,i){return this._renderTargetHelper.getFramebuffer(this._dimensions,t,i)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}advanceCurrentRenderTarget(){this._mainColorTarget=this._mainColorTarget===0&&this._needLastFrameColorTexture?1:0}initializeFrame(t){const i=this._rctx;this._dimensions.width=t.fullWidth,this._dimensions.height=t.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),i.setClearStencil(0);const r=this._background.color;i.setClearColor(r[0]*r[3],r[1]*r[3],r[2]*r[3],r[3]),i.clearSafe(wr.COLOR_BUFFER_BIT|wr.DEPTH_BUFFER_BIT|wr.STENCIL_BUFFER_BIT)}composite(t){_(this.colorTexture)&&this._compositingHelper.composite(t,this.colorTexture,Na.None)}renderTmpAndCompositeToMain(t,i,r,s=!1){this.renderToTargets(t,this.tmpColor,s?this.tmpDepth:this.mainDepth,aAt),this._compositingHelper.composite(i,this._getColorTexture(this.tmpColor),r)}renderHUDVisibility(t,i=!1){this.renderToTargets(t,this.hudVisibility,i?this.tmpDepth:this.mainDepth,lAt)}compositeTransparentTerrainOntoHUDVisibility(t){this.renderToTargets(()=>this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),Na.None,1,Ru.TransparentToHUDVisibility),this.hudVisibility,this.tmpDepth)}renderOITPass(t,i,r){let s,n;switch(i){case Rt.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case Rt.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case Rt.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0]}r?this.renderToTargets(t,s,this.tmpDepth,n,!0,!0):this.renderToTargets(t,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(t){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),Na.PremultipliedAlpha)}compositeOccludedOntoMain(t,i){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),Na.PremultipliedAlpha,i)}compositeTransparentOntoOpaque(t,i){i?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(wr.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeTransparent(t,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(t){this.bindTarget(this.currentColorTarget),t(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(t){this._renderTargetHelper.disposeTargetResource(t)}set needLastFrameColorTexture(t){!t&&this._needLastFrameColorTexture&&(this._mainColorTarget=0,this.disposeTarget(this.mainColorTargets[1])),this._needLastFrameColorTexture=t}get needLastFrameColorTexture(){return this._needLastFrameColorTexture}renderToTargets(t,i,r,s,n=!1,o=!1){const a=this._rctx,l=this.bindTarget(i,r);let c=0;if(s){const p=Math.max(1e-13,s[3]);a.setClearColor(s[0],s[1],s[2],p),c|=wr.COLOR_BUFFER_BIT}return n&&(c|=wr.DEPTH_BUFFER_BIT),o===!1?o=0:(o===!0&&(o=255),c|=wr.STENCIL_BUFFER_BIT),c&&a.clearSafe(c,o),t(),a.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth),l}bindTarget(t,i){const r=this._renderTargetHelper.getFramebuffer(this._dimensions,t,i);return this._rctx.bindFramebuffer(r),r}_getColorTexture(t){return this._renderTargetHelper.getColorTexture(t,this._dimensions)}get gpuMemoryUsage(){let t=0;return this._renderTargetHelper&&(t+=this._renderTargetHelper.gpuMemoryUsage),t}}const aAt=[0,0,0,0],lAt=[0,1,0,1];class cAt{constructor(t){this.context=t,this._renderPlugins=new ai,this.slots=[];for(let i=0;i<$e.MAX_SLOTS;++i)this.slots[i]=[]}add(t,i,r){const s=()=>{if(r==null?void 0:r.aborted)throw i.uninitializeRenderContext(),mi();this._renderPlugins.push(i);for(const o of t)this.slots[o].push(i);this.context.requestRender()},n=i.initializeRenderContext(this.context,r);if(qu(n))return n.then(s);s()}remove(t){if(this._renderPlugins.removeUnordered(t)!=null){for(let i=0;i<this.slots.length;++i)this.slots[i]=this.slots[i].filter(r=>r!==t);t.uninitializeRenderContext(),this.context.requestRender()}}prepareRender(){this._renderPlugins.forAll(t=>{t.prepareRender&&t.prepareRender(this.context.renderContext)})}updateAnimation(t){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(t)||i)}),i}render(){const t=this.slots[this.context.renderContext.bindParameters.slot],i=new Array;t.filter(r=>{if(!r.canRender)return!1;if(uAt(r)){const s=r.prepareTechnique(this.context.renderContext);return!!s&&(i.push(s),!0)}return i.push(null),!0}).forEach((r,s)=>r.render(this.context.renderContext,i[s]))}queryDepthRange(t){const i=hAt;return i.near=1/0,i.far=-1/0,this._renderPlugins.forAll(r=>{if(r.queryDepthRange){const s=r.queryDepthRange(t);s&&BM(i,s,i)}}),i}get needsTransparentPass(){return this._renderPlugins.some(t=>t.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(t=>t.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(t=>t.needsLinearDepth)}get needsLaserlineWithContrastControl(){const t=this.slots[$e.LASERLINES_CONTRAST_CONTROL];return!!t&&t.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((t,i)=>t|i.renderOccludedFlags,0)}}function uAt(e){return"prepareTechnique"in e}const hAt={near:0,far:0};class b3e extends SRe{}const R8=255,dAt=1/R8;function pAt(){const e=new mr,t=e.fragment;return t.include(Zu),t.include(ad),e.include(J6),e.include(Kb),e.include(W6,{receiveShadows:!0}),t.uniforms.add([new oi("depthMap",i=>i.linearDepthTexture),new Xr("inverseViewMatrix",(i,r)=>Ks(oge,Zl(oge,r.camera.viewMatrix,r.camera.center))),new Di("nearFar",(i,r)=>r.camera.nearFar)]),t.constants.add("sampleValue","float",dAt),t.code.add(E`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),e}const oge=Ne(),fAt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:b3e,shadowCastMaxSamples:R8,build:pAt},Symbol.toStringTag,{value:"Module"}));var VS;(function(e){e[e.Gradient=0]="Gradient",e[e.Threshold=1]="Threshold",e[e.COUNT=2]="COUNT"})(VS||(VS={}));class GJ extends Xl{constructor(){super(...arguments),this.visualization=VS.Gradient,this.bandsEnabled=!1}}u([Q({count:VS.COUNT})],GJ.prototype,"visualization",void 0),u([Q()],GJ.prototype,"bandsEnabled",void 0);function mAt(e){const t=new mr,i=t.fragment;i.include(Zu),i.include(ad),t.include(J6),t.include(Kb);const{visualization:r,bandsEnabled:s}=e;i.constants.add("inverseSampleValue","float",R8),i.uniforms.add([new oi("shadowCastMap",a=>a.shadowCastMap),new lt("sampleScale",a=>a.sampleScale),new lt("opacityFromElevation",a=>a.opacityFromElevation),new Ei("uColor",a=>a.color)]);const n=r===VS.Gradient,o=r===VS.Threshold;return n&&s?i.uniforms.add(new lt("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new lt("threshold",a=>a.threshold)),i.code.add(E`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?E`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?E`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?E`* strength`:""});
      }
    `),t}const gAt=Object.freeze(Object.defineProperty({__proto__:null,build:mAt},Symbol.toStringTag,{value:"Module"}));class P8 extends Lr{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=P8.shader.get().build(this.configuration);return new Er(t.rctx,i,lr)}initializePipeline(){return ri({blending:ed,colorWrite:xi,depthTest:null,depthWrite:null})}get primitiveType(){return Wt.TRIANGLE_STRIP}}P8.shader=new Sr(gAt,()=>import("./ShadowCastVisualize.glsl.8c8ab7a0.js"));const yAt=zi(.01,0,.25,1),vAt=4e4,_At=5e4,w3e=1/512;let Lk=class extends Ee{constructor(e,t,i,r){super({}),this._techniqueRepository=e,this._rctx=t,this._shadowAccumulator=i,this._requestRender=r,this._passParameters={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:yAt,threshold:.5,bandSize:.1,opacityFromElevation:1,__tagStrict:"NoParameters"},this._techniqueConfig=new GJ,this._enabled=!1,this._vao=Yl(t),this._techniqueConfig.visualization=VS.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=ht(this._vao),this._techniqueRepository.release(this._technique),this._technique=null,this._shadowAccumulator=null}get visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(P8,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._isRenderingVisualization)return;this._passParameters.sampleScale=1/this._computedSamples;const t=this.visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,this._passParameters,e),this._rctx.drawArrays(t.primitiveType,0,ka(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _isRenderingVisualization(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>w3e}get _computedSamples(){return this._shadowAccumulator.computedSamples}get _shadowCastTexture(){return this._shadowAccumulator.shadowCastTexture}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._passParameters.color;S3(e,t)||(Lf(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([d()],Lk.prototype,"opacityFromElevation",null),Lk=u([L("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],Lk);class I8 extends Lr{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=I8.shader.get().build();return new Er(t.rctx,i,lr)}initializePipeline(){return ri({blending:ba(ke.ONE,ke.ONE,ke.ONE,ke.ONE),colorWrite:xi,depthTest:null,depthWrite:null})}get primitiveType(){return Wt.TRIANGLE_STRIP}}I8.shader=new Sr(fAt,()=>import("./ShadowCastAccumulate.glsl.9cf6eba2.js"));var vI;let el=vI=class extends Ee{constructor(e,t,i,r,s,n){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=r,this._renderToShadowMap=s,this._requestRender=n,this._progress=0,this._sampleCount=0,this._passParameters=new b3e,this._enabled=!1,this._cachedLightDirections=[],this._depthRange=$J,this._previewing=!1,this._handles=new Nt,this._cameraForcedForScreenshot=!1,this._bindParameters=new m6(new _re(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._bindParameters.camera=new xr,this._vao=Yl(e);const o={colorTarget:zs.TEXTURE,depthStencilTarget:Yi.NONE,width:0,height:0},a={target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:gt.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new ss(e,o,a),this._accumulationRenderer=new Lk(t,e,this,n);const l=this._stage.resourceController.scheduler;this._handles.add(l.registerTask(Ot.SHADOW_ACCUMULATOR,this)),this._handles.add(re(()=>i.renderView,c=>{this._handles.remove(vI.renderViewHandleKey),M(c)||this._handles.add(c.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),vI.renderViewHandleKey)},fi))}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get accumulationTechnique(){if(M(this._accumulationTechnique)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechnique=new I8(e,new Xl)}return this._accumulationTechnique}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabled&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==$J&&this._opacityFromElevation>w3e}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const t=this._cachedLightDirections;if(wb(t,e,sS))return;const i=e.length;t.length=i,this._sampleCount=Math.min(R8,i);for(let r=0;r<i;++r){const s=e[r],n=t[r]||$();pe(n,s),t[r]=n}this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,i,r){if(this._passParameters.linearDepthTexture=e,this._depthRange=t,this._updateCamera(i),this._bindParameters.contentCamera=r,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(vI.previewSamples,this._sampleCount-this._progress);for(let n=0;n<s;++n)this._accumulateShadow();this._cameraForcedForScreenshot=!1}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=ht(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=ht(this._fbo),this._vao=ht(this._vao),this._accumulationTechnique=br(this._accumulationTechnique),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.previewing!==void 0&&(this.previewing=e.previewing),e.lightDirections!==void 0&&(this.lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}set previewing(e){this._previewing!==e&&(this._previewing=e,this._requestRenderIfEnabled())}set lightDirections(e){this._lightDirections=e}readAccumulatedShadow(e,t){if(!this._isActive||this._progress<1||e<0||e>this._fbo.width||t<0||t>this._fbo.height)return 0;const i=bAt;return this._fbo.readPixels(e,t,1,1,Qe.RGBA,kt.UNSIGNED_BYTE,i),i[0]/this._progress}_start(){this._progress=0,this._enabled=!0}_stop(){this._enabled=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(wr.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){const e=this._lightDirections[this._progress];this._renderToShadowMap(this._bindParameters,e,this._depthRange),this._passParameters.origin=this._bindParameters.camera.center,this._rctx.bindFramebuffer(this._fbo);const t=this.accumulationTechnique;this._rctx.bindTechnique(t,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(t.primitiveType,0,ka(this._vao,"geometry")),this._progress++}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-UA(vAt,_At,e.relativeElevation))}set enabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};el.previewSamples=6,el.renderViewHandleKey="renderView",u([d()],el.prototype,"_progress",void 0),u([d()],el.prototype,"_sampleCount",void 0),u([d()],el.prototype,"_enabled",void 0),u([d()],el.prototype,"_depthRange",void 0),u([d()],el.prototype,"_previewing",void 0),u([d()],el.prototype,"_accumulationRenderer",void 0),u([d()],el.prototype,"_isRefining",null),u([d()],el.prototype,"_isActive",null),u([d()],el.prototype,"canAccumulate",null),u([d()],el.prototype,"_isDoneAccumulating",null),u([d()],el.prototype,"_opacityFromElevation",null),u([d()],el.prototype,"running",null),el=vI=u([L("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],el);const bAt=new Uint8Array(4),age={highlightedThreshold:.99999,selfShadowThreshold:.025};function wAt(){const e=new mr;e.include(NS,{receiveShadows:!0});const t=e.fragment;return t.include(Zu),t.include(ad),e.include(J6),e.include(Kb),t.uniforms.add([new oi("defaultDepthTex",(i,r)=>r.shadowMap.getSnapshot(NM.Default)),new oi("highlightDepthTex",(i,r)=>r.shadowMap.getSnapshot(NM.Highlight)),new oi("depthMap",(i,r)=>r.linearDepthTexture),new oi("highlightMap",(i,r)=>r.highlightColorTexture),new Ei("uColor",i=>i.shadowColor),new Di("nearFar",(i,r)=>r.camera.nearFar),new lt("opacity",i=>i.shadowOpacity),new lt("occludedOpacity",i=>i.occludedShadowOpacity),new lt("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new Dt("lightingMainDirectionView",(i,r)=>Re(cge,Xe(cge,r.lighting.lightingMainDirection,r.camera.viewInverseTransposeMatrix))),new Di("texelSize",(i,r)=>_(r.linearDepthTexture)?Li(xAt,1/r.linearDepthTexture.descriptor.width,1/r.linearDepthTexture.descriptor.height):Sp),new Xr("inverseViewMatrix",(i,r)=>Ks(lge,Zl(lge,r.camera.viewMatrix,r.camera.center)))]),t.constants.add("unoccludedHighlightFlag","vec4",vOe).add("highlightedThreshold","float",age.highlightedThreshold).add("selfShadowThreshold","float",age.selfShadowThreshold),t.code.add(E`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),t.code.add(E`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const lge=Ne(),cge=$(),xAt=Ke(),TAt=Object.freeze(Object.defineProperty({__proto__:null,build:wAt},Symbol.toStringTag,{value:"Module"}));class SAt extends Nn{constructor(){super(...arguments),this.shadowColor=zi(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}}class $8 extends Lr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=$8.shader.get().build();return new Er(t.rctx,i,lr)}initializePipeline(){return ri({blending:ba(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),colorWrite:xi,depthTest:null,depthWrite:null})}get primitiveType(){return Wt.TRIANGLE_STRIP}}$8.shader=new Sr(TAt,()=>import("./ShadowHighlight.glsl.82e0e0e1.js"));const EAt=.001953125,CAt=4e4,AAt=5e4;class MAt{constructor(t,i){this._rctx=t,this._viewingMode=i,this._maxOpacity=1,this._passParameters=new SAt,this._drawParameters=new SRe,this._vao=Yl(this._rctx)}get technique(){return M(this._technique)&&(this._technique=new $8({rctx:this._rctx,viewingMode:this._viewingMode})),this._technique}render(t,i){if(!t.shadowMap.enabled||!t.linearDepthTexture||!this.isVisible)return;const r=this.technique;this._drawParameters.origin=t.camera.center,this._rctx.bindFramebuffer(i),this._rctx.bindTechnique(r,this._passParameters,t).bindDraw(this._drawParameters,t),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(r.primitiveType,0,ka(this._vao,"geometry"))}get gpuMemoryUsage(){var t,i;return(i=(t=this._vao)==null?void 0:t.size)!=null?i:0}setDefaultOptions(t){this._passParameters=F(F({},this._passParameters),t),this._updateMaxOpacity()}updateParameters(t,i){this._passParameters.opacityElevation=1-UA(CAt,AAt,t.relativeElevation);const r=this._viewingMode===tt.Global?Re(uge,t.center):he(uge,0,0,1),s=Pe(r,i);this._passParameters.dayNightTerminator=UA(0,1,He(30*s,0,1))}dispose(){this._vao=ht(this._vao),this._technique=br(this._technique)}get isVisible(){const{opacityElevation:t,dayNightTerminator:i}=this._passParameters;return this._maxOpacity*t*i>=EAt}_updateMaxOpacity(){const t=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=t*this._passParameters.shadowColor[3]}}const uge=$(),hge=Jb();class OAt{constructor(){this._plane=Jb()}get isEnabled(){return!Gwe(this.plane,hge)}get plane(){return this._plane}set plane(t){i2(t||hge,this._plane)}}var zg;(function(e){e[e.EdgeDetector=0]="EdgeDetector",e[e.BlendWeight=1]="BlendWeight",e[e.Blur=2]="Blur",e[e.COUNT=3]="COUNT"})(zg||(zg={}));class x3e extends Xl{constructor(){super(...arguments),this.output=zg.EdgeDetector}}u([Q({count:zg.COUNT})],x3e.prototype,"output",void 0);const P_={threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16};function RAt(e){const t=new mr;return e.output===zg.EdgeDetector&&(t.attributes.add(P.POSITION,"vec2"),t.vertex.uniforms.add(new Gl("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.vertex.code.add(E`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),t.fragment.uniforms.add(new ws("tColor")),t.fragment.code.add(E`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${E.float(P_.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${E.float(P_.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `)),e.output===zg.BlendWeight&&(t.attributes.add(P.POSITION,"vec2"),t.vertex.uniforms.add(new Gl("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.varyings.add("fPixCoord","vec2"),t.vertex.code.add(E`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${E.int(P_.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),t.fragment.uniforms.add(new ws("tEdges")),t.fragment.uniforms.add(new ws("tArea")),t.fragment.uniforms.add(new ws("tSearch")),t.fragment.uniforms.add(new ws("tColor")),t.fragment.uniforms.add(new Gl("resolution")),t.fragment.code.add(E`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${E.int(P_.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${E.int(P_.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${E.int(P_.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${E.int(P_.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${E.int(P_.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `)),e.output===zg.Blur&&(t.attributes.add(P.POSITION,"vec2"),t.vertex.uniforms.add(new Gl("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[2]","vec4"),t.vertex.code.add(E`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),t.fragment.uniforms.add(new ws("tBlendWeights")),t.fragment.uniforms.add(new ws("tColor")),t.fragment.uniforms.add(new Gl("resolution")),t.fragment.code.add(E`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`)),t}const PAt=Object.freeze(Object.defineProperty({__proto__:null,build:RAt},Symbol.toStringTag,{value:"Module"}));class L8 extends Lr{initializeProgram(t){const i=L8.shader.get().build(this.configuration);return new Er(t.rctx,i,lr)}initializePipeline(){return ri({colorWrite:xi})}}L8.shader=new Sr(PAt,()=>import("./SMAA.glsl.53a7bd3b.js"));let _I=class extends Ee{constructor(e,t){super({}),this.rctx=e,this._techniqueRep=t,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=Wn(this._abortController),this.disable()}_loadResources(e){if(_(this._abortController))return!1;if(_(this._searchTexture))return!0;this._abortController=new AbortController;const t=this._abortController.signal;return import("./SmaaRenderPassData.e07ab82b.js").then(i=>this._loadTextures(i,t)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,t){return qt(t),Promise.all([this._loadTextureFromBase64(e.areaTexture,gt.LINEAR,Qe.RGB),this._loadTextureFromBase64(e.searchTexure,gt.NEAREST,Qe.LUMINANCE)]).then(([i,r])=>{an(t)?(i.dispose(),r.dispose(),qt(t)):(this._areaTexture=i,this._searchTexture=r)})}get updating(){return _(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const t=new x3e,i=(r,s)=>this._techniqueRep.releaseAndAcquire(L8,r,s);t.output=zg.EdgeDetector,this._edgeDetectTechnique=i(t,this._edgeDetectTechnique),t.output=zg.BlendWeight,this._blendWeightsTechnique=i(t,this._blendWeightsTechnique),t.output=zg.Blur,this._blurTechnique=i(t,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=int(this.rctx),this._edges=new ss(this.rctx,{colorTarget:zs.TEXTURE,depthStencilTarget:Yi.NONE},{target:At.TEXTURE_2D,pixelFormat:Qe.RGB,dataType:kt.UNSIGNED_BYTE,samplingMode:gt.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:4,height:4}),this._blend=new ss(this.rctx,{colorTarget:zs.TEXTURE,depthStencilTarget:Yi.NONE},{target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:gt.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=ht(this._vao),this._areaTexture=ht(this._areaTexture),this._searchTexture=ht(this._searchTexture),this._blend=ht(this._blend),this._edges=ht(this._edges),this._isEnabled=!1)}render(e){if(!this._isEnabled)return;const t=this.rctx,i=t.getBoundFramebufferObject(),r={x:0,y:0,width:e.descriptor.width,height:e.descriptor.height};t.bindVAO(this._vao),t.setViewport(r.x,r.y,r.width,r.height),this._edges.resize(r.width,r.height),t.bindFramebuffer(this._edges),t.setClearColor(0,0,0,1),t.clear(wr.COLOR_BUFFER_BIT);const s=t.bindTechnique(this._edgeDetectTechnique);s.bindTexture("tColor",e),s.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),t.drawArrays(Wt.TRIANGLES,0,3),this._blend.resize(r.width,r.height),t.bindFramebuffer(this._blend),t.setClearColor(0,0,1,1),t.clear(wr.COLOR_BUFFER_BIT);const n=t.bindTechnique(this._blendWeightsTechnique);n.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),n.bindTexture("tSearch",this._searchTexture),n.bindTexture("tArea",this._areaTexture),n.bindTexture("tEdges",this._edges.colorTexture),t.drawArrays(Wt.TRIANGLES,0,3),t.bindFramebuffer(i),t.setClearColor(0,1,0,1),t.clear(wr.COLOR_BUFFER_BIT);const o=t.bindTechnique(this._blurTechnique);o.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),o.bindTexture("tColor",e),o.bindTexture("tBlendWeights",this._blend.colorTexture),t.drawArrays(Wt.TRIANGLES,0,3)}_loadTextureFromBase64(e,t,i){return lm(e).then(r=>new _t(this.rctx,{pixelFormat:i,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,width:r.width,height:r.height,samplingMode:t},r))}};u([d()],_I.prototype,"_abortController",void 0),u([d({readOnly:!0})],_I.prototype,"updating",null),_I=u([L("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],_I);function IAt(e,t){const i=t,r=-e[0],s=-e[1],n=-e[2],o=i[3],a=i[7],l=i[11],c=i[15];i[0]+=o*r,i[1]+=o*s,i[2]+=o*n,i[4]+=a*r,i[5]+=a*s,i[6]+=a*n,i[8]+=l*r,i[9]+=l*s,i[10]+=l*n,i[12]+=c*r,i[13]+=c*s,i[14]+=c*n}function $At(e,t){const i=t,r=e[0],s=e[1],n=e[2];i[12]+=r*i[0]+s*i[4]+n*i[8],i[13]+=r*i[1]+s*i[5]+n*i[9],i[14]+=r*i[2]+s*i[6]+n*i[10],i[14]+=r*i[3]+s*i[7]+n*i[11]}class LAt{constructor(t){this.factory=t,this.originData=new Map}acquire(t){return this.register(this.factory.getOrigin(t))}register(t){const i=this.originData.get(t.id);return i?(i.refCount++,i.origin):(this.originData.set(t.id,{refCount:1,viewMatrix:Ne(),origin:t}),t)}release(t){const i=this.originData.get(t.id);i&&(i.refCount--,i.refCount===0&&this.originData.delete(t.id))}updateViewMatrices(t){this.originData.forEach(i=>{ln(i.viewMatrix,t),$At(i.origin.vec3,i.viewMatrix)})}getViewMatrix(t){return this.originData.get(t.id).viewMatrix}}class DAt extends _Re{constructor(t,i,r){super(),this.distanceFalloffFactor=t,this.minimumEdgeLength=i,this.transparency=r,this.transformNormalViewFromGlobal=ls()}}class NAt extends bRe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=ls(),this.slicePlaneLocalOrigin=$(),this.transformNormalGlobalFromModel=ls()}}function FAt(e){const t=E`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;e.code.add(t)}const kAt=er(.5,-4e-4);function UAt(e,t){const i=e.vertex;i.include(FAt),i.constants.add("depthBias","vec2",kAt),i.uniforms.add(new Di("inverseViewport",(r,s)=>s.inverseViewport)),t.legacy?(i.uniforms.add(new Ib("localView")),i.uniforms.add(new Xr("proj",(r,s)=>s.camera.projectionMatrix)),i.code.add(E`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(i.uniforms.add(new BL("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),i.uniforms.add(new Xr("transformProjFromView",r=>r.transformProjFromView)),i.code.add(E`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),i.code.add(E`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function zAt(e,t){const i=e.fragment;i.constants.add("coverageTestThreshold","float",.01),t.antialiasing?i.code.add(E`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):i.code.add(E`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function VAt(e,t){const i=e.vertex;t.silhouette?(i.code.add(E`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),t.legacy?i.code.add(E`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):i.code.add(E`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):i.code.add(E`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function BAt(e,t){const i=e.vertex;i.include(Zu),i.uniforms.add(new lt("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(E`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(new ws("componentDataTex")),i.uniforms.add(new tv("componentDataTexInvDim")),e.attributes.add(P.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("componentTexWidth","float",4096),i.constants.add("verticalOffsetScale","float",2*sse),i.code.add(E`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * componentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texture2D(componentDataTex, colorIndex);
vec4 otherValue = texture2D(componentDataTex, otherIndex);
float verticalOffset = (rgba2float(texture2D(componentDataTex, verticalOffsetIndex)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),t.legacy?i.code.add(E`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new u$("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(E`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),t.silhouette?(e.attributes.add(P.NORMALA,"vec3"),e.attributes.add(P.NORMALB,"vec3"),i.code.add(E`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(e.attributes.add(P.NORMAL,"vec3"),i.code.add(E`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),t.legacy?i.code.add(E`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(Kz,t),i.include(Kz,t),i.uniforms.add([new BL("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new u$("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new ql("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new ql("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Dt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Dt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)]),i.code.add(E`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${t.spherical?E`normalize(transformWorldFromModelTL + rotatedModelPosition);`:E`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new Xr("transformProjFromView",(r,s)=>s.camera.projectionMatrix)),i.code.add(E`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(E`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function T3e(e){return e.mode===On.SKETCH||e.mode===On.MIXED}var On;(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH",e[e.MIXED=2]="MIXED",e[e.COUNT=3]="COUNT"})(On||(On={}));function GAt(e,t){const i=e.vertex;switch(t.mode){case On.SKETCH:i.code.add(E`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case On.MIXED:i.code.add(E`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case On.SOLID:i.code.add(E`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}}function use(e,t){const i=e.vertex;switch(e.attributes.add(P.SIDENESS,"vec2"),t.mode===On.MIXED?i.code.add(E`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):i.code.add(E`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),t.mode){case On.MIXED:i.code.add(E`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case On.SKETCH:i.code.add(E`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case On.SOLID:i.code.add(E`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case On.COUNT:break;default:t.mode}}function jAt(e,t){const i=e.vertex;switch(e.include(use,t),T3e(t)&&i.uniforms.add(new nr("strokesAmplitude")),t.mode){case On.SOLID:i.code.add(E`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case On.SKETCH:i.code.add(E`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case On.MIXED:i.code.add(E`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function HAt(e,t){const i=e.vertex;e.include(use,t);const r=e.fragment;switch(T3e(t)&&(i.uniforms.add(new tv("strokesTextureScale")),i.uniforms.add(new nr("strokesLog2Resolution")),i.uniforms.add(new nr("strokeVariants")),e.varyings.add("vStrokeUV","vec2"),r.uniforms.add(new ws("strokesTexture")),r.uniforms.add(new nr("strokesNormalizationScale")),i.code.add(E`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * strokesTextureScale;
vStrokeUV.x += variantOffset;
}`),e.fragment.include(Zu),r.code.add(E`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),t.mode){case On.SOLID:i.code.add(E`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),r.code.add(E`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case On.SKETCH:i.code.add(E`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),r.code.add(E`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case On.MIXED:e.varyings.add("vType","float"),i.code.add(E`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),r.code.add(E`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function qAt(e){const t=new mr,i=t.vertex,r=t.fragment;return e.legacy&&i.uniforms.add(new Ib("model")),e.antialiasing&&(i.code.add(E`#define ANTIALIASING 1`),r.code.add(E`#define ANTIALIASING 1`)),t.include(UAt,e),t.include(BAt,e),t.include(jAt,e),t.include(use,e),t.include(HAt,e),t.include(Qs,e),t.include(VAt,e),t.include(zAt,e),t.include(GAt,e),t.include(ld,e),t.varyings.add("vColor","vec4"),t.varyings.add("vRadius","float"),t.varyings.add("vPosition","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewPos","vec3"),t.varyings.add("vLineLengthPixels","float"),t.varyings.add("vSizeFalloffFactor","float"),i.uniforms.add(new Di("pixelToNDC",(s,n)=>Li(WAt,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3]))),i.uniforms.add(new Ei("viewport",(s,n)=>n.camera.fullViewport)),i.uniforms.add(new lt("pixelRatio",(s,n)=>n.camera.pixelRatio)),t.attributes.add(P.POSITION0,"vec3"),t.attributes.add(P.POSITION1,"vec3"),t.attributes.add(P.VARIANTOFFSET,"float"),t.attributes.add(P.VARIANTSTROKE,"float"),t.attributes.add(P.VARIANTEXTENSION,"float"),i.code.add(E`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 ndcToPixel = viewport.zw * 0.5;
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`),t.fragment.code.add(E`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `),t}const WAt=Ke(),ZAt=Object.freeze(Object.defineProperty({__proto__:null,build:qAt},Symbol.toStringTag,{value:"Module"}));class D8 extends Lr{initializeProgram(t){const i=D8.shader.get().build(this.configuration);return new Er(t.rctx,i,NJ)}initializePipeline(t){return t.blendMinMax?ri({blending:ba(ke.ONE,ke.ONE,ke.ZERO,ke.ONE,xv.ADD,t.blendMinMax.MAX),depthTest:{func:Fr.LEQUAL},colorWrite:xi}):ri({depthTest:{func:Fr.LEQUAL},depthWrite:jc,colorWrite:xi})}}D8.shader=new Sr(ZAt,()=>import("./EdgeShader.glsl.e2aa5643.js"));class rg extends al{constructor(){super(...arguments),this.mode=On.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}}u([Q({count:On.COUNT})],rg.prototype,"mode",void 0),u([Q()],rg.prototype,"hasSlicePlane",void 0),u([Q()],rg.prototype,"silhouette",void 0),u([Q()],rg.prototype,"legacy",void 0),u([Q()],rg.prototype,"antialiasing",void 0),u([Q()],rg.prototype,"doublePrecisionRequiresObfuscation",void 0),u([Q()],rg.prototype,"hasMultipassTerrain",void 0),u([Q()],rg.prototype,"cullAboveGround",void 0),u([Q()],rg.prototype,"spherical",void 0);const XAt=8,hH=128,YAt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0};class JAt{constructor(){this._value=0}get value(){return this._value}increment(){this._value++}decrement(){this._value--}}const QAt={solid:On.SOLID,sketch:On.SKETCH,uber:On.MIXED};class g3{constructor(t,i,r){this.rctx=t,this.shaderTechniqueRepository=i,this._configuration=new rg,this.refCount=new JAt,this.renderables=new Set,this.sortedRenderables={[Xt.TRANSPARENT]:{[Xt.TRANSPARENT]:new ai,[Xt.OPAQUE]:new ai},[Xt.OPAQUE]:{[Xt.TRANSPARENT]:new ai,[Xt.OPAQUE]:new ai}},this._renderablesDirty=!1,this._drawParameters=new NAt,this._settings=F(F({},YAt),r),this.key=g3.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:dr.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=QAt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this.rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=XL(t),this._configuration.spherical=r.spherical}dispose(){this._technique=br(this._technique)}addRenderable(t){this.renderables.add(t),this._renderablesDirty=!0}removeRenderable(t){this.renderables.delete(t),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(t,i){this._renderablesDirty&&this._sortRenderables(),this.sortedRenderables[i][Xt.TRANSPARENT].forAll(t),this.sortedRenderables[i][Xt.OPAQUE].forAll(t)}updateTechnique(t,i){return this._configuration.hasMultipassTerrain=!!t.multipassTerrain.enabled,this._configuration.cullAboveGround=!!t.multipassTerrain.cullAboveGround,this._configuration.silhouette=i,this._technique=this.shaderTechniqueRepository.releaseAndAcquire(D8,this._configuration,this._technique),this._technique}bindRegularEdges(t,i){return this.rctx.bindTechnique(this.updateTechnique(i,!1),t,i)}bindSilhouetteEdges(t,i){return this.rctx.bindTechnique(this.updateTechnique(i,!0),t,i)}renderRegularEdges(t,i,r,s,n){this._render(t,i,i.regular.vao,r,s,n)}renderSilhouetteEdges(t,i,r,s,n){this._render(t,i,i.silhouette.vao,r,s,n)}_render(t,i,r,s,n,o){this._bindDraw(t,i,s,o),this.rctx.bindVAO(r),this.rctx.capabilities.instancing.drawArraysInstanced(Wt.TRIANGLE_FAN,0,4,n)}_bindDraw(t,i,r,s){if(i.components.buffer.textureBuffer.bind(t,KAt,eMt),"origin"in i.transform)t.setUniformMatrix4fv("localView",s),t.setUniformMatrix4fv("model",i.transform.modelMatrix),pe(this._drawParameters.slicePlaneLocalOrigin,i.transform.origin.vec3);else{const n=new C8(i.transform.position),o=Ap(dge,l2(dge,i.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=i.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=r.camera.viewInverseTransposeMatrix;he(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}t.bindDraw(this._drawParameters,r),this._settings.type!=="uber"&&this._settings.type!=="sketch"||this._setSketchUniforms(t)}_setSketchUniforms(t){const i=this._settings.strokesTexture,r=i.texture;M(r)||(t.bindTexture("strokesTexture",r),t.setUniform2f("strokesTextureScale",1/r.descriptor.width,1/r.descriptor.height),t.setUniform1f("strokesLog2Resolution",Math.log2(i.resolution)),t.setUniform1f("strokesNormalizationScale",i.normalizationScale),t.setUniform1f("strokesAmplitude",i.amplitude),t.setUniform1f("strokeVariants",i.variants))}_sortRenderables(){this._renderablesDirty=!1,this.sortedRenderables[Xt.TRANSPARENT][Xt.TRANSPARENT].clear(),this.sortedRenderables[Xt.TRANSPARENT][Xt.OPAQUE].clear(),this.sortedRenderables[Xt.OPAQUE][Xt.TRANSPARENT].clear(),this.sortedRenderables[Xt.OPAQUE][Xt.OPAQUE].clear(),this.renderables.forEach(i=>{i.objectTransparency!==Xt.INVISIBLE&&i.edgeTransparency!==Xt.INVISIBLE&&this.sortedRenderables[i.objectTransparency][i.edgeTransparency].push(i)});const t=(i,r)=>"origin"in i.transform&&"origin"in r.transform?i.transform.origin.id<r.transform.origin.id?-1:i.transform.origin.id>r.transform.origin.id?1:0:0;this.sortedRenderables[Xt.TRANSPARENT][Xt.TRANSPARENT].sort(t),this.sortedRenderables[Xt.TRANSPARENT][Xt.OPAQUE].sort(t),this.sortedRenderables[Xt.OPAQUE][Xt.TRANSPARENT].sort(t),this.sortedRenderables[Xt.OPAQUE][Xt.OPAQUE].sort(t)}static getKey(t,i,r){return`edges-t:${t}:${i}:${r}`}}const KAt="componentDataTex",eMt="componentDataTexInvDim",dge=nv();class tMt extends sIe{constructor(t){super("EdgeProcessingWorker","extract",{extract:i=>[i.dataBuffer],extractComponentsEdgeLocations:i=>[i.dataBuffer],extractEdgeLocations:i=>[i.dataBuffer]},t)}async process(t,i,r){if(r)return lse(t);const s=this._packInput(t),n=await this.invoke(s,i);return this._unpackOutput(n)}async extractEdgeLocations(t,i){const r=this._packInput(t),s=await this.invokeMethod("extractEdgeLocations",r,i);return u4(s)}async extractComponentsEdgeLocations(t,i){const r=this._packInput(t),s=await this.invokeMethod("extractComponentsEdgeLocations",r,i);return u4(s)}_packInput(t){return{dataBuffer:t.data.buffer,writerSettings:t.writerSettings,skipDeduplicate:t.skipDeduplicate,indicesBuffer:t.indices.buffer,indicesType:Jk(t.indices)?"Uint32Array":"Uint16Array",indicesLength:t.indicesLength}}_unpackOutput(t){return{regular:{instancesData:u4(t.regular.instancesData),lodInfo:{lengths:new Float32Array(t.regular.lodInfo.lengths)}},silhouette:{instancesData:u4(t.silhouette.instancesData),lodInfo:{lengths:new Float32Array(t.silhouette.lodInfo.lengths)}},averageEdgeLength:t.averageEdgeLength}}}function iMt(e){const i=WR.resolution,r=i/2,s=new Uint8Array(4*i*i),n=4*i*r,o=WR.amplitude,a=2*o,l=4*i,c=Math.log2(i)+1,h=WR.strokes.length;let p=(c-1)*h*l;for(const{distance:m,pressure:g}of WR.strokes){let y=m,x=g,b=p;for(let S=0;S<c;S++){S!==0&&(y=pge(y,J$.DISTANCE),x=pge(x,J$.PRESSURE));for(let T=0;T<WR.resolution;T++){const C=.5+(y?y[T%y.length]/a:0),A=x?x[T%x.length]:1;R$(C,s,b),R$(A,s,b+n),b+=4}b-=l*(h+1)}p+=l}const f=new _t(e,{pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:gt.LINEAR,width:i,height:i,wrapMode:$t.REPEAT},s);return new sMt(i,a,o,h,f)}function pge(e,t){if(!e)return null;const i=e.length/2,r=rMt*i,s=new Array(i);let n=0;const o=t===J$.PRESSURE;for(let a=0;a<e.length;a+=2){const l=(e[a]+e[a+1])/2;s[n++]=o?Math.min(r,1-(1-l)*fge):Math.min(r,l*fge)}return s}var J$;(function(e){e[e.DISTANCE=0]="DISTANCE",e[e.PRESSURE=1]="PRESSURE"})(J$||(J$={}));const rMt=.1,fge=.5;class sMt{constructor(t,i,r,s,n){this.resolution=t,this.normalizationScale=i,this.amplitude=r,this.variants=s,this.texture=n}dispose(){this.texture=ht(this.texture)}}const WR={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function mge(e){let t=null;for(const i of e){const r=i.type;if(nMt(i)){if(M(t))t=r;else if(t!==r)return"uber"}}return _(t)?t:"uber"}function dH(e){let t=Xt.INVISIBLE;for(const{material:i}of e)if(S3e(i)){if(i.color[3]*i.opacity<1)return Xt.TRANSPARENT;t=Xt.OPAQUE}return t}function pH(e){let t=Xt.INVISIBLE;for(const{material:i}of e)if(S3e(i)){switch(i.objectTransparency){case Xt.TRANSPARENT:case Xt.INVISIBLE:return Xt.TRANSPARENT;case Xt.OPAQUE:if(i.opacity<1)return Xt.TRANSPARENT}t=Xt.OPAQUE}return t}function S3e(e){return e.size*e.color[3]*e.opacity>0}function nMt(e){return e.size*e.color[3]>0}function oMt(e,t){const i=j0e(e,t,!0);return i===-1?t<e[0]?0:e.length:i}function gge(e,t,i){return e.length-oMt(e,t*i.minimumEdgeLength)}function yge(e,t,i,r){for(let s=0;s<e.length;s++){const n=e[s].index,o=t[s],a=t[s+1];if(r)for(let l=o;l<a;l++){const c=r[l];i.set(c,n)}else for(let l=o;l<a;l++)i.set(l,n)}}const aMt=ve.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");let df=class extends Ee{constructor(e){super(e),this.updatingHandles=new Lg,this.perObjectData=new Map,this.perObjectDataEvictionCache=new Set,this.renderers=new Map,this.numberOfRenderedEdges={[Xt.TRANSPARENT]:0,[Xt.OPAQUE]:0},this.gpuMemoryUsage=0,this.workerAbort=new AbortController,this.tmpModelPosition=$(),this.localOrigins=new LAt(new vre(e.renderSR))}initialize(){this.worker=new tMt(this.schedule),this.componentColorManager=new m3e(this.rctx,3);const e=a3e.createBuffer(4);for(let t=0;t<4;t++)e.sideness.set(t,0,t===0||t===3?0:1),e.sideness.set(t,1,t===0||t===1?0:1);this.verticesBufferObject=Ci.createVertex(this.rctx,Wi.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this.perObjectData.forEach(e=>this._discardObjectEntry(e)),this.perObjectData.clear(),this.strokesTexture=ht(this.strokesTexture),this.componentColorManager=We(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=ht(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())}get updating(){return this.updatingHandles.updating}get usedMemory(){return this.gpuMemoryUsage}get numberOfRenderedPrimitives(){return this.numberOfRenderedEdges[Xt.TRANSPARENT]+this.numberOfRenderedEdges[Xt.OPAQUE]}shouldRender(){return this.renderers.size>0}async addComponentObject(e,t,i,r,s,n,o,a){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let l;const c=new vge(new Promise(p=>l=p),i.center,i.radius);this.perObjectData.set(e,c);const h=await this.updatingHandles.addPromise(this._addComponentGeometry(t,c,r,s,n,o,a));return this.setNeedsRender(),l(),h}async addOrUpdateObject3D(e,t,i,r){if(this.destroyed)return void aMt.warn("Attempt to add an object to a destroyed instance");const s=this.perObjectData.get(e);let n;(s==null?void 0:s.renderables.length)>0&&this.perObjectDataEvictionCache.add(s);const o=e.boundingVolumeWorldSpace.bounds,a=new vge(new Promise(c=>n=c),o,Y0(o));this.perObjectData.set(e,a);const l=new Array;if(i.mergeGeometries&&e.geometries.length>1&&cMt(e))l.push(this._addObjectMergedGeometries(e,a,t,i,r));else for(let c=0;c<e.geometries.length;c++){const h=e.geometryRecords[c];if(!h.material.supportsEdges)continue;const p=e.geometries[c];l.push(this._addGeometry(e,a,p,h,t[0],i,r))}await this.updatingHandles.addPromise(Promise.all(l)),this.perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(t=>this._removeRenderable(t)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this.perObjectData.has(e)}async updateAllComponentOpacities(e,t){const i=t instanceof Array?r=>t[r]:()=>t;(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(r=>{const s=r.components.meta.length;for(let n=0;n<s;n++){const o=i(n),a=r.components.meta[n],l=a.index;a.material.opacity=o,r.components.buffer.textureBuffer.setDataElement(l,1,3,255*o)}this._updateTransparency(r)}),this.setNeedsRender()}async getObjectMemoryUsage(e){return(await this._getObjectEntry(e)).renderables.reduce((t,i)=>t+i.statistics.gpuMemoryUsage,0)}async updateAllComponentMaterials(e,t,i,r){const s=e instanceof Hv,n=!!i.hasSlicePlane,o=mge(t),a=g3.getKey(o,n,s);(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(l=>{if(a!==l.rendererKey){const c=this.renderers.get(l.rendererKey),h=this._acquireRenderer(o,n,s);c.removeRenderable(l),c.refCount.decrement(),l.rendererKey=a,h.addRenderable(l)}for(let c=0;c<t.length;c++)l.components.meta[c].material=t[c];r&&this._updateComponentBuffer(l.components),this._updateTransparency(l)}),this.setNeedsRender()}async updateAllVerticalOffsets(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(i=>{var s;const r=i.components.meta;for(let n=0;n<r.length;n++)i.components.meta[n].verticalOffset=(s=t==null?void 0:t[n])!=null?s:0;this._updateComponentBuffer(i.components)}),this.setNeedsRender()}async updateObjectVisibility(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(i=>i.visible=t),this.setNeedsRender()}removeObject(e){const t=this.perObjectData.get(e);t&&(this.perObjectData.delete(e),this._discardObjectEntry(t))}async _getObjectEntry(e){const t=this.perObjectData.get(e);if(!t)throw"no object";if(await t.loaded,t.loaded==null)throw mi();return t}removeAll(){this.perObjectData.forEach((e,t)=>this.removeObject(t))}render(e,t){if(this.numberOfRenderedEdges[t]=0,M(this.componentColorManager))return;this.localOrigins.updateViewMatrices(e.camera.viewMatrix);const i=e.camera.viewInverseTransposeMatrix,r=$(),s=new C8;let n=0,o=0;if(this.renderers.forEach(h=>{h.refCount.value===0?(this.renderers.delete(h.key),h.dispose()):h.forEachRenderable(p=>{p.visible&&(n+=p.statistics.averageEdgeLength,o++,p.regular&&h.updateTechnique(e,!1),p.silhouette&&h.updateTechnique(e,!0))},t)}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures(),o===0)return;const a=40*n/o,l=e.camera.perScreenPixelRatio,c=new DAt(a,l,t);he(r,i[3],i[7],i[11]),s.set(r),pe(c.transformWorldFromViewTH,s.high),pe(c.transformWorldFromViewTL,s.low),Cp(c.transformViewFromCameraRelativeRS,e.camera.viewMatrix),Ap(_ge,c.transformViewFromCameraRelativeRS),l2(c.transformNormalViewFromGlobal,_ge),c.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this.renderers.forEach(h=>{this._renderRegularEdges(h,e,c),this._renderSilhouetteEdges(h,e,c)})}_updateTransparency(e){const t=dH(e.components.meta),i=pH(e.components.meta);t===e.edgeTransparency&&i===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=i,this.renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,t,i){if(e.getCombinedStaticTransformation(t,i),_(t.origin))this.localOrigins.register(t.origin);else{const r=he(this.tmpModelPosition,i[12],i[13],i[14]);t.origin=this.localOrigins.acquire(r)}return IAt(t.origin.vec3,i),t.origin}_updateComponentBuffer(e){const{meta:t,buffer:i}=e,r=new Uint8Array(4);for(let s=0;s<t.length;s++){const n=t[s].material,o=t[s].index,a=He(Math.round(n.size*XAt),0,255),l=He(n.extensionLength,-hH,255-hH)+hH,c=n.type==="solid"?wV.SOLID:wV.SKETCH,h=255*n.opacity,p=n.color,f=255*p[0],m=255*p[1],g=255*p[2],y=255*p[3];i.textureBuffer.setData(o,0,f,m,g,y),i.textureBuffer.setData(o,1,a,l,c,h),n3e(t[s].verticalOffset,r),i.textureBuffer.setData(o,2,r[0],r[1],r[2],r[3])}}_createComponentBuffers(e){if(M(this.componentColorManager))return null;const t=new Array,i=this.componentColorManager.getBuffer(e.length);for(let s=0;s<e.length;s++){const n=e[s],o=i.acquireIndex();t.push({index:o,verticalOffset:0,material:n})}const r={meta:t,buffer:i};return this._updateComponentBuffer(r),r}_extractEdges(e,t,i,r,s,n=s.length){return this.worker.process({data:t,indices:s,indicesLength:n,writerSettings:e,skipDeduplicate:i},this.workerAbort.signal,r)}_createEdgeResources(e){const t={};if(M(this.verticesBufferObject))return t;if(e.regular.lodInfo.lengths.length>0){const i=new Ln(this.rctx,NJ,{vertices:Xme,instances:_V.glLayout},{vertices:this.verticesBufferObject,instances:Ci.createVertex(this.rctx,Wi.STATIC_DRAW,e.regular.instancesData.buffer)});t.regular={vao:i,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){const i=new Ln(this.rctx,NJ,{vertices:Xme,instances:bV.glLayout},{vertices:this.verticesBufferObject,instances:Ci.createVertex(this.rctx,Wi.STATIC_DRAW,e.silhouette.instancesData.buffer)});t.silhouette={vao:i,lod:e.silhouette.lodInfo}}return t}async _addGeometry(e,t,i,r,s,n,o){const a=i.vertexAttributes.get(P.POSITION),l=i.indices.get(P.POSITION),c=Ne(),h={position:a,indices:l,modelTransform:c,origin:this._computeModelTransformWithLocalOrigin(e,r,c)};return this._addPositionData(t,h,i.edgeIndicesLength,s,n,o)}async _addPositionData(e,t,i,r,s,n=!1){if(e.loaded==null)return;const o=this._createComponentBuffers([r]);if(M(o)||i<=0)return;const a=this._acquireRenderer(r.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=t,h=t.indices,p=t.position,f=p.data.length/p.size,m=Z$.createBuffer(f);for(let T=0;T<f;T++)m.position.set(T,0,p.data[T*p.size+0]),m.position.set(T,1,p.data[T*p.size+1]),m.position.set(T,2,p.data[T*p.size+2]);yge(o.meta,[0,m.componentIndex.count],m.componentIndex);const g=await this.updatingHandles.addPromise(this._extractEdges(a.writerSettings,m,!1,n,h,i));if(e.loaded==null)return;const{regular:y,silhouette:x}=this._createEdgeResources(g),b=(y?y.vao.size:0)+(x?x.vao.size:0),S={regular:y,silhouette:x,transform:{modelMatrix:l,origin:c},statistics:{gpuMemoryUsage:b,externalMemoryUsage:!1,averageEdgeLength:g.averageEdgeLength},components:o,visible:!0,edgeTransparency:dH(o.meta),objectTransparency:pH(o.meta),distanceToCamera:0,rendererKey:a.key};e.renderables.push(S),a.addRenderable(S),this.gpuMemoryUsage+=b}async _addComponentGeometry(e,t,i,r,s,n,o){if(t.loaded==null)return 0;const a=this._createComponentBuffers(n);if(M(a))return 0;const l=mge(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),h=Z$.createBuffer(i.count);a8(h.position,i),yge(a.meta,s,h.componentIndex,r);const p=!0,f=c.writerSettings,m=await this.updatingHandles.addPromise(this._extractEdges(f,h,p,!1,r));if(t.loaded==null)return 0;const{regular:g,silhouette:y}=this._createEdgeResources(m),x=(g?g.vao.size:0)+(y?y.vao.size:0),b={regular:g,silhouette:y,transform:e,statistics:{gpuMemoryUsage:x,externalMemoryUsage:!0,averageEdgeLength:m.averageEdgeLength},components:a,visible:!0,edgeTransparency:dH(a.meta),objectTransparency:pH(a.meta),distanceToCamera:0,rendererKey:c.key};return t.renderables.push(b),c.addRenderable(b),x}async _addObjectMergedGeometries(e,t,i,r,s){const n=new Map;let o=0,a=null,l=0;for(let b=0;b<e.geometries.length;b++){const S=e.geometries[b],T=e.geometryRecords[b];if(!T.material.supportsEdges)continue;!a&&T.origin&&(a=T);const C=S.vertexAttributes.get(P.POSITION);l+=C.data.length/C.size,o+=S.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,h=o?new c(o):null,p=[];let f=0;for(let b=0;b<e.geometries.length;b++){const S=e.geometries[b];if(!e.geometryRecords[b].material.supportsEdges)continue;const T=S.vertexAttributes.get(P.POSITION),C=S.indices.get(P.POSITION);let A=n.get(T.data);if(A==null){A=p.length/3;for(let O=0;O<T.data.length;O+=T.size)p.push(T.data[O+0]),p.push(T.data[O+1]),p.push(T.data[O+2]);n.set(T.data,A)}if(C)for(let O=0;O<S.edgeIndicesLength;O++)h[f++]=A+C[O]}const m=a||e.geometryRecords[0],g=Ne(),y=this._computeModelTransformWithLocalOrigin(e,m,g);for(let b=0;b<e.geometryRecords.length;b++)e.geometryRecords[b].origin=y;const x={position:{data:p,size:3},indices:h,modelTransform:g,origin:y};await this.updatingHandles.addPromise(this._addPositionData(t,x,h.length,i[0],r,s))}_acquireRenderer(e,t,i){const r=g3.getKey(e,t,i);let s=this.renderers.get(r);return M(this.strokesTexture)&&(this.strokesTexture=iMt(this.rctx)),s||(s=new g3(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:t,strokesTexture:this.strokesTexture,legacy:i,spherical:this.viewingMode===tt.Global}),this.renderers.set(r,s)),s.refCount.increment(),s}_removeRenderable(e){lMt(e);const t=this.renderers.get(e.rendererKey);if(t){t.removeRenderable(e),t.refCount.decrement(),"origin"in e.transform&&this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const i of e.components.meta)e.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(e){const t=e.camera.eye,i=e.camera.viewForward,r=$(),s=n=>{const{center:o,radius:a}=n;zu(r,o,t);const l=Pe(r,i),c=l<-a?1/0:l<a?0:l-a;n.renderables.forEach(h=>h.distanceToCamera=c)};this.perObjectData.forEach(s),this.perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(e,t,i){const r=e.bindRegularEdges(i,t),s=i.transparency;e.forEachRenderable(n=>{if(!n.visible||!n.regular)return;const o=gge(n.regular.lod.lengths,n.distanceToCamera,i),a="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):Xn;e.renderRegularEdges(r,n,t,o,a),this.numberOfRenderedEdges[s]+=o},s)}_renderSilhouetteEdges(e,t,i){const r=e.bindSilhouetteEdges(i,t),s=i.transparency;e.forEachRenderable(n=>{if(!n.visible||!n.silhouette)return;const o=gge(n.silhouette.lod.lengths,n.distanceToCamera,i),a="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):Xn;e.renderSilhouetteEdges(r,n,t,o,a),this.numberOfRenderedEdges[s]+=o},s)}};function lMt(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)}function cMt(e){let t=null,i=null;for(let r=0;r<e.geometries.length;r++){const s=e.geometryRecords[r];if(s.material.supportsEdges){if(t){if(!wb(t,s.transformation))return!1}else t=s.transformation;if(!i&&_(s.origin))i=s;else if(_(i==null?void 0:i.origin)&&_(s.origin)&&i.origin.id!==s.origin.id)return!1}}return!0}u([d({constructOnly:!0})],df.prototype,"rctx",void 0),u([d({constructOnly:!0})],df.prototype,"renderSR",void 0),u([d({constructOnly:!0})],df.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],df.prototype,"techniqueRepository",void 0),u([d({constructOnly:!0})],df.prototype,"setNeedsRender",void 0),u([d({constructOnly:!0})],df.prototype,"schedule",void 0),u([d({readOnly:!0})],df.prototype,"updatingHandles",void 0),u([d({readOnly:!0})],df.prototype,"updating",null),df=u([L("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],df);class vge{constructor(t,i,r){this.center=i,this.radius=r,this.renderables=new Array,this.loaded=t,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}const _ge=ls();function uMt(e){const t=e.capabilities.disjointTimerQuery;return M(t)?null:t.timestampBits()>0?new hMt(t):jJ?null:new dMt(t)}class hMt{constructor(t){this.timer=t,this.start=t.createQuery(),t.createTimestamp(this.start)}stop(t,i=50){this.end=this.timer.createQuery(),this.timer.createTimestamp(this.end),this._checkQueryResult(t,i)}_checkQueryResult(t,i){if(!this.timer.resultAvailable(this.end))return void setTimeout(()=>this._checkQueryResult(t,i),i);if(this.timer.disjoint())return void t(null);const r=this.timer.getResult(this.start),s=this.timer.getResult(this.end);t((s-r)/1e6)}}class dMt{constructor(t){this.timer=t,this.query=t.createQuery(),jJ=!0,this.timer.beginTimeElapsed(this.query)}stop(t,i=50){this.timer.endTimeElapsed(),jJ=!1,this._checkQueryResult(t,i)}_checkQueryResult(t,i){const r=this.timer.resultAvailable(this.query),s=this.timer.disjoint();if(!r||s)s?t(null):setTimeout(()=>this._checkQueryResult(t,i),i);else{const n=this.timer.getResult(this.query);t(n/1e6)}}}let jJ=!1;var wn;(function(e){e[e.Prepare=0]="Prepare",e[e.Shadowmap=1]="Shadowmap",e[e.Lineardepth=2]="Lineardepth",e[e.Normals=3]="Normals",e[e.SSAO=4]="SSAO",e[e.Opaque=5]="Opaque",e[e.OpaqueEdges=6]="OpaqueEdges",e[e.Transparent=7]="Transparent",e[e.TransparentEdges=8]="TransparentEdges",e[e.Hudvisibility=9]="Hudvisibility",e[e.TransparentTerrain=10]="TransparentTerrain",e[e.Atmosphere=11]="Atmosphere",e[e.Laserline=12]="Laserline",e[e.Occluded=13]="Occluded",e[e.Antialiasing=14]="Antialiasing",e[e.Highlights=15]="Highlights",e[e.HudOccluded=16]="HudOccluded",e[e.HudNotoccluded=17]="HudNotoccluded"})(wn||(wn={}));const pMt=["prepare","shadowmap","lineardepth","normals","ssao","opaque","opaque edges","transparent","transparent edges","hudvisibility","transparent terrain","atmosphere","laserline","occluded","antialiasing","highlights","hudOccluded","hudNotoccluded"];class fMt extends cb{constructor(){super("total"),this.total=0,this.frameCount=0}}class mMt{constructor(){this._startTime=0,this._lastSample=0,this._enableGPUTimer=0,this.totalTime=new fMt,this.gpuTime=new cb("gpu",9),this.renderPassTimings=pMt.map(t=>new cb(t))}get elapsedTime(){return performance.now()-this._startTime}enableGPUTimer(){return++this._enableGPUTimer,{remove:LQ(()=>--this._enableGPUTimer)}}prerender(t){this._startTime=this._lastSample=performance.now(),this._enableGPUTimer&&(this._gpuTimer=uMt(t))}advance(t){const i=performance.now();this.renderPassTimings[t].record(i-this._lastSample),this._lastSample=i}postrender(){_(this._gpuTimer)&&(this._gpuTimer.stop(i=>_(i)&&this.gpuTime.record(i),16),this._gpuTimer=null);const t=performance.now()-this._startTime;this.totalTime.record(t),this.totalTime.total+=t,this.totalTime.frameCount++}}const bge=.9;let p0=class extends Ee{constructor(e,t,i,r,s,n,o,a,l){super({}),this._materialRepository=e,this._shaderTechniqueRepository=i,this._rctx=r,this._compositingHelper=s,this._magnifierHelper=n,this._requestRender=o,this._stage=l,this._materialRenderers=new Map,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this.performanceInfo=new mMt,this._antialiasing=uT.SMAA,this._oitEnabled=!1,this._multipassTerrain=!0,this._transparentTerrain=!1,this._hasAnimations=!1,this._animationTimestep=0,this._handles=new Nt,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new _I(this._rctx,i),this._oitEnabled=this._hasOITSupport,this._requestRender(),this._offscreenRendering=new oAt(this._rctx,this._compositingHelper),this._sliceHelper=new OAt,this._shadowMap=new _re(this._rctx,l.viewingMode,2),this._ssaoHelper=new $Re(i,this._rctx,()=>this._requestRender()),this._highlight=new iAt(i,this._rctx),this._shadowHighlight=new MAt(this._rctx,l.viewingMode),this._shadowAccumulator=new el(this._rctx,i,l,c=>{const h=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureCameraBindParameters(c.camera,c.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=h},(c,h,p)=>{c.shadowMap.start(c.camera,h,p),this._renderShadowCascades(rt.MATERIAL_DEPTH_SHADOWMAP_ALL,c.shadowMap),c.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(c.camera,c.contentCamera)},()=>this._requestRender()),this._renderContext=new zmt(this._rctx,this._offscreenRendering,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new cAt({renderContext:this._renderContext,shaderTechniqueRepository:i,textureRep:t,materialRep:this._materialRepository,requestRender:this._requestRender,schedule:a}),this.renderPassManager=new HCt(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([re(()=>this._stage.state.camera,()=>this._requestRender(),fi),re(()=>dr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges(Xt.TRANSPARENT):()=>{},this._requestRender()},Et)])}get _bindParameters(){return this._renderContext.bindParameters}get hasWater(){return this._hasWater||this._hasOverlayWater}get hasWaterReflection(){return this.hasWater&&this._waterReflectionEnabled}normalizeCtorArgs(){return{}}dispose(){this._handles.destroy(),this._smaaPass.dispose(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._edgeView=We(this._edgeView),this._offscreenRendering.dispose(),this._fallbackDepthStencilTexture=ht(this._fallbackDepthStencilTexture),this._shadowMap.enabled=!1,this._shadowMap.dispose(),this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),g6.prune(),this._content.clear()}disposeOffscreenBuffers(){this._offscreenRendering.dispose(),this._shadowMap.dispose(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing===uT.SMAA&&this._smaaPass.updating||_(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return M(this._edgeView)&&(this._edgeView=new df({rctx:this._rctx,renderSR:this._stage.renderSR,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:e=>this._stage.resourceController.schedule(e)}),this._handles.add(re(()=>wt(this._edgeView,e=>e.updating),()=>this._requestRender(),Ui)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return Dbe(this._bindParameters.ssr.reprojectionMatrix,Xn)}set _reprojectionMatrix(e){AQ(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var e;return!!((e=this._shadowMap)==null?void 0:e.enabled)}setRenderParameters(e){const{_shadowMap:t,_ssaoHelper:i,_bindParameters:r}=this;if(e.screenSpaceReflectionsEnabled!==void 0&&r.ssr.enabled!==e.screenSpaceReflectionsEnabled&&(r.ssr.enabled=e.screenSpaceReflectionsEnabled,this._requestRender()),e.shadowMap!==void 0&&t.enabled!==e.shadowMap&&(t.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&t.maxCascades!==e.shadowMapMaxCascades&&(t.maxCascades=e.shadowMapMaxCascades,this._requestRender()),_(e.environment)){_(e.environment.weather)&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=e.weatherVisible,this._renderContext.bindParameters.weather=e.environment.weather,this._renderContext.bindParameters.weatherVisible=e.weatherVisible),e.environment.lighting.ambientOcclusionEnabled!==void 0&&i.enabled!==e.environment.lighting.ambientOcclusionEnabled&&(i.enabled=e.environment.lighting.ambientOcclusionEnabled,this._requestRender()),e.environment.lighting.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==e.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=e.environment.lighting.waterReflectionEnabled,this._requestRender());const n=e.environment.lighting.type==="sun";r.enableFillLights!==n&&(r.enableFillLights=n,this._requestRender())}e.background&&this._offscreenRendering.background!==e.background&&(this._offscreenRendering.background=e.background,this._requestRender());const s=e.antialiasingEnabled?uT.SMAA:uT.NONE;e.antialiasingEnabled!==void 0&&this._antialiasing!==s&&(this._antialiasing=s,this._requestRender()),e.highQualityTransparency!==void 0&&this._multipassTerrain!==e.highQualityTransparency&&(this._multipassTerrain=e.highQualityTransparency,this._oitEnabled=e.highQualityTransparency&&this._hasOITSupport,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.overlays!==void 0&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.transparentTerrain!==void 0&&this._transparentTerrain!==e.transparentTerrain&&(this._transparentTerrain=e.transparentTerrain,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlendWorking}modify(e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:t,removes:i,updates:r}=e;if(t.length===0&&i.length===0&&r.length===0)return;i.forAll(({id:o})=>this._content.delete(o)),t.forAll(o=>this._content.set(o.id,o));const s=vRe(e);let n=!1;s.forEach((o,a)=>{let l=this._materialRenderers.get(a);if(!l){if(!(o.adds.length>0))return;l=new RRe(this._rctx,this._materialRepository,a),this._materialRenderers.set(a,l)}l.modify(o),l.isEmpty&&(n=!0)}),n&&this._materialRenderers.forEach((o,a)=>{o.isEmpty&&(this._materialRenderers.delete(a),o.dispose())}),this._hasHighlights=Mn(this._materialRenderers,o=>o.hasHighlights),this._bindParameters.hasOccludees=Mn(this._materialRenderers,o=>o.hasOccludees),this._hasWater=Mn(this._materialRenderers,o=>o.hasWater),this._needsTransparentPass=Mn(this._materialRenderers,o=>o.requiresSlot($e.TRANSPARENT_MATERIAL,rt.MATERIAL)),this._hasHUDElements=Mn(this._materialRenderers,o=>o.requiresSlot($e.LINE_CALLOUTS_HUD_DEPTH,rt.MATERIAL)||o.requiresSlot($e.HUD_MATERIAL,rt.MATERIAL)||o.requiresSlot($e.LABEL_MATERIAL,rt.MATERIAL)),this._requestRender()}updateAnimation(e){return this._hasAnimations=!1,this._materialRenderers.forEach(t=>this._hasAnimations=t.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations}get animationTimestep(){return this._animationTimestep}updateLightSources(e,t,i){this._bindParameters.lighting.groundLightingFactor=t,this._bindParameters.lighting.globalFactor=i,this._bindParameters.lighting.set(e)}render(e,t,i,r){this._isRendering=!0,this.performanceInfo.prerender(this._rctx),this._bindParameters.transparencyPassType=Rt.NONE;const s=this._offscreenRendering;s.needLastFrameColorTexture=this.hasWaterReflection,s.advanceCurrentRenderTarget();const n=Jb(this._sliceHelper.plane);r===TS.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),t.setGLViewport(this._rctx),this._ensureCameraBindParameters(t,i),this._renderPlugins.prepareRender(),this.performanceInfo.advance(wn.Prepare);const o=this._computeDepthRange(t);this._renderShadowMap(e,t,this._bindParameters.lighting.lightingMainDirection,o),this.performanceInfo.advance(wn.Shadowmap),s.initializeFrame(t),this._ensureBindParameters(t,i),this._renderLinearDepth(),this.performanceInfo.advance(wn.Lineardepth),this._accumulateShadows(o,t,i),this._renderNormal(),this.performanceInfo.advance(wn.Normals),this._ensureBindParametersSSR(),this._ssaoHelper.computeSSAO(this._bindParameters,s.linearDepthTexture,s.normalTexture),this.performanceInfo.advance(wn.SSAO),this._renderContext.pass=rt.MATERIAL,s.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(wn.Opaque);const a=this._multipassTerrain&&this._transparentTerrain;this._renderTerrainLinearDepth(a),this._setMultipassEnabled(a),this._setTerrainCulling(a),this._renderEdges(Xt.OPAQUE),this.performanceInfo.advance(wn.OpaqueEdges),this._offscreenRendering.bindTarget(this._offscreenRendering.currentColorTarget,this._offscreenRendering.mainDepth),this._renderSlot($e.VOXEL),this._renderHiddenTransparentEdges();const l=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;l&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(wn.Transparent),this._renderGeometryLinearDepth(a);const c=this._renderHUDVisibility();a||this._renderInternalSlot($e.LINE_CALLOUTS),this.performanceInfo.advance(wn.Hudvisibility),this._renderEdges(Xt.TRANSPARENT,a),this.performanceInfo.advance(wn.TransparentEdges),this._renderTransparentTerrain(),this._transparentTerrain&&c&&(a?this._renderLineCallouts(Yd.Occluded):s.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(Yd.Occluded,s.framebuffer),this.performanceInfo.advance(wn.HudOccluded)),this.performanceInfo.advance(wn.TransparentTerrain),this._setTerrainCulling(!1),this._transparentTerrain&&(s.compositeTransparentTerrainOntoMain(this._bindParameters),a&&(this._renderEdges(Xt.OPAQUE),this.performanceInfo.advance(wn.OpaqueEdges),l&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(wn.Transparent),this._renderEdges(Xt.TRANSPARENT),this.performanceInfo.advance(wn.TransparentEdges))),a&&this._renderLineCallouts(Yd.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),s.renderToTargets(()=>{this._renderInternalSlot($e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot($e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot($e.LASERLINES)},s.currentColorTarget,s.mainDepth),this.performanceInfo.advance(wn.Atmosphere),this._renderPlugins.needsLaserlineWithContrastControl&&s.renderTmpAndCompositeToMain(()=>this._renderSlot($e.LASERLINES_CONTRAST_CONTROL),this._bindParameters,Na.PremultipliedAlpha),this.performanceInfo.advance(wn.Laserline),this._renderOccluded(),this.performanceInfo.advance(wn.Occluded);const h=r===TS.ON&&this._magnifierHelper.enabled,p=h&&M(e)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):e;this._rctx.bindFramebuffer(p);const f=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(this._antialiasing,f)&&_(f)&&this._compositingHelper.composite(this._bindParameters,f,Na.None),this.performanceInfo.advance(wn.Antialiasing),this._renderHUD(Yd.NotOccluded,p),this.performanceInfo.advance(wn.HudNotoccluded),this._renderHighlights(p,this._bindParameters),this.performanceInfo.advance(wn.Highlights),h&&this._magnifierHelper.render(this._rctx,this._bindParameters),p!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.tmpColorTexture,Na.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=n,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.postrender()}finish(e){if(this._hasAnimations||(this._animationTimestep=0),e===An.BACKGROUND){this._rctx.gl.getError();const t=this.performanceInfo.elapsedTime/GCt;this._animationTimestep=Math.max(this._animationTimestep*bge+t*(1-bge),jCt)}}readDepthPixels(e,t,i){const r=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=wr.COLOR_BUFFER_BIT|wr.DEPTH_BUFFER_BIT|wr.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(rt.MATERIAL_DEPTH)}r.readPixels(t[0],t[1],t[2],t[3],Qe.RGBA,kt.UNSIGNED_BYTE,i)}readHUDVisibility(e,t,i,r,s){this._offscreenRendering.bindTarget(this._offscreenRendering.hudVisibility).readPixels(e,t,i,r,Qe.RGBA,kt.UNSIGNED_BYTE,s)}readAccumulatedShadow(e,t){return this._shadowAccumulator.readAccumulatedShadow(e,t)}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,t=!1){const i=this._edgeView;_(i)&&i.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>i.render(this._bindParameters,e),this._bindParameters,Na.Alpha,t)}_renderShadowMap(e,t,i,r){const s=this._shadowMap;s.enabled&&(s.start(t,i,r),this._shadowHighlight.updateParameters(t,i),this.needsShadowHighlight?(this._renderShadowCascades(rt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,NM.Highlight)),s.clear(),this._renderShadowCascades(rt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,NM.Default),this._renderGeometryAndTransparentTerrainPass(rt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT)})):this._renderShadowCascades(rt.MATERIAL_DEPTH_SHADOWMAP_ALL),s.finish(e),t.setGLViewport(this._rctx))}_renderShadowCascades(e,t=this._shadowMap,i=r=>{}){for(const r of t.getCascades())r.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(r.camera,r.camera),this._renderGeometryAndTransparentTerrainPass(e),i(r)}get _needsLinearDepth(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(rt.MATERIAL_DEPTH),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth),this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const t=this._renderContext.pass;this._renderContext.pass=rt.MATERIAL_DEPTH,this._offscreenRendering.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const t=this._renderContext.pass;this._offscreenRendering.renderToTargets(()=>this._renderGeometryPass(rt.MATERIAL_DEPTH),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture}get needsNormal(){return this._ssaoHelper.enabled}_renderNormal(){this.needsNormal?this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(rt.MATERIAL_NORMAL)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)}get needsDepthRange(){return this._shadowMap.enabled||this.needsShadowCast}_computeDepthRange(e){if(!this.needsDepthRange)return $J;const t=PCt(e,this._content,this._stage.layers);return BM(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.pass=e,this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.pass=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderOpaqueGeometry(){this._renderSlot($e.INTEGRATED_MESH),this._renderSlot($e.OPAQUE_TERRAIN),this._renderInternalSlot($e.OPAQUE_MATERIAL),this._renderSlot($e.OPAQUE_MATERIAL),this._renderSlot($e.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot($e.TRANSPARENT_MATERIAL),this._renderSlot($e.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot($e.TRANSPARENT_TERRAIN)}_renderHUDVisibility(){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot($e.OCCLUSION_PIXELS)},this._multipassTerrain&&this._transparentTerrain),e}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===Yd.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderInternalSlot($e.LINE_CALLOUTS),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot($e.LINE_CALLOUTS)}_renderHUD(e,t){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(e),!0),this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.hudColorTexture,Na.PremultipliedAlpha)):e===Yd.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderHUDElements(Yd.Occluded),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot($e.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot($e.HUD_MATERIAL),this._renderInternalSlot($e.LABEL_MATERIAL)}get needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this.needsHighlight}_renderHighlights(e,t){if(!this.needsHighlight)return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const i=this._highlight,r=this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(rt.MATERIAL_HIGHLIGHT),this._rctx.clearSafe(wr.DEPTH_BUFFER_BIT),this._renderHUDElements(Yd.Both)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=r.colorTexture,this.needsShadowHighlight&&this._shadowHighlight.render(t,e),i.render(this._bindParameters,r,e)}get needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,t,i){this.needsShadowCast&&this._shadowAccumulator.renderAccumulation(this._offscreenRendering.linearDepthTexture,e,t,i)}_renderOrderIndependentTransparency(e,t){const i=s=>{this._bindParameters.transparencyPassType=s,this._offscreenRendering.renderOITPass(()=>e(),s,t)},r=this._renderContext.pass;this._renderContext.pass=rt.MATERIAL_ALPHA,i(Rt.Alpha),this._renderContext.pass=rt.MATERIAL,i(Rt.Color),i(Rt.FrontFace),this._offscreenRendering.compositeTransparentOntoOpaque(this._bindParameters,t),this._bindParameters.transparencyPassType=Rt.NONE,this._renderContext.pass=r,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let e=0;this._materialRenderers.forEach((n,o)=>{o&&o.isVisible()&&o.renderOccluded===rs.OccludeAndTransparentStencil&&(e|=o.renderOccluded,XR.push(o))});const t=this._offscreenRendering,i=(n,o,a,l,c)=>{(e&o)!=0&&(t.renderToTargets(a,t.tmpColor,t.mainDepth,[0,0,0,0],l,c),t.compositeOccludedOntoMain(this._bindParameters,n))};XR.length!==0&&(this._renderInternalSlot($e.OCCLUDER_MATERIAL,XR),i(.5,rs.OccludeAndTransparentStencil,()=>this._renderInternalSlot($e.TRANSPARENT_OCCLUDER_MATERIAL,XR),!1,!1),XR.length=0),this._materialRenderers.forEach((n,o)=>{o&&o.isVisible()&&(o.renderOccluded===rs.OccludeAndTransparent||o.renderOccluded===rs.Transparent||o.renderOccluded===rs.Opaque)&&(e|=o.renderOccluded,ZR.push(o))});const r=this._renderPlugins.renderOccludedFlags;if(e|=r,!e)return;const s=n=>{this._renderContext.renderOccludedMask=n,r>rs.Occlude&&this._renderSlot($e.OCCLUDED_TERRAIN),this._renderInternalSlot($e.OPAQUE_MATERIAL,ZR),this._renderInternalSlot($e.TRANSPARENT_MATERIAL,ZR),this._renderInternalSlot($e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,ZR),this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=rt.MATERIAL,i(.5,rs.OccludeAndTransparent,()=>s(rs.OccludeAndTransparent),!0,Fc.OutlineVisualElementMask),i(.5,rs.Transparent,()=>s(rs.Transparent),!0,Fc.OutlineVisualElementMask),i(1,rs.Opaque,()=>s(rs.Opaque),!0,Fc.OutlineVisualElementMask),ZR.length=0}_renderAntiAliasing(e,t){if(e===uT.SMAA){if(this._smaaPass.enable(()=>this._requestRender())&&_(t))return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_ensureCameraBindParameters(e,t){this._bindParameters.camera=e,this._bindParameters.contentCamera=t}_ensureBindParameters(e,t){var r;this._ensureCameraBindParameters(e,t);const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.highlightDepthTexture=(r=i.depthTexture)!=null?r:this._getFallbackDepthTexture()}_ensureBindParametersSSR(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Xn:(Ks(xge,this._bindParameters.camera.viewMatrix),Ks(wge,this._bindParameters.camera.projectionMatrix),As(SE,xge,wge),As(SE,this._renderContext.lastFrameCamera.viewMatrix,SE),As(SE,this._renderContext.lastFrameCamera.projectionMatrix,SE),this._reprojectionMatrix=SE),this._bindParameters.ssr.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._bindParameters.ssr.lastFrameColorTexture=null,this._bindParameters.ssr.enabled=this.hasWaterReflection}_renderInternalSlot(e,t){let i=!1;return this._bindParameters.slot=e,_(t)?t.forEach(r=>{if(!r.shouldRender(this._renderContext))return;const s=this._materialRenderers.get(r);_(s)&&(i=s.render(this._renderContext.pass,this._bindParameters)||i)}):this._materialRenderers.forEach((r,s)=>{s.shouldRender(this._renderContext)&&r.render(this._renderContext.pass,this._bindParameters)&&(i=!0)}),i}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=qCe(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,t,i,r,s,n,o,a,l,c;return{offscreen:(t=(e=this._offscreenRendering)==null?void 0:e.gpuMemoryUsage)!=null?t:0,highlights:((r=(i=this._highlight)==null?void 0:i.gpuMemoryUsage)!=null?r:0)+((n=(s=this._shadowHighlight)==null?void 0:s.gpuMemoryUsage)!=null?n:0),shadows:(a=(o=this._shadowMap)==null?void 0:o.gpuMemoryUsage)!=null?a:0,ssao:(c=(l=this._ssaoHelper)==null?void 0:l.gpuMemoryUsage)!=null?c:0}}get test(){const e=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,getFramebufferTexture:t=>{switch(t){case L1.Color:return e._offscreenRendering.colorTexture;case L1.LinearDepth:return e._offscreenRendering.linearDepthTexture;case L1.Normals:return e._offscreenRendering.normalTexture;case L1.ShadowMap:return e._shadowMap.depthTexture;case L1.HudVisibility:return e._offscreenRendering.hudVisibilityTexture;case L1.Highlight:return e._offscreenRendering.highlightTexture}}}}};var L1;u([d()],p0.prototype,"_shadowAccumulator",void 0),u([d()],p0.prototype,"_smaaPass",void 0),u([d()],p0.prototype,"_antialiasing",void 0),u([d()],p0.prototype,"_edgeView",void 0),u([d()],p0.prototype,"updating",null),u([d()],p0.prototype,"isCameraFinal",null),p0=u([L("esri.views.3d.webgl-engine.lib.Renderer")],p0),function(e){e[e.Color=0]="Color",e[e.LinearDepth=1]="LinearDepth",e[e.Normals=2]="Normals",e[e.ShadowMap=3]="ShadowMap",e[e.HudVisibility=4]="HudVisibility",e[e.Highlight=5]="Highlight"}(L1||(L1={}));const ZR=[],XR=[],wge=Ne(),xge=Ne(),SE=Ne();class Tge{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:ke.ONE,dstRGB:ke.ZERO,srcAlpha:ke.ONE,dstAlpha:ke.ZERO},this.blendEquation={mode:xv.ADD,modeAlpha:xv.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=zf.BACK,this.frontFace=mM.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Fr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:zf.FRONT_AND_BACK,func:Fr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:zf.FRONT_AND_BACK,fail:Vs.KEEP,zFail:Vs.KEEP,zPass:Vs.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array}}class gMt{constructor(t){this._allocations=new Map,t?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(t){this._allocations.set(t,new Error().stack)}remove(t){this._allocations.delete(t)}print(){if(this._allocations.size>0){console.log(`${this._allocations.size} live object allocations:`);const t=new Map;this._allocations.forEach(i=>{var r;t.set(i,((r=t.get(i))!=null?r:0)+1)}),t.forEach((i,r)=>{const s=r.split(`
`);s.shift(),s.shift(),console.log(`${i}: ${s.shift()}`),s.forEach(n=>console.log("   ",n))})}}}const yMt={RECORD_ALLOCATIONS:!1};class vMt{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new gMt(yMt.RECORD_ALLOCATIONS);this._current.length<co.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(t,i){const r=++this._current[t];this._max[t]=Math.max(r,this._max[t]),this._allocations.add(i)}decrement(t,i){--this._current[t],this._allocations.remove(i)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((t,i)=>t+i,0)}printResourceCount(){if(this.total>0){console.log("Live objects:");for(let t=0;t<co.COUNT;++t){const i=this._current[t];i>0&&console.log(`${co[t]}: ${i}`)}}this._allocations.print()}}const _Mt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var Sge,E3e={exports:{}};(Sge=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(E3e.exports=Sge);const bMt=E3e.exports;var Ege,C3e={exports:{}};Ege=C3e,function(e){var t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];t!==void 0&&(Ege.exports=t)}();const Cge=C3e.exports;var A3e={exports:{}};(function(e){(function(t){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]}();i!==void 0&&(e.exports=i)})()})(A3e);const wMt=A3e.exports;var jp=999,Age=9999,fH=0,mH=1,Mge=2,Oge=3,Rge=4,m4=5,xMt=6,TMt=7,SMt=8,Pge=9,EMt=10,Ige=11,CMt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function AMt(){var e,t,i,r=0,s=0,n=jp,o=[],a=[],l=1,c=0,h=0,p=!1,f=!1,m="";return function(H){return a=[],H!==null?y(H.replace?H.replace(/\r\n/g,`
`):H):x()};function g(H){H.length&&a.push({type:CMt[n],data:H,position:h,line:l,column:c})}function y(H){var K;for(r=0,i=(m+=H).length;e=m[r],r<i;){switch(K=r,n){case fH:r=A();break;case mH:r=C();break;case Mge:r=T();break;case Oge:r=O();break;case Rge:r=k();break;case Ige:r=U();break;case m4:r=B();break;case Age:r=j();break;case Pge:r=S();break;case jp:r=b()}K!==r&&(m[K]===`
`?(c=0,++l):++c)}return s+=r,m=m.slice(r),a}function x(H){return o.length&&g(o.join("")),n=EMt,g("(eof)"),a}function b(){return o=o.length?[]:o,t==="/"&&e==="*"?(h=s+r-1,n=fH,t=e,r+1):t==="/"&&e==="/"?(h=s+r-1,n=mH,t=e,r+1):e==="#"?(n=Mge,h=s+r,r):/\s/.test(e)?(n=Pge,h=s+r,r):(p=/\d/.test(e),f=/[^\w_]/.test(e),h=s+r,n=p?Rge:f?Oge:Age,r)}function S(){return/[^\s]/g.test(e)?(g(o.join("")),n=jp,r):(o.push(e),t=e,r+1)}function T(){return e!=="\r"&&e!==`
`||t==="\\"?(o.push(e),t=e,r+1):(g(o.join("")),n=jp,r)}function C(){return T()}function A(){return e==="/"&&t==="*"?(o.push(e),g(o.join("")),n=jp,r+1):(o.push(e),t=e,r+1)}function O(){if(t==="."&&/\d/.test(e))return n=m4,r;if(t==="/"&&e==="*")return n=fH,r;if(t==="/"&&e==="/")return n=mH,r;if(e==="."&&o.length){for(;D(o););return n=m4,r}if(e===";"||e===")"||e==="("){if(o.length)for(;D(o););return g(e),n=jp,r+1}var H=o.length===2&&e!=="=";if(/[\w_\d\s]/.test(e)||H){for(;D(o););return n=jp,r}return o.push(e),t=e,r+1}function D(H){for(var K,ee,ce=0;;){if(K=Cge.indexOf(H.slice(0,H.length+ce).join("")),ee=Cge[K],K===-1){if(ce--+H.length>0)continue;ee=H.slice(0,1).join("")}return g(ee),h+=ee.length,(o=o.slice(ee.length)).length}}function U(){return/[^a-fA-F0-9]/.test(e)?(g(o.join("")),n=jp,r):(o.push(e),t=e,r+1)}function k(){return e==="."||/[eE]/.test(e)?(o.push(e),n=m4,t=e,r+1):e==="x"&&o.length===1&&o[0]==="0"?(n=Ige,o.push(e),t=e,r+1):/[^\d]/.test(e)?(g(o.join("")),n=jp,r):(o.push(e),t=e,r+1)}function B(){return e==="f"&&(o.push(e),t=e,r+=1),/[eE]/.test(e)||e==="-"&&/[eE]/.test(t)?(o.push(e),t=e,r+1):/[^\d]/.test(e)?(g(o.join("")),n=jp,r):(o.push(e),t=e,r+1)}function j(){if(/[^\d\w_]/.test(e)){var H=o.join("");return n=bMt.indexOf(H)>-1?SMt:wMt.indexOf(H)>-1?TMt:xMt,g(o.join("")),n=jp,r}return o.push(e),t=e,r+1}}function MMt(e){var t=AMt(),i=[];return i=(i=i.concat(t(e))).concat(t(null))}function OMt(e){return MMt(e)}function RMt(e){return e.map(t=>t.type!=="eof"?t.data:"").join("")}const gH=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function PMt(e,t="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of e)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const o=n[1].replace(/\s\s+/g," ");if(o===i)return o;if(o===t)return s.data="#version "+i,t;throw new Error("unknown glsl version: "+o)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function IMt(e,t){for(let i=t-1;i>=0;i--){const r=e[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function bI(e,t,i,r){r=r||i;for(const s of e)if(s.type==="ident"&&s.data===i)return r in t?t[r]++:t[r]=0,bI(e,t,r+"_"+t[r],r);return i}function M3e(e,t,i="afterVersion"){function r(l,c){for(let h=c;h<l.length;h++){const p=l[h];if(p.type==="operator"&&p.data===";")return h}return null}function s(l){let c=-1,h=0,p=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(m.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++h:m.data.match(/\#endif\s*.*/)&&--h),i!=="afterVersion"&&i!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(p=Math.max(p,f)),i==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const g=r(l,f);if(g===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,g)}c<p&&h===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<e.length&&/[^\r\n]$/.test(e[l].data);let a=s(e);o(a-1)&&e.splice(a++,0,n);for(const l of t)e.splice(a++,0,l);o(a-1)&&o(a)&&e.splice(a,0,n)}function $Mt(e,t,i,r="lowp"){M3e(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function LMt(e,t,i,r,s="lowp"){M3e(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function DMt(e,t){let i,r,s=-1;for(let n=t;n<e.length;n++){const o=e[n];if(o.type==="operator"&&(o.data==="["&&(i=n),o.data==="]")){r=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return i&&r&&e.splice(i,r-i+1),s}function $ge(e,t){const i=NMt();if(_(i))return i;const r=OMt(e);if(PMt(r,"100","300 es")==="300 es")return e;let s=null,n=null;const o={},a={};for(let l=0;l<r.length;++l){const c=r[l];switch(c.type){case"keyword":t===kh.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=t===kh.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),t===kh.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(s||(s=bI(r,o,"fragColor"),$Mt(r,s,"vec4")),c.data=s),t===kh.FRAGMENT_SHADER&&c.data==="gl_FragData"){const h=DMt(r,l+1),p=bI(r,o,"fragData");LMt(r,p,"vec4",h,"mediump"),c.data=p}else t===kh.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(n||(n=bI(r,o,"gl_FragDepth")),c.data=n);break;case"ident":if(_Mt.includes(c.data)){if(t===kh.VERTEX_SHADER&&IMt(r,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in a||(a[c.data]=bI(r,o,c.data)),c.data=a[c.data]}}}for(let l=r.length-1;l>=0;--l){const c=r[l];if(c.type==="preprocessor"){const h=c.data.match(/\#extension\s+(.*)\:/);if(h&&h[1]&&gH.includes(h[1].trim())){const m=r[l+1];r.splice(l,m&&m.type==="whitespace"?2:1)}const p=c.data.match(/\#ifdef\s+(.*)/);p&&p[1]&&gH.includes(p[1].trim())&&(c.data="#if 1");const f=c.data.match(/\#ifndef\s+(.*)/);f&&f[1]&&gH.includes(f[1].trim())&&(c.data="#if 0")}}return FMt(e,RMt(r))}function NMt(e){return null}function FMt(e,t){return t}const kMt=4294967295;class UMt{constructor(t,i,r,s,n=new Map){this._context=t,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,t||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),this._context.type===Ii.WEBGL2&&(i=$ge(i,kh.VERTEX_SHADER),r=$ge(r,kh.FRAGMENT_SHADER)),this._vShader=Lge(this._context,kh.VERTEX_SHADER,i),this._fShader=Lge(this._context,kh.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(co.Shader,this),o$()&&(this.vertexShader=i,this.fragmentShader=r)}get glName(){if(_(this._glName))return this._glName;if(M(this._vShader))return null;const t=this._context.gl,i=t.createProgram();if(t.attachShader(i,this._vShader),t.attachShader(i,this._fShader),this._locations.forEach((r,s)=>t.bindAttribLocation(i,r,s)),t.linkProgram(i),o$()&&!t.getProgramParameter(i,t.LINK_STATUS)&&console.error(`Could not link shader
validated: ${t.getProgramParameter(i,t.VALIDATE_STATUS)}, gl error ${t.getError()}, vertex: ${t.getShaderParameter(this._vShader,t.COMPILE_STATUS)}, fragment: ${t.getShaderParameter(this._fShader,t.COMPILE_STATUS)}, info log: ${t.getProgramInfoLog(i)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===Ii.WEBGL2){const r=t;for(const[s,n]of this._uniformBlockBindings){const o=r.getUniformBlockIndex(i,s);o<kMt&&r.uniformBlockBinding(i,o,n)}}return this._glName=i,this._context.instanceCounter.increment(co.Program,this),i}get hasGLName(){return _(this._glName)}get isCompiled(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return t==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const t=this._context.gl;this._vShader&&(t.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(co.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(co.Program,this))}ref(){++this._refCount}_getUniformLocation(t){return this._nameToUniformLocation[t]===void 0&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this.glName,t)),this._nameToUniformLocation[t]}hasUniform(t){return this._getUniformLocation(t)!==null}setUniform1i(t,i){const r=this._nameToUniform1[t];r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1iv(t,i){Nm(this._nameToUniform1v,t,i)&&this._context.gl.uniform1iv(this._getUniformLocation(t),i)}setUniform2iv(t,i){Nm(this._nameToUniform2,t,i)&&this._context.gl.uniform2iv(this._getUniformLocation(t),i)}setUniform3iv(t,i){Nm(this._nameToUniform3,t,i)&&this._context.gl.uniform3iv(this._getUniformLocation(t),i)}setUniform4iv(t,i){Nm(this._nameToUniform4,t,i)&&this._context.gl.uniform4iv(this._getUniformLocation(t),i)}setUniform1f(t,i){const r=this._nameToUniform1[t];r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1fv(t,i){Nm(this._nameToUniform1v,t,i)&&this._context.gl.uniform1fv(this._getUniformLocation(t),i)}setUniform2f(t,i,r){const s=this._nameToUniform2.get(t);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),this._nameToUniform2.set(t,[i,r])):i===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),s[0]=i,s[1]=r)}setUniform2fv(t,i){Nm(this._nameToUniform2,t,i)&&this._context.gl.uniform2fv(this._getUniformLocation(t),i)}setUniform3f(t,i,r,s){const n=this._nameToUniform3.get(t);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),this._nameToUniform3[t]=[i,r,s]):i===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),n[0]=i,n[1]=r,n[2]=s)}setUniform3fv(t,i){Nm(this._nameToUniform3,t,i)&&this._context.gl.uniform3fv(this._getUniformLocation(t),i)}setUniform4f(t,i,r,s,n){const o=this._nameToUniform4.get(t);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),this._nameToUniform4.set(t,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(t,i){Nm(this._nameToUniform4,t,i)&&this._context.gl.uniform4fv(this._getUniformLocation(t),i)}setUniformMatrix3fv(t,i,r=!1){Nm(this._nameToUniformMatrix3,t,i)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(t),r,i)}setUniformMatrix4fv(t,i,r=!1){Nm(this._nameToUniformMatrix4,t,i)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(t),r,i)}stop(){}}function Lge(e,t,i){const r=e.gl,s=r.createShader(t);return r.shaderSource(s,i),r.compileShader(s),o$()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===kh.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(zMt(i))),s}function zMt(e){let t=2;return e.replace(/\n/g,()=>`
`+VMt(t++)+":")}function VMt(e){return e>=1e3?e.toString():("  "+e).slice(-3)}function Nm(e,t,i){const r=e.get(t);return r?AQ(r,i):(e.set(t,Array.from(i)),!0)}class BMt{constructor(t){this._rctx=t,this._store=new gre}dispose(){this._store.forEach(t=>t.forEach(i=>i.dispose())),this._store.clear()}acquire(t,i,r,s){const n=this._store.get(t,i);if(_(n))return n.ref(),n;const o=new UMt(this._rctx,t,i,r,s);return o.ref(),this._store.set(t,i,o),o}get test(){let t=0;return this._store.forEach(i=>i.forEach(r=>t+=r.hasGLName?2:1)),{cachedWebGLObjects:t}}}function Dge(e,t){const i=new ss(e,{colorTarget:zs.TEXTURE,depthStencilTarget:Yi.NONE},{target:At.TEXTURE_2D,wrapMode:$t.CLAMP_TO_EDGE,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:gt.NEAREST,width:1,height:1});function r(b,S){const T=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,C=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,A=e.programCache.acquire(T,C,new Map([["position",0]])),O=new Float32Array(6);FY(b,O,3);const D=new Float32Array(6);return FY(S,D,3),e.useProgram(A),A.setUniform3f("u_highA",O[0],O[2],O[4]),A.setUniform3f("u_lowA",O[1],O[3],O[5]),A.setUniform3f("u_highB",D[0],D[2],D[4]),A.setUniform3f("u_lowB",D[1],D[3],D[5]),A}const s=Ci.createVertex(e,Wi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new Ln(e,new Map([["position",0]]),{geometry:[new ya("position",2,St.UNSIGNED_SHORT,0,4)]},{geometry:s}),o=Ze(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),a=Ze(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),l=r(o,a),c=e.getBoundFramebufferObject(),{x:h,y:p,width:f,height:m}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.bindVAO(n),e.drawArrays(Wt.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);i.readPixels(0,0,1,1,Qe.RGBA,kt.UNSIGNED_BYTE,g),l.dispose(),n.dispose(!1),s.dispose(),i.dispose(),e.setViewport(h,p,f,m),e.bindFramebuffer(c);const y=(o[2]-a[2])/25,x=Kie(g);return Math.abs(y-x)}var Nge,Fge,kge,O3e={exports:{}};function GMt(e){var g,y,x,b,S;if(!e.gl)return!1;if(e.type===Ii.WEBGL1)return!(!((g=e.capabilities.textureFloat)==null?void 0:g.textureFloat)||!((y=e.capabilities.colorBufferFloat)==null?void 0:y.textureFloat));if(!(((x=e.capabilities.textureFloat)==null?void 0:x.textureFloat)&&((b=e.capabilities.colorBufferFloat)==null?void 0:b.textureFloat)&&((S=e.capabilities.colorBufferFloat)==null?void 0:S.floatBlend)))return!1;const t=new ss(e,{colorTarget:zs.TEXTURE,depthStencilTarget:Yi.NONE},{target:At.TEXTURE_2D,wrapMode:$t.CLAMP_TO_EDGE,pixelFormat:Qe.RGBA,dataType:kt.FLOAT,internalFormat:Mt.RGBA32F,samplingMode:gt.NEAREST,width:1,height:1}),i=Ci.createVertex(e,Wi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),r=new Ln(e,new Map([["a_pos",0]]),{geometry:[new ya("a_pos",2,St.UNSIGNED_SHORT,0,4)]},{geometry:i}),s=`
  precision highp float;
  attribute vec2 a_pos;

  void main() {
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,n=`
   precision highp float;

   void main() {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
   }
  `,o=e.programCache.acquire(s,n,new Map([["a_pos",0]]));e.useProgram(o);const a=e.getBoundFramebufferObject(),{x:l,y:c,width:h,height:p}=e.getViewport();e.bindFramebuffer(t),e.setViewport(0,0,1,1),e.bindVAO(r),e.drawArrays(Wt.TRIANGLE_STRIP,0,4);const f=ri({blending:bOe});e.setPipelineState(f),e.drawArrays(Wt.TRIANGLE_STRIP,0,4),O3e.exports.init(e);const m=e.gl.getError();return e.setViewport(l,c,h,p),e.bindFramebuffer(a),o.dispose(),r.dispose(!1),i.dispose(),t.dispose(),m!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}Nge=O3e,Fge=function(){var e=function(y){window.console&&window.console.log&&window.console.log(y)},t=function(y){window.console&&window.console.error?window.console.error(y):e(y)},i={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},r=null,s=null;function n(y){if(r==null)for(var x in r={},s={},y)typeof y[x]=="number"&&(r[y[x]]=x,s[x]=y[x])}function o(){if(r==null)throw"WebGLDebugUtils.init(ctx) not called"}function a(y){return o(),r[y]!==void 0}function l(y){o();var x=r[y];return x!==void 0?"gl."+x:"/*UNKNOWN WebGL ENUM*/ 0x"+y.toString(16)}function c(y,x,b,S){var T;if((T=i[y])!==void 0&&(T=T[x])!==void 0&&T[b]){if(typeof T[b]=="object"&&T[b].enumBitwiseOr!==void 0){for(var C=T[b].enumBitwiseOr,A=0,O=[],D=0;D<C.length;++D){var U=s[C[D]];(S&U)!=0&&(A|=U,O.push(l(U)))}return A===S?O.join(" | "):l(S)}return l(S)}return S===null?"null":S===void 0?"undefined":S.toString()}function h(y,x){for(var b="",S=x.length,T=0;T<S;++T)b+=(T==0?"":", ")+c(y,S,T,x[T]);return b}function p(y,x,b){y.__defineGetter__(b,function(){return x[b]}),y.__defineSetter__(b,function(S){x[b]=S})}function f(y,x,b,S){S=S||y,n(y),x=x||function(U,k,B){for(var j="",H=B.length,K=0;K<H;++K)j+=(K==0?"":", ")+c(k,H,K,B[K]);t("WebGL error "+l(U)+" in "+k+"("+j+")")};var T={};function C(U,k){return function(){b&&b(k,arguments);var B=U[k].apply(U,arguments),j=S.getError();return j!=0&&(T[j]=!0,x(j,k,arguments)),B}}var A={};for(var O in y)if(typeof y[O]=="function")if(O!="getExtension")A[O]=C(y,O);else{var D=C(y,O);A[O]=function(){return f(D.apply(y,arguments),x,b,S)}}else p(A,y,O);return A.getError=function(){for(var U in T)if(T.hasOwnProperty(U)&&T[U])return T[U]=!1,U;return y.NO_ERROR},A}function m(y){var x=y.getParameter(y.MAX_VERTEX_ATTRIBS),b=y.createBuffer();y.bindBuffer(y.ARRAY_BUFFER,b);for(var S=0;S<x;++S)y.disableVertexAttribArray(S),y.vertexAttribPointer(S,4,y.FLOAT,!1,0,0),y.vertexAttrib1f(S,0);y.deleteBuffer(b);var T=y.getParameter(y.MAX_TEXTURE_IMAGE_UNITS);for(S=0;S<T;++S)y.activeTexture(y.TEXTURE0+S),y.bindTexture(y.TEXTURE_CUBE_MAP,null),y.bindTexture(y.TEXTURE_2D,null);for(y.activeTexture(y.TEXTURE0),y.useProgram(null),y.bindBuffer(y.ARRAY_BUFFER,null),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,null),y.bindFramebuffer(y.FRAMEBUFFER,null),y.bindRenderbuffer(y.RENDERBUFFER,null),y.disable(y.BLEND),y.disable(y.CULL_FACE),y.disable(y.DEPTH_TEST),y.disable(y.DITHER),y.disable(y.SCISSOR_TEST),y.blendColor(0,0,0,0),y.blendEquation(y.FUNC_ADD),y.blendFunc(y.ONE,y.ZERO),y.clearColor(0,0,0,0),y.clearDepth(1),y.clearStencil(-1),y.colorMask(!0,!0,!0,!0),y.cullFace(y.BACK),y.depthFunc(y.LESS),y.depthMask(!0),y.depthRange(0,1),y.frontFace(y.CCW),y.hint(y.GENERATE_MIPMAP_HINT,y.DONT_CARE),y.lineWidth(1),y.pixelStorei(y.PACK_ALIGNMENT,4),y.pixelStorei(y.UNPACK_ALIGNMENT,4),y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,!1),y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),y.UNPACK_COLORSPACE_CONVERSION_WEBGL&&y.pixelStorei(y.UNPACK_COLORSPACE_CONVERSION_WEBGL,y.BROWSER_DEFAULT_WEBGL),y.polygonOffset(0,0),y.sampleCoverage(1,!1),y.scissor(0,0,y.canvas.width,y.canvas.height),y.stencilFunc(y.ALWAYS,0,4294967295),y.stencilMask(4294967295),y.stencilOp(y.KEEP,y.KEEP,y.KEEP),y.viewport(0,0,y.canvas.width,y.canvas.height),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT|y.STENCIL_BUFFER_BIT);y.getError(););}function g(y){var x,b,S=[],T=[],C={},A=1,O=!1,D=[],U=0,k=0,B=!1,j=0,H={};function K(J){return typeof J=="function"?J:function(ae){J.handleEvent(ae)}}y.getContext=(b=y.getContext,function(){var J=b.apply(y,arguments);if(J instanceof WebGLRenderingContext){if(J!=x){if(x)throw"got different context";C=se(x=J)}return C}return J});var ee=function(J){S.push(K(J))},ce=function(J){T.push(K(J))};function le(J){var ae=J.addEventListener;J.addEventListener=function(_e,Oe,Be){switch(_e){case"webglcontextlost":ee(Oe);break;case"webglcontextrestored":ce(Oe);break;default:ae.apply(J,arguments)}}}function z(){for(var J=Object.keys(H),ae=0;ae<J.length;++ae)delete H[J]}function q(){++k,O||U==k&&y.loseContext()}function Z(J,ae){var _e=J[ae];return function(){if(q(),!O)return _e.apply(J,arguments)}}function Y(){for(var J=0;J<D.length;++J){var ae=D[J];ae instanceof WebGLBuffer?x.deleteBuffer(ae):ae instanceof WebGLFramebuffer?x.deleteFramebuffer(ae):ae instanceof WebGLProgram?x.deleteProgram(ae):ae instanceof WebGLRenderbuffer?x.deleteRenderbuffer(ae):ae instanceof WebGLShader?x.deleteShader(ae):ae instanceof WebGLTexture&&x.deleteTexture(ae)}}function te(J){return{statusMessage:J,preventDefault:function(){B=!0}}}return le(y),y.loseContext=function(){if(!O){for(O=!0,U=0,++A;x.getError(););z(),H[x.CONTEXT_LOST_WEBGL]=!0;var J=te("context lost"),ae=S.slice();setTimeout(function(){for(var _e=0;_e<ae.length;++_e)ae[_e](J);j>=0&&setTimeout(function(){y.restoreContext()},j)},0)}},y.restoreContext=function(){O&&T.length&&setTimeout(function(){if(!B)throw"can not restore. webglcontestlost listener did not call event.preventDefault";Y(),m(x),O=!1,k=0,B=!1;for(var J=T.slice(),ae=te("context restored"),_e=0;_e<J.length;++_e)J[_e](ae)},0)},y.loseContextInNCalls=function(J){if(O)throw"You can not ask a lost contet to be lost";U=k+J},y.getNumCalls=function(){return k},y.setRestoreTimeout=function(J){j=J},y;function se(J){for(var ae in J)typeof J[ae]=="function"?C[ae]=Z(J,ae):p(C,J,ae);C.getError=function(){if(q(),!O)for(;Ie=x.getError();)H[Ie]=!0;for(var Ie in H)if(H[Ie])return delete H[Ie],Ie;return C.NO_ERROR};for(var _e=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],Oe=0;Oe<_e.length;++Oe){var Be=_e[Oe];C[Be]=function(Ie){return function(){if(q(),O)return null;var Ve=Ie.apply(J,arguments);return Ve.__webglDebugContextLostId__=A,D.push(Ve),Ve}}(J[Be])}var Se=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(Oe=0;Oe<Se.length;++Oe)Be=Se[Oe],C[Be]=function(Ie){return function(){return q(),O?null:Ie.apply(J,arguments)}}(C[Be]);var Te=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(Oe=0;Oe<Te.length;++Oe)Be=Te[Oe],C[Be]=function(Ie){return function(){return q(),!O&&Ie.apply(J,arguments)}}(C[Be]);return C.checkFramebufferStatus=function(Ie){return function(){return q(),O?C.FRAMEBUFFER_UNSUPPORTED:Ie.apply(J,arguments)}}(C.checkFramebufferStatus),C.getAttribLocation=function(Ie){return function(){return q(),O?-1:Ie.apply(J,arguments)}}(C.getAttribLocation),C.getVertexAttribOffset=function(Ie){return function(){return q(),O?0:Ie.apply(J,arguments)}}(C.getVertexAttribOffset),C.isContextLost=function(){return O},C}}return{init:n,mightBeEnum:a,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:h,makeDebugContext:f,makeLostContextSimulatingCanvas:g,resetToInitialState:m}},(kge=Fge())!==void 0&&(Nge.exports=kge);const jMt=ve.getLogger("esri.views.WebGLDriverTest");function HMt(e){const t=new ss(e,{colorTarget:zs.TEXTURE,depthStencilTarget:Yi.NONE},{target:At.TEXTURE_2D,wrapMode:$t.CLAMP_TO_EDGE,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:gt.NEAREST,width:1,height:1}),i=`
precision highp float;
attribute vec2 a_pos;
uniform highp sampler2D u_texture;
varying vec4 v_color;

float getBit(in float bitset, in int bitIndex) {
  float offset = pow(2.0, float(bitIndex));
  return mod(floor(bitset / offset), 2.0);
}

void main() {
  vec4 value = texture2D(u_texture, vec2(0.0));
  float bit = getBit(value.x * 255.0, 1);

  v_color = bit * vec4(1.0);
  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
}
`,r=`
precision highp float;
varying vec4 v_color;

void main() {
  gl_FragColor = v_color;
}
`,s=new Uint8Array(4),n=Ci.createVertex(e,Wi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Ln(e,new Map([["a_position",0]]),{geometry:[new ya("a_position",2,St.SHORT,0,4)]},{geometry:n}),a=e.programCache.acquire(i,r,new Map([["a_pos",0]]));e.useProgram(a);const l=new _t(e,{target:At.TEXTURE_2D,wrapMode:$t.CLAMP_TO_EDGE,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:gt.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));a.setUniform1i("u_texture",0),e.bindTexture(l,0);const c=e.getBoundFramebufferObject();e.bindFramebuffer(t),e.useProgram(a);const{x:h,y:p,width:f,height:m}=e.getViewport();e.setViewport(0,0,1,1),e.bindVAO(o),e.drawArrays(Wt.TRIANGLE_STRIP,0,4),e.setViewport(h,p,f,m),t.readPixels(0,0,1,1,Qe.RGBA,kt.UNSIGNED_BYTE,s),a.dispose(),o.dispose(!1),n.dispose(),t.dispose();const g=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return g&&jMt.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),e.bindFramebuffer(c),g}new ya("a_pos",2,St.BYTE,0,2);new ya("a_pos",2,St.BYTE,0,4),new ya("a_tex",2,St.BYTE,2,4);const qMt={geometry:[new ya("a_pos",2,St.UNSIGNED_SHORT,0,4)]};async function WMt(e){const t=new Image;if(t.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",t.width=5,t.height=5,await t.decode(),!e.gl)return!0;const i=new ss(e,{colorTarget:zs.TEXTURE,depthStencilTarget:Yi.NONE},{target:At.TEXTURE_2D,wrapMode:$t.CLAMP_TO_EDGE,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:gt.NEAREST,width:1,height:1}),r=Ci.createVertex(e,Wi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Ln(e,new Map([["a_pos",0]]),qMt,{geometry:r}),n=`
  precision highp float;

  attribute vec2 a_pos;
  varying vec2 v_uv;

  void main() {
    v_uv = a_pos;
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,o=`
  precision highp float;

  varying vec2 v_uv;
  uniform sampler2D u_texture;

  void main() {
    gl_FragColor = texture2D(u_texture, v_uv);
  }
  `,a=e.programCache.acquire(n,o,new Map([["a_pos",0]]));e.useProgram(a);const l=new _t(e,{dataType:kt.UNSIGNED_BYTE,pixelFormat:Qe.RGBA,preMultiplyAlpha:!1,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:gt.LINEAR},t);e.bindTexture(l,0),a.setUniform1i("u_texture",0);const c=e.getBoundFramebufferObject(),{x:h,y:p,width:f,height:m}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.setClearColor(0,0,0,0),e.setBlendingEnabled(!1),e.clearSafe(wr.COLOR_BUFFER_BIT),e.bindVAO(s),e.drawArrays(Wt.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);return i.readPixels(0,0,1,1,Qe.RGBA,kt.UNSIGNED_BYTE,g),a.dispose(),s.dispose(!1),r.dispose(),i.dispose(),l.dispose(),e.setViewport(h,p,f,m),e.bindFramebuffer(c),t.src="",g[0]===255}class ZMt{constructor(t){this.context=t,this._floatBufferBlendWorking=GMt(t),WMt(t).then(i=>this._svgAlwaysPremultipliesAlpha=!i)}get floatBufferBlendWorking(){if(M(this._floatBufferBlendWorking))throw new Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}get svgAlwaysPremultipliesAlpha(){if(M(this._svgAlwaysPremultipliesAlpha))throw new Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}get doublePrecisionRequiresObfuscation(){if(M(this._doublePrecisionRequiresObfuscation)){const t=Dge(this.context,!1),i=Dge(this.context,!0);this._doublePrecisionRequiresObfuscation=t!==0&&(i===0||t/i>5)}return this._doublePrecisionRequiresObfuscation}get ignoresSamplerPrecision(){return M(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=HMt(this.context)),this._ignoresSamplerPrecision}}class Uge{constructor(t,i,r,s,n,o,a,l){this.createQuery=t,this.resultAvailable=i,this.getResult=r,this.disjoint=s,this.beginTimeElapsed=n,this.endTimeElapsed=o,this.createTimestamp=a,this.timestampBits=l}}function XMt(e,t){if(t.disjointTimerQuery)return null;let i=e.getExtension("EXT_disjoint_timer_query_webgl2");return i&&Lo(e)?new Uge(()=>e.createQuery(),r=>e.getQueryParameter(r,e.QUERY_RESULT_AVAILABLE),r=>e.getQueryParameter(r,e.QUERY_RESULT),()=>e.getParameter(i.GPU_DISJOINT_EXT),r=>e.beginQuery(i.TIME_ELAPSED_EXT,r),()=>e.endQuery(i.TIME_ELAPSED_EXT),r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=e.getExtension("EXT_disjoint_timer_query"),i?new Uge(()=>i.createQueryEXT(),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>e.getParameter(i.GPU_DISJOINT_EXT),r=>i.beginQueryEXT(i.TIME_ELAPSED_EXT,r),()=>i.endQueryEXT(i.TIME_ELAPSED_EXT),r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function YMt(e,t){if(t.disjointTimerQuery)return null;if(Lo(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const i=e.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function JMt(e){if(Lo(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}function QMt(e,t){if(t.compressedTextureETC)return null;const i=e.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function KMt(e,t){if(t.compressedTextureS3TC)return null;const i=e.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function eOt(e,t){if(Lo(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const i=e.getExtension("EXT_blend_minmax");return i?{MIN:i.MIN_EXT,MAX:i.MAX_EXT}:null}}function tOt(e,t){if(t.textureFilterAnisotropic)return null;const i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function iOt(e,t){if(Lo(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:e.HALF_FLOAT,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F};if(e instanceof WebGLRenderingContext){const i=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}function rOt(e,t){if(Lo(e)){const i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float")||!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float"),r=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}function YR(e,t,i,r,s){if(r&&Lo(e))return!0;if(t[i])return!1;for(const n of s)if(e.getExtension(n))return!0;return!1}function sOt(e,t){if(!Lo(e)||t.textureNorm16)return null;const i=e.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function nOt(e,t){const i=t.loseContext&&e.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}function oOt(e,t){if(Lo(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const i=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}class aOt{constructor(t,i){this.gl=t,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=YMt(this.gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=JMt(this.gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=oOt(this.gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=QMt(this.gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=KMt(this.gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=tOt(this.gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=XMt(this.gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=iOt(this.gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=rOt(this.gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=eOt(this.gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=YR(this.gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=YR(this.gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=YR(this.gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=YR(this.gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=nOt(this.gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=sOt(this.gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=YR(this.gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(t){return this[t]}}class lOt{constructor(t,i){this.gl=t,this.instanceCounter=new vMt,this.programCache=new BMt(this),this._state=new Tge,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=Lo(t)?Ii.WEBGL2:Ii.WEBGL1,this._loadExtensions(),this.configure(i)}configure(t){this._capabilities=new aOt(this.gl,t),this._parameters=this._loadParameters(t);const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new Tge,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new qst({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)}}),this.enforceState(),this._driverTest=new ZMt(this)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}dispose(){this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Lt.ARRAY_BUFFER),this.unbindBuffer(Lt.ELEMENT_ARRAY_BUFFER),Lo(this.gl)&&(this.unbindBuffer(Lt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Lt.PIXEL_PACK_BUFFER),this.unbindBuffer(Lt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Lt.COPY_READ_BUFFER),this.unbindBuffer(Lt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,Wd()&&this.instanceCounter.printResourceCount()}setPipelineState(t){this._stateTracker.setPipeline(t)}setBlendingEnabled(t){this._state.blend!==t&&(t===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=t,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var t;(t=this._state.program)==null||t.stop(),this._state.program=null}externalTextureUnitUpdate(t,i){for(let r=0;r<t.length;++r)this._state.textureUnitMap[t[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){const t=this.capabilities.vao;t&&(t.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(t,i,r,s){t===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(t,i,r,s),this._state.blendColor.r=t,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(t,i){t===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(t,i),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=t,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(t,i,r,s){this._state.blendFunction.srcRGB===t&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(t,i,r,s),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(t){this._state.blendEquation.mode!==t&&(this.gl.blendEquation(t),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(t,i){this._state.blendEquation.mode===t&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(t,i),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(t,i,r,s){this._state.colorMask.r===t&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(t,i,r,s),this._state.colorMask.r=t,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(t,i,r,s){this._state.clearColor.r===t&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(t,i,r,s),this._state.clearColor.r=t,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(t){this._state.faceCulling!==t&&(t===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=t,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(t){this._state.polygonOffsetFill!==t&&(t===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=t,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(t,i){this._state.polygonOffset[0]===t&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=t,this._state.polygonOffset[1]=i,this.gl.polygonOffset(t,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(t){this._state.cullFace!==t&&(this.gl.cullFace(t),this._state.cullFace=t,this._stateTracker.invalidateCulling())}setFrontFace(t){this._state.frontFace!==t&&(this.gl.frontFace(t),this._state.frontFace=t,this._stateTracker.invalidateCulling())}setScissorTestEnabled(t){this._state.scissorTest!==t&&(t===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=t)}setScissorRect(t,i,r,s){this._state.scissorRect.x===t&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(t,i,r,s),this._state.scissorRect.x=t,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(t){this._state.depthTest!==t&&(t===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=t,this._stateTracker.invalidateDepthTest())}setClearDepth(t){this._state.clearDepth!==t&&(this.gl.clearDepth(t),this._state.clearDepth=t)}setDepthFunction(t){this._state.depthFunction!==t&&(this.gl.depthFunc(t),this._state.depthFunction=t,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(t){this._state.depthWrite!==t&&(this.gl.depthMask(t),this._state.depthWrite=t,this._stateTracker.invalidateDepthWrite())}setDepthRange(t,i){this._state.depthRange.zNear===t&&this._state.depthRange.zFar===i||(this.gl.depthRange(t,i),this._state.depthRange.zNear=t,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(t){this._state.stencilTest!==t&&(t===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=t,this._stateTracker.invalidateStencilTest())}setClearStencil(t){t!==this._state.clearStencil&&(this.gl.clearStencil(t),this._state.clearStencil=t)}setStencilFunction(t,i,r){this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(t,i,r),this._state.stencilFunction.face=zf.FRONT_AND_BACK,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(t,i,r,s){this._state.stencilFunction.face===t&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(t,i,r,s),this._state.stencilFunction.face=t,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(t){this._state.stencilWriteMask!==t&&(this.gl.stencilMask(t),this._state.stencilWriteMask=t,this._stateTracker.invalidateStencilWrite())}setStencilOp(t,i,r){this._state.stencilOperation.face===zf.FRONT_AND_BACK&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(t,i,r),this._state.stencilOperation.face=zf.FRONT_AND_BACK,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(t,i,r,s){this._state.stencilOperation.face===t&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(t,i,r,s),this._state.stencilOperation.face=t,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(t,i=!1){const r=this._state.activeTexture;return t>=0&&(i||t!==this._state.activeTexture)&&(this.gl.activeTexture(rj+t),this._state.activeTexture=t),r}clear(t){t&&this.gl.clear(t)}clearSafe(t,i=255){t&&(t&wr.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),t&wr.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),t&wr.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(t))}drawArrays(t,i,r){if(Wd()&&(this._numOfDrawCalls++,this._numOfTriangles+=zge(t,r)),this.gl.drawArrays(t,i,r),Wd()){const s=ihe(this);s&&console.error("drawArrays:",s)}}drawElements(t,i,r,s){var n;if(Wd()&&(this._numOfDrawCalls++,this._numOfTriangles+=zge(t,i)),this.gl.drawElements(t,i,r,s),Wd()){const o=ihe(this);if(o){const a=this.getBoundVAO(),l=a==null?void 0:a.indexBuffer,c=a==null?void 0:a.vertexBuffers,h={indexBuffer:l,vertexBuffers:c},p={mode:t,count:i,type:r,offset:s},f=(n=wt(l,y=>y.size))!=null?n:0,m=s+i,g=f<m?`. Buffer is too small. Attempted to draw index ${m} of ${f}`:"";console.error(`drawElements: ${o}${g}`,{args:p,vao:h})}}}logInfo(){Wd()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){Wd()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(t,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===t&&n.y===i&&n.width===r&&n.height===s||(n.x=t,n.y=i,n.width=r,n.height=s,this.gl.viewport(t,i,r,s))}getViewport(){return{x:this._state.viewport.x,y:this._state.viewport.y,width:this._state.viewport.width,height:this._state.viewport.height}}useProgram(t){var i,r;this._state.program!==t&&((i=this._state.program)==null||i.stop(),this._state.program=t,this.gl.useProgram((r=t==null?void 0:t.glName)!=null?r:null))}bindTexture(t,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return M(t)||t.glName==null?(_(s)&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==t?(this.setActiveTexture(i,r),this.gl.bindTexture(t.descriptor.target,t.glName),t.applyChanges(),this._state.textureUnitMap[i]=t,s):(t.isDirty&&(this.setActiveTexture(i,r),t.applyChanges()),s)}unbindTexture(t){if(!M(t))for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===t&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(t,i=!1){if(i||this._state.readFramebuffer!==t||this._state.drawFramebuffer!==t){if(M(t))return this.gl.bindFramebuffer(Oo.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);t.initializeAndBind(Oo.FRAMEBUFFER),this._state.readFramebuffer=t,this._state.drawFramebuffer=t}}bindFramebufferSeparate(t,i,r=!1){const s=i===Oo.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==t)&&(M(t)?this.gl.bindFramebuffer(i,null):t.initializeAndBind(i),s?this._state.readFramebuffer=Ye(t,null):this._state.drawFramebuffer=Ye(t,null))}blitFramebuffer(t,i,r=0,s=0,n=t.width,o=t.height,a=0,l=0,c=i.width,h=i.height,p=wr.COLOR_BUFFER_BIT,f=gt.NEAREST){this.bindFramebufferSeparate(t,Oo.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,Oo.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,s,n,o,a,l,c,h,p,f)}bindBuffer(t,i){if(t)switch(i!=null||(i=t.bufferType),i){case Lt.ARRAY_BUFFER:this._state.vertexBuffer=eu(this.gl,t,i,this._state.vertexBuffer);break;case Lt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=eu(this.gl,t,i,this._state.indexBuffer);break;case Lt.UNIFORM_BUFFER:this._state.uniformBuffer=eu(this.gl,t,i,this._state.uniformBuffer);break;case Lt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=eu(this.gl,t,i,this._state.pixelPackBuffer);break;case Lt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=eu(this.gl,t,i,this._state.pixelUnpackBuffer);break;case Lt.COPY_READ_BUFFER:this._state.copyReadBuffer=eu(this.gl,t,i,this._state.copyReadBuffer);break;case Lt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=eu(this.gl,t,i,this._state.copyWriteBuffer)}}bindRenderbuffer(t){const i=this.gl;t||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==t&&(i.bindRenderbuffer(i.RENDERBUFFER,t.glName),this._state.renderbuffer=t)}_getBufferBinding(t,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=this._state.uniformBufferBindingPoints;let s=r[i];return M(s)&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(t,i,r){const s=this._getBufferBinding(t,i);M(s)||s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(t,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0)}bindBufferRange(t,i,r,s,n){const o=this._getBufferBinding(t,i);if(!M(o)&&!(o.buffer===r&&o.offset===s&&o.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(t,i,r.glName,s,n),o.buffer=r,o.offset=s,o.size=n}}bindUBO(t,i,r,s){M(i)?this.bindBufferBase(Lt.UNIFORM_BUFFER,t,null):(Wd()&&(s!=null?s:i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(Lt.UNIFORM_BUFFER,t,i.buffer,r,s):this.bindBufferBase(Lt.UNIFORM_BUFFER,t,i.buffer))}unbindUBO(t){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];_(s)&&s.buffer===t.buffer&&this.bindBufferBase(Lt.UNIFORM_BUFFER,i,null)}}unbindBuffer(t){switch(t){case Lt.ARRAY_BUFFER:this._state.vertexBuffer=eu(this.gl,null,t,this._state.vertexBuffer);break;case Lt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=eu(this.gl,null,t,this._state.indexBuffer);break;case Lt.UNIFORM_BUFFER:this._state.uniformBuffer=eu(this.gl,null,t,this._state.uniformBuffer);break;case Lt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=eu(this.gl,null,t,this._state.pixelPackBuffer);break;case Lt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=eu(this.gl,null,t,this._state.pixelUnpackBuffer);break;case Lt.COPY_READ_BUFFER:this._state.copyReadBuffer=eu(this.gl,null,t,this._state.copyReadBuffer);break;case Lt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=eu(this.gl,null,t,this._state.copyWriteBuffer)}}bindVAO(t=null){M(t)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==t&&(t.bind(),this._state.vertexArrayObject=t)}async clientWaitAsync(t=10){const i=this.gl,r=i.fenceSync(AY.SYNC_GPU_COMMANDS_COMPLETE,0);let s;this.instanceCounter.increment(co.Sync,r),i.flush();do await nS(t),s=i.clientWaitSync(r,0,0);while(s===wz.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(co.Sync,r),i.deleteSync(r),s===wz.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(t=Oo.FRAMEBUFFER){return t===Oo.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Lt.ARRAY_BUFFER),this.unbindBuffer(Lt.ELEMENT_ARRAY_BUFFER),Lo(this.gl)&&(this.unbindBuffer(Lt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Lt.PIXEL_PACK_BUFFER),this.unbindBuffer(Lt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Lt.COPY_READ_BUFFER),this.unbindBuffer(Lt.COPY_WRITE_BUFFER));for(let t=0;t<this.parameters.maxTextureImageUnits;++t)this.bindTexture(null,t);this.setBlendingEnabled(!1),this.setBlendFunction(ke.ONE,ke.ZERO),this.setBlendEquation(xv.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(zf.BACK),this.setFrontFace(mM.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Fr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Fr.ALWAYS,0,0),this.setStencilOp(Vs.KEEP,Vs.KEEP,Vs.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var r,s,n,o,a,l;const t=this.gl,i=this.capabilities.vao;i&&i.bindVertexArray(null);for(let c=0;c<this.parameters.maxVertexAttributes;c++)t.disableVertexAttribArray(c);if(this._state.vertexBuffer?t.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):t.bindBuffer(Lt.ARRAY_BUFFER,null),this._state.indexBuffer?t.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):t.bindBuffer(Lt.ELEMENT_ARRAY_BUFFER,null),Lo(t)){this._state.uniformBuffer?t.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):t.bindBuffer(Lt.UNIFORM_BUFFER,null);for(let c=0;c<this._parameters.maxUniformBufferBindings;c++){const h=this._state.uniformBufferBindingPoints[c];if(_(h)){const{buffer:p,offset:f,size:m}=h;p!==null?f===0&&m===0?t.bindBufferBase(Lt.UNIFORM_BUFFER,c,p.glName):t.bindBufferRange(Lt.UNIFORM_BUFFER,c,p.glName,f,m):t.bindBufferBase(Lt.UNIFORM_BUFFER,c,null)}}this._state.pixelPackBuffer?t.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):t.bindBuffer(Lt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?t.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):t.bindBuffer(Lt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?t.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):t.bindBuffer(Lt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?t.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):t.bindBuffer(Lt.COPY_WRITE_BUFFER,null),t.bindFramebuffer(Oo.READ_FRAMEBUFFER,null),t.readBuffer(t.BACK),this._state.readFramebuffer&&(t.bindFramebuffer(Oo.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),t.readBuffer(Eh.COLOR_ATTACHMENT0)),t.bindFramebuffer(Oo.DRAW_FRAMEBUFFER,(s=(r=this._state.drawFramebuffer)==null?void 0:r.glName)!=null?s:null)}else this._state.readFramebuffer=this._state.drawFramebuffer,t.bindFramebuffer(Oo.FRAMEBUFFER,(o=(n=this._state.drawFramebuffer)==null?void 0:n.glName)!=null?o:null);if(i&&this._state.vertexArrayObject){const c=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(c)}t.useProgram((l=(a=this._state.program)==null?void 0:a.glName)!=null?l:null),t.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),t.bindRenderbuffer(t.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?t.enable(this.gl.BLEND):t.disable(this.gl.BLEND),t.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),t.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),t.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),t.clearDepth(this._state.clearDepth),t.clearStencil(this._state.clearStencil),t.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),t.cullFace(this._state.cullFace),t.depthFunc(this._state.depthFunction),t.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthMask(this._state.depthWrite),t.frontFace(this._state.frontFace),t.lineWidth(1),this._state.faceCulling===!0?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),t.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),t.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),t.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),t.stencilMask(this._state.stencilWriteMask);for(let c=0;c<this.parameters.maxTextureImageUnits;c++){t.activeTexture(rj+c),t.bindTexture(At.TEXTURE_2D,null),t.bindTexture(At.TEXTURE_CUBE_MAP,null),Lo(t)&&(t.bindTexture(At.TEXTURE_3D,null),t.bindTexture(At.TEXTURE_2D_ARRAY,null));const h=this._state.textureUnitMap[c];_(h)&&t.bindTexture(h.descriptor.target,h.glName)}t.activeTexture(rj+this._state.activeTexture),t.viewport(this._state.viewport.x,this._state.viewport.y,this._state.viewport.width,this._state.viewport.height),this.resetInfo()}_loadExtensions(){this.type===Ii.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(t){var a;const i=this.capabilities.textureFilterAnisotropic,r=(a=t.maxAnisotropy)!=null?a:1/0,s=Lo(this.gl),n=this.gl,o={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:i?Math.min(this.gl.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY),r):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:s?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:s?n.getParameter(n.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:s?n.getParameter(n.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:s?n.getParameter(n.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:s?n.getParameter(n.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:s?n.getParameter(n.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:s?n.getParameter(n.MAX_SAMPLES):1};return _t.TEXTURE_UNIT_FOR_UPDATES=o.maxTextureImageUnits-1,o}}function eu(e,t,i,r){return t?r!==t&&e.bindBuffer(i,t.glName):e.bindBuffer(i,null),t}function zge(e,t){switch(e){case Wt.POINTS:return 2*t;case Wt.TRIANGLES:return t/3;case Wt.TRIANGLE_STRIP:case Wt.TRIANGLE_FAN:return t-2;default:return 0}}class cOt extends lOt{constructor(t,i,r){super(t,i),this.newCache=r,this._refCount=1}dispose(){--this._refCount>0||super.dispose()}ref(){++this._refCount}bindTechnique(t,i,r,s){this.useProgram(t.program);const n=_(r)?r.slot:null;return t.bindPipelineState(this,n,s),_(i)&&_(r)&&t.bindPass(i,r),t.program}get test(){return this.programCache.test}}const R3e=ve.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");let vC=class extends Ee{constructor(e,t,i){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new cs,this._frameTask=e.resourceController.scheduler.registerTask(Ot.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}dispose(){this._frameTask.remove(),this._stage.forEachOfType(um.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return M(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(QL,new bre)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),Ye(t.loadingPromise,t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(t=>{const i=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);i>=0&&i!==t.previousToken&&(t.previousToken=i,e=!0)}),e&&this.events.emit("changed",An.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(M(t))return Ct(t!==void 0),null;const i=t.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),r=new uOt(e,()=>{this._frameTask.schedule(()=>{r.isUnreferenced&&t.unload()})});return this._textures.set(e,r),r.ref(),_(t.glTexture)?(this._updateGLTexture(r,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r):(this._loadingCount++,r.loadingPromise=this._stage.schedule(()=>{const s=t.load(this._rctx,()=>this.textureTechnique),n=a=>(this._loadingCount--,r.loadingPromise=null,this._updateGLTexture(r,a),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r),o=a=>(this._loadingCount--,r.loadingPromise=null,as(a)||R3e.error(a),null);return qu(s)?s.then(n,o):n(s)}),r.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",An.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([d()],vC.prototype,"_loadingCount",void 0),u([d()],vC.prototype,"_frameTask",void 0),u([d()],vC.prototype,"updating",null),vC=u([L("esri.views.3d.webgl-engine.lib.TextureRepository")],vC);class uOt{constructor(t,i){this.id=t,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(R3e.error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}const hOt=ve.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");let wI=class extends Ee{constructor(){super(...arguments),this._data=new Array,this._state=Tu.NOT_LOADED}dispose(){this._state=Tu.NOT_LOADED,this._data.forEach(e=>e.dispose()),this._data.length=0}get updating(){return this._state===Tu.LOADING}get resourceState(){return this._state}loadTextures(e){const t=[ji("esri/images/materials/water/normals.jpg"),ji("esri/images/materials/water/perturbation.jpg")];this._state=Tu.LOADING,Promise.all(t.map(i=>lm(i))).then(i=>{i.forEach(r=>this._data.push(new _t(e,{target:At.TEXTURE_2D,pixelFormat:Qe.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.REPEAT,samplingMode:gt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8,width:r.width,height:r.height},r))),this._state=Tu.LOADED}).catch(i=>{hOt.error("Failed to load textures for water material.",i),this._state=Tu.NOT_LOADED})}bind(e){this._state===Tu.LOADED&&(e.bindTexture("texWaveNormal",this._data[0]),e.bindTexture("texWavePerturbation",this._data[1]))}};u([d()],wI.prototype,"_state",void 0),u([d({type:Boolean,readOnly:!0})],wI.prototype,"updating",null),wI=u([L("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],wI);class dOt extends B6{constructor(t,i,r,s,n,o){super(),this._rctx=t,this._renderScene=i,this._requestRenderScene=r,this._renderOverlay=s,this._forceCameraHook=n,this._disposeOffscreenBuffers=o,this.supersample=!0,this._screenshotQueue=new Array}dispose(){this._rctx=null}takeScreenshot(t){this._requestRenderScene(An.BACKGROUND);const i=rm();return this._screenshotQueue.push({settings:t,resolver:i}),i.promise}update(t){for(const i of this._screenshotQueue){if(this.isDisposed){i.resolver.reject();continue}const r=me(F({},i.settings),{pixelRatio:i.settings.pixelRatio*t.viewCamera.pixelRatio}),s=this._renderScreenshot(t,r);i.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(t,i,r){if(M(this._renderOverlay))return i;t.width=i.width,t.height=i.height;const s=t.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderOverlay(t,i),s.restore(),i}_readbackScreenshot(t,i){return t.resample?this._readbackScreenshotResampled(t,i):this._readbackScreenshotImmediate(t,i)}_readbackScreenshotResampled(t,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:o}=t,a=this._ensureScreenshotEncodeCanvas();let l=m7(r,s,a);this._rctx.gl.readPixels(0,0,r,s,Qe.RGBA,St.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,me(F({},t),{region:null}));const c=m7(n.width,n.height,a);return m0t(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(t,i){const{framebufferHeight:r,region:s}=t,n=this._ensureScreenshotEncodeCanvas(),o=m7(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,Qe.RGBA,St.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(n,o,t)}_renderScreenshot(t,i){let r=null;const s=t.viewCamera,{framebufferWidth:n,framebufferHeight:o}=i;let a=!1;const l=i.disableDecorations&&t.frameHasDecorations,c=n!==s.fullWidth||o!==s.fullHeight,h=i.ignorePadding&&s.pixelRatio!==i.pixelRatio,p=c||l||h;if(p){const g=s.clone();if(i.ignorePadding){const b=gB(g.padding);for(let S=0;S<4;S++)b[S]=Math.round(b[S]/g.pixelRatio*i.pixelRatio);g.padding=b}g.fullWidth=n,g.fullHeight=o,g.pixelRatio=i.pixelRatio;const y=s.fovX-g.fovX,x=s.fovY-g.fovY;y<0&&y<x?g.fovX=s.fovX:x<0&&x<y&&(g.fovY=s.fovY),this._forceCameraHook(g),a=!0,r=new ss(this._rctx,{width:g.fullWidth,height:g.fullHeight,colorTarget:zs.TEXTURE,depthStencilTarget:Yi.DEPTH_STENCIL_RENDER_BUFFER}),this._renderScene(r,g,i.disableDecorations?TS.OFF:TS.ON),this._disposeOffscreenBuffers()}const f=()=>{this._rctx.bindFramebuffer(null),ht(r)},m=this._readbackScreenshot(i,f);if(f(),p&&!this._rctx.contextAttributes.alpha)for(let g=3;g<m.data.length;g+=4)m.data[g]=255;return a&&this._forceCameraHook(s),m}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}const Vge=ve.getLogger("esri.views.3d.webgl-engine.parts.View");let Ma=class extends V6(Ee){constructor(e){super({}),this.events=new cs,this.waterTextureRepository=new wI,this._magnifierHelper=new yC,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),re(()=>{var t;return(t=this.waterTextureRepository)==null?void 0:t.updating},()=>this.requestRender(),Et),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new LRe(this._rctx),this._shaderTechniqueRepository=new rRe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new vC(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",t=>this.requestRender(t)),this._materialRepository=new sRe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new ECt(this._rctx,this._shaderTechniqueRepository),this._renderer=new p0(this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,t=>this.requestRender(t),(t,i)=>e.schedule(t,i),e),this._screenshotManager=new dOt(this._rctx,(t,i,r)=>this._renderer.render(t,i,i,r),t=>this.requestRender(t),e.options.screenshot.renderOverlay,t=>this.events.emit("force-camera-for-screenshot",t),()=>this._renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}dispose(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=hn(this._frameTask),this._shaderTechniqueRepository=ht(this._shaderTechniqueRepository),super.dispose(),this._tmpDepthBuffer=null,this._rctx=null}get performanceInfo(){const e=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=An.UPDATE){e===An.UPDATE?this._needsUpdate=!0:this._needsRender=!0}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}ensureEdgeView(){return this._renderer.ensureEdgeView()}get edgeView(){return this._renderer.edgeView}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}updateLightSources(e,t,i){this._renderer.updateLightSources(e,t,i),this.requestRender()}setRenderParameters(e){e.idleSuspend!==void 0&&this._idleSuspend!==!!e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend,this.requestRender()),this._renderer.setRenderParameters(e)}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}modify(e){this._renderer.modify(e),e.clear()}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e)}getAlpha(){return this._rctx.contextAttributes.alpha}get shadowsEnabled(){return this._renderer.shadowsEnabled}readAccumulatedShadow(e){return this._renderer.readAccumulatedShadow(e[0],e[1])}readHUDVisibility(e,t,i,r,s){this._renderer.readHUDVisibility(e,t,i,r,s)}getMinimalDepthForArea(e,t,i,r,s,n=s){const o=r.constrainWindowSize(t,i,s*r.pixelRatio,n*r.pixelRatio),a=this._ensureDepthBuffer(o);this._renderer.readDepthPixels(r,o,a);let l=Number.MAX_VALUE;for(let c=0;c<o[2]*o[3];c++){const h=RCt(4*c,a,r.nearFar);l>h&&h!==r.nearFar[0]&&h!==r.nearFar[1]&&(l=h)}if(_(e)){const c=e.pickDepth(t*r.pixelRatio,i*r.pixelRatio,r);_(c)&&l>c&&c!==r.nearFar[0]&&c!==r.nearFar[1]&&(l=c)}return l===Number.MAX_VALUE?void 0:l}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(M(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}get renderPlugins(){return this._renderer.renderPlugins}get test(){return{renderer:this._renderer}}get gpuMemoryUsage(){return this._renderer.gpuMemoryUsage}async reloadShaders(){cIe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}get animationTimestep(){return this._renderer.animationTimestep}_registerFrameTask(e){const t=e.state,i={viewCamera:t.camera,frameHasDecorations:!1};let r=!1,s=An.BACKGROUND,n=!1;const o={preRender:a=>{r=this.updating,s=this._needsUpdate?An.UPDATE:An.BACKGROUND,e.processSyncLayers();const l=a.time-this._lastAnimationUpdate;(l>this.animationTimestep||_(this.forcedAnimationTime)||r||this._needsRender)&&(this._renderer.updateAnimation({camera:t.camera,dt:l,forcedTime:this.forcedAnimationTime})&&this.requestRender(An.BACKGROUND),this._lastAnimationUpdate=a.time)},render:()=>{if((this._needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const a=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this._renderer.render(null,t.camera,t.contentCamera,TS.ON),n=!0,a&&this._renderer.hasWaterReflection&&(this.requestRender(An.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:()=>{i.viewCamera=t.camera,i.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled,this._textureRepository.update(),this._screenshotManager.update(i)},finish:()=>{n&&(this._renderer.finish(s),n=!1)}};this._frameTask=aS(o)}_initializeContext(e){var s;const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil==null||t.stencil,powerPreference:"high-performance",preserveDrawingBuffer:(s=t.preserveDrawingBuffer)!=null?s:!1},r=Wst("3d",this._canvas,i);if(M(r)){const n=ye("esri-force-webgl");Vge.error(n)}else this._rctx=this._newRenderingContext(r,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&Vge.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&ye("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,t){const i={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8},r=(s,n)=>t.resourceController.memoryController.newCache(s,n);return new cOt(e,i,r)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}get componentObjectCollection(){return M(this._componentObjectCollection)&&(this._componentObjectCollection=new wCt(this._renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([d({type:Boolean,readOnly:!0})],Ma.prototype,"updating",null),u([Pa()],Ma.prototype,"_rctx",void 0),u([Pa()],Ma.prototype,"_container",void 0),u([Pa()],Ma.prototype,"_canvas",void 0),u([Pa()],Ma.prototype,"_stippleTextureRepository",void 0),u([Pa(),d()],Ma.prototype,"waterTextureRepository",void 0),u([Pa(),d()],Ma.prototype,"_magnifierHelper",void 0),u([Pa(),d()],Ma.prototype,"_textureRepository",void 0),u([Pa()],Ma.prototype,"_compositingHelper",void 0),u([Pa()],Ma.prototype,"_renderer",void 0),u([Pa()],Ma.prototype,"_screenshotManager",void 0),u([Pa()],Ma.prototype,"componentObjectCollection",null),u([Pa()],Ma.prototype,"_componentObjectCollection",void 0),u([d()],Ma.prototype,"_needsUpdate",void 0),u([d()],Ma.prototype,"_needsWaterReflectionUpdate",void 0),Ma=u([L("esri.views.3d.webgl-engine.parts.RenderView")],Ma);var Dk;let mc=Dk=class extends V6(Ee){constructor(e){super(e),this._handles=new Nt,this._model=new Mk,this._layers=new ai,this._changeSet=new yRe,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Ma(this)),this._frameTask=this.resourceController.scheduler.registerTask(Ot.STAGE,this),this._handles.add(this._frameTask)}destroy(){LS.pool.prune(0),this._handles.destroy(),this.dispose()}get viewingMode(){return this.state.viewingMode}get updating(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}add(e){this._model.add(e),Yz(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){M(e)||(this.renderView.requestRender(),this._model.remove(e),Yz(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){_(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){_(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e){M(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(t=>M(t.glTexture)).map(t=>this.schedule(()=>this._model.has(t)?t.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null))))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty}runTask(e){this._frameTask.processQueue(e),e.done||this._commit()}_commit(){const e=this._model.dirtySet;Dk.DebugSettings.logDirtySet&&console.log("Dirty set: "+e.formatDebugInfo()),e.commit(this._changeSet),Dk.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(t=>t.id)),console.log("RGs remove: "+this._changeSet.removes.map(t=>t.id))),this._layerSyncSet.clear(),this.renderView.modify(this._changeSet),this.renderView.requestRender()}schedule(e,t){return this._frameTask.schedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}processSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(t=>{(this._layerSyncSet.has(t.id)||t.updatePolicy===gM.SYNC)&&(e.commitLayer(t.id,this._changeSet),this._layerSyncSet.delete(t.id))});for(const t of this._layerSyncSet)e.commitLayer(t,this._changeSet);this._layerSyncSet.clear(),this.renderView.modify(this._changeSet)}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commit(),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._changeSet.removes),this.renderView.modify(this._changeSet))}addRenderPlugin(e,t,i){const r=this.renderView.renderPlugins.add(e,t,i),s=()=>{jfe(t)&&this.sceneIntersectionHelper.addIntersectionHandler(t)};if(qu(r))return r.then(s);s()}removeRenderPlugin(e){jfe(e)&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderView.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:t=>e._model.test.content.filter(i=>i.type===t).length,model:e._model}}};mc.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},u([d({constructOnly:!0})],mc.prototype,"resourceController",void 0),u([d({constructOnly:!0})],mc.prototype,"options",void 0),u([d({constructOnly:!0})],mc.prototype,"state",void 0),u([d({constructOnly:!0})],mc.prototype,"sceneIntersectionHelper",void 0),u([d({readOnly:!0})],mc.prototype,"viewingMode",null),u([d({constructOnly:!0})],mc.prototype,"container",void 0),u([d({constructOnly:!0})],mc.prototype,"renderSR",void 0),u([d({constructOnly:!0})],mc.prototype,"_handles",void 0),u([d({readOnly:!0})],mc.prototype,"updating",null),u([d({constructOnly:!0})],mc.prototype,"_model",void 0),u([Pa(),d()],mc.prototype,"renderView",void 0),mc=Dk=u([L("esri.views.3d.webgl-engine.Stage")],mc);function P3e(e){return yy(e)&&e.intersector===xs.PCL&&!!e.target}function N8(e){return yy(e)&&e.intersector===xs.I3S&&!!e.target}function pOt(e){return yy(e)&&e.intersector===xs.TERRAIN&&!!e.target}function I3e(e){return yy(e)&&e.intersector===xs.OVERLAY&&!!e.target}function hse(e){return yy(e)&&e.intersector===xs.LOD&&!!e.target}function Bge(e,t){var i;return v6(e)||_6(e)?Q$(e.target.object.metadata,t):pOt(e)?(i=t.map)==null?void 0:i.ground:P3e(e)||N8(e)||I3e(e)?Q$(e.target,t):null}function fOt(e,t){const i=HJ(e,t);return _(i)&&i.type==="graphic"?i.graphic:null}function HJ(e,t){if(M(e))return null;if(v6(e)||_6(e))return Gge(e.target.object.metadata,t);if(P3e(e)){const i=e.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return I3e(e)||hse(e)?Gge(e.target,t):N8(e)?mOt(e.target,t):null}function Gge(e,t){if(M(e)||M(e.graphicUid))return null;const i=Q$(e,t);if(M(i))return null;if(i===t.graphics)return M(t.graphicsView)||typeof e.graphicUid!="number"?null:t.graphicsView.getHit(e.graphicUid);const r=t.allLayerViews.find(s=>s.layer===i);return!r||r.suspended||M(e.graphicUid)?null:"getHit"in r?r.getHit(e.graphicUid):null}function mOt(e,t){const i=Q$(e,t);if(M(i))return null;const r=t.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?yOt(r.getGraphicFromIntersectorTarget(e)):null}function gOt(e,t){const i=Q$(e,t);if(M(i))return null;const r=t.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(e):null}function yOt(e){return _(e)?{type:"graphic",graphic:e,layer:e.layer}:null}function Q$(e,t){return M(e.layerUid)?null:_(t.graphicsView)&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}function Bkt(e,t){if(v6(e)||_6(e))return Y0(e.target.object.boundingVolumeWorldSpace.bounds);if(hse(e)){Pbe(g4,e.transformation);const i=Math.max(g4[0],g4[1],g4[2]);return e.target.baseBoundingSphere.radius*i}return N8(e)?wt(gOt(e.target,t),i=>.5*a1e(i)):null}function Gkt(e){return!v6(e)&&!_6(e)&&(hse(e)?e.target.numLodLevels>1:!!N8(e))}const g4=$();async function vOt(e,t){if(e.type==="2d")return e.hitTest(t);const i=await e.hitTest(t);if(i.results.length===0)return i;const r=i.results[0],s=_(r.distance)?r.distance*(1+_Ot):r.distance,n=i.results.findIndex(o=>o.distance>s);return n!==-1&&(i.results=i.results.slice(0,n)),i}const _Ot=.05;function bOt(e){return _(e)&&e.type==="graphic"}function wOt(e){var t;return(t=e.find(bOt))!=null?t:null}let yH,vH;function xOt(e){const t=BCe(e);for(;t.length>1;){const i=jge(t.shift());if(i.available)return i}return jge(t.shift())}function jge(e){switch(e){case Ii.WEBGL1:return TOt();case Ii.WEBGL2:return SOt()}}function TOt(){return yH||(yH=AOt()),yH}function SOt(){return vH||(vH=MOt()),vH}class $3e{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}}class EOt extends $3e{constructor(){super(...arguments),this.type=Ii.WEBGL1}}class COt extends $3e{constructor(){super(...arguments),this.type=Ii.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}}function L3e(e,t){var n;if(e===Ii.WEBGL1&&typeof WebGLRenderingContext===void 0||e===Ii.WEBGL2&&typeof WebGL2RenderingContext===void 0)return null;const i=document.createElement("canvas");if(!i)return null;let r=xz(i,e,{failIfMajorPerformanceCaveat:!0});if(M(r)&&(r=xz(i,e),_(r)&&(t.majorPerformanceCaveat=!0)),M(r))return r;if(e===Ii.WEBGL1){const o=(n=r.getParameter(r.VERSION))==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);t.available=a>=.94}}else t.available=!0;t.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return s&&(t.supportsHighPrecisionFragment=s.precision>0),r}function AOt(){const e=new EOt,t=L3e(Ii.WEBGL1,e);return M(t)||(e.supportsElementIndexUint=t.getExtension("OES_element_index_uint")!==null,e.supportsStandardDerivatives=t.getExtension("OES_standard_derivatives")!==null,e.supportsInstancedArrays=t.getExtension("ANGLE_instanced_arrays")!==null,e.supportsTextureFloat=t.getExtension("OES_texture_float")!==null,e.supportsTextureHalfFloat=t.getExtension("OES_texture_half_float")!==null,e.supportsColorBufferFloat=t.getExtension("WEBGL_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=t.getExtension("EXT_color_buffer_half_float")!==null),e}function MOt(){const e=new COt,t=L3e(Ii.WEBGL2,e);return M(t)||(e.supportsColorBufferFloat=t.getExtension("EXT_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||t.getExtension("EXT_color_buffer_half_float")!==null),e}function OOt(e){const t=xOt(e);if(!t.available)return new W("webgl:required","WebGL is required but not supported.");if(e==="3d"&&t.majorPerformanceCaveat)return new W("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!t.supportsHighPrecisionFragment)return new W("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!t.supportsVertexShaderSamplers)return new W("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(t.type===Ii.WEBGL1){if(!t.supportsElementIndexUint)return new W("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!t.supportsStandardDerivatives)return new W("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!t.supportsInstancedArrays)return new W("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function ROt(e){return e&&"nodeType"in e}function POt(e){return e&&typeof e.render=="function"}const Hge={component:"esri-component"};let Vx=class extends Ee{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(Hge.component),t&&t.classList.remove(Hge.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||ROt(e)?(this._set("widget",null),fL(e)):(POt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([d({dependsOn:[]})],Vx.prototype,"id",null),u([d()],Vx.prototype,"node",null),u([Jt("node")],Vx.prototype,"castNode",null),u([d({readOnly:!0})],Vx.prototype,"widget",void 0),Vx=u([L("esri.views.ui.Component")],Vx);const Nk=Vx,IOt={left:0,top:0,bottom:0,right:0},D3e={bottom:30,top:15,right:15,left:15},_H="manual",lc={ui:"esri-ui",corner:"esri-ui-corner",innerContainer:"esri-ui-inner-container",manualContainer:"esri-ui-manual-container",cornerContainer:"esri-ui-corner-container",topLeft:"esri-ui-top-left",topRight:"esri-ui-top-right",bottomLeft:"esri-ui-bottom-left",bottomRight:"esri-ui-bottom-right"};function $Ot(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function bH(e){const t=e,i=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(i===null||i===Object.prototype)&&("component"in t||"index"in t||"position"in t)?e:null}function wH(e,{top:t,bottom:i,left:r,right:s}){e.style.top=t,e.style.bottom=i,e.style.left=r,e.style.right=s}let f0=class extends cs.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new Nt,this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&wH(t,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&wH(t,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this._handles.add([re(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,Et),re(()=>this.padding,this._applyUIPadding,Et)])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(lc.ui),OHe(e),this._attachContainers(e)),t&&(t.classList.remove(lc.ui),wH(t,{top:"",bottom:"",left:"",right:""}),nbe(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const t=this._getViewPadding(),i=t.top+t.bottom;return Math.max(e-i,0)}get padding(){return this._get("padding")}set padding(e){e?this._override("padding",e):this._clearOverride("padding")}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:F(F({},D3e),e)}get width(){const e=this.get("view.width")||0;if(e===0)return e;const t=this._getViewPadding(),i=t.left+t.right;return Math.max(e-i,0)}add(e,t){let i,r;if(Array.isArray(e))return void e.forEach(n=>this.add(n,t));const s=bH(e);s&&({index:i,position:t,component:e,key:r}=s),t&&typeof t=="object"&&({index:i,key:r,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,r)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(r=>this.remove(r,t));const i=this._find(e);if(i){const r=this._componentToKey;if(r.has(e)&&r.get(e)!==t)return;const s=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map(t=>this.empty(t)).reduce((t,i)=>t.concat(i)):(e=e||_H)===_H?Array.prototype.slice.call(this._manualContainer.children).filter(t=>!t.classList.contains(lc.corner)).map(t=>this.remove(t)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach(n=>this.move(n,t)),!e)return;let i;const r=bH(e)||bH(t);if(r&&(i=r.index,t=r.position,e=r.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:i})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,r){e instanceof Nk||(e=new Nk({node:e})),this._place({component:e,position:t,index:i}),this._components.push(e),r&&this._componentToKey.set(e,r)}_find(e){return e?e instanceof Nk?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||IOt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(lc.innerContainer),e.classList.add(lc.cornerContainer);const t=document.createElement("div");t.classList.add(lc.innerContainer),t.classList.add(lc.manualContainer);const i=document.createElement("div");i.classList.add(lc.topLeft),i.classList.add(lc.corner),e.appendChild(i);const r=document.createElement("div");r.classList.add(lc.topRight),r.classList.add(lc.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(lc.bottomLeft),s.classList.add(lc.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(lc.bottomRight),n.classList.add(lc.corner),e.appendChild(n),this._innerContainer=e,this._manualContainer=t;const o=jl();this._cornerNameToContainerLookup={"top-left":i,"top-right":r,"bottom-left":s,"bottom-right":n,"top-leading":o?r:i,"top-trailing":o?i:r,"bottom-leading":o?n:s,"bottom-trailing":o?s:n},this._positionNameToContainerLookup=F({manual:t},this._cornerNameToContainerLookup)}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,i=e.position||_H,r=e.index,s=this._positionNameToContainerLookup[i],n=r>-1;if($Ot(t.widget)&&t.widget.startup(),!n)return void s.appendChild(t.node);const o=Array.prototype.slice.call(s.children);if(r===0)return void(s.firstChild?Noe(t.node,s.firstChild):s.appendChild(t.node));r>=o.length?s.appendChild(t.node):Noe(t.node,o[r])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let t,i=null;return this._components.some(r=>(t=r===e,t&&(i=r),t)),i}_findById(e){let t,i=null;return this._components.some(r=>(t=r.id===e,t&&(i=r),t)),i}_findByNode(e){let t,i=null;return this._components.some(r=>(t=r.node===e,t&&(i=r),t)),i}};u([d()],f0.prototype,"container",null),u([d()],f0.prototype,"height",null),u([d({value:D3e})],f0.prototype,"padding",null),u([Jt("padding")],f0.prototype,"castPadding",null),u([d()],f0.prototype,"view",void 0),u([d()],f0.prototype,"width",null),f0=u([L("esri.views.ui.UI")],f0);const LOt=f0;function qge(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function DOt(e,t){return e.length!==t.length||e.some((i,r)=>i.text!==t[r].text)}function y4(e,t,i){!i||!t||e.find(r=>r.layerView===t&&r.text===i)||e.push({text:i,layerView:t})}function NOt(e){return e.type==="bing-maps"}const I_=[];let _C=class extends yv{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new nt,this.view=null,this._allLayerViewsChange=t=>{this.handles.remove("suspension");const i=this.get("view.allLayerViews");i&&this.handles.add(i.map(r=>re(()=>{var s;return[r.suspended,(s=r.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),t&&t.removed&&t.removed.forEach(r=>{this._pendingAttributions.delete(r),this._fetchedAttributionData.delete(r)}),this._updateAttributionItems()},this.handles.add([os(()=>{var t;return(t=this.view)==null?void 0:t.allLayerViews},"change",t=>this._allLayerViewsChange(t),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Jn(()=>{var t;return((t=this.view)==null?void 0:t.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.get("view.allLayerViews");I_.length=0,e?(e.forEach(t=>{var s;if(t.suspended||!((s=t.layer)==null?void 0:s.attributionVisible))return;const i=t.layer;if(qge(i,"user"))return void y4(I_,t,i.copyright);if(i.hasAttributionData){if(this._fetchedAttributionData.has(t)){const n=this._fetchedAttributionData.get(t);return void(n?y4(I_,t,this._getDynamicAttribution(n,this.view,i)):qge(i)&&y4(I_,t,i.copyright))}return void this._fetchAttributionData(t)}const r=i.get("portalItem.accessInformation");y4(I_,t,r||i.copyright)}),DOt(this.items,I_)&&(this.items.removeAll(),this.items.addMany(I_)),I_.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await Hu(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=t.ok?this._createContributionIndex(t.value,NOt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,t){const i=e.contributors,r={};if(!i)return r;for(let s=0;s<i.length;s++){const n=i[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(t&&a.zoomMin?1:0),h=a.zoomMax-(t&&a.zoomMax?1:0),p={xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:at.WGS84},f={extent:$g(p),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let m=c;m<=h;m++)r[m]=r[m]||[],r[m].push(f)}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}_getDynamicAttribution(e,t,i){const{extent:r,scale:s}=t;let n=i.tileInfo.scaleToZoom(s);if(n=Math.min(e.maxKey,Math.round(n)),!r||n==null||n<=-1)return"";const o=e[n],a=HS(r.center.clone().normalize(),t.spatialReference),l={};return o?o.filter(c=>{const h=!l[c.id]&&a&&WQ(c.extent,a);return h&&(l[c.id]=!0),h}).sort((c,h)=>h.score-c.score||c.objectId-h.objectId).map(c=>c.attribution).join(", "):""}};u([d({readOnly:!0,type:nt})],_C.prototype,"items",void 0),u([d({readOnly:!0})],_C.prototype,"state",null),u([d()],_C.prototype,"view",void 0),_C=u([L("esri.widgets.Attribution.AttributionViewModel")],_C);const N3e=_C,$_={base:"esri-attribution esri-widget",poweredBy:"esri-attribution__powered-by",sources:"esri-attribution__sources",open:"esri-attribution--open",sourcesOpen:"esri-attribution__sources--open",link:"esri-attribution__link",widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let gc=class extends Yr{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:r})=>this._checkSourceTextOverflow(r))),this.iconClass=$_.widgetIcon,this.itemDelimiter=" | ",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new N3e}initialize(){this.own(os(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}render(){const e={[$_.open]:this._isOpen};return N("div",{bind:this,class:this.classes($_.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return N("div",{class:$_.poweredBy},"Powered by"," ",N("a",{class:$_.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,i=t?"0":"",{attributionText:r}=this,s={[$_.sourcesOpen]:e,[$_.interactive]:t};return N("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes($_.sources,s),innerHTML:r,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:i,clientWidth:r,scrollWidth:s}=e,n=s>r,o=this._attributionTextOverflowed!==n;if(this._attributionTextOverflowed=n,o&&(t=!0),this._isOpen){const a=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,a&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([d()],gc.prototype,"_isOpen",void 0),u([d()],gc.prototype,"_isInteractive",null),u([d()],gc.prototype,"_attributionTextOverflowed",void 0),u([d()],gc.prototype,"_prevSourceNodeHeight",void 0),u([d({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],gc.prototype,"attributionText",null),u([d()],gc.prototype,"iconClass",void 0),u([d()],gc.prototype,"itemDelimiter",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],gc.prototype,"label",void 0),u([d(),pr("esri/widgets/Attribution/t9n/Attribution")],gc.prototype,"messages",void 0),u([ze("viewModel.view")],gc.prototype,"view",void 0),u([d({type:N3e})],gc.prototype,"viewModel",void 0),u([Da()],gc.prototype,"_toggleState",null),gc=u([L("esri.widgets.Attribution")],gc);const FOt=gc,kOt="esri.widgets.CompassViewModel";let Bx=class extends qte(Ee){constructor(e){super(e),this._handles=new Nt,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(re(()=>this.view,this._updateRotationWatcher,Et))}destroy(){this._handles=hn(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};this.view.type==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?re(()=>e==null?void 0:e.rotation,this._updateForRotation,Et):re(()=>e==null?void 0:e.camera,this._updateForCamera,Et))}};u([d({readOnly:!0})],Bx.prototype,"canShowNorth",null),u([d()],Bx.prototype,"orientation",void 0),u([d({readOnly:!0})],Bx.prototype,"state",null),u([d()],Bx.prototype,"view",void 0),Bx=u([L(kOt)],Bx);const F3e=Bx,L_={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let sg=class extends Yr{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=L_.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new F3e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,i=t==="disabled",r=(t==="rotation"?"rotation":"compass")=="compass",s=i?-1:0,n={[L_.disabled]:i,[L_.interactive]:!i},o={[L_.northIcon]:r,[L_.rotationIcon]:!r},{messages:a}=this;return N("div",{bind:this,class:this.classes(L_.base,n),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":a.reset,title:a.reset},N("span",{"aria-hidden":"true",class:this.classes(L_.icon,o),styles:this._toRotationTransform(e)}),N("span",{class:L_.text},a.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([ze("viewModel.goToOverride")],sg.prototype,"goToOverride",void 0),u([d()],sg.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],sg.prototype,"label",void 0),u([d(),pr("esri/widgets/Compass/t9n/Compass")],sg.prototype,"messages",void 0),u([ze("viewModel.view")],sg.prototype,"view",void 0),u([d({type:F3e})],sg.prototype,"viewModel",void 0),u([Da()],sg.prototype,"_reset",null),sg=u([L("esri.widgets.Compass")],sg);const UOt=sg;let bC=class extends Ee{constructor(e){super(e),this._handles=new Nt,this.navigationMode="pan",this.view=null}initialize(){this._handles.add(Jn(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")&&this.view.type==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([d({readOnly:!0})],bC.prototype,"state",null),u([d()],bC.prototype,"navigationMode",void 0),u([d()],bC.prototype,"view",void 0),bC=u([L("esri.widgets.NavigationToggleViewModel")],bC);const k3e=bC,Ed={base:"esri-navigation-toggle esri-widget",button:"esri-navigation-toggle__button esri-widget--button",activeButton:"esri-navigation-toggle__button--active",panButton:"esri-navigation-toggle__button--pan",rotateButton:"esri-navigation-toggle__button--rotate",isLayoutHorizontal:"esri-navigation-toggle--horizontal",rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let ng=class extends Yr{constructor(e,t){super(e,t),this.iconClass=Ed.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new k3e}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",t=this.get("viewModel.navigationMode")==="pan",i={[Ed.disabled]:e,[Ed.isLayoutHorizontal]:this.layout==="horizontal"},r={[Ed.activeButton]:t},s={[Ed.activeButton]:!t},n=e?-1:0,o=this.messages.toggle;return N("div",{bind:this,class:this.classes(Ed.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:n,"aria-label":o,title:o},N("div",{class:this.classes(Ed.button,Ed.panButton,r)},N("span",{class:Ed.panIcon})),N("div",{class:this.classes(Ed.button,Ed.rotateButton,s)},N("span",{class:Ed.rotationIcon})))}_toggle(){this.toggle()}};u([d()],ng.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ng.prototype,"label",void 0),u([d({value:"vertical"})],ng.prototype,"layout",null),u([d(),pr("esri/widgets/NavigationToggle/t9n/NavigationToggle")],ng.prototype,"messages",void 0),u([ze("viewModel.view")],ng.prototype,"view",void 0),u([d({type:k3e})],ng.prototype,"viewModel",void 0),u([Da()],ng.prototype,"_toggle",null),ng=u([L("esri.widgets.NavigationToggle")],ng);const zOt=ng,JR={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let h1=class extends Yr{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,t={[JR.disabled]:!this.enabled,[JR.interactive]:this.enabled},i={[this.iconClass]:!!this.iconClass};return N("div",{bind:this,class:this.classes(JR.button,t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},N("span",{"aria-hidden":"true",role:"presentation",class:this.classes(JR.icon,i)}),N("span",{class:JR.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([d()],h1.prototype,"action",void 0),u([d()],h1.prototype,"enabled",void 0),u([d()],h1.prototype,"iconClass",void 0),u([d()],h1.prototype,"title",void 0),u([Da()],h1.prototype,"_triggerAction",null),h1=u([L("esri.widgets.IconButton")],h1);const Wge=h1;let wC=class extends Ee{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return t===0||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return t===0||e<t}};u([d({readOnly:!0})],wC.prototype,"canZoomIn",null),u([d({readOnly:!0})],wC.prototype,"canZoomOut",null),u([d()],wC.prototype,"view",void 0),wC=u([L("esri.widgets.Zoom.ZoomConditions2D")],wC);const VOt=wC;let xC=class extends Ee{get canZoomIn(){return!!this.get("view.ready")}get canZoomOut(){return!!this.get("view.ready")}};u([d({readOnly:!0})],xC.prototype,"canZoomIn",null),u([d({readOnly:!0})],xC.prototype,"canZoomOut",null),u([d()],xC.prototype,"view",void 0),xC=u([L("esri.widgets.Zoom.ZoomConditions3D")],xC);const BOt=xC;let d1=class extends Ee{constructor(e){super(e),this.canZoomIn=!1,this.canZoomOut=!1}destroy(){this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new VOt({view:e}):e.type==="3d"&&(this._zoomConditions=new BOt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():VA(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():VA(e.goTo({zoomFactor:.5}))}};u([d()],d1.prototype,"_zoomConditions",void 0),u([d({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],d1.prototype,"canZoomIn",void 0),u([d({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],d1.prototype,"canZoomOut",void 0),u([d({readOnly:!0})],d1.prototype,"state",null),u([d()],d1.prototype,"view",null),d1=u([L("esri.widgets.Zoom.ZoomViewModel")],d1);const U3e=d1,QR={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let m0=class extends Yr{constructor(e,t){super(e,t),this.iconClass=QR.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new U3e}initialize(){this._zoomInButton=new Wge({action:this.zoomIn.bind(this),iconClass:QR.zoomInIcon}),this._zoomOutButton=new Wge({action:this.zoomOut.bind(this),iconClass:QR.zoomOutIcon})}destroy(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}render(){const e=this.viewModel,t={[QR.horizontalLayout]:this.layout==="horizontal"};return this._zoomInButton.enabled=e.state==="ready"&&e.canZoomIn,this._zoomOutButton.enabled=e.state==="ready"&&e.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,N("div",{class:this.classes(QR.base,t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([d()],m0.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],m0.prototype,"label",void 0),u([d({value:"vertical"})],m0.prototype,"layout",null),u([d(),pr("esri/widgets/Zoom/t9n/Zoom")],m0.prototype,"messages",void 0),u([ze("viewModel.view")],m0.prototype,"view",void 0),u([d({type:U3e})],m0.prototype,"viewModel",void 0),m0=u([L("esri.widgets.Zoom")],m0);const GOt=m0,z3e="esri.views.ui.DefaultUI";function jOt(e){return e&&e.view!==void 0}ve.getLogger(z3e);let Fk=class extends LOt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this._handles.add([re(()=>this.components,this._componentsWatcher.bind(this),Et),re(()=>this.view,this._updateViewAwareWidgets.bind(this),Et)])}_add(e,t,i,r){if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}super._add(e,t,i,r)}_removeComponents(e){e.forEach(t=>{const i=this._find(t);i&&(this.remove(i),i.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(t=>{const i=this._find(t),r=i&&i.widget;jOt(r)&&(r.view=e)})}_componentsWatcher(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:t}=this.padding;this.padding=t}}_addComponents(e){this.initialized&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){const t=this._createWidget(e);if(t)return new Nk({id:e,node:t})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new FOt({view:this.view})}_createCompass(){return new UOt({view:this.view})}_createNavigationToggle(){return new zOt({view:this.view})}_createZoom(){return new GOt({view:this.view})}};u([d()],Fk.prototype,"components",void 0),Fk=u([L(z3e)],Fk);const HOt=Fk;let kk=class extends HOt{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([d()],kk.prototype,"components",void 0),kk=u([L("esri.views.ui.3d.DefaultUI3D")],kk);const V3e=kk,ah=ve.getLogger("esri.views.SceneView");let vt=class extends t9e(Sit(Uit(Drt))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this.propertiesPool=new wv({slicePlane:Nwe},this),this._resourceController=Bwt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new KY({view:this}),this.labeler=new $x({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new rM,this.basemapTerrain=null,this.elevationProvider=null,this.camera=null,this.canvas=null,this.center=null,this.constraints=new cT,this.environmentManager=new cf,this.extent=null,this.floors=new nt,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new krt({view:this}),this.groundView=null,this.navigating=!1,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new Lbt,this.scale=null,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new V3e,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.viewpoint=null,this.zoom=null,this.highlightOptions=new yJ,this.voxelWasm=null,this.voxelWasmPromise=null,y6e(),e&&e.environment||(this._defaults.environment=new uC,this.environment=this._defaults.environment);const t=(i=null)=>{_(i)&&i.type===yr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.handles.add([os(()=>{var i;return(i=this.map)==null?void 0:i.allLayers},"after-changes",i=>t(i),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),re(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new zht({view:this}),this.stateManager=new owt({view:this})}initialize(){this.groundView=new kit({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.handles.add(os(()=>{var t;return(t=this.map)==null?void 0:t.allLayers},"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,t=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=t)},Et),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,t=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=t)},Et),this.updatingHandles.add(()=>this.qualitySettings.frameRate,t=>X5e(t>0?1e3/Math.ceil(t):0),Et),this.updatingHandles.add(()=>{var t;return(t=this.map)==null?void 0:t.ground},e,fi),this.updatingHandles.add(()=>{var t,i;return(i=(t=this.map)==null?void 0:t.ground)==null?void 0:i.opacity},()=>this._updateDefaultHitTestOptions(),fi),this.handles.add(re(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Ui))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=We(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=We(this._resourceController),this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=We(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var e;return(e=this.basemapTerrain)==null?void 0:e.spatialReference}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get clippingArea(){if(this.viewingMode==="global")return null;let e=this._userClippingArea||this.get("map.clippingArea");return!(!!this._userClippingArea||this.get("map.clippingEnabled"))||M(e)?(this._clippingArea=null,null):e instanceof yi?this.spatialReference&&(e=v4(e,this.spatialReference),M(e))?(ah.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),M(e.intersection(this.groundAndLayersExtent))&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(ah.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&_(e)?ah.error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===tt.Global)return null;const e=this.renderSpatialReference,t=this.dataExtent;return M(t)||M(e)||t.spatialReference.equals(e)?t:v4(t,e)}get dataExtent(){let e=this.groundAndLayersExtent;const t=this.spatialReference||at.WGS84,i=v4(this.clippingArea,t);_(i)&&(e=_(e)?e.intersection(i):i);const r=this._get("dataExtent");return _(e)&&e.equals(r)?r:e}get groundAndLayersExtent(){const e=this.spatialReference||at.WGS84;let t;const i=n=>{const o=v4(n,e);M(o)||(_(t)?t.union(o):t=o.clone())},r=this.basemapTerrain;if(r==null?void 0:r.spatialReference){const n=r.groundExtent;i(new yi({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const n=o=>{!_(o.fullExtent)||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(M(t))return null;t.hasZ?(t.zmin=Math.min(0,t.zmin),t.zmax=Math.max(0,t.zmax)):(t.zmin=0,t.zmax=0);const s=this._get("groundAndLayersExtent");return t.equals(s)?s:t}set environment(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e)}castEnvironment(e){return e?e instanceof uC?e:e instanceof SCe?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(e):uC.fromWebsceneEnvironment(e):dn(uC,e):new uC}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||_(this.activeTool)}get stationary(){return!this.animation&&!this.resizing&&(M(this.state)||this.state.stationary)}set qualityProfile(e){bk.isValidProfile(e)&&(bk.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||bk.getDefaultProfile()}set slicePlane(e){if(_(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:e}),M(e))return void this._set("slicePlane",null);const t=this.propertiesPool.get("slicePlane");i2(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?Qwe(this.scale,this.spatialReference):0}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return e!=null?e2.deriveUnitFromSR(e,this.spatialReference):null}get updating(){var r,s,n;if(this.destroyed)return!1;let e=0,t=this.layerViewManager.updating,i=t?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(o=>{if(o.isFulfilled()){if(o.updating){if(t=!0,o.suspended||j$(o))return;++i,e+=o.updatingProgress}}else++i});for(const o of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager,this.analysisViewManager])_(o)&&o.updating&&(i+=.1,e+=.5*.1);for(const o of[this.deconflictor,this.labeler,this.basemapTerrain])_(o)&&o.updating&&(++i,e+=o.updatingProgress);if(t=!!(t||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||((r=this.inputManager)==null?void 0:r.hasPendingInputs)||((n=(s=this.map)==null?void 0:s.allLayers)==null?void 0:n.some(o=>!o.isFulfilled()))),t?(this._numUpdating=Math.max(i,this._numUpdating),e+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=t?0:1,this._get("updatingProgress")!==e){const o=performance.now();if(e<1){const a=Math.min((o-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-a)+e*a}this._set("updatingProgress",e),this._lastUpdateTime=t&&e<1?o:0}return t}get viewingMode(){var i;const e=this._predeterminedViewingMode;if(_(e))return J9(e);const t=this.spatialReference;return t?_((i=this.defaultsFromMap)==null?void 0:i.viewingMode)&&t.equals(this.defaultsFromMap.spatialReference)?J9(this.defaultsFromMap.viewingMode):Uz(t,tt.Global)?"global":"local":"global"}set viewingMode(e){this.ready?ah.error("#viewingMode","viewingMode cannot be set once view is ready"):e?this._override("viewingMode",e):e===void 0&&this._clearOverride("viewingMode")}get resourceController(){return this._resourceController}get performanceInfo(){return new hxt(this)}forceAnimationTime(e){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=e}on(e,t,i,r){return this.viewEvents.on(e,t,i,r)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return ah.error("#toMap()","Scene view cannot be used before it is ready"),null;const i=t?this.externalToInternalIntersectOptions(t):this._defaultToMapOptions,r=_(i.graphics)&&(_(i.graphics.include)||_(i.graphics.exclude)),s=Lue(e)?$ue(this,e):e,n=L0(s);i.enableDraped=i.include&&!i.include.has(Rf)||i.exclude&&i.exclude.has(Rf);const o=this.sceneIntersectionHelper,a=cd(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=r?Vo.ALL:Vo.MIN,o.intersectIntersectorScreen(n,a,i),r){for(const l of a.results.all){const c=HJ(l,this);if(M(c))return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(i.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(e){if(!this.ready)return ah.error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=Ye(e.z==null&&Ag(this.elevationProvider,e),0);return Go(e,EE,this.renderSpatialReference,t),this.state.camera.projectToScreen(EE,xH),bp(xH[0],xH[1])}pixelSizeAt(e){return this.ready?e?(Go(e,EE,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(EE)):0:(ah.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e):1}hitTest(e,t){if(!this.ready)return ah.error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=Lue(e)?$ue(this,e):e,r=Ts(i.x,i.y),s=t?this.externalToInternalIntersectOptions(t):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=cd(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=Vo.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=Bge(a,this),c=_(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:i,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:yy(a)?a.distanceInRenderSpace:0,layer:c}};return dr.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(e){const{results:t,ground:i}=await vOt(this,e);let r=null;return!(t.length===0||Math.abs(Ye(t[0].distance,0)-i.distance)<1e-5)||i.layer&&i.layer.type==="integrated-mesh"||(r=i.mapPoint),{results:t,screenPoint:e,mapPoint:r}}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(M(e.parent))throw new W("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return e.parent.type==="line-of-sight"?(await this.whenLayerView(e.parent)).whenAnalysisView():this.analysisViewManager.whenAnalysisView(e)}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return u0t(i,t,this._pixelFormat())}async _takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return h0t(i,this._pixelFormat())}_completeSettings(e){const t=c0t(e,this);return t.pixelRatio/=this.state.pixelRatio,g0t(t,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:e=>this._takeScreenshot(e)}}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return Bue.importLayerView(e)}hasLayerViewModule(e){return Bue.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,t,i,r;return this.map&&"initialViewProperties"in this.map&&((t=(e=this.map)==null?void 0:e.initialViewProperties)==null?void 0:t.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let e=OOt(this.type);if(ye("safari")&&ye("safari")<9&&(e=new W("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:ye("safari")})),_(e))throw ah.warn("#validate()",e.message),e}get _predeterminedViewingMode(){var t,i;const e=this._isOverridden("viewingMode")?this._get("viewingMode"):(i=this.map&&"initialViewProperties"in this.map?(t=this.map.initialViewProperties)==null?void 0:t.viewingMode:null)!=null?i:null;return _(e)?Uue(e):null}getSpatialReferenceSupport({spatialReference:e,layer:t}){const i=this._predeterminedViewingMode;if(_(i))return this._validateSpatialReferenceForViewingMode(e,t,i)?{constraints:this._makeSpatialReferenceConstraints(e,t,i)}:null;const r=this._validateSpatialReferenceForViewingMode(e,t,tt.Local),s=this._validateSpatialReferenceForViewingMode(e,t,tt.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:r?{constraints:this._makeSpatialReferenceConstraints(e,t,tt.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,tt.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,i){return!!Uz(e,i)&&(!!M(t)||!!fae(t)||(!UI(t)||!M(g8(t,e,i)))&&(!pae(t)||i!==tt.Global))}_makeSpatialReferenceConstraints(e,t,i){if(M(t))return[{spatialReference:e,viewingMode:i}];const r=e.isWebMercator,s=e.isWGS84;return fae(t)&&(r||s)?!s||i===tt.Local||Bre(t.tileInfo,t.fullExtent,e,tt.Global)===null?[{spatialReference:e,viewingMode:i},{spatialReference:at.WebMercator,viewingMode:i}]:[{spatialReference:r?at.WGS84:at.WebMercator,viewingMode:i}]:UI(t)||pae(t)||!r&&!s?UI(t)&&r&&i!==tt.Global?[{spatialReference:e,viewingMode:i},{spatialReference:at.WGS84,viewingMode:tt.Local}]:[{spatialReference:e,viewingMode:i}]:[{spatialReference:e,viewingMode:i},{spatialReference:r?at.WGS84:at.WebMercator,viewingMode:i}]}_validateSpatialReference(e){const t=_(this.getSpatialReferenceSupport({spatialReference:e})),i=this._predeterminedViewingMode;return t||(_(i)?ah.warnOnce(`Spatial reference defined on view not supported in ${J9(i)} viewing mode.`):e.isGeographic&&ah.warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}computeMapPointFromVec3d(e,t){let i=this.spatialReference||at.WGS84;return Zn(e,this.renderSpatialReference,e,i)||(i=at.WGS84,Zn(e,this.renderSpatialReference,e,i)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=i):t=new dt(e,i),t}trackGraphicState(e){if(!e.graphic)return ah.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let i=null,r=!1;const s=n=>{var o;!r&&_(n)&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(i=n.processor.graphicsCore.trackGraphicState(e))};return _(t)?s(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,_(i)&&(i.remove(),i=null)}}}highlight(e){if(Array.isArray(e))return td(e.map(i=>this.highlight(i)));if(nt.isCollection(e))return td(e.toArray().map(i=>this.highlight(i)));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):Fo()}maskOccludee(e){if(!e)return ah.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let i=null,r=!1;const s=n=>{!r&&_(n)&&lit(n)&&(i=n.maskOccludee(e))};return _(t)?s(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,_(i)&&(i.remove(),i=null)}}}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find(t=>t.layer===e.layer):null}graphicChanged(e){_(this.graphicsView)&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await gv(()=>this.graphicsView),this.graphicsView;if(!e.layer||!this.map)throw new W("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((i,r)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(e.layer)&&(s.remove(),this.whenLayerView(e.layer).then(i,r))})}):this.whenLayerView(e.layer)}externalToInternalIntersectOptions(e){const t=this._externalToInternalRenderItems(e.include,y3.INCLUDE),i=this._externalToInternalRenderItems(e.exclude,y3.EXCLUDE);return{include:t.layerUids,exclude:i.layerUids,graphics:{include:t.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(e,t){return e.getIntersectionPoint(EE)?(t=this.computeMapPointFromVec3d(EE,t),e.intersector===xs.TERRAIN&&this.basemapTerrain&&(t.z=Ye(Ag(this.basemapTerrain,t),0)),t):null}_intersectResultsToHits(e,t){const i=new Array;let r=null;for(let s=0;s<e.length;s++){const n=e[s],o=Bge(n,this);if(_(o)&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=HJ(n,this);if(M(a))continue;if(a.type==="graphic"){if(M(r)&&s!==e.length-1&&(r=new Set),_(r)){const h=this._getGraphicFilterUid(a.graphic);if(r.has(h))continue;r.add(h)}if(!this._testGraphicUidFilter(t,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;i.push(me(F({},a),{mapPoint:l,distance:c}))}return i}_getGraphicFilterUid(e){if(e.layer&&"objectIdField"in e.layer){const t=e.attributes[e.layer.objectIdField];if(t)return`o-${e.layer.id}-${t}`}return`u-${e.uid}`}_testGraphicUidFilter(e,t){const i=this._getGraphicFilterUid(t);return M(e)||(M(e.include)||e.include.has(i))&&(M(e.exclude)||!e.exclude.has(i))}_externalToInternalRenderItems(e,t,i={layerUids:null,graphicUids:null}){if(!e)return i;if(e instanceof Ha)qOt(i,this._getGraphicFilterUid(e)),t===y3.INCLUDE&&(_(this.graphicsView)&&e.layer===this?KR(i,this.graphicsView.processor.layer.id):e.layer&&KR(i,e.layer.uid));else if(pve(e))for(const r of e)r===this.graphics&&_(this.graphicsView)?KR(i,this.graphicsView.processor.layer.id):r===this.map.ground?KR(i,Rf):this._externalToInternalRenderItems(r,t,i);else"uid"in e&&KR(i,e.uid);return i}_initBasemapTerrain(){this._set("basemapTerrain",new u2t({view:this})),this._set("elevationProvider",new fI({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new tl({view:this})),this._set("featureTiles",new oa({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{var i;const t=(i=this.basemapTerrain)==null?void 0:i.extent;if(this.clippingArea||t)if(t&&this.basemapTerrain.spatialReference){const r=_(this.basemapTerrain.extent)?Tp(JV(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;_(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>dr.FEATURE_TILE_TREE_SHOW_TILES,t=>{t&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(import("./FeatureTileTree3DDebugger.79ff953f.js")).then(({FeatureTileTree3DDebugger:i})=>{!this.featureTreeDebugger&&dr.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new i({view:this}))}):t||!this.featureTreeDebugger||dr.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},fi),this.updatingHandles.add(()=>this.clippingArea,e,fi),this.updatingHandles.add(()=>this.basemapTerrain.extent,e,fi)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new Awt(this.map,e));const t=this.state.isGlobal,i=Ywe(t,e);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",uV.create(this.state.viewingMode,i)),t||this.handles.add(re(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.extent},r=>{const s=this.renderCoordsHelper.spatialReference;r&&(r[0]!==0||r[1]!==0||r[2]!==0||r[3]!==0)&&mB(r,this.basemapTerrain.spatialReference,Zge,s)&&(this.renderCoordsHelper.extent=Zge)},Ui),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(AM/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){_(e)&&e.type===yr.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(t=>{t.destroyed||(this.handles.add(re(()=>[t.updating,t.updatingProgress],()=>this._updatingChanged(),Ui),"updatingMonitors"),t.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}_renderScreenshotOverlay(e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const i=e.getContext("2d");return i.putImageData(t,0,0),this.overlay.renderCanvas(e),i.getImageData(0,0,t.width,t.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(a,l)=>this._renderScreenshotOverlay(a,l)}},t=new hwt(this.state.viewingMode,a=>this._stage.layers.forAll(a),this);this._set("sceneIntersectionHelper",t);const i=fL(this.surface),{resourceController:r,state:s,renderSpatialReference:n}=this;this._stage=new mc({options:e,container:i,resourceController:r,state:s,sceneIntersectionHelper:t,renderSR:n}),this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=jS(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new W("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Et),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency}),Et),re(()=>this.magnifier,a=>this._stage.renderView.magnifier=a,fi)],"stage");const o=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:yJ.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],o),"stage"),o(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(AM/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage.destroy(),this._stage=null,this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null,this.handles.remove("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new pxt({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new mbt})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const t=(await import("./GraphicsView3D.8e95dfc2.js")).default;qt(e),await gv(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.ready},e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),_(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=Uue(this.viewingMode);if(e===tt.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.handles.add(os(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const i=this.get("map.initialViewProperties.environment");i&&(this.environment=i)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const t=this._resolveWhenReady;this._resolveWhenReady=[],t.forEach(i=>i(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Rf);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Rf);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&e.opacity<1&&this._defaultToMapOptions.exclude.add(e.uid)}}addVoxelLayerViewToWasm(e){return M(this.voxelWasm)?(M(this.voxelWasmPromise)&&(this.voxelWasmPromise=import("./VoxelWasmPerSceneView.b75dfbb8.js").then(t=>(this.voxelWasm=new t.default(this),this.voxelWasm))),this.voxelWasmPromise.then(t=>t.addVoxelLayer(e))):this.voxelWasm.addVoxelLayer(e)}removeVoxelLayerViewFromWasm(e){_(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(e)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function KR(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}function qOt(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)}function v4(e,t){return _(e)&&Jg(e.spatialReference,t)?Tp(e,t):null}var y3;vt.type="3d",u([d()],vt.prototype,"_userClippingArea",void 0),u([d()],vt.prototype,"_resourceController",void 0),u([d()],vt.prototype,"_stage",void 0),u([d({readOnly:!0})],vt.prototype,"deconflictor",void 0),u([d({readOnly:!0})],vt.prototype,"labeler",void 0),u([d(SU(rM,"analyses"))],vt.prototype,"analyses",void 0),u([d({type:dM,readOnly:!0,aliasOf:"state.animation"})],vt.prototype,"animation",void 0),u([d({readOnly:!0})],vt.prototype,"basemapTerrain",void 0),u([d({readOnly:!0})],vt.prototype,"elevationProvider",void 0),u([d({type:ju,aliasOf:"stateManager.camera"})],vt.prototype,"camera",void 0),u([d({type:ju,aliasOf:"stateManager.contentCamera"})],vt.prototype,"contentCamera",void 0),u([d({readOnly:!0})],vt.prototype,"canvas",void 0),u([d({type:dt,aliasOf:"stateManager.center"})],vt.prototype,"center",void 0),u([d({type:yi})],vt.prototype,"clippingArea",null),u([d({type:cT})],vt.prototype,"constraints",void 0),u([d({type:yi,readOnly:!0})],vt.prototype,"renderDataExtent",null),u([d({type:yi,readOnly:!0})],vt.prototype,"dataExtent",null),u([d({type:yi,readOnly:!0})],vt.prototype,"groundAndLayersExtent",null),u([d({value:null,type:uC})],vt.prototype,"environment",null),u([Jt("environment")],vt.prototype,"castEnvironment",null),u([d({readOnly:!0})],vt.prototype,"environmentManager",void 0),u([d({type:yi,aliasOf:"stateManager.extent"})],vt.prototype,"extent",void 0),u([d()],vt.prototype,"floors",void 0),u([d({readOnly:!0,aliasOf:"stateManager.screenCenter"})],vt.prototype,"screenCenter",void 0),u([d({aliasOf:"stateManager.frustum"})],vt.prototype,"frustum",void 0),u([d({type:Number,readOnly:!0})],vt.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],vt.prototype,"graphicsView",void 0),u([d({readOnly:!0})],vt.prototype,"analysisViewManager",void 0),u([d()],vt.prototype,"groundView",void 0),u([d({type:Boolean})],vt.prototype,"initialExtentRequired",null),u([d()],vt.prototype,"_defaultsFromMapSettings",null),u([d({type:Boolean,readOnly:!0})],vt.prototype,"interacting",null),u([d()],vt.prototype,"stationary",null),u([d({aliasOf:"state.navigating"})],vt.prototype,"navigating",void 0),u([d()],vt.prototype,"map",void 0),u([d({readOnly:!0})],vt.prototype,"mapCoordsHelper",void 0),u([d({aliasOf:"stateManager.padding"})],vt.prototype,"padding",void 0),u([d({type:tl,readOnly:!0})],vt.prototype,"pointsOfInterest",void 0),u([d({type:oa,readOnly:!0})],vt.prototype,"featureTiles",void 0),u([d()],vt.prototype,"featureTreeDebugger",void 0),u([d({type:Boolean})],vt.prototype,"screenSizePerspectiveEnabled",void 0),u([d({constructOnly:!0})],vt.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],vt.prototype,"debugWebGLExtensions",void 0),u([d({constructOnly:!0})],vt.prototype,"renderCanvas",void 0),u([d({constructOnly:!0})],vt.prototype,"state",void 0),u([d({readOnly:!0})],vt.prototype,"inputManager",void 0),u([d({readOnly:!0})],vt.prototype,"stateManager",void 0),u([d({type:["low","medium","high"]})],vt.prototype,"qualityProfile",null),u([d({type:qfe,get(){let e=this._get("qualitySettings");return e||(e=new qfe,bk.apply(this.qualityProfile,e)),e}})],vt.prototype,"qualitySettings",void 0),u([d()],vt.prototype,"slicePlane",null),u([d({readOnly:!0})],vt.prototype,"typeSpecificPreconditionsReady",null),u([d({readOnly:!0})],vt.prototype,"renderCoordsHelper",void 0),u([d({readOnly:!0})],vt.prototype,"sceneIntersectionHelper",void 0),u([d({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],vt.prototype,"resolution",null),u([d({type:Number,aliasOf:"stateManager.scale"})],vt.prototype,"scale",void 0),u([d()],vt.prototype,"heightModelInfo",null),u([d()],vt.prototype,"spatialReference",void 0),u([d({type:Boolean,constructOnly:!0})],vt.prototype,"alphaCompositingEnabled",void 0),u([d({constructOnly:!0})],vt.prototype,"preserveDrawingBufferEnabled",void 0),u([d({type:Boolean})],vt.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],vt.prototype,"type",void 0),u([d({type:V3e})],vt.prototype,"ui",void 0),u([d({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating"]})],vt.prototype,"updating",null),u([d({type:Number,readOnly:!0,dependsOn:["updating"]})],vt.prototype,"updatingProgress",void 0),u([d({type:["global","local"]})],vt.prototype,"viewingMode",null),u([d({type:xp,aliasOf:"stateManager.viewpoint"})],vt.prototype,"viewpoint",void 0),u([d({type:Number,aliasOf:"stateManager.zoom"})],vt.prototype,"zoom",void 0),u([d({type:yJ})],vt.prototype,"highlightOptions",void 0),vt=u([L("esri.views.SceneView")],vt),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE"}(y3||(y3={}));const EE=$(),xH=Ts(),Zge=Qt(),WOt=vt;/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.82
 */function ZOt(e){return e.map(t=>{let i="";for(let r=0;r<t;r++)i+=((1+Math.random())*65536|0).toString(16).substring(1);return i}).join("-")}const XOt=()=>ZOt([2,1,1,1,3]);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.82
 */const YOt='@charset "UTF-8";@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:root{--calcite-popper-transition:var(--calcite-animation-timing)}:host([hidden]){display:none}:host{position:relative;margin-left:auto;margin-right:auto;display:none;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;padding-top:4rem;padding-bottom:4rem;opacity:1;min-height:var(--calcite-loader-size);font-size:var(--calcite-loader-font-size);stroke:var(--calcite-ui-brand);stroke-width:3;fill:none;-webkit-transform:scale(1, 1);transform:scale(1, 1);animation:loader-color-shift 6s alternate-reverse infinite linear}:host([scale=s]){--calcite-loader-font-size:var(--calcite-font-size--2);--calcite-loader-size:2rem;--calcite-loader-size-inline:0.75rem}:host([scale=m]){--calcite-loader-font-size:var(--calcite-font-size-0);--calcite-loader-size:4rem;--calcite-loader-size-inline:1rem}:host([scale=l]){--calcite-loader-font-size:var(--calcite-font-size-2);--calcite-loader-size:6rem;--calcite-loader-size-inline:1.5rem}:host([no-padding]){padding-top:0px;padding-bottom:0px}:host{display:none}:host([active]){display:-ms-flexbox;display:flex}.loader__text{display:block;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;color:var(--calcite-ui-text-1);margin-top:calc(var(--calcite-loader-size) + 1.5rem)}.loader__percentage{position:absolute;display:block;text-align:center;color:var(--calcite-ui-text-1);font-size:var(--calcite-loader-font-size);width:var(--calcite-loader-size);left:50%;margin-left:calc(var(--calcite-loader-size) / 2 * -1);line-height:0.25;-webkit-transform:scale(1, 1);transform:scale(1, 1)}.loader__svgs{position:absolute;overflow:visible;opacity:1;width:var(--calcite-loader-size);height:var(--calcite-loader-size);left:50%;margin-left:calc(var(--calcite-loader-size) / 2 * -1);-webkit-transform:scale(1, 1);transform:scale(1, 1)}.loader__svg{position:absolute;top:0px;left:0px;-webkit-transform-origin:center;transform-origin:center;overflow:visible;width:var(--calcite-loader-size);height:var(--calcite-loader-size);-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-name:loader-clockwise;animation-name:loader-clockwise}@supports (display: grid){.loader__svg--1{-webkit-animation-name:loader-offset-1;animation-name:loader-offset-1}.loader__svg--2{-webkit-animation-name:loader-offset-2;animation-name:loader-offset-2}.loader__svg--3{-webkit-animation-name:loader-offset-3;animation-name:loader-offset-3}}:host([type=determinate]){-webkit-animation:none;animation:none;stroke:var(--calcite-ui-border-3)}:host([type=determinate]) .loader__svg--3{-webkit-animation:none;animation:none;stroke:var(--calcite-ui-brand);stroke-dasharray:150.79632;-webkit-transform:rotate(-90deg);transform:rotate(-90deg);-webkit-transition:all var(--calcite-internal-animation-timing-fast) linear;transition:all var(--calcite-internal-animation-timing-fast) linear}:host([inline]){position:relative;margin:0px;-webkit-animation:none;animation:none;stroke:currentColor;stroke-width:2;padding-top:0px;padding-bottom:0px;height:var(--calcite-loader-size-inline);min-height:var(--calcite-loader-size-inline);width:var(--calcite-loader-size-inline);-webkit-margin-end:calc(var(--calcite-loader-size-inline) * 0.5);margin-inline-end:calc(var(--calcite-loader-size-inline) * 0.5);vertical-align:calc(var(--calcite-loader-size-inline) * -1 * 0.2)}:host([active][inline]){display:inline-block}:host([inline]) .loader__svgs{top:0px;left:0px;margin:0px;width:var(--calcite-loader-size-inline);height:var(--calcite-loader-size-inline)}:host([inline]) .loader__svg{width:var(--calcite-loader-size-inline);height:var(--calcite-loader-size-inline)}:host([complete]){opacity:0;-webkit-transform:scale(0.75, 0.75);transform:scale(0.75, 0.75);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, -webkit-transform var(--calcite-internal-animation-timing-medium) linear 1000ms;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, -webkit-transform var(--calcite-internal-animation-timing-medium) linear 1000ms;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms, -webkit-transform var(--calcite-internal-animation-timing-medium) linear 1000ms}:host([complete]) .loader__svgs{opacity:0;-webkit-transform:scale(0.75, 0.75);transform:scale(0.75, 0.75);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, -webkit-transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, -webkit-transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, -webkit-transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms}:host([complete]) .loader__percentage{color:var(--calcite-ui-brand);-webkit-transform:scale(1.05, 1.05);transform:scale(1.05, 1.05);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:color var(--calcite-internal-animation-timing-medium) linear, -webkit-transform var(--calcite-internal-animation-timing-medium) linear;transition:color var(--calcite-internal-animation-timing-medium) linear, -webkit-transform var(--calcite-internal-animation-timing-medium) linear;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear, -webkit-transform var(--calcite-internal-animation-timing-medium) linear}.loader__svg--1{stroke-dasharray:27.9252444444% 139.6262222222%;-webkit-animation-duration:0.72s;animation-duration:0.72s}@-webkit-keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-83.7757333333%}100%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-83.7757333333%}100%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:-279.2524444444%}}.loader__svg--2{stroke-dasharray:55.8504888889% 139.6262222222%;-webkit-animation-duration:0.96s;animation-duration:0.96s}@-webkit-keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-97.7383555556%}100%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-97.7383555556%}100%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:-279.2524444444%}}.loader__svg--3{stroke-dasharray:13.9626222222% 139.6262222222%;-webkit-animation-duration:1.16s;animation-duration:1.16s}@-webkit-keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-76.7944222222%}100%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-76.7944222222%}100%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:-279.2524444444%}}@-webkit-keyframes loader-color-shift{0%{stroke:var(--calcite-ui-brand)}33%{stroke:var(--calcite-ui-brand-press)}66%{stroke:var(--calcite-ui-brand-hover)}100%{stroke:var(--calcite-ui-brand)}}@keyframes loader-color-shift{0%{stroke:var(--calcite-ui-brand)}33%{stroke:var(--calcite-ui-brand-press)}66%{stroke:var(--calcite-ui-brand-hover)}100%{stroke:var(--calcite-ui-brand)}}@-webkit-keyframes loader-clockwise{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes loader-clockwise{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}',JOt=h7e(class extends Oje{constructor(){super();this.__registerHost(),this.__attachShadow(),this.active=!1,this.inline=!1,this.scale="m",this.value=0,this.text="",this.noPadding=!1}render(){const{el:e,inline:t,label:i,scale:r,text:s,type:n,value:o}=this,a=e.id||XOt(),l=.45,c=t?this.getInlineSize(r):this.getSize(r),h=c*l,p=`0 0 ${c} ${c}`,f=n==="determinate",m=2*h*Math.PI,g=o/100*m,y=m-g,x=Math.floor(o),b={"aria-valuenow":x,"aria-valuemin":0,"aria-valuemax":100,complete:x===100},S={r:h,cx:c/2,cy:c/2},T={"stroke-dasharray":`${g} ${y}`};return Bd(Pxe,Object.assign({"aria-label":i,id:a,role:"progressbar"},f?b:{}),Bd("div",{class:"loader__svgs"},Bd("svg",{class:"loader__svg loader__svg--1",viewBox:p},Bd("circle",Object.assign({},S))),Bd("svg",{class:"loader__svg loader__svg--2",viewBox:p},Bd("circle",Object.assign({},S))),Bd("svg",Object.assign({class:"loader__svg loader__svg--3",viewBox:p},f?{style:T}:{}),Bd("circle",Object.assign({},S)))),s&&Bd("div",{class:"loader__text"},s),f&&Bd("div",{class:"loader__percentage"},o))}getSize(e){return{s:32,m:56,l:80}[e]}getInlineSize(e){return{s:12,m:16,l:20}[e]}get el(){return this}static get style(){return YOt}},[1,"calcite-loader",{active:[516],inline:[516],label:[1],scale:[513],type:[513],value:[2],text:[1],noPadding:[4,"no-padding"]}]);function QOt(){if(typeof customElements=="undefined")return;["calcite-loader"].forEach(t=>{switch(t){case"calcite-loader":customElements.get(t)||customElements.define(t,JOt);break}})}QOt();let p1=class extends Ee{constructor(e){super(e),this._viewpointHandle=null,this._handles=new Nt,this.group=null}initialize(){this._handles.add(os(()=>{var e;return(e=this.view)==null?void 0:e.ui},"expand",e=>{const{target:t}=e;t&&t!==this&&t.expanded&&t.group&&t.group===this.group&&this._collapse()}))}destroy(){this._viewpointHandle=null,this.view=null,this._handles.destroy(),this._handles=null}set autoCollapse(e){this._set("autoCollapse",e),this._watchViewpoint()}set expanded(e){const t=!!e;this._set("expanded",t);const i=this.get("view.ui");i&&i.emit("expand",{target:this}),this._viewpointHandleChange(t)}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){this._get("view")!==e&&(this._set("view",e),e&&Jn(()=>e.ready,()=>{this.view===e&&this._watchViewpoint()},{once:!0,initial:!0}))}_viewpointHandleChange(e){this._viewpointHandle&&(e?Jn(()=>this.view.stationary,()=>this._viewpointHandle.resume(),{once:!0,initial:!0}):this._viewpointHandle.pause())}_watchViewpoint(){const e="viewpoint";this._handles.remove(e),this._viewpointHandle=null;const{autoCollapse:t,view:i}=this;if(i&&t){const r=NBe(()=>i.type==="3d"?i.camera:i.viewpoint,()=>this._collapse());this._handles.add(r,e),this._viewpointHandle=r}}_collapse(){this.expanded=!1}};u([d({value:!1})],p1.prototype,"autoCollapse",null),u([d({value:!1})],p1.prototype,"expanded",null),u([d()],p1.prototype,"group",void 0),u([d({readOnly:!0})],p1.prototype,"state",null),u([d({value:null})],p1.prototype,"view",null),p1=u([L("esri.widgets.Expand.ExpandViewModel")],p1);const B3e=p1,vo={base:"esri-expand esri-widget",modeAuto:"esri-expand--auto",modeDrawer:"esri-expand--drawer",modeFloating:"esri-expand--floating",container:"esri-expand__container",containerExpanded:"esri-expand__container--expanded",panel:"esri-expand__panel",button:"esri-widget--button",text:"esri-icon-font-fallback-text",icon:"esri-collapse__icon",iconExpanded:"esri-expand__icon--expanded",iconNumber:"esri-expand__icon-number",iconNumberExpanded:"esri-expand__icon-number--expanded",expandIcon:"esri-icon-expand",collapseIcon:"esri-icon-collapse",content:"esri-expand__content",contentExpanded:"esri-expand__content--expanded",expandMask:"esri-expand__mask",expandMaskExpanded:"esri-expand__mask--expanded"};let Vn=class extends Yr{constructor(e,t){super(e,t),this.autoCollapse=null,this.closeOnEsc=!0,this.collapseTooltip="",this.content="",this.expanded=null,this.expandTooltip="",this.group=null,this.iconNumber=0,this.label=void 0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.view=null,this.viewModel=new B3e,this._handleKeyDown=i=>{const{closeOnEsc:r,_toggleButtonEl:s,expanded:n}=this;!n||!r||i.target===s||i.key!=="Escape"||(typeof r=="function"?r(i):r)&&(this.expanded=!1,s==null||s.focus())}}get contentId(){return`${this.id}_controls_content`}get expandTitle(){const{expanded:e,messagesCommon:t,collapseTooltip:i,expandTooltip:r}=this;return e?i||t.collapse:r||t.expand}get collapseIconClass(){return vo.collapseIcon}set collapseIconClass(e){e?this._override("collapseIconClass",e):this._clearOverride("collapseIconClass")}get expandIconClass(){return YU(this.content)?this.content.iconClass:vo.expandIcon}set expandIconClass(e){e?this._override("expandIconClass",e):this._clearOverride("expandIconClass")}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}toggle(){this.viewModel.expanded=!this.viewModel.expanded}render(){const{mode:e}=this,t={[vo.modeAuto]:e==="auto",[vo.modeDrawer]:e==="drawer",[vo.modeFloating]:e==="floating"};return N("div",{class:this.classes(vo.base,t),onkeydown:this._handleKeyDown},this.renderMask(),this.renderContainer())}renderContainer(){const{expanded:e}=this,t={[vo.containerExpanded]:e};return N("div",{class:this.classes(vo.container,t)},this.renderPanel(),this.renderContent())}renderMask(){const{expanded:e}=this,t={[vo.expandMaskExpanded]:e};return N("div",{bind:this,onclick:this._toggle,class:this.classes(vo.expandMask,t)})}renderBadgeNumber(){const{expanded:e,iconNumber:t}=this;return t&&!e?N("span",{key:"expand__icon-number",class:vo.iconNumber},t):null}renderPanelNumber(){const{iconNumber:e,expanded:t}=this;return e&&t?N("span",{key:"expand__expand-icon-number",class:this.classes(vo.iconNumber,vo.iconNumberExpanded)},e):null}renderIcon(){const{collapseIconClass:e,expandIconClass:t,expanded:i}=this,r={[vo.iconExpanded]:i,[e]:i,[t]:!i};return e===t&&(r[e]=!0),N("span",{"aria-hidden":"true",class:this.classes(vo.icon,r)})}renderTitle(){return N("span",{class:vo.text},this.expandTitle)}renderExpandButton(){const{expanded:e,expandTitle:t,contentId:i}=this;return N("div",{afterCreate:this._storeToggleButtonEl,"aria-controls":i,"aria-expanded":e?"true":"false",bind:this,class:vo.button,onclick:this._toggle,onkeydown:this._toggle,role:"button",tabindex:"0",title:t},this.renderBadgeNumber(),this.renderIcon(),this.renderTitle())}renderPanel(){return N("div",{class:vo.panel},this.renderExpandButton(),this.renderPanelNumber())}renderContent(){const{expanded:e,contentId:t,content:i}=this,r={[vo.contentExpanded]:e},s={id:t,role:"region",class:this.classes(vo.content,r)};return typeof i=="string"?N("div",F({key:"content__string",innerHTML:i},s)):YU(i)?N("div",F({key:"content__widget"},s),i.render()):i instanceof HTMLElement?N("div",F({key:"content__html-element",bind:i,afterCreate:this._attachToNode},s)):hTe(i)?N("div",F({key:"content__node",bind:i.domNode,afterCreate:this._attachToNode},s)):null}_toggle(){this.toggle()}_attachToNode(e){const t=this;e.appendChild(t)}_storeToggleButtonEl(e){this._toggleButtonEl=e}};u([d({readOnly:!0})],Vn.prototype,"contentId",null),u([d({readOnly:!0})],Vn.prototype,"expandTitle",null),u([ze("viewModel.autoCollapse")],Vn.prototype,"autoCollapse",void 0),u([d()],Vn.prototype,"closeOnEsc",void 0),u([d()],Vn.prototype,"collapseIconClass",null),u([d()],Vn.prototype,"collapseTooltip",void 0),u([d()],Vn.prototype,"content",void 0),u([ze("viewModel.expanded")],Vn.prototype,"expanded",void 0),u([d()],Vn.prototype,"expandIconClass",null),u([d()],Vn.prototype,"expandTooltip",void 0),u([ze("viewModel.group")],Vn.prototype,"group",void 0),u([d()],Vn.prototype,"iconNumber",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Vn.prototype,"label",void 0),u([d(),pr("esri/widgets/Expand/t9n/Expand")],Vn.prototype,"messages",void 0),u([d(),pr("esri/t9n/common")],Vn.prototype,"messagesCommon",void 0),u([d()],Vn.prototype,"mode",void 0),u([ze("viewModel.view")],Vn.prototype,"view",void 0),u([d({type:B3e})],Vn.prototype,"viewModel",void 0),u([Da()],Vn.prototype,"_toggle",null),Vn=u([L("esri.widgets.Expand")],Vn);const jkt=Vn;function Zh(e){let t,i,r=[],s=!1;function n(...o){return s&&t===this&&KOt(o,r)||(i=e.apply(this,o),t=this,r=o,s=!0),i}return n}function KOt(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}const f1="esri-weather",Fm={base:f1,esriWidget:"esri-widget",esriWidgetDisabled:"esri-widget--disabled",widgetIcon:"esri-icon-partly-cloudy",content:`${f1}__content`,hasError:`${f1}__content--has-error`,selector:`${f1}__selector`,options:`${f1}__options`,error:`${f1}__error`,warning:`${f1}__warning`},eRt={base:`${`${f1}__labeled-slider`}`};var Mg,If;(function(e){e.Disabled="disabled",e.Ready="ready",e.Error="error"})(Mg||(Mg={})),function(e){e.NotVisible="not-visible",e.LocalScene="local-scene",e.NoAtmosphere="no-atmosphere",e.UnsupportedView="unsupported-view"}(If||(If={}));let Dh=class extends Yr{constructor(e){super(e),this.debounceDelay=200,this._onChangeTimeout=null,this._onChangeDebounced=t=>{const i=t.target.value;this._cancelChange(),this._onChangeTimeout=setTimeout(()=>this.onChange(i),this.debounceDelay)},this._cancelChange=()=>{_(this._onChangeTimeout)&&(clearTimeout(this._onChangeTimeout),this._onChangeTimeout=null)}}initialize(){this.own([re(()=>this.onChange,()=>{this._cancelChange()})])}render(){const{label:e,disabled:t}=this;return N("div",{class:eRt.base},N("calcite-label",{scale:"s",disabled:t},e,N("calcite-slider",{"aria-label":e,disabled:this.disabled,max:1,min:0,step:.01,value:this.value,onCalciteSliderInput:this._onChangeDebounced,onCalciteSliderChange:this._onChangeDebounced})))}destroy(){this._cancelChange()}async loadDependencies(){await import("./calcite-slider.65afea63.js")}};u([d()],Dh.prototype,"value",void 0),u([d()],Dh.prototype,"onChange",void 0),u([d()],Dh.prototype,"disabled",void 0),u([d()],Dh.prototype,"debounceDelay",void 0),Dh=u([L("esri.widgets.Weather.LabeledSlider")],Dh);let Uk=class extends Ee{constructor(){super(...arguments),this.header=!0}};u([d({type:Boolean,nonNullable:!0})],Uk.prototype,"header",void 0),Uk=u([L("esri.widgets.Weather.VisibleElements")],Uk);const G3e=Uk,tRt=ve.getLogger("esri.widgets.Weather.WeatherViewModel");let m1=class extends Ee{constructor(e){super(e),this.view=null,this._handles=new Nt,this._settingWeather=!1,this._weatherByType={sunny:new bz,cloudy:new mCe,rainy:new yCe,snowy:new vCe,foggy:new gCe}}initialize(){this._handles.add([re(()=>this.current,e=>{this._settingWeather||M(e)||(this._weatherByType=me(F({},this._weatherByType),{[e.type]:e}))},fi)])}destroy(){this._handles=We(this._handles)}get state(){const e=this.view;return M(e)||!e.ready?Mg.Disabled:_(this.error)?this.error===If.NotVisible?Mg.Ready:Mg.Error:Mg.Ready}get error(){const e=this.view;return M(e)||!e.ready?null:e.type!=="3d"?If.UnsupportedView:e.viewingMode==="local"?If.LocalScene:e.environment.atmosphereEnabled?e.environmentManager.weatherVisible?null:If.NotVisible:If.NoAtmosphere}get current(){const e=wt(this._environment,t=>t.weather);return Ye(e,this._weatherByType.sunny)}set current(e){wt(this._environment,t=>t.weather=e)}get test(){return F({},this._weatherByType)}get _environment(){const e=this.view;return _(e)&&e.type==="3d"?e.environment:null}setWeatherByType(e){if(!wCe(e,tRt))return;const t=this._environment;_(t)&&(this._settingWeather=!0,t.weather=this._weatherByType[e],this._settingWeather=!1)}setSnowCoverEnabled(e){const t=this.current;"snowCover"in t&&(t.snowCover=e?"enabled":"disabled")}};u([d()],m1.prototype,"view",void 0),u([d()],m1.prototype,"state",null),u([d()],m1.prototype,"error",null),u([d()],m1.prototype,"current",null),u([d()],m1.prototype,"_environment",null),m1=u([L("esri.widgets.Weather.WeatherViewModel")],m1);const iRt=m1,rRt={sunny:"brightness",cloudy:"partly-cloudy",rainy:"rain",snowy:"snow",foggy:"fog"};let Ud=class extends Yr{constructor(e){super(e),this.viewModel=new iRt,this.headingLevel=4,this.visibleElements=new G3e,this.iconClass=Fm.widgetIcon,this.label=void 0,this._renderWeatherTypeButton=t=>{const i=this.viewModel,r=this.messages[t].label,s=i.state===Mg.Disabled,n=!s&&i.current.type===t;return N("calcite-button",{appearance:n?"solid":"outline","aria-checked":n?"true":"false",color:n?"blue":"neutral",disabled:s,"icon-start":rRt[t],key:`${t}-type-button`,label:r,role:"radio",scale:"l",title:r,onclick:()=>{n||i.setWeatherByType(t)}})},this._memoizedCallbacks=Zh(t=>({onCloudCoverChange:i=>{"cloudCover"in t&&(t.cloudCover=i)},onPrecipitationChange:i=>{"precipitation"in t&&(t.precipitation=i)},onFogStrengthChange:i=>{"fogStrength"in t&&(t.fogStrength=i)},onSnowCoverChange:i=>{this.viewModel.setSnowCoverEnabled(i.target.checked)}}))}render(){const e=this.viewModel.state===Mg.Disabled;return N("div",{class:this.classes(Fm.base,Fm.esriWidget,e&&Fm.esriWidgetDisabled),role:"region","aria-label":this.messages.widgetLabelAccessible},this._renderContent())}async loadDependencies(){await Promise.all([import("./calcite-button.ad24f688.js"),import("./calcite-checkbox.abb813a4.js"),import("./calcite-icon.8b18df0a.js"),import("./calcite-label.62464d51.js"),import("./calcite-slider.65afea63.js")])}get view(){var e;return(e=this.viewModel)==null?void 0:e.view}set view(e){this.viewModel&&(this.viewModel.view=e)}get _errorMessage(){const e=this.messages.error;switch(this.viewModel.error){case If.LocalScene:return e.localScene;case If.NoAtmosphere:return e.noAtmosphere;case If.UnsupportedView:return e.unsupported;default:return null}}get _warningMessage(){var e;return this.viewModel.error===If.NotVisible&&_(this.view)&&((e=this.view)==null?void 0:e.type)==="3d"&&this.view.environment.atmosphereEnabled?this.messages.error.notVisible:null}_renderContent(){const e=this.messages,t=this._warningMessage,i=this.viewModel.state===Mg.Error;return N(y5,null,this.visibleElements.header&&N(J0,{level:this.headingLevel},e.widgetLabel),i&&N("div",{key:"error",class:Fm.error},this._errorMessage),N("div",{key:"content",class:CT({[Fm.content]:!0,[Fm.hasError]:i})},N("div",{class:Fm.selector,role:"radiogroup","aria-label":e.weatherType},bCe.map(this._renderWeatherTypeButton)),N("div",{class:Fm.options},this._renderOptions()),_(t)&&this._renderWarning(t)))}_renderOptions(){const{viewModel:e,messages:t}=this,i=e.state===Mg.Disabled,r=e.current,s=this._memoizedCallbacks(r);switch(r.type){case"sunny":return N(Dh,{key:"sunny-cover",disabled:i,label:t.sunny.cloudCover,value:r.cloudCover,onChange:s.onCloudCoverChange});case"cloudy":return N(Dh,{key:"cloudy-cover",disabled:i,label:t.cloudy.cloudCover,value:r.cloudCover,onChange:s.onCloudCoverChange});case"rainy":return N(y5,null,N(Dh,{key:"rainy-cover",disabled:i,label:t.rainy.cloudCover,value:r.cloudCover,onChange:s.onCloudCoverChange}),N(Dh,{key:"rainy-precipitation",disabled:i,debounceDelay:0,label:t.rainy.precipitation,value:r.precipitation,onChange:s.onPrecipitationChange}));case"snowy":return N(y5,null,N(Dh,{key:"snowy-cloud-cover",disabled:i,label:t.snowy.cloudCover,value:r.cloudCover,onChange:s.onCloudCoverChange}),N(Dh,{key:"snowy-precipitation",disabled:i,debounceDelay:0,label:t.snowy.precipitation,value:r.precipitation,onChange:s.onPrecipitationChange}),N("calcite-label",{key:"snow-cover",scale:"s",disabled:i,layout:"inline",title:t.snowy.snowCoverTooltip},N("calcite-checkbox",{checked:r.snowCover==="enabled",onCalciteCheckboxChange:s.onSnowCoverChange}),t.snowy.snowCover));case"foggy":return N(Dh,{key:"foggy-cover",disabled:i,debounceDelay:0,label:t.foggy.fogStrength,value:r.fogStrength,onChange:s.onFogStrengthChange})}}_renderWarning(e){return N("div",{key:"warning",class:Fm.warning},N("calcite-icon",{icon:"exclamation-mark-triangle",scale:"s"}),e)}};u([d()],Ud.prototype,"viewModel",void 0),u([d()],Ud.prototype,"view",null),u([d()],Ud.prototype,"headingLevel",void 0),u([d({type:G3e,nonNullable:!0})],Ud.prototype,"visibleElements",void 0),u([d()],Ud.prototype,"iconClass",void 0),u([ze("messages.widgetLabel",{overridable:!0})],Ud.prototype,"label",void 0),u([d(),pr("esri/widgets/Weather/t9n/Weather")],Ud.prototype,"messages",void 0),u([d()],Ud.prototype,"_errorMessage",null),u([d()],Ud.prototype,"_warningMessage",null),Ud=u([L("esri.widgets.Weather")],Ud);const Hkt=Ud,og="esri-daylight",TH=`${og}__container`,js={base:og,widgetIcon:"esri-icon-environment-settings",widget:"esri-widget",select:"esri-select",pause:"esri-icon-pause",play:"esri-icon-play",shadowOff:"esri-slider--shadow-off",shadowOn:"esri-slider--shadow-on",sliderDateOn:"esri-slider--date-on",sliderDateOff:"esri-slider--date-off",sliderAmPmOn:"esri-slider--ampm-on",sliderAlignLeft:"esri-slider--align-left",sliderAlignRight:"esri-slider--align-right",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",secondaryTick:"secondary-tick",dayContainer:`${TH} ${og}__day-container`,dateContainer:`${TH} ${og}__date-container`,containerDisabled:`${TH}--disabled`,playPauseButton:`${og}__play-pause-button`,seasonPicker:`${og}__season-picker`,seasonPickerDisabled:`${og}__season-picker--disabled`,panelError:`${og}__panel--error`,sunLightingCheckbox:`${og}__sun-lighting-checkbox`,shadowsCheckbox:`${og}__shadows-checkbox`};var Og;(function(e){e[e.NORTHERN=0]="NORTHERN",e[e.SOUTHERN=1]="SOUTHERN"})(Og||(Og={}));const sRt={spring:{dayOfMonth:20,month:2},summer:{dayOfMonth:21,month:5},fall:{dayOfMonth:23,month:8},winter:{dayOfMonth:21,month:11}},qJ=["spring","summer","fall","winter"];function xI(e,t,i){const r=dse(t,i),{dayOfMonth:s,month:n}=sRt[r],o=new Date(e.getTime());return o.setMonth(n,s),o}function nRt(e,t){return dse(oRt(e),t)}function oRt(e){const t=e.getTime(),i=xI(e,"spring",Og.NORTHERN).getTime(),r=xI(e,"summer",Og.NORTHERN).getTime(),s=xI(e,"fall",Og.NORTHERN).getTime(),n=xI(e,"winter",Og.NORTHERN).getTime();return t>=i&&t<r?"spring":t>=r&&t<s?"summer":t>=s&&t<n?"fall":"winter"}function dse(e,t){return t===Og.NORTHERN?e:aRt(e)}function aRt(e){const t=qJ.indexOf(e);return qJ[(t+2)%4]}function lRt(e,t){return QWe(e,t,"minutes")}function cRt(e){return KWe(e,"minutes")}function uRt(e,t,i){if(isNaN(e.getTime())&&isNaN(t.getTime()))return 3e5;const l=i.getTime(),c=e.getTime(),h=t.getTime(),p=c-72e5/2,f=c+72e5/2,m=h-72e5/3*2,g=h+72e5/3;let y=3e5;return l>=p&&l<=f?y=l-p<=12e5?18e5-(l-p)/12e5*(18e5-2e5):f-l<=12e5/2?3e5-(f-l)/12e5*2*(3e5-2e5):2e5:l>=m&&l<=g?y=l-m<=12e5/2?3e5-(l-m)/12e5*2*(3e5-2e5):g-l<=12e5?18e5-(g-l)/12e5*(18e5-2e5):2e5:(l<c||l>h)&&(y=18e5),y}const j3e="esri.widgets.Slider.SliderViewModel",hRt=ve.getLogger(j3e);let yc=class extends Ee{constructor(e){super(e),this.precision=4,this.thumbsConstrained=!0}set effectiveMax(e){this.setEffectiveMax(e)}set effectiveMin(e){this.setEffectiveMin(e)}set labelFormatFunction(e){this._set("labelFormatFunction",e)}set inputFormatFunction(e){this._set("inputFormatFunction",e)}set inputParseFunction(e){this._set("inputParseFunction",e)}get labels(){const{max:e,min:t,values:i}=this,r=i&&i.length?i.map((s,n)=>this.getLabelForValue(s,"value",n)):[];return{max:this.getLabelForValue(e,"max"),min:this.getLabelForValue(t,"min"),values:r}}set max(e){this.setMax(e)}set min(e){this.setMin(e)}get state(){const{max:e,min:t}=this;return _(e)&&_(t)&&e>t?"ready":"disabled"}set values(e){const{max:t,min:i}=this,r=this.values;r&&e&&r.length===e.length&&r.every((s,n)=>s===e[n])||(this._set("values",null),e&&e.length&&(_(i)&&e.some(s=>s<i)&&(this.min=Math.min(...e)),_(t)&&e.some(s=>s>t)&&(this.max=Math.max(...e))),this._set("values",e))}toPrecision(e){return parseFloat(e.toFixed(this.precision))}defaultLabelFormatFunction(e){const{max:t,min:i,precision:r}=this,s=t-i>10?2:r;return parseFloat(e.toFixed(s)).toString()}defaultInputFormatFunction(e){return e.toString()}defaultInputParseFunction(e){return parseFloat(e)}getBounds(){const{effectiveMax:e,effectiveMin:t,max:i,min:r}=this;return{min:_(t)?Math.max(r,t):r,max:_(e)?Math.min(i,e):i}}getBoundsForValueAtIndex(e){const{thumbsConstrained:t,values:i}=this,{min:r,max:s}=this.getBounds();if(t){const n=e-1,o=e+1;return{min:_(i[n])?i[n]:r,max:_(i[o])?i[o]:s}}return{min:r,max:s}}getLabelForValue(e,t,i){return M(e)?null:this.labelFormatFunction?this.labelFormatFunction(e,t,i):this.defaultLabelFormatFunction(e)}setMax(e){const{max:t,values:i}=this;if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'max' is NaN.");if(e===null)return void this._set("max",null);const r=this.toPrecision(e);if(t!==r&&(this._set("max",r),i&&i.length))for(let s=0;s<i.length;s++)r<i[s]&&this.setValue(s,r)}setMin(e){const{min:t,values:i}=this;if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'min' is NaN.");if(e===null)return void this._set("min",null);const r=this.toPrecision(e);if(t!==r&&(this._set("min",r),i&&i.length))for(let s=0;s<i.length;s++)r>i[s]&&this.setValue(s,r)}setEffectiveMax(e){if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'effectiveMax' is NaN.");if(e===null)return void this._set("effectiveMax",null);const t=this.toPrecision(e);this.effectiveMax!==t&&this._set("effectiveMax",this._applyBoundsToValue(t))}setEffectiveMin(e){if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'effectiveMin' is NaN.");if(e===null)return void this._set("effectiveMin",null);const t=this.toPrecision(e);this.effectiveMin!==t&&this._set("effectiveMin",this._applyBoundsToValue(t))}setValue(e,t){if(isNaN(t))return void this._logError("slider:invalid-value","Supplied value for member of property 'values' is NaN.");const{values:i}=this,r=i[e],s=this.toPrecision(t);if(r===s)return;const n=[...i];n[e]=s,this._set("values",n),this.notifyChange("labels")}_applyBoundsToValue(e){const{max:t,min:i}=this;return _(i)&&e<i?i:_(t)&&e>t?t:e}_logError(e,t,i){hRt.error(new W(e,t,i))}};u([d()],yc.prototype,"effectiveMax",null),u([d()],yc.prototype,"effectiveMin",null),u([d()],yc.prototype,"labelFormatFunction",null),u([d()],yc.prototype,"inputFormatFunction",null),u([d()],yc.prototype,"inputParseFunction",null),u([d({readOnly:!0})],yc.prototype,"labels",null),u([d()],yc.prototype,"max",null),u([d()],yc.prototype,"min",null),u([d()],yc.prototype,"precision",void 0),u([d({readOnly:!0})],yc.prototype,"state",null),u([d()],yc.prototype,"thumbsConstrained",void 0),u([d()],yc.prototype,"values",null),yc=u([L(j3e)],yc);const H3e=yc;let P0=class extends H3e{constructor(e){super(e),this.items=null,this.currentIndex=0,this.isDropdownOpen=!1}get currentItem(){return this.items!==null&&this.currentIndex!==null&&this.currentIndex<this.items.length?this.items[this.currentIndex]:null}selectItem(e){this.currentIndex=e,this.isDropdownOpen=!1}toggle(){this.isDropdownOpen=!this.isDropdownOpen}};u([d()],P0.prototype,"items",void 0),u([d()],P0.prototype,"currentIndex",void 0),u([d()],P0.prototype,"currentItem",null),u([d()],P0.prototype,"isDropdownOpen",void 0),P0=u([L("esri.widgets.Daylight.SliderWithDropdown")],P0);let TI=class extends Ee{constructor(){super(...arguments),this.state="ready",this.value=new Date}};u([d()],TI.prototype,"state",void 0),u([d()],TI.prototype,"value",void 0),TI=u([L("esri.widgets.support.DateTimeElementViewModel")],TI);const dRt=TI;let WJ=class extends dRt{constructor(e){super(e)}};WJ=u([L("esri.widgets.support.DatePickerViewModel")],WJ);const F8=WJ,pRt={hour:"2-digit",minute:"2-digit",timeZone:"UTC"},fRt={hour:"numeric",timeZone:"UTC"};function Xge(e,t){let i;if(t==="tick"){const s=Math.round(tb(e,"minutes","hours"));i=new Date(tb(s,"hours","milliseconds"))}else i=new Date(6e4*e);let r=Sn(i,pRt);return e!==0&&r==="00:00"&&(r="24:00"),t==="tick"&&r.includes(" ")&&(r=Sn(i,fRt),r=r.replace(":00","")),r}function mRt(e,t,i,r){const s=kb.getTimes(e,t,i),n=s.sunrise,o=s.sunset,a=gp(e,r,"hours"),l=gp(n,r,"hours"),c=gp(o,r,"hours");if(a.getUTCDate()!==l.getUTCDate()||a.getUTCDate()!==c.getUTCDate()){const h=a.getTime()-l.getTime()>0?1:-1;n.setUTCDate(n.getUTCDate()+h),o.setUTCDate(o.getUTCDate()+h)}return{sunrise:n,sunset:o}}function gRt(e){return[{utcOffset:-12,short:"UTC-12",long:e.timezoneDateline},{utcOffset:-11,short:"UTC-11",long:e.timezoneSamoa},{utcOffset:-10,short:e.timezoneHAST,long:e.timezoneHawaii},{utcOffset:-9,short:e.timezoneAKST,long:e.timezoneAlaska},{utcOffset:-8,short:e.timezonePST,long:e.timezoneBaja},{utcOffset:-7,short:e.timezoneMST,long:e.timezoneMountain},{utcOffset:-7,short:e.timezoneMST,long:e.timezoneLaPaz},{utcOffset:-7,short:e.timezoneMST,long:e.timezoneArizona},{utcOffset:-6,short:e.timezoneCST,long:e.timezoneSaskatchewan},{utcOffset:-6,short:e.timezoneCST,long:e.timezoneCentralAmerica},{utcOffset:-6,short:e.timezoneCST,long:e.timezoneCentralTime},{utcOffset:-6,short:e.timezoneCST,long:e.timezoneMexico},{utcOffset:-5,short:e.timezoneEST,long:e.timezoneEasternUS},{utcOffset:-5,short:e.timezoneEST,long:e.timezoneLima},{utcOffset:-5,short:e.timezoneEST,long:e.timezoneIndiana},{utcOffset:-4,short:null,long:e.timezoneAtlantic},{utcOffset:-4,short:null,long:e.timezoneCuiaba},{utcOffset:-4,short:null,long:e.timezoneSantiago},{utcOffset:-4,short:null,long:e.timezoneManaus},{utcOffset:-4,short:null,long:e.timezoneAsuncion},{utcOffset:-3,short:null,long:e.timezoneBrasilia},{utcOffset:-3,short:null,long:e.timezoneGreenland},{utcOffset:-3,short:null,long:e.timezoneMontevideo},{utcOffset:-3,short:null,long:e.timezoneCayenne},{utcOffset:-3,short:null,long:e.timezoneBuenosAires},{utcOffset:-2,short:null,long:e.timezoneMidAtlantic},{utcOffset:-1,short:null,long:e.timezoneAzores},{utcOffset:-1,short:null,long:e.timezoneCaboVerde},{utcOffset:0,short:null,long:e.timezoneDublin},{utcOffset:0,short:null,long:e.timezoneReykjavik},{utcOffset:0,short:null,long:e.timezoneCasablanca},{utcOffset:1,short:e.timezoneCET,long:e.timezoneBelgrade},{utcOffset:1,short:e.timezoneCET,long:e.timezoneSarajevo},{utcOffset:1,short:e.timezoneCET,long:e.timezoneBrussels},{utcOffset:1,short:e.timezoneCET,long:e.timezoneWCAfrica},{utcOffset:1,short:e.timezoneCET,long:e.timezoneAmsterdam},{utcOffset:1,short:e.timezoneCET,long:e.timezoneWindhoek},{utcOffset:2,short:e.timezoneEET,long:e.timezoneMinsk},{utcOffset:2,short:e.timezoneEET,long:e.timezoneCairo},{utcOffset:2,short:e.timezoneEET,long:e.timezoneHelsinki},{utcOffset:2,short:e.timezoneEET,long:e.timezoneAthens},{utcOffset:2,short:e.timezoneEET,long:e.timezoneJerusalem},{utcOffset:2,short:e.timezoneEET,long:e.timezoneAmman},{utcOffset:2,short:e.timezoneEET,long:e.timezoneBeirut},{utcOffset:2,short:e.timezoneEET,long:e.timezoneHarare},{utcOffset:2,short:e.timezoneEET,long:e.timezoneDamascus},{utcOffset:2,short:e.timezoneEET,long:e.timezoneIstanbul},{utcOffset:3,short:e.timezoneMSK,long:e.timezoneKuwait},{utcOffset:3,short:e.timezoneMSK,long:e.timezoneBaghdad},{utcOffset:3,short:e.timezoneMSK,long:e.timezoneNairobi},{utcOffset:3,short:e.timezoneMSK,long:e.timezoneKaliningrad},{utcOffset:4,short:e.timezoneGST,long:e.timezoneMoscow},{utcOffset:4,short:e.timezoneGST,long:e.timezoneMuscat},{utcOffset:4,short:e.timezoneGST,long:e.timezoneBaku},{utcOffset:4,short:e.timezoneGST,long:e.timezoneYerevan},{utcOffset:4,short:e.timezoneGST,long:e.timezoneTbilisi},{utcOffset:4,short:e.timezoneGST,long:e.timezonePortLouis},{utcOffset:5,short:null,long:e.timezoneTashkent},{utcOffset:5,short:null,long:e.timezoneIslamabad},{utcOffset:6,short:null,long:e.timezoneEkaterinburg},{utcOffset:6,short:null,long:e.timezoneAstana},{utcOffset:6,short:null,long:e.timezoneDhaka},{utcOffset:7,short:e.timezoneICT,long:e.timezoneNovosibirsk},{utcOffset:7,short:e.timezoneICT,long:e.timezoneBangkok},{utcOffset:8,short:e.timezoneCCT,long:e.timezoneKrasnoyarsk},{utcOffset:8,short:e.timezoneCCT,long:e.timezoneBeijing},{utcOffset:8,short:e.timezoneCCT,long:e.timezoneSingapore},{utcOffset:8,short:e.timezoneCCT,long:e.timezoneTaipei},{utcOffset:8,short:e.timezoneCCT,long:e.timezonePerth},{utcOffset:8,short:e.timezoneCCT,long:e.timezoneUlaanbaatar},{utcOffset:9,short:e.timezoneJST,long:e.timezoneIrkutsk},{utcOffset:9,short:e.timezoneJST,long:e.timezoneSeoul},{utcOffset:9,short:e.timezoneJST,long:e.timezoneOsaka},{utcOffset:10,short:e.timezoneAEST,long:e.timezoneYakutsk},{utcOffset:10,short:e.timezoneAEST,long:e.timezoneCanberra},{utcOffset:10,short:e.timezoneAEST,long:e.timezoneBrisbane},{utcOffset:10,short:e.timezoneAEST,long:e.timezoneHobart},{utcOffset:10,short:e.timezoneAEST,long:e.timezoneGuam},{utcOffset:11,short:null,long:e.timezoneVladivostok},{utcOffset:11,short:null,long:e.timezoneSolomon},{utcOffset:12,short:e.timezoneNZST,long:e.timezoneMagadan},{utcOffset:12,short:e.timezoneNZST,long:e.timezoneFiji},{utcOffset:12,short:e.timezoneNZST,long:e.timezoneAuckland},{utcOffset:12,short:e.timezoneNZST,long:e.timezoneNukualofa}].map(({utcOffset:t,short:i,long:r})=>{const s=t>0?`UTC+${t}`:t<0?`UTC${t}`:"GMT";return i?{utcOffset:t,short:i,shortWithUTC:`${s} (${i})`,long:r}:{utcOffset:t,short:s,shortWithUTC:s,long:r}})}let ds=class extends yv{constructor(e){super(e),this.view=null,this.datePickerViewModel=new F8,this.timeSliderViewModel=new P0,this.lightingUpdateInterval=200,this._oldLighting=null,this.playSpeedMultiplier=1,this._cachedLightingDateUTC=new Date(0),this._cachedDisplayUTCOffset=0,this._firstInteraction=!0,this._lastLightingUpdate=0,this._nextLightingUpdate=null}initialize(){this.handles.add([Jn(()=>this.view,e=>e.when(()=>this._updateLighting(null)),Et),re(()=>wt(this._lighting,e=>e.type==="sun"?e.date:null),e=>this._scheduleUpdateLighting(e)),os(()=>this._lighting,"timezone-will-change",e=>this._timezoneWillChange(e),{onListenerAdd:()=>this._timezoneWillChange(null)}),re(()=>wt(this.view,e=>e.stationary)===!0,()=>{(this.dayPlaying||this.yearPlaying)&&this._updateSunriseAndSunset()},Et),re(()=>{const e=this.timeSliderViewModel;return{vm:e,state:e.state,sliderPosition:this.timeSliderPosition}},({vm:e,state:t,sliderPosition:i})=>{t==="ready"&&e.setValue(0,i)}),re(()=>{var e;return(e=this.timeSliderViewModel.currentItem)==null?void 0:e.utcOffset},e=>this.utcOffset=e),re(()=>this.timeSliderViewModel.isDropdownOpen,()=>this.stopPlaying()),re(()=>this.timeSliderViewModel.values,e=>this.timeSliderPosition=e[0]),re(()=>this.datePickerViewModel.value,e=>{this.dayPlaying=!1,this.localDate=e}),re(()=>this.localDate,e=>{this.datePickerViewModel.value.valueOf()!==e.getTime()&&this.datePickerViewModel.set("value",e)})])}destroy(){this._nextLightingUpdate&&(clearTimeout(this._nextLightingUpdate),this._nextLightingUpdate=null),this.view=null}get isSupported(){return M(this.view)||this.view.type==="3d"}get utcOffset(){return this._cachedDisplayUTCOffset}set utcOffset(e){e!==this.utcOffset&&_(this._lighting)&&this._lighting.type==="sun"&&(this._lighting.displayUTCOffset=e,this._updateLighting(null))}get localDate(){return tZe(this._lightingDateDisplay)}set localDate(e){e.getTime()!==this.localDate.getTime()&&(this._lightingDateDisplay=eZe(this._lightingDateDisplay,e))}get timeSliderPosition(){return cRt(this._lightingDateDisplay)}set timeSliderPosition(e){Math.abs(e-this.timeSliderPosition)>1/60&&(this._lightingDateDisplay=lRt(this._lightingDateDisplay,e),this.stopPlaying(),this._enableDirectShadowsIfFirstInteraction())}_timezoneFromCamera(e,t){if(M(t)||!e.cameraTrackingEnabled)return 0;const i=DY([t.longitude,t.latitude]);return M(i)?0:Math.round(i.hours+i.minutes/60+i.seconds/3600)}get directShadowsEnabled(){const e=wt(this._lighting,t=>t.directShadowsEnabled);return Ye(e,!1)}set directShadowsEnabled(e){wt(this._lighting,t=>{t.directShadowsEnabled=e})}get sunLightingEnabled(){return this._lightingType==="sun"}set sunLightingEnabled(e){const t=this._environment;if(e===this._get("sunLightingEnabled")||M(t))return;const i=t.lighting,r=this._oldLighting;this._oldLighting=i;const s={directShadowsEnabled:i.directShadowsEnabled,ambientOcclusionEnabled:i.ambientOcclusionEnabled,waterReflectionEnabled:i.waterReflectionEnabled},n=e?"sun":"virtual";let o;o=_(r)&&r.type===n?r:e?new yg:new GC,o.set(s),t.lighting=o,e||(this.timeSliderViewModel.isDropdownOpen=!1)}set playingState(e){this.playingState!==e&&this.sunLightingEnabled&&(this._set("playingState",e),e!=="none"&&(this._updateSunriseAndSunset(),this._lastTime=Date.now(),this._play(),this._enableDirectShadowsIfFirstInteraction()))}get dayPlaying(){return this.playingState==="day"}set dayPlaying(e){e?this.playingState="day":this.dayPlaying&&(this.playingState="none")}get yearPlaying(){return this.playingState==="year"}set yearPlaying(e){e?this.playingState="year":this.yearPlaying&&(this.playingState="none")}get currentSeason(){return nRt(this.localDate,this._currentHemisphere)}set currentSeason(e){this.stopPlaying();const t=dse(e,this._currentHemisphere);this.localDate=xI(this.localDate,t,Og.NORTHERN)}get _currentHemisphere(){const e=wt(this.view,t=>{var i;return(i=t.camera)==null?void 0:i.position});return M(e)||e.latitude>=0?Og.NORTHERN:Og.SOUTHERN}get _environment(){return wt(this.view,e=>e.environment)}get _lighting(){return wt(this._environment,e=>e.lighting)}get _lightingType(){return wt(this._lighting,e=>e.type)}get _lightingDateDisplay(){return gp(this._cachedLightingDateUTC,this._cachedDisplayUTCOffset,"hours")}set _lightingDateDisplay(e){const t=this._lighting;if(M(t)||!this.sunLightingEnabled||t.type!=="sun")return;const i=gp(e,-this._cachedDisplayUTCOffset,"hours");i.getTime()!==t.date.getTime()&&(t.date=i,this._updateLighting(null))}stopPlaying(){this.playingState="none"}toggleDayPlaying(){this.dayPlaying=!this.dayPlaying}toggleYearPlaying(){this.yearPlaying=!this.yearPlaying}toggleSunLightingEnabled(){this.stopPlaying(),this.sunLightingEnabled=!this.sunLightingEnabled}toggleDirectShadowsEnabled(){this.stopPlaying(),this.directShadowsEnabled=!this.directShadowsEnabled}_enableDirectShadowsIfFirstInteraction(){this._firstInteraction&&(this._firstInteraction=!1,this.directShadowsEnabled=!0)}_updateLighting(e){var a;const t=Date.now();this._lastLightingUpdate=t;const{view:i}=this,r=this._lighting;if(M(i)||M(r)||r.type!=="sun")return;const s=e||r.date,n=r.displayUTCOffset,o=n!==null?n:this._timezoneFromCamera(r,(a=i.camera)==null?void 0:a.position);this._cachedLightingDateUTC.getTime()!==s.getTime()&&(this._cachedLightingDateUTC=new Date(s.getTime())),this._cachedDisplayUTCOffset!==o&&(this._cachedDisplayUTCOffset=o)}_timezoneWillChange(e){const t=this._lighting;if(M(t)||t.type!=="sun"||!t.cameraTrackingEnabled)return;let i;if(e)i=e.timezoneOffset;else{if(t.displayUTCOffset!=null)return;i=yg.calculateTimezoneOffset(t.positionTimezoneInfo)}t.displayUTCOffset=i,this._scheduleUpdateLighting(null)}_scheduleUpdateLighting(e){if(this._nextLightingUpdate||M(e))return;const t=Date.now()-this._lastLightingUpdate,i=this.lightingUpdateInterval-t;i<=0?Zb(()=>this._updateLighting(e)):this._nextLightingUpdate=setTimeout(()=>{this._updateLighting(null),this._nextLightingUpdate=null},i)}_play(){const e=this._lighting;if(!M(e)&&this.sunLightingEnabled&&e.type==="sun"&&(this.dayPlaying||this.yearPlaying)){const t=Date.now()-this._lastTime;if(this.dayPlaying){this._lastTime=Date.now();const i=uRt(this._sunrise,this._sunset,e.date)*this.playSpeedMultiplier/100*t;if(i>0){let r=new Date(e.date.getTime()+i);((r.getUTCHours()+e.displayUTCOffset)%24+24)%24<((e.date.getUTCHours()+e.displayUTCOffset)%24+24)%24&&(r=new Date(e.date.getTime()+i-864e5)),e.date=r}}else if(t>1e3){this._lastTime=Date.now();const i=(e.date.getUTCMonth()+1)%12,r=new Date(e.date.getTime());r.setUTCMonth(i),e.date=r}requestAnimationFrame(()=>this._play())}}_updateSunriseAndSunset(){const e=this._lighting;if(M(e)||e.type!=="sun"||!this.sunLightingEnabled)return;const t=wt(this.view,r=>{var s;return(s=r.camera)==null?void 0:s.position});if(M(t))return;const i=mRt(e.date,t.latitude,t.longitude,e.displayUTCOffset);this._sunrise=new Date(i.sunrise),this._sunset=new Date(i.sunset)}};u([d({type:WOt})],ds.prototype,"view",void 0),u([d({type:F8,nonNullable:!0})],ds.prototype,"datePickerViewModel",void 0),u([d({type:P0,nonNullable:!0})],ds.prototype,"timeSliderViewModel",void 0),u([d()],ds.prototype,"isSupported",null),u([d()],ds.prototype,"lightingUpdateInterval",void 0),u([d()],ds.prototype,"utcOffset",null),u([d()],ds.prototype,"localDate",null),u([d()],ds.prototype,"timeSliderPosition",null),u([d()],ds.prototype,"directShadowsEnabled",null),u([d()],ds.prototype,"sunLightingEnabled",null),u([d({type:["none","day","year"],value:"none"})],ds.prototype,"playingState",null),u([d()],ds.prototype,"dayPlaying",null),u([d()],ds.prototype,"yearPlaying",null),u([d()],ds.prototype,"playSpeedMultiplier",void 0),u([d()],ds.prototype,"currentSeason",null),u([d()],ds.prototype,"_lastTime",void 0),u([d()],ds.prototype,"_sunrise",void 0),u([d()],ds.prototype,"_sunset",void 0),u([d()],ds.prototype,"_cachedLightingDateUTC",void 0),u([d()],ds.prototype,"_cachedDisplayUTCOffset",void 0),u([d()],ds.prototype,"_firstInteraction",void 0),u([d()],ds.prototype,"_currentHemisphere",null),u([d()],ds.prototype,"_environment",null),u([d()],ds.prototype,"_lighting",null),u([d()],ds.prototype,"_lightingType",null),u([d()],ds.prototype,"_lightingDateDisplay",null),ds=u([L("esri.widgets.Daylight.DaylightViewModel")],ds);const q3e=ds;let g0=class extends Ee{constructor(){super(...arguments),this.header=!0,this.playButtons=!0,this.datePicker=!0,this.timezone=!0,this.sunLightingToggle=!0,this.shadowsToggle=!0}};u([d({type:Boolean,nonNullable:!0})],g0.prototype,"header",void 0),u([d({type:Boolean,nonNullable:!0})],g0.prototype,"playButtons",void 0),u([d({type:Boolean,nonNullable:!0})],g0.prototype,"datePicker",void 0),u([d({type:Boolean,nonNullable:!0})],g0.prototype,"timezone",void 0),u([d({type:Boolean,nonNullable:!0})],g0.prototype,"sunLightingToggle",void 0),u([d({type:Boolean,nonNullable:!0})],g0.prototype,"shadowsToggle",void 0),g0=u([L("esri.widgets.Daylight.VisibleElements")],g0);const W3e=g0,vi={base:"esri-slider",reversed:"esri-slider--reversed",horizontalLayout:"esri-slider--horizontal",verticalLayout:"esri-slider--vertical",contentElement:"esri-slider__content",extraContentElement:"esri-slider__extra-content",trackElement:"esri-slider__track",ticksContainerElement:"esri-slider__ticks",tickElement:"esri-slider__tick",tickLabelElement:"esri-slider__tick-label",maxElement:"esri-slider__max",minElement:"esri-slider__min",maxElementInteractive:"esri-slider__max--interactive",minElementInteractive:"esri-slider__min--interactive",rangeElementActive:"esri-slider__range--active",rangeInput:"esri-slider__range-input",anchorElement:"esri-slider__anchor",movingAnchorElement:"esri-slider__anchor--moving",lastMovedAnchorElement:"esri-slider__anchor--moved",anchorElementActive:"esri-slider__anchor--active",anchorElementIndexPrefix:"esri-slider__anchor-",segmentElement:"esri-slider__segment",segmentElementIndexPrefix:"esri-slider__segment-",segmentElementInteractive:"esri-slider__segment--interactive",segmentElementActive:"esri-slider__segment--active",effectiveSegmentElement:"esri-slider__effective-segment",effectiveMaxSegmentElement:"esri-slider__effective-max-segment",effectiveMinSegmentElement:"esri-slider__effective-min-segment",thumbElement:"esri-slider__thumb",labelElement:"esri-slider__label",labelElementInteractive:"esri-slider__label--interactive",labelInput:"esri-slider__label-input",esriWidget:"esri-widget",widgetIcon:"esri-icon-edit",disabled:"esri-disabled",hidden:"esri-hidden"},tu={showInput:"Enter",hideInput1:"Enter",hideInput2:"Escape",hideInput3:"Tab",moveAnchorUp:"ArrowUp",moveAnchorDown:"ArrowDown",moveAnchorLeft:"ArrowLeft",moveAnchorRight:"ArrowRight",moveAnchorToMax:"End",moveAnchorToMin:"Home"},yRt="esri.widgets.Slider",Yge={labels:!1,rangeLabels:!1};let Gi=class extends Yr{constructor(e,t){super(e,t),this._activeLabelInputIndex=null,this._anchorElements=[],this._dragged=!1,this._dragStartInfo=null,this._focusedAnchorIndex=null,this._isMinInputActive=!1,this._isMaxInputActive=!1,this._lastMovedHandleIndex=null,this._positionPrecision=5,this._segmentDragStartInfo=null,this._trackHeight=null,this._trackWidth=null,this._zIndices=null,this._zIndexOffset=3,this.disabled=!1,this.draggableSegmentsEnabled=!0,this.effectiveMax=null,this.effectiveMin=null,this.effectiveSegmentElements=new nt,this.extraNodes=[],this.inputCreatedFunction=null,this.inputFormatFunction=null,this.inputParseFunction=null,this.label=void 0,this.labelElements=new nt,this.labelInputsEnabled=!1,this.labelFormatFunction=null,this.labels=null,this.max=null,this.maxLabelElement=null,this.messages=null,this.min=null,this.minLabelElement=null,this.precision=4,this.rangeLabelInputsEnabled=!1,this.segmentElements=new nt,this.snapOnClickEnabled=!0,this.steps=null,this.syncedSegmentsEnabled=!1,this.thumbsConstrained=!0,this.thumbCreatedFunction=null,this.thumbElements=new nt,this.tickElements=new nt,this.trackElement=null,this.values=null,this.viewModel=new H3e,this.visibleElements=F({},Yge),this._onAnchorPointerDown=this._onAnchorPointerDown.bind(this),this._onAnchorPointerMove=this._onAnchorPointerMove.bind(this),this._onAnchorPointerUp=this._onAnchorPointerUp.bind(this),this._onLabelPointerDown=this._onLabelPointerDown.bind(this),this._onLabelPointerUp=this._onLabelPointerUp.bind(this),this._onSegmentPointerDown=this._onSegmentPointerDown.bind(this),this._onSegmentPointerMove=this._onSegmentPointerMove.bind(this),this._onSegmentPointerUp=this._onSegmentPointerUp.bind(this),this._onTrackPointerDown=this._onTrackPointerDown.bind(this),this._onTrackPointerMove=this._onTrackPointerMove.bind(this),this._onTrackPointerUp=this._onTrackPointerUp.bind(this)}destroy(){document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove),document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),this.labelElements.removeAll(),this.labelElements.destroy(),this.segmentElements.removeAll(),this.segmentElements.destroy(),this.effectiveSegmentElements.removeAll(),this.effectiveSegmentElements.destroy(),this.thumbElements.removeAll(),this.thumbElements.destroy(),this.tickElements.removeAll(),this.tickElements.destroy()}set layout(e){["vertical","vertical-reversed","horizontal","horizontal-reversed"].includes(e)||(e="horizontal"),this._set("layout",e)}get state(){const{_activeLabelInputIndex:e,_isMaxInputActive:t,_isMinInputActive:i,_dragStartInfo:r,_segmentDragStartInfo:s,disabled:n,viewModel:o}=this,a=_(r)||_(s);return n?"disabled":e===null&&!t&&!i?a?"dragging":o.state:"editing"}set tickConfigs(e){this._set("tickConfigs",e),this.scheduleRender()}castVisibleElements(e){return F(F({},Yge),e)}render(){const{label:e}=this,t=this.classes(vi.base,vi.esriWidget,this._isHorizontalLayout()?vi.horizontalLayout:vi.verticalLayout,this._isReversedLayout()?vi.reversed:null,this._isDisabled()?vi.disabled:null);return this._storeTrackDimensions(),N("div",{"aria-label":e,class:t,"touch-action":"none",bind:this,afterCreate:this._afterContainerCreate},this.renderContent())}toNextStep(e){this._toStep(e,1)}toPreviousStep(e){this._toStep(e,-1)}renderContent(){const{max:e,min:t}=this;if(!(M(t)||M(e)||t>=e))return[this.renderMin(),this.renderSliderContainer(),this.renderMax()]}renderSliderContainer(){return N("div",{key:"slider-container",bind:this,class:vi.contentElement},this.renderTrackElement(),this.renderTicksContainer(),this.renderExtraContentElements())}renderTrackElement(){return N("div",{afterCreate:this._afterTrackCreate,afterRemoved:this._afterTrackRemoved,bind:this,class:vi.trackElement,"data-node-ref":"trackElement","touch-action":"none"},this.renderEffectiveSegmentElements(),this.renderSegmentElements(),this.renderAnchorElements())}renderEffectiveSegmentElements(){if(!this.trackElement||!this.values||!this.values.length)return;const e=_(this.effectiveMax),t=_(this.effectiveMin);if(!e&&!t)return;const{max:i,min:r,viewModel:s}=this,n=s.getBounds(),o=[];return t&&o.push(this.renderEffectiveSegmentElement(r,n.min,!0)),e&&o.push(this.renderEffectiveSegmentElement(n.max,i,!1)),o}renderSegmentElements(){if(!this.trackElement||!this.values||!this.values.length)return;const e=this.values.length,t=[];for(let i=0;i<=e;i++)t.push(this.renderSegmentElement(i));return t}renderSegmentElement(e){const{_trackHeight:t,_trackWidth:i,draggableSegmentsEnabled:r,id:s,state:n,values:o}=this,a=this._isHorizontalLayout(),l=a?i:t,c=this.viewModel.getBounds(),h=this._positionFromValue(c.max),p=this._positionFromValue(c.min),f=e===o.length?null:e,m=e===0?null:e-1,g=_(f),y=_(m);let x,b;const S=[...o].sort((D,U)=>D-U);this._isReversedLayout()?(x=y?this._positionFromValue(S[m]):p,b=g?this._positionFromValue(S[f]):h):(x=g?this._positionFromValue(S[f]):h,b=y?this._positionFromValue(S[m]):p);const T=this._applyPrecisionToPosition(100*b/l),C=(x-b)/l,A=a?`transform: translate(${T}%, 0px) scale(${C}, 1);`:`transform: translate(0px, ${T}%) scale(1, ${C});`,O=this.classes(vi.segmentElement,vi.segmentElementIndexPrefix+e,r&&g&&y&&n!=="disabled"?vi.segmentElementInteractive:null);return N("div",{afterCreate:this._afterSegmentCreate,afterRemoved:this._afterSegmentRemoved,bind:this,class:O,"data-max-thumb-index":f,"data-min-thumb-index":m,"data-segment-index":e,key:`${s}-segment-${e}`,style:A,"touch-action":"none"})}renderEffectiveSegmentElement(e,t,i){const{_trackHeight:r,_trackWidth:s,layout:n}=this,o=this._positionFromValue(e),a=this._positionFromValue(t),l=this._isHorizontalLayout(),c=l?s:r,h=this._applyPrecisionToPosition(100*o/c);let p=null;if(n==="horizontal"){const g=i?c-a:a,y=o===c?0:h;p=`clip-path: inset(0% ${a===c?0:this._applyPrecisionToPosition(g/c*100)}% 0% ${y}%);`}else{const g=(a-o)/c;p=l?`transform: translate(${h}%, 0px) scale(${g}, 1);`:`transform: translate(0px, ${h}%) scale(1, ${g});`}const f=i?vi.effectiveMinSegmentElement:vi.effectiveMaxSegmentElement,m=this.classes(vi.segmentElement,vi.effectiveSegmentElement,f);return N("div",{afterCreate:this._afterEffectiveSegmentCreate,afterRemoved:this._afterEffectiveSegmentRemoved,bind:this,class:m,style:p,"touch-action":"none"})}renderAnchorElements(){const{trackElement:e,values:t}=this;if(t&&t.length)return this._zIndices=t.map((i,r)=>{const s=this._positionFromValue(i),n=this._positionToPercent(s),o=(this._isHorizontalLayout()?n>50:n<50)?-1:1;return this._zIndexOffset+(t.length+o*r)}),e&&t&&t.length?t.map((i,r)=>this.renderAnchorElement(i,r)):null}renderAnchorElement(e,t){const i=this._positionFromValue(e),r=this._valueFromPosition(i);if(M(r)||isNaN(r))return;const{_dragStartInfo:s,_lastMovedHandleIndex:n,id:o,layout:a,values:l,visibleElements:{labels:c}}=this,h=s&&s.index===t,p=n===t,f=this.classes(vi.anchorElement,vi.anchorElementIndexPrefix+t,h?vi.movingAnchorElement:null,p?vi.lastMovedAnchorElement:null),m=this.labels.values[t],g=this._getStyleForAnchor(e,t,h||p),{min:y,max:x}=this.viewModel.getBoundsForValueAtIndex(t),{disabled:b,messages:S}=this,T=l.length===2?xc(t===0?S.rangeMinimum:S.rangeMaximum,{value:e}):m,C=l.length===1?null:t===0?`${o}-handle-${t+1}`:t===l.length-1?`${o}-handle-${t-1}`:`${o}-handle-${t-1} ${o}-handle-${t+1}`;return N("div",{afterCreate:this._afterAnchorCreate,afterUpdate:this._afterAnchorUpdate,afterRemoved:this._afterAnchorRemoved,"aria-controls":C,"aria-label":S.sliderValue,"aria-labelledby":c?`${o}-label-${t}`:null,"aria-orientation":a,"aria-valuemax":x.toString(),"aria-valuemin":y.toString(),"aria-valuenow":e.toString(),"aria-valuetext":T,bind:this,class:f,"data-thumb-index":t,"data-value":e,id:`${o}-handle-${t}`,key:`${o}-handle-${t}`,onkeydown:this._onAnchorKeyDown,"touch-action":"none",role:"slider",style:g,tabIndex:b?-1:0},N("span",{afterCreate:this._afterThumbCreate,afterRemoved:this._afterThumbRemoved,bind:this,class:vi.thumbElement,"data-thumb-index":t,"touch-action":"none"}),this.renderThumbLabel(t))}renderThumbLabel(e){const{id:t,labels:i,labelInputsEnabled:r,state:s}=this,n=this.visibleElements.labels,o=i.values[e],a=this.classes(vi.labelElement,n?null:vi.hidden,r&&s!=="disabled"?vi.labelElementInteractive:null);return N("span",{afterCreate:this._afterLabelCreate,afterRemoved:this._afterLabelRemoved,"aria-hidden":(!n).toString(),bind:this,class:a,"data-thumb-index":e,key:`${t}-label-${e}`,id:`${t}-label-${e}`,role:r?"button":null,"touch-action":"none"},this._activeLabelInputIndex===e?this.renderValueInput(e):o)}renderValueInput(e){const{disabled:t,values:i}=this,r=i[e];return N("input",{key:`value-input-${e}`,afterCreate:this._afterInputCreate,"aria-label":this.messages.sliderValue,bind:this,class:vi.labelInput,"data-input-type":"thumb","data-input-index":e,required:!0,tabIndex:t?-1:0,type:"text",value:this._formatInputValue(r,"value",e),onblur:this._onLabelInputBlur,onkeydown:this._onInputKeyDown})}renderMax(){const{_isMaxInputActive:e,labels:t,rangeLabelInputsEnabled:i,state:r}=this,s=this.visibleElements.rangeLabels,n=this.classes(vi.maxElement,{[vi.hidden]:!s,[vi.maxElementInteractive]:i&&r!=="disabled",[vi.rangeElementActive]:e});return N("div",{"aria-hidden":(!s).toString(),afterCreate:this._afterMaxLabelCreate,bind:this,class:n,onclick:this._onMaxLabelClick,onkeydown:this._onMaxLabelKeyDown,role:i?"button":null,tabIndex:!this.disabled&&i?0:-1},e?this.renderMaxInput():t.max)}renderMin(){const{_isMinInputActive:e,labels:t,rangeLabelInputsEnabled:i,state:r}=this,s=this.visibleElements.rangeLabels,n=this.classes(vi.minElement,{[vi.hidden]:!s,[vi.minElementInteractive]:i&&r!=="disabled",[vi.rangeElementActive]:e});return N("div",{"aria-hidden":(!s).toString(),afterCreate:this._afterMinLabelCreate,bind:this,class:n,onclick:this._onMinLabelClick,onkeydown:this._onMinLabelKeyDown,role:i?"button":null,tabIndex:!this.disabled&&i?0:-1},e?this.renderMinInput():t.min)}renderMaxInput(){return N("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.maximumValue,bind:this,class:vi.rangeInput,"data-input-type":"max",required:!0,tabIndex:this.disabled?-1:0,type:"text",value:this._formatInputValue(this.max,"max"),onblur:this._onMaxInputBlur,onkeydown:this._onInputKeyDown})}renderMinInput(){return N("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.minimumValue,bind:this,class:vi.rangeInput,"data-input-type":"min",required:!0,tabIndex:this.disabled?-1:0,type:"text",value:this._formatInputValue(this.min,"min"),onblur:this._onMinInputBlur,onkeydown:this._onInputKeyDown})}renderExtraContentElements(){return N("div",{bind:this,class:vi.extraContentElement},this.extraNodes)}renderTicksContainer(){if(this.tickConfigs&&this.trackElement&&(this._trackHeight!==0||this._trackWidth!==0))return this.tickConfigs.map((e,t)=>N("div",{key:"ticks-container",class:this.classes(vi.ticksContainerElement)},this.renderTicks(e,t)))}renderTicks(e,t){const{mode:i,values:r}=e;if(this.tickElements.getItemAt(t)||this.tickElements.add(new nt,t),i==="position"){const o=Array.isArray(r)?r:[r];return this._calculateTickPositions(o).map((a,l)=>this.renderTickGroup(e,l,t,a))}if(i==="percent"&&Array.isArray(r)){const{max:o,min:a}=this,l=o-a,c=r.map(h=>this._applyPrecisionToPosition(h/100*l+a));return this._calculateTickPositions(c).map((h,p)=>this.renderTickGroup(e,p,t,h))}const s=Array.isArray(r)&&r.length?r[0]:isNaN(r)?null:r,n=this._getTickCounts(s,e);return this._calculateEquidistantTickPositions(n).map((o,a)=>this.renderTickGroup(e,a,t,o))}renderTickGroup(e,t,i,r){const s=e.mode==="position"?Array.isArray(e.values)?e.values[t]:e.values:this._valueFromPosition(r);if(!M(s)&&!isNaN(s))return N("div",{afterCreate:this._afterTickGroupCreate,afterRemoved:this._afterTickGroupRemoved,bind:this,"data-config":e,"data-position":r,"data-tick-config-index":i,"data-tick-group-index":t,"data-value":s,onclick:this._onTickGroupClick,key:`tick-group-${t}`},this.renderTickLine(e,t,i,s),e.labelsVisible?this.renderTickLabel(e,t,i,s):null)}renderTickLine(e,t,i,r){return N("div",{afterCreate:this._afterTickLineCreate,"aria-valuenow":r.toString(),bind:this,class:vi.tickElement,"data-config":e,"data-tick-config-index":i,"data-tick-group-index":t,"data-value":r,key:`tick-label-${t}`,style:this._getPositionStyleForElement(r)})}renderTickLabel(e,t,i,r){const s=e.labelFormatFunction?e.labelFormatFunction(r,"tick",t):this.viewModel.getLabelForValue(r,"tick",t);return N("div",{afterCreate:this._afterTickLabelCreate,"aria-label":s,"aria-valuenow":r.toString(),"aria-valuetext":s,bind:this,class:vi.tickLabelElement,"data-config":e,"data-tick-config-index":i,"data-tick-group-index":t,"data-value":r,key:`tick-label-${t}`,style:`transform: translate(-50%); ${this._getPositionStyleForElement(r)}`},s)}_afterContainerCreate(e){this.own(vxe(e,()=>this.scheduleRender()))}_afterTrackCreate(e){this._set("trackElement",e),e.addEventListener("pointerdown",this._onTrackPointerDown),this.scheduleRender()}_afterTrackRemoved(e){e.removeEventListener("pointerdown",this._onTrackPointerDown),document.removeEventListener("pointermove",this._onTrackPointerMove),document.removeEventListener("pointerup",this._onTrackPointerUp)}_afterSegmentCreate(e){this.segmentElements.add(e),e.addEventListener("pointerdown",this._onSegmentPointerDown)}_afterSegmentRemoved(e){this.segmentElements.remove(e),e.removeEventListener("pointerdown",this._onSegmentPointerDown)}_afterEffectiveSegmentCreate(e){this.effectiveSegmentElements.add(e)}_afterEffectiveSegmentRemoved(e){this.effectiveSegmentElements.remove(e)}_afterAnchorCreate(e){if(this._anchorElements.push(e),e.addEventListener("pointerdown",this._onAnchorPointerDown),this.thumbCreatedFunction){const t=e["data-thumb-index"],i=e["data-value"],r=this.thumbElements.getItemAt(t)||null,s=this.labelElements.getItemAt(t)||null;this.thumbCreatedFunction(t,i,r,s)}}_afterAnchorUpdate(e){_(this._focusedAnchorIndex)&&e["data-thumb-index"]===this._focusedAnchorIndex&&(e.focus(),this._focusedAnchorIndex=null)}_afterAnchorRemoved(e){const t=this._anchorElements.indexOf(e,0);t>-1&&this._anchorElements.splice(t,1),e.removeEventListener("pointerdown",this._onAnchorPointerDown)}_afterThumbCreate(e){this.thumbElements.add(e)}_afterThumbRemoved(e){this.thumbElements.remove(e)}_afterLabelCreate(e){this.labelElements.add(e),e.addEventListener("pointerdown",this._onLabelPointerDown),e.addEventListener("pointerup",this._onLabelPointerUp)}_afterLabelRemoved(e){this.labelElements.remove(e),e.removeEventListener("pointerdown",this._onLabelPointerDown),e.removeEventListener("pointerup",this._onLabelPointerUp)}_afterInputCreate(e){if(e.focus(),e.select(),this.inputCreatedFunction){const t=e.getAttribute("data-input-type"),i=t==="thumb"?e["data-input-index"]:null;this.inputCreatedFunction(e,t,i)}}_afterTickLineCreate(e){const t=e["data-tick-config-index"],i=e["data-tick-group-index"],r=this.tickElements.getItemAt(t);r.getItemAt(i)?r.getItemAt(i).tickElement=e:r.add({groupElement:null,tickElement:e,labelElement:null},i)}_afterTickLabelCreate(e){const t=e["data-tick-config-index"],i=e["data-tick-group-index"],r=this.tickElements.getItemAt(t);r.getItemAt(i)?r.getItemAt(i).labelElement=e:r.add({groupElement:null,labelElement:e,tickElement:null},i)}_afterTickGroupRemoved(e){const t=e["data-tick-config-index"],i=this.tickElements.items[t],r=i==null?void 0:i.find(s=>s.groupElement===e);r&&i.remove(r)}_afterTickGroupCreate(e){var i,r;const t=e["data-config"];if(t&&t.tickCreatedFunction){const s=e["data-tick-config-index"],n=e["data-tick-group-index"],o=e["data-value"],a=(r=(i=this.tickElements)==null?void 0:i.getItemAt(s))==null?void 0:r.getItemAt(n);if(a){a.groupElement=e;const l=a.tickElement||null,c=a.labelElement||null;t.tickCreatedFunction(o,l,c)}}}_afterMaxLabelCreate(e){this._set("maxLabelElement",e)}_afterMinLabelCreate(e){this._set("minLabelElement",e)}_onAnchorKeyDown(e){if(this._isDisabled()||this.state==="editing")return;const{target:t}=e,i=Mc(e),{_anchorElements:r,values:s}=this,n=t["data-thumb-index"],o=r[n],a=s[n],l=[tu.moveAnchorUp,tu.moveAnchorDown,tu.moveAnchorLeft,tu.moveAnchorRight];if(i===tu.showInput&&this.labelInputsEnabled)this._activeLabelInputIndex=n,this.notifyChange("state");else if(l.includes(i)){e.preventDefault();const{steps:c}=this,h=i===tu.moveAnchorUp||i===tu.moveAnchorRight?1:-1;if(_(c))this._toStep(n,this._isReversedLayout()?-1*h:h);else{const{precision:f}=this,m=this._getPositionOfElement(o),g=this._valueFromPosition(m),y=this._isHorizontalLayout()?h:-1*h;let x;x=f===0?this._positionFromValue(g+y):f===1?this._positionFromValue(g+.1*y):m+y,this._toPosition(n,x)}const p=this.values[n];a!==p&&this._emitThumbChangeEvent({index:n,oldValue:a,value:p})}else if(i===tu.moveAnchorToMax||i===tu.moveAnchorToMin){e.preventDefault();const{min:c,max:h}=this._getAnchorBoundsInPixels(n),p=this._isPositionInverted()?i===tu.moveAnchorToMax?c:h:i===tu.moveAnchorToMin?c:h;this._toPosition(n,p);const f=this.values[n];a!==f&&this._emitThumbChangeEvent({index:n,oldValue:a,value:f})}}_onAnchorPointerDown(e){if(this._isDisabled())return;const{target:t,clientX:i,clientY:r}=e,s=t["data-thumb-index"];s!==void 0&&(e.preventDefault(),this._anchorElements[s]&&this._anchorElements[s].focus(),this._storeTrackDimensions(),this._dragStartInfo={clientX:i,clientY:r,index:s,position:this._getPositionOfElement(this._anchorElements[s])},this.notifyChange("state"),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}_onAnchorPointerMove(e){if(this.state==="editing"||!this._dragStartInfo)return;e.preventDefault();const{values:t,_anchorElements:i,_dragged:r,_dragStartInfo:s,_dragStartInfo:{index:n,position:o}}=this,{clientX:a,clientY:l}=e,c=r?"drag":"start",h=i[n],p=this._getPositionOfElement(h),f=this._applyPrecisionToPosition(this._isHorizontalLayout()?o+a-s.clientX:o+l-s.clientY);if(p===f)return;const m=t[n];this._dragged=!0,this._toPosition(n,f);const g=this.values[n];r?m!==g&&this._emitThumbDragEvent({index:n,state:c,value:g}):this._emitThumbDragEvent({index:n,state:c,value:m})}_onAnchorPointerUp(e){if(document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),!this._dragStartInfo)return;e.preventDefault();const{index:t}=this._dragStartInfo,i=this._dragged,r=this.values[t];this._dragged=!1,this._dragStartInfo=null,this._lastMovedHandleIndex=t,this.notifyChange("state"),i?this._emitThumbDragEvent({index:t,state:"stop",value:r}):(this.scheduleRender(),this.state!=="editing"&&this._emitThumbClickEvent({index:t,value:r}))}_onTrackPointerDown(e){const{_dragStartInfo:t,snapOnClickEnabled:i,state:r,values:s}=this;if(this._isDisabled()||r==="editing"||t||(document.addEventListener("pointermove",this._onTrackPointerMove),document.addEventListener("pointerup",this._onTrackPointerUp),!i||!s.length))return;const{steps:n}=this,{clientX:o,clientY:a}=e,l=this._getCursorPositionFromEvent(e),c=this._valueFromPosition(l),h=this._getIndexOfNearestValue(c),p=s[h],f=s.some((x,b)=>x===p&&b!==h)&&c>p?this.values.lastIndexOf(p):h;if(M(f))return;const m=s[f],g=_(n)?this._calculateNearestStepPosition(l):l;this._toPosition(f,g),this._dragged=!0,this._dragStartInfo={clientX:o,clientY:a,index:f,position:g},this._focusedAnchorIndex=f,this.notifyChange("state"),this._emitThumbDragEvent({index:f,state:"start",value:m});const y=this.values[f];m!==y&&this._emitThumbDragEvent({index:f,state:"drag",value:y}),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove)}_onTrackPointerMove(e){e.preventDefault(),this._dragged=!0}_onTrackPointerUp(e){if(e.preventDefault(),document.removeEventListener("pointermove",this._onTrackPointerMove),document.removeEventListener("pointerup",this._onTrackPointerUp),this.snapOnClickEnabled||(this._dragged=!1),!this._dragged){const t=this._getCursorPositionFromEvent(e),i=this._valueFromPosition(t);this._emitTrackClickEvent({value:i})}}_onSegmentPointerDown(e){var a,l;e.preventDefault();const t=e.target,i=t["data-segment-index"],r=t["data-min-thumb-index"],s=t["data-max-thumb-index"];if(this._isDisabled()||M(r)||M(s))return;e.stopPropagation(),this._storeTrackDimensions(),document.addEventListener("pointerup",this._onSegmentPointerUp);const n=this._getAnchorDetails(r),o=this._getAnchorDetails(s);this.syncedSegmentsEnabled?(this.segmentElements.forEach(c=>c.classList.add(vi.segmentElementActive)),this._anchorElements.forEach(c=>c.classList.add(vi.anchorElementActive))):(this.segmentElements.getItemAt(i).classList.add(vi.segmentElementActive),(a=this._anchorElements[n.index])==null||a.classList.add(vi.anchorElementActive),(l=this._anchorElements[o.index])==null||l.classList.add(vi.anchorElementActive)),this._segmentDragStartInfo={cursorPosition:this._getCursorPositionFromEvent(e),index:i,details:this._normalizeSegmentDetails({min:n,max:o})},this.draggableSegmentsEnabled&&(document.addEventListener("pointermove",this._onSegmentPointerMove),this.notifyChange("state"),this._emitSegmentDragEvent({index:i,state:"start",thumbIndices:[r,s]}))}_onSegmentPointerMove(e){if(!this._segmentDragStartInfo)return;e.preventDefault();const{_trackHeight:t,_trackWidth:i,_segmentDragStartInfo:{index:r,cursorPosition:s,details:{min:n,max:o}}}=this,{index:a,position:l,value:c}=n,{index:h,position:p,value:f}=o;this._dragged=!0;const m=this._getCursorPositionFromEvent(e);if(m===s)return;const g=this._positionToPercent(s),y=this._positionToPercent(m)-g,x=this._positionToPercent(l)+y,b=this._positionToPercent(p)+y,{min:S}=this._getAnchorBoundsAsPercents(a),{max:T}=this._getAnchorBoundsAsPercents(h);let C=!1,A=!1;if(x<S?C=!0:b>T&&(A=!0),C){const{min:K,max:ee}=this.viewModel.getBoundsForValueAtIndex(a),ce=this._isPositionInverted()?ee:K,le=ce,z=f+(ce-c),q=z-this.values[h];return void(this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(q):this._updateAnchorValues([a,h],[le,z]))}if(A){const{min:K,max:ee}=this.viewModel.getBoundsForValueAtIndex(h),ce=this._isPositionInverted()?K:ee,le=ce,z=c+(ce-f),q=z-this.values[a];return void(this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(q):this._updateAnchorValues([a,h],[z,le]))}const O=this._isHorizontalLayout()?i:t,D=b/100*O,U=x/100*O,k=this.values,B=[k[a],k[h]],j=this._getValueForAnchorAtPosition(a,U),H=this._getValueForAnchorAtPosition(h,D);this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(j-B[0]):this._updateAnchorValues([a,h],[j,H]),[this.values[a],this.values[h]].every((K,ee)=>K===B[ee])||this._emitSegmentDragEvent({index:r,state:"drag",thumbIndices:[a,h]})}_onSegmentPointerUp(e){if(e.preventDefault(),document.removeEventListener("pointerup",this._onSegmentPointerUp),document.removeEventListener("pointermove",this._onSegmentPointerMove),!this._segmentDragStartInfo)return;const{_dragged:t,max:i,min:r,values:s}=this,{index:n,details:{min:{index:o},max:{index:a}}}=this._segmentDragStartInfo;if(this.segmentElements.forEach(l=>l.classList.remove(vi.segmentElementActive)),this._anchorElements.forEach(l=>l.classList.remove(vi.anchorElementActive)),this.draggableSegmentsEnabled){const l=i-r,c=s[o],h=s[a];this._lastMovedHandleIndex=c===h?c>l/2?o:a:null,this._dragged=!1,this._segmentDragStartInfo=null,this.notifyChange("state"),this._emitSegmentDragEvent({index:n,state:"stop",thumbIndices:[o,a]})}if(!t){const l=this._getCursorPositionFromEvent(e),c=this._valueFromPosition(l);this._emitSegmentClickEvent({index:n,value:c,thumbIndices:[o,a]})}}_onTickGroupClick(e){const t=e.target;if(t["data-config"]){const i=t["data-tick-config-index"],r=t["data-tick-group-index"],s=t["data-value"];this._emitTickClickEvent({configIndex:i,groupIndex:r,value:s})}}_storeTrackDimensions(){if(this.trackElement){const e=this._getDimensions(this.trackElement);this._trackHeight=e.height,this._trackWidth=e.width}}_onLabelPointerDown(){this._isDisabled()||(this._dragged=!1,document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}_onLabelPointerMove(){this._isDisabled()||(this._dragged=!0)}_onLabelPointerUp(e){if(this._isDisabled())return;const t=e.target["data-thumb-index"];this.labelInputsEnabled&&!this._dragged&&_(t)&&(this._activeLabelInputIndex=t),this._dragged=!1,this.notifyChange("state"),document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove)}_onLabelInputBlur(e){const{_activeLabelInputIndex:t,values:i,viewModel:r}=this,s=e.target.value;if(this._activeLabelInputIndex=null,this.notifyChange("state"),!s)return;const n=this._parseInputValue(s,"value",t),o=i[t],{min:a,max:l}=this.viewModel.getBoundsForValueAtIndex(t);if(n<a||n>l)return;r.setValue(t,n);const c=this.values[t];o!==c&&this._emitThumbChangeEvent({index:t,oldValue:o,value:c})}_onInputKeyDown(e){if(this._isDisabled())return;const{target:t}=e,i=Mc(e),{hideInput1:r,hideInput2:s,hideInput3:n}=tu,{_activeLabelInputIndex:o,_anchorElements:a}=this,l=t;if(i===r||i===s||i===n){e.stopPropagation();const c=o;l.blur(),_(c)?a[c].focus():l.parentElement.focus()}}_onMaxLabelClick(){this._isDisabled()||(this._emitRangeLabelClickEvent({type:"max-click",value:this.max}),this.rangeLabelInputsEnabled&&(this._isMaxInputActive=!0,this.notifyChange("state")))}_onMaxLabelKeyDown(e){this._isDisabled()||Mc(e)!==tu.showInput||(this._isMaxInputActive=!0,this.notifyChange("state"))}_onMaxInputBlur(e){const t=e.target.value;if(this._isMaxInputActive=!1,this.notifyChange("state"),!t)return;const i=this.max,r=this._parseInputValue(t,"max");r<=this.min||(this.viewModel.set("max",r),this.max!==i&&this._emitMaxChangeEvent({oldValue:i,value:this.max}))}_onMinLabelClick(){this._isDisabled()||(this._emitRangeLabelClickEvent({type:"min-click",value:this.min}),this.rangeLabelInputsEnabled&&(this._isMinInputActive=!0,this.notifyChange("state")))}_onMinLabelKeyDown(e){this._isDisabled()||Mc(e)!==tu.showInput||(this._isMinInputActive=!0,this.notifyChange("state"))}_onMinInputBlur(e){const t=e.target.value;if(this._isMinInputActive=!1,this.notifyChange("state"),!t)return;const i=this.min,r=this._parseInputValue(t,"min");r>=this.max||(this.viewModel.set("min",r),this.min!==i&&this._emitMinChangeEvent({oldValue:i,value:this.min}))}_isDisabled(){return this.disabled||this.state==="disabled"}_positionFromValue(e){const{max:t,min:i}=this,r=t-i;if(r===0)return 0;const{_trackHeight:s,_trackWidth:n}=this,o=this._isHorizontalLayout();let a=parseFloat(o?(n*(e-i)/r).toFixed(2):(s*(t-e)/r).toFixed(2));return this._isReversedLayout()&&(a=o?n-a:s-a),a}_valueFromPosition(e){const{_trackHeight:t,_trackWidth:i,max:r,min:s,precision:n}=this,o=r-s;let a=this._isHorizontalLayout()?e*o/i+s:o*(1e3-e/t*1e3)/1e3+s;return this._isReversedLayout()&&(a=r+s-a),parseFloat(a.toFixed(n))}_positionToPercent(e){const{_trackHeight:t,_trackWidth:i}=this,r=100*e/(this._isHorizontalLayout()?i:t);return this._applyPrecisionToPosition(r)}_applyPrecisionToPosition(e){return parseFloat(e.toFixed(this._positionPrecision))}_isPositionInverted(){const{layout:e}=this;return e==="horizontal-reversed"||e==="vertical"}_isHorizontalLayout(){return this.layout.includes("horizontal")}_isReversedLayout(){return this.layout.includes("reversed")}_normalizeSegmentDetails(e){if(this._isPositionInverted()){const{min:t,max:i}=e;return{min:i,max:t}}return e}_parseInputValue(e,t,i){return this.inputParseFunction?this.inputParseFunction(e,t,i):this.viewModel.defaultInputParseFunction(e)}_formatInputValue(e,t,i){return this.inputFormatFunction?this.inputFormatFunction(e,t,i):this.viewModel.defaultInputFormatFunction(e)}_getAnchorDetails(e){const t=[...this.values].sort((r,s)=>r-s)[e],i=this.values.indexOf(t);return{index:i,position:this._getPositionOfElement(this._anchorElements[i]),value:t}}_updateAnchorStyle(e,t){const i=this._anchorElements[e];i&&(this._isHorizontalLayout()?i.style.left=`${t}`:i.style.top=`${t}`)}_getStyleForAnchor(e,t,i){const r=this._getPositionStyleForElement(e);if(this.values.length===1)return`${r}`;const s=this._zIndices[t];return`${r}; z-index: ${i?this._zIndexOffset+s:s}`}_getPositionStyleForElement(e){const t=this._positionFromValue(e),i=this._positionToPercent(t);return`${this._isHorizontalLayout()?"left":"top"}: ${i+"%"}`}_getPositionOfElement(e){const t=this._getDimensions(e.offsetParent),i=this._getDimensions(e);return this._isHorizontalLayout()?this._applyPrecisionToPosition(i.left-t.left):this._applyPrecisionToPosition(i.top-t.top)}_updateAnchorValues(e,t){e.forEach((i,r)=>this._toValue(i,t[r]))}_updateAnchorValuesByDifference(e){const{min:t,max:i,values:r}=this;r.forEach((s,n)=>this._toValue(n,Math.max(Math.min(s+e,i),t)))}_toValue(e,t){_(this.steps)&&(t=this._getStepValues()[this._getIndexOfNearestStepValue(t)]),this._updateAnchorStyle(e,this._getPositionStyleForElement(t)),this.viewModel.setValue(e,t)}_toPosition(e,t){const i=_(this.steps)?this._getStepValueForAnchorAtPosition(e,t):this._getValueForAnchorAtPosition(e,t);this._updateAnchorStyle(e,this._getPositionStyleForElement(i)),this.viewModel.setValue(e,i)}_getValueForAnchorAtPosition(e,t){const{min:i,max:r}=this._getAnchorBoundsInPixels(e),{min:s,max:n}=this.viewModel.getBoundsForValueAtIndex(e);let o,a,l=null;return this._isPositionInverted()?(o=s,a=n):(o=n,a=s),l=t>r?o:t<i?a:this._valueFromPosition(t),l>n?l=n:l<s&&(l=s),l}_getStepValueForAnchorAtPosition(e,t){const i=this._getStepValues(),r=this._calculateNearestStepPosition(t),s=this._getValueForAnchorAtPosition(e,r);return i[this._getIndexOfNearestStepValue(s)]}_getAnchorBoundsAsPercents(e){const{min:t,max:i}=this._getAnchorBoundsInPixels(e);return{min:this._positionToPercent(t),max:this._positionToPercent(i)}}_getAnchorBoundsInPixels(e){const{_anchorElements:t,_trackHeight:i,_trackWidth:r,effectiveMax:s,effectiveMin:n,thumbsConstrained:o}=this,a=t[e-1],l=t[e+1],c=this._isHorizontalLayout()?r:i;let h,p;return this._isPositionInverted()?(h=_(n)?this._positionFromValue(n):c,p=_(s)?this._positionFromValue(s):0):(h=_(s)?this._positionFromValue(s):c,p=_(n)?this._positionFromValue(n):0),o?this._isPositionInverted()?{max:a?this._getPositionOfElement(a):h,min:l?this._getPositionOfElement(l):p}:{max:l?this._getPositionOfElement(l):h,min:a?this._getPositionOfElement(a):p}:{max:h,min:p}}_getIndexOfNearestValue(e){return this.values.indexOf(this.values.reduce((t,i)=>Math.abs(i-e)<Math.abs(t-e)?i:t))}_getCursorPositionFromEvent(e){const t=this._getDimensions(this.trackElement);return this._isHorizontalLayout()?e.clientX-t.left:e.clientY-t.top}_getStepValues(){const{steps:e}=this;if(Array.isArray(e))return e;const{max:t,min:i}=this,r=Math.ceil((t-i)/e),s=[];for(let n=0;n<=r;n++){const o=i+e*n;s.push(o>t?t:o)}return s}_toStep(e,t){const{values:i,viewModel:r}=this,s=i[e],n=this._getStepValues(),o=n.indexOf(s);let a=null;if(o>-1){let l=n[o+t];isNaN(l)&&(l=n[o]);const c=this._positionFromValue(l);a=this._getStepValueForAnchorAtPosition(e,c)}else a=n[this._getIndexOfNearestStepValue(s)+t];r.setValue(e,a)}_getIndexOfNearestStepValue(e){const{steps:t}=this;if(M(t))return null;const i=this._getStepValues(),r=i.reduce((s,n)=>Math.abs(n-e)<Math.abs(s-e)?n:s);return i.indexOf(r)}_calculateNearestStepPosition(e){const t=this._valueFromPosition(e),i=this._getIndexOfNearestStepValue(t),r=this._getStepValues();return this._positionFromValue(r[i])}_getTickCounts(e,t){const{mode:i}=t;return i==="count"||i==="position"?e||0:i==="percent"&&100/e||0}_calculateTickPositions(e){return e.map(t=>this._positionFromValue(t))}_calculateEquidistantTickPositions(e){const{_trackWidth:t,_trackHeight:i}=this,r=this._isHorizontalLayout()?t:i,s=r/(e-1),n=[];if(e===1)return[r/2];for(let o=0;o<e;o++){const a=o*s;a<=r&&n.push(a)}return n}_getDimensions(e){try{return e.getBoundingClientRect()}catch(t){if(typeof t=="object"&&t!==null)return new DOMRect(0,0,0,0);throw t}}_emitTrackClickEvent(e){this.emit("track-click",me(F({},e),{type:"track-click"}))}_emitTickClickEvent(e){this.emit("tick-click",me(F({},e),{type:"tick-click"}))}_emitMaxChangeEvent(e){this.emit("max-change",me(F({},e),{type:"max-change"}))}_emitMinChangeEvent(e){this.emit("min-change",me(F({},e),{type:"min-change"}))}_emitThumbChangeEvent(e){this.emit("thumb-change",me(F({},e),{type:"thumb-change"}))}_emitThumbClickEvent(e){this.emit("thumb-click",me(F({},e),{type:"thumb-click"}))}_emitThumbDragEvent(e){this.emit("thumb-drag",me(F({},e),{type:"thumb-drag"}))}_emitSegmentClickEvent(e){this.emit("segment-click",me(F({},e),{type:"segment-click"}))}_emitSegmentDragEvent(e){this.emit("segment-drag",me(F({},e),{type:"segment-drag"}))}_emitRangeLabelClickEvent(e){this.emit(e.type,F({},e))}};u([d()],Gi.prototype,"disabled",void 0),u([d()],Gi.prototype,"draggableSegmentsEnabled",void 0),u([ze("viewModel.effectiveMax")],Gi.prototype,"effectiveMax",void 0),u([ze("viewModel.effectiveMin")],Gi.prototype,"effectiveMin",void 0),u([d({readOnly:!0})],Gi.prototype,"effectiveSegmentElements",void 0),u([d()],Gi.prototype,"extraNodes",void 0),u([d()],Gi.prototype,"inputCreatedFunction",void 0),u([ze("viewModel.inputFormatFunction")],Gi.prototype,"inputFormatFunction",void 0),u([ze("viewModel.inputParseFunction")],Gi.prototype,"inputParseFunction",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Gi.prototype,"label",void 0),u([d({readOnly:!0})],Gi.prototype,"labelElements",void 0),u([d()],Gi.prototype,"labelInputsEnabled",void 0),u([ze("viewModel.labelFormatFunction")],Gi.prototype,"labelFormatFunction",void 0),u([ze("viewModel.labels")],Gi.prototype,"labels",void 0),u([d({value:"horizontal"})],Gi.prototype,"layout",null),u([ze("viewModel.max")],Gi.prototype,"max",void 0),u([d({readOnly:!0})],Gi.prototype,"maxLabelElement",void 0),u([d(),pr("esri/widgets/Slider/t9n/Slider")],Gi.prototype,"messages",void 0),u([ze("viewModel.min")],Gi.prototype,"min",void 0),u([d({readOnly:!0})],Gi.prototype,"minLabelElement",void 0),u([ze("viewModel.precision")],Gi.prototype,"precision",void 0),u([d()],Gi.prototype,"rangeLabelInputsEnabled",void 0),u([d({readOnly:!0})],Gi.prototype,"segmentElements",void 0),u([d()],Gi.prototype,"snapOnClickEnabled",void 0),u([d({readOnly:!0})],Gi.prototype,"state",null),u([d()],Gi.prototype,"steps",void 0),u([d()],Gi.prototype,"syncedSegmentsEnabled",void 0),u([ze("viewModel.thumbsConstrained")],Gi.prototype,"thumbsConstrained",void 0),u([d()],Gi.prototype,"thumbCreatedFunction",void 0),u([d({readOnly:!0})],Gi.prototype,"thumbElements",void 0),u([d()],Gi.prototype,"tickConfigs",null),u([d({readOnly:!0})],Gi.prototype,"tickElements",void 0),u([d({readOnly:!0})],Gi.prototype,"trackElement",void 0),u([ze("viewModel.values")],Gi.prototype,"values",void 0),u([d()],Gi.prototype,"viewModel",void 0),u([d()],Gi.prototype,"visibleElements",void 0),u([Jt("visibleElements")],Gi.prototype,"castVisibleElements",null),Gi=u([L(yRt)],Gi);const vRt=Gi;function fm(e){if(e==null)return window;if(e.toString()!=="[object Window]"){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function GM(e){var t=fm(e).Element;return e instanceof t||e instanceof Element}function vp(e){var t=fm(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}function pse(e){if(typeof ShadowRoot=="undefined")return!1;var t=fm(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}var rS=Math.max,xV=Math.min,jM=Math.round;function HM(e,t){t===void 0&&(t=!1);var i=e.getBoundingClientRect(),r=1,s=1;if(vp(e)&&t){var n=e.offsetHeight,o=e.offsetWidth;o>0&&(r=jM(i.width)/o||1),n>0&&(s=jM(i.height)/n||1)}return{width:i.width/r,height:i.height/s,top:i.top/s,right:i.right/r,bottom:i.bottom/s,left:i.left/r,x:i.left/r,y:i.top/s}}function fse(e){var t=fm(e),i=t.pageXOffset,r=t.pageYOffset;return{scrollLeft:i,scrollTop:r}}function _Rt(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function bRt(e){return e===fm(e)||!vp(e)?fse(e):_Rt(e)}function oy(e){return e?(e.nodeName||"").toLowerCase():null}function rw(e){return((GM(e)?e.ownerDocument:e.document)||window.document).documentElement}function mse(e){return HM(rw(e)).left+fse(e).scrollLeft}function Mv(e){return fm(e).getComputedStyle(e)}function gse(e){var t=Mv(e),i=t.overflow,r=t.overflowX,s=t.overflowY;return/auto|scroll|overlay|hidden/.test(i+s+r)}function wRt(e){var t=e.getBoundingClientRect(),i=jM(t.width)/e.offsetWidth||1,r=jM(t.height)/e.offsetHeight||1;return i!==1||r!==1}function xRt(e,t,i){i===void 0&&(i=!1);var r=vp(t),s=vp(t)&&wRt(t),n=rw(t),o=HM(e,s),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!i)&&((oy(t)!=="body"||gse(n))&&(a=bRt(t)),vp(t)?(l=HM(t,!0),l.x+=t.clientLeft,l.y+=t.clientTop):n&&(l.x=mse(n))),{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function yse(e){var t=HM(e),i=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-i)<=1&&(i=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:i,height:r}}function k8(e){return oy(e)==="html"?e:e.assignedSlot||e.parentNode||(pse(e)?e.host:null)||rw(e)}function Z3e(e){return["html","body","#document"].indexOf(oy(e))>=0?e.ownerDocument.body:vp(e)&&gse(e)?e:Z3e(k8(e))}function v3(e,t){var i;t===void 0&&(t=[]);var r=Z3e(e),s=r===((i=e.ownerDocument)==null?void 0:i.body),n=fm(r),o=s?[n].concat(n.visualViewport||[],gse(r)?r:[]):r,a=t.concat(o);return s?a:a.concat(v3(k8(o)))}function TRt(e){return["table","td","th"].indexOf(oy(e))>=0}function Jge(e){return!vp(e)||Mv(e).position==="fixed"?null:e.offsetParent}function SRt(e){var t=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1,i=navigator.userAgent.indexOf("Trident")!==-1;if(i&&vp(e)){var r=Mv(e);if(r.position==="fixed")return null}var s=k8(e);for(pse(s)&&(s=s.host);vp(s)&&["html","body"].indexOf(oy(s))<0;){var n=Mv(s);if(n.transform!=="none"||n.perspective!=="none"||n.contain==="paint"||["transform","perspective"].indexOf(n.willChange)!==-1||t&&n.willChange==="filter"||t&&n.filter&&n.filter!=="none")return s;s=s.parentNode}return null}function rD(e){for(var t=fm(e),i=Jge(e);i&&TRt(i)&&Mv(i).position==="static";)i=Jge(i);return i&&(oy(i)==="html"||oy(i)==="body"&&Mv(i).position==="static")?t:i||SRt(e)||t}var ku="top",Pp="bottom",Ip="right",Uu="left",vse="auto",sD=[ku,Pp,Ip,Uu],qM="start",K$="end",ERt="clippingParents",X3e="viewport",eP="popper",CRt="reference",Qge=sD.reduce(function(e,t){return e.concat([t+"-"+qM,t+"-"+K$])},[]),Y3e=[].concat(sD,[vse]).reduce(function(e,t){return e.concat([t,t+"-"+qM,t+"-"+K$])},[]),ARt="beforeRead",MRt="read",ORt="afterRead",RRt="beforeMain",PRt="main",IRt="afterMain",$Rt="beforeWrite",LRt="write",DRt="afterWrite",NRt=[ARt,MRt,ORt,RRt,PRt,IRt,$Rt,LRt,DRt];function FRt(e){var t=new Map,i=new Set,r=[];e.forEach(function(n){t.set(n.name,n)});function s(n){i.add(n.name);var o=[].concat(n.requires||[],n.requiresIfExists||[]);o.forEach(function(a){if(!i.has(a)){var l=t.get(a);l&&s(l)}}),r.push(n)}return e.forEach(function(n){i.has(n.name)||s(n)}),r}function kRt(e){var t=FRt(e);return NRt.reduce(function(i,r){return i.concat(t.filter(function(s){return s.phase===r}))},[])}function URt(e){var t;return function(){return t||(t=new Promise(function(i){Promise.resolve().then(function(){t=void 0,i(e())})})),t}}function Vg(e){return e.split("-")[0]}function zRt(e){var t=e.reduce(function(i,r){var s=i[r.name];return i[r.name]=s?Object.assign({},s,r,{options:Object.assign({},s.options,r.options),data:Object.assign({},s.data,r.data)}):r,i},{});return Object.keys(t).map(function(i){return t[i]})}function VRt(e){var t=fm(e),i=rw(e),r=t.visualViewport,s=i.clientWidth,n=i.clientHeight,o=0,a=0;return r&&(s=r.width,n=r.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(o=r.offsetLeft,a=r.offsetTop)),{width:s,height:n,x:o+mse(e),y:a}}function BRt(e){var t,i=rw(e),r=fse(e),s=(t=e.ownerDocument)==null?void 0:t.body,n=rS(i.scrollWidth,i.clientWidth,s?s.scrollWidth:0,s?s.clientWidth:0),o=rS(i.scrollHeight,i.clientHeight,s?s.scrollHeight:0,s?s.clientHeight:0),a=-r.scrollLeft+mse(e),l=-r.scrollTop;return Mv(s||i).direction==="rtl"&&(a+=rS(i.clientWidth,s?s.clientWidth:0)-n),{width:n,height:o,x:a,y:l}}function J3e(e,t){var i=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(i&&pse(i)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function ZJ(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function GRt(e){var t=HM(e);return t.top=t.top+e.clientTop,t.left=t.left+e.clientLeft,t.bottom=t.top+e.clientHeight,t.right=t.left+e.clientWidth,t.width=e.clientWidth,t.height=e.clientHeight,t.x=t.left,t.y=t.top,t}function Kge(e,t){return t===X3e?ZJ(VRt(e)):GM(t)?GRt(t):ZJ(BRt(rw(e)))}function jRt(e){var t=v3(k8(e)),i=["absolute","fixed"].indexOf(Mv(e).position)>=0,r=i&&vp(e)?rD(e):e;return GM(r)?t.filter(function(s){return GM(s)&&J3e(s,r)&&oy(s)!=="body"}):[]}function HRt(e,t,i){var r=t==="clippingParents"?jRt(e):[].concat(t),s=[].concat(r,[i]),n=s[0],o=s.reduce(function(a,l){var c=Kge(e,l);return a.top=rS(c.top,a.top),a.right=xV(c.right,a.right),a.bottom=xV(c.bottom,a.bottom),a.left=rS(c.left,a.left),a},Kge(e,n));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function WM(e){return e.split("-")[1]}function _se(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function Q3e(e){var t=e.reference,i=e.element,r=e.placement,s=r?Vg(r):null,n=r?WM(r):null,o=t.x+t.width/2-i.width/2,a=t.y+t.height/2-i.height/2,l;switch(s){case ku:l={x:o,y:t.y-i.height};break;case Pp:l={x:o,y:t.y+t.height};break;case Ip:l={x:t.x+t.width,y:a};break;case Uu:l={x:t.x-i.width,y:a};break;default:l={x:t.x,y:t.y}}var c=s?_se(s):null;if(c!=null){var h=c==="y"?"height":"width";switch(n){case qM:l[c]=l[c]-(t[h]/2-i[h]/2);break;case K$:l[c]=l[c]+(t[h]/2-i[h]/2);break}}return l}function K3e(){return{top:0,right:0,bottom:0,left:0}}function e$e(e){return Object.assign({},K3e(),e)}function t$e(e,t){return t.reduce(function(i,r){return i[r]=e,i},{})}function eL(e,t){t===void 0&&(t={});var i=t,r=i.placement,s=r===void 0?e.placement:r,n=i.boundary,o=n===void 0?ERt:n,a=i.rootBoundary,l=a===void 0?X3e:a,c=i.elementContext,h=c===void 0?eP:c,p=i.altBoundary,f=p===void 0?!1:p,m=i.padding,g=m===void 0?0:m,y=e$e(typeof g!="number"?g:t$e(g,sD)),x=h===eP?CRt:eP,b=e.rects.popper,S=e.elements[f?x:h],T=HRt(GM(S)?S:S.contextElement||rw(e.elements.popper),o,l),C=HM(e.elements.reference),A=Q3e({reference:C,element:b,strategy:"absolute",placement:s}),O=ZJ(Object.assign({},b,A)),D=h===eP?O:C,U={top:T.top-D.top+y.top,bottom:D.bottom-T.bottom+y.bottom,left:T.left-D.left+y.left,right:D.right-T.right+y.right},k=e.modifiersData.offset;if(h===eP&&k){var B=k[s];Object.keys(U).forEach(function(j){var H=[Ip,Pp].indexOf(j)>=0?1:-1,K=[ku,Pp].indexOf(j)>=0?"y":"x";U[j]+=B[K]*H})}return U}var eye={placement:"bottom",modifiers:[],strategy:"absolute"};function tye(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return!t.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function qRt(e){e===void 0&&(e={});var t=e,i=t.defaultModifiers,r=i===void 0?[]:i,s=t.defaultOptions,n=s===void 0?eye:s;return function(a,l,c){c===void 0&&(c=n);var h={placement:"bottom",orderedModifiers:[],options:Object.assign({},eye,n),modifiersData:{},elements:{reference:a,popper:l},attributes:{},styles:{}},p=[],f=!1,m={state:h,setOptions:function(b){var S=typeof b=="function"?b(h.options):b;y(),h.options=Object.assign({},n,h.options,S),h.scrollParents={reference:GM(a)?v3(a):a.contextElement?v3(a.contextElement):[],popper:v3(l)};var T=kRt(zRt([].concat(r,h.options.modifiers)));return h.orderedModifiers=T.filter(function(C){return C.enabled}),g(),m.update()},forceUpdate:function(){if(!f){var b=h.elements,S=b.reference,T=b.popper;if(!!tye(S,T)){h.rects={reference:xRt(S,rD(T),h.options.strategy==="fixed"),popper:yse(T)},h.reset=!1,h.placement=h.options.placement,h.orderedModifiers.forEach(function(B){return h.modifiersData[B.name]=Object.assign({},B.data)});for(var C=0;C<h.orderedModifiers.length;C++){if(h.reset===!0){h.reset=!1,C=-1;continue}var A=h.orderedModifiers[C],O=A.fn,D=A.options,U=D===void 0?{}:D,k=A.name;typeof O=="function"&&(h=O({state:h,options:U,name:k,instance:m})||h)}}}},update:URt(function(){return new Promise(function(x){m.forceUpdate(),x(h)})}),destroy:function(){y(),f=!0}};if(!tye(a,l))return m;m.setOptions(c).then(function(x){!f&&c.onFirstUpdate&&c.onFirstUpdate(x)});function g(){h.orderedModifiers.forEach(function(x){var b=x.name,S=x.options,T=S===void 0?{}:S,C=x.effect;if(typeof C=="function"){var A=C({state:h,name:b,instance:m,options:T}),O=function(){};p.push(A||O)}})}function y(){p.forEach(function(x){return x()}),p=[]}return m}}var _4={passive:!0};function WRt(e){var t=e.state,i=e.instance,r=e.options,s=r.scroll,n=s===void 0?!0:s,o=r.resize,a=o===void 0?!0:o,l=fm(t.elements.popper),c=[].concat(t.scrollParents.reference,t.scrollParents.popper);return n&&c.forEach(function(h){h.addEventListener("scroll",i.update,_4)}),a&&l.addEventListener("resize",i.update,_4),function(){n&&c.forEach(function(h){h.removeEventListener("scroll",i.update,_4)}),a&&l.removeEventListener("resize",i.update,_4)}}var ZRt={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:WRt,data:{}};function XRt(e){var t=e.state,i=e.name;t.modifiersData[i]=Q3e({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}var YRt={name:"popperOffsets",enabled:!0,phase:"read",fn:XRt,data:{}},JRt={top:"auto",right:"auto",bottom:"auto",left:"auto"};function QRt(e){var t=e.x,i=e.y,r=window,s=r.devicePixelRatio||1;return{x:jM(t*s)/s||0,y:jM(i*s)/s||0}}function iye(e){var t,i=e.popper,r=e.popperRect,s=e.placement,n=e.variation,o=e.offsets,a=e.position,l=e.gpuAcceleration,c=e.adaptive,h=e.roundOffsets,p=e.isFixed,f=o.x,m=f===void 0?0:f,g=o.y,y=g===void 0?0:g,x=typeof h=="function"?h({x:m,y}):{x:m,y};m=x.x,y=x.y;var b=o.hasOwnProperty("x"),S=o.hasOwnProperty("y"),T=Uu,C=ku,A=window;if(c){var O=rD(i),D="clientHeight",U="clientWidth";if(O===fm(i)&&(O=rw(i),Mv(O).position!=="static"&&a==="absolute"&&(D="scrollHeight",U="scrollWidth")),O=O,s===ku||(s===Uu||s===Ip)&&n===K$){C=Pp;var k=p&&O===A&&A.visualViewport?A.visualViewport.height:O[D];y-=k-r.height,y*=l?1:-1}if(s===Uu||(s===ku||s===Pp)&&n===K$){T=Ip;var B=p&&O===A&&A.visualViewport?A.visualViewport.width:O[U];m-=B-r.width,m*=l?1:-1}}var j=Object.assign({position:a},c&&JRt),H=h===!0?QRt({x:m,y}):{x:m,y};if(m=H.x,y=H.y,l){var K;return Object.assign({},j,(K={},K[C]=S?"0":"",K[T]=b?"0":"",K.transform=(A.devicePixelRatio||1)<=1?"translate("+m+"px, "+y+"px)":"translate3d("+m+"px, "+y+"px, 0)",K))}return Object.assign({},j,(t={},t[C]=S?y+"px":"",t[T]=b?m+"px":"",t.transform="",t))}function KRt(e){var t=e.state,i=e.options,r=i.gpuAcceleration,s=r===void 0?!0:r,n=i.adaptive,o=n===void 0?!0:n,a=i.roundOffsets,l=a===void 0?!0:a,c={placement:Vg(t.placement),variation:WM(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:s,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,iye(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:l})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,iye(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}var ePt={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:KRt,data:{}};function tPt(e){var t=e.state;Object.keys(t.elements).forEach(function(i){var r=t.styles[i]||{},s=t.attributes[i]||{},n=t.elements[i];!vp(n)||!oy(n)||(Object.assign(n.style,r),Object.keys(s).forEach(function(o){var a=s[o];a===!1?n.removeAttribute(o):n.setAttribute(o,a===!0?"":a)}))})}function iPt(e){var t=e.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow),function(){Object.keys(t.elements).forEach(function(r){var s=t.elements[r],n=t.attributes[r]||{},o=Object.keys(t.styles.hasOwnProperty(r)?t.styles[r]:i[r]),a=o.reduce(function(l,c){return l[c]="",l},{});!vp(s)||!oy(s)||(Object.assign(s.style,a),Object.keys(n).forEach(function(l){s.removeAttribute(l)}))})}}var rPt={name:"applyStyles",enabled:!0,phase:"write",fn:tPt,effect:iPt,requires:["computeStyles"]};function sPt(e,t,i){var r=Vg(e),s=[Uu,ku].indexOf(r)>=0?-1:1,n=typeof i=="function"?i(Object.assign({},t,{placement:e})):i,o=n[0],a=n[1];return o=o||0,a=(a||0)*s,[Uu,Ip].indexOf(r)>=0?{x:a,y:o}:{x:o,y:a}}function nPt(e){var t=e.state,i=e.options,r=e.name,s=i.offset,n=s===void 0?[0,0]:s,o=Y3e.reduce(function(h,p){return h[p]=sPt(p,t.rects,n),h},{}),a=o[t.placement],l=a.x,c=a.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=c),t.modifiersData[r]=o}var oPt={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:nPt},aPt={left:"right",right:"left",bottom:"top",top:"bottom"};function zk(e){return e.replace(/left|right|bottom|top/g,function(t){return aPt[t]})}var lPt={start:"end",end:"start"};function rye(e){return e.replace(/start|end/g,function(t){return lPt[t]})}function cPt(e,t){t===void 0&&(t={});var i=t,r=i.placement,s=i.boundary,n=i.rootBoundary,o=i.padding,a=i.flipVariations,l=i.allowedAutoPlacements,c=l===void 0?Y3e:l,h=WM(r),p=h?a?Qge:Qge.filter(function(g){return WM(g)===h}):sD,f=p.filter(function(g){return c.indexOf(g)>=0});f.length===0&&(f=p);var m=f.reduce(function(g,y){return g[y]=eL(e,{placement:y,boundary:s,rootBoundary:n,padding:o})[Vg(y)],g},{});return Object.keys(m).sort(function(g,y){return m[g]-m[y]})}function uPt(e){if(Vg(e)===vse)return[];var t=zk(e);return[rye(e),t,rye(t)]}function hPt(e){var t=e.state,i=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var s=i.mainAxis,n=s===void 0?!0:s,o=i.altAxis,a=o===void 0?!0:o,l=i.fallbackPlacements,c=i.padding,h=i.boundary,p=i.rootBoundary,f=i.altBoundary,m=i.flipVariations,g=m===void 0?!0:m,y=i.allowedAutoPlacements,x=t.options.placement,b=Vg(x),S=b===x,T=l||(S||!g?[zk(x)]:uPt(x)),C=[x].concat(T).reduce(function(ae,_e){return ae.concat(Vg(_e)===vse?cPt(t,{placement:_e,boundary:h,rootBoundary:p,padding:c,flipVariations:g,allowedAutoPlacements:y}):_e)},[]),A=t.rects.reference,O=t.rects.popper,D=new Map,U=!0,k=C[0],B=0;B<C.length;B++){var j=C[B],H=Vg(j),K=WM(j)===qM,ee=[ku,Pp].indexOf(H)>=0,ce=ee?"width":"height",le=eL(t,{placement:j,boundary:h,rootBoundary:p,altBoundary:f,padding:c}),z=ee?K?Ip:Uu:K?Pp:ku;A[ce]>O[ce]&&(z=zk(z));var q=zk(z),Z=[];if(n&&Z.push(le[H]<=0),a&&Z.push(le[z]<=0,le[q]<=0),Z.every(function(ae){return ae})){k=j,U=!1;break}D.set(j,Z)}if(U)for(var Y=g?3:1,te=function(_e){var Oe=C.find(function(Be){var Se=D.get(Be);if(Se)return Se.slice(0,_e).every(function(Te){return Te})});if(Oe)return k=Oe,"break"},se=Y;se>0;se--){var J=te(se);if(J==="break")break}t.placement!==k&&(t.modifiersData[r]._skip=!0,t.placement=k,t.reset=!0)}}var dPt={name:"flip",enabled:!0,phase:"main",fn:hPt,requiresIfExists:["offset"],data:{_skip:!1}};function pPt(e){return e==="x"?"y":"x"}function _3(e,t,i){return rS(e,xV(t,i))}function fPt(e,t,i){var r=_3(e,t,i);return r>i?i:r}function mPt(e){var t=e.state,i=e.options,r=e.name,s=i.mainAxis,n=s===void 0?!0:s,o=i.altAxis,a=o===void 0?!1:o,l=i.boundary,c=i.rootBoundary,h=i.altBoundary,p=i.padding,f=i.tether,m=f===void 0?!0:f,g=i.tetherOffset,y=g===void 0?0:g,x=eL(t,{boundary:l,rootBoundary:c,padding:p,altBoundary:h}),b=Vg(t.placement),S=WM(t.placement),T=!S,C=_se(b),A=pPt(C),O=t.modifiersData.popperOffsets,D=t.rects.reference,U=t.rects.popper,k=typeof y=="function"?y(Object.assign({},t.rects,{placement:t.placement})):y,B=typeof k=="number"?{mainAxis:k,altAxis:k}:Object.assign({mainAxis:0,altAxis:0},k),j=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,H={x:0,y:0};if(!!O){if(n){var K,ee=C==="y"?ku:Uu,ce=C==="y"?Pp:Ip,le=C==="y"?"height":"width",z=O[C],q=z+x[ee],Z=z-x[ce],Y=m?-U[le]/2:0,te=S===qM?D[le]:U[le],se=S===qM?-U[le]:-D[le],J=t.elements.arrow,ae=m&&J?yse(J):{width:0,height:0},_e=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:K3e(),Oe=_e[ee],Be=_e[ce],Se=_3(0,D[le],ae[le]),Te=T?D[le]/2-Y-Se-Oe-B.mainAxis:te-Se-Oe-B.mainAxis,Ie=T?-D[le]/2+Y+Se+Be+B.mainAxis:se+Se+Be+B.mainAxis,Ve=t.elements.arrow&&rD(t.elements.arrow),Ni=Ve?C==="y"?Ve.clientTop||0:Ve.clientLeft||0:0,Fi=(K=j==null?void 0:j[C])!=null?K:0,hi=z+Te-Fi-Ni,Vi=z+Ie-Fi,di=_3(m?xV(q,hi):q,z,m?rS(Z,Vi):Z);O[C]=di,H[C]=di-z}if(a){var ki,kr=C==="x"?ku:Uu,us=C==="x"?Pp:Ip,ot=O[A],cr=A==="y"?"height":"width",en=ot+x[kr],mo=ot-x[us],Fn=[ku,Uu].indexOf(b)!==-1,gl=(ki=j==null?void 0:j[A])!=null?ki:0,yl=Fn?en:ot-D[cr]-U[cr]-gl+B.altAxis,Qn=Fn?ot+D[cr]+U[cr]-gl-B.altAxis:mo,hd=m&&Fn?fPt(yl,ot,Qn):_3(m?yl:en,ot,m?Qn:mo);O[A]=hd,H[A]=hd-ot}t.modifiersData[r]=H}}var gPt={name:"preventOverflow",enabled:!0,phase:"main",fn:mPt,requiresIfExists:["offset"]},yPt=function(t,i){return t=typeof t=="function"?t(Object.assign({},i.rects,{placement:i.placement})):t,e$e(typeof t!="number"?t:t$e(t,sD))};function vPt(e){var t,i=e.state,r=e.name,s=e.options,n=i.elements.arrow,o=i.modifiersData.popperOffsets,a=Vg(i.placement),l=_se(a),c=[Uu,Ip].indexOf(a)>=0,h=c?"height":"width";if(!(!n||!o)){var p=yPt(s.padding,i),f=yse(n),m=l==="y"?ku:Uu,g=l==="y"?Pp:Ip,y=i.rects.reference[h]+i.rects.reference[l]-o[l]-i.rects.popper[h],x=o[l]-i.rects.reference[l],b=rD(n),S=b?l==="y"?b.clientHeight||0:b.clientWidth||0:0,T=y/2-x/2,C=p[m],A=S-f[h]-p[g],O=S/2-f[h]/2+T,D=_3(C,O,A),U=l;i.modifiersData[r]=(t={},t[U]=D,t.centerOffset=D-O,t)}}function _Pt(e){var t=e.state,i=e.options,r=i.element,s=r===void 0?"[data-popper-arrow]":r;s!=null&&(typeof s=="string"&&(s=t.elements.popper.querySelector(s),!s)||!J3e(t.elements.popper,s)||(t.elements.arrow=s))}var bPt={name:"arrow",enabled:!0,phase:"main",fn:vPt,effect:_Pt,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function sye(e,t,i){return i===void 0&&(i={x:0,y:0}),{top:e.top-t.height-i.y,right:e.right-t.width+i.x,bottom:e.bottom-t.height+i.y,left:e.left-t.width-i.x}}function nye(e){return[ku,Ip,Pp,Uu].some(function(t){return e[t]>=0})}function wPt(e){var t=e.state,i=e.name,r=t.rects.reference,s=t.rects.popper,n=t.modifiersData.preventOverflow,o=eL(t,{elementContext:"reference"}),a=eL(t,{altBoundary:!0}),l=sye(o,r),c=sye(a,s,n),h=nye(l),p=nye(c);t.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:h,hasPopperEscaped:p},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":h,"data-popper-escaped":p})}var xPt={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:wPt},TPt=[ZRt,YRt,ePt,rPt,oPt,dPt,gPt,bPt,xPt],SPt=qRt({defaultModifiers:TPt});const EPt=["bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end","top","top-start","top-end"],oye={base:"esri-popover",open:"esri-popover--open"},CPt={position:"fixed","z-index":"1000"};let ag=class extends Yr{constructor(e,t){super(e,t),this._popper=null,this._contentNode=null,this._renderAttached=!1,this._rootNode=null,this.anchorElement=null,this.offset=[0,0],this.open=!1,this.renderContentFunction=null,this._afterRootCreate=i=>{this._rootNode=i},this._afterContentCreate=i=>{this._contentNode=i},this._updatePosition=()=>{_(this._popper)&&this._popper.update()}}initialize(){this.when(()=>{this.destroyed||(this._projector.append(document.body,this.render),this._renderAttached=!0)}),this.own([re(()=>[this.open,this.anchorElement],()=>this._buildPopper(),Et),re(()=>[this.placement,this.offset],()=>this._setPopperOptions(),Et)])}destroy(){this.owner=null,this.anchorElement=null,this.renderContentFunction=null,this._renderAttached&&(this._projector.detach(this.render),this._renderAttached=!1),_(this._rootNode)&&(LBe(this._rootNode),this._rootNode=null),this._contentNode=null,_(this._popper)&&(this._popper.destroy(),this._popper=null)}set container(e){}set owner(e){this._set("owner",e)}get placement(){return"top"}set placement(e){EPt.includes(e)?this._override("placement",e):this._clearOverride("placement")}render(){var r;const{open:e,owner:t,renderContentFunction:i}=this;return N("div",{afterCreate:this._afterRootCreate,class:this.classes(oye.base,e?oye.open:null),styles:CPt},N("div",{dir:_xe((r=this.owner)==null?void 0:r.container),afterCreate:this._afterContentCreate,afterUpdate:this._updatePosition},e&&(i==null?void 0:i.call(t))))}_buildPopper(){_(this._popper)&&(this._popper.destroy(),this._popper=null);const e=this._contentNode;if(M(e)||!this.open||!this.renderContentFunction)return;const t=this._getAnchor();t&&(this._popper=SPt(t,e),this._setPopperOptions())}_setPopperOptions(){const{placement:e,offset:t,_popper:i}=this;M(i)||(i.setOptions({placement:e,modifiers:[{name:"offset",options:{offset:t}}]}),i.forceUpdate())}_getAnchor(){const{anchorElement:e}=this;return fL(typeof e=="function"?e():e)}};u([d()],ag.prototype,"anchorElement",void 0),u([d()],ag.prototype,"container",null),u([d()],ag.prototype,"offset",void 0),u([d()],ag.prototype,"open",void 0),u([d()],ag.prototype,"owner",null),u([d()],ag.prototype,"placement",null),u([d()],ag.prototype,"renderContentFunction",void 0),ag=u([L("esri.widgets.support.Popover")],ag);const bse=ag,Tl={interactive:"esri-interactive",label:"esri-slider__label",box:"esri-slider-with-dropdown__box",dropdownRoot:"esri-slider-with-dropdown__dropdown-root",anchor:" esri-widget__anchor esri-slider-with-dropdown__anchor",anchorOpen:"esri-slider-with-dropdown__anchor--open",anchorClosed:"esri-slider-with-dropdown__anchor--closed",dropdownList:"esri-slider-with-dropdown__list",dropdownListItem:"esri-slider-with-dropdown__list-item",dropdownListItemSelected:"esri-slider-with-dropdown__list-item--selected",boxDropDownOn:"esri-slider-with-dropdown__box--drop-down-on",boxDropDownOff:"esri-slider-with-dropdown__box--drop-down-off"},b4={selectItem:"Enter",closeDropdown:"Escape",moveSelectionUp:"ArrowUp",moveSelectionDown:"ArrowDown"};let lg=class extends vRt{constructor(e,t){super(e,t),this.viewModel=new P0,this.buttonTooltip="",this.showDropDown=!0,this.currentIndex=0,this._dropdownAnchor=null,this._dropdownElement=null,this._popover=new bse({owner:this,placement:"bottom-start",anchorElement:()=>this._dropdownAnchor,renderContentFunction:()=>this._renderPopover()})}initialize(){this.own(re(()=>this.viewModel.isDropdownOpen,e=>{this._popover.open=e},Et))}destroy(){this._popover.destroy()}renderThumbLabel(e){const t={[Tl.boxDropDownOn]:this.showDropDown,[Tl.boxDropDownOff]:!this.showDropDown};return N("div",{class:this.classes(Tl.box,Tl.label,t)},super.renderThumbLabel(e),this.showDropDown&&N("div",{bind:this,afterCreate:this._onDropdownAnchorAfterCreate,class:Tl.dropdownRoot},N("button",{class:this.classes(Tl.interactive,Tl.anchor,this.isDropdownOpen?Tl.anchorOpen:Tl.anchorClosed),bind:this,disabled:this.disabled,onclick:this._onAnchorClick,onpointerdown:this._killEvent,"aria-label":this.buttonTooltip,title:this.buttonTooltip,"aria-expanded":this.isDropdownOpen.toString(),"aria-haspopup":"listbox",type:"button"},this.currentItem?this.currentItem.name+" ":"")))}_onDropdownAnchorAfterCreate(e){this._dropdownAnchor=e}_renderPopover(){return N("ol",{role:"listbox",afterCreate:this._onDropdownAfterCreate,"aria-label":this.buttonTooltip,bind:this,class:this.classes(Tl.dropdownList),tabindex:"-1",onkeydown:this._onDropdownKeyDown,onfocusout:this._onDropdownFocusOut,onpointerdown:this._killEvent},this.items.map((e,t)=>N("li",{class:t===this.currentIndex?this.classes(Tl.interactive,Tl.dropdownListItem,Tl.dropdownListItemSelected):this.classes(Tl.interactive,Tl.dropdownListItem),bind:this,onclick:this._onDropdownItemClick,"data-result":t,"aria-label":e.label.join(" "),role:"option","aria-selected":(t===this.currentIndex).toString(),onkeydown:this._onLiKeyDown,tabindex:"0"},e.label.map(i=>N("span",{bind:this},i)))))}_onDropdownAfterCreate(e){var i;this._dropdownElement=e;const t=(i=e.querySelector(`.${Tl.dropdownListItemSelected}`))!=null?i:e.firstChild;_(t)&&t instanceof HTMLElement&&(t.scrollIntoView(),t.focus())}_onAnchorClick(){return!this.disabled&&(this.viewModel.toggle(),!0)}_onDropdownItemClick(e){const t=e.currentTarget;this.viewModel.selectItem(t["data-result"])}_onDropdownFocusOut(e){let t=e.relatedTarget;t===null&&(t=document.activeElement),_(this._dropdownElement)&&!this._dropdownElement.contains(t)&&_(this._dropdownAnchor)&&!this._dropdownAnchor.contains(t)&&(this.viewModel.isDropdownOpen=!1)}_killEvent(e){return e.stopPropagation(),!0}_onDropdownKeyDown(e){e.stopPropagation(),Mc(e)===b4.closeDropdown&&(this.viewModel.isDropdownOpen=!1)}_onLiKeyDown(e){const t=e.target;switch(Mc(e)){case b4.moveSelectionUp:t.previousElementSibling&&t.previousElementSibling.focus();break;case b4.moveSelectionDown:t.nextElementSibling&&t.nextElementSibling.focus();break;case b4.selectItem:t.click()}}};u([d()],lg.prototype,"viewModel",void 0),u([d()],lg.prototype,"buttonTooltip",void 0),u([d()],lg.prototype,"showDropDown",void 0),u([d({aliasOf:"viewModel.items"})],lg.prototype,"items",void 0),u([d({aliasOf:"viewModel.currentIndex"})],lg.prototype,"currentIndex",void 0),u([d({aliasOf:"viewModel.currentItem"})],lg.prototype,"currentItem",void 0),u([d({aliasOf:"viewModel.isDropdownOpen"})],lg.prototype,"isDropdownOpen",void 0),lg=u([L("esri.widgets.Daylight.SliderWithDropdown")],lg);const APt=lg;function MPt(e,t){const i=N_e(t),r=Date.now(),s=i.formatToParts(r),n=new Set;s.filter(({type:c})=>c==="literal").forEach(({value:c})=>n.add(c));let o=0;const a={};for(;s.length>0;){const{type:c,value:h}=s.shift();for(let p=0;p<h.length;p++,o++){const f=e.charAt(o);if(n.has(f)){o++;break}if(c==="literal")break;a[c]||(a[c]=[]),a[c].push(f)}}const l={};try{l.day=SH(a.day.join("")),l.month=SH(a.month.join("")),l.year=SH((a.year||a.relatedYear).join(""))}catch{throw aye(t)}if(isNaN(l.day)||isNaN(l.month)||isNaN(l.year))throw aye(t);return l}function SH(e){const t=[//g,//g,//g,//g,//g,//g,//g,//g,//g,//g];for(let i=0;i<10;i++)e=e.replace(t[i],i.toString());return Number(e)}function aye(e){return new W(`could not parse date input, expecting the following format: ${Sn(Date.now(),e)}`)}const tP={ar:6,"ar-dz":6,"ar-kw":6,"ar-ly":6,"ar-ma":1,"ar-sa":7,"ar-tn":1,bg:1,bs:1,ca:1,cs:1,da:1,de:1,"de-at":1,"de-ch":1,el:1,"en-au":1,"en-ca":7,"en-gb":1,"en-ie":1,"en-il":7,"en-in":7,"en-nz":1,"en-sg":7,es:1,"es-do":7,"es-mx":7,"es-us":7,et:1,fi:1,fr:1,"fr-ca":7,"fr-ch":1,he:7,hr:1,hu:1,id:7,it:1,"it-ch":1,ja:7,ko:7,lt:1,lv:1,nb:1,nl:1,"nl-be":1,pl:1,pt:7,"pt-br":7,ro:1,ru:1,sk:1,sl:1,sr:1,"sr-cyrl":1,sv:1,th:7,tr:1,uk:1,vi:1,"zh-cn":7,"zh-hk":7,"zh-mo":7,"zh-tw":7},OPt="Locale"in Intl&&"weekInfo"in Intl.Locale.prototype;function i$e(e){if(e=e.toLowerCase(),tP[e])return tP[e];if(OPt)try{const i=new Intl.Locale(e).weekInfo.firstDay;return tP[e]=i,i}catch{}const t=dze(e);return tP[t]?tP[t]:7}function RPt(e,t){return(t+7-i$e(e))%7}const sr={base:"esri-date-picker",datePicker:"esri-date-picker__calendar",monthPicker:"esri-date-picker__month-picker",dayPicker:"esri-date-picker__day-picker",week:"esri-date-picker__week-item",nearbyMonth:"esri-date-picker__day-item--nearby-month",activeDay:"esri-date-picker__day-item--active",today:"esri-date-picker__day-item--today",selectedDay:"esri-date-picker__day-item--selected",day:"esri-date-picker__day-item",dayHeader:"esri-date-picker__day-item--header",yearPicker:"esri-date-picker__year-picker",selectedYear:"esri-date-picker__year-picker-item--selected",year:"esri-date-picker__year-picker-item",monthDropdown:"esri-date-picker__month-dropdown",date:"esri-date-picker__date",datePickerToggle:"esri-date-picker__calendar-toggle",dateInput:"esri-date-picker__input",dateTextInput:"esri-date-picker__text-input",leadingIcon:"esri-date-picker__icon--leading",previousIcon:"esri-icon-left",nextIcon:"esri-icon-right",calendarIcon:"esri-icon-calendar",widget:"esri-widget",button:"esri-widget--button",input:"esri-input",select:"esri-select"},CE={year:"numeric",month:"2-digit",day:"2-digit"},PPt=[" ","ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Enter","Home","PageDown","PageUp"],r$e="esri.widgets.support.DatePicker",IPt=ve.getLogger(r$e);let hu=class extends Yr{constructor(e,t){super(e,t),this._activeDate=null,this._calendarNode=null,this._calendarPopover=new bse({owner:this,placement:"bottom-start",anchorElement:()=>this._rootNode,renderContentFunction:this._renderCalendar}),this._inputOrButtonNode=null,this._isOpen=!1,this._requestDayPickerFocusOnCreate=!1,this._rootNode=null,this.dateInputEnabled=!1,this.label=void 0,this.messages=null,this.value=null,this.commitOnMonthChange=!1,this.viewModel=new F8,this.disabled=!1,this._toggle=this._toggle.bind(this)}initialize(){this.own(re(()=>{var e;return{viewModel:this.viewModel,value:(e=this.viewModel)==null?void 0:e.value}},({viewModel:e,value:t})=>{this.destroyed||!e||M(this.onChange)||this.onChange(t)},Ui))}destroy(){this._calendarPopover.destroy()}render(){return N("div",{afterCreate:AT,bind:this,class:this.classes(sr.base,sr.widget),"data-node-ref":"_rootNode"},this.dateInputEnabled?this.renderInputAndButtonMode():this.renderButtonOnlyMode())}renderButtonOnlyMode(){const e=Sn(this.viewModel.value,CE),{disabled:t,_isOpen:i,messages:r}=this;return N("div",{key:`date-button-${t}`,afterCreate:AT,"aria-controls":i?this._getCalendarId():null,"aria-expanded":i.toString(),"aria-haspopup":"true","aria-label":r.setDate,"aria-pressed":i.toString(),bind:this,class:this.classes(sr.button,sr.select,sr.datePickerToggle),"data-node-ref":"_inputOrButtonNode",onclick:this._toggle,onkeydown:this._handleDateButtonKeyDown,role:"button",tabIndex:t?null:0},N("span",{class:sr.date},e))}renderInputAndButtonMode(){const e=Sn(this.viewModel.value,CE),{_isOpen:t,messages:i}=this;return N("div",{class:this.classes(sr.dateInput)},N("input",{afterCreate:AT,"data-node-ref":"_inputOrButtonNode","aria-controls":t?this._getCalendarId():null,"aria-haspopup":"true","aria-label":i.setDate,bind:this,class:this.classes(sr.dateTextInput,sr.input),key:"date-input",onblur:this._handleDateInputBlur,onclick:this._handleDateInputClick,onkeydown:this._handleDateInputKeyDown,type:"text",value:e}),N("span",{"aria-hidden":"true",class:this.classes(sr.leadingIcon,sr.calendarIcon)}))}_handleDateInputClick(){this._open(this.viewModel.value,!1)}_handleDateInputKeyDown(e){const{key:t}=e;this._isOpen?t==="Enter"?this._handleDateText(e):t==="Escape"&&this._close():t==="ArrowDown"&&(this._open(this.viewModel.value),e.preventDefault())}_handleDateButtonKeyDown(e){const{key:t,shiftKey:i}=e;this._isOpen&&t==="Tab"&&i?this._close():$P(t)&&this._toggle()}_handleDateInputBlur(e){this._isOpen||this._handleDateText(e)}_handleDateText(e){const t=e.currentTarget;let i;try{i=MPt(t.value,CE)}catch(s){return IPt.warn(s),void(t.value=Sn(this.viewModel.value,CE))}const r=ei.fromObject(i);r.isValid?(this.viewModel.value=r.toJSDate(),this._activeDate=r):t.value=Sn(this.viewModel.value,CE)}_handleDatePickerKeydown(e){Mc(e)==="Escape"&&(this._close(),e.preventDefault(),e.stopPropagation())}_renderCalendar(){const e=this._activeDate,t=ei.fromJSDate(this.viewModel.value);return N("div",{afterCreate:AT,bind:this,class:this.classes(sr.datePicker,sr.widget),"data-node-ref":"_calendarNode",id:this._getCalendarId(),key:"esri-date-picker__calendar",onkeydown:this._handleDatePickerKeydown},this._renderMonthPicker(e),this._renderDayPicker(e,t),this._renderYearPicker(e))}_getCalendarId(){return`date-picker__calendar--${this.id}`}_renderMonthPicker(e){const t=jl(this.container),i=t?sr.nextIcon:sr.previousIcon,r=t?sr.previousIcon:sr.nextIcon,s=VP.months("long",{locale:ul()}).map((a,l)=>{const c=e.month-1===l;return N("option",{selected:c,value:l.toString()},a)}),{disabled:n,messages:o}=this;return N("div",{class:sr.monthPicker},N("div",{key:`previous-month-${n}`,"aria-label":o.goToPreviousMonth,bind:this,class:sr.button,onclick:this._setPreviousMonth,onkeydown:this._handlePreviousMonthKeyDown,role:"button",tabIndex:n?null:0,title:o.goToPreviousMonth},N("span",{"aria-hidden":"true",class:i})),N("select",{"aria-live":"assertive","aria-label":o.selectMonth,bind:this,class:this.classes(sr.monthDropdown,sr.select),disabled:n,id:`${this.id}__month-picker`,onchange:this._setMonth,onkeydown:this._setMonth,title:o.selectMonth},s),N("div",{key:`next-month-${n}`,"aria-label":o.goToNextMonth,bind:this,class:sr.button,onclick:this._setNextMonth,onkeydown:this._setNextMonth,role:"button",tabIndex:n?null:0,title:o.goToNextMonth},N("span",{"aria-hidden":"true",class:r})))}_renderDayPicker(e,t){const i=this._getWeekLabels(),r=this._getDayId(e),s=this._renderMonth(e,t),{id:n,disabled:o}=this;return N("div",{key:`day-picker-${o}`,afterCreate:this._handleDayPickerCreate,"aria-activedescendant":r,"aria-labelledby":`${n}__month-picker ${n}__selected-year`,bind:this,class:sr.dayPicker,id:`${n}__day-picker`,onkeydown:this._handleDayPickerKeydown,role:"grid",tabIndex:o?null:0},N("div",{class:sr.week,role:"row"},i.map(a=>N("div",{"aria-label":a.name,class:this.classes(sr.day,sr.dayHeader),role:"columnheader",title:a.name},a.abbr))),s)}_getDayId(e){return`${this.id}__${Sn(e.valueOf(),CE)}`}_handleDayPickerCreate(e){this._requestDayPickerFocusOnCreate&&(this._requestDayPickerFocusOnCreate=!1,e.focus())}_getWeekLabels(){const e=[],t={weekday:"long"},i={weekday:"narrow"};let r=ei.now().set({weekday:i$e(ul())});for(let s=0;s<7;s++)e.push({name:Sn(r.valueOf(),t),abbr:Sn(r.valueOf(),i)}),r=r.plus({day:1});return e}_handleDayPickerKeydown(e){const{ctrlKey:t,shiftKey:i}=e,r=Mc(e);if(!PPt.includes(r))return;let s=this._activeDate;if(r==="ArrowLeft")s=s.minus({day:1});else if(r==="ArrowRight")s=s.plus({day:1});else if(r==="ArrowUp")s=s.minus({week:1});else if(r==="ArrowDown")s=s.plus({week:1});else if(r==="PageUp"){const n=i?"year":"month";s=s.minus({[n]:1})}else if(r==="PageDown"){const n=i?"year":"month";s=s.plus({[n]:1})}else if(r==="Home"){const n=t?"year":"month";s=s.startOf(n)}else if(r==="End"){const n=t?"year":"month";s=s.endOf(n)}else $P(r)&&(this.viewModel.value=s.toJSDate(),this._close());this._activeDate=s,e.preventDefault(),e.stopPropagation()}_renderMonth(e,t){const i=ei.now(),r=e.startOf("month"),s=e.endOf("month"),n=6,o=7;let a=r.minus({day:RPt(ul(),r.weekday)});const l=[];for(let c=0;c<n;c++){const h=[];for(let p=0;p<o;p++){const f=a.day,m=a.hasSame(e,"day"),g=a.hasSame(t,"day"),y=this._getDayId(a),x=Tn.fromDateTimes(r,s),b={[sr.nearbyMonth]:!x.contains(a),[sr.today]:a.hasSame(i,"day"),[sr.activeDay]:m,[sr.selectedDay]:g};h.push(N("div",{"aria-label":f.toString(),"aria-selected":m.toString(),bind:this,class:this.classes(sr.day,b),"data-iso-date":a.toISO(),id:y,onclick:this._handleSelectedDate,onkeydown:this._handleSelectedDate,role:"gridcell"},f)),a=a.plus({day:1})}l.push(N("div",{class:sr.week,role:"row"},h))}return l}_renderYearPicker(e){const t={year:"numeric"},i=e,r=Sn(i.valueOf(),t),s=Sn(i.plus({year:1}).valueOf(),t),n=Sn(i.minus({year:1}).valueOf(),t),{disabled:o,messages:a}=this;return N("div",{class:sr.yearPicker},N("div",{key:`previous-year-${o}`,"aria-label":a.goToPreviousYear,bind:this,class:sr.year,onclick:this._setPreviousYear,onkeydown:this._setPreviousYear,tabIndex:o?null:0,title:a.goToPreviousYear},n),N("div",{class:this.classes(sr.year,sr.selectedYear),id:`${this.id}__selected-year`},r),N("div",{key:`next-year-${o}`,"aria-label":a.goToNextYear,bind:this,class:sr.year,onclick:this._setNextYear,onkeydown:this._handleNextYearKeyDown,tabIndex:o?null:0,title:a.goToNextYear},s))}_toggle(){this._isOpen?this._close():this._open(this.viewModel.value)}_setMonth(e){const t=e.target,i=Number(t.value)+1;this._activeDate=this._activeDate.set({month:i}),this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate())}_close(e=!0){this._activeDate=null,this._isOpen=!1,this._calendarPopover.open=!1,this.pageClickHandler.pause(),e&&this._inputOrButtonNode.focus()}_open(e,t=!0){this._activeDate=ei.fromJSDate(e),this._isOpen=!0,this._calendarPopover.open=!0,this._requestDayPickerFocusOnCreate=t,this.pageClickHandler||(this.pageClickHandler=G5e(document,"click",({target:i})=>{var r,s;((r=this._calendarNode)==null?void 0:r.contains(i))||((s=this._rootNode)==null?void 0:s.contains(i))||this._close()}),this.own(this.pageClickHandler)),this.pageClickHandler.resume()}_setPreviousMonth(){this._activeDate=this._activeDate.minus({month:1}),this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate())}_handlePreviousMonthKeyDown(e){if(e.key==="Tab"&&e.shiftKey)return e.preventDefault(),void this._close();$P(e.key)&&this._setPreviousMonth()}_setNextMonth(){this._activeDate=this._activeDate.plus({month:1}),this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate())}_setPreviousYear(){this._activeDate=this._activeDate.minus({year:1})}_setNextYear(){this._activeDate=this._activeDate.plus({year:1})}_handleNextYearKeyDown(e){if(e.key==="Tab"&&!e.shiftKey)return e.preventDefault(),void this._close();$P(e.key)&&this._setNextYear()}_handleSelectedDate(e){const t=e.target;this.viewModel.value=ei.fromISO(t.getAttribute("data-iso-date")).toJSDate(),this._close()}};u([d()],hu.prototype,"dateInputEnabled",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],hu.prototype,"label",void 0),u([d(),pr("esri/widgets/support/t9n/DatePicker")],hu.prototype,"messages",void 0),u([ze("viewModel.value")],hu.prototype,"value",void 0),u([d()],hu.prototype,"commitOnMonthChange",void 0),u([d({type:F8})],hu.prototype,"viewModel",void 0),u([d()],hu.prototype,"onChange",void 0),u([d()],hu.prototype,"disabled",void 0),u([Da()],hu.prototype,"_setNextMonth",null),u([Da()],hu.prototype,"_setPreviousYear",null),u([Da()],hu.prototype,"_handleSelectedDate",null),hu=u([L(r$e)],hu);const $Pt=hu,lye=/(.*)\s(.*)/,LPt=ve.getLogger("esri.widgets.Daylight"),XJ="date";let na=class extends Yr{constructor(e,t){var i;super(e,t),this.headingLevel=3,this.iconClass=js.widgetIcon,this.label=void 0,this.playSpeedMultiplier=1,this.timeSliderSteps=5,this.view=null,this.viewModel=new q3e,this.visibleElements=new W3e,this.dateOrSeason=XJ,this._timeSlider=new APt({viewModel:this.viewModel.timeSliderViewModel,labelFormatFunction:Xge,inputFormatFunction:Xge,min:0,max:1439,steps:(i=this.timeSliderSteps)!=null?i:5,values:[0],labelInputsEnabled:!1,visibleElements:{labels:!0},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:this._onPrimaryTickCreated.bind(this)},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:this._onSecondaryTickCreated.bind(this)}],items:[]}),this._datePicker=new $Pt({viewModel:this.viewModel.datePickerViewModel,commitOnMonthChange:!0}),this._onPlayDayClick=()=>{this.viewModel.toggleDayPlaying()},this._onYearPlayClick=()=>{this.viewModel.toggleYearPlaying()},this._onSeasonChange=r=>{const s=r.target;this.viewModel.currentSeason=s.value},this._onSunLightingCheckboxChange=()=>{this.viewModel.toggleSunLightingEnabled()},this._onShadowCheckboxChange=()=>{this.viewModel.toggleDirectShadowsEnabled()}}get gmtOffsets(){return wt(this.timezoneMessages,gRt)}get _useAmPm(){const e=this._timeSlider.viewModel.getLabelForValue(0,"tick");return lye.test(e)}get _labelAlignmentClass(){var r,s;const e=(s=(r=this.viewModel.timeSliderViewModel.values)==null?void 0:r[0])!=null?s:0,t=60*(this._useAmPm?4:3),i=60*(this._useAmPm?21:21.5);return e<t?js.sliderAlignLeft:e>i?js.sliderAlignRight:null}postInitialize(){this.viewModel.isSupported&&this.own([re(()=>this.viewModel.datePickerViewModel,e=>this._datePicker.viewModel=e,fi),re(()=>this.viewModel.timeSliderViewModel,e=>this._timeSlider.viewModel=e,fi),re(()=>{var e;return(e=this.timezoneMessages)==null?void 0:e.chooseTimezone},e=>this._timeSlider.buttonTooltip=e,fi),re(()=>{var e;return(e=this.visibleElements)==null?void 0:e.timezone},e=>this._timeSlider.showDropDown=e,fi),re(()=>!this.viewModel.sunLightingEnabled,e=>{this._datePicker.disabled=e,this._timeSlider.disabled=e},fi),Jn(()=>this.gmtOffsets,e=>{this._timeSlider.items=e.map(t=>({utcOffset:t.utcOffset,name:t.short,label:[t.shortWithUTC,t.long]}))},fi),re(()=>[this.viewModel.utcOffset,this.gmtOffsets],()=>this._onUTCOffsetChange(),fi)])}destroy(){this._datePicker.destroy(),this._timeSlider.destroy()}render(){const{messages:e,viewModel:t,visibleElements:i}=this,r=t.isSupported;return N("div",{class:this.classes(js.base,js.widget)},r?N(y5,null,i.header&&N(J0,{level:this.headingLevel},e.title),this._renderTimeOptions(),i.datePicker&&this._renderDateOrSeason(),i.sunLightingToggle&&this._renderSunLightingToggle(),i.shadowsToggle&&this._renderShadowsToggle()):N("div",{key:"unsupported",class:js.panelError},N("p",null,e.unsupported)))}async loadDependencies(){await Promise.all([import("./calcite-button.ad24f688.js"),import("./calcite-checkbox.abb813a4.js"),import("./calcite-label.62464d51.js")])}_renderTimeOptions(){const{viewModel:e,visibleElements:t,messages:i}=this,{directShadowsEnabled:r,dayPlaying:s}=e,n=!e.sunLightingEnabled;return N("div",{class:this.classes(js.dayContainer,this._labelAlignmentClass,{[js.shadowOn]:r,[js.shadowOff]:!r,[js.sliderDateOn]:t.datePicker,[js.sliderDateOff]:!t.datePicker,[js.sliderAmPmOn]:this._useAmPm,[js.containerDisabled]:n}),key:"daylight-time-options"},this._timeSlider.render(),t.playButtons&&this._renderPlayPauseButton({playing:s,disabled:n,label:i==null?void 0:i.playDay,onClick:this._onPlayDayClick}))}_renderDateOptions(){const{viewModel:e,visibleElements:t,messages:i}=this,{yearPlaying:r}=e,s=!e.sunLightingEnabled;return N("div",{key:"daylight-date-options",class:this.classes(js.dateContainer,s&&js.containerDisabled)},this._datePicker.render(),t.playButtons&&this._renderPlayPauseButton({playing:r,disabled:s,label:i==null?void 0:i.playYear,onClick:this._onYearPlayClick}))}_renderPlayPauseButton({playing:e,disabled:t,label:i,onClick:r}){return N("calcite-button",{appearance:"solid",class:js.playPauseButton,disabled:t,"icon-start":e?"pause-f":"play-f",label:i,round:!0,title:i,type:"button",onclick:r})}_renderSeasonOptions(){const{messages:e,viewModel:t}=this,i=!t.sunLightingEnabled;return N("select",{class:this.classes(js.select,js.seasonPicker,i&&js.seasonPickerDisabled),disabled:i,value:t.currentSeason,"aria-label":e.season,onchange:this._onSeasonChange},qJ.map(r=>N("option",{value:r},e[r])))}_renderDateOrSeason(){return this.dateOrSeason==="date"?this._renderDateOptions():this._renderSeasonOptions()}_renderSunLightingToggle(){var t;const e=(t=this.messages)==null?void 0:t.sunLightingToggle;return N("calcite-label",{key:"date-time-toggle",layout:"inline",title:e==null?void 0:e.tooltip,scale:"s"},N("calcite-checkbox",{class:js.sunLightingCheckbox,checked:this.viewModel.sunLightingEnabled,onCalciteCheckboxChange:this._onSunLightingCheckboxChange}),e==null?void 0:e.label)}_renderShadowsToggle(){var t;const e=(t=this.messages)==null?void 0:t.shadowsToggle;return N("calcite-label",{key:"shadow-toggle",layout:"inline",title:e==null?void 0:e.tooltip,scale:"s"},N("calcite-checkbox",{class:js.shadowsCheckbox,checked:this.viewModel.directShadowsEnabled,onCalciteCheckboxChange:this._onShadowCheckboxChange}),e.label)}_onUTCOffsetChange(){var s;const e=this.viewModel.utcOffset,t=(s=this._timeSlider.currentItem)==null?void 0:s.utcOffset,i=this.gmtOffsets;if(M(i)||t===e)return;const r=i.findIndex(({utcOffset:n})=>n===e);r>-1&&(this._timeSlider.currentIndex=r)}_onPrimaryTickCreated(e,t,i){t.classList.add(...EH,js.primaryTick),i.classList.add(...EH,js.primaryTickLabel),i.onclick=t.onclick=this._makeGoToTime(e);const r=i.textContent.match(lye);r&&(i.innerHTML=`${r[1]}<br><div class=${js.primaryTickAmPm}>${r[2]}</div>`)}_onSecondaryTickCreated(e,t){t.classList.add(...EH,js.secondaryTick),t.onclick=this._makeGoToTime(e)}_makeGoToTime(e){return()=>{this.viewModel.timeSliderPosition=e}}};u([d({readOnly:!0})],na.prototype,"gmtOffsets",null),u([d(),pr("esri/widgets/Daylight/t9n/Daylight")],na.prototype,"messages",void 0),u([d(),pr("esri/widgets/support/t9n/timezone")],na.prototype,"timezoneMessages",void 0),u([d()],na.prototype,"headingLevel",void 0),u([d()],na.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.title",overridable:!0}})],na.prototype,"label",void 0),u([ze("viewModel.playSpeedMultiplier")],na.prototype,"playSpeedMultiplier",void 0),u([ze("_timeSlider.steps")],na.prototype,"timeSliderSteps",void 0),u([ze("viewModel.view")],na.prototype,"view",void 0),u([d({type:q3e})],na.prototype,"viewModel",void 0),u([d({type:W3e,nonNullable:!0})],na.prototype,"visibleElements",void 0),u([d({cast:e=>e==="season"||e==="date"?e:(LPt.warn(`"${e}" is not a valid option. Acceptable values are only "date" or "season". Defaulting to "${XJ}".`),XJ)})],na.prototype,"dateOrSeason",void 0),u([d()],na.prototype,"_timeSlider",void 0),u([d()],na.prototype,"_useAmPm",null),u([d()],na.prototype,"_labelAlignmentClass",null),u([d()],na.prototype,"_datePicker",void 0),na=u([L("esri.widgets.Daylight")],na);const EH=["esri-interactive","esri-widget__anchor"],qkt=na,Yo="esri-elevation-profile",Ls={esriWidget:"esri-widget--panel esri-widget",esriWidgetDisabled:"esri-widget--disabled",buttonDisabled:"esri-button--disabled",widgetIcon:"esri-icon-elevation-profile",base:`${Yo}`,portrait:`${Yo}--portrait`,refined:`${Yo}--refined`,mainContainer:`${Yo}__main-container`,promptContainer:`${Yo}__prompt-container`,header:`${Yo}__header`,zoomOutButton:`${Yo}__zoom-out-button esri-icon-zoom-out-magnifying-glass`,clearButton:`${Yo}__clear-button esri-icon-trash`,actionButton:`${Yo}__action-button esri-button`,sketchButton:`${Yo}__sketch-button esri-button--primary`,sketchCancelButton:`${Yo}__sketch-cancel-button esri-button--secondary`,sketchDoneButton:`${Yo}__sketch-done-button esri-button--primary`,selectButton:`${Yo}__select-button esri-button--secondary`,selectCancelButton:`${Yo}__select-cancel-button esri-button--secondary`,chartContainer:`${Yo}__chart-container`,chartSpinner:`${Yo}__chart-spinner esri-icon-loading-indicator esri-rotating`,chartSpinnerVisible:`${Yo}__chart-spinner--visible`,chartSpinnerSmall:`${Yo}__chart-spinner--small`,footer:`${Yo}__footer`},DPt={line:"amcharts-LineSeries",cursorEnabled:"amcharts-cursor--enabled",axisTooltip:"amcharts-axis-tooltip",seriesTooltip:"amcharts-series-tooltip"},NPt={base:"esri-elevation-profile-legend"},Hp="esri-elevation-profile-legend-item",Cd={base:Hp,disabled:`${Hp}--disabled`,expanded:`${Hp}--expanded`,colorIndicator:`${Hp}__color-indicator`,header:`${Hp}__header`,content:`${Hp}__content`,collapseToggle:`${Hp}__collapse-toggle esri-button esri-button--tertiary`,collapseToggleIcon:`${Hp}__collapse-toggle__icon esri-icon-down`,label:`${Hp}__label`,labelDisabled:`${Hp}__label--disabled`,checkbox:`${Hp}__checkbox`},iP="esri-elevation-profile-statistics",jw={base:iP,statistic:`${iP}__statistic`,statisticLabel:`${iP}__statistic__label`,statisticValue:`${iP}__statistic__value`,slopeValue:`${iP}__slope-value`,slopeUpIcon:"esri-icon-arrow-up",slopeDownIcon:"esri-icon-arrow-down"},Hw="esri-elevation-profile-settings",qw={base:`${Hw} esri-icon-handle-vertical`,popoverContent:`${Hw}__popover-content`,select:`${Hw}__select esri-select`,selectLabel:`${Hw}__select-label`,checkboxLabel:`${Hw}__checkbox-label`,checkbox:`${Hw}__checkbox`,uniformChartScalingCheckbox:`${Hw}__uniform-chart-scaling-checkbox`},FPt={readOnly:!0,get(){return D6e(this.view)}};function kPt(e,t){return M(t)||!t.mode?e?"absolute-height":"on-the-ground":t.mode}function s$e(e,t){return kPt(!!_(e)&&e.hasZ,t)}function U8(e){const t=wse(e);return s$e(e.geometry,t)}function n$e(e){const t=wse(e),i=s$e(e.geometry,t);return{mode:i,offset:_(t)&&i!=="on-the-ground"?Ye(t.offset,0)*X2e(Ye(t.unit,"meters")):0}}function z8(e){if(U8(e)==="on-the-ground")return!1;const t=wse(e),i=_(t)&&t.featureExpressionInfo?t.featureExpressionInfo.expression:null;return!(!i||i==="0")}function wse(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function Wkt(e,t,i){if(M(i)||!i.mode)return;const r=e.hasZ?e.z:0,s=_(i.offset)?i.offset:0;switch(i.mode){case"absolute-height":return r-s;case"on-the-ground":return 0;case"relative-to-ground":return r-(Ye(t.elevationProvider.getElevation(e.x,e.y,e.z,e.spatialReference,"ground"),0)+s);case"relative-to-scene":return r-(Ye(t.elevationProvider.getElevation(e.x,e.y,e.z,e.spatialReference,"scene"),0)+s)}}function Zkt(e,t,i,r=null){return o$e(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,i,r)}function TV(e,t,i,r,s=null){return o$e(e,t[0],t[1],t.length>2?t[2]:0,i,r,s)}function o$e(e,t,i,r,s,n,o=null){if(M(n))return;const a=_(o)?o.mode:"absolute-height";if(a==="on-the-ground")return 0;const{absoluteZ:l}=UPt(t,i,r,s,e,n);return zPt(l,t,i,r,s,e,o,a)}function UPt(e,t,i,r,s,n){const o=_(n.offset)?n.offset:0;switch(n.mode){case"absolute-height":return{absoluteZ:i+o,elevation:0};case"on-the-ground":{const a=Ye(s.elevationProvider.getElevation(e,t,0,r,"ground"),0);return{absoluteZ:a,elevation:a}}case"relative-to-ground":{const a=Ye(s.elevationProvider.getElevation(e,t,i,r,"ground"),0);return{absoluteZ:i+a+o,elevation:a}}case"relative-to-scene":{const a=Ye(s.elevationProvider.getElevation(e,t,i,r,"scene"),0);return{absoluteZ:i+a+o,elevation:a}}}}function zPt(e,t,i,r,s,n,o,a){const l=_(o)&&_(o.offset)?o.offset:0;switch(a){case"absolute-height":return e-l;case"relative-to-ground":return e-(Ye(n.elevationProvider.getElevation(t,i,r,s,"ground"),0)+l);case"relative-to-scene":return e-(Ye(n.elevationProvider.getElevation(t,i,r,s,"scene"),0)+l)}}const Xkt={mode:"absolute-height",offset:0};var Au,Io;(function(e){e.Disabled="disabled",e.Ready="ready",e.Creating="creating",e.Created="created",e.Selecting="selecting",e.Selected="selected"})(Au||(Au={})),function(e){e.NoValidInput="no-valid-input",e.NoVisibleProfiles="no-visible-profiles",e.InvalidGeometry="invalid-geometry",e.TooComplex="too-complex",e.InvalidElevationInfo="invalid-elevation-info",e.UnknownError="unknown-error",e.RefinedButNoChartData="refined-but-no-chart-data",e.None="none"}(Io||(Io={}));const a$e=-5e5,VPt={noDataValue:a$e,demResolution:"auto",maximumAutoTileRequests:150,ignoreInvisibleLayers:!0},BPt=100,GPt=500,l$e=.1,jPt=3e3,HPt=1e4,qPt=300,WPt=1e5,eA=1,ZPt=400,c$e=" \u2015 ",Ykt={width:3,outlineSize:0,falloff:0,outlineColor:yB([1,1,1,0]),renderOccluded:rs.Opaque},Jkt={size:14,borderStyle:"solid",borderWidth:3,borderColor:"#ffffff",boxShadow:"0px 0px 0px 5px rgba(255,255,255,0.2)"},XPt=10,YPt={progress:1,hasZ:!1,samples:[],statistics:null,spatialReference:null};function u$e(e){if(!e)return null;if(BV(e)&&e.wkid){const t=u8e[e.wkid];if(t)return t}if(e.wkt){const t=JPt(e.wkt);if(t)return t}return null}function JPt(e){const t=l8e.exec(e);if(!t||t.length!==2)return null;const i=t[1].split(",");if(!i||i.length<3)return null;const r=parseFloat(i[1]),s=parseFloat(i[2]);return isNaN(r)||isNaN(s)?null:{a:r,f:s===0?0:1/s}}function V8(e){const t=u$e(e||at.WGS84);if(QPt(t))return t;const i=t.a*(1-t.f);return Object.assign(t,{b:i,eSq:1-(i/t.a)**2,radius:(2*t.a+i)/3,densificationRatio:1e4/((2*t.a+i)/3)})}function QPt(e){return"b"in e&&"eSq"in e&&"radius"in e}function w4(e,t,i){const{a:r,eSq:s}=V8(i),n=Math.sqrt(s),o=Math.sin(t[1]*wu),a=r*t[0]*wu;let l;return s>0?l=r*((1-s)*(o/(1-s*(o*o))-1/(2*n)*Math.log((1-n*o)/(1+n*o))))*.5:l=r*o,e[0]=a,e[1]=l,e}function B8(e){return u$e(e)!==null}function Qkt(e,t="square-meters"){if(e.some(o=>!B8(o.spatialReference)))throw new W("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let o=0;o<e.length;o++){const a=e[o],l=a.spatialReference,{radius:c,densificationRatio:h}=V8(l),p=c*h;i.push(eIt(a,p))}const r=[],s=[0,0],n=[0,0];for(let o=0;o<i.length;o++){const{rings:a,spatialReference:l}=i[o];let c=0;for(let h=0;h<a.length;h++){const p=a[h];w4(s,p[0],l),w4(n,p[p.length-1],l);let f=n[0]*s[1]-s[0]*n[1];for(let m=0;m<p.length-1;m++)w4(s,p[m+1],l),w4(n,p[m],l),f+=n[0]*s[1]-s[0]*n[1];c+=f}c=tr(c,"square-meters",t),r.push(c/-2)}return r}function KPt(e,t="meters"){if(!e)throw new W("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(e.some(r=>!B8(r.spatialReference)))throw new W("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let r=0;r<e.length;r++){const s=e[r],{spatialReference:n}=s,o=s.type==="polyline"?s.paths:s.rings;let a=0;for(let l=0;l<o.length;l++){const c=o[l];let h=0;for(let p=1;p<c.length;p++){const f=c[p-1][0],m=c[p][0],g=c[p-1][1],y=c[p][1];if(g!==y||f!==m){const x={distance:null};xse(x,[f,g],[m,y],n),h+=x.distance}}a+=h}a=tr(a,"meters",t),i.push(a)}return i}function eIt(e,t){if(e.type!=="polyline"&&e.type!=="polygon")throw new W("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:i}=e;if(!B8(i))throw new W("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const r=e.type==="polyline"?e.paths:e.rings,s=[],n=[0,0],o={distance:null};for(const a of r){const l=[];s.push(l),l.push([a[0][0],a[0][1]]);let c,h,p=a[0][0],f=a[0][1];for(let m=0;m<a.length-1;m++){if(c=a[m+1][0],h=a[m+1][1],p===c&&f===h)continue;const g=[p,f];xse(o,[p,f],[c,h],i);const{azimuth:y,distance:x}=o,b=x/t;if(b>1){for(let S=1;S<=b-1;S++)RA(n,g,y,S*t,i),l.push(n.slice(0));RA(n,g,y,(x+Math.floor(b-1)*t)/2,i),l.push(n.slice(0))}RA(n,g,y,x,i),l.push(n.slice(0)),p=n[0],f=n[1]}}return e.type==="polyline"?new Fa({paths:s,spatialReference:i}):new Uo({rings:s,spatialReference:i})}function RA(e,t,i,r,s){const n=t[0],o=t[1],a=n*wu,l=o*wu,c=i*wu,{a:h,b:p,f}=V8(s),m=Math.sin(c),g=Math.cos(c),y=(1-f)*Math.tan(l),x=1/Math.sqrt(1+y*y),b=y*x,S=Math.atan2(y,g),T=x*m,C=T*T,A=1-C,O=A*(h*h-p*p)/(p*p),D=1+O/16384*(4096+O*(O*(320-175*O)-768)),U=O/1024*(256+O*(O*(74-47*O)-128));let k,B,j,H,K=r/(p*D),ee=2*Math.PI;for(;Math.abs(K-ee)>1e-12;)j=Math.cos(2*S+K),k=Math.sin(K),B=Math.cos(K),H=U*k*(j+U/4*(B*(2*j*j-1)-U/6*j*(4*k*k-3)*(4*j*j-3))),ee=K,K=r/(p*D)+H;const ce=b*k-x*B*g,le=Math.atan2(b*B+x*k*g,(1-f)*Math.sqrt(C+ce*ce)),z=Math.atan2(k*m,x*B-b*k*g),q=f/16*A*(4+f*(4-3*A)),Z=le/wu,Y=(a+(z-(1-q)*f*T*(K+q*k*(j+q*B*(2*j*j-1)))))/wu;return e[0]=Y,e[1]=Z,e}function xse(e,t,i,r){const s=t[0]*wu,n=t[1]*wu,o=i[0]*wu,a=i[1]*wu,{a:l,b:c,f:h,radius:p}=V8(r),f=o-s,m=Math.atan((1-h)*Math.tan(n)),g=Math.atan((1-h)*Math.tan(a)),y=Math.sin(m),x=Math.cos(m),b=Math.sin(g),S=Math.cos(g);let T,C,A,O,D,U,k,B,j,H,K=1e3,ee=f;do{if(k=Math.sin(ee),B=Math.cos(ee),A=Math.sqrt(S*k*(S*k)+(x*b-y*S*B)*(x*b-y*S*B)),A===0)return e.distance=0,e.azimuth=void 0,e.reverseAzimuth=void 0,e;D=y*b+x*S*B,U=Math.atan2(A,D),j=x*S*k/A,C=1-j*j,O=D-2*y*b/C,isNaN(O)&&(O=0),H=h/16*C*(4+h*(4-3*C)),T=ee,ee=f+(1-H)*h*j*(U+H*A*(O+H*D*(2*O*O-1)))}while(Math.abs(ee-T)>1e-12&&--K>0);if(K===0){const Y=p,te=Math.acos(Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.cos(o-s))*Y,se=o-s,J=Math.sin(se)*Math.cos(a),ae=Math.cos(n)*Math.sin(a)-Math.sin(n)*Math.cos(a)*Math.cos(se),_e=Math.atan2(J,ae);return e.azimuth=_e/wu,e.distance=te,e.reverseAzimuth=void 0,e}const ce=C*(l*l-c*c)/(c*c),le=ce/1024*(256+ce*(ce*(74-47*ce)-128)),z=c*(1+ce/16384*(4096+ce*(ce*(320-175*ce)-768)))*(U-le*A*(O+le/4*(D*(2*O*O-1)-le/6*O*(4*A*A-3)*(4*O*O-3)))),q=Math.atan2(S*Math.sin(ee),x*b-y*S*Math.cos(ee)),Z=Math.atan2(x*Math.sin(ee),x*b*Math.cos(ee)-y*S);return e.azimuth=q/wu,e.distance=z,e.reverseAzimuth=Z/wu,e}const h$e="ProfileGenerationError";var fp;(function(e){e.TooComplex="too-complex",e.InvalidGeometry="invalid-geometry",e.InvalidElevationInfo="invalid-elevation-info",e.ElevationQueryError="elevation-query-error"})(fp||(fp={}));class PA extends Error{constructor(t){super("profile could not be generated"),this.cause=t,this.type=h$e}}function tIt(e){return e.type===h$e}async function iIt(e,t,i,r,s,n,o){let a,l,c;const h=e.spatialReference,p=h.isGeographic||h.isWebMercator,f=await import("./geometryEngineAsync.51a9eb35.js");qt(o);let m=0;p||(m=await f.planarLength(e,"meters"),qt(o));const g=1/$n(r);if(p||m>=s.geodesicDistanceThreshold){await KA([{source:h,dest:r},{source:h,dest:at.WGS84}],o);const y=pIt(e);a=KPt([y],"meters")[0];const x=cye(a,s);if(dye(e,a,x)>n)throw new PA(fp.TooComplex);const b=uye(y,t,i);({densifiedPath:l,distances:c}=oIt(b,x,g)),l=Tp(l,r)}else{await KA([{source:h,dest:r}],o),a=m;const y=cye(a,s);if(dye(e,a,y)>n)throw new PA(fp.TooComplex);const x=uye(e,t,i);({densifiedPath:l,distances:c}=nIt(x,y,g)),qt(o),l=Tp(l,r)}return{densifiedPath:l,pathLength:a*g,distances:c}}function cye(e,t){const i=e/t.densificationMaxSamples;return Math.max(t.samplingDistance,i)}function uye(e,t,i){if(M(t))return hye(e);const r=e.spatialReference,s=t.mode,n=Ye(t.offset,0);let o=null;switch(i.type){case"2d":o=rIt(e,s,n);break;case"3d":o=sIt(e,s,n,i)}return M(o)?hye(e):new Fa({hasZ:!0,hasM:!1,spatialReference:r,paths:d$e(e.paths,o)})}function rIt({hasZ:e},t,i){return t==="absolute-height"?e?([r,s,n])=>[r,s,n+i]:([r,s])=>[r,s,i]:null}function sIt({spatialReference:e,hasZ:t},i,r,{elevationProvider:s}){const n=(o,a,l,c)=>Ye(s.getElevation(o,a,l,e,c),0);switch(i){case"on-the-ground":return([o,a])=>[o,a,n(o,a,0,"ground")];case"absolute-height":return t?([o,a,l])=>[o,a,l+r]:([o,a])=>[o,a,r];case"relative-to-ground":return t?([o,a,l])=>[o,a,l+n(o,a,l,"ground")+r]:([o,a])=>[o,a,n(o,a,0,"ground")+r];case"relative-to-scene":return t?([o,a,l])=>[o,a,l+n(o,a,l,"scene")+r]:([o,a])=>[o,a,n(o,a,0,"scene")+r];default:return null}}function hye(e){return e.hasZ?new Fa({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:d$e(e.paths,([t,i])=>[t,i])}):e}function d$e(e,t){const i=e.length,r=new Array(i);for(let s=0;s<i;++s){const n=e[s],o=n.length,a=new Array(n.length);r[s]=a;for(let l=0;l<o;++l)a[l]=t(n[l])}return r}function Tse(e){return nD(e)&&e.paths.length>0&&e.paths.every(t=>t.length>=2)}function nD(e){return _(e)&&e.type==="polyline"}function p$e(e,t,i,r,s){const{spatialReference:n,hasZ:o}=e,a={from:null,to:null,distance:0,azimuth:0,reverseAzimuth:0,spatialReference:n,metersPerSR:$n(n)},l=new Array(e.paths.length),c=new Array(e.paths.length);let h=0;for(let p=0;p<e.paths.length;++p){const f=e.paths[p],m=new Array,g=new Array;let y=0;for(let x=1;x<f.length;++x){const b=f[x-1],S=f[x],T=r(a,b,S);let C;for(C=y;C<T.distance;C+=t)m.push(s(T,C)),g.push((h+C)*i);y=C-T.distance,h+=T.distance,m.push(S),g.push(h*i)}l[p]=m,c[p]=g}return{densifiedPath:new Fa({spatialReference:n,hasZ:o,paths:l}),distances:c}}function nIt(e,t,i){const{hasZ:r}=e;return p$e(e,t,i,lIt,r?dIt:hIt)}function oIt(e,t,i){const{hasZ:r}=e;return p$e(e,t,i,aIt,r?uIt:cIt)}function aIt(e,t,i){return e.distance=0,xse(e,t,i,e.spatialReference),e.from=t,e.to=i,e}function lIt(e,t,i){return e.from=t,e.to=i,e.distance=a2(i,t)*e.metersPerSR,e}function cIt({from:e,azimuth:t,spatialReference:i},r){return RA([0,0],e,t,r,i)}function uIt({from:e,to:t,azimuth:i,distance:r,spatialReference:s},n){const o=n/r,a=[0,0,ui(e[2],t[2],o)];return RA(a,e,i,n,s),a}function hIt({from:e,to:t,distance:i},r){return F0([0,0],e,t,r/i)}function dIt({from:e,to:t,distance:i},r){return Pn([0,0,0],e,t,r/i)}function pIt(e){return B8(e.spatialReference)?e:Tp(e,at.WGS84)}function f$e(e){return e.paths.reduce((t,i)=>t+i.length,0)}function dye(e,t,i){return f$e(e)+Math.floor(t/i)+Math.max(0,e.paths.reduce(r=>1+r,0)-1)}class fIt{constructor(t,i){this.item=t,this.controller=i,this.promise=null}}class mIt{constructor(t){this._deferreds=new Map,this._controllers=new Map,this._processingItems=new Map,this._isPaused=!1,this._schedule=null,this._task=null,this.concurrency=1,t.concurrency&&(this.concurrency=t.concurrency),this._queue=new xU(t.peeker),this.process=t.process;const i=t.scheduler;t.priority&&_(i)&&(this._task=i.registerTask(t.priority,this))}destroy(){this.clear(),this._schedule&&(this._schedule.remove(),this._schedule=null),this._task&&(this._task.remove(),this._task=null)}get length(){return this._processingItems.size+this._queue.length}abort(t){const i=this._controllers.get(t);i&&i.abort()}clear(){this._queue.clear();const t=[];this._controllers.forEach(i=>t.push(i)),this._controllers.clear(),t.forEach(i=>i.abort()),this._processingItems.clear(),this._cancelNext()}forEach(t){this._deferreds.forEach((i,r)=>t(r))}get(t){const i=this._deferreds.get(t);return i?i.promise:void 0}isOngoing(t){return this._processingItems.has(t)}has(t){return this._deferreds.has(t)}pause(){this._isPaused||(this._isPaused=!0,this._cancelNext())}push(t,i){const r=this.get(t);if(r)return r;const s=new AbortController;let n=null;i&&(n=va(i,()=>s.abort()));const o=()=>{const h=this._processingItems.get(t);h&&h.controller.abort(),a(),c.reject(mi())},a=()=>{l.remove(),_(n)&&n.remove(),this._deferreds.delete(t),this._controllers.delete(t),this._queue.remove(t),this._processingItems.delete(t),this._scheduleNext()},l=kV(s.signal,o),c=hv();return this._deferreds.set(t,c),this._controllers.set(t,s),c.promise.then(a,a),this._queue.push(t),this._scheduleNext(),c.promise}last(){return this._queue.last()}peek(){return this._queue.peek()}popLast(){return this._queue.popLast()}reset(){const t=[];this._processingItems.forEach(i=>t.push(i)),this._processingItems.clear();for(const i of t)this._queue.push(i.item),i.controller.abort();this._scheduleNext()}resume(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())}takeAll(){const t=[];for(;this._queue.length;)t.push(this._queue.pop());return this.clear(),t}get running(){return!this._isPaused&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(t){for(;!t.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),t.madeProgress()}_scheduleNext(){this._task||this._isPaused||this._schedule||(this._schedule=Zb(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(t,i){this._canProcessFulfillment(t)&&(this._scheduleNext(),this._deferreds.get(t.item).resolve(i))}_processError(t,i){this._canProcessFulfillment(t)&&(this._scheduleNext(),this._deferreds.get(t.item).reject(i))}_canProcessFulfillment(t){return!!this._deferreds.get(t.item)&&this._processingItems.get(t.item)===t}_process(t){if(M(t))return;let i;const r=new AbortController,s=new fIt(t,r);this._processingItems.set(t,s);try{i=this.process(t,r.signal)}catch(n){this._processError(s,n)}qu(i)?(s.promise=i,i.then(n=>this._processResult(s,n),n=>this._processError(s,n))):this._processResult(s,i)}get test(){return{update:t=>this.runTask(t)}}}function gIt(e,t){const i=e.length;if(i===0)return null;const r=e[0],s=r.sampledZ;let n=s,o=s,a=0,l=0,c=null,h=null,p=_(s)?s:0,f=0,m=0,g=_(s)?1:0,y=0,x=0;const b=$n(t),S=rd(t),T=XPt/b,C=2*T,A=new pye,O=new pye,D=()=>{k(),A.copy(O),O.reset()},U=(B,j)=>{D();const H=A||B-A.start>C?B:A.start+T;O.restart(H,j)},k=()=>{if(A.isHole||O.isHole)return;const B=O.avgElevation-A.avgElevation,j=O.start-A.start,H=B*S,K=j*b,ee=tr(Math.atan2(H,K),"radians","degrees");ee>0?(f+=ee,c=q0(c,ee),y++):ee<0&&(m-=ee,h=q0(h,-ee),x++)};_(r.sampledZ)&&U(r.distance,r.sampledZ);for(let B=1;B<i;++B){const j=e[B-1],H=e[B],K=H.sampledZ;if(M(K)){O.isHole||D();continue}g++,p+=K,n=Sse(n,K),o=q0(o,K),O.isHole||H.distance-O.start>=T?U(H.distance,K):O.insert(K);const ee=j.sampledZ;if(_(ee)){const ce=K-ee;ce>0?a+=ce:ce<0&&(l-=ce)}}return D(),g===0?null:{maxDistance:e[i-1].distance,minElevation:n,maxElevation:o,avgElevation:g===0?null:p/g,elevationGain:a,elevationLoss:l,maxPositiveSlope:c,maxNegativeSlope:h,avgPositiveSlope:y===0?null:f/y,avgNegativeSlope:x===0?null:m/x}}function yIt(e){const t=e.filter(_),i=t.length;if(i===0)return null;const r=t[0];if(i===1)return r;let s=r.maxDistance,n=r.minElevation,o=r.maxElevation,a=r.maxPositiveSlope,l=r.maxNegativeSlope;for(let c=1;c<t.length;++c){const h=t[c];s=q0(s,h.maxDistance),n=Sse(n,h.minElevation),o=q0(o,h.maxElevation),a=q0(a,h.maxPositiveSlope),l=q0(l,h.maxNegativeSlope)}return{maxDistance:s,minElevation:n,maxElevation:o,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:a,maxNegativeSlope:l,avgPositiveSlope:null,avgNegativeSlope:null}}function vIt(e){let t=null,i=null,r=null;for(const s of e){if(M(s))continue;const{statistics:n,spatialReference:o}=s;if(M(n))continue;const a=$n(o);t=q0(t,CH(n.maxDistance,a));const l=rd(o);r=Sse(r,CH(n.minElevation,l)),i=q0(i,CH(n.maxElevation,l))}return{minDistance:0,maxDistance:Ye(t,0),minElevation:Ye(r,0),maxElevation:Ye(i,0)}}function Sse(e,t){return M(t)?e:_(e)?Math.min(e,t):t}function q0(e,t){return M(t)?e:_(e)?Math.max(e,t):t}function CH(e,t){return _(e)&&_(t)?e*t:null}class pye{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return this._sampleCount===0}get start(){return this._start}copy(t){this._start=t._start,this._sampleCount=t._sampleCount,this._totalElevation=t._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(t,i){this._start=t,this._sampleCount=1,this._totalElevation=i}insert(t){++this._sampleCount,this._totalElevation+=t}}function _It(e,t,i=[]){if(e>=t||(i.push(e),t-e<2))return i;const r=t-1;i.push(r);const s=YJ(e+1,r);for(;;){const n=s.next();if(n.done)break;i.push(n.value)}return i}function*YJ(e,t){if(e>=t)return;const i=e+Math.floor((t-e)/2);yield i;const r=YJ(e,i),s=YJ(i+1,t);for(;;){const n=r.next(),o=s.next();if(n.done&&o.done)break;n.done||(yield n.value),o.done||(yield o.value)}}async function*bIt(e,t){var x;const{view:i,geometry:r,elevationInfo:s,providers:n,options:o}=e;if(M(r)||!Tse(r))throw new PA(fp.InvalidGeometry);const a=i.spatialReference,l=n.length;if(l===0)return x1;const c=Math.round(o.maxTotalSamples/l);if(f$e(r)>c)throw new PA(fp.TooComplex);const h=await iIt(r,s,i,a,o,c,t);let p=0;const f=new Array(l),m=new Array(l);for(let b=0;b<l;b++){const S=CIt(h);f[b]=S,p+=S.samples.length;const T=me(F({},e),{provider:n[b],result:S,densificationResult:h});m[b]=wIt(T,t)[Symbol.iterator]()}if(p>o.maxTotalSamples)throw new PA(fp.TooComplex);const g=await Promise.all(m.map(b=>{const S=b.next();return S.done===!0?Promise.resolve(null):S.value}));qt(t);for(let b=0;b<l;b++)f[b]=g[b];yield f,await nS((x=e.delayAfterPreview)!=null?x:GPt,null,t.signal);const y=[];try{let b;do{b=!1;for(let S=0;S<l;S++){const T=m[S].next();T.done===!1&&(y.push({resultPromise:T.value,index:S}),b=!0)}}while(b)}finally{m.forEach(b=>{var S;return(S=b.return)==null?void 0:S.call(b)})}for(const{resultPromise:b,index:S}of y)f[S]=await b,qt(t),yield f;B4e(f,b=>{b.progress=1}),yield f}function*wIt(e,t){const{densificationResult:i}=e,r=me(F({},e),{abortOptions:t,densificationResult:i}),s=_It(0,r.result.samples.length),n=s.slice(0,r.provider.numSamplesForPreview);yield fye(r,n,!0);const o=G0e(s,r.provider.numSamplesPerChunk);for(const a of o)yield fye(r,a,!1)}async function fye({densificationResult:e,result:t,provider:i,queue:r,abortOptions:s,cache:n},o,a){const{densifiedPath:l,pathLength:c}=e,h=t.spatialReference,{samples:p}=t,f=new Array(o.length);for(let m=0;m<o.length;m++){const g=p[o[m]];f[m]=g.coordinate}try{return await r.push({geometry:new Wf({spatialReference:h,points:f,hasZ:l.hasZ}),provider:i,indices:o,preview:a,result:t,queryOptions:me(F({},VPt),{minDemResolution:Math.round(a?c/i.numSamplesForPreview:c/p.length),cache:n})},s),F({},t)}catch(m){return as(m)?null:YPt}}function xIt(e){return new mIt({priority:Ot.ELEVATION_PROFILE,concurrency:1,scheduler:e,process:async t=>{qt(t.queryOptions);try{await TIt(t)}catch(i){sU(i)}}})}async function TIt({geometry:e,provider:t,indices:i,preview:r,result:s,queryOptions:n}){if(i.length===0)return;const o=(await MIt(t,e,n)).geometry,{hasZ:a,points:l}=o,c=n.noDataValue,{samples:h}=s;for(let p=0;p<i.length;p++){const f=h[i[p]];if(f.isHole)continue;const m=a?l[p][2]:null;m===null||m===c?f.sampledZ=null:(s.hasZ=!0,f.sampledZ=m),f.sampled=!0}SIt(h),s.progress=r?0:s.progress+i.length/h.length,s.statistics=gIt(s.samples,s.spatialReference)}function SIt(e){const t=e.length-1;let i=0;for(let r=1;r<=t;r++)(e[r].sampled||r===t)&&(EIt(e,i,r),i=r)}function EIt(e,t,i){if(i-t==1)return;const r=e[t],s=r.sampledZ,n=e[i],o=n.sampledZ;if(M(s)||M(o)){for(let c=t+1;c<i;c++)e[c].sampledZ=null;return}const a=r.distance,l=n.distance-a;for(let c=t+1;c<i;c++){const h=e[c],p=(h.distance-a)/l;h.sampledZ=ui(s,o,p)}}function CIt({densifiedPath:e,distances:t}){const i=e.spatialReference,r=e.paths,s=r.length,n=2*(s-1),o=r.reduce((f,m)=>f+m.length,0)+n,a=new Array(o);let l=0,c=null,h=0;const p=(f,m,g,y)=>{a[l++]=mye(f,g),a[l++]=mye(m,y)};for(let f=0;f<s;f++){const m=r[f],g=t[f];for(let y=0;y<m.length;y++){const x=m[y],b=g[y];c&&y===0&&p(c,x,h,b),a[l++]=AIt(x,b),c=x,h=b}}return{progress:0,samples:a,hasZ:!1,statistics:null,spatialReference:i}}function AIt(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!1,isHole:!1}}function mye(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!0,isHole:!0}}async function MIt(e,t,i){try{return await e.queryElevation(t,i)}catch{throw new PA(fp.ElevationQueryError)}}const gye="line-change";let g1=class extends Ee{constructor(e){super(e),this._handles=new Nt,this._updateTask=null,this._paramsPerProfile=new Map,this._getUpdateParametersMemoized=Zh((t,i,r)=>({stationary:t,visibleProfiles:i,generationParameters:r})),this._getGenerationParametersMemoized=Zh((t,i,r,s,n,o,a)=>nD(i)&&Tse(i)&&!M(s)?{view:t,geometry:i,elevationInfo:r,options:o,queue:s,cache:n,slicePlane:a}:null),this._getElevationInfoMemoized=Zh((t,i)=>({mode:t,offset:i})),this._getOptionsMemoized=Zh((t,i,r)=>({geodesicDistanceThreshold:t,samplingDistance:i,densificationMaxSamples:Math.round(jPt/r),maxTotalSamples:WPt})),this._updateThrottled=gL(t=>VA(this._update(t)),BPt)}initialize(){const e=this.viewModel;this._handles.add([re(()=>e.profiles.toArray(),t=>{this._abortUpdate(),this._paramsPerProfile.clear(),this._handles.remove(gye),this._handles.add(t.map(i=>td([i.attach(this.viewModel),i.on("change",()=>{this._invalidateProfile(i)})])),gye)},fi),this._updateThrottled,re(()=>this._updateParameters,this._updateThrottled,fi)])}destroy(){this._handles.destroy(),this._paramsPerProfile.clear()}get _updateParameters(){const{viewModel:e}=this,t=e.view;return this._getUpdateParametersMemoized(!_(t)||t.stationary,this.viewModel.visibleProfiles,this._generationParameters)}get _generationParameters(){const{view:e,input:t,queue:i,tileCache:r}=this.viewModel;return M(e)||!e.ready?null:this._getGenerationParametersMemoized(e,wt(t,s=>s.geometry),this._elevationInfo,i,r,this._options,e.type==="3d"?e.slicePlane:null)}get _elevationInfo(){const e=wt(this.viewModel.input,t=>z8(t)?null:n$e(t));return _(e)?this._getElevationInfoMemoized(e.mode,e.offset):null}get _options(){const e=this.viewModel,t=e.visibleProfiles.length;let i=Ye(e.minDemResolution,l$e);return i=parseFloat(i.toFixed(2)),this._getOptionsMemoized(e.geodesicDistanceThreshold,i,t)}async _update({stationary:e,visibleProfiles:t,generationParameters:i}){this._abortUpdate(),e&&(M(i)?this._clearResults():this._updateTask=Pv(async r=>{this.viewModel.error=null;const s=t.filter(o=>!this._isProfileValid(o,i)),n=bIt(me(F({},i),{providers:s}),{signal:r});try{for await(const o of n){qt(r),this._clearInvalidResults(i);for(let a=0;a<s.length;a++)s[a].result=o[a]}for(const o of s)this._paramsPerProfile.set(o,i)}catch(o){cl(o),this._abortUpdate(),this.viewModel.error=o,s.forEach(a=>{a.result=null})}}))}_abortUpdate(){this._updateTask=Wn(this._updateTask)}_isProfileValid(e,t){return this._paramsPerProfile.has(e)&&this._paramsPerProfile.get(e)===t}_invalidateProfile(e){this._paramsPerProfile.delete(e),this._updateThrottled(this._updateParameters)}_clearInvalidResults(e){for(const t of this.viewModel.profiles.items)this._isProfileValid(t,e)||(t.result=null,this._paramsPerProfile.delete(t))}_clearResults(){for(const e of this.viewModel.profiles.items)e.result=null,this._paramsPerProfile.delete(e)}};u([d({nonNullable:!0})],g1.prototype,"viewModel",void 0),u([d()],g1.prototype,"_updateParameters",null),u([d()],g1.prototype,"_generationParameters",null),u([d()],g1.prototype,"_elevationInfo",null),u([d()],g1.prototype,"_options",null),g1=u([L("esri.widgets.ElevationProfile.ElevationProfileController")],g1);function OIt(e,t){if(M(e)||M(t))return null;const{samples:i,spatialReference:r}=e,{distance:s,elevation:n}=t,o=$n(r),a=rd(r),l=i.length,c=new Array(l);for(let h=0;h<l;++h){const p=i[h],f=p.sampledZ,m=p.coordinate;c[h]={x:m[0],y:m[1],z:f,distance:m$e(p.distance,o,s),elevation:TC(f,a,n)}}return c}function RIt(e,t){if(M(e)||M(t)||M(e.statistics)||M(e.spatialReference))return null;const{distance:i,elevation:r}=t,{statistics:s,spatialReference:n}=e,o=$n(n),a=rd(n);return{maxDistance:m$e(s.maxDistance,o,i),minElevation:TC(s.minElevation,a,r),maxElevation:TC(s.maxElevation,a,r),avgElevation:TC(s.avgElevation,a,r),elevationGain:TC(s.elevationGain,a,r),elevationLoss:TC(s.elevationLoss,a,r),maxPositiveSlope:s.maxPositiveSlope,maxNegativeSlope:s.maxNegativeSlope,avgPositiveSlope:s.avgPositiveSlope,avgNegativeSlope:s.avgNegativeSlope}}function m$e(e,t,i){return e==null?null:tr(e*t,"meters",i)}function TC(e,t,i){return e==null?null:tr(e*t,"meters",i)}let _n=class extends cs.EventedAccessor{constructor(e){super(e),this.type=null,this.id=AB(),this.title=null,this.color=new Le("#000000"),this.visible=!0,this._getSamplesMemoized=Zh((t,i)=>OIt(t,i)),this._getStatisticsMemoized=Zh((t,i)=>RIt(t,i)),this.viewVisualizationEnabled=!0,this.result=null,this.effectiveUnits=null,this.numSamplesForPreview=30,this.numSamplesPerChunk=200,this.chartFillEnabled=!0,this.chartStrokeWidth=1.5,this.chartStrokeOffsetY=0}get progress(){return _(this.result)&&this.visible?this.result.progress:0}get samples(){return this._getSamplesMemoized(this.result,this.effectiveUnits)}get statistics(){return this._getStatisticsMemoized(this.result,this.effectiveUnits)}get hoveredPoint(){return wt(this._viewModel.hoveredChartPosition,e=>this._getPoint(e))}get available(){return!0}get hasZ(){const e=this.result;return _(e)&&e.hasZ}get minDemResolution(){return l$e}queryElevation(){throw new Error("not implemented")}attach(e){return this._viewModel=e,td([re(()=>e.effectiveUnits,t=>{this.effectiveUnits=t},fi),re(()=>[e.input],()=>this._onChange(),Ui)])}toggleVisibility(e){this.visible=e===void 0?!this.visible:e}_onChange(){this.emit("change")}_getPoint(e){const{samples:t,result:i}=this;if(M(t)||M(i))return null;const r=t.length;if(r===0)return null;const s=e*t[r-1].distance,{x:n,y:o,z:a}=H0e(t,s,l=>l.distance);return M(a)?null:new dt({x:n,y:o,z:a,spatialReference:i.spatialReference})}};u([d({nonNullable:!0})],_n.prototype,"id",void 0),u([d({nonNullable:!0})],_n.prototype,"title",void 0),u([d({type:Le,nonNullable:!0})],_n.prototype,"color",void 0),u([d({nonNullable:!0})],_n.prototype,"visible",void 0),u([d({readOnly:!0})],_n.prototype,"progress",null),u([d({readOnly:!0})],_n.prototype,"samples",null),u([d({readOnly:!0})],_n.prototype,"statistics",null),u([d()],_n.prototype,"hoveredPoint",null),u([d()],_n.prototype,"viewVisualizationEnabled",void 0),u([d()],_n.prototype,"available",null),u([d()],_n.prototype,"result",void 0),u([d()],_n.prototype,"effectiveUnits",void 0),u([d()],_n.prototype,"numSamplesForPreview",void 0),u([d()],_n.prototype,"numSamplesPerChunk",void 0),u([d()],_n.prototype,"chartFillEnabled",void 0),u([d()],_n.prototype,"chartStrokeWidth",void 0),u([d()],_n.prototype,"chartStrokeOffsetY",void 0),u([d({readOnly:!0})],_n.prototype,"hasZ",null),u([d({readOnly:!0})],_n.prototype,"minDemResolution",null),u([d()],_n.prototype,"_viewModel",void 0),_n=u([L("esri.widgets.ElevationProfile.ElevationProfileLine")],_n);const oD=_n;function g$e(e){if(M(e))return null;if(e instanceof r$)return y$e(e);const t=e.tileInfo;if(M(t))return null;const i=G4e(t.lods);return M(i)?null:i.resolution*$n(t.spatialReference)}function y$e(e){var i;if(M(e))return null;const t=e.layers.items.map(PIt).filter(_);return(i=B0e(t))!=null?i:null}function PIt(e){return"tileInfo"in e?g$e(e):null}let cg=class extends oD{constructor(e){super(e),this.type="ground",this.color=new Le("#ff7f00"),this.viewVisualizationEnabled=!0,this.numSamplesForPreview=50,this.numSamplesPerChunk=1e3,this._getQueryElevationDependencies=Zh((t,i)=>({ground:t,groundLayers:i}))}get available(){const e=this._ground;return _(e)&&e.layers.some(t=>t.visible)}get minDemResolution(){return y$e(this._ground)}get queryElevationDependencies(){return this._getQueryElevationDependencies(this._ground,this._groundLayers)}get _ground(){var e;return wt((e=this._viewModel)==null?void 0:e.view,t=>{var i;return(i=t.map)==null?void 0:i.ground})}get _groundLayers(){const e=this._ground,t=wt(e,i=>{var r;return(r=i.layers)==null?void 0:r.toArray()});return Ye(t,[])}async queryElevation(e,t){const i=this.queryElevationDependencies;if(M(i))throw new Error("ElevationProfileLineGround: no dependencies");const{ground:r}=i;if(M(r))throw new Error("No ground configured in the view");const s=await r.queryElevation(e,t),n=rd(e.spatialReference),o=rd(r.layers.getItemAt(0).spatialReference);if(n!==o){const a=s.geometry;a.points=a.points.map(([l,c,h])=>[l,c,h===t.noDataValue?h:h*o/n])}return s}attach(e){return td([super.attach(e),re(()=>this.queryElevationDependencies,()=>this._onChange())])}};u([d({type:Le,nonNullable:!0})],cg.prototype,"color",void 0),u([d()],cg.prototype,"viewVisualizationEnabled",void 0),u([d()],cg.prototype,"available",null),u([d({readOnly:!0})],cg.prototype,"minDemResolution",null),u([d()],cg.prototype,"queryElevationDependencies",null),u([d()],cg.prototype,"_ground",null),u([d()],cg.prototype,"_groundLayers",null),cg=u([L("esri.widgets.ElevationProfile.ElevationProfileLineGround")],cg);const v$e=cg;class yye{constructor(t,i=null){if(this.tile=t,this.zmin=0,this.zmax=0,_(i)){const r=t.extent;this.samplerData={pixelData:i.values,width:i.width,height:i.height,safeWidth:.99999999*(i.width-1),noDataValue:i.noDataValue,dx:(i.width-1)/(r[2]-r[0]),dy:(i.width-1)/(r[3]-r[1]),x0:r[0],y1:r[3]},this.zmin=i.minValue,this.zmax=i.maxValue}}sample(t,i){if(M(this.samplerData))return;const{safeWidth:r,width:s,pixelData:n,noDataValue:o,dx:a,dy:l,y1:c,x0:h}=this.samplerData,p=vye(l*(c-i),0,r),f=vye(a*(t-h),0,r),m=Math.floor(p),g=Math.floor(f),y=m*s+g,x=y+s,b=n[y],S=n[x],T=n[y+1],C=n[x+1];if(b!==o&&S!==o&&T!==o&&C!==o){const A=f-g,O=b+(T-b)*A;return O+(S+(C-S)*A-O)*(p-m)}}}function vye(e,t,i){return e<t?t:e>i?i:e}class IIt{async queryAll(t,i,r){if(!(t=r&&r.ignoreInvisibleLayers?t.filter(c=>c.visible):t.slice()).length)throw new W("elevation-query:invalid-layer","Elevation queries require at least one elevation layer to fetch tiles from");const s=Gf.fromGeometry(i);let n=!1;r&&r.returnSampleInfo||(n=!0);const o=me(F(F({},x4),r),{returnSampleInfo:!0}),a=await this.query(t[t.length-1],s,o),l=await this._queryAllContinue(t,a,o);return l.geometry=l.geometry.export(),n&&delete l.sampleInfo,l}async query(t,i,r){if(!t)throw new W("elevation-query:invalid-layer","Elevation queries require an elevation layer to fetch tiles from");if(!i||!(i instanceof Gf)&&i.type!=="point"&&i.type!=="multipoint"&&i.type!=="polyline")throw new W("elevation-query:invalid-geometry","Only point, polyline and multipoint geometries can be used to query elevation");const s=F(F({},x4),r),n=new $It(t,i.spatialReference,s),o=s.signal;return await t.load({signal:o}),await this._createGeometryDescriptor(n,i,o),await this._selectTiles(n,o),await this._populateElevationTiles(n,o),this._sampleGeometryWithElevation(n),this._createQueryResult(n,o)}async createSampler(t,i,r){if(!t)throw new W("elevation-query:invalid-layer","Elevation queries require an elevation layer to fetch tiles from");if(!i||i.type!=="extent")throw new W("elevation-query:invalid-extent","Invalid or undefined extent");const s=F(F({},x4),r);return this._createSampler(t,i,s)}async createSamplerAll(t,i,r){if(!(t=r&&r.ignoreInvisibleLayers?t.filter(o=>o.visible):t.slice()).length)throw new W("elevation-query:invalid-layer","Elevation queries require at least one elevation layer to fetch tiles from");if(!i||i.type!=="extent")throw new W("elevation-query:invalid-extent","Invalid or undefined extent");const s=me(F(F({},x4),r),{returnSampleInfo:!0}),n=await this._createSampler(t[t.length-1],i,s);return this._createSamplerAllContinue(t,i,n,s)}async _createSampler(t,i,r,s){const n=r.signal;await t.load({signal:n});const o=i.spatialReference,a=t.tileInfo.spatialReference;o.equals(a)||(await KA([{source:o,dest:a}],{signal:n}),i=Tp(i,a));const l=new LIt(t,i,r,s);return await this._selectTiles(l,n),await this._populateElevationTiles(l,n),new fue(l.elevationTiles,l.layer.tileInfo,l.options.noDataValue)}async _createSamplerAllContinue(t,i,r,s){if(t.pop(),!t.length)return r;const n=r.samplers.map(c=>hK(c.extent)),o=await this._createSampler(t[t.length-1],i,s,n);if(o.samplers.length===0)return r;const a=r.samplers.concat(o.samplers),l=new fue(a,s.noDataValue);return this._createSamplerAllContinue(t,i,l,s)}async _queryAllContinue(t,i,r){const s=t.pop(),n=i.geometry.coordinates,o=[],a=[];for(let h=0;h<n.length;h++){const p=i.sampleInfo[h];p.demResolution>=0?p.source||(p.source=s):t.length&&(o.push(n[h]),a.push(h))}if(!t.length||o.length===0)return i;const l=i.geometry.clone(o),c=await this.query(t[t.length-1],l,r);return a.forEach((h,p)=>{n[h].z=c.geometry.coordinates[p].z,i.sampleInfo[h].demResolution=c.sampleInfo[p].demResolution}),this._queryAllContinue(t,i,r)}async _createQueryResult(t,i){const r={geometry:(await t.geometry.project(t.outSpatialReference,i)).export(),noDataValue:t.options.noDataValue};return t.options.returnSampleInfo&&(r.sampleInfo=this._extractSampleInfo(t)),t.geometry.coordinates.forEach(s=>{s.tile=null,s.elevationTile=null}),r}async _createGeometryDescriptor(t,i,r){let s;const n=t.layer.tileInfo.spatialReference;if(i instanceof Gf?s=await i.project(n,r):(await KA([{source:i.spatialReference,dest:n}],{signal:r}),s=Tp(i,n)),!s)throw new W("elevation-query:spatial-reference-mismatch",`Cannot query elevation in '${i.spatialReference.wkid}' on an elevation service in '${n.wkid}'`);t.geometry=Gf.fromGeometry(s)}async _selectTiles(t,i){const r=t.options.demResolution;if(t.type==="geometry"&&this._preselectOutsideLayerExtent(t),typeof r=="number")this._selectTilesClosestResolution(t);else if(r==="finest-contiguous")await this._selectTilesFinestContiguous(t,i);else{if(r!=="auto")throw new W("elevation-query:invalid-dem-resolution",`Invalid dem resolution value '${r}', expected a number, "finest-contiguous" or "auto"`);await this._selectTilesAuto(t,i)}}_preselectOutsideLayerExtent(t){if(M(t.layer.fullExtent))return;const i=new yye(null);i.sample=()=>t.options.noDataValue,t.outsideExtentTile=i;const r=t.layer.fullExtent;t.geometry.coordinates.forEach(s=>{const n=s.x,o=s.y;(n<r.xmin||n>r.xmax||o<r.ymin||o>r.ymax)&&(s.elevationTile=i)})}_selectTilesClosestResolution(t){const i=t.layer.tileInfo,r=this._findNearestDemResolutionLODIndex(i,t.options.demResolution);t.selectTilesAtLOD(r)}_findNearestDemResolutionLODIndex(t,i){const r=i/$n(t.spatialReference);let s=t.lods[0],n=0;for(let o=1;o<t.lods.length;o++){const a=t.lods[o];Math.abs(a.resolution-r)<Math.abs(s.resolution-r)&&(s=a,n=o)}return n}async _selectTilesFinestContiguous(t,i){const r=JJ(t.layer.tileInfo,t.options.minDemResolution);await this._selectTilesFinestContiguousAt(t,r,i)}async _selectTilesFinestContiguousAt(t,i,r){const s=t.layer;if(t.selectTilesAtLOD(i),i<0)return;const n=s.tilemapCache,o=t.getTilesToFetch();try{if(n)await VT(Promise.all(o.map(a=>n.fetchAvailability(a.level,a.row,a.col,{signal:r}))),r);else if(await this._populateElevationTiles(t,r),!t.allElevationTilesFetched())throw t.clearElevationTiles(),new W("elevation-query:has-unavailable-tiles")}catch(a){cl(a),await this._selectTilesFinestContiguousAt(t,i-1,r)}}async _populateElevationTiles(t,i){const r=t.getTilesToFetch(),s={},n=t.options.cache,o=t.options.noDataValue,a=r.map(async l=>{const c=`${t.layer.uid}:${l.id}:${o}`,h=_(n)?n.get(c):null,p=_(h)?h:await t.layer.fetchTile(l.level,l.row,l.col,{noDataValue:o,signal:i});_(n)&&n.put(c,p),s[l.id]=new yye(l,p)});await VT(Us(a),i),t.populateElevationTiles(s)}async _selectTilesAuto(t,i){this._selectTilesAutoFinest(t),this._reduceTilesForMaximumRequests(t);const r=t.layer.tilemapCache;if(!r)return this._selectTilesAutoPrefetchUpsample(t,i);const s=t.getTilesToFetch(),n={},o=s.map(async a=>{const l={id:null,level:0,row:0,col:0,extent:Qt()},c=await Hu(r.fetchAvailabilityUpsample(a.level,a.row,a.col,l,{signal:i}));c.ok===!1?cl(c.error):n[a.id]=l});await VT(Promise.all(o),i),t.remapTiles(n)}_reduceTilesForMaximumRequests(t){const i=t.layer.tileInfo;let r=0;const s={},n=l=>{l.id in s?s[l.id]++:(s[l.id]=1,r++)},o=l=>{const c=s[l.id];c===1?(delete s[l.id],r--):s[l.id]=c-1};t.forEachTileToFetch(n,o);let a=!0;for(;a&&(a=!1,t.forEachTileToFetch(l=>{r<=t.options.maximumAutoTileRequests||(o(l),i.upsampleTile(l)&&(a=!0),n(l))},o),a););}_selectTilesAutoFinest(t){const i=JJ(t.layer.tileInfo,t.options.minDemResolution);t.selectTilesAtLOD(i,t.options.maximumAutoTileRequests)}async _selectTilesAutoPrefetchUpsample(t,i){const r=t.layer.tileInfo;await this._populateElevationTiles(t,i);let s=!1;t.forEachTileToFetch((n,o)=>{r.upsampleTile(n)?s=!0:o()}),s&&await this._selectTilesAutoPrefetchUpsample(t,i)}_sampleGeometryWithElevation(t){t.geometry.coordinates.forEach(i=>{const r=i.elevationTile;let s=t.options.noDataValue;if(r){const n=r.sample(i.x,i.y);_(n)?s=n:i.elevationTile=null}i.z=s})}_extractSampleInfo(t){const i=t.layer.tileInfo,r=$n(i.spatialReference);return t.geometry.coordinates.map(s=>{let n=-1;return s.elevationTile&&s.elevationTile!==t.outsideExtentTile&&(n=i.lodAt(s.elevationTile.tile.level).resolution*r),{demResolution:n}})}}class Gf{export(){return this._exporter(this.coordinates,this.spatialReference)}clone(t){const i=new Gf;return i.geometry=this.geometry,i.spatialReference=this.spatialReference,i.coordinates=t||this.coordinates.map(r=>this._cloneCoordinate(r)),i._exporter=this._exporter,i}async project(t,i){if(this.spatialReference.equals(t))return this.clone();await KA([{source:this.spatialReference,dest:t}],{signal:i});const r=new Wf({spatialReference:this.spatialReference,points:this.coordinates.map(a=>[a.x,a.y])}),s=Tp(r,t);if(!s)return null;const n=this.coordinates.map((a,l)=>{const c=this._cloneCoordinate(a),h=s.points[l];return c.x=h[0],c.y=h[1],c}),o=this.clone(n);return o.spatialReference=t,o}_cloneCoordinate(t){return{x:t.x,y:t.y,z:t.z,m:t.m,tile:null,elevationTile:null}}static fromGeometry(t){const i=new Gf;if(i.geometry=t,i.spatialReference=t.spatialReference,t instanceof Gf)i.coordinates=t.coordinates.map(r=>i._cloneCoordinate(r)),i._exporter=(r,s)=>{const n=t.clone(r);return n.spatialReference=s,n};else switch(t.type){case"point":{const r=t,{hasZ:s,hasM:n}=r;i.coordinates=s&&n?[{x:r.x,y:r.y,z:r.z,m:r.m}]:s?[{x:r.x,y:r.y,z:r.z}]:n?[{x:r.x,y:r.y,m:r.m}]:[{x:r.x,y:r.y}],i._exporter=(o,a)=>t.hasM?new dt(o[0].x,o[0].y,o[0].z,o[0].m,a):new dt(o[0].x,o[0].y,o[0].z,a);break}case"multipoint":{const r=t,{hasZ:s,hasM:n}=r;i.coordinates=s&&n?r.points.map(o=>({x:o[0],y:o[1],z:o[2],m:o[3]})):s?r.points.map(o=>({x:o[0],y:o[1],z:o[2]})):n?r.points.map(o=>({x:o[0],y:o[1],m:o[2]})):r.points.map(o=>({x:o[0],y:o[1]})),i._exporter=(o,a)=>t.hasM?new Wf({points:o.map(l=>[l.x,l.y,l.z,l.m]),hasZ:!0,hasM:!0,spatiaReference:a}):new Wf(o.map(l=>[l.x,l.y,l.z]),a);break}case"polyline":{const r=t,s=[],n=[],{hasZ:o,hasM:a}=t;let l=0;for(const c of r.paths)if(n.push([l,l+c.length]),l+=c.length,o&&a)for(const h of c)s.push({x:h[0],y:h[1],z:h[2],m:h[3]});else if(o)for(const h of c)s.push({x:h[0],y:h[1],z:h[2]});else if(a)for(const h of c)s.push({x:h[0],y:h[1],m:h[2]});else for(const h of c)s.push({x:h[0],y:h[1]});i.coordinates=s,i._exporter=(c,h)=>{const p=t.hasM?c.map(m=>[m.x,m.y,m.z,m.m]):c.map(m=>[m.x,m.y,m.z]),f=n.map(m=>p.slice(m[0],m[1]));return new Fa({paths:f,hasM:t.hasM,hasZ:!0,spatialReference:h})};break}}return i}}class _$e{constructor(t,i){this.layer=t,this.options=i}}class $It extends _$e{constructor(t,i,r){super(t,r),this.outSpatialReference=i,this.type="geometry"}selectTilesAtLOD(t){if(t<0)this.geometry.coordinates.forEach(i=>i.tile=null);else{const i=this.layer.tileInfo,r=i.lods[t].level;this.geometry.coordinates.forEach(s=>{s.tile=i.tileAt(r,s.x,s.y)})}}allElevationTilesFetched(){return!this.geometry.coordinates.some(t=>!t.elevationTile)}clearElevationTiles(){for(const t of this.geometry.coordinates)t.elevationTile!==this.outsideExtentTile&&(t.elevationTile=null)}populateElevationTiles(t){for(const i of this.geometry.coordinates)!i.elevationTile&&i.tile&&(i.elevationTile=t[i.tile.id])}remapTiles(t){for(const i of this.geometry.coordinates)i.tile=t[i.tile.id]}getTilesToFetch(){const t={},i=[];for(const r of this.geometry.coordinates){const s=r.tile;r.elevationTile||!r.tile||t[s.id]||(t[s.id]=s,i.push(s))}return i}forEachTileToFetch(t){for(const i of this.geometry.coordinates)i.tile&&!i.elevationTile&&t(i.tile,()=>i.tile=null)}}class LIt extends _$e{constructor(t,i,r,s){super(t,r),this.type="extent",this.elevationTiles=[],this.candidateTiles=[],this.fetchedCandidates=new Set,this.extent=i.intersection(t.fullExtent),this.maskExtents=s}selectTilesAtLOD(t,i){const r=this._maximumLodForRequests(i),s=Math.min(r,t);s<0?this.candidateTiles.length=0:this._selectCandidateTilesCoveringExtentAt(s)}_maximumLodForRequests(t){const i=this.layer.tileInfo;if(!t)return i.lods.length-1;const r=this.extent;if(M(r))return-1;for(let s=i.lods.length-1;s>=0;s--){const n=i.lods[s],o=n.resolution*i.size[0],a=n.resolution*i.size[1];if(Math.ceil(r.width/o)*Math.ceil(r.height/a)<=t)return s}return-1}allElevationTilesFetched(){return this.candidateTiles.length===this.elevationTiles.length}clearElevationTiles(){this.elevationTiles.length=0,this.fetchedCandidates.clear()}populateElevationTiles(t){for(const i of this.candidateTiles){const r=t[i.id];r&&(this.fetchedCandidates.add(i),this.elevationTiles.push(r))}}remapTiles(t){this.candidateTiles=this._uniqueNonOverlappingTiles(this.candidateTiles.map(i=>t[i.id]))}getTilesToFetch(){return this.candidateTiles}forEachTileToFetch(t,i){const r=this.candidateTiles;this.candidateTiles=[],r.forEach(s=>{if(this.fetchedCandidates.has(s))return void(i&&i(s));let n=!1;t(s,()=>n=!0),n?i&&i(s):this.candidateTiles.push(s)}),this.candidateTiles=this._uniqueNonOverlappingTiles(this.candidateTiles,i)}_uniqueNonOverlappingTiles(t,i){const r={},s=[];for(const o of t)r[o.id]?i&&i(o):(r[o.id]=o,s.push(o));const n=s.sort((o,a)=>o.level-a.level);return n.filter((o,a)=>{for(let l=0;l<a;l++)if(yU(n[l].extent,o.extent))return i&&i(o),!1;return!0})}_selectCandidateTilesCoveringExtentAt(t){this.candidateTiles.length=0;const i=this.extent;if(M(i))return;const r=this.layer.tileInfo,s=r.lods[t],n=r.tileAt(s.level,i.xmin,i.ymin),o=s.resolution*r.size[0],a=s.resolution*r.size[1],l=Math.ceil((i.xmax-n.extent[0])/o),c=Math.ceil((i.ymax-n.extent[1])/a);for(let h=0;h<c;h++)for(let p=0;p<l;p++){const f={id:null,level:n.level,row:n.row-h,col:n.col+p};r.updateTileInfo(f),this._tileIsMasked(f)||this.candidateTiles.push(f)}}_tileIsMasked(t){return!!this.maskExtents&&this.maskExtents.some(i=>yU(i,t.extent))}}function JJ(e,t){let i=e.lods.length-1;if(t>0){const r=e.lods.findIndex(s=>s.resolution<t);r===0?i=0:r>0&&(i=r-1)}return i}const x4={maximumAutoTileRequests:20,noDataValue:0,returnSampleInfo:!1,demResolution:"auto",minDemResolution:0};var _ye=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",ElevationQuery:IIt,GeometryDescriptor:Gf,getFinestLodIndex:JJ});let y0=class extends oD{constructor(e){super(e),this.type="input",this.color=new Le("#00c8c8"),this.viewVisualizationEnabled=!1,this.numSamplesForPreview=50,this.numSamplesPerChunk=500,this.chartFillEnabled=!1,this.chartStrokeOffsetY=-1,this._getQueryElevationDependencies=Zh((t,i,r,s,n)=>wt(t,o=>({elevationInfo:o,visibleLayers:i,view:r,stationary:s,spatialReference:n})))}get queryElevationDependencies(){const e=this._viewModel.view;return M(e)?null:this._getQueryElevationDependencies(this._elevationInfo,this._visibleLayers,e,e.stationary,e.spatialReference)}get available(){return!this._viewModel.inputIsSketched}get _elevationInfo(){return wt(this._viewModel.input,n$e)}get _visibleLayers(){var i;const e=(i=this._viewModel)==null?void 0:i.view,t=wt(e,r=>{var s,n;return(n=(s=r.map)==null?void 0:s.allLayers)==null?void 0:n.filter(o=>o.visible).toArray()});return Ye(t,[])}async queryElevation(e,{noDataValue:t,signal:i}){const r=this.queryElevationDependencies;if(M(r))throw new Error("ElevationProfileLineInput: no dependencies");const{view:s,elevationInfo:n,spatialReference:o}=r;if(n.mode==="on-the-ground"&&s.type==="3d"){const a=await Gf.fromGeometry(e).project(o,i),l=s.elevationProvider;return a.coordinates.forEach(c=>{c.z=Ye(l.getElevation(c.x,c.y,0,o,"ground"),0)}),{geometry:a.export(),noDataValue:t}}return{geometry:e,noDataValue:t}}attach(e){const t=()=>this._onChange();return td([super.attach(e),re(()=>this.queryElevationDependencies,t),os(()=>e.elevationProvider,"elevation-change",t,{onListenerAdd:t,onListenerRemove:t})])}};u([d({type:Le,nonNullable:!0})],y0.prototype,"color",void 0),u([d()],y0.prototype,"viewVisualizationEnabled",void 0),u([d()],y0.prototype,"queryElevationDependencies",null),u([d()],y0.prototype,"available",null),u([d()],y0.prototype,"_elevationInfo",null),u([d()],y0.prototype,"_visibleLayers",null),y0=u([L("esri.widgets.ElevationProfile.ElevationProfileLineInput")],y0);const DIt=y0;let y1=class extends oD{constructor(e){super(e),this.type="query",this.color=new Le("#db334a"),this.viewVisualizationEnabled=!0,this.source=null,this.numSamplesForPreview=50,this.numSamplesPerChunk=500}get minDemResolution(){return g$e(this.source)}get available(){const e=this.source;return!!e&&(M(e.visible)||e.visible)&&(M(e.layers)||e.layers.some(t=>t.visible))}queryElevation(e,t){if(!this.source)throw new Error("No source configured for the elevation profile line");return this.source.queryElevation(e,t)}attach(e){return td([super.attach(e),re(()=>this.source,()=>this._onChange(),Ui)])}};u([d({type:Le,nonNullable:!0})],y1.prototype,"color",void 0),u([d()],y1.prototype,"viewVisualizationEnabled",void 0),u([d()],y1.prototype,"source",void 0),u([d({readOnly:!0})],y1.prototype,"minDemResolution",null),u([d()],y1.prototype,"available",null),y1=u([L("esri.widgets.ElevationProfile.ElevationProfileLineQuery")],y1);const NIt=y1,FIt=2e5;let vc=class extends oD{constructor(e){super(e),this.type="view",this.color=new Le("#cf4ccf"),this.viewVisualizationEnabled=!0,this.include=null,this.exclude=null,this.numSamplesForPreview=50,this.numSamplesPerChunk=25,this._getQueryElevationDependencies=Zh((t,i,r,s,n,o,a)=>({inputGraphicUid:_(t)?b$e(t):null,visibleLayers:i,maxIntersectionDistance:r,intersectOptions:s,view:n,stationary:o,spatialReference:a})),this._vecA=si(),this._vecB=si(),this._ray=Do()}get minDemResolution(){var i,r,s;const e=(i=this._viewModel)==null?void 0:i.view;if(M(e)||e.type!=="3d")return null;const t=(s=(r=e.pointsOfInterest)==null?void 0:r.focus)==null?void 0:s.renderLocation;return t?e.state.camera.computeRenderPixelSizeAt(t)*rd(e.spatialReference):null}get queryElevationDependencies(){return wt(this._view,e=>this._getQueryElevationDependencies(this._viewModel.input,this._visibleLayers,this._maxIntersectionDistance,this._intersectOptions,e,e.stationary,e.spatialReference))}get _visibleLayers(){const e=this._view,t=wt(e,i=>{var r,s;return(s=(r=i.map)==null?void 0:r.allLayers)==null?void 0:s.filter(n=>n.visible).toArray()});return Ye(t,[])}get _intersectOptions(){const e=this._view;if(M(e))return{};const t=e.externalToInternalIntersectOptions({include:this.include,exclude:this.exclude}),i=e.externalToInternalIntersectOptions({exclude:this._pointCloudLayers});return t.exclude=eke(t.exclude,i.exclude),t}get _pointCloudLayers(){const e=this._view;return M(e)?[]:e.allLayerViews.toArray().filter(t=>{var i;return((i=t.layer)==null?void 0:i.type)==="point-cloud"}).map(t=>t.layer)}get _view(){const e=this._viewModel.view;return _(e)&&e.type==="3d"?e:null}get _maxIntersectionDistance(){const e=this._view;return M(e)||!e.renderCoordsHelper?Number.POSITIVE_INFINITY:Ri(e.spatialReference).radius/e.renderCoordsHelper.unitInMeters}get _intersector(){const e=this._view;if(M(e))return null;const t=cd(e.state.viewingMode),i=t.options;return i.hud=!1,i.invisibleTerrain=!1,i.backfacesTerrain=!1,i.selectionMode=!1,i.store=Vo.ALL,t}async queryElevation(e,{noDataValue:t,signal:i}){var b;const r=this.queryElevationDependencies;if(M(r))throw new Error("ElevationProfileLineInput: no dependencies");const s=this._intersector;if(M(s))throw new Error("ElevationProfileLineInput: no view");const{intersectOptions:n,view:o,spatialReference:a}=r,l=o.renderCoordsHelper,c=o.sceneIntersectionHelper,h=this._vecA,p=this._vecA,f=this._vecB,m=this._ray,g=await Gf.fromGeometry(e).project(a,i),y=g.coordinates,x=y.length;for(let S=0;S<x;++S){const T=y[S];he(f,T.x,T.y,(b=T.z)!=null?b:0),l.toRenderCoords(f,a,f),l.setAltitude(h,FIt,f);const C=Twe(h,f,m);c.computeIntersection(C,s,n);const A=kIt(r,s.results.all);A?(A.getIntersectionPoint(p),l.fromRenderCoords(p,p,a),T.z=p[2]):T.z=t}return{geometry:g.export(),noDataValue:t}}attach(e){const t=()=>this._onChange();return td([super.attach(e),re(()=>this.queryElevationDependencies,t),os(()=>e.elevationProvider,"elevation-change",t,{onListenerAdd:t,onListenerRemove:t})])}};function kIt({view:e,inputGraphicUid:t,maxIntersectionDistance:i},r){for(const s of r){if(s.distanceInRenderSpace>i)continue;const n=fOt(s,e);if(M(n)||b$e(n)!==t)return s}return null}function b$e(e){if(e.layer&&"objectIdField"in e.layer){const t=e.attributes[e.layer.objectIdField];if(t)return`o-${e.layer.id}-${t}`}return`u-${e.uid}`}u([d({type:Le,nonNullable:!0})],vc.prototype,"color",void 0),u([d()],vc.prototype,"viewVisualizationEnabled",void 0),u([d()],vc.prototype,"include",void 0),u([d()],vc.prototype,"exclude",void 0),u([d({readOnly:!0})],vc.prototype,"minDemResolution",null),u([d()],vc.prototype,"queryElevationDependencies",null),u([d()],vc.prototype,"_visibleLayers",null),u([d()],vc.prototype,"_intersectOptions",null),u([d()],vc.prototype,"_pointCloudLayers",null),u([d()],vc.prototype,"_view",null),u([d()],vc.prototype,"_maxIntersectionDistance",null),u([d()],vc.prototype,"_intersector",null),vc=u([L("esri.widgets.ElevationProfile.ElevationProfileLineView")],vc);const UIt=vc,zIt={base:oD,key:"type",typeMap:{ground:v$e,input:DIt,query:NIt,view:UIt},errorContext:"elevation-profile-line"},VIt=nt.ofType(zIt);let v0=class extends Ste(KB(_S)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new QT,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};u([d({type:Y2e})],v0.prototype,"elevationInfo",void 0),u([d(SU(QT,"graphics"))],v0.prototype,"graphics",void 0),u([d({type:["show","hide"]})],v0.prototype,"listMode",void 0),u([d()],v0.prototype,"screenSizePerspectiveEnabled",void 0),u([d({readOnly:!0})],v0.prototype,"type",void 0),u([d({constructOnly:!0})],v0.prototype,"internal",void 0),v0=u([L("esri.layers.GraphicsLayer")],v0);const w$e=v0;function AH(e){switch(e){case Hr.SUPPORTED:break;case Hr.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case Hr.GEOMETRY_MISSING:return"no geometry";case Hr.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case Hr.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case Hr.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}var Hr;(function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"})(Hr||(Hr={}));function BIt(e){var t;if(((t=e.layer)==null?void 0:t.type)!=="graphics")return Hr.GRAPHICS_LAYER_MISSING;if(M(e.geometry))return Hr.GEOMETRY_MISSING;switch(e.geometry.type){case"polygon":case"point":case"polyline":case"mesh":break;default:return Hr.GEOMETRY_TYPE_UNSUPPORTED}return U8(e)!=="on-the-ground"&&z8(e)?Hr.ELEVATION_MODE_UNSUPPORTED:Hr.SUPPORTED}var QJ;let v1=QJ=class extends Uo{constructor(...e){super(...e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(e,t){let i;if(e&&e.center)i=e;else{if(e&&e.rings)return super.normalizeCtorArgs(e,t);i={center:e}}return F(F(F({},super.normalizeCtorArgs()),i),t)}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e&&e.hasZ,this.rings.length!==0||!e)return;const i=tr(this.radius,this.radiusUnit,"meters"),r=e.spatialReference;let s,n="geographic";if(r.isWebMercator?n="webMercator":(G[r.wkid]!=null||r.wkt&&r.wkt.indexOf("PROJCS")===0)&&(n="projected"),this.geodesic){let o;switch(n){case"webMercator":o=RC(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":o=e}s=this._createGeodesicCircle(o,i,t),n==="webMercator"&&(s=$g(s))}else{let o;n==="webMercator"||n==="projected"?o=i/this._convert2Meters(1,e.spatialReference):n==="geographic"&&(o=_be(i,"meters",Ri(e.spatialReference).radius)),s=this._createPlanarCircle(e,o,t)}this.spatialReference=s.spatialReference,this.addRing(s.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:i,radiusUnit:r,geodesic:s}=this;return new QJ({center:e.clone(),numberOfPoints:t,radius:i,radiusUnit:r,geodesic:s})}_createGeodesicCircle(e,t,i){let r=0;const s=[];for(;r<360;){const n=[0,0],o=[e.x,e.y];RA(n,o,r,t),this.hasZ&&n.push(e.z),s.push(n),r+=360/i}return s.push(s[0]),new Uo(s)}_createPlanarCircle(e,t,i){const r=[],s=2*Math.PI/i;for(let n=0;n<i;++n){const o=s*n,a=[e.x+Math.cos(-o)*t,e.y+Math.sin(-o)*t];this.hasZ&&a.push(e.z),r.push(a)}return r.push(r[0]),new Uo({spatialReference:e.spatialReference,rings:[r]})}_convert2Meters(e,t){let i;if(G[t.wkid]!=null)i=G.values[G[t.wkid]];else{const r=t.wkt,s=r.lastIndexOf(",")+1,n=r.lastIndexOf("]]");i=parseFloat(r.substring(s,n))}return e*i}};u([d({type:dt})],v1.prototype,"center",void 0),u([d()],v1.prototype,"geodesic",void 0),u([d()],v1.prototype,"numberOfPoints",void 0),u([d()],v1.prototype,"radius",void 0),u([d()],v1.prototype,"radiusUnit",void 0),v1=QJ=u([L("esri.geometry.Circle")],v1);const GIt=v1;function T4(e){return x$e(e).result}function Kkt(e){return x$e(e).geometry}function x$e(e){var t;return((t=e.layer)==null?void 0:t.type)!=="graphics"?{result:Hr.GRAPHICS_LAYER_MISSING,geometry:null}:M(e.geometry)?{result:Hr.GEOMETRY_MISSING,geometry:null}:U8(e)!=="on-the-ground"&&z8(e)?{result:Hr.ELEVATION_MODE_UNSUPPORTED,geometry:null}:e.geometry.type!=="point"&&e.geometry.type!=="polyline"&&(e.geometry.type!=="polygon"||e.geometry instanceof GIt)?{result:Hr.GEOMETRY_TYPE_UNSUPPORTED,geometry:null}:{result:Hr.SUPPORTED,geometry:e.geometry}}function jIt(e){var i;if(((i=e.layer)==null?void 0:i.type)!=="graphics")return Hr.GRAPHICS_LAYER_MISSING;if(M(e.geometry))return Hr.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return Hr.SUPPORTED;default:return Hr.GEOMETRY_TYPE_UNSUPPORTED}const t=_(e.symbol)&&e.symbol.type==="point-3d"&&e.symbol.symbolLayers;return t&&t.length>0&&t.some(r=>r.type==="object")?U8(e)!=="on-the-ground"&&z8(e)?Hr.ELEVATION_MODE_UNSUPPORTED:Hr.SUPPORTED:Hr.SYMBOL_TYPE_UNSUPPORTED}function bye(e,t,i){if(!t||!e||!e.map)return;const{map:r}=e,s=r.layers.find(n=>n===t);s||r.add(t,i),i!=null&&r.layers.reorder(s,i)}function eUt(e,t){return e.allLayerViews.find(i=>{const r=i.layer;return r===t||"sublayers"in r&&_(r.sublayers)&&r.sublayers.includes(t)})}const Qr={redo:"r",undo:"z",center:"Alt",constraint:"Shift",snappingToggle:"Control",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "};let Vk=class extends Ee{constructor(e){super(e),this.enabled=!1}};u([d({type:Boolean,nonNullable:!0})],Vk.prototype,"enabled",void 0),Vk=u([L("esri.views.interactive.sketch.SketchLabelOptions")],Vk);const T$e=Vk;let b3=class extends Ee{constructor(e){super(e),this.mode="absolute-height"}};u([d({type:String,nonNullable:!0})],b3.prototype,"mode",void 0),b3=u([L("esri.widgets.Sketch.SketchTooltipOptions.ElevationOptions")],b3);let xh=class extends Ee{constructor(){super(...arguments),this.distance=!0,this.elevation=!0,this.size=!0,this.scale=!0,this.rotation=!0,this.orientation=!0,this.totalLength=!0,this.area=!0,this.radius=!0}};u([d({type:Boolean,nonNullable:!0})],xh.prototype,"distance",void 0),u([d({type:Boolean,nonNullable:!0})],xh.prototype,"elevation",void 0),u([d({type:Boolean,nonNullable:!0})],xh.prototype,"size",void 0),u([d({type:Boolean,nonNullable:!0})],xh.prototype,"scale",void 0),u([d({type:Boolean,nonNullable:!0})],xh.prototype,"rotation",void 0),u([d({type:Boolean,nonNullable:!0})],xh.prototype,"orientation",void 0),u([d({type:Boolean,nonNullable:!0})],xh.prototype,"totalLength",void 0),u([d({type:Boolean,nonNullable:!0})],xh.prototype,"area",void 0),u([d({type:Boolean,nonNullable:!0})],xh.prototype,"radius",void 0),xh=u([L("esri.widgets.Sketch.SketchTooltipOptions.VisibleElements")],xh);let Gx=class extends Ee{constructor(e){super(e),this.enabled=!1,this.elevation=new b3,this.visibleElements=new xh,this.visualVariables=null}};u([d({type:Boolean,nonNullable:!0})],Gx.prototype,"enabled",void 0),u([d({type:b3,nonNullable:!0})],Gx.prototype,"elevation",void 0),u([d({type:xh,nonNullable:!0})],Gx.prototype,"visibleElements",void 0),u([d()],Gx.prototype,"visualVariables",void 0),Gx=u([L("esri.widgets.Sketch.SketchTooltipOptions")],Gx);const S$e=Gx;function HIt(e,t){const i=E$e[e.toLowerCase()];if(i==null)throw new Error("Function Not Recognised");if(t.length<i.minParams||t.length>i.maxParams)throw new Error(`Invalid Parameter count for call to ${e.toUpperCase()}`);return i.evaluate(t)}function qIt(e,t){const i=E$e[e.toLowerCase()];return i!=null&&t>=i.minParams&&t<=i.maxParams}const E$e={min:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.min.apply(Math,e[0])},max:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.max.apply(Math,e[0])},avg:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:C$e(e[0])},sum:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:WIt(e[0])},stddev:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.sqrt(wye(e[0]))},count:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:e[0].length},var:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:wye(e[0])}};function C$e(e){let t=0;for(let i=0;i<e.length;i++)t+=e[i];return t/e.length}function WIt(e){let t=0;for(let i=0;i<e.length;i++)t+=e[i];return t}function wye(e){const t=C$e(e),i=e.length;let r=0;for(const s of e)r+=(s-t)**2;return i>1?r/(i-1):0}class Pc{constructor(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0}static _fixDefaults(t){if(t.precision!==null||t.secondary!==null)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")}static createFromMilliseconds(t){const i=new Pc;return i.second=t/1e3,i}static createFromValueAndQualifer(t,i,r){let s=null;const n=new Pc;if(n.op=r==="-"?"-":"+",i.type==="interval-period"){Pc._fixDefaults(i);const o=new RegExp("^[0-9]{1,}$");if(i.period==="year"||i.period==="month")throw new Error("Year-Month Intervals not supported");if(!o.test(t))throw new Error("Illegal Interval");n[i.period]=parseFloat(t)}else{if(Pc._fixDefaults(i.start),Pc._fixDefaults(i.end),i.start.period==="year"||i.start.period==="month")throw new Error("Year-Month Intervals not supported");if(i.end.period==="year"||i.end.period==="month")throw new Error("Year-Month Intervals not supported");switch(i.start.period){case"day":switch(i.end.period){case"hour":if(s=new RegExp("^[0-9]{1,} [0-9]{1,}$"),!s.test(t))throw new Error("Illegal Interval");n[i.start.period]=parseFloat(t.split(" ")[0]),n[i.end.period]=parseFloat(t.split(" ")[1]);break;case"minute":if(s=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),!s.test(t))throw new Error("Illegal Interval");{n[i.start.period]=parseFloat(t.split(" ")[0]);const o=t.split(" ")[1].split(":");n.hour=parseFloat(o[0]),n.minute=parseFloat(o[1])}break;case"second":if(s=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!s.test(t))throw new Error("Illegal Interval");{n[i.start.period]=parseFloat(t.split(" ")[0]);const o=t.split(" ")[1].split(":");n.hour=parseFloat(o[0]),n.minute=parseFloat(o[1]),n.second=parseFloat(o[2])}break;default:throw new Error("Invalid Interval.")}break;case"hour":switch(i.end.period){case"minute":if(s=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),!s.test(t))throw new Error("Illegal Interval");n.hour=parseFloat(t.split(":")[0]),n.minute=parseFloat(t.split(":")[1]);break;case"second":if(s=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!s.test(t))throw new Error("Illegal Interval");{const o=t.split(":");n.hour=parseFloat(o[0]),n.minute=parseFloat(o[1]),n.second=parseFloat(o[2])}break;default:throw new Error("Invalid Interval.")}break;case"minute":if(i.end.period!=="second")throw new Error("Invalid Interval.");if(s=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!s.test(t))throw new Error("Illegal Interval");{const o=t.split(":");n.minute=parseFloat(o[0]),n.second=parseFloat(o[1])}break;default:throw new Error("Invalid Interval.")}}return n}valueInMilliseconds(){return(this.op==="-"?-1:1)*(1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}}function A$e(e,t){const i=M$e[e.toLowerCase()];if(i==null)throw new Error("Function Not Recognised");if(t.length<i.minParams||t.length>i.maxParams)throw new Error(`Invalid Parameter count for call to ${e.toUpperCase()}`);return i.evaluate(t)}function ZIt(e,t){const i=M$e[e.toLowerCase()];return i!=null&&t>=i.minParams&&t<=i.maxParams}const M$e={extract:{minParams:2,maxParams:2,evaluate:([e,t])=>{if(t==null)return null;if(t instanceof Date)switch(e.toUpperCase()){case"SECOND":return t.getSeconds();case"MINUTE":return t.getMinutes();case"HOUR":return t.getHours();case"DAY":return t.getDate();case"MONTH":return t.getMonth()+1;case"YEAR":return t.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:e=>{if(e.length===2){const[t,i]=e;return t==null||i==null?null:t.toString().substring(i-1)}if(e.length===3){const[t,i,r]=e;return t==null||i==null||r==null?null:r<=0?"":t.toString().substring(i-1,i+r-1)}}},position:{minParams:2,maxParams:2,evaluate:([e,t])=>e==null||t==null?null:t.indexOf(e)+1},trim:{minParams:2,maxParams:3,evaluate:e=>{const t=e.length===3,i=t?e[1]:" ",r=t?e[2]:e[1];if(i==null||r==null)return null;const s=`(${PQ(i)})`;switch(e[0]){case"BOTH":return r.replace(new RegExp(`^${s}*|${s}*$`,"g"),"");case"LEADING":return r.replace(new RegExp(`^${s}*`,"g"),"");case"TRAILING":return r.replace(new RegExp(`${s}*$`,"g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.abs(e[0])},ceiling:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.ceil(e[0])},floor:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.floor(e[0])},log:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.log(e[0])},log10:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.log(e[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.sin(e[0])},cos:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.cos(e[0])},tan:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.tan(e[0])},asin:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.asin(e[0])},acos:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.acos(e[0])},atan:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:Math.atan(e[0])},sign:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:e[0]>0?1:e[1]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:e=>e[0]==null||e[1]==null?null:e[0]**e[1]},mod:{minParams:2,maxParams:2,evaluate:e=>e[0]==null||e[1]==null?null:e[0]%e[1]},round:{minParams:1,maxParams:2,evaluate:e=>{const t=e[0],i=e.length===2?10**e[1]:1;return t==null?null:Math.round(t*i)/i}},truncate:{minParams:1,maxParams:2,evaluate:e=>e[0]==null?null:e.length===1?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))},char_length:{minParams:1,maxParams:1,evaluate:e=>typeof e[0]=="string"||e[0]instanceof String?e[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:e=>{let t="";for(let i=0;i<e.length;i++){if(e[i]==null)return null;t+=e[i].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:e[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:e=>e[0]==null?null:e[0].toString().toUpperCase()}};var xye,Tye,O$e={exports:{}};Tye=function(){function e(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function t(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,t.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function i(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function r(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:rne},h=rne,p="!",f="=",m=">=",g=">",y="<=",x="<>",b="<",S="!=",T="+",C="-",A="*",O="/",D="@",U="'",k="N'",B="''",j=".",H="null",K="true",ee="false",ce="in",le="is",z="like",q="escape",Z="not",Y="and",te="or",se="between",J="from",ae="for",_e="substring",Oe="extract",Be="trim",Se="position",Te="timestamp",Ie="date",Ve="leading",Ni="trailing",Fi="both",hi="to",Vi="interval",di="year",ki="month",kr="day",us="hour",ot="minute",cr="second",en="case",mo="end",Fn="when",gl="then",yl="else",Qn=",",hd="(",RO=")",h2="`",d2=/^[A-Za-z_\x80-\uFFFF]/,p2=/^[A-Za-z0-9_]/,f2=/^[A-Za-z0-9_.\x80-\uFFFF]/,sw=/^[^']/,PO=/^[0-9]/,IO=/^[eE]/,$O=/^[+\-]/,LO=/^[ \t\n\r]/,qv=/^[^`]/,m2=zt("!",!1),nw=zt("=",!1),g2=zt(">=",!1),Bi=zt(">",!1),qo=zt("<=",!1),go=zt("<>",!1),vl=zt("<",!1),wy=zt("!=",!1),Wv=zt("+",!1),Zv=zt("-",!1),y2=zt("*",!1),v2=zt("/",!1),dd=Sy([["A","Z"],["a","z"],"_",["\x80","\uFFFF"]],!1,!1),ge=Sy([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Ur=Sy([["A","Z"],["a","z"],["0","9"],"_",".",["\x80","\uFFFF"]],!1,!1),Xv=zt("@",!1),Jl=zt("'",!1),xy=zt("N'",!1),xt=zt("''",!1),mm=Sy(["'"],!0,!1),kn=zt(".",!1),Ty=Sy([["0","9"]],!1,!1),_2=Sy(["e","E"],!1,!1),Yu=Sy(["+","-"],!1,!1),ow=zt("NULL",!0),b2=zt("TRUE",!0),pi=zt("FALSE",!0),K8=zt("IN",!0),lD=zt("IS",!0),eG=zt("LIKE",!0),tG=zt("ESCAPE",!0),DO=zt("NOT",!0),iG=zt("AND",!0),NO=zt("OR",!0),yo=zt("BETWEEN",!0),rG=zt("FROM",!0),cD=zt("FOR",!0),sG=zt("SUBSTRING",!0),nG=zt("EXTRACT",!0),oG=zt("TRIM",!0),aG=zt("POSITION",!0),lG=zt("TIMESTAMP",!0),Wc=zt("DATE",!0),cG=zt("LEADING",!0),uG=zt("TRAILING",!0),ie=zt("BOTH",!0),Me=zt("TO",!0),Fe=zt("INTERVAL",!0),Ai=zt("YEAR",!0),Wo=zt("MONTH",!0),Gs=zt("DAY",!0),Zc=zt("HOUR",!0),w2=zt("MINUTE",!0),eDe=zt("SECOND",!0),tDe=zt("CASE",!0),iDe=zt("END",!0),rDe=zt("WHEN",!0),sDe=zt("THEN",!0),nDe=zt("ELSE",!0),oDe=zt(",",!1),aDe=zt("(",!1),lDe=zt(")",!1),cDe=Sy([" ","	",`
`,"\r"],!1,!1),Hse=zt("`",!1),qse=Sy(["`"],!0,!1),uDe=function(w){return w},hDe=function(w,I){var V={type:"expression-list"},X=qFe(w,I);return V.value=X,V},hG=function(w,I){return xG(w,I)},dDe=function(w){return jFe("NOT",w)},pDe=function(w,I){return I==""||I==null||I==null?w:I.type=="arithmetic"?xG(w,I.tail):Pne(I.op,w,I.right,I.escape)},fDe=function(w){return{type:"arithmetic",tail:w}},mDe=function(w,I){return{op:w+"NOT",right:I}},gDe=function(w,I){return{op:w,right:I}},yDe=function(w,I,V){return{op:"NOT"+w,right:{type:"expression-list",value:[I,V]}}},vDe=function(w,I,V){return{op:w,right:{type:"expression-list",value:[I,V]}}},Wse=function(w){return w[0]+" "+w[2]},_De=function(w,I,V){return{op:w,right:I,escape:V.value}},bDe=function(w,I){return{op:w,right:I,escape:""}},wDe=function(w,I){return{op:w,right:I}},xDe=function(w){return{op:w,right:{type:"expression-list",value:[]}}},TDe=function(w,I){return{op:w,right:I}},SDe=function(w,I){return xG(w,I)},EDe=function(w){return w.paren=!0,w},CDe=function(w){return/^CURRENT_DATE$/i.test(w)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(w)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:w}},Zse=function(w){return w},Xse=function(w,I){return w+I.join("")},ADe=function(w){return{type:"parameter",value:w[1]}},MDe=function(w,I){return{type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",value:w},I]}}},ODe=function(w,I,V){return{type:"function",name:"substring",args:{type:"expression-list",value:V?[w,I,V[2]]:[w,I]}}},RDe=function(w,I,V){return{type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:w==null?"BOTH":w},I,V]}}},PDe=function(w,I){return{type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:w==null?"BOTH":w},I]}}},IDe=function(w,I){return{type:"function",name:"position",args:{type:"expression-list",value:[w,I]}}},$De=function(w,I){return{type:"function",name:w,args:I||{type:"expression-list",value:[]}}},LDe=function(w){return{type:"timestamp",value:w.value}},DDe=function(w,I,V){return{type:"interval",value:I,qualifier:V,op:w}},NDe=function(w,I){return{type:"interval",value:w,qualifier:I,op:""}},FDe=function(w,I){return{type:"interval-qualifier",start:w,end:I}},kDe=function(w,I){return{type:"interval-period",period:w.value,precision:I,secondary:null}},Yse=function(w){return{type:"interval-period",period:w.value,precision:null,secondary:null}},UDe=function(w){return{type:"interval-period",period:w.value,precision:null,secondary:null}},Jse=function(w,I){return{type:"interval-period",period:"second",precision:w,secondary:I}},zDe=function(w){return{type:"interval-period",period:"second",precision:w,secondary:null}},VDe=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},BDe=function(w,I){return{type:"interval-period",period:w.value,precision:I,secondary:null}},GDe=function(w){return{type:"interval-period",period:"second",precision:w,secondary:null}},jDe=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},HDe=function(){return{type:"string",value:"day"}},qDe=function(){return{type:"string",value:"hour"}},WDe=function(){return{type:"string",value:"minute"}},ZDe=function(){return{type:"string",value:"month"}},XDe=function(){return{type:"string",value:"year"}},Qse=function(w){return parseFloat(w)},YDe=function(w){return{type:"date",value:w.value}},JDe=function(){return{type:"null",value:null}},QDe=function(){return{type:"boolean",value:!0}},KDe=function(){return{type:"boolean",value:!1}},Kse=function(){return"'"},eNe=function(w){return{type:"string",value:w.join("")}},tNe=function(w,I){return{type:"case-expression",format:"simple",operand:w,clauses:I,else:null}},iNe=function(w,I,V){return{type:"case-expression",format:"simple",operand:w,clauses:I,else:V.value}},rNe=function(w){return{type:"case-expression",format:"searched",clauses:w,else:null}},sNe=function(w,I){return{type:"case-expression",format:"searched",clauses:w,else:I.value}},ene=function(w,I){return{type:"when-clause",operand:w,value:I}},nNe=function(w){return{type:"else-clause",value:w}},oNe=function(w){return{type:"number",value:w}},aNe=function(w,I,V){return parseFloat(w+I+V)},lNe=function(w,I){return parseFloat(w+I)},cNe=function(w,I){return parseFloat(w+I)},uNe=function(w){return parseFloat(w)},hNe=function(w,I){return w[0]+I},dNe=function(w){return"."+(w!=null?w:"")},pNe=function(w,I){return w+I},fNe=function(w){return w.join("")},mNe=function(w,I){return"e"+(I===null?"":I)},gNe=function(){return"IN"},yNe=function(){return"IS"},vNe=function(){return"LIKE"},_Ne=function(){return"ESCAPE"},bNe=function(){return"NOT"},wNe=function(){return"AND"},xNe=function(){return"OR"},TNe=function(){return"BETWEEN"},SNe=function(){return"FROM"},ENe=function(){return"FOR"},CNe=function(){return"SUBSTRING"},ANe=function(){return"EXTRACT"},MNe=function(){return"TRIM"},ONe=function(){return"POSITION"},RNe=function(){return"TIMESTAMP"},PNe=function(){return"DATE"},INe=function(){return"LEADING"},$Ne=function(){return"TRAILING"},LNe=function(){return"BOTH"},DNe=function(){return"TO"},NNe=function(){return"INTERVAL"},FNe=function(){return"YEAR"},kNe=function(){return"MONTH"},UNe=function(){return"DAY"},zNe=function(){return"HOUR"},VNe=function(){return"MINUTE"},BNe=function(){return"SECOND"},GNe=function(){return"CASE"},jNe=function(){return"END"},HNe=function(){return"WHEN"},qNe=function(){return"THEN"},WNe=function(){return"ELSE"},ZNe=function(w){return w.join("")},R=0,uD=[{line:1,column:1}],gm=0,dG=[],be=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function zt(w,I){return{type:"literal",text:w,ignoreCase:I}}function Sy(w,I,V){return{type:"class",parts:w,inverted:I,ignoreCase:V}}function XNe(){return{type:"end"}}function tne(w){var I,V=uD[w];if(V)return V;for(I=w-1;!uD[I];)I--;for(V={line:(V=uD[I]).line,column:V.column};I<w;)s.charCodeAt(I)===10?(V.line++,V.column=1):V.column++,I++;return uD[w]=V,V}function ine(w,I){var V=tne(w),X=tne(I);return{source:l,start:{offset:w,line:V.line,column:V.column},end:{offset:I,line:X.line,column:X.column}}}function ct(w){R<gm||(R>gm&&(gm=R,dG=[]),dG.push(w))}function YNe(w,I,V){return new t(t.buildMessage(w,I),w,I,V)}function rne(){var w,I;return w=R,Ae(),(I=Kn())!==a?(Ae(),w=uDe(I)):(R=w,w=a),w}function sne(){var w,I,V,X,ut,ur,Ms,tn;if(w=R,(I=Kn())!==a){for(V=[],X=R,ut=Ae(),(ur=bD())!==a?(Ms=Ae(),(tn=Kn())!==a?X=ut=[ut,ur,Ms,tn]:(R=X,X=a)):(R=X,X=a);X!==a;)V.push(X),X=R,ut=Ae(),(ur=bD())!==a?(Ms=Ae(),(tn=Kn())!==a?X=ut=[ut,ur,Ms,tn]:(R=X,X=a)):(R=X,X=a);w=hDe(I,V)}else R=w,w=a;return w}function Kn(){var w,I,V,X,ut,ur,Ms,tn;if(w=R,(I=pG())!==a){for(V=[],X=R,ut=Ae(),(ur=_ne())!==a?(Ms=Ae(),(tn=pG())!==a?X=ut=[ut,ur,Ms,tn]:(R=X,X=a)):(R=X,X=a);X!==a;)V.push(X),X=R,ut=Ae(),(ur=_ne())!==a?(Ms=Ae(),(tn=pG())!==a?X=ut=[ut,ur,Ms,tn]:(R=X,X=a)):(R=X,X=a);w=hG(I,V)}else R=w,w=a;return w}function pG(){var w,I,V,X,ut,ur,Ms,tn;if(w=R,(I=hD())!==a){for(V=[],X=R,ut=Ae(),(ur=yD())!==a?(Ms=Ae(),(tn=hD())!==a?X=ut=[ut,ur,Ms,tn]:(R=X,X=a)):(R=X,X=a);X!==a;)V.push(X),X=R,ut=Ae(),(ur=yD())!==a?(Ms=Ae(),(tn=hD())!==a?X=ut=[ut,ur,Ms,tn]:(R=X,X=a)):(R=X,X=a);w=hG(I,V)}else R=w,w=a;return w}function hD(){var w,I,V,X,ut;return w=R,(I=kO())===a&&(I=R,s.charCodeAt(R)===33?(V=p,R++):(V=a,be===0&&ct(m2)),V!==a?(X=R,be++,s.charCodeAt(R)===61?(ut=f,R++):(ut=a,be===0&&ct(nw)),be--,ut===a?X=void 0:(R=X,X=a),X!==a?I=V=[V,X]:(R=I,I=a)):(R=I,I=a)),I!==a?(V=Ae(),(X=hD())!==a?w=dDe(X):(R=w,w=a)):(R=w,w=a),w===a&&(w=JNe()),w}function JNe(){var w,I,V;return w=R,(I=Ey())!==a?(Ae(),(V=QNe())===a&&(V=null),w=pDe(I,V)):(R=w,w=a),w}function QNe(){var w;return(w=KNe())===a&&(w=rFe())===a&&(w=tFe())===a&&(w=eFe())===a&&(w=iFe()),w}function KNe(){var w,I,V,X,ut,ur;if(w=[],I=R,V=Ae(),(X=nne())!==a?(ut=Ae(),(ur=Ey())!==a?I=V=[V,X,ut,ur]:(R=I,I=a)):(R=I,I=a),I!==a)for(;I!==a;)w.push(I),I=R,V=Ae(),(X=nne())!==a?(ut=Ae(),(ur=Ey())!==a?I=V=[V,X,ut,ur]:(R=I,I=a)):(R=I,I=a);else w=a;return w!==a&&(w=fDe(w)),w}function nne(){var w;return s.substr(R,2)===m?(w=m,R+=2):(w=a,be===0&&ct(g2)),w===a&&(s.charCodeAt(R)===62?(w=g,R++):(w=a,be===0&&ct(Bi)),w===a&&(s.substr(R,2)===y?(w=y,R+=2):(w=a,be===0&&ct(qo)),w===a&&(s.substr(R,2)===x?(w=x,R+=2):(w=a,be===0&&ct(go)),w===a&&(s.charCodeAt(R)===60?(w=b,R++):(w=a,be===0&&ct(vl)),w===a&&(s.charCodeAt(R)===61?(w=f,R++):(w=a,be===0&&ct(nw)),w===a&&(s.substr(R,2)===S?(w=S,R+=2):(w=a,be===0&&ct(wy)))))))),w}function eFe(){var w,I,V,X;return w=R,(I=yne())!==a?(Ae(),(V=kO())!==a?(Ae(),(X=Ey())!==a?w=mDe(I,X):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w===a&&(w=R,(I=yne())!==a?(Ae(),(V=Ey())!==a?w=gDe(I,V):(R=w,w=a)):(R=w,w=a)),w}function tFe(){var w,I,V,X,ut,ur;return w=R,(I=kO())!==a?(Ae(),(V=bne())!==a?(Ae(),(X=Ey())!==a?(Ae(),(ut=yD())!==a?(Ae(),(ur=Ey())!==a?w=yDe(V,X,ur):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w===a&&(w=R,(I=bne())!==a?(Ae(),(V=Ey())!==a?(Ae(),(X=yD())!==a?(Ae(),(ut=Ey())!==a?w=vDe(I,V,ut):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)),w}function one(){var w,I,V,X,ut;return w=R,I=R,(V=kO())!==a?(X=Ae(),(ut=vne())!==a?I=V=[V,X,ut]:(R=I,I=a)):(R=I,I=a),I!==a&&(I=Wse(I)),(w=I)===a&&(w=vne()),w}function fG(){var w,I,V,X,ut;return w=R,I=R,(V=kO())!==a?(X=Ae(),(ut=bG())!==a?I=V=[V,X,ut]:(R=I,I=a)):(R=I,I=a),I!==a&&(I=Wse(I)),(w=I)===a&&(w=bG()),w}function iFe(){var w,I,V,X;return w=R,(I=one())!==a?(Ae(),(V=x2())!==a?(Ae(),PFe()!==a?(Ae(),(X=_G())!==a?w=_De(I,V,X):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w===a&&(w=R,(I=one())!==a?(Ae(),(V=x2())!==a?w=bDe(I,V):(R=w,w=a)):(R=w,w=a)),w}function rFe(){var w,I,V,X;return w=R,(I=fG())!==a?(Ae(),(V=Ql())!==a?(Ae(),(X=sne())!==a?(Ae(),Kl()!==a?w=wDe(I,X):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w===a&&(w=R,(I=fG())!==a?(Ae(),(V=Ql())!==a?(Ae(),(X=Kl())!==a?w=xDe(I):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w===a&&(w=R,(I=fG())!==a?(Ae(),(V=vG())!==a?w=TDe(I,V):(R=w,w=a)):(R=w,w=a))),w}function Ey(){var w,I,V,X,ut,ur,Ms,tn;if(w=R,(I=mG())!==a){for(V=[],X=R,ut=Ae(),(ur=ane())!==a?(Ms=Ae(),(tn=mG())!==a?X=ut=[ut,ur,Ms,tn]:(R=X,X=a)):(R=X,X=a);X!==a;)V.push(X),X=R,ut=Ae(),(ur=ane())!==a?(Ms=Ae(),(tn=mG())!==a?X=ut=[ut,ur,Ms,tn]:(R=X,X=a)):(R=X,X=a);w=hG(I,V)}else R=w,w=a;return w}function ane(){var w;return s.charCodeAt(R)===43?(w=T,R++):(w=a,be===0&&ct(Wv)),w===a&&(s.charCodeAt(R)===45?(w=C,R++):(w=a,be===0&&ct(Zv))),w}function mG(){var w,I,V,X,ut,ur,Ms,tn;if(w=R,(I=gG())!==a){for(V=[],X=R,ut=Ae(),(ur=lne())!==a?(Ms=Ae(),(tn=gG())!==a?X=ut=[ut,ur,Ms,tn]:(R=X,X=a)):(R=X,X=a);X!==a;)V.push(X),X=R,ut=Ae(),(ur=lne())!==a?(Ms=Ae(),(tn=gG())!==a?X=ut=[ut,ur,Ms,tn]:(R=X,X=a)):(R=X,X=a);w=SDe(I,V)}else R=w,w=a;return w}function lne(){var w;return s.charCodeAt(R)===42?(w=A,R++):(w=a,be===0&&ct(y2)),w===a&&(s.charCodeAt(R)===47?(w=O,R++):(w=a,be===0&&ct(v2))),w}function gG(){var w,I;return(w=pFe())===a&&(w=aFe())===a&&(w=lFe())===a&&(w=cFe())===a&&(w=uFe())===a&&(w=hFe())===a&&(w=xFe())===a&&(w=sFe())===a&&(w=vG())===a&&(w=R,Ql()!==a?(Ae(),(I=Kn())!==a?(Ae(),Kl()!==a?w=EDe(I):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)),w}function sFe(){var w;return(w=nFe())!==a&&(w=CDe(w)),w}function nFe(){var w;return(w=oFe())!==a&&(w=Zse(w)),w}function oFe(){var w,I,V,X;if(w=R,(I=yG())!==a){for(V=[],X=une();X!==a;)V.push(X),X=une();w=Xse(I,V)}else R=w,w=a;return w}function cne(){var w,I,V,X;if(w=R,(I=yG())!==a){for(V=[],X=rr();X!==a;)V.push(X),X=rr();w=Xse(I,V)}else R=w,w=a;return w}function yG(){var w;return d2.test(s.charAt(R))?(w=s.charAt(R),R++):(w=a,be===0&&ct(dd)),w}function rr(){var w;return p2.test(s.charAt(R))?(w=s.charAt(R),R++):(w=a,be===0&&ct(ge)),w}function une(){var w;return f2.test(s.charAt(R))?(w=s.charAt(R),R++):(w=a,be===0&&ct(Ur)),w}function vG(){var w,I,V;return w=R,s.charCodeAt(R)===64?(I=D,R++):(I=a,be===0&&ct(Xv)),I!==a&&(V=cne())!==a?w=I=[I,V]:(R=w,w=a),w!==a&&(w=ADe(w)),w}function aFe(){var w,I,V;return w=R,LFe()!==a?(Ae(),Ql()!==a?(Ae(),(I=dFe())!==a?(Ae(),wG()!==a?(Ae(),(V=Kn())!==a?(Ae(),Kl()!==a?w=MDe(I,V):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w}function lFe(){var w,I,V,X,ut,ur,Ms;return w=R,$Fe()!==a?(Ae(),Ql()!==a?(Ae(),(I=Kn())!==a?(Ae(),wG()!==a?(Ae(),(V=Kn())!==a?(Ae(),X=R,(ut=IFe())!==a?(ur=Ae(),(Ms=Kn())!==a?X=ut=[ut,ur,Ms,Ae()]:(R=X,X=a)):(R=X,X=a),X===a&&(X=null),(ut=Kl())!==a?w=ODe(I,V,X):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w}function cFe(){var w,I,V,X;return w=R,wne()!==a?(Ae(),Ql()!==a?(Ae(),(I=hne())===a&&(I=null),Ae(),(V=Kn())!==a?(Ae(),wG()!==a?(Ae(),(X=Kn())!==a?(Ae(),Kl()!==a?w=RDe(I,V,X):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w===a&&(w=R,wne()!==a?(Ae(),Ql()!==a?(Ae(),(I=hne())===a&&(I=null),Ae(),(V=Kn())!==a?(Ae(),Kl()!==a?w=PDe(I,V):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)),w}function hne(){var w;return(w=kFe())===a&&(w=UFe())===a&&(w=zFe()),w}function uFe(){var w,I,V;return w=R,DFe()!==a?(Ae(),Ql()!==a?(Ae(),(I=Kn())!==a?(Ae(),bG()!==a?(Ae(),(V=Kn())!==a?(Ae(),Kl()!==a?w=IDe(I,V):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w}function hFe(){var w,I,V;return w=R,(I=GFe())!==a?(Ae(),Ql()!==a?(Ae(),(V=sne())===a&&(V=null),Ae(),Kl()!==a?w=$De(I,V):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w}function dFe(){var w;return(w=Tne())===a&&(w=Sne())===a&&(w=Ene())===a&&(w=Cne())===a&&(w=Ane())===a&&(w=aw()),w}function pFe(){var w;return(w=_G())===a&&(w=EFe())===a&&(w=wFe())===a&&(w=bFe())===a&&(w=_Fe())===a&&(w=fFe())===a&&(w=mFe()),w}function fFe(){var w,I;return w=R,NFe()!==a?(Ae(),(I=x2())!==a?w=LDe(I):(R=w,w=a)):(R=w,w=a),w}function mFe(){var w,I,V,X;return w=R,xne()!==a?(Ae(),s.charCodeAt(R)===45?(I=C,R++):(I=a,be===0&&ct(Zv)),I===a&&(s.charCodeAt(R)===43?(I=T,R++):(I=a,be===0&&ct(Wv))),I!==a?(Ae(),(V=x2())!==a?(Ae(),(X=dne())!==a?w=DDe(I,V,X):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w===a&&(w=R,xne()!==a?(Ae(),(I=x2())!==a?(Ae(),(V=dne())!==a?w=NDe(I,V):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)),w}function dne(){var w,I,V;return w=R,(I=gFe())!==a?(Ae(),VFe()!==a?(Ae(),(V=yFe())!==a?w=FDe(I,V):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w===a&&(w=vFe()),w}function gFe(){var w,I,V;return w=R,(I=FO())!==a?(Ae(),Ql()!==a?(Ae(),(V=pD())!==a?(Ae(),Kl()!==a?w=kDe(I,V):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w===a&&(w=R,(I=FO())!==a&&(I=Yse(I)),w=I),w}function yFe(){var w,I,V,X;return w=R,(I=FO())!==a&&(I=UDe(I)),(w=I)===a&&(w=R,(I=aw())!==a?(Ae(),Ql()!==a?(Ae(),(V=pD())!==a?(Ae(),bD()!==a?(Ae(),(X=dD())!==a?(Ae(),Kl()!==a?w=Jse(V,X):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w===a&&(w=R,(I=aw())!==a?(Ae(),Ql()!==a?(Ae(),(V=pD())!==a?(Ae(),Kl()!==a?w=zDe(V):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w===a&&(w=R,(I=aw())!==a&&(I=VDe()),w=I))),w}function vFe(){var w,I,V,X;return w=R,(I=FO())!==a?(Ae(),Ql()!==a?(Ae(),(V=dD())!==a?(Ae(),Kl()!==a?w=BDe(I,V):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w===a&&(w=R,(I=FO())!==a&&(I=Yse(I)),(w=I)===a&&(w=R,(I=aw())!==a?(Ae(),Ql()!==a?(Ae(),(V=pD())!==a?(Ae(),bD()!==a?(Ae(),(X=dD())!==a?(Ae(),Kl()!==a?w=Jse(V,X):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w===a&&(w=R,(I=aw())!==a?(Ae(),Ql()!==a?(Ae(),(V=dD())!==a?(Ae(),Kl()!==a?w=GDe(V):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w===a&&(w=R,(I=aw())!==a&&(I=jDe()),w=I)))),w}function FO(){var w,I;return w=R,(I=Ene())!==a&&(I=HDe()),(w=I)===a&&(w=R,(I=Cne())!==a&&(I=qDe()),(w=I)===a&&(w=R,(I=Ane())!==a&&(I=WDe()),(w=I)===a&&(w=R,(I=Sne())!==a&&(I=ZDe()),(w=I)===a&&(w=R,(I=Tne())!==a&&(I=XDe()),w=I)))),w}function dD(){var w;return(w=T2())!==a&&(w=Qse(w)),w}function pD(){var w;return(w=T2())!==a&&(w=Qse(w)),w}function _Fe(){var w,I;return w=R,FFe()!==a?(Ae(),(I=x2())!==a?w=YDe(I):(R=w,w=a)):(R=w,w=a),w}function bFe(){var w;return(w=MFe())!==a&&(w=JDe()),w}function wFe(){var w,I;return w=R,(I=OFe())!==a&&(I=QDe()),(w=I)===a&&(w=R,(I=RFe())!==a&&(I=KDe()),w=I),w}function x2(){var w;return(w=_G())===a&&(w=vG()),w}function _G(){var w,I,V,X,ut;if(w=R,s.charCodeAt(R)===39?(I=U,R++):(I=a,be===0&&ct(Jl)),I===a&&(s.substr(R,2)===k?(I=k,R+=2):(I=a,be===0&&ct(xy))),I!==a){for(V=[],X=R,s.substr(R,2)===B?(ut=B,R+=2):(ut=a,be===0&&ct(xt)),ut!==a&&(ut=Kse()),(X=ut)===a&&(sw.test(s.charAt(R))?(X=s.charAt(R),R++):(X=a,be===0&&ct(mm)));X!==a;)V.push(X),X=R,s.substr(R,2)===B?(ut=B,R+=2):(ut=a,be===0&&ct(xt)),ut!==a&&(ut=Kse()),(X=ut)===a&&(sw.test(s.charAt(R))?(X=s.charAt(R),R++):(X=a,be===0&&ct(mm)));s.charCodeAt(R)===39?(X=U,R++):(X=a,be===0&&ct(Jl)),X!==a?w=eNe(V):(R=w,w=a)}else R=w,w=a;return w}function xFe(){var w;return(w=TFe())===a&&(w=SFe()),w}function TFe(){var w,I,V,X,ut;if(w=R,vD()!==a)if(Ae(),(I=Kn())!==a){for(Ae(),V=[],X=mD();X!==a;)V.push(X),X=mD();X=Ae(),(ut=_D())!==a?w=tNe(I,V):(R=w,w=a)}else R=w,w=a;else R=w,w=a;if(w===a)if(w=R,vD()!==a)if(Ae(),(I=Kn())!==a){for(Ae(),V=[],X=mD();X!==a;)V.push(X),X=mD();X=Ae(),(ut=pne())!==a?(Ae(),_D()!==a?w=iNe(I,V,ut):(R=w,w=a)):(R=w,w=a)}else R=w,w=a;else R=w,w=a;return w}function SFe(){var w,I,V,X;if(w=R,vD()!==a){for(Ae(),I=[],V=fD();V!==a;)I.push(V),V=fD();V=Ae(),(X=_D())!==a?w=rNe(I):(R=w,w=a)}else R=w,w=a;if(w===a)if(w=R,vD()!==a){for(Ae(),I=[],V=fD();V!==a;)I.push(V),V=fD();V=Ae(),(X=pne())!==a?(Ae(),_D()!==a?w=sNe(I,X):(R=w,w=a)):(R=w,w=a)}else R=w,w=a;return w}function fD(){var w,I,V;return w=R,Mne()!==a?(Ae(),(I=Kn())!==a?(Ae(),One()!==a?(Ae(),(V=Kn())!==a?w=ene(I,V):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w}function mD(){var w,I,V;return w=R,Mne()!==a?(Ae(),(I=Kn())!==a?(Ae(),One()!==a?(Ae(),(V=Kn())!==a?w=ene(I,V):(R=w,w=a)):(R=w,w=a)):(R=w,w=a)):(R=w,w=a),w}function pne(){var w,I;return w=R,BFe()!==a?(Ae(),(I=Kn())!==a?w=nNe(I):(R=w,w=a)):(R=w,w=a),w}function EFe(){var w,I,V,X;return w=R,(I=CFe())!==a?(V=R,be++,X=yG(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=oNe(I):(R=w,w=a)):(R=w,w=a),w}function CFe(){var w,I,V,X;return w=R,(I=gD())!==a&&(V=fne())!==a&&(X=mne())!==a?w=aNe(I,V,X):(R=w,w=a),w===a&&(w=R,(I=gD())!==a&&(V=fne())!==a?w=lNe(I,V):(R=w,w=a),w===a&&(w=R,(I=gD())!==a&&(V=mne())!==a?w=cNe(I,V):(R=w,w=a),w===a&&(w=R,(I=gD())!==a&&(I=uNe(I)),w=I))),w}function gD(){var w,I,V;return(w=T2())===a&&(w=R,s.charCodeAt(R)===45?(I=C,R++):(I=a,be===0&&ct(Zv)),I===a&&(s.charCodeAt(R)===43?(I=T,R++):(I=a,be===0&&ct(Wv))),I!==a&&(V=T2())!==a?w=hNe(I,V):(R=w,w=a)),w}function fne(){var w,I,V;return w=R,s.charCodeAt(R)===46?(I=j,R++):(I=a,be===0&&ct(kn)),I!==a?((V=T2())===a&&(V=null),w=dNe(V)):(R=w,w=a),w}function mne(){var w,I,V;return w=R,(I=AFe())!==a&&(V=T2())!==a?w=pNe(I,V):(R=w,w=a),w}function T2(){var w,I;if(w=[],(I=gne())!==a)for(;I!==a;)w.push(I),I=gne();else w=a;return w!==a&&(w=fNe(w)),w}function gne(){var w;return PO.test(s.charAt(R))?(w=s.charAt(R),R++):(w=a,be===0&&ct(Ty)),w}function AFe(){var w,I,V;return w=R,IO.test(s.charAt(R))?(I=s.charAt(R),R++):(I=a,be===0&&ct(_2)),I!==a?($O.test(s.charAt(R))?(V=s.charAt(R),R++):(V=a,be===0&&ct(Yu)),V===a&&(V=null),w=mNe(I,V)):(R=w,w=a),w}function MFe(){var w,I,V,X;return w=R,s.substr(R,4).toLowerCase()===H?(I=s.substr(R,4),R+=4):(I=a,be===0&&ct(ow)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=I=[I,V]:(R=w,w=a)):(R=w,w=a),w}function OFe(){var w,I,V,X;return w=R,s.substr(R,4).toLowerCase()===K?(I=s.substr(R,4),R+=4):(I=a,be===0&&ct(b2)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=I=[I,V]:(R=w,w=a)):(R=w,w=a),w}function RFe(){var w,I,V,X;return w=R,s.substr(R,5).toLowerCase()===ee?(I=s.substr(R,5),R+=5):(I=a,be===0&&ct(pi)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=I=[I,V]:(R=w,w=a)):(R=w,w=a),w}function bG(){var w,I,V,X;return w=R,s.substr(R,2).toLowerCase()===ce?(I=s.substr(R,2),R+=2):(I=a,be===0&&ct(K8)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=gNe():(R=w,w=a)):(R=w,w=a),w}function yne(){var w,I,V,X;return w=R,s.substr(R,2).toLowerCase()===le?(I=s.substr(R,2),R+=2):(I=a,be===0&&ct(lD)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=yNe():(R=w,w=a)):(R=w,w=a),w}function vne(){var w,I,V,X;return w=R,s.substr(R,4).toLowerCase()===z?(I=s.substr(R,4),R+=4):(I=a,be===0&&ct(eG)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=vNe():(R=w,w=a)):(R=w,w=a),w}function PFe(){var w,I,V,X;return w=R,s.substr(R,6).toLowerCase()===q?(I=s.substr(R,6),R+=6):(I=a,be===0&&ct(tG)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=_Ne():(R=w,w=a)):(R=w,w=a),w}function kO(){var w,I,V,X;return w=R,s.substr(R,3).toLowerCase()===Z?(I=s.substr(R,3),R+=3):(I=a,be===0&&ct(DO)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=bNe():(R=w,w=a)):(R=w,w=a),w}function yD(){var w,I,V,X;return w=R,s.substr(R,3).toLowerCase()===Y?(I=s.substr(R,3),R+=3):(I=a,be===0&&ct(iG)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=wNe():(R=w,w=a)):(R=w,w=a),w}function _ne(){var w,I,V,X;return w=R,s.substr(R,2).toLowerCase()===te?(I=s.substr(R,2),R+=2):(I=a,be===0&&ct(NO)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=xNe():(R=w,w=a)):(R=w,w=a),w}function bne(){var w,I,V,X;return w=R,s.substr(R,7).toLowerCase()===se?(I=s.substr(R,7),R+=7):(I=a,be===0&&ct(yo)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=TNe():(R=w,w=a)):(R=w,w=a),w}function wG(){var w,I,V,X;return w=R,s.substr(R,4).toLowerCase()===J?(I=s.substr(R,4),R+=4):(I=a,be===0&&ct(rG)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=SNe():(R=w,w=a)):(R=w,w=a),w}function IFe(){var w,I,V,X;return w=R,s.substr(R,3).toLowerCase()===ae?(I=s.substr(R,3),R+=3):(I=a,be===0&&ct(cD)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=ENe():(R=w,w=a)):(R=w,w=a),w}function $Fe(){var w,I,V,X;return w=R,s.substr(R,9).toLowerCase()===_e?(I=s.substr(R,9),R+=9):(I=a,be===0&&ct(sG)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=CNe():(R=w,w=a)):(R=w,w=a),w}function LFe(){var w,I,V,X;return w=R,s.substr(R,7).toLowerCase()===Oe?(I=s.substr(R,7),R+=7):(I=a,be===0&&ct(nG)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=ANe():(R=w,w=a)):(R=w,w=a),w}function wne(){var w,I,V,X;return w=R,s.substr(R,4).toLowerCase()===Be?(I=s.substr(R,4),R+=4):(I=a,be===0&&ct(oG)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=MNe():(R=w,w=a)):(R=w,w=a),w}function DFe(){var w,I,V,X;return w=R,s.substr(R,8).toLowerCase()===Se?(I=s.substr(R,8),R+=8):(I=a,be===0&&ct(aG)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=ONe():(R=w,w=a)):(R=w,w=a),w}function NFe(){var w,I,V,X;return w=R,s.substr(R,9).toLowerCase()===Te?(I=s.substr(R,9),R+=9):(I=a,be===0&&ct(lG)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=RNe():(R=w,w=a)):(R=w,w=a),w}function FFe(){var w,I,V,X;return w=R,s.substr(R,4).toLowerCase()===Ie?(I=s.substr(R,4),R+=4):(I=a,be===0&&ct(Wc)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=PNe():(R=w,w=a)):(R=w,w=a),w}function kFe(){var w,I,V,X;return w=R,s.substr(R,7).toLowerCase()===Ve?(I=s.substr(R,7),R+=7):(I=a,be===0&&ct(cG)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=INe():(R=w,w=a)):(R=w,w=a),w}function UFe(){var w,I,V,X;return w=R,s.substr(R,8).toLowerCase()===Ni?(I=s.substr(R,8),R+=8):(I=a,be===0&&ct(uG)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=$Ne():(R=w,w=a)):(R=w,w=a),w}function zFe(){var w,I,V,X;return w=R,s.substr(R,4).toLowerCase()===Fi?(I=s.substr(R,4),R+=4):(I=a,be===0&&ct(ie)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=LNe():(R=w,w=a)):(R=w,w=a),w}function VFe(){var w,I,V,X;return w=R,s.substr(R,2).toLowerCase()===hi?(I=s.substr(R,2),R+=2):(I=a,be===0&&ct(Me)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=DNe():(R=w,w=a)):(R=w,w=a),w}function xne(){var w,I,V,X;return w=R,s.substr(R,8).toLowerCase()===Vi?(I=s.substr(R,8),R+=8):(I=a,be===0&&ct(Fe)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=NNe():(R=w,w=a)):(R=w,w=a),w}function Tne(){var w,I,V,X;return w=R,s.substr(R,4).toLowerCase()===di?(I=s.substr(R,4),R+=4):(I=a,be===0&&ct(Ai)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=FNe():(R=w,w=a)):(R=w,w=a),w}function Sne(){var w,I,V,X;return w=R,s.substr(R,5).toLowerCase()===ki?(I=s.substr(R,5),R+=5):(I=a,be===0&&ct(Wo)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=kNe():(R=w,w=a)):(R=w,w=a),w}function Ene(){var w,I,V,X;return w=R,s.substr(R,3).toLowerCase()===kr?(I=s.substr(R,3),R+=3):(I=a,be===0&&ct(Gs)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=UNe():(R=w,w=a)):(R=w,w=a),w}function Cne(){var w,I,V,X;return w=R,s.substr(R,4).toLowerCase()===us?(I=s.substr(R,4),R+=4):(I=a,be===0&&ct(Zc)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=zNe():(R=w,w=a)):(R=w,w=a),w}function Ane(){var w,I,V,X;return w=R,s.substr(R,6).toLowerCase()===ot?(I=s.substr(R,6),R+=6):(I=a,be===0&&ct(w2)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=VNe():(R=w,w=a)):(R=w,w=a),w}function aw(){var w,I,V,X;return w=R,s.substr(R,6).toLowerCase()===cr?(I=s.substr(R,6),R+=6):(I=a,be===0&&ct(eDe)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=BNe():(R=w,w=a)):(R=w,w=a),w}function vD(){var w,I,V,X;return w=R,s.substr(R,4).toLowerCase()===en?(I=s.substr(R,4),R+=4):(I=a,be===0&&ct(tDe)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=GNe():(R=w,w=a)):(R=w,w=a),w}function _D(){var w,I,V,X;return w=R,s.substr(R,3).toLowerCase()===mo?(I=s.substr(R,3),R+=3):(I=a,be===0&&ct(iDe)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=jNe():(R=w,w=a)):(R=w,w=a),w}function Mne(){var w,I,V,X;return w=R,s.substr(R,4).toLowerCase()===Fn?(I=s.substr(R,4),R+=4):(I=a,be===0&&ct(rDe)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=HNe():(R=w,w=a)):(R=w,w=a),w}function One(){var w,I,V,X;return w=R,s.substr(R,4).toLowerCase()===gl?(I=s.substr(R,4),R+=4):(I=a,be===0&&ct(sDe)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=qNe():(R=w,w=a)):(R=w,w=a),w}function BFe(){var w,I,V,X;return w=R,s.substr(R,4).toLowerCase()===yl?(I=s.substr(R,4),R+=4):(I=a,be===0&&ct(nDe)),I!==a?(V=R,be++,X=rr(),be--,X===a?V=void 0:(R=V,V=a),V!==a?w=WNe():(R=w,w=a)):(R=w,w=a),w}function bD(){var w;return s.charCodeAt(R)===44?(w=Qn,R++):(w=a,be===0&&ct(oDe)),w}function Ql(){var w;return s.charCodeAt(R)===40?(w=hd,R++):(w=a,be===0&&ct(aDe)),w}function Kl(){var w;return s.charCodeAt(R)===41?(w=RO,R++):(w=a,be===0&&ct(lDe)),w}function Ae(){var w,I;for(w=[],I=Rne();I!==a;)w.push(I),I=Rne();return w}function Rne(){var w;return LO.test(s.charAt(R))?(w=s.charAt(R),R++):(w=a,be===0&&ct(cDe)),w}function GFe(){var w,I,V,X;if(w=R,(I=cne())!==a&&(I=Zse(I)),(w=I)===a)if(w=R,s.charCodeAt(R)===96?(I=h2,R++):(I=a,be===0&&ct(Hse)),I!==a){if(V=[],qv.test(s.charAt(R))?(X=s.charAt(R),R++):(X=a,be===0&&ct(qse)),X!==a)for(;X!==a;)V.push(X),qv.test(s.charAt(R))?(X=s.charAt(R),R++):(X=a,be===0&&ct(qse));else V=a;V!==a?(s.charCodeAt(R)===96?(X=h2,R++):(X=a,be===0&&ct(Hse)),X!==a?w=ZNe(V):(R=w,w=a)):(R=w,w=a)}else R=w,w=a;return w}function jFe(w,I){return{type:"unary-expression",operator:w,expr:I}}function Pne(w,I,V,X){var ut={type:"binary-expression",operator:w,left:I,right:V};return X!==void 0&&(ut.escape=X),ut}function HFe(w,I){for(var V=[w],X=0;X<I.length;X++)V.push(I[X][3]);return V}function qFe(w,I,V){return HFe(w,I)}function xG(w,I){for(var V=w,X=0;X<I.length;X++)V=Pne(I[X][1],V,I[X][3]);return V}if((o=h())!==a&&R===s.length)return o;throw o!==a&&R<s.length&&ct(XNe()),YNe(dG,gm<s.length?s.charAt(gm):null,gm<s.length?ine(gm,gm+1):ine(gm,gm))}return e(t,Error),t.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var h=this.location.end,p=i("",l.line.toString().length),f=a[l.line-1],m=l.line===h.line?h.column:f.length+1;n+=`
 --> `+c+`
`+p+` |
`+l.line+" | "+f+`
`+p+" | "+i("",l.column-1)+i("",m-l.column,"^")}else n+=`
 at `+c}return n},t.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var g=m.parts.map(function(y){return Array.isArray(y)?c(y[0])+"-"+c(y[1]):c(y)});return"["+(m.inverted?"^":"")+g+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function h(m){return o[m.type](m)}function p(m){var g,y,x=m.map(h);if(x.sort(),x.length>0){for(g=1,y=1;g<x.length;g++)x[g-1]!==x[g]&&(x[y]=x[g],y++);x.length=y}switch(x.length){case 1:return x[0];case 2:return x[0]+" or "+x[1];default:return x.slice(0,-1).join(", ")+", or "+x[x.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+p(s)+" but "+f(n)+" found."},{SyntaxError:t,parse:r}},(xye=O$e).exports&&(xye.exports=Tye());class XIt{static parse(t){return O$e.exports.parse(t)}}const R$e=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,YIt=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,JIt=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,QIt=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,KIt=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,e3t=new Set(["current_timestamp","current_date","current_time"]);function Ww(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}function rP(e,t,i="0",r="0",s="0",n="0",o="",a="0",l="0"){if(o==="+"||o==="-"){const c=`${Ww(parseInt(e,10),4)}-${Ww(parseInt(t,10),2)}-${Ww(parseInt(i,10),2)}`;let h="";parseFloat(n)<10&&(h="0");const p=`${Ww(parseInt(r,10),2)}:${Ww(parseInt(s,10),2)}:${h+parseFloat(n).toString()}`,f=`${o}${Ww(parseInt(a,10),2)}:${Ww(parseInt(l,10),2)}`;return new Date(c+"T"+p+f)}return new Date(parseInt(e,10),parseInt(t,10)-1,parseInt(i,10),parseInt(r,10),parseInt(s,10),parseFloat(n))}class t3t{static makeBool(t){return P$e(t)}static featureValue(t,i,r,s){return N$e(t,i,r,s)}static equalsNull(t){return t===null}static applyLike(t,i,r){return tQ(t,i,r)}static ensureArray(t){return KJ(t)}static applyIn(t,i){return eQ(t,i)}static currentDate(){const t=new Date;return t.setHours(0,0,0,0),t}static makeSqlInterval(t,i,r){return Pc.createFromValueAndQualifer(t,i,r)}static convertInterval(t){return t instanceof Pc?t.valueInMilliseconds():t}static currentTimestamp(){return new Date}static compare(t,i,r){return L$e(t,i,r)}static calculate(t,i,r){return D$e(t,i,r)}static makeComparable(t){return I0(t)}static evaluateFunction(t,i){return A$e(t,i)}static lookup(t,i){const r=i[t];return r===void 0?null:r}static between(t,i){return t==null||i[0]==null||i[1]==null?null:t>=i[0]&&t<=i[1]}static notbetween(t,i){return t==null||i[0]==null||i[1]==null?null:t<i[0]||t>i[1]}static ternaryNot(t){return Bk(t)}static ternaryAnd(t,i){return I$e(t,i)}static ternaryOr(t,i){return $$e(t,i)}}class G8{constructor(t,i){this.fieldsIndex=i,this.datefields={},this.parameters={},this._hasDateFunctions=void 0,this.parseTree=XIt.parse(t);const{isStandardized:r,isAggregate:s,referencedFieldNames:n}=this._extractExpressionInfo(i);this.referencedFieldNames=n,this.isStandardized=r,this.isAggregate=s}static create(t,i){return new G8(t,i)}get fieldNames(){return this.referencedFieldNames}testSet(t,i=jx){const r={};for(const s of this.fieldNames)r[s]=t.map(n=>i.getAttribute(n,s));return!!this._evaluateNode(this.parseTree,{attributes:r},jx)}calculateValue(t,i=jx){const r=this._evaluateNode(this.parseTree,t,i);return r instanceof Pc?r.valueInMilliseconds()/864e5:r}calculateValueCompiled(t,i=jx){return this.parseTree._compiledVersion!=null?this.parseTree._compiledVersion(t,this.parameters,i,this.datefields):ye("esri-csp-restrictions")?this.calculateValue(t,i):(this._compileMe(),this.parseTree._compiledVersion(t,this.parameters,i,this.datefields))}testFeature(t,i=jx){return!!this._evaluateNode(this.parseTree,t,i)}testFeatureCompiled(t,i=jx){return this.parseTree._compiledVersion!=null?!!this.parseTree._compiledVersion(t,this.parameters,i,this.datefields):ye("esri-csp-restrictions")?this.testFeature(t,i):(this._compileMe(),!!this.parseTree._compiledVersion(t,this.parameters,i,this.datefields))}get hasDateFunctions(){return this._hasDateFunctions!=null||(this._hasDateFunctions=!1,this._visitAll(this.parseTree,t=>{t.type==="current-time"?this._hasDateFunctions=!0:t.type==="function"&&(this._hasDateFunctions=this._hasDateFunctions||e3t.has(t.name.toLowerCase()))})),this._hasDateFunctions}getFunctions(){const t=new Set;return this._visitAll(this.parseTree,i=>{i.type==="function"&&t.add(i.name.toLowerCase())}),Array.from(t)}getExpressions(){const t=new Map;return this._visitAll(this.parseTree,i=>{if(i.type==="function"){const r=i.name.toLowerCase(),s=i.args.value[0];if(s.type==="column-reference"){const n=s.column,o=`${r}-${n}`;t.has(o)||t.set(o,{aggregateType:r,field:n})}}}),[...t.values()]}getVariables(){const t=new Set;return this._visitAll(this.parseTree,i=>{i.type==="parameter"&&t.add(i.value.toLowerCase())}),Array.from(t)}_compileMe(){const t="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",t).bind(t3t)}_extractExpressionInfo(t){const i=[],r=new Set;let s=!0,n=!0;return this._visitAll(this.parseTree,o=>{switch(o.type){case"column-reference":{const a=t.get(o.column);let l,c;a?l=c=a.name:(c=o.column,l=c.toLowerCase()),!a||a.type!=="date"&&a.type!=="esriFieldTypeDate"||(this.datefields[a.name]=1),r.has(l)||(r.add(l),i.push(c)),o.column=c;break}case"function":{const{name:a,args:l}=o,c=l.value.length;s&&(s=ZIt(a,c)),n&&(n=qIt(a,c));break}}}),{referencedFieldNames:Array.from(i),isStandardized:s,isAggregate:n}}_visitAll(t,i){if(t!=null)switch(i(t),t.type){case"when-clause":this._visitAll(t.operand,i),this._visitAll(t.value,i);break;case"case-expression":for(const r of t.clauses)this._visitAll(r,i);t.format==="simple"&&this._visitAll(t.operand,i),t.else!==null&&this._visitAll(t.else,i);break;case"expression-list":for(const r of t.value)this._visitAll(r,i);break;case"unary-expression":this._visitAll(t.expr,i);break;case"binary-expression":this._visitAll(t.left,i),this._visitAll(t.right,i);break;case"function":this._visitAll(t.args,i)}}evaluateNodeToJavaScript(t){switch(t.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(t.value)+", "+JSON.stringify(t.qualifier)+","+JSON.stringify(t.op)+")";case"case-expression":{let i="";if(t.format==="simple"){const r="this.makeComparable("+this.evaluateNodeToJavaScript(t.operand)+")";i="( ";for(let s=0;s<t.clauses.length;s++)i+=" ("+r+" === this.makeComparable("+this.evaluateNodeToJavaScript(t.clauses[s].operand)+")) ? ("+this.evaluateNodeToJavaScript(t.clauses[s].value)+") : ";t.else!==null?i+=this.evaluateNodeToJavaScript(t.else):i+="null",i+=" )"}else{i="( ";for(let r=0;r<t.clauses.length;r++)i+=" this.makeBool("+this.evaluateNodeToJavaScript(t.clauses[r].operand)+")===true ? ("+this.evaluateNodeToJavaScript(t.clauses[r].value)+") : ";t.else!==null?i+=this.evaluateNodeToJavaScript(t.else):i+="null",i+=" )"}return i}case"parameter":return"this.lookup("+JSON.stringify(t.value.toLowerCase())+",lookups)";case"expression-list":{let i="[";for(const r of t.value)i!=="["&&(i+=","),i+=this.evaluateNodeToJavaScript(r);return i+="]",i}case"unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(t.expr)+")";case"binary-expression":switch(t.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(t.left)+","+this.evaluateNodeToJavaScript(t.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(t.left)+","+this.evaluateNodeToJavaScript(t.right)+" )";case"IS":if(t.right.type!=="null")throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(t.left)+")";case"ISNOT":if(t.right.type!=="null")throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(t.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(t.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(t.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(t.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(t.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(t.left)+","+this.evaluateNodeToJavaScript(t.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(t.left)+","+this.evaluateNodeToJavaScript(t.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(t.left)+","+this.evaluateNodeToJavaScript(t.right)+","+JSON.stringify(t.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(t.left)+","+this.evaluateNodeToJavaScript(t.right)+","+JSON.stringify(t.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(t.operator)+","+this.evaluateNodeToJavaScript(t.left)+","+this.evaluateNodeToJavaScript(t.right)+")";case"*":case"-":case"+":case"/":return"this.calculate("+JSON.stringify(t.operator)+","+this.evaluateNodeToJavaScript(t.left)+","+this.evaluateNodeToJavaScript(t.right)+")"}throw new Error("Not Supported Operator "+t.operator);case"null":case"boolean":case"string":case"number":return JSON.stringify(t.value);case"date":return"(new Date("+Eye(t.value).getTime().toString()+"))";case"timestamp":return"(new Date("+Sye(t.value).getTime().toString()+"))";case"current-time":return t.mode==="date"?"this.currentDate()":"this.currentTimestamp()";case"column-reference":return"this.featureValue(feature,"+JSON.stringify(t.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(t.name)+","+this.evaluateNodeToJavaScript(t.args)+")"}throw new Error("Unsupported sql syntax "+t.type)}_evaluateNode(t,i,r){switch(t.type){case"interval":{const s=this._evaluateNode(t.value,i,r);return Pc.createFromValueAndQualifer(s,t.qualifier,t.op)}case"case-expression":if(t.format==="simple"){const s=I0(this._evaluateNode(t.operand,i,r));for(let n=0;n<t.clauses.length;n++)if(s===I0(this._evaluateNode(t.clauses[n].operand,i,r)))return this._evaluateNode(t.clauses[n].value,i,r);if(t.else!==null)return this._evaluateNode(t.else,i,r)}else{for(let s=0;s<t.clauses.length;s++)if(P$e(this._evaluateNode(t.clauses[s].operand,i,r)))return this._evaluateNode(t.clauses[s].value,i,r);if(t.else!==null)return this._evaluateNode(t.else,i,r)}return null;case"parameter":return this.parameters[t.value.toLowerCase()];case"expression-list":{const s=[];for(const n of t.value)s.push(this._evaluateNode(n,i,r));return s}case"unary-expression":return Bk(this._evaluateNode(t.expr,i,r));case"binary-expression":switch(t.operator){case"AND":return I$e(this._evaluateNode(t.left,i,r),this._evaluateNode(t.right,i,r));case"OR":return $$e(this._evaluateNode(t.left,i,r),this._evaluateNode(t.right,i,r));case"IS":if(t.right.type!=="null")throw new Error("Unsupported RHS for IS");return this._evaluateNode(t.left,i,r)===null;case"ISNOT":if(t.right.type!=="null")throw new Error("Unsupported RHS for IS");return this._evaluateNode(t.left,i,r)!==null;case"IN":{const s=KJ(this._evaluateNode(t.right,i,r));return eQ(this._evaluateNode(t.left,i,r),s)}case"NOT IN":{const s=KJ(this._evaluateNode(t.right,i,r));return Bk(eQ(this._evaluateNode(t.left,i,r),s))}case"BETWEEN":{const s=this._evaluateNode(t.left,i,r),n=this._evaluateNode(t.right,i,r);return s==null||n[0]==null||n[1]==null?null:s>=I0(n[0])&&s<=I0(n[1])}case"NOTBETWEEN":{const s=this._evaluateNode(t.left,i,r),n=this._evaluateNode(t.right,i,r);return s==null||n[0]==null||n[1]==null?null:s<I0(n[0])||s>I0(n[1])}case"LIKE":return tQ(this._evaluateNode(t.left,i,r),this._evaluateNode(t.right,i,r),t.escape);case"NOT LIKE":return Bk(tQ(this._evaluateNode(t.left,i,r),this._evaluateNode(t.right,i,r),t.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return L$e(t.operator,this._evaluateNode(t.left,i,r),this._evaluateNode(t.right,i,r));case"-":case"+":case"*":case"/":return D$e(t.operator,this._evaluateNode(t.left,i,r),this._evaluateNode(t.right,i,r))}case"null":case"boolean":case"string":case"number":return t.value;case"date":return Eye(t.value);case"timestamp":return Sye(t.value);case"current-time":{const s=new Date;return t.mode==="date"&&s.setHours(0,0,0,0),s}case"column-reference":return N$e(i,t.column,this.datefields,r);case"function":{const s=this._evaluateNode(t.args,i,r);return this.isAggregate?HIt(t.name,s):A$e(t.name,s)}}throw new Error("Unsupported sql syntax "+t.type)}}function Sye(e){let t=YIt.exec(e);if(t!==null){const[,i,r,s,n,o,a]=t;return rP(i,r,s,n,o,a)}if(t=JIt.exec(e),t!==null){const[,i,r,s,n,o,a,l,c,h]=t;return rP(i,r,s,n,o,a,l,c,h)}if(t=QIt.exec(e),t!==null){const[,i,r,s,n,o,a,l,c]=t;return rP(i,r,s,n,o,"0",a,l,c)}if(t=KIt.exec(e),t!==null){const[,i,r,s,n,o]=t;return rP(i,r,s,n,o)}if(t=R$e.exec(e),t!==null){const[,i,r,s]=t;return rP(i,r,s)}throw new Error("SQL Invalid Timestamp")}function Eye(e){const t=R$e.exec(e);if(t===null)throw new Error("SQL Invalid Date");const[,i,r,s]=t;return new Date(parseInt(i,10),parseInt(r,10)-1,parseInt(s,10))}function P$e(e){return e===!0}function KJ(e){return Array.isArray(e)?e:[e]}function Bk(e){return e!==null?e!==!0:null}function I$e(e,t){return e!=null&&t!=null?e===!0&&t===!0:e!==!1&&t!==!1&&null}function $$e(e,t){return e!=null&&t!=null?e===!0||t===!0:e===!0||t===!0||null}function eQ(e,t){if(e==null)return null;let i=!1;for(const r of t)if(r==null)i=null;else if(e===r){i=!0;break}return i}const Cye="-[]/{}()*+?.\\^$|";var mT;function i3t(e,t){const i=t;let r="",s=mT.Normal;for(let n=0;n<e.length;n++){const o=e.charAt(n);switch(s){case mT.Normal:o===i?s=mT.Escaped:Cye.includes(o)?r+="\\"+o:r+=o==="%"?".*":o==="_"?".":o;break;case mT.Escaped:Cye.includes(o)?r+="\\"+o:r+=o,s=mT.Normal}}return new RegExp("^"+r+"$","m")}function tQ(e,t,i){return e==null?null:i3t(t,i).test(e)}function I0(e){return e instanceof Date?e.valueOf():e}function L$e(e,t,i){if(t==null||i==null)return null;const r=I0(t),s=I0(i);switch(e){case"<>":return r!==s;case"=":return r===s;case">":return r>s;case"<":return r<s;case">=":return r>=s;case"<=":return r<=s}}function D$e(e,t,i){if(t instanceof Pc)if(i instanceof Date)switch(e){case"+":return new Date(t.valueInMilliseconds()+i.getTime());case"-":return t.valueInMilliseconds()-i.getTime();case"*":return t.valueInMilliseconds()*i.getTime();case"/":return t.valueInMilliseconds()/i.getTime()}else if(i instanceof Pc)switch(e){case"+":return Pc.createFromMilliseconds(t.valueInMilliseconds()+i.valueInMilliseconds());case"-":return Pc.createFromMilliseconds(t.valueInMilliseconds()-i.valueInMilliseconds());case"*":return t.valueInMilliseconds()*i.valueInMilliseconds();case"/":return t.valueInMilliseconds()/i.valueInMilliseconds()}else t=t.valueInMilliseconds();else if(i instanceof Pc)if(t instanceof Date)switch(e){case"+":return new Date(i.valueInMilliseconds()+t.getTime());case"-":return new Date(t.getTime()-i.valueInMilliseconds());case"*":return t.getTime()*i.valueInMilliseconds();case"/":return t.getTime()/i.valueInMilliseconds()}else i=i.valueInMilliseconds();else if(t instanceof Date&&typeof i=="number")switch(i=24*i*60*60*1e3,t=t.getTime(),e){case"+":return new Date(t+i);case"-":return new Date(t-i);case"*":return new Date(t*i);case"/":return new Date(t/i)}else if(i instanceof Date&&typeof t=="number")switch(t=24*t*60*60*1e3,i=i.getTime(),e){case"+":return new Date(t+i);case"-":return new Date(t-i);case"*":return new Date(t*i);case"/":return new Date(t/i)}switch(e){case"+":return t+i;case"-":return t-i;case"*":return t*i;case"/":return t/i}}function r3t(e){return e&&typeof e.attributes=="object"}function N$e(e,t,i,r){const s=r.getAttribute(e,t);return s!=null&&i[t]===1?new Date(s):s}(function(e){e[e.Normal=0]="Normal",e[e.Escaped=1]="Escaped"})(mT||(mT={}));const jx={getAttribute:(e,t)=>(r3t(e)?e.attributes:e)[t]};var Ese=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",WhereClause:G8,defaultAttributeAdapter:jx});class s3t{constructor(t,i){this._cache=new mZ(t),this._invalidCache=new mZ(i)}get(t,i){const r=`${i.uid}:${t}`,s=this._cache.get(r);if(s)return s;if(this._invalidCache.get(r)!==void 0)return null;try{const n=G8.create(t,i);return this._cache.put(r,n),n}catch{return this._invalidCache.put(r,null),null}}}const Cse=new s3t(50,500),bb="feature-store:unsupported-query",F$e=" as ",n3t=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);function tUt(e,t){if(!t)return!0;const i=Cse.get(t,e);if(!i)throw new W(bb,"invalid SQL expression",{where:t});if(!i.isStandardized)throw new W(bb,"where clause is not standard",{where:t});return Ase(e,i.fieldNames,"where clause contains missing fields"),!0}function iUt(e,t,i){if(!t)return!0;const r=Cse.get(t,e);if(!r)throw new W(bb,"invalid SQL expression",{having:t});if(!r.isAggregate)throw new W(bb,"having does not contain a valid aggregate function",{having:t});const s=r.fieldNames;if(Ase(e,s,"having contains missing fields"),!r.getExpressions().every(n=>{const{aggregateType:o,field:a}=n,l=e.has(a)&&e.get(a).name;return i.some(c=>{const{onStatisticField:h,statisticType:p}=c;return(e.has(h)&&e.get(h).name)===l&&p.toLowerCase().trim()===o})}))throw new W(bb,"expressions in having should also exist in outStatistics",{having:t});return!0}function SI(e,t){return e?Cse.get(e,t):null}function Ase(e,t,i,r=!0){const s=[];for(const n of t)if(n!=="*"&&!e.has(n))if(r){const o=k$e(n);try{const a=SI(o,e);if(!a)throw new W(bb,"invalid SQL expression",{where:o});if(!a.isStandardized)throw new W(bb,"expression is not standard",{clause:a});Ase(e,a.fieldNames,"expression contains missing fields")}catch(a){const l=a&&a.details;if(l&&(l.clause||l.where))throw a;l&&l.missingFields?s.push(...l.missingFields):s.push(n)}}else s.push(n);if(s.length)throw new W(bb,i,{missingFields:s})}function k$e(e){return e.split(F$e)[0]}function o3t(e){return e.split(F$e)[1]}function rUt(e,t){const i=t.get(e);return!!i&&!n3t.has(i.type)}const Aye=new Ti({classBreaksDef:"class-breaks-definition",uniqueValueDef:"unique-value-definition"});let SC=class extends Ce{constructor(){super(...arguments),this.baseSymbol=null,this.colorRamp=null,this.type=null}};u([d({type:qc,json:{write:!0}})],SC.prototype,"baseSymbol",void 0),u([d({types:u2e,json:{read:{reader:h2e},write:!0}})],SC.prototype,"colorRamp",void 0),u([d({json:{read:Aye.read,write:Aye.write}})],SC.prototype,"type",void 0),SC=u([L("esri.rest.support.ClassificationDefinition")],SC);const a3t=SC,Mye=new Ti({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),Oye=new Ti({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let pf=class extends a3t{constructor(){super(...arguments),this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null,this.type="class-breaks-definition"}set standardDeviationInterval(e){this.classificationMethod==="standard-deviation"&&this._set("standardDeviationInterval",e)}set definedInterval(e){this.classificationMethod==="defined-interval"&&this._set("definedInterval",e)}};u([d({json:{write:!0}})],pf.prototype,"breakCount",void 0),u([d({json:{write:!0}})],pf.prototype,"classificationField",void 0),u([d({type:String,json:{read:Mye.read,write:Mye.write}})],pf.prototype,"classificationMethod",void 0),u([d({json:{write:!0}})],pf.prototype,"normalizationField",void 0),u([d({json:{read:Oye.read,write:Oye.write}})],pf.prototype,"normalizationType",void 0),u([d({value:null,json:{write:!0}})],pf.prototype,"standardDeviationInterval",null),u([d({value:null,json:{write:!0}})],pf.prototype,"definedInterval",null),u([d()],pf.prototype,"type",void 0),pf=u([L("esri.rest.support.ClassBreaksDefinition")],pf);const l3t=pf;function AE(e,t){return Number(e.toFixed(t))}function c3t(e){const{normalizationTotal:t}=e;return{classBreaks:u3t(e),normalizationTotal:t}}function u3t(e){const t=e.definition,{classificationMethod:i,breakCount:r,normalizationType:s,definedInterval:n}=t,o=[];let a=e.values;if(a.length===0)return[];a=a.sort((h,p)=>h-p);const l=a[0],c=a[a.length-1];if(i==="equal-interval")if(a.length>=r){const h=(c-l)/r;let p=l;for(let f=1;f<r;f++){const m=AE(l+f*h,6);o.push({minValue:p,maxValue:m,label:iu(p,m,s)}),p=m}o.push({minValue:p,maxValue:c,label:iu(p,c,s)})}else a.forEach(h=>{o.push({minValue:h,maxValue:h,label:iu(h,h,s)})});else if(i==="natural-breaks"){const h=h3t(a),p=e.valueFrequency||h.valueFrequency,f=d3t(h.uniqueValues,p,r);let m=l;for(let g=1;g<r;g++)if(h.uniqueValues.length>g){const y=AE(h.uniqueValues[f[g]],6);o.push({minValue:m,maxValue:y,label:iu(m,y,s)}),m=y}o.push({minValue:m,maxValue:c,label:iu(m,c,s)})}else if(i==="quantile")if(a.length>=r&&l!==c){let h=l,p=Math.ceil(a.length/r),f=0;for(let m=1;m<r;m++){let g=p+f-1;g>a.length&&(g=a.length-1),g<0&&(g=0),o.push({minValue:h,maxValue:a[g],label:iu(h,a[g],s)}),h=a[g],f+=p,p=Math.ceil((a.length-f)/(r-m))}o.push({minValue:h,maxValue:c,label:iu(h,c,s)})}else{let h=-1;for(let p=0;p<a.length;p++){const f=a[p];f!==h&&(h=f,o.push({minValue:h,maxValue:f,label:iu(h,f,s)}),h=f)}}else if(i==="standard-deviation"){const h=m3t(a),p=g3t(a,h);if(p===0)o.push({minValue:a[0],maxValue:a[0],label:iu(a[0],a[0],s)});else{const f=f3t(l,c,r,h,p)*p;let m=0,g=l;for(let x=r;x>=1;x--){const b=AE(h-(x-.5)*f,6);o.push({minValue:g,maxValue:b,label:iu(g,b,s)}),g=b,m++}let y=AE(h+.5*f,6);o.push({minValue:g,maxValue:y,label:iu(g,y,s)}),g=y,m++;for(let x=1;x<=r;x++)y=m===2*r?c:AE(h+(x+.5)*f,6),o.push({minValue:g,maxValue:y,label:iu(g,y,s)}),g=y,m++}}else if(i==="defined-interval"){if(!n)return o;const h=a[0],p=a[a.length-1],f=Math.ceil((p-h)/n);let m=h;for(let g=1;g<f;g++){const y=AE(h+g*n,6);o.push({minValue:m,maxValue:y,label:iu(m,y,s)}),m=y}o.push({minValue:m,maxValue:p,label:iu(m,p,s)})}return o}function iu(e,t,i){let r=null;return r=e===t?i&&i==="percent-of-total"?e+"%":e.toString():i&&i==="percent-of-total"?e+"% - "+t+"%":e+" - "+t,r}function h3t(e){const t=[],i=[];let r=Number.MIN_VALUE,s=1,n=-1;for(let o=0;o<e.length;o++){const a=e[o];a===r?(s++,i[n]=s):a!==null&&(t.push(a),r=a,s=1,i.push(s),n++)}return{uniqueValues:t,valueFrequency:i}}function d3t(e,t,i){const r=e.length,s=[];i>r&&(i=r);for(let o=0;o<i;o++)s.push(Math.round(o*r/i-1));s.push(r-1);let n=Rye(s,e,t,i);return p3t(n.mean,n.sdcm,s,e,t,i)&&(n=Rye(s,e,t,i)),s}function Rye(e,t,i,r){let s=[],n=[],o=[],a=0;const l=[],c=[];for(let m=0;m<r;m++){const g=tA(m,e,t,i);l.push(g.sbMean),c.push(g.sbSdcm),a+=c[m]}let h,p=a,f=!0;for(;f||a<p;){f=!1,s=[];for(let m=0;m<r;m++)s.push(e[m]);for(let m=0;m<r;m++)for(let g=e[m]+1;g<=e[m+1];g++)if(h=t[g],m>0&&g!==e[m+1]&&Math.abs(h-l[m])>Math.abs(h-l[m-1]))e[m]=g;else if(m<r-1&&e[m]!==g-1&&Math.abs(h-l[m])>Math.abs(h-l[m+1])){e[m+1]=g-1;break}p=a,a=0,n=[],o=[];for(let m=0;m<r;m++){n.push(l[m]),o.push(c[m]);const g=tA(m,e,t,i);l[m]=g.sbMean,c[m]=g.sbSdcm,a+=c[m]}}if(a>p){for(let m=0;m<r;m++)e[m]=s[m],l[m]=n[m],c[m]=o[m];a=p}return{mean:l,sdcm:c}}function p3t(e,t,i,r,s,n){let o=0,a=0,l=0,c=0,h=!0;for(let p=0;p<2&&h;p++){p===0&&(h=!1);for(let f=0;f<n-1;f++)for(;i[f+1]+1!==i[f+2];){i[f+1]=i[f+1]+1;const m=tA(f,i,r,s);l=m.sbMean,o=m.sbSdcm;const g=tA(f+1,i,r,s);if(c=g.sbMean,a=g.sbSdcm,!(o+a<t[f]+t[f+1])){i[f+1]=i[f+1]-1;break}t[f]=o,t[f+1]=a,e[f]=l,e[f+1]=c,h=!0}for(let f=n-1;f>0;f--)for(;i[f]!==i[f-1]+1;){i[f]=i[f]-1;const m=tA(f-1,i,r,s);l=m.sbMean,o=m.sbSdcm;const g=tA(f,i,r,s);if(c=g.sbMean,a=g.sbSdcm,!(o+a<t[f-1]+t[f])){i[f]=i[f]+1;break}t[f-1]=o,t[f]=a,e[f-1]=l,e[f]=c,h=!0}}return h}function f3t(e,t,i,r,s){let n=Math.max(r-e,t-r)/s/i;return n=n>=1?1:n>=.5?.5:.25,n}function m3t(e){let t=0;for(let i=0;i<e.length;i++)t+=e[i];return t/=e.length,t}function g3t(e,t){let i=0;for(let r=0;r<e.length;r++){const s=e[r];i+=(s-t)*(s-t)}return i/=e.length,Math.sqrt(i)}function tA(e,t,i,r){let s=0,n=0;for(let l=t[e]+1;l<=t[e+1];l++){const c=r[l];s+=i[l]*c,n+=c}n<=0&&console.log("Exception in Natural Breaks calculation");const o=s/n;let a=0;for(let l=t[e]+1;l<=t[e+1];l++)a+=r[l]*(i[l]-o)**2;return{sbMean:o,sbSdcm:a}}const y3t="equal-interval",v3t=1,_3t=5,b3t=10,w3t=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,Pye=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),x3t=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function U$e(e){const t=e.normalizationField!=null||e.normalizationType!=null,i=e.minValue!=null||e.maxValue!=null,r=!!e.sqlExpression&&e.supportsSQLExpression;return!t&&!i&&!r}function Iye(e){const t=e.returnDistinct?[...new Set(e.values)]:e.values,i=t.filter(s=>s!=null).length,r={count:i};return e.supportsNullCount&&(r.nullcount=t.length-i),e.percentileParams&&(r.median=Mse(t,e.percentileParams)),r}function iQ(e){const{values:t,useSampleStdDev:i,supportsNullCount:r}=e;let s=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,o=null,a=null,l=null,c=null,h=0;const p=e.minValue==null?-1/0:e.minValue,f=e.maxValue==null?1/0:e.maxValue;for(const g of t)Number.isFinite(g)?g>=p&&g<=f&&(o+=g,s=Math.min(s,g),n=Math.max(n,g),h++):typeof g=="string"&&h++;if(h&&o!=null){a=o/h;let g=0;for(const y of t)Number.isFinite(y)&&y>=p&&y<=f&&(g+=(y-a)**2);c=i?h>1?g/(h-1):0:h>0?g/h:0,l=Math.sqrt(c)}else s=null,n=null;const m={avg:a,count:h,max:n,min:s,stddev:l,sum:o,variance:c};return r&&(m.nullcount=t.length-h),e.percentileParams&&(m.median=Mse(t,e.percentileParams)),m}function Mse(e,t){const{fieldType:i,value:r,orderBy:s,isDiscrete:n}=t,o=z$e(i,s==="desc");if((e=[...e].filter(m=>m!=null).sort((m,g)=>o(m,g))).length===0)return null;if(r<=0)return e[0];if(r>=1)return e[e.length-1];const a=(e.length-1)*r,l=Math.floor(a),c=l+1,h=a%1,p=e[l],f=e[c];return c>=e.length||n||typeof p=="string"||typeof f=="string"?p:p*(1-h)+f*h}function z$e(e,t){const i=t?1:-1,r=T3t(t),s=$ye(t);if(!(!!e&&["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...Pye].includes(e)))return(n,o)=>typeof n=="number"&&typeof o=="number"?r(n,o):typeof n=="string"&&typeof o=="string"?s(n,o):i;if(e==="esriFieldTypeDate")return(n,o)=>{const a=new Date(n).getTime(),l=new Date(o).getTime();return isNaN(a)||isNaN(l)?i:r(a,l)};if(Pye.has(e))return(n,o)=>r(n,o);if(e==="esriFieldTypeString")return(n,o)=>s(n,o);if(e==="esriFieldTypeGUID"||e==="esriFieldTypeGlobalID"){const n=$ye(t);return(o,a)=>n(Lye(o),Lye(a))}return t?(n,o)=>1:(n,o)=>-1}function $ye(e){return e?(t,i)=>(t=t==null?void 0:t.toUpperCase(),i=i==null?void 0:i.toUpperCase(),t>i?-1:t<i?1:0):(t,i)=>(t=t==null?void 0:t.toUpperCase(),i=i==null?void 0:i.toUpperCase(),t<i?-1:t>i?1:0)}function T3t(e){return e?(t,i)=>i-t:(t,i)=>t-i}function Lye(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function S3t(e,t){let i;for(i in e)x3t.includes(i)&&(Number.isFinite(e[i])||(e[i]=null));return t&&["avg","stddev","variance"].forEach(r=>{e[r]!=null&&(e[r]=Math.ceil(e[r]))}),e}function E3t(e){const t={};for(let i of e)(i==null||typeof i=="string"&&i.trim()==="")&&(i=null),t[i]==null?t[i]={count:1,data:i}:t[i].count++;return{count:t}}function C3t(e,t,i){const r=e.count,s=[];i&&t&&t.type==="coded-value"&&t.codedValues.forEach(n=>{const o=n.code;r.hasOwnProperty(o)||(r[o]={data:o,count:0})});for(const n in r){const o=r[n];s.push({value:o.data,count:o.count,label:o.label})}return{uniqueValueInfos:s}}function A3t(e,t,i,r){let s=null;switch(t){case"log":e!==0&&(s=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(r)&&r!==0&&(s=e/r*100);break;case"field":Number.isFinite(i)&&i!==0&&(s=e/i);break;case"natural-log":e>0&&(s=Math.log(e));break;case"square-root":e>0&&(s=e**.5)}return s}function V$e(e,t){const i=O3t({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,breakCount:t.numClasses||_3t});return e=M3t(e,t.minValue,t.maxValue),c3t({definition:i,values:e,normalizationTotal:t.normalizationTotal})}function M3t(e,t,i){return t=t==null?-1/0:t,i=i==null?1/0:i,e.filter(r=>Number.isFinite(r)&&r>=t&&r<=i)}function O3t(e){const t=e.field,i=e.classificationMethod||y3t,r=e.normalizationType,s=e.normalizationField,n=new l3t;return n.classificationField=t,n.breakCount=e.breakCount,n.classificationMethod=i,n.standardDeviationInterval=i==="standard-deviation"?e.standardDeviationInterval||v3t:void 0,n.normalizationType=r,n.normalizationField=r==="field"?s:void 0,n}function R3t(e,t){let i=e.classBreaks;const r=i.length,s=i[0].minValue,n=i[r-1].maxValue,o=t==="standard-deviation",a=w3t;return i=i.map(l=>{const c=l.label,h={minValue:l.minValue,maxValue:l.maxValue,label:c};if(o&&c){const p=c.match(a).map(f=>+f.trim());p.length===2?(h.minStdDev=p[0],h.maxStdDev=p[1],p[0]<0&&p[1]>0&&(h.hasAvg=!0)):p.length===1&&(c.includes("<")?(h.minStdDev=null,h.maxStdDev=p[0]):c.includes(">")&&(h.minStdDev=p[0],h.maxStdDev=null))}return h}),{minValue:s,maxValue:n,classBreakInfos:i,normalizationTotal:e.normalizationTotal}}function P3t(e,t){const{min:i,max:r,intervals:s}=I3t(e,t),n=s.map((o,a)=>({minValue:s[a][0],maxValue:s[a][1],count:0}));for(const o of e)if(o!=null&&o>=i&&o<=r){const a=$3t(s,o);a>-1&&n[a].count++}return{bins:n,minValue:i,maxValue:r,normalizationTotal:t.normalizationTotal}}function I3t(e,t){const{field:i,classificationMethod:r,standardDeviationInterval:s,normalizationType:n,normalizationField:o,normalizationTotal:a,minValue:l,maxValue:c}=t,h=t.numBins||b3t;let p=null,f=null,m=null;if((!r||r==="equal-interval")&&!n){if(l!=null&&c!=null)p=l,f=c;else{const g=iQ({values:e,minValue:l,maxValue:c,useSampleStdDev:!n,supportsNullCount:U$e({normalizationType:n,normalizationField:o,minValue:l,maxValue:c})});p=g.min,f=g.max}m=L3t(p,f,h)}else{const{classBreaks:g}=V$e(e,{field:i,normalizationType:n,normalizationField:o,normalizationTotal:a,classificationMethod:r,standardDeviationInterval:s,minValue:l,maxValue:c,numClasses:h});p=g[0].minValue,f=g[g.length-1].maxValue,m=g.map(y=>[y.minValue,y.maxValue])}return{min:p,max:f,intervals:m}}function $3t(e,t){let i=-1;for(let r=e.length-1;r>=0;r--)if(t>=e[r][0]){i=r;break}return i}function L3t(e,t,i){const r=(t-e)/i,s=[];let n,o=e;for(let a=1;a<=i;a++)n=o+r,n=Number(n.toFixed(16)),s.push([o,a===i?t:n]),o=n;return s}class S4{constructor(t,i,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=t.returnDistinctValues,this.fieldsIndex=r,this.featureAdapter=i;const s=t.outFields;if(s&&!s.includes("*")){this.outFields=s;let n=0;for(const o of s){const a=k$e(o),l=this.fieldsIndex.get(a),c=l?null:SI(a,r),h=l?l.name:o3t(o)||"FIELD_EXP_"+n++;this._fieldDataCache.set(o,{alias:h,clause:c})}}}countDistinctValues(t){return this.returnDistinctValues?(t.forEach(i=>this.getAttributes(i)),this._returnDistinctMap.size):t.length}getAttributes(t){const i=this._processAttributesForOutFields(t);return this._processAttributesForDistinctValues(i)}getFieldValue(t,i,r){const s=r?r.name:i;let n=null;return this._fieldDataCache.has(s)?n=this._fieldDataCache.get(s).clause:r||(n=SI(i,this.fieldsIndex),this._fieldDataCache.set(s,{alias:s,clause:n})),r?this.featureAdapter.getAttribute(t,s):n.calculateValue(t,this.featureAdapter)}getNormalizedValue(t,i){const r=i.normalizationType,s=i.normalizationTotal;let n=this.getFieldValue(t,i.field,i.fieldInfo);if(r&&Number.isFinite(n)){const o=this.getFieldValue(t,i.normalizationField,i.normalizationFieldInfo);n=A3t(n,r,o,s)}return n}getExpressionValue(t,i,r,s){const n={attributes:this.featureAdapter.getAttributes(t),layer:{fields:this.fieldsIndex.fields}},o=s.createExecContext(n,r);return s.executeFunction(i,o)}getExpressionValues(t,i,r,s){const n={fields:this.fieldsIndex.fields};return t.map(o=>{const a={attributes:this.featureAdapter.getAttributes(o),layer:n},l=s.createExecContext(a,r);return s.executeFunction(i,l)})}validateItem(t,i){return this._fieldDataCache.has(i)||this._fieldDataCache.set(i,{alias:i,clause:SI(i,this.fieldsIndex)}),this._fieldDataCache.get(i).clause.testFeature(t,this.featureAdapter)}validateItems(t,i){return this._fieldDataCache.has(i)||this._fieldDataCache.set(i,{alias:i,clause:SI(i,this.fieldsIndex)}),this._fieldDataCache.get(i).clause.testSet(t,this.featureAdapter)}_processAttributesForOutFields(t){const i=this.outFields;if(!i||!i.length)return this.featureAdapter.getAttributes(t);const r={};for(const s of i){const{alias:n,clause:o}=this._fieldDataCache.get(s);r[n]=o?o.calculateValue(t,this.featureAdapter):this.featureAdapter.getAttribute(t,n)}return r}_processAttributesForDistinctValues(t){if(M(t)||!this.returnDistinctValues)return t;const i=this.outFields,r=[];if(i)for(const o of i){const{alias:a}=this._fieldDataCache.get(o);r.push(t[a])}else for(const o in t)r.push(t[o]);const s=`${(i||["*"]).join(",")}=${r.join(",")}`;let n=this._returnDistinctMap.get(s)||0;return this._returnDistinctMap.set(s,++n),n>1?null:t}}const B$e={convertToGEGeometry:D3t,exportPoint:F3t,exportPolygon:U3t,exportPolyline:V3t,exportMultipoint:G3t,exportExtent:H3t};function D3t(e,t){return t==null?null:e.convertJSONToGeometry(t)}class N3t{constructor(t,i,r){this.x=t,this.y=i,this.spatialReference=r,this.z=void 0,this.m=void 0}}function F3t(e,t,i){const r=new N3t(e.getPointX(t),e.getPointY(t),i),s=e.hasZ(t),n=e.hasM(t);return s&&(r.z=e.getPointZ(t)),n&&(r.m=e.getPointM(t)),r}class k3t{constructor(t,i,r,s){this.rings=t,this.spatialReference=i,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}function U3t(e,t,i){return new k3t(e.exportPaths(t),i,e.hasZ(t),e.hasM(t))}class z3t{constructor(t,i,r,s){this.paths=t,this.spatialReference=i,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}function V3t(e,t,i){return new z3t(e.exportPaths(t),i,e.hasZ(t),e.hasM(t))}class B3t{constructor(t,i,r,s){this.points=t,this.spatialReference=i,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}function G3t(e,t,i){return new B3t(e.exportPoints(t),i,e.hasZ(t),e.hasM(t))}class j3t{constructor(t,i,r,s,n){this.xmin=t,this.ymin=i,this.xmax=r,this.ymax=s,this.spatialReference=n,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}function H3t(e,t,i){const r=e.hasZ(t),s=e.hasM(t),n=new j3t(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),i);if(r){const o=e.getZExtent(t);n.zmin=o.vmin,n.zmax=o.vmax}if(s){const o=e.getMExtent(t);n.mmin=o.vmin,n.mmax=o.vmax}return n}const MH=[0,0];function G$e(e,t){if(!t)return null;if("x"in t){const i={x:0,y:0};return[i.x,i.y]=e(t.x,t.y,MH),t.z!=null&&(i.z=t.z),t.m!=null&&(i.m=t.m),i}if("xmin"in t){const i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=e(t.xmin,t.ymin,MH),[i.xmax,i.ymax]=e(t.xmax,t.ymax,MH),t.hasZ&&(i.zmin=t.zmin,i.zmax=t.zmax,i.hasZ=!0),t.hasM&&(i.mmin=t.mmin,i.mmax=t.mmax,i.hasM=!0),i}return"rings"in t?{rings:Dye(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:Dye(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:j$e(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:void 0}function Dye(e,t){const i=[];for(const r of e)i.push(j$e(r,t));return i}function j$e(e,t){const i=[];for(const r of e){const s=t(r[0],r[1],[0,0]);i.push(s),r.length>2&&s.push(r[2]),r.length>3&&s.push(r[3])}return i}async function H$e(e,t){if(!t)return;const i=Array.isArray(e)?e.map(r=>_(r.geometry)&&r.geometry.spatialReference):[e];await KA(i.map(r=>({source:r,dest:t})))}const q$e=G$e.bind(null,bT),W$e=G$e.bind(null,oA);function SV(e,t,i,r){if(!e||(i||(i=t,t=e.spatialReference),!ja(t)||!ja(i)||_a(t,i)))return e;if(Ig(t,i)){const s=Gg(i)?q$e(e):W$e(e);return s.spatialReference=i,s}return LU(B$e,[e],t,i,null,r)[0]}class q3t{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(t,i,r){if(!t||!t.length||!i||!r||_a(i,r))return t;const s={geometries:t,inSpatialReference:i,outSpatialReference:r,resolve:null};return this._jobs.push(s),new Promise(n=>{s.resolve=n,this._timer===null&&(this._timer=setTimeout(this._process,10))})}_process(){this._timer=null;const t=this._jobs.shift();if(!t)return;const{geometries:i,inSpatialReference:r,outSpatialReference:s,resolve:n}=t;Ig(r,s)?Gg(s)?n(i.map(q$e)):n(i.map(W$e)):n(LU(B$e,i,r,s,null,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}}const W3t=new q3t;function sUt(e,t,i){return W3t.push(e,t,i)}function Ose(e,t){return e?t?4:3:t?3:2}function nUt(e,t,i,r,s){if(M(t)||!t.lengths.length)return null;const n=(s==null?void 0:s.originPosition)==="upperLeft"?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const o=e.coords,a=[],l=i?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:c,coords:h}=t,p=Ose(i,r);let f=0;for(const m of c){const g=Z3t(l,h,f,m,i,r,n);g&&a.push(g),f+=m*p}if(a.sort((m,g)=>{let y=n*m[2]-n*g[2];return y===0&&i&&(y=m[4]-g[4]),y}),a.length){let m=6*a[0][2];o[0]=a[0][0]/m,o[1]=a[0][1]/m,i&&(m=6*a[0][4],o[2]=m!==0?a[0][3]/m:0),(o[0]<l[0]||o[0]>l[1]||o[1]<l[2]||o[1]>l[3]||i&&(o[2]<l[4]||o[2]>l[5]))&&(o.length=0)}if(!o.length){const m=t.lengths[0]?X3t(h,0,c[0],i,r):null;if(!m)return null;o[0]=m[0],o[1]=m[1],i&&m.length>2&&(o[2]=m[2])}return e}function Z3t(e,t,i,r,s,n,o=1){const a=Ose(s,n);let l=i,c=i+a,h=0,p=0,f=0,m=0,g=0;for(let x=0,b=r-1;x<b;x++,l+=a,c+=a){const S=t[l],T=t[l+1],C=t[l+2],A=t[c],O=t[c+1],D=t[c+2];let U=S*O-A*T;m+=U,h+=(S+A)*U,p+=(T+O)*U,s&&(U=S*D-A*C,f+=(C+D)*U,g+=U),S<e[0]&&(e[0]=S),S>e[1]&&(e[1]=S),T<e[2]&&(e[2]=T),T>e[3]&&(e[3]=T),s&&(C<e[4]&&(e[4]=C),C>e[5]&&(e[5]=C))}if(m*o>0&&(m*=-1),g*o>0&&(g*=-1),!m)return null;const y=[h,p,.5*m];return s&&(y[3]=f,y[4]=.5*g),y}function X3t(e,t,i,r,s){const n=Ose(r,s);let o=t,a=t+n,l=0,c=0,h=0,p=0;for(let f=0,m=i-1;f<m;f++,o+=n,a+=n){const g=e[o],y=e[o+1],x=e[o+2],b=e[a],S=e[a+1],T=e[a+2],C=r?J3t(g,y,x,b,S,T):Y3t(g,y,b,S);if(C)if(l+=C,r){const A=K3t(g,y,x,b,S,T);c+=C*A[0],h+=C*A[1],p+=C*A[2]}else{const A=Q3t(g,y,b,S);c+=C*A[0],h+=C*A[1]}}return l>0?r?[c/l,h/l,p/l]:[c/l,h/l]:i>0?r?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function Y3t(e,t,i,r){const s=i-e,n=r-t;return Math.sqrt(s*s+n*n)}function J3t(e,t,i,r,s,n){const o=r-e,a=s-t,l=n-i;return Math.sqrt(o*o+a*a+l*l)}function Q3t(e,t,i,r){return[e+.5*(i-e),t+.5*(r-t)]}function K3t(e,t,i,r,s,n){return[e+.5*(r-e),t+.5*(s-t),i+.5*(n-i)]}const e$t=new Ti({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),Nye=Object.freeze({}),Fye=new Ga,t$t=new Ga,rQ=new Ga,OH={esriGeometryPoint:kZ,esriGeometryPolyline:Gee,esriGeometryPolygon:jee,esriGeometryMultipoint:Bee};function kye(e,t,i,r=e.hasZ,s=e.hasM){if(M(t))return null;const n=e.hasZ&&r,o=e.hasM&&s;if(i){const a=X3(rQ,t,e.hasZ,e.hasM,"esriGeometryPoint",i,r,s);return kZ(a,n,o)}return kZ(t,n,o)}function RH(e,t,i,r,s,n,o=t,a=i){const l=t&&o,c=i&&a,h=_(r)?"coords"in r?r:r.geometry:null;if(M(h))return null;if(s){let p=TZe(t$t,h,t,i,e,s,o,a);return n&&(p=X3(rQ,p,l,c,e,n)),OH[e](p,l,c)}if(n){const p=X3(rQ,h,t,i,e,n,o,a);return OH[e](p,l,c)}return EZe(Fye,h,t,i,o,a),OH[e](Fye,l,c)}async function oUt(e,t,i){const{outFields:r,orderByFields:s,groupByFieldsForStatistics:n,outStatistics:o}=e;if(r)for(let a=0;a<r.length;a++)r[a]=r[a].trim();if(s)for(let a=0;a<s.length;a++)s[a]=s[a].trim();if(n)for(let a=0;a<n.length;a++)n[a]=n[a].trim();if(o)for(let a=0;a<o.length;a++)o[a].onStatisticField&&(o[a].onStatisticField=o[a].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),i$t(e,t,i)}async function i$t(e,t,i){if(!e)return null;let{where:r}=e;if(e.where=r=r&&r.trim(),(!r||/^1 *= *1$/.test(r)||t&&t===r)&&(e.where=null),!e.geometry)return e;let s=await r$t(e);if(e.distance=0,e.units=null,e.spatialRel==="esriSpatialRelEnvelopeIntersects"){const{spatialReference:l}=e.geometry;s=fq(s),s.spatialReference=l}e.geometry=s,await H$e(s.spatialReference,i);const n=(await Nee(jg(s)))[0];if(M(n))throw Nye;const o=n.toJSON(),a=await SV(o,o.spatialReference,i);if(!a)throw Nye;return a.spatialReference=i,e.geometry=a,e}async function r$t(e){const{geometry:t,distance:i,units:r}=e;if(i==null||"vertexAttributes"in t)return t;const s=t.spatialReference,n=r?e$t.fromJSON(r):mL(s),o=s&&(BV(s)||Gg(s))?t:await H$e(s,uq).then(()=>SV(t,uq));return(await s$t())(o.spatialReference,o,i,n)}async function s$t(){return(await import("./geometryEngineJSON.843ccea9.js")).geodesicBuffer}function PH(e){return e&&Z$e in e?JSON.parse(JSON.stringify(e,n$t)):e}const Z$e="_geVersion",n$t=(e,t)=>e!==Z$e?t:void 0;class aUt{constructor(t,i,r){this.items=t,this.query=i,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.fieldsIndex=r.fieldsIndex,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.featureAdapter=r.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const t=new S4(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return t.countDistinctValues(this.items);const{groupByFieldsForStatistics:i,having:r,outStatistics:s}=this.query;if(!(i==null?void 0:i.length))return 1;const o=new Map,a=new Map,l=new Set;for(const c of s){const{statisticType:h}=c,p=h!=="exceedslimit"?c.onStatisticField:void 0;if(!a.has(p)){const m=[];for(const g of i){const y=this._getAttributeValues(t,g,o);m.push(y)}a.set(p,this._calculateUniqueValues(m,t.returnDistinctValues))}const f=a.get(p);for(const m in f){const{data:g,items:y}=f[m],x=g.join(",");r&&!t.validateItems(y,r)||l.add(x)}}return l.size}async createQueryResponse(){let t;return this.query.outStatistics?t=this.query.outStatistics.some(i=>i.statisticType==="exceedslimit")?this._createExceedsLimitQueryResponse(this.query):await this._createStatisticsQueryResponse(this.query):t=this._createFeatureQueryResponse(this.query),this.query.returnQueryGeometry&&(ja(this.query.outSR)&&!_a(this.query.geometry.spatialReference,this.query.outSR)?t.queryGeometry=PH(F({spatialReference:this.query.outSR},SV(this.query.geometry,this.query.geometry.spatialReference,this.query.outSR))):t.queryGeometry=PH(F({spatialReference:this.query.outSR},this.query.geometry))),t}createSnappingResponse(t,i){const r=this.featureAdapter,s=a$t(this.hasZ,this.hasM),{x:n,y:o}=t.point,a=typeof t.distance=="number"?t.distance:t.distance.x,l=typeof t.distance=="number"?t.distance:t.distance.y,c={candidates:[]},h=this.geometryType==="esriGeometryPolygon",p=this._getPointCreator(t.point,this.spatialReference,i);for(const f of this.items){const m=r.getGeometry(f);if(M(m))continue;const{coords:g,lengths:y}=m;if(t.types&ZM.EDGE){let x=0;for(let b=0;b<y.length;b++){const S=y[b];for(let T=0;T<S;T++,x+=s){const C=g[x],A=g[x+1];if(T!==S-1){const O=g[x+s],D=g[x+s+1],{x:U,y:k}=o$t(n,o,C,A,O,D),B=(n-U)/a,j=(o-k)/l,H=B*B+j*j;H<=1&&c.candidates.push({type:"edge",objectId:r.getObjectId(f),distance:Math.sqrt(H),target:p(U,k),start:p(C,A),end:p(O,D)})}}}}if(t.types&ZM.VERTEX){const x=h?g.length-s:g.length;for(let b=0;b<x;b+=s){const S=g[b],T=g[b+1],C=(n-S)/a,A=(o-T)/l,O=C*C+A*A;O<=1&&c.candidates.push({type:"vertex",objectId:r.getObjectId(f),distance:Math.sqrt(O),target:p(S,T)})}}}return c.candidates.sort((f,m)=>f.distance-m.distance),c}_getPointCreator(t,i,r){const s=_(r)&&!_a(i,r)?n=>SV(n,i,r):n=>n;return t.z!=null&&t.m!=null?(n,o)=>s({x:n,y:o,z:t.z,m:t.m}):t.z!=null?(n,o)=>s({x:n,y:o,z:t.z}):t.m!=null?(n,o)=>s({x:n,y:o,m:t.m}):(n,o)=>s({x:n,y:o})}async createSummaryStatisticsResponse(t){const{field:i,valueExpression:r,normalizationField:s,normalizationType:n,normalizationTotal:o,minValue:a,maxValue:l,scale:c}=t,h=this.fieldsIndex.isDateField(i),p=await this._getDataValues({field:i,valueExpression:r,normalizationField:s,normalizationType:n,normalizationTotal:o,scale:c}),f=U$e({normalizationType:n,normalizationField:s,minValue:a,maxValue:l}),m=this.fieldsIndex.get(i),g={value:.5,fieldType:m==null?void 0:m.type},y=voe(m)?Iye({values:p,supportsNullCount:f,percentileParams:g}):iQ({values:p,minValue:a,maxValue:l,useSampleStdDev:!n,supportsNullCount:f,percentileParams:g});return S3t(y,h)}async createUniqueValuesResponse(t){const{field:i,valueExpression:r,domain:s,returnAllCodedValues:n,scale:o}=t,a=await this._getDataValues({field:i,valueExpression:r,scale:o}),l=E3t(a);return C3t(l,s,n)}async createClassBreaksResponse(t){const{field:i,valueExpression:r,normalizationField:s,normalizationType:n,normalizationTotal:o,classificationMethod:a,standardDeviationInterval:l,minValue:c,maxValue:h,numClasses:p,scale:f}=t,m=await this._getDataValues({field:i,valueExpression:r,normalizationField:s,normalizationType:n,normalizationTotal:o,scale:f}),g=V$e(m,{field:i,normalizationField:s,normalizationType:n,normalizationTotal:o,classificationMethod:a,standardDeviationInterval:l,minValue:c,maxValue:h,numClasses:p});return R3t(g,a)}async createHistogramResponse(t){const{field:i,valueExpression:r,normalizationField:s,normalizationType:n,normalizationTotal:o,classificationMethod:a,standardDeviationInterval:l,minValue:c,maxValue:h,numBins:p,scale:f}=t,m=await this._getDataValues({field:i,valueExpression:r,normalizationField:s,normalizationType:n,normalizationTotal:o,scale:f});return P3t(m,{field:i,normalizationField:s,normalizationType:n,normalizationTotal:o,classificationMethod:a,standardDeviationInterval:l,minValue:c,maxValue:h,numBins:p})}_sortFeatures(t,i,r){if(t.length>1&&i&&i.length)for(const s of i.reverse()){const n=s.split(" "),o=n[0],a=this.fieldsIndex.get(o),l=n[1]&&n[1].toLowerCase()==="desc",c=z$e(a==null?void 0:a.type,l);t.sort((h,p)=>{const f=r(h,o,a),m=r(p,o,a);return c(f,m)})}}_createFeatureQueryResponse(t){const i=this.items,{geometryType:r,hasM:s,hasZ:n,objectIdField:o,spatialReference:a}=this,{outFields:l,outSR:c,quantizationParameters:h,resultRecordCount:p,resultOffset:f,returnZ:m,returnM:g}=t,y=p!=null&&i.length>(f||0)+p,x=l&&(l.includes("*")?[...this.fieldsIndex.fields]:l.map(b=>this.fieldsIndex.get(b)));return{exceededTransferLimit:y,features:this._createFeatures(t,i),fields:x,geometryType:r,hasM:s&&g,hasZ:n&&m,objectIdFieldName:o,spatialReference:PH(c||a),transform:h&&Pde(h)||null}}_createFeatures(t,i){const r=new S4(t,this.featureAdapter,this.fieldsIndex),{hasM:s,hasZ:n}=this,{orderByFields:o,quantizationParameters:a,returnGeometry:l,returnCentroid:c,maxAllowableOffset:h,resultOffset:p,resultRecordCount:f,returnZ:m=!1,returnM:g=!1}=t,y=n&&m,x=s&&g;let b=[],S=0;const T=[...i];if(this._sortFeatures(T,o,(A,O,D)=>r.getFieldValue(A,O,D)),l||c){const A=Pde(a);if(l&&!c)for(const O of T)b[S++]={attributes:r.getAttributes(O),geometry:RH(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(O),h,A,y,x)};else if(!l&&c)for(const O of T)b[S++]={attributes:r.getAttributes(O),centroid:kye(this,this.featureAdapter.getCentroid(O,this),A)};else for(const O of T)b[S++]={attributes:r.getAttributes(O),centroid:kye(this,this.featureAdapter.getCentroid(O,this),A),geometry:RH(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(O),h,A,y,x)}}else for(const A of T){const O=r.getAttributes(A);O&&(b[S++]={attributes:O})}const C=p||0;if(f!=null){const A=C+f;b=b.slice(C,Math.min(b.length,A))}return b}_createExceedsLimitQueryResponse(t){let i=!1,r=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY;for(const o of t.outStatistics)if(o.statisticType==="exceedslimit"){r=o.maxPointCount!=null?o.maxPointCount:Number.POSITIVE_INFINITY,s=o.maxRecordCount!=null?o.maxRecordCount:Number.POSITIVE_INFINITY,n=o.maxVertexCount!=null?o.maxVertexCount:Number.POSITIVE_INFINITY;break}if(this.geometryType==="esriGeometryPoint")i=this.items.length>r;else if(this.items.length>s)i=!0;else{const o=this.hasZ?this.hasM?4:3:this.hasM?3:2,a=this.featureAdapter;i=this.items.reduce((l,c)=>{const h=a.getGeometry(c);return l+(_(h)&&h.coords.length||0)},0)/o>n}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(i)}}]}}async _createStatisticsQueryResponse(t){const i={attributes:{}},r=[],s=new Map,n=new Map,o=new Map,a=new Map,l=new S4(t,this.featureAdapter,this.fieldsIndex),c=t.outStatistics,{groupByFieldsForStatistics:h,having:p,orderByFields:f}=t,m=h&&h.length,g=!!m,y=g&&h[0],x=g&&!this.fieldsIndex.get(y);for(const S of c){const{outStatisticFieldName:T,statisticType:C}=S,A=S,O=C!=="exceedslimit"?S.onStatisticField:void 0,D=C==="percentile_disc"||C==="percentile_cont",U=C==="EnvelopeAggregate"||C==="CentroidAggregate"||C==="ConvexHullAggregate",k=g&&m===1&&(O===y||x)&&C==="count";if(g){if(!o.has(O)){const j=[];for(const H of h){const K=this._getAttributeValues(l,H,s);j.push(K)}o.set(O,this._calculateUniqueValues(j,l.returnDistinctValues))}const B=o.get(O);for(const j in B){const{count:H,data:K,items:ee,itemPositions:ce}=B[j],le=K.join(",");if(!p||l.validateItems(ee,p)){const z=a.get(le)||{attributes:{}};if(U){z.aggregateGeometries||(z.aggregateGeometries={});const{aggregateGeometries:q,outStatisticFieldName:Z}=await this._getAggregateGeometry(A,ee);z.aggregateGeometries[Z]=q}else{let q=null;if(k)q=H;else{const Z=this._getAttributeValues(l,O,s),Y=ce.map(te=>Z[te]);q=D&&"statisticParameters"in A?this._getPercentileValue(A,Y):this._getStatisticValue(A,Y,null,l.returnDistinctValues)}z.attributes[T]=q}h.forEach((q,Z)=>z.attributes[this.fieldsIndex.get(q)?q:`EXPR_${Z+1}`]=K[Z]),a.set(le,z)}}}else if(U){i.aggregateGeometries||(i.aggregateGeometries={});const{aggregateGeometries:B,outStatisticFieldName:j}=await this._getAggregateGeometry(A,this.items);i.aggregateGeometries[j]=B}else{const B=this._getAttributeValues(l,O,s);i.attributes[T]=D&&"statisticParameters"in A?this._getPercentileValue(A,B):this._getStatisticValue(A,B,n,l.returnDistinctValues)}r.push({name:T,alias:T,type:"esriFieldTypeDouble"})}const b=g?Array.from(a.values()):[i];return this._sortFeatures(b,f,(S,T)=>S.attributes[T]),{fields:r,features:b}}async _getAggregateGeometry(t,i){const r=await import("./geometryEngineJSON.843ccea9.js"),{statisticType:s,outStatisticFieldName:n}=t,{featureAdapter:o,spatialReference:a,geometryType:l,hasZ:c,hasM:h}=this,p=i.map(g=>RH(l,c,h,o.getGeometry(g))),f=r.convexHull(a,p,!0)[0],m={aggregateGeometries:null,outStatisticFieldName:null};if(s==="EnvelopeAggregate"){const g=f?QQ(f):fq(r.union(a,p));m.aggregateGeometries=me(F({},g),{spatialReference:a}),m.outStatisticFieldName=n||"extent"}else if(s==="CentroidAggregate"){const g=f?n_e(f):TUe(fq(r.union(a,p)));m.aggregateGeometries={x:g[0],y:g[1],spatialReference:a},m.outStatisticFieldName=n||"centroid"}else s==="ConvexHullAggregate"&&(m.aggregateGeometries=f,m.outStatisticFieldName=n||"convexHull");return m}_getStatisticValue(t,i,r,s){const{onStatisticField:n,statisticType:o}=t;let a=null;return a=(r==null?void 0:r.has(n))?r.get(n):voe(this.fieldsIndex.get(n))?Iye({values:i,returnDistinct:s}):iQ({values:i,minValue:null,maxValue:null,useSampleStdDev:!0}),r&&r.set(n,a),a[o==="var"?"variance":o]}_getPercentileValue(t,i){const{onStatisticField:r,statisticParameters:s,statisticType:n}=t,{value:o,orderBy:a}=s,l=this.fieldsIndex.get(r);return Mse(i,{value:o,orderBy:a,fieldType:l==null?void 0:l.type,isDiscrete:n==="percentile_disc"})}_getAttributeValues(t,i,r){if(r.has(i))return r.get(i);const s=this.fieldsIndex.get(i),n=this.items.map(o=>t.getFieldValue(o,i,s));return r.set(i,n),n}_getAttributeNormalizedValues(t,i){return this.items.map(r=>t.getNormalizedValue(r,{field:i.field,fieldInfo:this.fieldsIndex.get(i.field),normalizationField:i.normalizationField,normalizationFieldInfo:this.fieldsIndex.get(i.normalizationField),normalizationType:i.normalizationType,normalizationTotal:i.normalizationTotal}))}async _getAttributeExpressionValues(t,i,r){const{arcadeUtils:s}=await sm(),n=s.createFunction(i),o=r&&s.getViewInfo(r);return t.getExpressionValues(this.items,n,o,s)}_calculateUniqueValues(t,i){const r={},s=this.items,n=s.length;for(let o=0;o<n;o++){const a=s[o],l=[];for(const h of t)l.push(h[o]);const c=l.join(",");i?r[c]==null&&(r[c]={count:1,data:l,items:[a],itemPositions:[o]}):r[c]==null?r[c]={count:1,data:l,items:[a],itemPositions:[o]}:(r[c].count++,r[c].items.push(a),r[c].itemPositions.push(o))}return r}async _getDataValues(t){const i=new S4(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:r,field:s,normalizationField:n,normalizationType:o,normalizationTotal:a,scale:l}=t,c=r?{viewingMode:"map",scale:l,spatialReference:this.query.outSR||this.spatialReference}:null;return r?this._getAttributeExpressionValues(i,r,c):this._getAttributeNormalizedValues(i,{field:s,normalizationField:n,normalizationType:o,normalizationTotal:a})}}function o$t(e,t,i,r,s,n){const o=s-i,a=n-r,l=o*o+a*a,c=(e-i)*o+(t-r)*a,h=Math.min(1,Math.max(0,c/l));return{x:i+o*h,y:r+a*h}}function a$t(e,t){return e?t?4:3:t?3:2}var ZM;(function(e){e[e.NONE=0]="NONE",e[e.EDGE=1]="EDGE",e[e.VERTEX=2]="VERTEX"})(ZM||(ZM={}));let jf=class extends Ce{constructor(){super(...arguments),this.enabled=!0}};u([d({type:Boolean})],jf.prototype,"enabled",void 0),jf=u([L("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],jf);let bn=class extends Ce{constructor(e){super(e),this.lineSnapper=new jf,this.parallelLineSnapper=new jf,this.rightAngleSnapper=new jf,this.rightAngleTriangleSnapper=new jf,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new Le([255,127,0]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5}};u([d({type:jf,constructOnly:!0,nonNullable:!0,json:{write:!0}})],bn.prototype,"lineSnapper",void 0),u([d({type:jf,constructOnly:!0,nonNullable:!0,json:{write:!0}})],bn.prototype,"parallelLineSnapper",void 0),u([d({type:jf,constructOnly:!0,nonNullable:!0,json:{write:!0}})],bn.prototype,"rightAngleSnapper",void 0),u([d({type:jf,constructOnly:!0,nonNullable:!0,json:{write:!0}})],bn.prototype,"rightAngleTriangleSnapper",void 0),u([d({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],bn.prototype,"shortLineThreshold",void 0),u([d({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],bn.prototype,"distance",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],bn.prototype,"pointThreshold",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],bn.prototype,"intersectionParallelLineThreshold",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],bn.prototype,"parallelLineThreshold",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],bn.prototype,"touchSensitivityMultiplier",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],bn.prototype,"pointOnLineThreshold",void 0),u([d({type:Le,nonNullable:!0})],bn.prototype,"orange",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],bn.prototype,"lineHintWidthReference",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],bn.prototype,"lineHintWidthTarget",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],bn.prototype,"lineHintFadedExtensions",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],bn.prototype,"parallelLineHintWidth",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],bn.prototype,"parallelLineHintLength",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],bn.prototype,"parallelLineHintOffset",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],bn.prototype,"rightAngleHintSize",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],bn.prototype,"rightAngleHintOutlineSize",void 0),bn=u([L("esri.views.interactive.snapping.Settings.Defaults")],bn);const Ov=new bn;function BS(e,t){const i=e.x-t.x,r=e.y-t.y;return i*i+r*r}function em(e,t){const i=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return i;case 3:return i&&e[2]===t[2];case 4:return i&&e[3]===t[3]}return!1}function Rse(e,t){t.sort((i,r)=>ty(i.targetPoint,e)-ty(r.targetPoint,e))}var hm;(function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(hm||(hm={}));function IH(e,t){return e[0]*t[1]-e[1]*t[0]}function X$e(e,t,i){const r=(t[0]-e[0])*(i[1]-e[1])-(t[1]-e[1])*(i[0]-e[0]);return Math.abs(r)/a2(t,i)}function l$t(e,t,i){const r=ys(i,t)/wS(i);return Oc(e,i,r)}function IA(e,t,i,r,s=i){return Ss(Hf,r,i),Ss(_p,t,s),l$t(XM,_p,Hf),$h(e,s,XM)}function c$t(e,t,i,r){Ss(Hf,r,i),Ss(_p,t,i);const s=ys(Hf,_p)/wS(Hf);return s>0?Fg(e,i,Hf,s):po(e,i)}function Pse(e,t,i,r){Ss(Hf,t,i);const s=r/a6(Hf);return Fg(e,i,Hf,s)}function Y$e(e,t){return IA(_p,t,e.start,e.end),Rg(_p[0],t[0])&&Rg(_p[1],t[1])?[TT(t)]:[]}function J$e(e,t,i){return Pse(_p,i,e,t),Rg(_p[0],i[0])&&Rg(_p[1],i[1])?[TT(i)]:[]}function u$t(e,t){const i=e.start,r=e.end,s=t.start,n=t.end,o=Ss(Hf,r,i),a=Ss(K$e,n,s),l=IH(o,a);if(Math.abs(l)<=h$t)return[];const c=Ss(_p,i,s),h=IH(a,c)/l,p=IH(o,c)/l;if(h>=0){if(p>=0||t.type===$o.LINE)return[Fg(XM,i,o,h)]}else if(e.type===$o.LINE&&(p>=0||t.type===$o.LINE))return[Fg(XM,i,o,h)];return[]}function Q$e(e,t,i){const r=[],s=Ss(Hf,e.end,e.start),n=Ss(K$e,e.start,t),o=wS(s),a=2*ys(s,n),l=a*a-4*o*(wS(n)-i*i);if(l===0){const c=-a/(2*o);(e.type===$o.LINE||c>=0)&&r.push(Fg(XM,e.start,s,c))}else if(l>0){const c=Math.sqrt(l),h=(-a+c)/(2*o);(e.type===$o.LINE||h>=0)&&r.push(Fg(XM,e.start,s,h));const p=(-a-c)/(2*o);(e.type===$o.LINE||p>=0)&&r.push(Fg(_p,e.start,s,p))}return r}var $o;(function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"})($o||($o={}));const h$t=1e-6,Hf=Ke(),K$e=Ke(),_p=Ke(),XM=Ke();class j8{constructor(t){this.coordinateHelper=t}}class H8 extends j8{constructor(t,i){super(t),this.point=i}objectEqual(t){return t instanceof H8&&em(this.point,t.point)}check(t){return ty(t,this.point)<Ov.pointThreshold}closestTo(){return this.coordinateHelper.clone(this.point)}intersect(t){const i=[];return t instanceof GS?i.push(...Y$e({start:t.start,end:t.end,type:t instanceof qf?$o.LINE:$o.RAY},this.point)):t instanceof aD&&i.push(...J$e(t.center,t.radius,this.point)),i.map(r=>new MO(this.coordinateHelper,r,this,t))}}class GS extends j8{constructor(t,i,r){super(t),this.start=i,this.end=r}objectEqual(t){return t instanceof GS&&em(this.start,t.start)&&em(this.end,t.end)}intersect(t){const i=[];return t instanceof H8?i.push(...Y$e({start:this.start,end:this.end,type:this instanceof qf?$o.LINE:$o.RAY},t.point)):t instanceof GS?i.push(...u$t({start:this.start,end:this.end,type:this instanceof qf?$o.LINE:$o.RAY},{start:t.start,end:t.end,type:t instanceof qf?$o.LINE:$o.RAY})):t instanceof aD&&i.push(...Q$e({start:this.start,end:this.end,type:this instanceof qf?$o.LINE:$o.RAY},t.center,t.radius)),i.map(r=>new MO(this.coordinateHelper,r,this,t))}}class q8 extends GS{constructor(t,i,r){super(t,i,r),this.dir=Ke(),this.p=Ke()}objectEqual(t){return t instanceof q8&&super.objectEqual(t)}check(t){return Ss(this.dir,this.end,this.start),Ss(this.p,t,this.start),ys(this.dir,this.p)>=0&&X$e(t,this.start,this.end)<Ov.pointOnLineThreshold}closestTo(t){const i=this.coordinateHelper.clone(t);return c$t(i,t,this.start,this.end),i}}class qf extends GS{constructor(t,i,r){super(t,i,r)}objectEqual(t){return t instanceof qf&&super.objectEqual(t)}check(t){return X$e(t,this.start,this.end)<Ov.pointOnLineThreshold}closestTo(t){const i=this.coordinateHelper.clone(t);return IA(i,t,this.start,this.end),i}}class MO extends j8{constructor(t,i,r,s){super(t),this.intersection=i,this.first=r,this.second=s}objectEqual(t){return t instanceof MO&&this.first.objectEqual(t.first)&&this.second.objectEqual(t.second)}check(){return!1}closestTo(t){const i=this.coordinateHelper.clone(t);return po(i,this.intersection),i}intersect(){return[]}}class aD extends j8{constructor(t,i,r){super(t),this.center=i,this.radius=r}objectEqual(t){return t instanceof aD&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}check(){return!1}closestTo(t){const i=this.coordinateHelper.clone(t);return Pse(i,t,this.center,this.radius),i}intersect(t){const i=[];return t instanceof GS?i.push(...Q$e({start:t.start,end:t.end,type:t instanceof qf?$o.LINE:$o.RAY},this.center,this.radius)):t instanceof H8&&i.push(...J$e(this.center,this.radius,t.point)),i.map(r=>new MO(this.coordinateHelper,r,this,t))}}class OO{constructor(t,i,r,s){this.coordinateHelper=t,this.targetPoint=i,this.constraint=r,this.elevationInfo=s}}class eLe extends OO{constructor({coordinateHelper:t,targetPoint:i,objectId:r,constraint:s,elevationInfo:n}){super(t,i,s,n),this.objectId=r}}class W8{constructor(t){this.elevationInfo=t}}ve.getLogger("esri.views.interactive.snapping.hints.LineSnappingHint");class dm extends W8{constructor(t,i,r,s,n=!0,o=!0){super(s),this.type=t,this.lineStart=i,this.lineEnd=r,this.fadeLeft=n,this.fadeRight=o}equals(t){return t instanceof dm&&this.type===t.type&&em(this.lineStart,t.lineStart)&&em(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight}}class d$t extends eLe{constructor(t){super(me(F({},t),{constraint:new qf(t.coordinateHelper,t.edgeStart,t.edgeEnd)}))}get hints(){return[new dm(hm.REFERENCE,this.constraint.start,this.constraint.end,this.elevationInfo)]}}ve.getLogger("esri.views.interactive.snapping.hints.RightAngleSnappingHint");class Z8 extends W8{constructor(t,i,r,s){super(s),this.previousVertex=t,this.centerVertex=i,this.nextVertex=r}equals(t){return t instanceof Z8&&em(this.previousVertex,t.previousVertex)&&em(this.centerVertex,t.centerVertex)&&em(this.nextVertex,t.nextVertex)}}class tLe extends OO{constructor({coordinateHelper:t,targetPoint:i,constraint:r,previousVertex:s,otherVertex:n,otherVertexType:o,objectId:a,elevationInfo:l}){super(t,i,r,l),this.previousVertex=s,this.otherVertex=n,this.otherVertexType=o,this.objectId=a}get hints(){const t=this.previousVertex,i=this.otherVertexType===YM.CENTER?this.otherVertex:this.targetPoint,r=this.otherVertexType===YM.CENTER?this.targetPoint:this.otherVertex,s=this.elevationInfo;return[new dm(hm.TARGET,i,r,s),new dm(hm.REFERENCE,t,i,s),new Z8(this.previousVertex,i,r,s)]}}var YM;(function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"})(YM||(YM={}));function lUt(e,t,i,r){i.projectToRenderScreen(e,Uye),i.projectToRenderScreen(t,zye),Ss(r,zye,Uye),pM(r,r)}function iLe(e,t,i,r,s=$()){const n=t.toXYZ(e);return n[2]=TV(r,n,t.spatialReference,i)||0,r.renderCoordsHelper.toRenderCoords(n,t.spatialReference,s),s}function cUt(e,t,i,r,s=$()){const n=pe(sQ,e);return n[2]=TV(r,n,t,i)||0,r.renderCoordsHelper.toRenderCoords(n,t,s),s}function ga(e,t,i,r){return r.type==="2d"?r.toScreen(t.vectorToPoint(e,p$t)):(iLe(e,t,i,r,sQ),r.state.camera.projectToScreen(sQ,$H),bp($H[0],$H[1]))}function uUt(e,t,i,r,s,n,o){const a=i.toXYZ(e),l=i.toXYZ(t);if(r.mode!=="absolute-height"){const c=TV(s,a,i.spatialReference,r),h=TV(s,l,i.spatialReference,r),p=(c==null?h:h==null?c:Math.min(c,h))||0;a[2]=p,l[2]=p}s.renderCoordsHelper.toRenderCoords(a,i.spatialReference,n),s.renderCoordsHelper.toRenderCoords(l,i.spatialReference,o)}const p$t=new dt,sQ=$(),Uye=ko(),zye=ko(),$H=Ts();let _1=class extends yv{constructor(e){super(e),this.options=null,this.sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null}}}get updating(){return Mn(this.snappingSources,({snappingSource:e})=>e.updating)||this.updatingHandles.updating}get snappingSources(){const e=this._get("snappingSources")||new Map,t=new Map;if(_(this.options)&&_(this.options.featureSources))for(const i of this.options.featureSources.items){const r=i.layer.uid,s=e.get(r);if(s){e.delete(r),t.set(r,s);continue}if(!i.layer.loaded){this.updatingHandles.addPromise(i.layer.load());continue}const n=this._createSourceInfo(i);_(n)&&t.set(r,n)}for(const[,i]of e)i.destroy();return t}initialize(){this.updatingHandles.add(()=>this.snappingSources,()=>this.notifyChange("updating"),Ui),_(this.view)&&this.handles.add([this.view.on("layerview-create",e=>this._updateLayerView(e.layer,e.layerView)),this.view.on("layerview-destroy",e=>this._updateLayerView(e.layer,null))])}_updateLayerView(e,t){for(const[,i]of this.snappingSources)i.snappingSource.layerSource.layer===e&&(i.layerView=t)}destroy(){this._set("options",null);for(const[,e]of this.snappingSources)e.destroy()}async fetchCandidates(e,t,i){if(M(this.options)||!this.options.effectiveFeatureEnabled)return[];const r=[],s=this._computeScreeenSizeDistanceParameters(e,t),n={distance:s,point:e,coordinateHelper:t.coordinateHelper,types:this.types,filter:null};for(const[,{snappingSource:a,layerView:l}]of this.snappingSources)!a.layerSource.enabled||_(l)&&l.suspended||r.push(a.fetchCandidates(n,i).then(c=>c.filter(h=>!this._candidateIsExcluded(a,h,t.excludeFeature))));const o=(await Cve(r)).flat();return this._addRightAngleCandidates(o,e,s,t),qt(i),Rse(e,o),o}_addRightAngleCandidates(e,t,i,r){var a,l,c,h,p,f,m,g;const s=_(r.vertexHandle)?(l=(a=r.vertexHandle.rightEdge)==null?void 0:a.rightVertex)==null?void 0:l.pos:_(r.editGeometryOperations)&&r.editGeometryOperations.data.type==="polygon"?(h=(c=r.editGeometryOperations.data.components[0])==null?void 0:c.getFirstVertex())==null?void 0:h.pos:null,n=_(r.vertexHandle)?(f=(p=r.vertexHandle.leftEdge)==null?void 0:p.leftVertex)==null?void 0:f.pos:_(r.editGeometryOperations)?(g=(m=r.editGeometryOperations.data.components[0])==null?void 0:m.getLastVertex())==null?void 0:g.pos:null,o=e.length;for(let y=0;y<o;y++)this._addRightAngleCandidate(e[y],n,t,i,r,e),this._addRightAngleCandidate(e[y],s,t,i,r,e)}_addRightAngleCandidate(e,t,i,r,s,n){if(M(t)||!(e instanceof d$t))return;const o=e.constraint.closestTo(t),a=(o[0]-i[0])/r.x,l=(o[1]-i[1])/r.y;if(a*a+l*l<=1){const c=s.coordinateHelper;n.push(new tLe({coordinateHelper:c,targetPoint:o,otherVertex:t,otherVertexType:YM.NEXT,previousVertex:e.constraint.start,constraint:new q8(c,t,o),objectId:e.objectId,elevationInfo:e.elevationInfo}))}}_computeScreeenSizeDistanceParameters(e,t){const i=_(this.options)?this.options.distance*(t.pointer==="touch"?this.options.touchSensitivityMultiplier:1):0;if(M(this.view))return{x:i,y:i,pixelSize:i};if(this.view.type==="2d"){const r=i*this.view.resolution;return{x:r,y:r,pixelSize:r}}return this._computeScreenSizeDistanceParameters3D(e,i,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,i,r){const{coordinateHelper:s,elevationInfo:n}=r,o=i.state.camera.computeScreenPixelSizeAt(iLe(e,s,n,i,m$t)),a=o*i.renderCoordsHelper.unitInMeters/i.mapCoordsHelper.unitInMeters,l=t*a;return{x:l/this._computeScreenMagnitudeOfMapOffset(e,a,0,i,r),y:l/this._computeScreenMagnitudeOfMapOffset(e,0,a,i,r),pixelSize:o}}_computeScreenMagnitudeOfMapOffset(e,t,i,r,{coordinateHelper:s,elevationInfo:n}){const o=s.clone(e);o[0]+=t,o[1]+=i;const a=ga(e,s,n,r),l=ga(o,s,n,r),c=l.x-a.x,h=l.y-a.y;return Math.sqrt(c*c+h*h)}get types(){return ZM.EDGE|ZM.VERTEX}_candidateIsExcluded(e,t,i){if(M(i))return!1;const r=this._getCandidateObjectId(t);if(M(r))return!1;const s=e.layerSource.layer;return s.type==="graphics"?i.uid===r:i.sourceLayer===s&&!(!i.attributes||!("objectIdField"in s))&&i.attributes[s.objectIdField]===r}_getCandidateObjectId(e){return e instanceof eLe?e.objectId:null}_createSourceInfo(e){const t=this._createFeatureSnappingSourceType(e);if(M(t))return null;if("loading"in t)return this.updatingHandles.addPromise(t.loading.then(()=>{this.destroyed||this.notifyChange("snappingSources")})),null;const i=_(this.view)?this.view.allLayerViews.find(r=>r.layer===e.layer):null;return new f$t(t.source,i)}_createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e)}return null}_createFeatureSnappingSourceFeatureLayer(e){switch(e.layer.source.type){case"feature-layer":{const t=this._getSourceModule("featureService");return _(t.module)?{source:new t.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}case"memory":case"csv":case"geojson":case"wfs":{if(e.layer.geometryType==="mesh")return null;const t=this._getSourceModule("featureCollection");return _(t.module)?{source:new t.module.FeatureCollectionSnappingSource({layerSource:e})}:{loading:t.loader}}}return null}_createFeatureSnappingSourceGraphicsLayer(e){const t=this._getSourceModule("graphics");return _(t.module)?{source:new t.module.GraphicsSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}_getSourceModule(e){const t=this.sourceModules[e];if(M(t.loader)){const i=this._loadSourceModule(e).then(r=>{t.module=r});return t.loader=i,{module:t.module,loader:i}}return{module:t.module,loader:t.loader}}_loadSourceModule(e){switch(e){case"featureService":return this.updatingHandles.addPromise(import("./FeatureServiceSnappingSource.adb73bea.js"));case"featureCollection":return this.updatingHandles.addPromise(import("./FeatureCollectionSnappingSource.1acef5cf.js"));case"graphics":return this.updatingHandles.addPromise(import("./GraphicsSnappingSource.915f0bad.js"))}return null}};u([d({constructOnly:!0})],_1.prototype,"spatialReference",void 0),u([d({constructOnly:!0})],_1.prototype,"view",void 0),u([d()],_1.prototype,"options",void 0),u([d({readOnly:!0})],_1.prototype,"updating",null),u([d({readOnly:!0})],_1.prototype,"snappingSources",null),_1=u([L("esri.views.interactive.snapping.FeatureSnappingEngine")],_1);class f$t{constructor(t,i){this.snappingSource=t,this.layerView=i,this.handles=new Nt;const r=this.snappingSource.layerSource.layer;if("refresh"in r){const s=r;this.handles.add(s.on("refresh",()=>t.refresh()))}this.handles.add([re(()=>t.updating,s=>t.layerSource.updating=s,fi),re(()=>t.availability,s=>t.layerSource.availability=s,fi)])}destroy(){this.snappingSource.destroy(),this.handles.destroy()}}const m$t=$();class X8{constructor(t,i){this.view=t,this.options=i,this.squaredShortLineThreshold=Ov.shortLineThreshold*Ov.shortLineThreshold}snap(t,i){return _(i.vertexHandle)?i.vertexHandle.type!=="vertex"?[]:this.snapExistingVertex(t,i):this.snapNewVertex(t,i)}edgeExceedsShortLineThreshold(t,i){return this.exceedsShortLineThreshold(t.leftVertex.pos,t.rightVertex.pos,i)}exceedsShortLineThreshold(t,i,{elevationInfo:r,editGeometryOperations:s}){const n=s.data.coordinateHelper;return this.squaredShortLineThreshold===0||BS(ga(i,n,r,this.view),ga(t,n,r,this.view))>this.squaredShortLineThreshold}squaredProximityTreshold(t){return t==="touch"?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:t,touchSensitivityMultiplier:i}=this.options,r=t*i;return r*r}}class g$t extends OO{constructor({coordinateHelper:t,lineStart:i,lineEnd:r,targetPoint:s,elevationInfo:n}){super(t,s,new qf(t,i,r),n),this.referenceLineHint=new dm(hm.REFERENCE_EXTENSION,i,r,n)}get hints(){return[this.referenceLineHint,new dm(hm.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.elevationInfo)]}_lineEndClosestToTarget(){const t=this.constraint.start,i=this.constraint.end;return Math.sign(ys(Ss(v$t,i,t),Ss(y$t,this.targetPoint,t)))>0?i:t}}const y$t=Ke(),v$t=Ke();class _$t extends X8{snapNewVertex(t,i){const r=i.editGeometryOperations.data.components[0],s=r.edges.length,n=[];if(s<1)return n;const o=i.coordinateHelper,a=ga(t,o,i.elevationInfo,this.view),l=r.edges[s-1];let c=l;do this.edgeExceedsShortLineThreshold(c,i)&&this._processCandidateProposal(c.leftVertex.pos,c.rightVertex.pos,t,a,i,n),c=c.leftVertex.leftEdge;while(c&&c!==l);return n}snapExistingVertex(t,i){const r=[],s=i.vertexHandle,n=s.component;if(n.edges.length<2)return r;const o=i.coordinateHelper,a=ga(t,o,i.elevationInfo,this.view),l=s.leftEdge,c=s.rightEdge;l&&c&&this.edgeExceedsShortLineThreshold(l,i)&&this.edgeExceedsShortLineThreshold(c,i)&&this._processCandidateProposal(l.leftVertex.pos,c.rightVertex.pos,t,a,i,r);const h=n.edges[0];let p=h;do p!==s.leftEdge&&p!==s.rightEdge&&this.edgeExceedsShortLineThreshold(p,i)&&this._processCandidateProposal(p.leftVertex.pos,p.rightVertex.pos,t,a,i,r),p=p.rightVertex.rightEdge;while(p&&p!==h);return r}_processCandidateProposal(t,i,r,s,n,o){const a=IA(Ke(),r,t,i),{coordinateHelper:l,elevationInfo:c,pointer:h}=n,p=l.fromXYZ(a,l.getZ(r,0));BS(s,ga(p,l,c,this.view))<this.squaredProximityTreshold(h)&&o.push(new g$t({coordinateHelper:l,lineStart:t,lineEnd:i,targetPoint:p,elevationInfo:c}))}}ve.getLogger("esri.views.interactive.snapping.hints.ParallelSnappingHint");class Ise extends W8{constructor(t,i,r){super(r),this.lineStart=t,this.lineEnd=i}equals(t){return t instanceof Ise&&em(this.lineStart,t.lineStart)&&em(this.lineEnd,t.lineEnd)}}class b$t extends OO{constructor({coordinateHelper:t,referenceLine:i,lineStart:r,targetPoint:s,elevationInfo:n}){const o=t.clone(r);Ss(o,$h(o,o,i.rightVertex.pos),i.leftVertex.pos),super(t,s,new qf(t,r,o),n),this._referenceLines=[{edge:i,fadeLeft:!0,fadeRight:!0}]}get hints(){const t=this.elevationInfo;return[new dm(hm.TARGET,this.constraint.start,this.targetPoint,t),new Ise(this.constraint.start,this.targetPoint,t),...this._referenceLines.map(i=>new dm(hm.REFERENCE,i.edge.leftVertex.pos,i.edge.rightVertex.pos,t,i.fadeLeft,i.fadeRight))]}addReferenceLine(t){const i={edge:t,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(r=>{t.rightVertex.rightEdge===r.edge&&(r.fadeLeft=!1,i.fadeRight=!1),t.leftVertex.leftEdge===r.edge&&(r.fadeRight=!1,i.fadeLeft=!1)}),this._referenceLines.push(i)}}class w$t extends X8{constructor(){super(...arguments),this._tmpProjection=Ke()}snapNewVertex(t,i){const r=i.editGeometryOperations.data.components[0],s=r.edges.length,n=r.vertices.length,o=[];if(s<2)return o;const a=ga(t,i.coordinateHelper,i.elevationInfo,this.view),l=r.vertices[n-1],c=r.vertices[0],h=r.edges[s-1];let p=h;do this.edgeExceedsShortLineThreshold(p,i)&&(this._checkEdgeForParalleLines(p,l.pos,t,a,i,o),this._checkEdgeForParalleLines(p,c.pos,t,a,i,o)),p=p.leftVertex.leftEdge;while(p&&p!==h);return o}snapExistingVertex(t,i){const r=[],s=i.vertexHandle,n=s.component;if(n.edges.length<3)return r;const o=ga(t,i.coordinateHelper,i.elevationInfo,this.view),a=s.leftEdge,l=s.rightEdge,c=n.vertices[0],h=n.vertices.length,p=n.vertices[h-1],f=n.edges[0];let m=f;do m!==a&&m!==l&&this.edgeExceedsShortLineThreshold(m,i)&&(a&&this._checkEdgeForParalleLines(m,a.leftVertex.pos,t,o,i,r),l&&this._checkEdgeForParalleLines(m,l.rightVertex.pos,t,o,i,r),s===c?this._checkEdgeForParalleLines(m,p.pos,t,o,i,r):s===p&&this._checkEdgeForParalleLines(m,c.pos,t,o,i,r)),m=m.rightVertex.rightEdge;while(m&&m!==f);return r}_checkEdgeForParalleLines(t,i,r,s,n,o){const a=t.leftVertex.pos,l=t.rightVertex.pos;if(IA(this._tmpProjection,i,a,l),ty(this._tmpProjection,i)<Ov.parallelLineThreshold)return;IA(this._tmpProjection,r,a,l,i);const{coordinateHelper:c,elevationInfo:h,pointer:p}=n,f=c.fromXYZ(this._tmpProjection,c.getZ(r,0));if(BS(s,ga(f,c,h,this.view))<this.squaredProximityTreshold(p)){if(this._parallelToPreviousCandidate(t,o))return;o.push(new b$t({coordinateHelper:c,referenceLine:t,lineStart:i,targetPoint:f,elevationInfo:h}))}}_parallelToPreviousCandidate(t,i){const r=t.leftVertex.pos,s=t.rightVertex.pos;for(const n of i)if(IA(this._tmpProjection,s,n.constraint.start,n.constraint.end,r),ty(this._tmpProjection,s)<Ov.parallelLineThreshold)return n.addReferenceLine(t),!0;return!1}}class x$t extends X8{constructor(){super(...arguments),this._tmp=Ke()}snapNewVertex(t,i){const r=i.editGeometryOperations.data.components[0],s=r.vertices.length,n=[];if(s<2)return n;const o=ga(t,i.coordinateHelper,i.elevationInfo,this.view),a=r.vertices[s-1];this._checkForSnappingCandidate(n,a.leftEdge,a.pos,t,a.leftEdge.leftVertex.pos,a.pos,i,t,o);const l=r.vertices[0];return this._checkForSnappingCandidate(n,l.rightEdge,l.pos,t,l.rightEdge.rightVertex.pos,l.pos,i,t,o),n}snapExistingVertex(t,i){const r=[],s=i.vertexHandle,n=s.component,o=n.vertices.length;if(o<3)return r;const a=ga(t,i.coordinateHelper,i.elevationInfo,this.view),l=s.leftEdge,c=s.rightEdge,h=n.vertices[0],p=n.vertices[o-1];if(!l)return this._checkForSnappingCandidate(r,h.rightEdge.rightVertex.rightEdge,h.rightEdge.rightVertex.pos,t,h.rightEdge.rightVertex.rightEdge.rightVertex.pos,h.rightEdge.rightVertex.pos,i,t,a),r;if(!c)return this._checkForSnappingCandidate(r,p.leftEdge.leftVertex.leftEdge,p.leftEdge.leftVertex.pos,t,p.leftEdge.leftVertex.leftEdge.leftVertex.pos,p.leftEdge.leftVertex.pos,i,t,a),r;if(l&&l.leftVertex.leftEdge){const f=l.leftVertex.leftEdge;this._checkForSnappingCandidate(r,f,l.leftVertex.pos,t,f.leftVertex.pos,l.leftVertex.pos,i,t,a)}if(c&&c.rightVertex.rightEdge){const f=c.rightVertex.rightEdge;this._checkForSnappingCandidate(r,f,c.rightVertex.pos,t,f.rightVertex.pos,c.rightVertex.pos,i,t,a)}return r}_checkForSnappingCandidate(t,i,r,s,n,o,a,l,c){if(!this.edgeExceedsShortLineThreshold(i,a))return;Ss(this._tmp,i.rightVertex.pos,i.leftVertex.pos);const h=er(this._tmp[1],-this._tmp[0]),p=ys(h,Ss(this._tmp,s,r))/wS(h),{coordinateHelper:f,elevationInfo:m,pointer:g}=a,y=f.fromXYZ(Fg(Ke(),o,h,p),f.getZ(l,0));BS(c,ga(y,f,m,this.view))<this.squaredProximityTreshold(g)&&t.push(new tLe({coordinateHelper:f,targetPoint:y,constraint:new q8(f,o,Fg(f.createVector(),o,h,Math.sign(p))),previousVertex:n,otherVertex:o,otherVertexType:YM.CENTER,elevationInfo:m}))}}class T$t extends OO{constructor({coordinateHelper:t,targetPoint:i,point1:r,point2:s,elevationInfo:n}){super(t,i,new aD(t,F0(S$t,r,s,.5),.5*a2(r,s)),n),this.p1=r,this.p2=s}get hints(){const t=this.elevationInfo;return[new dm(hm.REFERENCE,this.targetPoint,this.p1,t),new dm(hm.REFERENCE,this.targetPoint,this.p2,t),new Z8(this.p1,this.targetPoint,this.p2,t)]}}const S$t=Ke();class E$t extends X8{snapNewVertex(t,i){const r=i.editGeometryOperations.data.components[0],s=[],n=r.vertices.length;if(i.editGeometryOperations.data.type!=="polygon"||n<2)return s;const o=r.vertices[0],a=r.vertices[n-1];return this._processCandidateProposal(o.pos,a.pos,t,i,s),s}snapExistingVertex(t,i){const r=[],s=i.vertexHandle,n=s.component;return n.edges.length<2||(i.editGeometryOperations.data.type!=="polyline"||s.index!==0&&s.index!==n.vertices.length-1)&&this._processCandidateProposal(s.leftEdge.leftVertex.pos,s.rightEdge.rightVertex.pos,t,i,r),r}_processCandidateProposal(t,i,r,s,n){if(!this.exceedsShortLineThreshold(t,i,s))return;const o=F0(Ke(),t,i,.5),a=.5*a2(t,i),l=Pse(Ke(),r,o,a),{coordinateHelper:c,elevationInfo:h,pointer:p}=s,f=c.fromXYZ(l,c.getZ(r,0)),m=ga(r,c,h,this.view);BS(m,ga(f,c,h,this.view))<this.squaredProximityTreshold(p)&&n.push(new T$t({coordinateHelper:c,targetPoint:f,point1:t,point2:i,elevationInfo:h}))}}let EC=class extends Ee{constructor(e){super(e),this.updating=!1,this._snappers=new nt}initialize(){this._snappers.push(new w$t(this.view,this.options),new _$t(this.view,this.options),new x$t(this.view,this.options),new E$t(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t){if(!this.options.effectiveSelfEnabled)return[];const i=[];for(const r of this._snappers.items)i.push(...r.snap(e,t));return Rse(e,i),i}};u([d({readOnly:!0})],EC.prototype,"updating",void 0),u([d({constructOnly:!0})],EC.prototype,"view",void 0),u([d()],EC.prototype,"options",null),EC=u([L("esri.views.interactive.snapping.SelfSnappingEngine")],EC);function C$t(e,t){return[new EC({view:e,options:t}),new _1({view:e,options:t,spatialReference:e.spatialReference})]}let Hx=class extends Ee{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};u([d({constructOnly:!0})],Hx.prototype,"layer",void 0),u([d()],Hx.prototype,"enabled",void 0),u([d()],Hx.prototype,"updating",void 0),u([d()],Hx.prototype,"availability",void 0),Hx=u([L("esri.views.interactive.snapping.SnappingLayerSource")],Hx);const A$t=Hx;let yh=class extends Ee{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new nt,this.distance=Ov.distance,this.touchSensitivityMultiplier=Ov.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};u([d()],yh.prototype,"enabled",void 0),u([d()],yh.prototype,"enabledToggled",void 0),u([d()],yh.prototype,"selfEnabled",void 0),u([d()],yh.prototype,"featureEnabled",void 0),u([d({type:nt.ofType(A$t)})],yh.prototype,"featureSources",void 0),u([d()],yh.prototype,"distance",void 0),u([d()],yh.prototype,"touchSensitivityMultiplier",void 0),u([d({readOnly:!0})],yh.prototype,"effectiveEnabled",null),u([d({readOnly:!0})],yh.prototype,"effectiveSelfEnabled",null),u([d({readOnly:!0})],yh.prototype,"effectiveFeatureEnabled",null),yh=u([L("esri.views.interactive.snapping.SnappingOptions")],yh);const $se=yh;class Lse extends W8{constructor(t,i){super(i),this.intersectionPoint=t}equals(t){return t instanceof Lse&&em(this.intersectionPoint,t.intersectionPoint)}}class E4 extends OO{constructor(t,i,r,s,n){super(t,i,new MO(t,i,r.constraint,s.constraint),n),this.first=r,this.second=s}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Lse(this.targetPoint,this.elevationInfo)]}}let ug=class extends cs.EventedMixin(yv){constructor(e){super(e),this.options=new $se,this.snappingEnginesFactory=C$t,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}initialize(){this.handles.add([re(()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:r}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:r}},()=>{this.doneSnapping(),this.emit("changed")},Ui),re(()=>this.options,e=>{for(const t of this._engines)t.options=e},Ui),re(()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory}),({viewReady:e,snappingEnginesFactory:t})=>this._recreateEngines(e,t),fi)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:i,options:r}=this;this._engines=t(i,r)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}async snap(e,t,i){const r=t.coordinateHelper.pointToVector(e),s=await this._fetchCandidates(r,t,i);return{get valid(){return!an(i)},apply:()=>{const{snappedPoint:n,hints:o}=this._processCandidates(r,s,t);return this._removeVisualization(),_(t.visualizer)&&this.handles.add(t.visualizer.draw(o,{coordinateHelper:t.coordinateHelper,elevationInfo:t.elevationInfo,view:this.view}),C4),n}}}update(e,t){this._removeVisualization();let i=e;const r=[];if(_(this._currentMainCandidate)){const s=t.coordinateHelper,n=s.pointToVector(e),o=this._currentMainCandidate.constraint.closestTo(n);if(BS(ga(n,s,t.elevationInfo,this.view),ga(o,s,t.elevationInfo,this.view))<this._squaredPointProximityThreshold(t.pointer)){i=s.vectorToDehydratedPoint(o),this._currentMainCandidate.targetPoint=o,r.push(...this._currentMainCandidate.hints);for(const a of this._currentOtherActiveCandidates)a.targetPoint=o,r.push(...a.hints)}else this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}return _(t.visualizer)&&this.handles.add(t.visualizer.draw(r,{coordinateHelper:t.coordinateHelper,elevationInfo:t.elevationInfo,view:this.view}),C4),i}doneSnapping(){this._removeVisualization(),this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}_removeVisualization(){this.handles.remove(C4)}async _fetchCandidates(e,t,i){return(await Promise.all(this._engines.map(r=>r.fetchCandidates(e,t,i)))).flat()}_processCandidates(e,t,i){if(t.length<1)return this.doneSnapping(),{snappedPoint:i.coordinateHelper.vectorToDehydratedPoint(e),hints:[]};Rse(e,t);const r=this._currentMainCandidate;if(_(r)){const s=this._findOldConstraintInNewCandidates(r,t);if(s>=0){if(!(t[s]instanceof E4))return this._intersectWithOtherCandidates(s,t,e,i);if(ty(e,r.targetPoint)<this._squaredPointProximityThreshold(i.pointer))return this._updateSnappingCandidate(r,t,i)}}return this._intersectWithOtherCandidates(0,t,e,i)}_findOldConstraintInNewCandidates(e,t){return e instanceof E4?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,i,r){const s=t[e],n=[],o=r.coordinateHelper;for(let a=0;a<t.length;++a){if(a===e)continue;const l=t[a];for(const c of s.constraint.intersect(l.constraint)){const h=o.fromXYZ(c.intersection,s.targetPoint[2]);n.push([new E4(o,h,s,l,l.elevationInfo),BS(ga(i,r.coordinateHelper,r.elevationInfo,this.view),ga(h,r.coordinateHelper,r.elevationInfo,this.view))])}}return n.length>0&&(n.sort((a,l)=>a[1]-l[1]),n[0][1]<this._squaredPointProximityThreshold(r.pointer))?this._updateSnappingCandidate(n[0][0],t,r):this._updateSnappingCandidate(s,t,r)}_updateSnappingCandidate(e,t,i){this.doneSnapping(),this._currentMainCandidate=e;const r=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const n of t){if(e instanceof E4){if(n.constraint.objectEqual(e.first.constraint)||n.constraint.objectEqual(e.second.constraint))continue}else if(n.constraint.objectEqual(e.constraint))continue;n.constraint.check(r)&&(n.targetPoint=r,this._currentOtherActiveCandidates.push(n),s.push(...n.hints))}return{snappedPoint:i.coordinateHelper.vectorToDehydratedPoint(r),hints:s}}_squaredPointProximityThreshold(e){return e==="touch"?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}_findOldCandidateIndex(e,t){let i=-1;for(let r=0;r<e.length;++r)if(t.constraint.objectEqual(e[r].constraint)){i=r;break}return i}get test(){return{visualizationsActive:this.handles.has(C4),engines:this._engines}}};u([d({constructOnly:!0})],ug.prototype,"view",void 0),u([d()],ug.prototype,"options",void 0),u([d({readOnly:!0})],ug.prototype,"updating",null),u([d()],ug.prototype,"snappingEnginesFactory",void 0),u([d()],ug.prototype,"_engines",void 0),u([d()],ug.prototype,"squaredMouseProximityTreshold",null),u([d()],ug.prototype,"squaredTouchProximityThreshold",null),ug=u([L("esri.views.interactive.snapping.SnappingManager")],ug);const C4="visualization-handle";let Ra=class extends cs.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:this.activeComponent}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent.reset()}refreshComponent(){const e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};u([d()],Ra.prototype,"activeComponent",void 0),u([d()],Ra.prototype,"cancelled",void 0),u([d()],Ra.prototype,"history",void 0),u([d()],Ra.prototype,"tool",null),u([d()],Ra.prototype,"type",void 0),u([d()],Ra.prototype,"canUndo",null),u([d()],Ra.prototype,"canRedo",null),u([d()],Ra.prototype,"onEnd",void 0),u([d()],Ra.prototype,"undo",null),u([d()],Ra.prototype,"redo",null),u([d()],Ra.prototype,"toggleTool",void 0),u([d()],Ra.prototype,"addToSelection",void 0),u([d()],Ra.prototype,"removeFromSelection",void 0),Ra=u([L("esri.widgets.Sketch.support.OperationHandle")],Ra);let LH=class extends Ra{};u([d()],LH.prototype,"activeComponent",void 0),LH=u([L("esri.widgets.Sketch.support.CreateOperationHandle")],LH);let $0=class extends Ra{constructor(e){super(e)}};u([d()],$0.prototype,"activeComponent",void 0),$0=u([L("esri.widgets.Sketch.support.UpdateOperationHandle")],$0);const rLe="esri.widgets.Sketch.SketchViewModel",M$t=ve.getLogger(rLe),Vye={defaultZ:0},A4={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,tool:"transform"};let ps=class extends cs.EventedAccessor{constructor(e){super(e),this._numUpdating=0,this._handles=new Nt,this._internalGraphicsLayer=new w$e({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandles=new Nt,this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.labelOptions=new T$e,this.layer=null,this.pointSymbol=new hl({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new wp({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new dl({color:[130,130,130,1],width:2}),this._snappingManager=null,this.tooltipOptions=new S$e,this.updateGraphics=new nt,this.updateOnGraphicClick=!0,this.updatePointSymbol=new hl({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}}),this.updatePolygonSymbol=new wp({color:[12,207,255,.2],outline:{join:"round",color:[12,207,255],width:2}}),this.updatePolylineSymbol=new dl({color:[12,207,255],width:2}),this.vertexSymbol=new hl({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._originalAutoOpenEnabled=null,this.defaultCreateOptions=Vye,this.defaultUpdateOptions=A4,this.snappingOptions=new $se}initialize(){this._handles.add([os(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.layers},"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),os(()=>{var e;return(e=this.layer)==null?void 0:e.graphics},"change",e=>{if(_(this._operationHandle))for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),re(()=>{var e,t;return(t=(e=this.layer)==null?void 0:e.elevationInfo)!=null?t:null},e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},fi),re(()=>this.view,e=>{We(this._snappingManager),e&&(this._snappingManager=new ug({view:e,options:this.snappingOptions}),e.type==="2d"?import("./editingTools.5af44f62.js"):e.type==="3d"&&(import("./editingTools.3ec37095.js"),import("./GraphicsLayerView3D.79aac1b2.js")))},fi),re(()=>{var e;return(e=this.view)==null?void 0:e.spatialReference},(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})])}destroy(){this.cancel(),this._handles=We(this._handles),this._viewHandles=We(this._viewHandles),this._removeDefaultLayer(),this._snappingManager=We(this._snappingManager),this._set("view",null),this.emit("destroy")}get _defaultUpdateTool(){return this.view.type==="3d"?"move":"transform"}get updating(){return this._numUpdating>0}get activeTool(){return this._operationHandle&&this._operationHandle.tool?this._operationHandle.tool:null}get activeComponent(){return this._operationHandle?this._operationHandle.activeComponent:null}get createGraphic(){return!_(this.activeComponent)||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}set defaultCreateOptions(e){this._set("defaultCreateOptions",F(F({},Vye),e))}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",me(F(F({},A4),e),{reshapeOptions:F(F({},A4.reshapeOptions),e==null?void 0:e.reshapeOptions)}))}set snappingOptions(e){_(this._snappingManager)&&(this._snappingManager.options=e),this._set("snappingOptions",e)}get state(){var i;const e=!(!((i=this.view)==null?void 0:i.ready)||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:r,map:s}=t;r&&(t.cursor=null),s&&s.remove(this._internalGraphicsLayer),this._viewHandles.removeAll(),this.cancel()}const i="view-ready";this._handles.remove(i),e&&this._handles.add(Jn(()=>e.ready,r=>{this._viewHandles.removeAll(),r&&this._viewHandles.add(this._generateViewHandles(e))},fi),i),this._set("view",e)}cancel(){this._moduleLoaderAbortController=Wn(this._moduleLoaderAbortController),this._viewReadyAbortController=Wn(this._viewReadyAbortController),this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if(e==="active"&&t.length){const{activeTool:i,layer:r}=this,s=t.toArray();r.removeMany(s),this.cancel(),this._emitDeleteEvent({graphics:s,tool:i})}}async create(e,t){if(this.cancel(),await this._waitViewReady(),this.state==="disabled")throw this.layer||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),this.view||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),mi();if(_(this.view.activeTool)&&(this.view.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");bye(this.view,this._internalGraphicsLayer);const i=await this._setupCreateOperation(e,t);if(M(i)||this.destroyed)return void this.view.map.remove(this._internalGraphicsLayer);const r=()=>{if(i===this._operationHandle){const s=this.createGraphic,n=this._operationHandle.cancelled;this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),i.cancelled||s==null||this.layer.add(s),this.emit("create",{graphic:s,state:n?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"})}};i.on("complete",r),this._operationHandle=i,this.view.ready&&WEe(this.view)&&this.view.focus()}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:i,view:r,state:s}=this;if(s==="disabled")throw r||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),i||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),mi();_(this.view.activeTool)&&(this.view.activeTool=null);const n=Array.isArray(e)?e:[e];if(e==null||!n||!n.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(n.some(a=>a.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):!!M(a.geometry)&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const o=await this._setupUpdateOperation(n,t);this.destroyed||M(o)||_o(o)||(bye(this.view,this._internalGraphicsLayer),this._setUpdateOperationHandle(o,t),this.emit("update",{graphics:n,state:"start",aborted:!1,tool:o.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){this._beginAsyncOperation(),e=Array.isArray(e)?e:[e];for(const t of e)_(t.geometry)&&t.geometry.type!=="mesh"&&!_a(t.geometry.spatialReference,this.view.spatialReference)&&(Jg(t.geometry.spatialReference,this.view.spatialReference)||fB()||await V3(),t.geometry=Tp(t.geometry,this.view.spatialReference));this._endAsyncOperation()}undo(){this.canUndo()&&this._operationHandle.undo()}redo(){this.canRedo()&&this._operationHandle.redo()}canUndo(){return!(!this._operationHandle||!this._operationHandle.canUndo())}canRedo(){return!(!this._operationHandle||!this._operationHandle.canRedo())}toggleUpdateTool(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()}async _getFirstHit(e){const t=this.view;if(t.type==="2d"){const s=[];this.view.map.allLayers.forEach(o=>{o.type!=="vector-tile"&&o.type!=="imagery"||s.push(o)});const n=await this.view.hitTest(e,{exclude:s});return wOt(n.results)}const i=[this.view.map.ground];t.map.allLayers.forEach(s=>{s.type==="integrated-mesh"&&i.push(s)});const r=await t.hitTest(e,{exclude:i});if(r.results.length>0){const s=r.results[0];if(_(s)&&s.type==="graphic"&&s.graphic&&(!r.ground.mapPoint||t.map.ground.opacity<1||r.ground.distance-Ye(s.distance,0)>-Math.min(3*r.ground.distance,t.viewingMode==="global"?Ri(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return s}return null}_generateViewHandles(e){return[e.on("immediate-click",async t=>{const i=this.state==="active"&&this._operationHandle.type==="create";if(this.state==="disabled"||i||!this.updateOnGraphicClick)return;this._beginAsyncOperation();const r=await t.async(()=>this._getFirstHit(jd(t)));let s=null;if(_(r)){const n=r.graphic;this.updateGraphics.includes(n)||n.layer===this.layer?(t.stopPropagation(),s=n):e.type!=="2d"||this._isComponentGraphic(n)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();_(s)&&!this.updateGraphics.includes(s)&&await this.update([s],me(F({},this.defaultUpdateOptions),{reshapeOptions:F({},this.defaultUpdateOptions.reshapeOptions)})),this._endAsyncOperation()},ts.WIDGET)]}async _setupCreateOperation(e,t){const i=F(F({hasZ:this.view.type==="3d"},this.defaultCreateOptions),t),r=await this._setupDrawGraphicTool(e,this.view,i);return M(r)?null:(this.view.tools.add(r),this.view.activeTool=r,this._setupCreateOperationHandle(r))}async _setupDrawGraphicTool(e,t,i){if(e==="multipoint"&&t.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;const r=e!=="rectangle",s=e!=="rectangle";this.snappingOptions.enabledToggled=!1;const n=me(F({view:t,mode:e==="rectangle"||e==="circle"?"hybrid":"click"},i),{snapToScene:!1,geometryType:e,graphicSymbol:this._getGraphicSymbolFromTool(e),snappingManager:this._snappingManager,forceUniformSize:s,centered:r});return this.view.type==="2d"?this._makeDrawGraphicTool2D(n):this._makeDrawGraphicTool3D(n)}async _makeDrawGraphicTool2D(e){const t=await this._requireModule(import("./editingTools.5af44f62.js"));return _o(t)||this.destroyed?null:new t.module.DrawGraphicTool2D(me(F({},e),{activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:O$t(e.geometryType)?this.activeFillSymbol:null}))}async _makeDrawGraphicTool3D(e){const t=await this._requireModule(import("./editingTools.3ec37095.js"));if(_o(t)||this.destroyed)return null;const{elevationInfo:i}=this.layer;return new t.module.DrawGraphicTool3D(me(F({},e),{elevationInfo:i,snapToScene:!_(i)||i.mode==="absolute-height",labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions}))}_setupCreateOperationHandle(e){let t=null;const i=e.forceUniformSize,r=e.centered,s=[this.view.on("key-down",o=>{if(o.key===Qr.pan)o.stopPropagation(),o.repeat||(e.enabled=!1);else if(o.key===Qr.complete)o.stopPropagation(),e.completeCreateOperation();else if(o.key!==Qr.vertexAdd||o.repeat)o.key===Qr.undo?(o.stopPropagation(),n.undo()):o.key===Qr.redo?(o.stopPropagation(),n.redo()):o.key!==Qr.snappingToggle||e.geometryType==="rectangle"||e.geometryType==="circle"||o.repeat?o.key!==Qr.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"||o.repeat?o.key===Qr.center&&(o.repeat||(e.centered=!r,o.stopPropagation())):(e.forceUniformSize=!i,o.stopPropagation()):(this.snappingOptions.enabledToggled=!0,o.stopPropagation());else{const a=e.drawOperation.geometryType;a!=="polyline"&&a!=="polygon"&&a!=="multipoint"||(o.stopPropagation(),e.drawOperation.commitStagedVertex())}},ts.WIDGET),this.view.on("key-up",o=>{o.key===Qr.pan?e.enabled=!0:o.key===Qr.snappingToggle&&e.geometryType!=="rectangle"&&e.geometryType!=="circle"?(this.snappingOptions.enabledToggled=!1,o.stopPropagation()):o.key!==Qr.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"?o.key===Qr.center&&(e.centered=r,o.stopPropagation()):(e.forceUniformSize=i,o.stopPropagation())},ts.WIDGET),e.on("vertex-add",o=>{switch(t=M(t)?"start":"active",o.operation){case"apply":this.emit("create",{graphic:e.graphic,state:t,tool:this.activeTool,toolEventInfo:o,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",o=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:o.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",o=>{switch(o.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:o,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",o=>{this._set("createGraphic",o.graphic),t="complete",o.aborted?n&&n.cancel():n&&n.complete()}),re(()=>this._getGraphicSymbolFromTool(e.geometryType),o=>{e.graphicSymbol=o})],n=new Ra({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{var o;s.forEach(a=>a.remove()),s.length=0,(o=this.view.tools)==null||o.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return n}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":return this.polygonSymbol;default:return null}}async _setupUpdateOperation(e,t){const{layer:i,view:r}=this,s=me(F(F({tool:this._defaultUpdateTool},this.defaultUpdateOptions),t),{reshapeOptions:F(F({},this.defaultUpdateOptions.reshapeOptions),t==null?void 0:t.reshapeOptions)});let n=s.tool;for(const o of e)i.remove(o),i.add(o);if(r.type==="3d"){if(e.length===0)return null;switch(n){case"move":return this._setupMove3DOperation(e,s,r,n);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const o=T4(e[0]);return o===Hr.SUPPORTED?this._setupReshape3DOperation(e[0],s,r):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${AH(o)}).`),null)}case"transform":return this._setupGraphicTransform3DOperation(e,s,r)}}switch(n){case"move":return this._setupMove2DOperation(e,s,r);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const o=T4(e[0]);return o===Hr.SUPPORTED?this._setupTransformOrReshape2DOperation(e,n,s,r):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${AH(o)}).`),null)}case"transform":if(e.length===1){const o=Wr(e[0].geometry,"type");o!=="point"&&o!=="multipoint"||(n="reshape")}return this._setupTransformOrReshape2DOperation(e,n,s,r)}}async _setupMove3DOperation(e,t,i,r,s=!1){for(const c of e){const h=BIt(c);if(h!==Hr.SUPPORTED)return this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${AH(h)}).`),null}const n=await this._requireModule(import("./editingTools.3ec37095.js"));if(_o(n))return n;const o=new n.module.GraphicMoveTool({view:i,enableZ:t.enableZ,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});this.view.tools.add(o),o.graphics.addMany(e),s||this.updateGraphics.addMany(e);const a=[],l=new $0({activeComponent:o,tool:r,type:"update",onEnd:()=>{var c;a.forEach(h=>h.remove()),a.length=0,(c=this.view.tools)==null||c.remove(o),o.destroyed||o.destroy()},undo:()=>{M4(l,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{O4(l,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:c=>{this.updateGraphics.push(c),o.graphics.push(c),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[c],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:c=>{const h=this.updateGraphics.indexOf(c);l.history.undo.forEach(p=>p.updates.splice(h,1)),l.history.redo.forEach(p=>p.updates.splice(h,1)),this.updateGraphics.remove(c),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[c],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?o.graphics.remove(c):l.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1||r!=="transform")return;const c=this.updateGraphics.getItemAt(0);if(T4(c)!==Hr.SUPPORTED)return;const h=await this._setupReshape3DOperation(c,t,i,!0);_o(h)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(h,t))}});return a.push(...this._getHandlesForComponent(l,t),this.view.on("immediate-click",c=>this._getCommonUpdateOperationClickHandlers(l,c,t),ts.WIDGET),i.on("key-down",c=>{this._getCommonUpdateOperationKeyDownHandlers(l,c),c.key===Qr.snappingToggle&&(this.snappingOptions.enabledToggled=!0,c.stopPropagation())},ts.WIDGET),i.on("key-up",c=>{c.key===Qr.snappingToggle&&(this.snappingOptions.enabledToggled=!1,c.stopPropagation())},ts.WIDGET)),l}_setupGraphicTransform3DOperation(e,t,i,r=!1){if(e.length===1&&jIt(e[0])===Hr.SUPPORTED){const s=e[0],n=s.geometry;if(_(n)&&(n.type==="point"||n.type==="mesh"))return this._setupPointTransform3DOperation(s,t,i);if(_(n)&&(n.type==="polygon"||n.type==="polyline"))return this._setupPolyTransform3DOperation(s,t,i,r)}return this._setupMove3DOperation(e,t,i,"transform",r)}async _setupPointTransform3DOperation(e,t,i){const r="transform",{enableRotation:s,enableScaling:n,enableZ:o}=t,a=await this._requireModule(import("./editingTools.3ec37095.js"));if(_o(a))return a;const l=new a.module.GraphicTransformTool({graphic:e,view:i,enableRotation:s,enableScaling:n,enableZ:o,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});this.view.tools.add(l),this.updateGraphics.add(e);const c=[],h=new $0({activeComponent:l,tool:r,type:"update",onEnd:()=>{var p;c.forEach(f=>f.remove()),c.length=0,(p=this.view.tools)==null||p.remove(l),l.destroyed||l.destroy()},undo:()=>{M4(h,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{O4(h,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:async p=>{this.updateGraphics.add(p),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[p],removed:[],type:"selection-change"},type:"update"});const f=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);_o(f)||(h.onEnd(),h.destroy(),this._setUpdateOperationHandle(f,t))},removeFromSelection:p=>{this.updateGraphics.remove(p),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[p],type:"selection-change"},type:"update"}),h.complete()},toggleTool:()=>{}});return c.push(...this._getHandlesForComponent(h,t),this.view.on("immediate-click",p=>this._getCommonUpdateOperationClickHandlers(h,p,t),ts.WIDGET),i.on("key-down",p=>{this._getCommonUpdateOperationKeyDownHandlers(h,p),p.key===Qr.snappingToggle&&(this.snappingOptions.enabledToggled=!0,p.stopPropagation())},ts.WIDGET),i.on("key-up",p=>{p.key===Qr.snappingToggle&&(this.snappingOptions.enabledToggled=!1,p.stopPropagation())},ts.WIDGET)),h}async _setupPolyTransform3DOperation(e,t,i,r=!1){const s="transform",{enableRotation:n,enableScaling:o,enableZ:a,preserveAspectRatio:l}=t,c=await this._requireModule(import("./editingTools.3ec37095.js"));if(_o(c))return c;const h=new c.module.ExtentTransformTool({graphic:e,view:i,enableRotation:n,enableScaling:o,enableZ:a,preserveAspectRatio:l,tooltipOptions:this.tooltipOptions});this.view.tools.add(h),r||this.updateGraphics.add(e);const p=[],f=new $0({activeComponent:h,tool:s,type:"update",onEnd:()=>{var m;p.forEach(g=>g.remove()),p.length=0,(m=this.view.tools)==null||m.remove(h),h.destroyed||h.destroy()},canUndo:()=>h.canUndo,undo:()=>{h.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s})},canRedo:()=>h.canRedo,redo:()=>{h.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s})},addToSelection:async m=>{this.updateGraphics.add(m),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[m],removed:[],type:"selection-change"},type:"update"});const g=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);_o(g)||(f.onEnd(),f.destroy(),this._setUpdateOperationHandle(g,t))},removeFromSelection:m=>{this.updateGraphics.remove(m),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[m],type:"selection-change"},type:"update"}),f.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1)return;const m=this.updateGraphics.getItemAt(0);if(T4(m)!==Hr.SUPPORTED)return;const g=await this._setupReshape3DOperation(m,t,i,!0);_o(g)||(f.onEnd(),f.destroy(),this._setUpdateOperationHandle(g,t))}});return p.push(...this._getHandlesForComponent(f,t),this.view.on("immediate-click",m=>this._getCommonUpdateOperationClickHandlers(f,m,t),ts.WIDGET),this.view.on("key-down",m=>this._getCommonUpdateOperationKeyDownHandlers(f,m),ts.WIDGET),this.view.on("key-down",m=>{m.key!==Qr.constraint||m.repeat||(h.preserveAspectRatio=!h.preserveAspectRatio,m.stopPropagation())},ts.WIDGET),this.view.on("key-up",m=>{m.key===Qr.constraint&&(h.preserveAspectRatio=!h.preserveAspectRatio,m.stopPropagation())},ts.WIDGET)),f}async _setupMove2DOperation(e,t,i){const r="move";this.updateGraphics.addMany(e),await this._updateSpatialReference(e);const s=await this._getGraphicMover(e,t,i);if(_o(s))return s;const n=new $0({activeComponent:s,tool:r,type:"update",onEnd:()=>{var c;this._displayDefaultCursor(),l.forEach(h=>h.remove()),a.forEach(h=>h.remove()),l=[],a=[],s.destroy(),(c=this._internalGraphicsLayer)==null||c.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const c=this.updateGraphics.toArray();M4(n,c),n.refreshComponent(),this._emitUndoEvent({graphics:c,tool:r})},redo:()=>{const c=this.updateGraphics.toArray();O4(n,c),n.refreshComponent(),this._emitRedoEvent({graphics:c,tool:r})},addToSelection:async c=>{await this._updateSpatialReference(c),this.updateGraphics.push(c),s.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[c],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:c=>{const h=this.updateGraphics.indexOf(c);n.history.undo.forEach(f=>f.updates.splice(h,1)),n.history.redo.forEach(f=>f.updates.splice(h,1)),this.updateGraphics.remove(c);const p=this.updateGraphics.toArray();this.emit("update",{graphics:p,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[c],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?s.graphics=p:n.complete()}});let o=!1,a=[i.on("immediate-click",c=>this._getCommonUpdateOperationClickHandlers(n,c,t),ts.WIDGET),i.on("key-down",c=>{this._getCommonUpdateOperationKeyDownHandlers(n,c),c.key!==Qr.constraint||c.repeat||(o=!0,s.enableMoveAllGraphics=!s.enableMoveAllGraphics)},ts.WIDGET),i.on("key-up",c=>{c.key===Qr.constraint&&o&&(o=!1,s.enableMoveAllGraphics=!s.enableMoveAllGraphics)},ts.WIDGET)],l=this._getHandlesForComponent(n,t);return n}async _setupReshape3DOperation(e,t,i,r=!1){const s="reshape",n=await this._requireModule(import("./editingTools.3ec37095.js"));if(_o(n))return n;this.snappingOptions.enabledToggled=!1;const o=new n.module.GraphicReshapeTool({view:i,graphic:e,enableZVertex:t.enableZ&&t.reshapeOptions.vertexOperation==="move",enableZShape:t.enableZ&&t.reshapeOptions.shapeOperation==="move",enableMoveGraphic:t.reshapeOptions.shapeOperation==="move"||t.reshapeOptions.shapeOperation==="move-xy",enableMidpoints:t.reshapeOptions.edgeOperation==="split",enableEdgeOffset:t.reshapeOptions.edgeOperation==="offset",snappingManager:this._snappingManager,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions});i.tools.add(o),r||this.updateGraphics.add(e);const a=[],l=new $0({activeComponent:o,tool:s,type:"update",onEnd:()=>{var c;a.forEach(h=>h.remove()),a.length=0,(c=this.view.tools)==null||c.remove(o),o.destroyed||o.destroy()},canUndo:()=>o.canUndo,undo:()=>{o.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s})},canRedo:()=>o.canRedo,redo:()=>{o.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s})},addToSelection:async c=>{this.updateGraphics.add(c),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[c],removed:[],type:"selection-change"},type:"update"});const h=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);_o(h)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(h,t))},removeFromSelection:c=>{this.updateGraphics.remove(c),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[c],type:"selection-change"},type:"update"}),l.complete()},toggleTool:async()=>{if(t.toggleToolOnClick===!1)return;const c=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,i,!0);_o(c)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(c,t))}});return a.push(...this._getHandlesForComponent(l,t),i.on("immediate-click",c=>this._getCommonUpdateOperationClickHandlers(l,c,t),ts.WIDGET),i.on("key-down",c=>{this._getCommonUpdateOperationKeyDownHandlers(l,c),c.key===Qr.snappingToggle&&(this.snappingOptions.enabledToggled=!0,c.stopPropagation())},ts.WIDGET),i.on("key-up",c=>{c.key===Qr.snappingToggle&&(this.snappingOptions.enabledToggled=!1,c.stopPropagation())},ts.WIDGET)),l}async _setupTransformOrReshape2DOperation(e,t,i,r){this.updateGraphics.addMany(e),await this._updateSpatialReference(e);const s=t==="transform"?await this._getBox(e,i,r):await this._getReshape(e,i,r);if(_o(s))return s;const n=new $0({activeComponent:s,type:"update",onEnd:()=>{a.forEach(l=>l.remove()),o.forEach(l=>l.remove()),a=[],o=[],n.activeComponent&&!n.activeComponent.destroyed&&n.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{M4(n,this.updateGraphics.toArray()),n.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n.tool})},redo:()=>{O4(n,this.updateGraphics.toArray()),n.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n.tool})},addToSelection:async l=>{let c=n.activeComponent;if(c.type==="reshape"){const h=[...this.updateGraphics,l];this.updateGraphics.removeAll();const p=await this._setupMove2DOperation(h,i,r);if(_o(p))return;n.onEnd(),n.destroy(),this._setUpdateOperationHandle(p,i)}else this.updateGraphics.add(l),c.graphics=this.updateGraphics.toArray(),c.refresh(),n.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[l],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async l=>{const c=this.updateGraphics.indexOf(l);n.history.undo.forEach(p=>p.updates.splice(c,1)),n.history.redo.forEach(p=>p.updates.splice(c,1)),this.updateGraphics.remove(l);const h=this.updateGraphics.toArray();if(h.length===0)n.complete();else{const p=h[0].geometry;h.length!==1||!_(p)||p.type!=="point"&&p.type!=="multipoint"?n.activeComponent.graphics=h:n.toggleTool()}this.emit("update",{graphics:h,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const l=this.updateGraphics.getItemAt(0),c=l.geometry;if(_(c)&&(n.tool==="reshape"&&(c.type==="point"||c.type==="multipoint")||n.tool==="transform"&&c.type==="extent"))return;let h=null;n.tool==="transform"?h=await this._getReshape([l],i,r):n.tool==="reshape"&&(h=await this._getBox([l],i,r)),_o(h)||(n.activeComponent.destroy(),n.activeComponent=h,n.activeComponent&&(a.forEach(p=>p.remove()),a=this._getHandlesForComponent(n,i)))}});let o=[r.on("immediate-click",l=>this._getCommonUpdateOperationClickHandlers(n,l,i),ts.WIDGET),r.on("key-down",l=>{if(this._getCommonUpdateOperationKeyDownHandlers(n,l),l.key!==Qr.snappingToggle||l.repeat||(this.snappingOptions.enabledToggled=!0,l.stopPropagation()),l.key===Qr.constraint&&!l.repeat&&n){const c=n.activeComponent;c&&c.type==="box"&&(c.preserveAspectRatio=!c.preserveAspectRatio)}},ts.WIDGET),r.on("key-up",l=>{var c;if(l.key===Qr.snappingToggle&&((c=n==null?void 0:n.activeComponent)==null?void 0:c.type)==="reshape"&&(this.snappingOptions.enabledToggled=!1,l.stopPropagation()),l.key===Qr.constraint&&n){const h=n.activeComponent;h&&h.type==="box"&&(h.preserveAspectRatio=!h.preserveAspectRatio)}},ts.WIDGET)],a=this._getHandlesForComponent(n,i);return n}async _getGraphicMover(e,t,i){const{enableMoveAllGraphics:r}=t,s=await this._requireModule(import("./GraphicMover.3b6abcc4.js").then(function(n){return n.G}));return _o(s)?s:new s.module.default({enableMoveAllGraphics:r,highlightsEnabled:!0,indicatorsEnabled:!1,graphics:e,view:i,callbacks:{onGraphicMoveStart:({dx:n,dy:o,graphic:a})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n,dy:o,mover:a,type:"move-start"},type:"update"})},onGraphicMove:({dx:n,dy:o,graphic:a})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n,dy:o,mover:a,type:"move"},type:"update"}),onGraphicMoveStop:({dx:n,dy:o,graphic:a})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n,dy:o,mover:a,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,i){const{enableRotation:r,enableScaling:s,preserveAspectRatio:n}=t,o=await this._requireModule(import("./Box.4646e17e.js"));return _o(o)?o:new o.module.default({graphics:e,enableRotation:r,enableScaling:s,preserveAspectRatio:n,layer:this._internalGraphicsLayer,view:i,callbacks:{onMoveStart:a=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:F({},a),type:"update"}),onMove:a=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:F({},a),type:"update"}),onMoveStop:a=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:F({},a),type:"update"}),onScaleStart:a=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:F({},a),type:"update"}),onScale:a=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:F({},a),type:"update"}),onScaleStop:a=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:F({},a),type:"update"}),onRotateStart:a=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:F({},a),type:"update"}),onRotate:a=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:F({},a),type:"update"}),onRotateStop:a=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:F({},a),type:"update"})}})}async _getReshape(e,t,i){var o,a;const r=((o=t.reshapeOptions)==null?void 0:o.edgeOperation)==="split",s=((a=t.reshapeOptions)==null?void 0:a.shapeOperation)==="move",n=await this._requireModule(import("./Reshape.e905cf3d.js"));return _o(n)?n:new n.module.default({enableMidpoints:r,enableMovement:s,graphic:e[0],layer:this._internalGraphicsLayer,snappingManager:this._snappingManager,view:i,callbacks:{onReshapeStart:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:F({},l),type:"update"}),onReshape:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:F({},l),type:"update"}),onReshapeStop:({mover:l,type:c})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:l,type:c},type:"update"}),onMoveStart:({dx:l,dy:c,mover:h,type:p})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:c,mover:h,type:p},type:"update"}),onMove:({dx:l,dy:c,mover:h,type:p})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:c,mover:h,type:p},type:"update"}),onMoveStop:({dx:l,dy:c,mover:h,type:p})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:c,mover:h,type:p},type:"update"}),onVertexAdd:({added:l,type:c,vertices:h})=>{const p=l.map(f=>foe(f.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:p,vertices:h,type:c},type:"update"})},onVertexRemove:({removed:l,type:c,vertices:h})=>{const p=l.map(f=>foe(f.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:p,vertices:h,type:c},type:"update"})}}})}_getHandlesForComponent(e,t){const i=e.activeComponent;switch(i.type){case"graphic-mover":return[i.on("graphic-click",({graphic:r,viewEvent:s})=>{var n;((n=s.native)==null?void 0:n.shiftKey)&&(s.stopPropagation(),e.removeFromSelection(r))}),i.on("graphic-move-start",r=>e.addToHistory(Gy(r.allGraphics)))];case"box":return[i.on("graphic-click",r=>this._onTransformOrReshape2DGraphicClick(e,t,r)),i.on("move-start",r=>e.addToHistory(Gy(r.graphics))),i.on("rotate-start",r=>e.addToHistory(Gy(r.graphics))),i.on("scale-start",r=>e.addToHistory(Gy(r.graphics)))];case"reshape":return[i.on("graphic-click",r=>this._onTransformOrReshape2DGraphicClick(e,t,r)),i.on("move-start",r=>e.addToHistory(Gy([r.mover]))),i.on("reshape-start",r=>e.addToHistory(Gy([r.graphic]))),i.on("vertex-add",r=>e.addToHistory(Gy([r.oldGraphic]))),i.on("vertex-remove",r=>e.addToHistory(Gy([r.oldGraphic])))];case"move-3d":return[i.on("graphic-move-start",r=>{e.addToHistory(Gy(r.allGraphics)),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:r.allGraphics.length>0?r.allGraphics[0]:null,type:"move-start"},type:"update"})}),i.on("graphic-move",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:r.dx,dy:r.dy,mover:r.allGraphics.length>0?r.allGraphics[0]:null,type:"move"},type:"update"})}),i.on("graphic-move-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:r.allGraphics.length>0?r.allGraphics[0]:null,type:"move-stop"},type:"update"})}),i.on("immediate-click",r=>{r.shiftKey?this._toggleSelection([r.graphic],e,t):e.toggleTool()})];case"transform-3d":return[i.on("record-undo",({record:r})=>{e.addToHistory({updates:[r]})}),i.on("graphic-translate-start",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,dx:r.dxScreen,dy:r.dyScreen,type:"move-start"},type:"update"})}),i.on("graphic-translate-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,dx:r.dxScreen,dy:r.dyScreen,type:"move-stop"},type:"update"})}),i.on("graphic-rotate-start",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,angle:r.angle,type:"rotate-start"},type:"update"})}),i.on("graphic-rotate-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,angle:r.angle,type:"rotate-stop"},type:"update"})}),i.on("graphic-scale-start",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,xScale:r.xScale,yScale:r.yScale,type:"scale-start"},type:"update"})}),i.on("graphic-scale-stop",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,xScale:r.xScale,yScale:r.yScale,type:"scale-stop"},type:"update"})}),i.on("graphic-translate",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,dx:r.dxScreen,dy:r.dyScreen,type:"move"},type:"update"})}),i.on("graphic-rotate",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,angle:r.angle,type:"rotate"},type:"update"})}),i.on("graphic-scale",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r.graphic,xScale:r.xScale,yScale:r.yScale,type:"scale"},type:"update"})}),i.on("immediate-click",r=>{r.shiftKey?this._toggleSelection([r.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[i.on("reshape",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:r,type:"update"})}),i.on("move",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:r,type:"update"})}),i.on("vertex-add",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:r,type:"update"})}),i.on("vertex-remove",r=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:r,type:"update"})}),i.on("immediate-click",r=>{r.shiftKey?this._toggleSelection([r.graphic],e,t):e.toggleTool()})];default:return}}_onTransformOrReshape2DGraphicClick(e,t,i){var n;const{graphic:r,viewEvent:s}=i;return((n=s.native)==null?void 0:n.shiftKey)&&r.layer===this.layer?(s.stopPropagation(),e.removeFromSelection(r)):t.toggleToolOnClick?(s.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const i=this.view.map;this._disablePopup(t);const r=()=>{if(e===this._operationHandle){const s=this.updateGraphics.toArray(),n=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:s,state:"complete",aborted:e.cancelled,tool:n,toolEventInfo:null,type:"update"})}};e.on("complete",r)}async _getCommonUpdateOperationClickHandlers(e,t,i){const r=jd(t),s=await t.async(()=>this._getFirstHit(r));if(M(s))return void e.complete();if(t.native.shiftKey&&this._toggleSelection([s.graphic],e,i))return void t.stopPropagation();this.updateGraphics.includes(s.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,i){const r=!!i.multipleSelectionEnabled;return e.some(s=>s!=null&&!(!r||s.layer!==this.layer)&&(this.updateGraphics.includes(s)?t.removeFromSelection(s):t.addToSelection(s),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const i=t.key;i===Qr.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):i===Qr.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):i===Qr.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&Qr.delete.includes(i)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||this._operationHandle.type!=="update")return;const t=this.activeComponent,i=this.updateGraphics.toArray();M(t)||t.type==="reshape-3d"||(t.type!=="reshape"||i.length===1&&Wr(i[0].geometry,"type")==="point")&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=We(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||M(t))&&(e.attributes&&e.attributes.esriSketchTool||t.type==="draw-2d"&&t.graphic===e||(t.type==="box"||t.type==="reshape")&&t.isUIGraphic(e))}_displayPointerCursor(){this.view&&this.view.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view&&this.view.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view&&this.view.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(e,t,i){M$t.error(new W(e,t,i))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const i=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(e){this.emit("undo",me(F({},e),{type:"undo"}))}_emitRedoEvent(e){this.emit("redo",me(F({},e),{type:"redo"}))}_emitDeleteEvent(e){this.emit("delete",me(F({},e),{type:"delete"}))}get test(){return{operationHandle:this._operationHandle,defaultUpdateOptions:A4}}wait(){return gv(()=>!this.updating)}_beginAsyncOperation(){this._numUpdating+=1,this.notifyChange("updating")}_endAsyncOperation(){this._numUpdating-=1,this.notifyChange("updating")}_disablePopupEnabled(e){var t;return((t=this.view)==null?void 0:t.type)!=="3d"||this.updateOnGraphicClick||_(e)&&e.toggleToolOnClick}_disablePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&M(this._originalAutoOpenEnabled)&&(this._originalAutoOpenEnabled=t.autoOpenEnabled,t.autoOpenEnabled=!1)}_restorePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&_(this._originalAutoOpenEnabled)&&(t.autoOpenEnabled=this._originalAutoOpenEnabled,this._originalAutoOpenEnabled=null)}async _waitViewReady(){const e=this.view;e&&(Wn(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await VT(gv(()=>e==null?void 0:e.ready),this._viewReadyAbortController.signal))}};function O$t(e){return e==="polygon"||e==="rectangle"||e==="circle"}function M4(e,t){sLe("undo",e.history.undo,e.history.redo,t)}function O4(e,t){sLe("redo",e.history.redo,e.history.undo,t)}function sLe(e,t,i,r){const s=t.pop().updates,n=[];r.forEach((o,a)=>{const l=s[a];l!=null&&("geometry"in l&&_(l.geometry)&&(n.push({geometry:o.geometry}),o.geometry=l.geometry),"symbol"in l&&_(l.symbol)&&(n.push({symbol:o.symbol}),o.symbol=l.symbol),"undo"in l&&(n.push(l),l[e](o)))}),i.push({updates:n})}function Gy(e){return{updates:e.map(t=>({geometry:t.geometry}))}}function _o(e){return"requireError"in e&&e.requireError==="aborted"}u([d()],ps.prototype,"updating",null),u([d()],ps.prototype,"_operationHandle",void 0),u([d({readOnly:!0})],ps.prototype,"activeTool",null),u([d()],ps.prototype,"activeFillSymbol",void 0),u([d()],ps.prototype,"activeLineSymbol",void 0),u([d()],ps.prototype,"activeVertexSymbol",void 0),u([d()],ps.prototype,"allowDeleteKey",void 0),u([d({readOnly:!0})],ps.prototype,"createGraphic",null),u([d()],ps.prototype,"defaultCreateOptions",null),u([d()],ps.prototype,"defaultUpdateOptions",null),u([d({type:T$e,nonNullable:!0})],ps.prototype,"labelOptions",void 0),u([d()],ps.prototype,"layer",void 0),u([d({types:bu})],ps.prototype,"pointSymbol",void 0),u([d({types:bu})],ps.prototype,"polygonSymbol",void 0),u([d({types:bu})],ps.prototype,"polylineSymbol",void 0),u([d({type:$se,nonNullable:!0})],ps.prototype,"snappingOptions",null),u([d()],ps.prototype,"_snappingManager",void 0),u([d({readOnly:!0})],ps.prototype,"state",null),u([d({type:S$e,nonNullable:!0})],ps.prototype,"tooltipOptions",void 0),u([d({readOnly:!0})],ps.prototype,"updateGraphics",void 0),u([d()],ps.prototype,"updateOnGraphicClick",void 0),u([d({types:bu})],ps.prototype,"updatePointSymbol",void 0),u([d({types:bu})],ps.prototype,"updatePolygonSymbol",void 0),u([d({types:bu})],ps.prototype,"updatePolylineSymbol",void 0),u([d({types:bu})],ps.prototype,"vertexSymbol",void 0),u([d({value:null})],ps.prototype,"view",null),ps=u([L(rLe)],ps);const R$t=ps;var fs,Th;function P$t(e){return e==="2d"?new XS({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5,color:[0,0,0,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5,color:[255,255,255,255]}]}}}):new dl({color:[0,0,0,0]})}(function(e){e.Ready="ready",e.Creating="creating",e.Reshaping="reshaping",e.ReshapingDisabled="rehsaping-disabled",e.Selecting="selecting",e.Selected="selected"})(fs||(fs={})),function(e){e.View="view",e.Main="main",e.Interaction="interaction"}(Th||(Th={}));let vh=class extends Ee{constructor(e){super(e),this.state=fs.Ready,this._handles=new Nt,this._pendingStartOptions=null,this._previousInputInfo=null,this._shouldRemoveLastPoint=!1,this._sketchedGraphics=new WeakSet,this._creationToolPromise=null,this._updateToolPromise=null,this._updateDisabled=!1}initialize(){this._handles.add(re(()=>({view:this.tool.viewModel.view,visible:this.tool.visible}),({view:e,visible:t})=>{_(e)&&t?this._attach(e):this._detach()},fi),Th.View)}destroy(){this._detach(),this._handles=We(this._handles)}get canStopCreating(){const e=this._geometry,t=this._shouldRemoveLastPoint?3:2;return nD(e)&&e.paths.length>0&&e.paths[0].length>=t}get _input(){return this.tool.viewModel.input}set _input(e){this.tool.viewModel.input=e}get _geometry(){return wt(this._input,e=>e.geometry)}get _visibleAndEditable(){return this.tool.visible&&this.tool.editable}get _view(){return this.tool.viewModel.view}get test(){return{sketchVM:this._sketchVM,toolPromise:Promise.all([Ye(this._creationToolPromise,Promise.resolve()),Ye(this._updateToolPromise,Promise.resolve())])}}start(e={mode:"sketch"}){if(!this.tool.editable)return;const t=this._view;if(!M(t)&&t.ready)switch(this._pendingStartOptions=null,this._stopInteraction(),M(this._previousInputInfo)&&this._storePreviousInput(this._input),this._setSketchedGraphic(null),e.mode){case"sketch":this._set("state",fs.Creating),this._startCreationInteraction();break;case"select":this._set("state",fs.Selecting),this._startSelectionInteraction()}else this._pendingStartOptions=e}stop(){this._pendingStartOptions=null,this._stopInteractionAndUpdate(),this._clearPreviousInput()}cancel(){this._pendingStartOptions=null,this._stopInteractionAndUpdate(),this._restorePreviousInput()}clear(){this._stopInteractionAndUpdate(),this._set("state",fs.Ready),this._clearPreviousInput(),this._input=null,this._pendingStartOptions=null}isSketchedGraphic(e){return _(e)&&this._sketchedGraphics.has(e)}_attach(e){this._detach();const t={mode:e.type==="3d"?"relative-to-ground":"on-the-ground",offset:null};this._graphicsLayer=new w$e({listMode:"hide",internal:!0,elevationInfo:t});const i=P$t(e.type);this._sketchVM=new R$t({layer:this._graphicsLayer,view:e,defaultCreateOptions:{mode:"click",hasZ:!1},updateOnGraphicClick:!1,defaultUpdateOptions:{reshapeOptions:{shapeOperation:"none"},enableRotation:!1,enableScaling:!1,enableMoveAllGraphics:!1,enableZ:!1,multipleSelectionEnabled:!1,toggleToolOnClick:!1,tool:"reshape"},polylineSymbol:i,updatePolylineSymbol:i,activeLineSymbol:i}),this._handles.add([Jn(()=>e.ready,()=>wt(this._pendingStartOptions,r=>this.start(r)),fi),re(()=>[this._input,this._visibleAndEditable],()=>this._update(),fi),re(()=>({map:e.map,graphicsLayer:this._graphicsLayer}),({map:r,graphicsLayer:s})=>{_(r)&&_(s)&&r.add(s),this._update()},fi)],Th.Main)}_detach(){this._handles.remove(Th.Main),this._sketchVM=We(this._sketchVM),this._creationToolPromise=null,this._updateToolPromise=null;const e=wt(this._view,i=>i.map),t=this._graphicsLayer;_(e)&&_(t)&&e.remove(t),this._graphicsLayer=We(this._graphicsLayer),this._shouldRemoveLastPoint=!1,this._set("state",fs.Ready)}_startCreationInteraction(){this._stopInteractionAndUpdate();const e=this._view,t=this._sketchVM;if(M(e)||M(t))return;this._shouldRemoveLastPoint=!1;const i=t.on("create",s=>{const n=s.graphic;switch(s.state){case"complete":this._shouldRemoveLastPoint=!1,this._setSketchedGraphic(n),this._stopInteractionAndUpdate(),this._clearPreviousInput();break;case"cancel":this.cancel();break;case"active":this._setSketchedGraphic(n),s.toolEventInfo.type==="cursor-update"&&(this._shouldRemoveLastPoint=!0);break;case"start":this._setSketchedGraphic(n)}}),r=()=>{i.remove();const s=this.canStopCreating,n=wt(this._geometry,o=>o.clone());t.cancel(),this._creationToolPromise=null,!M(n)&&s?this._shouldRemoveLastPoint&&this._setSketchedGraphic(new Ha({geometry:I$t(n)})):this._input=null};this._handles.remove(Th.Interaction),this._handles.add(Fo(r),Th.Interaction),this._creationToolPromise=VA(t.create("polyline"))}_startReshapeInteraction(){this._stopInteraction();const e=this._view,t=this._sketchVM;if(M(e)||M(t))return;const i=t.on("update",s=>{const n=s.graphics[0];switch(s.state){case"complete":this._setSketchedGraphic(n),this._stopInteractionAndUpdate(),this._clearPreviousInput();break;case"active":case"start":this._setSketchedGraphic(n)}}),r=()=>{i.remove(),t.cancel(),this._updateToolPromise=null};this._handles.remove(Th.Interaction),this._handles.add(Fo(r),Th.Interaction),wt(this._input,s=>{s.visible=!0,this._updateToolPromise=VA(t.update(s,{tool:"reshape"}))})}_startSelectionInteraction(){this._stopInteraction();const e=this._view;if(M(e))return;const t=e.cursor,i=Fo(()=>e.cursor=t);e.cursor="crosshair",e.popup.close();let r=null;const s=Fo(()=>Wn(r)),n=e.on("immediate-click",a=>{a.preventDefault(),a.stopPropagation(),Wn(r),r=Pv(async l=>{const{results:c}=await e.hitTest(a);qt(l);const h=c.filter(p=>p.type==="graphic"&&p.graphic!=null).map(p=>p.graphic).find(p=>_(p.geometry)&&p.geometry.type==="polyline");h&&(this._input=h,this._clearPreviousInput(),this._stopInteractionAndUpdate())})}),o=e.on("key-down",a=>{a.key==="Escape"&&this.cancel()});this._handles.remove(Th.Interaction),this._handles.add([n,o,s,i],Th.Interaction),e.ready&&WEe(e)&&e.focus()}_stopInteraction(){this._handles.remove(Th.Interaction)}_stopInteractionAndUpdate(){this._handles.has(Th.Interaction)&&(this._updateDisabled=!0,this._stopInteraction(),this._updateDisabled=!1,this._triggerUpdate())}_triggerUpdate(){this._set("state",fs.Ready),this._update()}_update(){if(this._updateDisabled)return;const e=this.state;if(e!==fs.Selecting){if(this._visibleAndEditable){if(e===fs.Creating||e===fs.Reshaping&&this.isSketchedGraphic(this._input))return}else this.cancel();this._set("state",this._getNextState()),this._updateVisuals()}else this.stop()}_getNextState(){return M(this._input)?fs.Ready:this.isSketchedGraphic(this._input)?this.state===fs.Creating?fs.Creating:this._visibleAndEditable?fs.Reshaping:fs.ReshapingDisabled:fs.Selected}_updateVisuals(){switch(this.state){case fs.Creating:break;case fs.Reshaping:this._startReshapeInteraction();break;case fs.ReshapingDisabled:{this._stopInteractionAndUpdate();const e=this._input;_(e)&&this.isSketchedGraphic(e)&&(e.visible=!1);break}case fs.Ready:case fs.Selected:this._stopInteractionAndUpdate();case fs.Selecting:}this._updateSketchedGraphic()}_storePreviousInput(e){this._previousInputInfo={graphic:e}}_restorePreviousInput(){const e=this._previousInputInfo;M(e)||(this._clearPreviousInput(),this._input=e.graphic,this._triggerUpdate())}_clearPreviousInput(){this._previousInputInfo=null}_updateSketchedGraphic(){const e=this._graphicsLayer;if(M(e))return;const t=e.graphics,i=this._input;if(M(i)||!this.isSketchedGraphic(i))return void t.removeAll();if(t.indexOf(i)===-1)t.removeAll(),t.add(i);else if(t.length!==1){const r=t.filter(s=>s!==i);t.removeMany(r)}}_setSketchedGraphic(e){_(e)&&this._sketchedGraphics.add(e),this._input=e,this._updateSketchedGraphic()}};function I$t(e){if(nD(e)){const t=e.clone();return t.paths=[t.paths[0].slice(0,-1)],t}return e}u([d({nonNullable:!0})],vh.prototype,"state",void 0),u([d({nonNullable:!0})],vh.prototype,"tool",void 0),u([d()],vh.prototype,"canStopCreating",null),u([d()],vh.prototype,"_graphicsLayer",void 0),u([d()],vh.prototype,"_sketchVM",void 0),u([d()],vh.prototype,"_input",null),u([d()],vh.prototype,"_geometry",null),u([d()],vh.prototype,"_visibleAndEditable",null),u([d()],vh.prototype,"_view",null),u([d()],vh.prototype,"_shouldRemoveLastPoint",void 0),vh=u([L("esri.widgets.ElevationProfile.ElevationProfileInteraction")],vh);let Gk=class extends Ee{constructor(e){super(e),this._implementation=null,this._loadingTask=null,this._handles=new Nt}initialize(){this._handles.add(re(()=>({tool:this.tool,view:this.tool.viewModel.view,visible:this.tool.visible&&!!wt(this.tool.viewModel.view,e=>e.ready)}),({tool:e,view:t,visible:i})=>{_(t)&&i?this._show(t,e):this._hide()},fi))}destroy(){this._handles=We(this._handles),this._hide()}_show(e,t){this._loadingTask=Wn(this._loadingTask),this._loadingTask=Pv(async i=>{if(e.type==="2d"){const r=import("./ElevationProfileView2D.5255e701.js"),s=(await VT(r,i)).ElevationProfileView2D;this._implementation=new s(e,t)}else if(e.type==="3d"){const r=import("./ElevationProfileView3D.8e12cbb3.js"),s=(await VT(r,i)).ElevationProfileView3D;this._implementation=new s(e,t)}})}_hide(){this._loadingTask=Wn(this._loadingTask),this._implementation=We(this._implementation)}};u([d()],Gk.prototype,"tool",void 0),Gk=u([L("esri.widgets.ElevationProfile.support.ElevationProfileView")],Gk);let _0=class extends Ee{constructor(e){super(e),this.editable=!0,this.visible=!0,this.highlightEnabled=!0}initialize(){this.view=new Gk({tool:this}),this.interaction=new vh({tool:this})}destroy(){this.interaction.destroy(),this.view.destroy()}get state(){var t;switch((t=this.interaction)==null?void 0:t.state){case fs.Ready:return Au.Ready;case fs.Creating:return Au.Creating;case fs.Selecting:return Au.Selecting;case fs.Selected:return Au.Selected;case fs.Reshaping:case fs.ReshapingDisabled:return Au.Created}}};u([d({nonNullable:!0})],_0.prototype,"viewModel",void 0),u([d()],_0.prototype,"view",void 0),u([d()],_0.prototype,"interaction",void 0),u([d()],_0.prototype,"editable",void 0),u([d()],_0.prototype,"visible",void 0),u([d()],_0.prototype,"highlightEnabled",void 0),_0=u([L("esri.widgets.ElevationProfile.ElevationProfileTool")],_0);const $$t=ve.getLogger("esri.widgets.ElevationProfile.ElevationProfileViewModel");let gr=class extends Ee{constructor(e){super(e),this.view=null,this.input=null,this._getEffectiveUnitsMemoized=Zh((t,i)=>({distance:t,elevation:i})),this.geodesicDistanceThreshold=1e5,this.hoveredChartPosition=null,this.uniformChartScaling=!1,this.highlightEnabled=!0,this.defaultUnit=null,this.queue=null,this._currentTileCache=null,this.error=null,this._handles=new Nt,this._defaultProfileLineGround=new v$e,this._userUnitOptions=null,this._userUnit=null,(e==null?void 0:e.profiles)||(this.profiles=new nt([this._defaultProfileLineGround]))}initialize(){this._handles.add(re(()=>this.view,e=>{var t;M(e)?$$t.warnOnce("no view. Widget will be disabled until a view is provided."):this.queue=xIt(e.type==="3d"?(t=e.resourceController)==null?void 0:t.scheduler:void 0)},fi)),this.tool=new _0({viewModel:this}),this._controller=new g1({viewModel:this})}destroy(){this._handles=We(this._handles),this._defaultProfileLineGround=We(this._defaultProfileLineGround),this._controller=We(this._controller),this._currentTileCache=We(this._currentTileCache),this.tool=We(this.tool),this.queue=We(this.queue)}set profiles(e){const t=this._get("profiles"),i=e!=null?e:new nt;this._set("profiles",Mb(i,t))}get state(){const e=this.view;return _(e)&&e.ready?this.tool.state:Au.Disabled}get progress(){let e=0,t=0;for(const i of this.visibleProfiles)e++,t+=i.progress;return e>0?t/e:0}set unitOptions(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}get unitOptions(){return this._filteredOrAllUnits(this._userUnitOptions)}set unit(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null,this.notifyChange("unit")}get unit(){return this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)}get effectiveUnits(){const e=vIt(this.visibleProfiles.map(r=>r.result)),t=A6e(e.maxDistance,"meters",this.unit),i=M6e(e.maxElevation,"meters",this.unit);return this._getEffectiveUnitsMemoized(t,i)}get hasVertices(){const e=wt(this.input,t=>t.geometry);return nD(e)&&e.paths.reduce((t,i)=>t+i.length,0)>0}get hoveredPoints(){return!M(this.input)&&this.visible&&this.tool.editable?this.visibleProfiles.map(e=>{const t=e.hoveredPoint;return _(t)?{hoveredPoint:t,color:e.color}:null}).filter(_):[]}get statistics(){return yIt(this.visibleProfiles.map(e=>e.statistics))}get chartData(){if(M(this.input))return null;const{effectiveUnits:e,progress:t,statistics:i,visibleProfiles:r,uniformChartScaling:s}=this,n=r.filter(o=>o.hasZ).map(o=>({id:o.id,type:o.type,title:o.title,color:o.color,samples:o.samples,progress:o.progress,chartFillEnabled:o.chartFillEnabled,chartStrokeWidth:o.chartStrokeWidth,chartStrokeOffsetY:o.chartStrokeOffsetY,viewVisualizationEnabled:o.viewVisualizationEnabled}));return n.length===0?null:{lines:n,effectiveUnits:e,statistics:i,refined:t===1,dynamicElevationRange:r.some(o=>o.type==="view"),uniformScaling:s}}get visibleProfiles(){return this.profiles.toArray().filter(e=>e.available&&e.visible)}get minDemResolutions(){const e=[];for(const{minDemResolution:t}of this.visibleProfiles)_(t)&&e.push(t);return e}get minDemResolution(){return B0e(this.minDemResolutions)}get errorState(){const e=wt(this.input,t=>t.geometry);if(!Tse(e))return Io.NoValidInput;if(_(this.error)){if(tIt(this.error))switch(this.error.cause){case fp.TooComplex:return Io.TooComplex;case fp.InvalidGeometry:return Io.InvalidGeometry;case fp.InvalidElevationInfo:return Io.InvalidElevationInfo;case fp.ElevationQueryError:return Io.NoValidInput}return Io.UnknownError}return this.visibleProfiles.length===0?Io.NoVisibleProfiles:M(this.chartData)&&this.progress===1?Io.RefinedButNoChartData:Io.None}get tileCache(){var t;this._currentTileCache=We(this._currentTileCache);const e=this.view;if(_(e)&&(e==null?void 0:e.type)==="3d"){const i=(t=e.basemapTerrain)==null?void 0:t.elevationQueryCache;if(_(i))return i}return M(this._currentTileCache)&&(this._currentTileCache=new rIe(new hte(20*Rb.MEGABYTES))),this._currentTileCache}get inputIsSketched(){return this.tool.interaction.isSketchedGraphic(this.input)}get elevationProvider(){const e=this.view;return _(e)&&e.type==="3d"?e.elevationProvider:null}start(e){this.tool.interaction.start(e)}stop(){this.tool.interaction.stop()}cancel(){this.tool.interaction.cancel()}clear(){this.tool.interaction.clear()}_findSelectableUnit(e,t){const i=this.unitOptions;return _(e)&&i.includes(e)?e:t?this._findSelectableUnit(t):i[0]}_filteredOrAllUnits(e){const t=(_(e)?e:[]).filter(i=>AU.includes(i));return t.length===0?AU.slice():t}};u([d()],gr.prototype,"view",void 0),u([d({type:Ha})],gr.prototype,"input",void 0),u([d({type:VIt,nonNullable:!0})],gr.prototype,"profiles",null),u([d({readOnly:!0})],gr.prototype,"state",null),u([d({readOnly:!0})],gr.prototype,"progress",null),u([d()],gr.prototype,"unitOptions",null),u([d()],gr.prototype,"unit",null),u([d({readOnly:!0})],gr.prototype,"effectiveUnits",null),u([d({type:Number})],gr.prototype,"geodesicDistanceThreshold",void 0),u([d()],gr.prototype,"hoveredChartPosition",void 0),u([d()],gr.prototype,"uniformChartScaling",void 0),u([ze("tool.highlightEnabled")],gr.prototype,"highlightEnabled",void 0),u([d({readOnly:!0})],gr.prototype,"hoveredPoints",null),u([d({readOnly:!0})],gr.prototype,"statistics",null),u([d()],gr.prototype,"chartData",null),u([d()],gr.prototype,"visibleProfiles",null),u([d()],gr.prototype,"minDemResolutions",null),u([d({readOnly:!0})],gr.prototype,"minDemResolution",null),u([d({readOnly:!0})],gr.prototype,"errorState",null),u([d(FPt)],gr.prototype,"defaultUnit",void 0),u([d()],gr.prototype,"queue",void 0),u([d()],gr.prototype,"tileCache",null),u([d()],gr.prototype,"tool",void 0),u([ze("tool.visible")],gr.prototype,"visible",void 0),u([d()],gr.prototype,"error",void 0),u([d()],gr.prototype,"inputIsSketched",null),u([d()],gr.prototype,"elevationProvider",null),u([d()],gr.prototype,"_defaultProfileLineGround",void 0),u([d()],gr.prototype,"_userUnitOptions",void 0),u([d()],gr.prototype,"_controller",void 0),u([d()],gr.prototype,"_userUnit",void 0),gr=u([L("esri.widgets.ElevationProfile.ElevationProfileViewModel")],gr);const nLe=gr;let ff=class extends Ee{constructor(){super(...arguments),this.legend=!0,this.chart=!0,this.clearButton=!0,this.settingsButton=!0,this.sketchButton=!0,this.selectButton=!0,this.unitSelector=!0,this.uniformChartScalingToggle=!0}};u([d()],ff.prototype,"legend",void 0),u([d()],ff.prototype,"chart",void 0),u([d()],ff.prototype,"clearButton",void 0),u([d()],ff.prototype,"settingsButton",void 0),u([d()],ff.prototype,"sketchButton",void 0),u([d()],ff.prototype,"selectButton",void 0),u([d()],ff.prototype,"unitSelector",void 0),u([d()],ff.prototype,"uniformChartScalingToggle",void 0),ff=u([L("esri.widgets.ElevationProfile.ElevationProfileVisibleElements")],ff);const oLe=ff,L$t=100;let qx=class extends Yr{constructor(e,t){super(e,t),this._messagesUnits=null,this._updateLayout=i=>{const r=i.parentElement,s=i.style.display;r.removeChild(i),document.body.appendChild(i),i.style.display="block";let n=80;for(const o of i.childNodes)o instanceof HTMLElement&&(n=Math.max(n,o.offsetWidth));document.body.removeChild(i),r.appendChild(i),i.style.display=s,i.style.setProperty("--max-width",`${n}px`)},this._updateLayoutThrottled=gL(this._updateLayout,L$t)}initialize(){this.own(this._updateLayoutThrottled)}render(){return N("div",{bind:this,class:jw.base,afterCreate:this._updateLayout,afterUpdate:this._updateLayoutThrottled},this._renderStatistics())}_renderStatistics(){var t;const e=(t=this._messages)==null?void 0:t.statistics;return e?[this._renderDistanceStatistic("maxDistance",e.maxDistance),this._renderElevationStatistic("elevationGain",e.gain),this._renderElevationStatistic("elevationLoss",e.loss),this._renderElevationStatistic("minElevation",e.minElevation),this._renderElevationStatistic("maxElevation",e.maxElevation),this._renderElevationStatistic("avgElevation",e.avgElevation),this._renderSlopeStatistic("maxPositiveSlope","maxNegativeSlope",e.maxSlope),this._renderSlopeStatistic("avgPositiveSlope","avgNegativeSlope",e.avgSlope)]:[]}_renderDistanceStatistic(e,t){const i=this._renderValue(e,r=>{const s=this.effectiveUnits.distance;return Kg(this._messagesUnits,r,s,eA)});return this._renderStatistic(t,i)}_renderElevationStatistic(e,t){const i=this._renderValue(e,r=>{const s=this.effectiveUnits.elevation;return Kg(this._messagesUnits,r,s,eA)});return this._renderStatistic(t,i)}_renderSlopeStatistic(e,t,i){const r=N("div",{key:"slope-up",class:jw.slopeValue},N("div",{class:jw.slopeUpIcon}),this._renderValue(e,s=>Uae(s,"degrees","geographic","geographic",eA)),N("div",{class:jw.slopeDownIcon}),this._renderValue(t,s=>Uae(s,"degrees","geographic","geographic",eA)));return this._renderStatistic(i,r)}_renderStatistic(e,t){return N("div",{class:jw.statistic},N("label",{class:jw.statisticLabel},e),N("div",{class:jw.statisticValue},t))}_renderValue(e,t){const i=this.line,r=i.progress===1?i.statistics:null,s=wt(r,n=>n[e]);return _(s)?t(s):c$e}};u([d()],qx.prototype,"effectiveUnits",void 0),u([d()],qx.prototype,"line",void 0),u([d(),pr("esri/widgets/ElevationProfile/t9n/ElevationProfile")],qx.prototype,"_messages",void 0),u([d(),pr("esri/core/t9n/Units")],qx.prototype,"_messagesUnits",void 0),qx=u([L("esri.widgets.ElevationProfile.Statistics")],qx);function nQ(e,{profiles:t}){const i=e.title;if(_(i))return i;switch(e.type){case"ground":return t.ground;case"input":return t.input;case"query":return t.query;case"view":return t.view;default:return""}}let mf=class extends Yr{constructor(e,t){super(e,t),this.expanded=!1,this.checkboxVisible=!0,this._messages=null}initialize(){this._statistics=new qx(this._statisticsProps),this.own(re(()=>this._statisticsProps,e=>this._statistics.set(e)))}destroy(){this._statistics=We(this._statistics)}render(){const e=this.expanded;return N("div",{key:this,class:this.classes(Cd.base,{[Cd.disabled]:this.disabled,[Cd.expanded]:e})},this._renderColorIndicator(),N("div",{key:"header",class:Cd.header},this._renderLabelWithCheckbox(),this._renderCollapseToggleButton()),e&&N("div",{key:"content",class:Cd.content},this._statistics.render()))}get disabled(){return!this.line.available}get _statisticsProps(){return{line:this.line,effectiveUnits:this.effectiveUnits}}_renderColorIndicator(){return N("div",{key:"color-indicator",class:Cd.colorIndicator,styles:{backgroundColor:this.line.color.toCss()}})}_renderCollapseToggleButton(){const e=this._messages,t=this.expanded?e.hideDetails:e.showDetails;return N("button",{key:"collapse-toggle",bind:this,class:Cd.collapseToggle,onclick:this._onCollapseToggleClick,title:t,"aria-label":t,type:"button"},N("span",{class:Cd.collapseToggleIcon}))}_onCollapseToggleClick(){this.onExpandedToggle()}_renderLabelWithCheckbox(){const{line:e,checkboxVisible:t,disabled:i}=this,r=`${Cd.base}__check-${e.id}`;return N("label",{key:"id",for:r,class:this.classes(Cd.label,{[Cd.labelDisabled]:i||!t})},t&&this._renderCheckbox(r),N("span",null,nQ(e,this._messages)))}_renderCheckbox(e){const t=this.line,i=t.visible,r=this.disabled,s=this._messages,n=i?s.hideProfile:s.showProfile,o=nQ(t,this._messages),a=xc(n,{name:o});return N("input",{key:"checkbox",id:e,type:"checkbox",class:Cd.checkbox,title:a,checked:i,disabled:r,"aria-label":a,bind:this,onchange:l=>this._onCheckboxToggle(l,t)})}_onCheckboxToggle(e,t){e.stopPropagation(),t.toggleVisibility()}};u([d({nonNullable:!0})],mf.prototype,"effectiveUnits",void 0),u([d({nonNullable:!0})],mf.prototype,"line",void 0),u([d()],mf.prototype,"expanded",void 0),u([d()],mf.prototype,"disabled",null),u([d()],mf.prototype,"checkboxVisible",void 0),u([d()],mf.prototype,"onExpandedToggle",void 0),u([d()],mf.prototype,"_statistics",void 0),u([d(),pr("esri/widgets/ElevationProfile/t9n/ElevationProfile")],mf.prototype,"_messages",void 0),mf=u([L("esri.widgets.ElevationProfile.LegendItem")],mf);let Wx=class extends Yr{constructor(e,t){super(e,t),this._items=new nt,this._expandedLine=null}initialize(){this.own([re(()=>this.profiles,e=>{this._destroyItems(),this._items.addMany(e.map(t=>this._createItemForLine(t)))},Et),re(()=>this.effectiveUnits,e=>{this._items.forEach(t=>{t.effectiveUnits=e})},Et)])}destroy(){this._destroyItems()}render(){return N("div",{class:NPt.base},this._items.toArray().map(e=>e.render()))}_onExpandedToggle(e){this._expandedLine=e===this._expandedLine?null:e,this._items.forEach(t=>t.expanded=t.line===this._expandedLine)}_createItemForLine(e){return new mf({line:e,effectiveUnits:this.effectiveUnits,expanded:e===this._expandedLine,checkboxVisible:this.profiles.length>1,onExpandedToggle:()=>this._onExpandedToggle(e)})}_destroyItems(){this._items.drain(e=>e.destroy())}};u([d()],Wx.prototype,"profiles",void 0),u([d()],Wx.prototype,"effectiveUnits",void 0),u([d()],Wx.prototype,"_items",void 0),u([d()],Wx.prototype,"_expandedLine",void 0),Wx=u([L("esri.widgets.ElevationProfile.Legend")],Wx);let Zx=class extends Yr{constructor(e,t){super(e,t),this._messagesUnits=null,this._popover=null,this._buttonElement=null,this._focusOutElement=null,this._requestFocusOnCreate=!1}destroy(){this._destroyPopover()}render(){const{unitSelector:e,uniformChartScalingToggle:t}=this.visibleElements;if(!e&&!t)return N("div",{key:`${this.id}-empty`});const i=_(this._popover)&&this._popover.open?this._messages.hideSettings:this._messages.showSettings;return N("button",{class:qw.base,title:i,bind:this,afterCreate:this._initializePopover,onclick:this._togglePopover,"aria-label":i,type:"button"})}_initializePopover(e){this._destroyPopover(),this._buttonElement=e,this._popover=new bse({owner:this,placement:"bottom-end",offset:[0,0],anchorElement:e,renderContentFunction:()=>this._renderPopoverContent()})}_destroyPopover(){this._focusOutElement=hn(this._focusOutElement),this._popover=We(this._popover)}_renderPopoverContent(){const{unitSelector:e,uniformChartScalingToggle:t}=this.visibleElements;return N("div",{class:qw.popoverContent,dir:_xe(this._buttonElement),bind:this,afterCreate:this._onPopoverContentAfterCreate},e&&this._renderUnitSelector(),t&&this._renderUniformChartScalingToggle())}_renderUnitSelector(){const{unit:e,unitOptions:t}=this.viewModel,i=this._messagesUnits;return N("label",{key:"unit-selector-label",class:qw.selectLabel},this._messages.unitSelectLabel,N("select",{class:qw.select,value:e,bind:this,onchange:this._onUnitChange,afterCreate:this._onUnitSelectAfterCreate},t.map(r=>N("option",{key:r,value:r},C6e(r)?i.systems[r]:i.units[r].pluralCapitalized))))}_onUnitChange(e){this.viewModel.unit=e.target.value}_onUnitSelectAfterCreate(e){this._requestFocusOnCreate&&(this._requestFocusOnCreate=!1,e.focus())}_renderUniformChartScalingToggle(){const e=this._messages,t=this.viewModel.uniformChartScaling,i=t?e.uniformChartScalingDisable:e.uniformChartScalingEnable;return N("label",{key:"uniform-chart-scaling-label",class:qw.checkboxLabel,onmousedown:D$t},N("input",{class:this.classes(qw.checkbox,qw.uniformChartScalingCheckbox),type:"checkbox",checked:t,title:i,"aria-label":i,bind:this,onchange:this._onUniformChartScalingChange}),e.uniformChartScalingLabel)}_onUniformChartScalingChange(e){this.viewModel.uniformChartScaling=e.target.checked}_togglePopover(e){_(this._popover)&&this._popover.open?this._closePopover():this._openPopover()}_openPopover(){wt(this._popover,e=>e.open=!0),this._requestFocusOnCreate=!0}_closePopover({focusOnButton:e=!0}={}){wt(this._popover,t=>t.open=!1),e&&wt(this._buttonElement,t=>t.focus())}_onPopoverContentAfterCreate(e){hn(this._focusOutElement),this._focusOutElement=jS(e,"focusout",({relatedTarget:t})=>{const i=e.contains(t),r=t===this._buttonElement;i||r||this._closePopover({focusOnButton:!1})})}};function D$t(e){e.preventDefault()}u([d()],Zx.prototype,"viewModel",void 0),u([d()],Zx.prototype,"visibleElements",void 0),u([d(),pr("esri/widgets/ElevationProfile/t9n/ElevationProfile")],Zx.prototype,"_messages",void 0),u([d(),pr("esri/core/t9n/Units")],Zx.prototype,"_messagesUnits",void 0),Zx=u([L("esri.widgets.ElevationProfile.SettingsButton")],Zx);function N$t(e,t,i=10){const r=Bye(t-e,!1);if(r===0)return[e,t];const s=Bye(r/(i-1),!0);return[Math.floor(e/s)*s,Math.ceil(t/s)*s]}function Bye(e,t){const i=Math.floor(Math.log10(e)),r=e/10**i;let s;return s=t?r<1.5?1:r<3?2:r<5?2.5:r<7?5:10:r<=1?1:r<=2?2:r<=3?2.5:r<=5?5:10,s*10**i}const EV="#f8f8f8",aLe="#a9a9a9",w3="#323232",F$t="line",k$t="fill",sP=15,R4=12,U$t=30,Gye=.001,z$t=.5,V$t=.5,jye=30,B$t=.02,G$t=.02,lLe={sideSpacing:sP,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,axisFontSize:9,axisFontWeight:"400",axisGridStroke:"#f4f4f4",axisLabelsFontSize:9,axisLabelsFontWeight:"400",axisLabelsColor:aLe,axisTooltipFontSize:12,axisTooltipBackgroundColor:w3,axisTooltipLabelColor:EV,axisTooltipPaddingTop:Math.round(R4/4),axisTooltipPaddingBottom:Math.round(R4/4),axisTooltipPaddingHorizontal:Math.round(sP/4),xAxisMinGridDistance:50,xAxisLabelsSpacing:Math.round(R4/2),xAxisMinLabelPosition:.05,xAxisMaxLabelPosition:.9,yAxisMinGridDistance:30,yAxisLabelSpacing:Math.round(sP/4),yAxisMinLabelPosition:0,yAxisMaxLabelPosition:.8,seriesTooltipFontSize:12,seriesTooltipBackgroundColor:EV,seriesTooltipLabelColor:w3,seriesFillLighten:.9,seriesTooltipSpacing:R4/2,seriesTooltipPaddingVertical:Math.round(sP/4),seriesTooltipPaddingHorizontal:Math.round(sP/4),tooltipBorderRadius:0},j$t=me(F({},lLe),{axisGridStroke:w3,axisLabelsColor:aLe,axisTooltipBackgroundColor:w3,axisTooltipLabelColor:EV,seriesTooltipBackgroundColor:w3,seriesTooltipLabelColor:EV,seriesFillLighten:-.75}),Hye={minX:void 0,maxX:void 0,minY:void 0,maxY:void 0};async function H$t(e){const t=await tSe(),{am4core:i,am4charts:r}=t;qt(e.abortOptions);const{options:s}=i;s.minPolylineStep=z$t,s.autoSetClassName=!0,s.animationsEnabled=!1;const n=RB(),o=n?j$t:lLe;n&&i.useTheme(t.am4themes_dark);const a=i.create(e.container,r.XYChart);a.arrangeTooltips=!1,a.preloader.disabled=!0,a.zoomOutButton.disabled=!0;const l=jl(e.container);a.rtl=l,a.padding(o.paddingTop,l?o.paddingLeft:o.paddingRight,o.paddingBottom,l?o.paddingRight:o.paddingLeft);const c=a.plotContainer.background;c.strokeWidth=0,c.strokeOpacity=0,c.stroke=null;const h=a.xAxes.push(new r.ValueAxis),p=a.yAxes.push(new r.ValueAxis),f={params:e,amCharts4Index:t,amChart:a,xAxis:h,yAxis:p,series:new Map,data:null,messages:null,theme:o,zooming:!1,pointerIsOver:!1};a.cursor=q$t(f),W$t(f),Z$t(f),X$t(f);const m=[rLt(f,e.onRangeChange),nLt(f,e.onCursorPositionChange),sLt(f)];let g=null,y=!1;const x=()=>{M(g)||(typeof window!="undefined"&&"cancelIdleCallback"in window?window.cancelIdleCallback(g):clearTimeout(g),g=null)};return me(F({},f),{destroy(){y=!0,x(),td(m).remove(),a.dispose()},update(b){if(b.data===f.data&&b.messages===f.messages||(x(),y))return;const S=()=>{y||(g=null,Y$t(f,b))};g=typeof window!="undefined"&&"requestIdleCallback"in window?window.requestIdleCallback(S,{timeout:jye}):setTimeout(S,jye)},zoomOut(){y||(f.yAxis.zoom({start:0,end:1},!1,!0),f.xAxis.zoom({start:0,end:1},!1,!0))}})}function q$t(e){const t=new e.amCharts4Index.am4charts.XYCursor;return t.trackable=!0,t.lineY.disabled=!0,t.behavior="zoomXY",t}function W$t(e){const t=e.theme,i=e.amChart.tooltip,{am4core:r}=e.amCharts4Index;i.id="series-tooltip",i.fitPointerToBounds=!0,i.pointerOrientation="vertical",i.zIndex=-1,i.getFillFromObject=!1,i.label.fontSize=t.seriesTooltipFontSize,i.label.fill=r.color(t.seriesTooltipLabelColor),i.label.padding(t.seriesTooltipPaddingVertical,t.seriesTooltipPaddingHorizontal,t.seriesTooltipPaddingVertical,t.seriesTooltipPaddingHorizontal),i.background.cornerRadius=t.tooltipBorderRadius,i.background.stroke=null,i.background.fill=r.color(t.seriesTooltipBackgroundColor),i.background.padding(0,0,0,0),i.adapter.add("dy",()=>t.seriesTooltipSpacing*(i.background.pointerY<=0?1:-1)),jl(e.params.container)&&(i.label.textAlign="middle")}function Z$t(e){const{xAxis:t,theme:i}=e,{am4core:r}=e.amCharts4Index;t.numberFormatter=uLe(e,"distance"),t.strictMinMax=!0,t.cursorTooltipEnabled=!1,t.title.visible=!1;const s=t.renderer;s.line.visible=!1,s.minGridDistance=i.xAxisMinGridDistance,s.minLabelPosition=i.xAxisMinLabelPosition,s.maxLabelPosition=i.xAxisMaxLabelPosition,s.fontWeight=i.axisFontWeight,s.fontSize=i.axisFontSize,s.baseGrid.disabled=!0;const n=s.labels.template;n.fontSize=i.axisLabelsFontSize,n.fontWeight=i.axisLabelsFontWeight,n.fill=r.color(i.axisLabelsColor),n.paddingTop=i.xAxisLabelsSpacing,n.horizontalCenter="left",n.paddingLeft=0;const o=t.tooltip;o.id="axis-tooltip",o.background.fill=r.color(i.axisTooltipBackgroundColor),o.background.stroke=null,o.background.padding(0,0,0,0),o.label.fontSize=i.axisTooltipFontSize,o.label.fill=r.color(i.axisTooltipLabelColor),o.label.padding(i.axisTooltipPaddingTop,i.axisTooltipPaddingHorizontal,i.axisTooltipPaddingBottom,i.axisTooltipPaddingHorizontal);const a=s.grid.template;a.strokeOpacity=1,a.stroke=r.color(i.axisGridStroke)}function X$t(e){const{yAxis:t,theme:i}=e,{am4core:r}=e.amCharts4Index;t.numberFormatter=uLe(e,"elevation"),t.title.visible=!1,t.cursorTooltipEnabled=!1,t.strictMinMax=!0,t.baseValue=a$e;const s=t.renderer;s.inside=!0,s.line.opacity=0,s.line.visible=!1,s.minGridDistance=i.yAxisMinGridDistance,s.minLabelPosition=i.yAxisMinLabelPosition,s.maxLabelPosition=i.yAxisMaxLabelPosition,s.fontWeight=i.axisFontWeight,s.fontSize=i.axisFontSize,s.baseGrid.disabled=!0;const n=s.labels.template;n.fontSize=i.axisLabelsFontSize,n.fontWeight=i.axisLabelsFontWeight,n.fill=r.color(i.axisLabelsColor),n.verticalCenter="bottom",n.paddingLeft=i.yAxisLabelSpacing,n.paddingBottom=0;const o=s.grid.template;o.strokeOpacity=1,o.stroke=r.color(i.axisGridStroke),jl(e.params.container)&&(s.opposite=!0,n.textAlign="middle",n.paddingLeft=0,n.paddingRight=i.yAxisLabelSpacing)}function Y$t(e,{data:t,messages:i}){const{htmlContainer:r}=e.amChart;if(!r)return;const s=_(t)&&t.refined;e.amChart.cursor.disabled=!s,r.classList.toggle(DPt.cursorEnabled,s);const n=e.data!==t,o=wt(e.data,a=>a.effectiveUnits)!==wt(t,a=>a.effectiveUnits);e.data=t,e.messages=i,n&&(J$t(e),K$t(e)),o&&(e.yAxis.invalidateLabels(),e.xAxis.invalidateLabels()),tL(e)}function J$t(e){const{xAxis:t,yAxis:i}=e,{minX:r,maxX:s,minY:n,maxY:o}=Q$t({data:e.data,pixelWidth:t.pixelWidth,pixelHeight:i.pixelHeight});t.min=r,t.max=s,i.min=n,i.max=o}function Q$t({data:e,pixelWidth:t,pixelHeight:i}){if(M(e))return Hye;const r=e.statistics,s=0,n=wt(r,p=>p.maxDistance);let o=wt(r,p=>p.minElevation),a=wt(r,p=>p.maxElevation);if(M(n)||M(o)||M(a))return Hye;const l=Math.max(n-s,Gye);let c=Math.max(a-o,Gye);const h=e.effectiveUnits;if(e.dynamicElevationRange){const p=tr(l,h.distance,h.elevation);c=Math.max(c,p/qPt)}return o-=G$t*c,a=o+c+B$t*c,[o,a]=N$t(o,a,10),c=a-o,e.uniformScaling?cLe({data:e,bounds:{minX:s,maxX:n,minY:o,maxY:a},pixelWidth:t,pixelHeight:i,centered:!0}):{minX:s,maxX:s+l,minY:o,maxY:o+c}}function cLe({data:e,bounds:t,pixelWidth:i,pixelHeight:r,centered:s}){if(M(e))return t;let{minX:n,maxX:o,minY:a,maxY:l}=t;const c=o-n,h=l-a,p=e.effectiveUnits,f=tr(h,p.elevation,p.distance)/r/(c/i);return f>=1?[n,o]=qye([n,o],f,s):[a,l]=qye([a,l],1/f,s),{minX:n,maxX:o,minY:a,maxY:l}}function qye([e,t],i,r){const s=(t-e)*i;if(r){const n=(e+t)/2-s/2;return[n,n+s]}return[e,e+s]}function K$t(e){const{amChart:t,data:i}=e;if(M(i)||i.lines.length===0)return void t.series.clear();const r=new Map,s=new Set(t.series.values),n=i.lines.length;for(let o=0;o<n;o++){const a=i.lines[o];let l=e.series.get(a.id);l?(wt(l.fill,h=>s.delete(h)),s.delete(l.line)):(l=iLt(e,a),wt(l.fill,h=>t.series.push(h)),t.series.push(l.line)),r.set(l.id,l);const c=n-o-1;wt(l.fill,h=>h.zIndex=c),l.line.zIndex=n+c,eLt(e,l,a)}e.series=r;for(const o of s)t.series.removeValue(o)}function eLt(e,{line:t,fill:i},r){const{theme:s}=e,{am4core:n}=e.amCharts4Index,{r:o,g:a,b:l,a:c}=r.color,h=n.color({r:o,g:a,b:l,a:c}),p=Ye(r.samples,[]),f=p.length>0;t.stroke=h,t.visible=f,wt(i,y=>{y.visible=f,y.fill=h.lighten(s.seriesFillLighten)});const m=p.length,g=t.data;if(g.length===m){for(let y=0;y<m;++y)tLt(g[y],p[y]);t.invalidateRawData(),wt(i,y=>y.invalidateRawData())}else t.data=p,wt(i,y=>y.data=p)}function tLt(e,t){e.x=t.x,e.y=t.y,e.z=t.z,e.distance=t.distance,e.elevation=t.elevation}function iLt(e,t){const{id:i}=t,r=Wye(e,`${F$t}-${i}`);r.strokeWidth=t.chartStrokeWidth,r.dy=t.chartStrokeOffsetY;let s=null;return t.chartFillEnabled&&(s=Wye(e,`${k$t}-${i}`),s.fillOpacity=1),{id:i,line:r,fill:s}}function Wye(e,t){const i=new e.amCharts4Index.am4charts.LineSeries;i.id=t,i.showOnInit=!1,i.simplifiedProcessing=!0,i.minDistance=V$t,i.excludeFromTotal=!0,i.clickable=!1,i.contextMenuDisabled=!0,i.cursorHoverEnabled=!1,i.cursorTooltipEnabled=!1,i.connect=!1,i.fill=null,i.stroke=null;const r="distance";i.dataFields.valueX=r;const s="elevation";return i.dataFields.valueY=s,i}function rLt(e,t){const{amChart:i,xAxis:r,yAxis:s}=e;let n=!1;const o=()=>{const{data:h}=e;if(!n||M(h)||!h.uniformScaling)return;n=!1;const{minX:p,maxX:f,minY:m,maxY:g}=cLe({data:e.data,bounds:{minX:r.minZoomed,maxX:r.maxZoomed,minY:s.minZoomed,maxY:s.maxZoomed},pixelWidth:r.pixelWidth,pixelHeight:s.pixelHeight,centered:!0});r.zoomToValues(p,f,!0),s.zoomToValues(m,g,!0),i.validate(),tL(e)},a=()=>{t(e.xAxis.zoomFactor,e.yAxis.zoomFactor)},l=h=>{e.zooming=h,tL(e)},c=[i.events.on("down",()=>l(!0)),i.events.on("up",()=>l(!1)),i.cursor.events.on("zoomended",()=>{n=!0}),r.events.on("startendchanged",o),s.events.on("startendchanged",o),r.events.on("rangechangeended",a),s.events.on("rangechangeended",a)];return Fo(()=>{c.forEach(h=>h.dispose())})}function sLt({xAxis:e,yAxis:t}){const i=s=>()=>{s.renderer.grid.each(n=>{n.visible=n.dataItem.label.dom.getAttribute("display")!=="none"})},r=[e.events.on("rangechangeended",i(e)),e.events.on("validated",i(e)),t.events.on("rangechangeended",i(t)),t.events.on("validated",i(t))];return Fo(()=>{r.forEach(s=>s.dispose())})}function nLt(e,t){const{amChart:i,xAxis:r,yAxis:s}=e,{cursor:n,events:o}=i,a=h=>{e.pointerIsOver=h,tL(e)},l=()=>{a(!1),t(null,null)},c=[n.events.on("cursorpositionchanged",()=>{if(!e.pointerIsOver)return;tL(e);const h=r.toAxisPosition(n.xPosition),p=s.toAxisPosition(n.yPosition);t(h,p)}),o.on("over",()=>a(!0)),o.on("out",l),o.on("blur",l)];return Fo(()=>{c.forEach(h=>h.dispose())})}function tL(e){const{amChart:t,xAxis:i,data:r,theme:s,zooming:n,pointerIsOver:o}=e;if(e.amChart.tooltip.hide(),e.xAxis.hideTooltip(),!o||n||M(r)||!r.refined)return;const a=oLt(e);if(_(a)){const{cursor:l,tooltip:c}=t;l.show(0),l.validate(),c.text=a.text,c.show(0),c.validate();const h=a.y-c.contentHeight-s.seriesTooltipSpacing;c.pointerOrientation=h<U$t?"up":"down",c.pointTo(a,!0),c.validate();const p=i.tooltip;p.text=cLt(e),p.show(0),p.validate()}}function oLt(e){const{amChart:t,yAxis:i,data:r}=e;if(M(r))return null;const s=r.lines.map(c=>({line:c,y:wt(hLe(e,c),h=>h.elevation)})).sort(aLt),n=s.length?s[0].y:null;if(M(n))return null;const o=t.cursor,a=i.measuredHeight,l=a+t.pixelPaddingTop;return{text:s.map(({y:c,line:h})=>lLt(e,h,c)).join(`
`),x:o.point.x+o.parent.pixelX+t.pixelPaddingLeft,y:l-i.valueToPosition(n)*a}}function aLt({y:e},{y:t}){return M(e)?1:M(t)?-1:t-e}function lLt(e,t,i){const{data:r,messages:s}=e;if(M(r)||M(s))return"";const n=xc(s.chartTooltip,{name:nQ(t,s),elevation:_(i)?Kg(s,i,r.effectiveUnits.elevation,eA):c$e});return`[${t.color.toHex()}]\u25CF[/] ${n}`}function cLt(e){const{data:t,messages:i}=e;if(M(t)||M(i))return"";const r=t.lines[0],s=r?hLe(e,r):null;return _(s)?Kg(i,s.distance,t.effectiveUnits.distance,eA):"-"}function uLe(e,t){const i=e.xAxis.numberFormatter.clone();return i.format=(r,s,n)=>{const{messages:o,data:a}=e;return M(o)||M(a)||typeof r=="string"?"":`${Wl(r,{maximumFractionDigits:n})} ${bee(o,a.effectiveUnits[t],"abbr")}`},i}function hLe({amChart:e,xAxis:t},i){const r=Ye(i.samples,[]);if(r.length===0)return null;const s=t.toAxisPosition(e.cursor.xPosition),n=t.positionToValue(s);return H0e(r,n,o=>o.distance)}var gu;(function(e){e.Sketch="sketch",e.SketchCancel="sketch-cancel",e.SketchDone="sketch-done",e.Select="select",e.SelectCancel="select-cancel"})(gu||(gu={}));const nP=[{type:gu.Select},{type:gu.Sketch}],uLt={[Io.None]:null,[Io.NoValidInput]:"noProfile",[Io.NoVisibleProfiles]:"noProfile",[Io.RefinedButNoChartData]:"noProfile",[Io.TooComplex]:"tooComplex",[Io.UnknownError]:"unknown",[Io.InvalidGeometry]:"invalidGeometry",[Io.InvalidElevationInfo]:"invalidElevationInfo"};let Vr=class extends Yr{constructor(e,t){super(e,t),this.viewModel=null,this.view=null,this.input=null,this.profiles=null,this.unitOptions=[],this.unit="metric",this.geodesicDistanceThreshold=1e5,this.visibleElements=new oLe,this.iconClass=Ls.widgetIcon,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this._chartContainer=null,this._chart=null,this._chartInitTask=null,this._chartIsRefined=!1,this._width=0,this._zoomOutButtonVisible=!1,this._getChartUpdateParamsMemoized=Zh((i,r,s,n)=>({chart:i,data:r,stationary:s,messages:n})),this._getDetailsPropsMemoized=Zh((i,r)=>({effectiveUnits:i,profiles:r})),(e==null?void 0:e.viewModel)||(this._defaultViewModel=new nLe({view:e==null?void 0:e.view}),this.viewModel=this._defaultViewModel)}initialize(){this._legend=new Wx(this._legendProps),this._settingsButton=new Zx(this._settingsButtonProps),this.own([re(()=>this._legendProps,e=>this._legend.set(e)),re(()=>this._settingsButtonProps,e=>this._settingsButton.set(e))])}postInitialize(){this.own([re(()=>({container:this._chartContainer,width:this._width}),({container:e,width:t})=>{this._destroyChart(),_(e)&&t>0&&this._initializeChart(e)},Et),re(()=>this._chartUpdateParams,()=>this._updateChart(this._chartUpdateParams),Et)])}destroy(){this._destroyChart(),_(this._defaultViewModel)&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy(),this._legend=We(this._legend),this._settingsButton=We(this._settingsButton)}get _portrait(){return this._width<ZPt}get _chartUpdateParams(){const e=this.view;return this._getChartUpdateParamsMemoized(this._chart,this.viewModel.chartData,!_(e)||e.stationary,this._chartMessages)}get _chartMessages(){return F(F({},this.messagesUnits),this.messages)}get _legendProps(){return this._getDetailsPropsMemoized(this.viewModel.effectiveUnits,this._profilesArray)}get _profilesArray(){return this.profiles.toArray()}get _settingsButtonProps(){return{viewModel:this.viewModel,visibleElements:this.visibleElements}}render(){const{viewModel:e,visible:t}=this;return N("div",{key:this,class:this.classes({[Ls.base]:t,[Ls.esriWidget]:t,[Ls.esriWidgetDisabled]:t&&e.state==="disabled",[Ls.portrait]:this._portrait,[Ls.refined]:e.progress===1}),"aria-label":this.messages.widgetLabel,afterCreate:i=>{this.own(vxe(i,r=>{this._width=r.contentRect.width}))}},t&&this._renderContentForState())}_renderContentForState(){switch(this.viewModel.state){case Au.Ready:return this._renderContentForReadyState();case Au.Selecting:return this._renderContentForSelectingState();case Au.Creating:return this._renderContentForCreatingState();case Au.Selected:return this._renderContentForSelectedState();case Au.Created:return this._renderContentForCreatedState();case Au.Disabled:return this._renderContentForReadyState()}}_renderContentForReadyState(){var s;const{sketchButton:e,selectButton:t}=this.visibleElements,i=this.messages;let r;return r=e&&t?i.readyPrompt:e?i.readyPromptCreateOnly:t?i.readyPromptSelectOnly:(s=i.errors)==null?void 0:s.noProfile,this._renderContent({prompt:r,chart:!1,actions:nP})}_renderContentForSelectingState(){const e=this.view;if(M(e))return null;const t=this.messages[`selectingPrompt-${e.type}`];return this._renderContent({prompt:t,chart:!1,actions:[{type:gu.SelectCancel}]})}_renderContentForCreatingState(){const{view:e,viewModel:t}=this;if(M(e))return null;const i=t.hasVertices?[{type:gu.SketchCancel},{type:gu.SketchDone,disabled:!t.tool.interaction.canStopCreating}]:[{type:gu.Select},{type:gu.Sketch,disabled:!0}];if(t.errorState===Io.NoValidInput){const s=this.messages[`creatingPrompt-${e.type}`];return this._renderContent({chart:!1,actions:i,prompt:s})}const r=this._getErrorMessage();return r?this._renderContent({chart:!1,actions:i,prompt:r}):this._renderContent({chart:!0,actions:i})}_renderContentForSelectedState(){const e=this._getErrorMessage();return e?this._renderContent({chart:!1,actions:nP,prompt:e}):this._renderContent({chart:!0,actions:nP})}_renderContentForCreatedState(){const e=this._getErrorMessage();return e?this._renderContent({chart:!1,actions:nP,prompt:e}):this._renderContent({chart:!0,actions:nP})}_getErrorMessage(){var t,i;const e=uLt[this.viewModel.errorState];return(i=(t=this.messages)==null?void 0:t.errors)==null?void 0:i[e]}_renderContent(e){const t=_(e.prompt)?this._renderPrompt(e.prompt):e.chart&&this._renderChart(),i=_(this.viewModel.input);return[N("header",{key:"header",class:Ls.header},this._zoomOutButtonVisible&&this._renderZoomOutButton(),this.visibleElements.clearButton&&i&&this._renderClearButton(),this.visibleElements.settingsButton&&this._settingsButton.render()),N("div",{class:Ls.mainContainer},...t),this.visibleElements.legend&&this._legend.render(),this._renderActions(e)]}_renderZoomOutButton(){return N("button",{key:"zoom-out",class:Ls.zoomOutButton,bind:this,onclick:this._onZoomOutButtonClick,title:this.messages.zoomOut,type:"button"})}_onZoomOutButtonClick(){wt(this._chart,e=>e.zoomOut())}_renderClearButton(){return N("button",{key:"clear-profile",class:Ls.clearButton,bind:this,onclick:this._onClearButtonClick,title:this.messages.clearProfile,type:"button"})}_onClearButtonClick(){this.viewModel.clear()}_renderPrompt(e){return[N("div",{key:"prompt-container",bind:this,class:Ls.promptContainer},N("p",null,e))]}_renderChart(){if(!this.visibleElements.chart)return[N("div",{key:"empty-chart-container",class:Ls.chartContainer})];const e=this._chartIsRefined||this._canRenderChart();if(!e)return[this._renderSpinner({size:"large"}),N("div",{key:"chart-container-empty",class:Ls.chartContainer})];const{chartData:t,progress:i}=this.viewModel;return[_(t)&&i>0&&i<1&&this._renderSpinner({size:e?"small":"large"}),N("div",{key:"chart-container",bind:this,class:Ls.chartContainer,afterCreate:this._onChartContainerAfterCreate,afterRemoved:this._onChartContainerRemoved})]}_renderSpinner(e){return N("div",{key:"spinner",class:this.classes(Ls.chartSpinner,{[Ls.chartSpinnerSmall]:e.size==="small"}),afterCreate:this._onSpinnerAfterCreate,exitAnimation:this._onSpinnerExit})}_onSpinnerAfterCreate(e){requestAnimationFrame(()=>e.classList.add(Ls.chartSpinnerVisible))}_onSpinnerExit(e,t){e.classList.remove(Ls.chartSpinnerVisible),setTimeout(t,200)}_canRenderChart(){const e=this.viewModel.chartData;if(M(e))return!1;if(!this.viewModel.inputIsSketched)return e.refined;let t=0;for(const{samples:i}of e.lines)t+=_(i)?i.length:0;return e.refined||t<=HPt}_renderActions({actions:e}){const t=e.map(i=>{switch(i.type){case gu.Sketch:return this.visibleElements.sketchButton&&this._renderAction({action:i,onClick:this._onSketchButtonClick,className:Ls.sketchButton,label:this.messages.sketchButtonLabel});case gu.SketchCancel:return this.visibleElements.sketchButton&&this._renderAction({action:i,onClick:this._onCancelButtonClick,className:Ls.sketchCancelButton,label:this.messagesCommon.cancel});case gu.SketchDone:return this.visibleElements.sketchButton&&this._renderAction({action:i,onClick:this._onDoneButtonClick,className:Ls.sketchDoneButton,label:this.messagesCommon.done});case gu.Select:return this.visibleElements.selectButton&&this._renderAction({action:i,onClick:this._onSelectButtonClick,className:Ls.selectButton,label:this.messages.selectButtonLabel});case gu.SelectCancel:return this.visibleElements.selectButton&&this._renderAction({action:i,onClick:this._onCancelButtonClick,className:Ls.selectCancelButton,label:this.messagesCommon.cancel})}}).filter(Boolean);return t.length?N("footer",{key:"footer",class:Ls.footer},...t):null}_renderAction({action:e,onClick:t,className:i,label:r}){return N("button",{key:`action-${e.type}`,class:this.classes(Ls.actionButton,i,{[Ls.buttonDisabled]:e.disabled}),bind:this,disabled:e.disabled,onclick:t,type:"button"},r)}_onSketchButtonClick(){this.viewModel.start({mode:"sketch"})}_onSelectButtonClick(){this.viewModel.start({mode:"select"})}_onCancelButtonClick(){this.viewModel.cancel()}_onDoneButtonClick(){this.viewModel.stop()}_updateChart(e){const{data:t,chart:i,messages:r,stationary:s}=e;!M(i)&&!M(r)&&s&&this._canRenderChart()&&(i.update(e),this._chartIsRefined=_(t)&&t.refined)}_onChartContainerAfterCreate(e){this._chartContainer=e}_onChartContainerRemoved(){this._chartContainer=null}_initializeChart(e){Wn(this._chartInitTask),this._chartInitTask=Pv(async t=>{const i=await H$t({container:e,abortOptions:{signal:t},onRangeChange:(r,s)=>{this._zoomOutButtonVisible=r!==1||s!==1},onCursorPositionChange:r=>{this.viewModel.hoveredChartPosition=r}});if(t.aborted)throw We(i),mi();this._chart=i,this._updateChart(this._chartUpdateParams)})}_destroyChart(){this._chartInitTask=Wn(this._chartInitTask),this._chart=We(this._chart),this._chartIsRefined=!1}};u([d({type:nLe})],Vr.prototype,"viewModel",void 0),u([ze("viewModel.view")],Vr.prototype,"view",void 0),u([ze("viewModel.input")],Vr.prototype,"input",void 0),u([ze("viewModel.profiles")],Vr.prototype,"profiles",void 0),u([ze("viewModel.unitOptions")],Vr.prototype,"unitOptions",void 0),u([ze("viewModel.unit")],Vr.prototype,"unit",void 0),u([ze("viewModel.geodesicDistanceThreshold")],Vr.prototype,"geodesicDistanceThreshold",void 0),u([d({type:oLe,nonNullable:!0})],Vr.prototype,"visibleElements",void 0),u([d()],Vr.prototype,"iconClass",void 0),u([ze("messages.widgetLabel",{overridable:!0})],Vr.prototype,"label",void 0),u([ze("viewModel.visible")],Vr.prototype,"visible",void 0),u([d(),pr("esri/widgets/ElevationProfile/t9n/ElevationProfile")],Vr.prototype,"messages",void 0),u([d(),pr("esri/t9n/common")],Vr.prototype,"messagesCommon",void 0),u([d(),pr("esri/core/t9n/Units")],Vr.prototype,"messagesUnits",void 0),u([d()],Vr.prototype,"_chartContainer",void 0),u([d()],Vr.prototype,"_chart",void 0),u([d()],Vr.prototype,"_chartInitTask",void 0),u([d()],Vr.prototype,"_chartIsRefined",void 0),u([d()],Vr.prototype,"_settingsButton",void 0),u([d()],Vr.prototype,"_legend",void 0),u([d()],Vr.prototype,"_width",void 0),u([d()],Vr.prototype,"_portrait",null),u([d()],Vr.prototype,"_zoomOutButtonVisible",void 0),u([d()],Vr.prototype,"_chartUpdateParams",null),u([d()],Vr.prototype,"_chartMessages",null),u([d()],Vr.prototype,"_legendProps",null),u([d()],Vr.prototype,"_profilesArray",null),u([d()],Vr.prototype,"_settingsButtonProps",null),Vr=u([L("esri.widgets.ElevationProfile")],Vr);const hUt=Vr,hLt={type:B0,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:dLt}}}}};function dLt(e,t,i,r){if(!e)return null;const{minScale:s,maxScale:n,minLOD:o,maxLOD:a}=t;if(o!=null&&a!=null)return r&&r.ignoreMinMaxLOD?B0.fromJSON(e):B0.fromJSON(me(F({},e),{lods:e.lods.filter(({level:l})=>l!=null&&l>=o&&l<=a)}));if(s!==0&&n!==0){const l=p=>Math.round(1e4*p)/1e4,c=s?l(s):1/0,h=n?l(n):-1/0;return B0.fromJSON(me(F({},e),{lods:e.lods.filter(p=>{const f=l(p.scale);return f<=c&&f>=h})}))}return B0.fromJSON(e)}class $A{constructor(){this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}getAvailability(t,i){if(this._allAvailability!=="unknown")return this._allAvailability;const r=(t-this.location.top)*this.location.width+(i-this.location.left),s=r%8,n=r>>3,o=this._tileAvailabilityBitSet;return n<0||n>o.length?"unknown":o[n]&1<<s?"available":"unavailable"}_updateFromData(t){const i=this.location.width,r=this.location.height;let s=!0,n=!0;const o=Math.ceil(i*r/8),a=new Uint8Array(o);let l=0;for(let c=0;c<t.length;c++){const h=c%8;t[c]?(n=!1,a[l]|=1<<h):s=!1,h===7&&++l}n?this._allAvailability="unavailable":s?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=a,this.byteSize+=a.length)}static fromDefinition(t,i){const r=t.service.request||Zt,{row:s,col:n,width:o,height:a}=t,l={query:{f:"json"}};return i=i?F(F({},l),i):l,r(pLt(t),i).then(c=>c.data).catch(c=>{if(c&&c.details&&c.details.httpStatus===422)return{location:{top:s,left:n,width:o,height:a},valid:!0,data:Z4e(o*a,0)};throw c}).then(c=>{if(c.location&&(c.location.top!==s||c.location.left!==n||c.location.width!==o||c.location.height!==a))throw new W("tilemap:location-mismatch","Tilemap response for different location than requested",{response:c,definition:{top:s,left:n,width:o,height:a}});return $A.fromJSON(c)})}static fromJSON(t){$A._validateJSON(t);const i=new $A;return i.location=Object.freeze(ue(t.location)),i._updateFromData(t.data),Object.freeze(i)}static _validateJSON(t){if(!t||!t.location)throw new W("tilemap:missing-location","Location missing from tilemap response");if(t.valid===!1)throw new W("tilemap:invalid","Tilemap response was marked as invalid");if(!t.data)throw new W("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(t.data))throw new W("tilemap:data-mismatch","Data must be an array of numbers");if(t.data.length!==t.location.width*t.location.height)throw new W("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}}function Zye(e){return`${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}function pLt(e){let t;if(e.service.type==="vector-tile")t=`${e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`;else{const r=e.service.tileServers;t=`${r&&r.length?r[e.row%r.length]:e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}const i=e.service.query;return i&&(t=`${t}?${i}`),t}var gT;const fLt=ve.getLogger("esri.layers.support.TilemapCache");let gf=gT=class extends pm(Ee){constructor(e){super(e),this._pendingTilemapRequests={},this._availableLevels={},this.levels=5,this.cacheByteSize=2*Rb.MEGABYTES,this.request=Zt,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new hte(this.cacheByteSize),this.own([re(()=>{const{layer:e}=this;return[e==null?void 0:e.parsedUrl,e==null?void 0:e.tileServers,e==null?void 0:e.apiKey,e==null?void 0:e.customParameters]},()=>this._initializeTilemapDefinition()),re(()=>{var e,t;return(t=(e=this.layer)==null?void 0:e.tileInfo)==null?void 0:t.lods},e=>this._initializeAvailableLevels(e),fi)]),this._initializeTilemapDefinition()}castLevels(e){return e<=2?(fLt.error("Minimum levels for Tilemap is 3, but got ",e),3):e}get size(){return 1<<this.levels}fetchTilemap(e,t,i,r){if(!this._availableLevels[e])return Promise.reject(new W("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`));const s=this._tmpTilemapDefinition,n=this._tilemapFromCache(e,t,i,s);if(n)return Promise.resolve(n);const o=r&&r.signal;return r=me(F({},r),{signal:null}),new Promise((a,l)=>{va(o,()=>l(mi()));const c=Zye(s);let h=this._pendingTilemapRequests[c];if(!h){h=$A.fromDefinition(s,r).then(f=>(this._tilemapCache.put(c,f,f.byteSize),f));const p=()=>delete this._pendingTilemapRequests[c];this._pendingTilemapRequests[c]=h,h.then(p,p)}h.then(a,l)})}getAvailability(e,t,i){if(!this._availableLevels[e])return"unavailable";const r=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return r?r.getAvailability(t,i):"unknown"}fetchAvailability(e,t,i,r){return this._availableLevels[e]?this.fetchTilemap(e,t,i,r).catch(s=>s).then(s=>{if(s instanceof $A){const n=s.getAvailability(t,i);if(n==="unavailable")throw new W("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i});return n}if(as(s))throw s;return"unknown"}):Promise.reject(new W("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`))}fetchAvailabilityUpsample(e,t,i,r,s){r.level=e,r.row=t,r.col=i;const n=this.layer.tileInfo;n.updateTileInfo(r);const o=this.fetchAvailability(e,t,i,s).catch(a=>{if(as(a))throw a;if(n.upsampleTile(r))return this.fetchAvailabilityUpsample(r.level,r.row,r.col,r);throw a});return this._fetchAvailabilityUpsamplePrefetch(r.id,e,t,i,s,o),o}async _fetchAvailabilityUpsamplePrefetch(e,t,i,r,s,n){if(!this._prefetchingEnabled)return;const o=`prefetch-${e}`;if(this.handles.has(o))return;const a=new AbortController;n.then(()=>a.abort(),()=>a.abort());let l=!1;const c={remove(){l||(l=!0,a.abort())}};if(this.handles.add(c,o),await J5e(10,a.signal).catch(()=>{}),l||(l=!0,this.handles.remove(o)),an(a))return;const h={id:e,level:t,row:i,col:r},p=me(F({},s),{signal:a.signal}),f=this.layer.tileInfo;for(let m=0;gT._prefetches.length<gT._maxPrefetch&&f.upsampleTile(h);++m){const g=this.fetchAvailability(h.level,h.row,h.col,p);gT._prefetches.push(g);const y=()=>{gT._prefetches.removeUnordered(g)};g.then(y,y)}}_initializeTilemapDefinition(){var r;if(!this.layer.parsedUrl)return;const{parsedUrl:e,apiKey:t,customParameters:i}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:Eb(me(F(F({},e.query),i),{token:t!=null?t:(r=e.query)==null?void 0:r.token})),tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(e,t,i,r){r.level=e,r.row=t-t%this.size,r.col=i-i%this.size;const s=Zye(r);return this._tilemapCache.get(s)}_initializeAvailableLevels(e){this._availableLevels={},e&&e.forEach(t=>this._availableLevels[t.level]=!0)}get test(){const e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:(t,i,r)=>!!e._tilemapFromCache(t,i,r,e._tmpTilemapDefinition)}}};gf._maxPrefetch=4,gf._prefetches=new ai({initialSize:gT._maxPrefetch}),u([d({constructOnly:!0,type:Number})],gf.prototype,"levels",void 0),u([Jt("levels")],gf.prototype,"castLevels",null),u([d({readOnly:!0,type:Number})],gf.prototype,"size",null),u([d({constructOnly:!0,type:Number})],gf.prototype,"cacheByteSize",void 0),u([d({constructOnly:!0})],gf.prototype,"layer",void 0),u([d({constructOnly:!0})],gf.prototype,"request",void 0),gf=gT=u([L("esri.layers.support.TilemapCache")],gf);const mLt=e=>{let t=class extends e{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}readMinScale(i,r){return r.minLOD!=null&&r.maxLOD!=null?i:0}readMaxScale(i,r){return r.minLOD!=null&&r.maxLOD!=null?i:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(i,r){return r.capabilities&&r.capabilities.includes("Tilemap")?new gf({layer:this}):null}};return u([d({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),u([d()],t.prototype,"minScale",void 0),u([De("service","minScale")],t.prototype,"readMinScale",null),u([d()],t.prototype,"maxScale",void 0),u([De("service","maxScale")],t.prototype,"readMaxScale",null),u([d({type:at})],t.prototype,"spatialReference",void 0),u([d({readOnly:!0})],t.prototype,"supportsBlankTile",null),u([d(hLt)],t.prototype,"tileInfo",void 0),u([d()],t.prototype,"tilemapCache",void 0),u([De("service","tilemapCache",["capabilities"])],t.prototype,"readTilemapCache",null),u([d()],t.prototype,"version",void 0),t=u([L("esri.layers.mixins.ArcGISCachedService")],t),t},gLt=e=>{let t=class extends e{constructor(){super(...arguments),this.capabilities=void 0,this.copyright=null,this.fullExtent=null,this.legendEnabled=!0,this.spatialReference=null,this.version=void 0}readCapabilities(i,r){var S,T;const s=r.capabilities&&r.capabilities.split(",").map(C=>C.toLowerCase().trim());if(!s)return{operations:{supportsExportMap:!1,supportsExportTiles:!1,supportsIdentify:!1,supportsQuery:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};const n=this.type,o=s.includes("data"),a=s.includes("query"),l=s.includes("map"),c=!!r.exportTilesAllowed,h=s.includes("tilemap"),p=n!=="tile"&&!!r.supportsDynamicLayers,f=n!=="tile"&&(!r.tileInfo||p),m=n!=="tile"&&(!r.tileInfo||p),g=n!=="tile",y=r.cimVersion&&Wb.parse(r.cimVersion),x=(S=y==null?void 0:y.since(1,4))!=null?S:!1,b=(T=y==null?void 0:y.since(2,0))!=null?T:!1;return{operations:{supportsExportMap:l,supportsExportTiles:c,supportsIdentify:a,supportsQuery:o,supportsTileMap:h},exportMap:l?{supportsArcadeExpressionForLabeling:x,supportsSublayersChanges:g,supportsDynamicLayers:p,supportsSublayerVisibility:f,supportsSublayerDefinitionExpression:m,supportsCIMSymbols:b}:null,exportTiles:c?{maxExportTilesCount:+r.maxExportTilesCount}:null}}readVersion(i,r){let s=r.currentVersion;return s||(s=r.hasOwnProperty("capabilities")||r.hasOwnProperty("tables")?10:r.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3),s}async fetchSublayerInfo(i,r){return await this.fetchAllLayersAndTables(r),this._allLayersAndTablesMap.get(i)}async fetchAllLayersAndTables(i){await this.load(i),this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=Zt(pn(this.url).path+"/layers",{responseType:"json",query:me(F({f:"json"},this.customParameters),{token:this.apiKey})}).then(s=>{this._allLayersAndTablesMap=new Map;for(const n of s.data.layers)this._allLayersAndTablesMap.set(n.id,n);return{result:s.data}},s=>({error:s})));const r=await this._allLayersAndTablesPromise;if(qt(i),"result"in r)return r.result;throw r.error}};return u([d({readOnly:!0})],t.prototype,"capabilities",void 0),u([De("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],t.prototype,"readCapabilities",null),u([d({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),u([d({type:yi})],t.prototype,"fullExtent",void 0),u([d(Cte)],t.prototype,"id",void 0),u([d({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],t.prototype,"legendEnabled",void 0),u([d(RL)],t.prototype,"popupEnabled",void 0),u([d({type:at})],t.prototype,"spatialReference",void 0),u([d({readOnly:!0})],t.prototype,"version",void 0),u([De("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],t.prototype,"readVersion",null),t=u([L("esri.layers.mixins.ArcGISMapService")],t),t};var jk;function DH(e){return e&&e.type==="esriSMS"}function NH(e,t,i){var s;const r=this.originIdOf(t)>=Hh(i.origin);return{ignoreOrigin:!0,allowNull:r,enabled:!!i&&((s=i.layer)==null?void 0:s.type)==="map-image"&&(i.writeSublayerStructure||r)}}function Xye(e,t,i){var r;return{enabled:!!i&&((r=i.layer)==null?void 0:r.type)==="tile"&&this._isOverridden(t)}}function Ad(e,t,i){return{ignoreOrigin:!0,enabled:i&&i.writeSublayerStructure||!1}}function P4(e,t,i){return{ignoreOrigin:!0,enabled:!!i&&(i.writeSublayerStructure||this.originIdOf(t)>=Hh(i.origin))}}const FH=ve.getLogger("esri.layers.support.Sublayer");let yLt=0;const Xx=new Set;Xx.add("layer"),Xx.add("parent"),Xx.add("loaded"),Xx.add("loadStatus"),Xx.add("loadError"),Xx.add("loadWarnings");let ci=jk=class extends pm(OL(ZV(Zg))){constructor(e){super(e),this.capabilities=void 0,this.fields=null,this.fullExtent=null,this.globalIdField=null,this.legendEnabled=!0,this.objectIdField=null,this.popupEnabled=!0,this.popupTemplate=null,this.sourceJSON=null,this.title=null,this.typeIdField=null,this.types=null}async load(e){return this.addResolvingPromise((async()=>{var i,r;if(!this.layer&&!this.url)throw new W("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});let t=null;if(!this.layer||this.originIdOf("url")>st.SERVICE||((i=this.source)==null?void 0:i.type)==="data-layer")t=(await Zt(this.url,F({responseType:"json",query:{f:"json"}},e))).data;else{let s=this.id;((r=this.source)==null?void 0:r.type)==="map-layer"&&(s=this.source.mapLayerId),t=await this.layer.fetchSublayerInfo(s,e)}t&&(this.sourceJSON=t,this.read({layerDefinition:t},{origin:"service"}))})()),this}readCapabilities(e,t){const i=(e=(t=t.layerDefinition||t).capabilities||e)?e.toLowerCase().split(",").map(n=>n.trim()):[],r=this.url?bv(this.url):null,s=i.includes(_(r)&&r.serverType==="MapServer"?"data":"query");return{exportMap:{supportsModification:!!t.canModifyLayer},operations:{supportsQuery:s}}}set definitionExpression(e){this._setAndNotifyLayer("definitionExpression",e)}get fieldsIndex(){return new Lte(this.fields||[])}set floorInfo(e){this._setAndNotifyLayer("floorInfo",e)}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeGlobalID")return i.name}}get id(){const e=this._get("id");return e==null?yLt++:e}set id(e){this._get("id")!==e&&(this.get("layer.capabilities.exportMap.supportsDynamicLayers")!==!1?this._set("id",e):this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"))}set labelingInfo(e){this._setAndNotifyLayer("labelingInfo",e)}writeLabelingInfo(e,t,i,r){e&&e.length&&(t.layerDefinition={drawingInfo:{labelingInfo:e.map(s=>s.write({},r))}})}set labelsVisible(e){this._setAndNotifyLayer("labelsVisible",e)}set layer(e){this._set("layer",e),this.sublayers&&this.sublayers.forEach(t=>t.layer=e)}set listMode(e){this._set("listMode",e)}set minScale(e){this._setAndNotifyLayer("minScale",e)}readMinScale(e,t){return t.minScale||t.layerDefinition&&t.layerDefinition.minScale||0}set maxScale(e){this._setAndNotifyLayer("maxScale",e)}readMaxScale(e,t){return t.maxScale||t.layerDefinition&&t.layerDefinition.maxScale||0}get effectiveScaleRange(){const{minScale:e,maxScale:t}=this;return{minScale:e,maxScale:t}}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeOID")return i.name}}set opacity(e){this._setAndNotifyLayer("opacity",e)}readOpacity(e,t){const i=t.layerDefinition;return 1-.01*(i.transparency!=null?i.transparency:i.drawingInfo.transparency)}writeOpacity(e,t,i,r){t.layerDefinition={drawingInfo:{transparency:100-100*e}}}writeParent(e,t){this.parent&&this.parent!==this.layer?t.parentLayerId=IV(this.parent.id):t.parentLayerId=-1}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){if(e){for(const t of e.getSymbols())if(om(t)){FH.warn("Sublayer renderer should use 2D symbols");break}}this._setAndNotifyLayer("renderer",e)}get source(){return this._get("source")||new N0({mapLayerId:this.id})}set source(e){this._setAndNotifyLayer("source",e)}set sublayers(e){this._handleSublayersChange(e,this._get("sublayers")),this._set("sublayers",e)}castSublayers(e){return dn(nt.ofType(jk),e)}writeSublayers(e,t,i){this.get("sublayers.length")&&(t[i]=this.sublayers.map(r=>r.id).toArray().reverse())}readTypeIdField(e,t){let i=(t=t.layerDefinition||t).typeIdField;if(i&&t.fields){i=i.toLowerCase();const r=t.fields.find(s=>s.name.toLowerCase()===i);r&&(i=r.name)}return null}get url(){var r,s;const e=(s=(r=this.layer)==null?void 0:r.parsedUrl)!=null?s:this._lastParsedUrl,t=this.source;if(!e)return null;if(this._lastParsedUrl=e,(t==null?void 0:t.type)==="map-layer")return`${e.path}/${t.mapLayerId}`;const i={layer:JSON.stringify({source:this.source})};return`${e.path}/dynamicLayer?${Eb(i)}`}set url(e){e?this._override("url",e):this._clearOverride("url")}set visible(e){this._setAndNotifyLayer("visible",e)}writeVisible(e,t,i,r){t[i]=this.getAtOrigin("defaultVisibility","service")||e}clone(){const{store:e}=ho(this),t=new jk;return ho(t).store=e.clone(Xx),this.commitProperty("url"),t._lastParsedUrl=this._lastParsedUrl,t}createPopupTemplate(e){return Nte(this,e)}createQuery(){return new Ou({returnGeometry:!0,where:this.definitionExpression||"1=1"})}async createFeatureLayer(){var i,r;if(this.hasOwnProperty("sublayers"))return null;const e=(i=this.layer)==null?void 0:i.parsedUrl,t=new(await Promise.resolve().then(function(){return Ret})).default({url:e.path});return e&&this.source&&(this.source.type==="map-layer"?t.layerId=this.source.mapLayerId:t.dynamicDataSource=this.source),this.layer.refreshInterval!=null&&(t.refreshInterval=this.layer.refreshInterval),this.definitionExpression&&(t.definitionExpression=this.definitionExpression),this.floorInfo&&(t.floorInfo=ue(this.floorInfo)),this.originIdOf("labelingInfo")>st.SERVICE&&(t.labelingInfo=ue(this.labelingInfo)),this.originIdOf("labelsVisible")>st.DEFAULTS&&(t.labelsVisible=this.labelsVisible),this.originIdOf("legendEnabled")>st.DEFAULTS&&(t.legendEnabled=this.legendEnabled),this.originIdOf("visible")>st.DEFAULTS&&(t.visible=this.visible),this.originIdOf("minScale")>st.DEFAULTS&&(t.minScale=this.minScale),this.originIdOf("maxScale")>st.DEFAULTS&&(t.maxScale=this.maxScale),this.originIdOf("opacity")>st.DEFAULTS&&(t.opacity=this.opacity),this.originIdOf("popupTemplate")>st.DEFAULTS&&(t.popupTemplate=ue(this.popupTemplate)),this.originIdOf("renderer")>st.SERVICE&&(t.renderer=ue(this.renderer)),((r=this.source)==null?void 0:r.type)==="data-layer"&&(t.dynamicDataSource=this.source.clone()),this.originIdOf("title")>st.DEFAULTS&&(t.title=this.title),this.layer.type==="map-image"&&this.layer.originIdOf("customParameters")>st.DEFAULTS&&(t.customParameters=this.layer.customParameters),this.layer.type==="tile"&&this.layer.originIdOf("customParameters")>st.DEFAULTS&&(t.customParameters=this.layer.customParameters),t}getField(e){return this.fieldsIndex.get(e)}getFeatureType(e){const{typeIdField:t,types:i}=this;if(!t||!e)return null;const r=e.attributes?e.attributes[t]:void 0;if(r==null)return null;let s=null;return i.some(n=>{const{id:o}=n;return o!=null&&(o.toString()===r.toString()&&(s=n),!!s)}),s}getFieldDomain(e,t){const i=t&&t.feature,r=this.getFeatureType(i);if(r){const s=r.domains&&r.domains[e];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(e)}async queryFeatures(e=this.createQuery(),t){var o,a,l,c,h,p;if(await this.load(),!((a=(o=this.capabilities)==null?void 0:o.operations)==null?void 0:a.supportsQuery))throw new W("Sublayer.queryFeatures","this layer doesn't support queries.");const[{executeQuery:i},{default:r}]=await Promise.all([Promise.resolve().then(function(){return ZWe}),Promise.resolve().then(function(){return XWe})]),s=await i(this.url,Ou.from(e),(c=(l=this.layer)==null?void 0:l.spatialReference)!=null?c:null,me(F({},t),{query:me(F({},(h=this.layer)==null?void 0:h.customParameters),{token:(p=this.layer)==null?void 0:p.apiKey})})),n=r.fromJSON(s.data);if(n==null?void 0:n.features)for(const f of n.features)f.sourceLayer=this;return n}toExportImageJSON(e){var n;const t={id:this.id,source:((n=this.source)==null?void 0:n.toJSON())||{mapLayerId:this.id,type:"mapLayer"}},i=_te(e,this.definitionExpression);_(i)&&(t.definitionExpression=i);const r=["renderer","labelingInfo","opacity","labelsVisible"].reduce((o,a)=>(o[a]=this.originIdOf(a),o),{});if(Object.keys(r).some(o=>r[o]>st.SERVICE)){const o=t.drawingInfo={};r.renderer>st.SERVICE&&(o.renderer=this.renderer?this.renderer.toJSON():null),r.labelsVisible>st.SERVICE&&(o.showLabels=this.labelsVisible),this.labelsVisible&&r.labelingInfo>st.SERVICE&&(o.labelingInfo=this.labelingInfo?this.labelingInfo.map(a=>a.write({},{origin:"service",layer:this.layer})):null,o.showLabels=!0),r.opacity>st.SERVICE&&(o.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(o.renderer)}return t}_assignDefaultSymbolColors(e){this._forEachSimpleMarkerSymbols(e,t=>{t.color||t.style!=="esriSMSX"&&t.style!=="esriSMSCross"||(t.outline&&t.outline.color?t.color=t.outline.color:t.color=[0,0,0,0])})}_forEachSimpleMarkerSymbols(e,t){if(e){const i="uniqueValueInfos"in e?e.uniqueValueInfos:"classBreakInfos"in e?e.classBreakInfos:[];for(const r of i)DH(r.symbol)&&t(r.symbol);"symbol"in e&&DH(e.symbol)&&t(e.symbol),"defaultSymbol"in e&&DH(e.defaultSymbol)&&t(e.defaultSymbol)}}_setAndNotifyLayer(e,t){const i=this.layer,r=this._get(e);let s,n;switch(e){case"definitionExpression":case"floorInfo":s="supportsSublayerDefinitionExpression";case"minScale":case"maxScale":case"visible":s="supportsSublayerVisibility";break;case"labelingInfo":case"labelsVisible":case"opacity":case"renderer":case"source":s="supportsDynamicLayers",n="supportsModification"}const o=ho(this).getDefaultOrigin();if(o!=="service"){if(s&&this.get(`layer.capabilities.exportMap.${s}`)===!1)return void this._logLockedError(e,`capability not available 'layer.capabilities.exportMap.${s}'`);if(n&&this.get(`capabilities.exportMap.${n}`)===!1)return void this._logLockedError(e,`capability not available 'capabilities.exportMap.${n}'`)}e!=="source"||this.loadStatus==="not-loaded"?(this._set(e,t),o!=="service"&&r!==t&&i&&i.emit&&i.emit("sublayer-update",{propertyName:e,target:this})):this._logLockedError(e,"'source' can't be changed after calling sublayer.load()")}_handleSublayersChange(e,t){t&&(t.forEach(i=>{i.parent=null,i.layer=null}),this.handles.removeAll()),e&&(e.forEach(i=>{i.parent=this,i.layer=this.layer}),this.handles.add([e.on("after-add",({item:i})=>{i.parent=this,i.layer=this.layer}),e.on("after-remove",({item:i})=>{i.parent=null,i.layer=null}),e.on("before-changes",i=>{const r=this.get("layer.capabilities.exportMap.supportsSublayersChanges");r==null||r||(FH.error(new W("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),i.preventDefault())})]))}_logLockedError(e,t){FH.error(new W("sublayer:locked",`Property '${String(e)}' can't be changed on Sublayer from the layer '${this.layer.id}'`,{reason:t,sublayer:this,layer:this.layer}))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}};ci.test={isMapImageLayerOverridePolicy:e=>e===Ad||e===NH,isTileImageLayerOverridePolicy:e=>e===Xye},u([d({readOnly:!0})],ci.prototype,"capabilities",void 0),u([De("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],ci.prototype,"readCapabilities",null),u([d({type:String,value:null,json:{name:"layerDefinition.definitionExpression",write:{allowNull:!0,overridePolicy:NH}}})],ci.prototype,"definitionExpression",null),u([d({type:[hO],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],ci.prototype,"fields",void 0),u([d({readOnly:!0})],ci.prototype,"fieldsIndex",null),u([d({type:Dte,value:null,json:{name:"layerDefinition.floorInfo",read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo",overridePolicy:NH},origins:{"web-scene":{read:!1,write:!1}}}})],ci.prototype,"floorInfo",null),u([d({type:yi,json:{read:{source:"layerDefinition.extent"}}})],ci.prototype,"fullExtent",void 0),u([d({type:String})],ci.prototype,"globalIdField",void 0),u([De("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],ci.prototype,"readGlobalIdFieldFromService",null),u([d({type:Zr,json:{write:{ignoreOrigin:!0}}})],ci.prototype,"id",null),u([d({value:null,type:[_O],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:Ad}}})],ci.prototype,"labelingInfo",null),u([it("labelingInfo")],ci.prototype,"writeLabelingInfo",null),u([d({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:Ad}}})],ci.prototype,"labelsVisible",null),u([d({value:null})],ci.prototype,"layer",null),u([d({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:P4}}})],ci.prototype,"legendEnabled",void 0),u([d({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],ci.prototype,"listMode",null),u([d({type:Number,value:0,json:{write:{overridePolicy:Ad}}})],ci.prototype,"minScale",null),u([De("minScale",["minScale","layerDefinition.minScale"])],ci.prototype,"readMinScale",null),u([d({type:Number,value:0,json:{write:{overridePolicy:Ad}}})],ci.prototype,"maxScale",null),u([De("maxScale",["maxScale","layerDefinition.maxScale"])],ci.prototype,"readMaxScale",null),u([d({readOnly:!0})],ci.prototype,"effectiveScaleRange",null),u([d({type:String})],ci.prototype,"objectIdField",void 0),u([De("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],ci.prototype,"readObjectIdFieldFromService",null),u([d({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:Ad}}})],ci.prototype,"opacity",null),u([De("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],ci.prototype,"readOpacity",null),u([it("opacity")],ci.prototype,"writeOpacity",null),u([d({json:{type:Zr,write:{target:"parentLayerId",writerEnsuresNonNull:!0,overridePolicy:Ad}}})],ci.prototype,"parent",void 0),u([it("parent")],ci.prototype,"writeParent",null),u([d({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:(e,t)=>!t.disablePopup},write:{target:"disablePopup",overridePolicy:P4,writer(e,t,i){t[i]=!e}}}})],ci.prototype,"popupEnabled",void 0),u([d({type:ZS,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:P4}}})],ci.prototype,"popupTemplate",void 0),u([d({readOnly:!0})],ci.prototype,"defaultPopupTemplate",null),u([d({types:ML,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:Ad},origins:{"web-scene":{types:yte,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:Ad}}}}})],ci.prototype,"renderer",null),u([d({types:{key:"type",base:null,typeMap:{"data-layer":Ph,"map-layer":N0}},cast(e){if(e){if("mapLayerId"in e)return xb(N0,e);if("dataSource"in e)return xb(Ph,e)}return e},json:{name:"layerDefinition.source",write:{overridePolicy:Ad}}})],ci.prototype,"source",null),u([d()],ci.prototype,"sourceJSON",void 0),u([d({value:null,json:{type:[Zr],write:{target:"subLayerIds",allowNull:!0,overridePolicy:Ad}}})],ci.prototype,"sublayers",null),u([Jt("sublayers")],ci.prototype,"castSublayers",null),u([it("sublayers")],ci.prototype,"writeSublayers",null),u([d({type:String,json:{name:"name",write:{overridePolicy:P4}}})],ci.prototype,"title",void 0),u([d({type:String})],ci.prototype,"typeIdField",void 0),u([De("typeIdField",["layerDefinition.typeIdField"])],ci.prototype,"readTypeIdField",null),u([d({type:[$te],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],ci.prototype,"types",void 0),u([d({type:String,json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:Xye}}})],ci.prototype,"url",null),u([d({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:Ad}}})],ci.prototype,"visible",null),u([it("visible")],ci.prototype,"writeVisible",null),ci=jk=u([L("esri.layers.support.Sublayer")],ci);const Y8=ci;function dUt(e,t,i){return t.flatten(({sublayers:s})=>s).length!==e.length?!0:!!e.some(s=>s.originIdOf("minScale")>i||s.originIdOf("maxScale")>i||s.originIdOf("renderer")>i||s.originIdOf("labelingInfo")>i||s.originIdOf("opacity")>i||s.originIdOf("labelsVisible")>i||s.originIdOf("source")>i)||!dLe(e,t)}function vLt(e,t,i){return!!e.some(r=>{const s=r.source;return!(!s||s.type==="map-layer"&&s.mapLayerId===r.id&&(M(s.gdbVersion)||s.gdbVersion===i))||r.originIdOf("renderer")>st.SERVICE||r.originIdOf("labelingInfo")>st.SERVICE||r.originIdOf("opacity")>st.SERVICE||r.originIdOf("labelsVisible")>st.SERVICE})||!dLe(e,t)}function dLe(e,t){if(!e||!e.length||M(t))return!0;const i=t.slice().reverse().flatten(({sublayers:n})=>n&&n.toArray().reverse()).map(n=>n.id).toArray();if(e.length>i.length)return!1;let r=0;const s=i.length;for(const{id:n}of e){for(;r<s&&i[r]!==n;)r++;if(r>=s)return!1}return!0}function _Lt(e){return!!e&&e.some(t=>t.minScale!=null||t.layerDefinition&&t.layerDefinition.minScale!=null)}const bLt=ve.getLogger("esri.layers.TileLayer");function wLt(e,t){const i=[],r={};return e&&e.forEach(s=>{const n=new Y8;if(n.read(s,t),r[n.id]=n,s.parentLayerId!=null&&s.parentLayerId!==-1){const o=r[s.parentLayerId];o.sublayers||(o.sublayers=[]),o.sublayers.unshift(n)}else i.unshift(n)}),i}const kH=nt.ofType(Y8);function pLe(e,t){e&&e.forEach(i=>{t(i),i.sublayers&&i.sublayers.length&&pLe(i.sublayers,t)})}const xLt=e=>{let t=class extends e{constructor(...i){super(...i),this.allSublayers=new bS({getCollections:()=>[this.sublayers],getChildrenFunction:r=>r.sublayers}),this.sublayersSourceJSON={[st.SERVICE]:{},[st.PORTAL_ITEM]:{},[st.WEB_SCENE]:{},[st.WEB_MAP]:{}},this.own(re(()=>this.sublayers,(r,s)=>this._handleSublayersChange(r,s),Ui))}readSublayers(i,r){if(!r||!i)return;const{sublayersSourceJSON:s}=this,n=Hh(r.origin);if(n<st.SERVICE||(s[n]={context:r,visibleLayers:i.visibleLayers||s[n].visibleLayers,layers:i.layers||s[n].layers},n>st.SERVICE))return;this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);const{sublayers:o,origin:a}=this.createSublayersForOrigin("web-document"),l=ho(this);l.setDefaultOrigin(a),this._set("sublayers",new kH(o)),l.setDefaultOrigin("user")}findSublayerById(i){return this.allSublayers.find(r=>r.id===i)}createServiceSublayers(){return this.createSublayersForOrigin("service").sublayers}createSublayersForOrigin(i){const r=Hh(i==="web-document"?"web-map":i);let s=st.SERVICE,n=this.sublayersSourceJSON[st.SERVICE].layers,o=this.sublayersSourceJSON[st.SERVICE].context,a=null;const l=[st.PORTAL_ITEM,st.WEB_SCENE,st.WEB_MAP].filter(g=>g<=r);for(const g of l){const y=this.sublayersSourceJSON[g];_Lt(y.layers)&&(s=g,n=y.layers,o=y.context,y.visibleLayers&&(a={visibleLayers:y.visibleLayers,context:y.context}))}const c=[st.PORTAL_ITEM,st.WEB_SCENE,st.WEB_MAP].filter(g=>g>s&&g<=r);let h=null;for(const g of c){const{layers:y,visibleLayers:x,context:b}=this.sublayersSourceJSON[g];y&&(h={layers:y,context:b}),x&&(a={visibleLayers:x,context:b})}const p=wLt(n,o),f=new Map,m=new Set;if(h)for(const g of h.layers)f.set(g.id,g);if(a)for(const g of a.visibleLayers)m.add(g);return pLe(p,g=>{h&&g.read(f.get(g.id),h.context),a&&g.read({defaultVisibility:m.has(g.id)},a.context)}),{origin:C3(s),sublayers:new kH({items:p})}}read(i,r){super.read(i,r),this.readSublayers(i,r)}_handleSublayersChange(i,r){r&&(r.forEach(s=>{s.parent=null,s.layer=null}),this.handles.remove("sublayers-owner")),i&&(i.forEach(s=>{s.parent=this,s.layer=this}),this.handles.add([i.on("after-add",({item:s})=>{s.parent=this,s.layer=this}),i.on("after-remove",({item:s})=>{s.parent=null,s.layer=null})],"sublayers-owner"),this.type==="tile"&&this.handles.add(i.on("before-changes",s=>{bLt.error(new W("tilelayer:sublayers-non-modifiable","ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this})),s.preventDefault()}),"sublayers-owner"))}};return u([d({readOnly:!0})],t.prototype,"allSublayers",void 0),u([d({readOnly:!0,type:nt.ofType(Y8)})],t.prototype,"serviceSublayers",void 0),u([d({value:null,type:kH,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],t.prototype,"sublayers",void 0),u([d({readOnly:!0})],t.prototype,"sublayersSourceJSON",void 0),t=u([L("esri.layers.mixins.SublayersOwner")],t),t},Yye=["Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Elevation/World_Hillshade","Elevation/World_Hillshade_Dark","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Ocean_Basemap","Reference/World_Boundaries_and_Places","Reference/World_Boundaries_and_Places_Alternate","Reference/World_Transportation","World_Imagery","World_Street_Map","World_Topo_Map"];let so=class extends Ste(xLt(KB(Ate(Mte(mLt(gLt(Tte(OL(pm(nEe(wte(Z2e(_S))))))))))))){constructor(...e){super(...e),this.listMode="show",this.isReference=null,this.operationalLayerType="ArcGISTiledMapServiceLayer",this.resampling=!0,this.sourceJSON=null,this.spatialReference=null,this.path=null,this.sublayers=null,this.type="tile",this.url=null}normalizeCtorArgs(e,t){return typeof e=="string"?F({url:e},t):e}load(e){const t=_(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},e).catch(cl).then(()=>this._fetchService(t))),Promise.resolve(this)}get attributionDataUrl(){var t;const e=(t=this.parsedUrl)==null?void 0:t.path.toLowerCase();return e&&this._getDefaultAttribution(this._getMapName(e))}readSpatialReference(e,t){return(e=e||t.tileInfo&&t.tileInfo.spatialReference)&&at.fromJSON(e)}writeSublayers(e,t,i,r){if(!this.loaded||!e)return;const s=e.slice().reverse().flatten(({sublayers:a})=>a&&a.toArray().reverse()).toArray(),n=[],o=F({writeSublayerStructure:!1},r);s.forEach(a=>{const l=a.write({},o);n.push(l)}),n.some(a=>Object.keys(a).length>1)&&(t.layers=n)}get tileServers(){return this._getDefaultTileServers(this.parsedUrl.path)}castTileServers(e){return Array.isArray(e)?e.map(t=>pn(t).path):null}fetchTile(e,t,i,r={}){const{signal:s}=r,n=this.getTileUrl(e,t,i),o={responseType:"image",signal:s,query:F({},this.refreshParameters)};return Zt(n,o).then(a=>a.data)}getTileUrl(e,t,i){const r=!this.tilemapCache&&this.supportsBlankTile,s=Eb(me(F(me(F({},this.parsedUrl.query),{blankTile:!r&&null}),this.customParameters),{token:this.apiKey})),n=this.tileServers;return`${n&&n.length?n[t%n.length]:this.parsedUrl.path}/tile/${e}/${t}/${i}${s?"?"+s:""}`}_fetchService(e){return new Promise((t,i)=>{if(this.sourceJSON){if(this.sourceJSON.bandCount!=null&&this.sourceJSON.pixelSizeX!=null)throw new W("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");return void t({data:this.sourceJSON})}if(!this.parsedUrl)throw new W("tile-layer:undefined-url","layer's url is not defined");const r=bv(this.parsedUrl.path);if(_(r)&&r.serverType==="ImageServer")throw new W("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");Zt(this.parsedUrl.path,{query:me(F(F({f:"json"},this.parsedUrl.query),this.customParameters),{token:this.apiKey}),responseType:"json",signal:e}).then(t,i)}).then(t=>{if(t.ssl&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=t.data,this.read(t.data,{origin:"service",url:this.parsedUrl}),this.version===10.1&&!xte(this.url))return this._fetchServerVersion(this.url,e).then(i=>{this.read({currentVersion:i})}).catch(()=>{})})}_fetchServerVersion(e,t){if(!rKe(e))return Promise.reject();const i=e.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return Zt(i,{query:me(F({f:"json"},this.customParameters),{token:this.apiKey}),responseType:"json",signal:t}).then(r=>{if(r.data&&r.data.currentVersion)return r.data.currentVersion;throw new W("tile-layer:version-not-available")})}_getMapName(e){const t=e.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i);return t&&t[2]}_getDefaultAttribution(e){if(!e)return;let t;e=e.toLowerCase();for(let i=0,r=Yye.length;i<r;i++)if(t=Yye[i],t.toLowerCase().includes(e))return Wh("//static.arcgis.com/attribution/"+t)}_getDefaultTileServers(e){const t=e.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i)!==-1,i=e.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i)!==-1;return t||i?[e,e.replace(t?/server\.arcgisonline/i:/services\.arcgisonline/i,t?"services.arcgisonline":"server.arcgisonline")]:[]}get hasOverriddenFetchTile(){return!this.fetchTile.__isDefault__}};u([d({readOnly:!0})],so.prototype,"attributionDataUrl",null),u([d({type:["show","hide","hide-children"]})],so.prototype,"listMode",void 0),u([d({json:{read:!0,write:!0}})],so.prototype,"blendMode",void 0),u([d({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],so.prototype,"isReference",void 0),u([d({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],so.prototype,"operationalLayerType",void 0),u([d({type:Boolean})],so.prototype,"resampling",void 0),u([d()],so.prototype,"sourceJSON",void 0),u([d({type:at})],so.prototype,"spatialReference",void 0),u([De("spatialReference",["spatialReference","tileInfo"])],so.prototype,"readSpatialReference",null),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],so.prototype,"path",void 0),u([d({readOnly:!0})],so.prototype,"sublayers",void 0),u([it("sublayers",{layers:{type:[Y8]}})],so.prototype,"writeSublayers",null),u([d({json:{read:!1,write:!1}})],so.prototype,"popupEnabled",void 0),u([d()],so.prototype,"tileServers",null),u([Jt("tileServers")],so.prototype,"castTileServers",null),u([d({readOnly:!0,json:{read:!1}})],so.prototype,"type",void 0),u([d(Ete)],so.prototype,"url",void 0),so=u([L("esri.layers.TileLayer")],so),so.prototype.fetchTile.__isDefault__=!0;const TLt=so;var pUt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:TLt});function fLe(e){return e&&"getAtOrigin"in e&&"originOf"in e}function Jye(e){e&&e.writtenProperties&&e.writtenProperties.forEach(({target:t,propName:i,newOrigin:r})=>{fLe(t)&&r&&t.originOf(i)!==r&&t.updateOrigin(i,r)})}async function SLt(e,t,i,r,s,n){let o=null;if(_(i)){const c=`${e}/nodepages/`,h=c+Math.floor(i.rootIndex/i.nodesPerPage);try{return{type:"page",rootPage:(await Zt(h,{query:{f:"json",token:r},responseType:"json",signal:n})).data,rootIndex:i.rootIndex,pageSize:i.nodesPerPage,lodMetric:i.lodSelectionMetricType,urlPrefix:c}}catch(p){_(s)&&s.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",h,p),o=p}}if(!t)return null;const a=`${e}/nodes/`,l=a+(t&&t.split("/").pop());try{return{type:"node",rootNode:(await Zt(l,{query:{f:"json",token:r},responseType:"json",signal:n})).data,urlPrefix:a}}catch(c){throw new W("sceneservice:root-node-missing","Root node missing.",{pageError:o,nodeError:c,url:l})}}async function ELt(e,t={},i){await e.load(i);const r=Bc(e.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="created"}=t,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:e.apiKey},signal:Wr(i,"signal")},c=await e.portal._request(r,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:h,size:p,resource:f})=>({created:new Date(h),size:p,resource:e.resourceFromPath(f)}))}}async function CLt(e,t,i,r){if(!e.hasPath())throw new W(`portal-item-resource-${t}:invalid-path`,"Resource does not have a valid path");const s=e.portalItem;await s.load(r);const n=Bc(s.userItemUrl,t==="add"?"addResources":"updateResources"),[o,a]=mLe(e.path),l=await gLe(i),c=new FormData;return o&&o!=="."&&c.append("resourcesPrefix",o),c.append("fileName",a),c.append("file",l,a),c.append("f","json"),_(r)&&r.access&&c.append("access",r.access),await s.portal._request(n,{method:"post",body:c,signal:Wr(r,"signal")}),e}async function ALt(e,t,i){if(!t.hasPath())throw new W("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(i);const r=Bc(e.userItemUrl,"removeResources");await e.portal._request(r,{method:"post",query:{resource:t.path},signal:Wr(i,"signal")}),t.portalItem=null}async function MLt(e,t){await e.load(t);const i=Bc(e.userItemUrl,"removeResources");return e.portal._request(i,{method:"post",query:{deleteAll:!0},signal:Wr(t,"signal")})}function mLe(e){const t=e.lastIndexOf("/");return t===-1?[".",e]:[e.slice(0,t),e.slice(t+1)]}function Dse(e){const[t,i]=OLt(e),[r,s]=mLe(t);return[r,s,i]}function OLt(e){const t=CK(e);return M(t)?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}async function gLe(e){return e instanceof Blob?e:(await Zt(e.url,{responseType:"blob"})).data}function RLt(e,t){if(!e.hasPath())return null;const[i,,r]=Dse(e.path);return e.portalItem.resourceFromPath(Bc(i,t+r))}function yLe(e,t){if(!e.hasPath())return null;const[i,,r]=Dse(e.path);return e.portalItem.resourceFromPath(Bc(i,t+r))}var EI=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",addOrUpdateResource:CLt,contentToBlob:gLe,fetchResources:ELt,getSiblingOfSameType:RLt,getSiblingOfSameTypeI:yLe,removeAllResources:MLt,removeResource:ALt,splitPrefixFileNameAndExtension:Dse});async function Qye(e,t,i){if(!t||!t.resources)return;const r=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const s=new Set(t.resources.toKeep.map(c=>c.resource.path)),n=new Set,o=[];s.forEach(c=>{r.delete(c),e.paths.push(c)});for(const c of t.resources.toUpdate)if(r.delete(c.resource.path),s.has(c.resource.path)||n.has(c.resource.path)){const{resource:h,content:p,finish:f,error:m}=c,g=yLe(h,AB());e.paths.push(g.path),o.push(Kye({resource:g,content:p,finish:f,error:m},i))}else e.paths.push(c.resource.path),o.push(PLt(c,i)),n.add(c.resource.path);for(const c of t.resources.toAdd)o.push(Kye(c,i)),e.paths.push(c.resource.path);if(r.forEach(c=>{const h=t.portalItem.resourceFromPath(c);o.push(h.portalItem.removeResource(h).catch(()=>{}))}),o.length===0)return;const a=await Us(o);qt(i);const l=a.filter(c=>"error"in c).map(c=>c.error);if(l.length>0)throw new W("save:resources","Failed to save one or more resources",{errors:l})}async function Kye(e,t){const i=await Hu(e.resource.portalItem.addResource(e.resource,e.content,t));if(i.ok!==!0)throw e.error&&e.error(i.error),i.error;e.finish&&e.finish(e.resource)}async function PLt(e,t){const i=await Hu(e.resource.update(e.content,t));if(i.ok!==!0)throw e.error(i.error),i.error;e.finish(e.resource)}const ME=ve.getLogger("esri.layers.mixins.SceneService"),ILt=e=>{let t=class extends e{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=UV(async(i,r,s)=>{switch(i){case JM.SAVE:return this._save(r);case JM.SAVE_AS:return this._saveAs(s,r)}})}readSpatialReference(i,r){return this._readSpatialReference(r)}_readSpatialReference(i){if(i.spatialReference!=null)return at.fromJSON(i.spatialReference);{const r=i.store,s=r.indexCRS||r.geographicCRS,n=s&&parseInt(s.substring(s.lastIndexOf("/")+1,s.length),10);return n!=null?new at(n):null}}readFullExtent(i,r,s){if(i!=null&&typeof i=="object"){const a=i.spatialReference==null?me(F({},i),{spatialReference:this._readSpatialReference(r)}):i;return yi.fromJSON(a,s)}const n=r.store,o=this._readSpatialReference(r);return o==null||n==null||n.extent==null||!Array.isArray(n.extent)||n.extent.some(a=>a<UH)?null:new yi({xmin:n.extent[0],ymin:n.extent[1],xmax:n.extent[2],ymax:n.extent[3],spatialReference:o})}parseVersionString(i){const r={major:Number.NaN,minor:Number.NaN,versionString:i},s=i.split(".");return s.length>=2&&(r.major=parseInt(s[0],10),r.minor=parseInt(s[1],10)),r}readVersion(i,r){const s=r.store,n=s.version!=null?s.version.toString():"";return this.parseVersionString(n)}readTitlePortalItem(i){return this.sublayerTitleMode!=="item-title"?void 0:i}readTitleService(i,r){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return H2e(this.url,r.name);let n=r.name;if(!n&&this.url){const o=bv(this.url);_(o)&&(n=o.title)}return this.sublayerTitleMode==="item-title-and-service-name"&&s&&(n=s+" - "+n),JB(n)}set url(i){const r=q2e({layer:this,url:i,nonStandardUrlAllowed:!1,logger:ME});this._set("url",r.url),r.layerId!=null&&this._set("layerId",r.layerId)}writeUrl(i,r,s,n){W2e(this,i,"layers",r,n)}get parsedUrl(){const i=this._get("url");if(!i)return null;const r=pn(i);return this.layerId!=null&&(r.path=`${r.path}/layers/${this.layerId}`),r}async _fetchIndexAndUpdateExtent(i,r){this.indexInfo=SLt(this.parsedUrl.path,this.rootNode,i,this.apiKey,ME,r),this.fullExtent==null||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(i){var r,s,n;if((i==null?void 0:i.type)==="page"){const o=i.rootIndex%i.pageSize,a=(s=(r=i.rootPage)==null?void 0:r.nodes)==null?void 0:s[o];if(a==null||a.obb==null||a.obb.center==null||a.obb.halfSize==null)throw new W("sceneservice:invalid-node-page","Invalid node page.");if(a.obb.center[0]<UH||this.fullExtent==null||this.fullExtent.hasZ)return;const l=a.obb.halfSize,c=a.obb.center[2],h=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]);this.fullExtent.zmin=c-h,this.fullExtent.zmax=c+h}else if((i==null?void 0:i.type)==="node"){const o=(n=i.rootNode)==null?void 0:n.mbs;if(!Array.isArray(o)||o.length!==4||o[0]<UH)return;const a=o[2],l=o[3];this.fullExtent.zmin=a-l,this.fullExtent.zmax=a+l}}async _fetchService(i){if(this.url==null)throw new W("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(this.layerId==null&&/SceneServer\/*$/i.test(this.url)){const r=await this._fetchFirstLayerId(i);r!=null&&(this.layerId=r)}return this._fetchServiceLayer(i)}async _fetchFirstLayerId(i){const r=await Zt(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:i});if(r.data&&Array.isArray(r.data.layers)&&r.data.layers.length>0)return r.data.layers[0].id}async _fetchServiceLayer(i){const r=await Zt(this.parsedUrl.path,{query:{f:"json",token:this.apiKey},responseType:"json",signal:i});r.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let s=!1;if(r.data.layerType&&r.data.layerType==="Voxel"&&(s=!0),s)return this._fetchVoxelServiceLayer();const n=r.data;this.read(n,{origin:"service",url:this.parsedUrl}),this.validateLayer(n)}async _fetchVoxelServiceLayer(i){const r=(await Zt(this.parsedUrl.path+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:i})).data;this.read(r,{origin:"service",url:this.parsedUrl}),this.validateLayer(r)}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&typeof this.beforeSave=="function"&&await this.beforeSave()}validateLayer(i){}_updateTypeKeywords(i,r,s){i.typeKeywords||(i.typeKeywords=[]);const n=r.getTypeKeywords();for(const o of n)i.typeKeywords.push(o);i.typeKeywords&&(i.typeKeywords=i.typeKeywords.filter((o,a,l)=>l.indexOf(o)===a),s===x3.newItem&&(i.typeKeywords=i.typeKeywords.filter(o=>o!=="Hosted Service")))}async _saveAs(i,r){const s=F(F({},e0e),r);let n=uM.from(i);n||(ME.error("_saveAs(): requires a portal item parameter"),await Promise.reject(new W("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),n.id&&(n=n.clone(),n.id=null);const o=n.portal||Bo.getDefault();await this._ensureLoadBeforeSave(),n.type=I4,n.portal=o;const a={origin:"portal-item",url:null,messages:[],portal:o,portalItem:n,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},l={layers:[this.write({},a)]};return await Promise.all(a.resources.pendingOperations),await this._validateAgainstJSONSchema(l,a,s),n.url=this.url,n.title||(n.title=this.title),this._updateTypeKeywords(n,s,x3.newItem),await o._signIn(),await o.user.addItem({item:n,folder:s&&s.folder,data:l}),await Qye(this.resourceReferences,a,null),this.portalItem=n,Jye(a),a.portalItem=n,n}async _save(i){const r=F(F({},e0e),i);this.portalItem||(ME.error("_save(): requires the .portalItem property to be set"),await Promise.reject(new W("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService"))),this.portalItem.type!==I4&&(ME.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected "+I4),await Promise.reject(new W("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${I4}"`))),await this._ensureLoadBeforeSave();const s={origin:"portal-item",url:this.portalItem.itemUrl&&pn(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||Bo.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},n={layers:[this.write({},s)]};return await Promise.all(s.resources.pendingOperations),await this._validateAgainstJSONSchema(n,s,r),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,r,x3.existingItem),await this.portalItem.update({data:n}),await Qye(this.resourceReferences,s,null),Jye(s),this.portalItem}async _validateAgainstJSONSchema(i,r,s){let n=r.messages.filter(o=>o.type==="error").map(o=>new W(o.name,o.message,o.details));if(s&&s.validationOptions.ignoreUnsupported&&(n=n.filter(o=>o.name!=="layer:unsupported"&&o.name!=="symbol:unsupported"&&o.name!=="symbol-layer:unsupported"&&o.name!=="property:unsupported"&&o.name!=="url:unsupported"&&o.name!=="scenemodification:unsupported")),s.validationOptions.enabled||$Lt){const o=(await import("./schemaValidator.a97e491f.js")).validate(i,s.portalItemLayerType);if(o.length>0){const a=`Layer item did not validate:
${o.join(`
`)}`;if(ME.error(`_validateAgainstJSONSchema(): ${a}`),s.validationOptions.failPolicy==="throw"){const l=o.map(c=>new W("sceneservice:schema-validation",c)).concat(n);throw new W("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:l})}}}if(n.length>0)throw new W("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:n})}};return u([d(Cte)],t.prototype,"id",void 0),u([d({type:at})],t.prototype,"spatialReference",void 0),u([De("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readSpatialReference",null),u([d({type:yi})],t.prototype,"fullExtent",void 0),u([De("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readFullExtent",null),u([d({readOnly:!0,type:e2})],t.prototype,"heightModelInfo",void 0),u([d({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],t.prototype,"minScale",void 0),u([d({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],t.prototype,"maxScale",void 0),u([d({readOnly:!0})],t.prototype,"version",void 0),u([De("version",["store.version"])],t.prototype,"readVersion",null),u([d({type:String,json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),u([d({type:String,json:{read:!1}})],t.prototype,"sublayerTitleMode",void 0),u([d({type:String})],t.prototype,"title",void 0),u([De("portal-item","title")],t.prototype,"readTitlePortalItem",null),u([De("service","title",["name"])],t.prototype,"readTitleService",null),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],t.prototype,"layerId",void 0),u([d(Ete)],t.prototype,"url",null),u([it("url")],t.prototype,"writeUrl",null),u([d()],t.prototype,"parsedUrl",null),u([d({readOnly:!0})],t.prototype,"store",void 0),u([d({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],t.prototype,"rootNode",void 0),t=u([L("esri.layers.mixins.SceneService")],t),t},UH=-1e38,$Lt=!1;var x3;(function(e){e[e.existingItem=0]="existingItem",e[e.newItem=1]="newItem"})(x3||(x3={}));const I4="Scene Service",e0e={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var JM;(function(e){e[e.SAVE=0]="SAVE",e[e.SAVE_AS=1]="SAVE_AS"})(JM||(JM={}));const LLt={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};class DLt{constructor(t,i,r,s){this.parsedUrl=t,this.portalItem=i,this.apiKey=r,this.signal=s,this.rootDocument=null;const n=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);n&&(this.urlParts={root:n[1],layerId:parseInt(n[2],10)})}async fetch(){var r;if(!this.urlParts)return null;const t=(r=this.portalItem)!=null?r:await this._portalItemFromServiceItemId();if(M(t))return this._loadFromUrl();const i=await this._findAndLoadRelatedPortalItem(t);return M(i)?null:this._loadFeatureLayerFromPortalItem(i)}async fetchPortalItem(){var i;if(!this.urlParts)return null;const t=(i=this.portalItem)!=null?i:await this._portalItemFromServiceItemId();return M(t)?null:this._findAndLoadRelatedPortalItem(t)}async _fetchRootDocument(){if(_(this.rootDocument))return this.rootDocument;if(M(this.urlParts))return this.rootDocument={},{};const t={query:{f:"json",token:this.apiKey},responseType:"json",signal:this.signal},i=`${this.urlParts.root}/SceneServer`;try{const r=await Zt(i,t);this.rootDocument=r.data}catch{this.rootDocument={}}return this.rootDocument}async _fetchServiceOwningPortalUrl(){const t=Es==null?void 0:Es.findServerInfo(this.parsedUrl.path);if(t==null?void 0:t.owningSystemUrl)return t.owningSystemUrl;const i=this.parsedUrl.path.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const r=(await Zt(i,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(r)return r}catch(r){cl(r)}return null}async _findAndLoadRelatedPortalItem(t){try{return(await t.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(i=>i.type==="Feature Service")||null}catch(i){return cl(i),null}}async _loadFeatureLayerFromPortalItem(t){await t.load({signal:this.signal});const i=await this._findMatchingAssociatedSublayerUrl(t.url);return new fz({url:i,portalItem:t}).load({signal:this.signal})}async _loadFromUrl(){const t=await this._findMatchingAssociatedSublayerUrl(`${this.urlParts.root}/FeatureServer`);return new fz({url:t}).load({signal:this.signal})}async _findMatchingAssociatedSublayerUrl(t){const i=t.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),r={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal},s=this.urlParts.layerId,n=this._fetchRootDocument(),o=Zt(i,r),[a,l]=await Promise.all([o,n]),c=l&&l.layers,h=a.data&&a.data.layers;if(!Array.isArray(h))throw new Error("expected layers array");if(Array.isArray(c)){for(let p=0;p<Math.min(c.length,h.length);p++)if(c[p].id===s)return`${i}/${h[p].id}`}else if(s<h.length)return`${i}/${h[s].id}`;throw new Error("could not find matching associated sublayer")}async _portalItemFromServiceItemId(){const t=(await this._fetchRootDocument()).serviceItemId;if(!t)return null;const i=new uM({id:t,apiKey:this.apiKey}),r=await this._fetchServiceOwningPortalUrl();_(r)&&(i.portal=new Bo({url:r}));try{return i.load({signal:this.signal})}catch(s){return cl(s),null}}}let yT=class extends Ce{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};u([d({type:Number})],yT.prototype,"nodesPerPage",void 0),u([d({type:Number})],yT.prototype,"rootIndex",void 0),u([d({type:String})],yT.prototype,"lodSelectionMetricType",void 0),yT=u([L("esri.layer.support.I3SNodePageDefinition")],yT);let W0=class extends Ce{constructor(){super(...arguments),this.factor=1}};u([d({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],W0.prototype,"id",void 0),u([d({type:Number})],W0.prototype,"factor",void 0),W0=u([L("esri.layer.support.I3SMaterialTexture")],W0);let b1=class extends Ce{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};u([d({type:[Number]})],b1.prototype,"baseColorFactor",void 0),u([d({type:W0})],b1.prototype,"baseColorTexture",void 0),u([d({type:W0})],b1.prototype,"metallicRoughnessTexture",void 0),u([d({type:Number})],b1.prototype,"metallicFactor",void 0),u([d({type:Number})],b1.prototype,"roughnessFactor",void 0),b1=u([L("esri.layer.support.I3SMaterialPBRMetallicRoughness")],b1);let zd=class extends Ce{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};u([bt({opaque:"opaque",mask:"mask",blend:"blend"})],zd.prototype,"alphaMode",void 0),u([d({type:Number})],zd.prototype,"alphaCutoff",void 0),u([d({type:Boolean})],zd.prototype,"doubleSided",void 0),u([bt({none:"none",back:"back",front:"front"})],zd.prototype,"cullFace",void 0),u([d({type:W0})],zd.prototype,"normalTexture",void 0),u([d({type:W0})],zd.prototype,"occlusionTexture",void 0),u([d({type:W0})],zd.prototype,"emissiveTexture",void 0),u([d({type:[Number]})],zd.prototype,"emissiveFactor",void 0),u([d({type:b1})],zd.prototype,"pbrMetallicRoughness",void 0),zd=u([L("esri.layer.support.I3SMaterialDefinition")],zd);let CI=class extends Ce{};u([d({type:String,json:{read:{source:["name","index"],reader:(e,t)=>e!=null?e:`${t.index}`}}})],CI.prototype,"name",void 0),u([bt({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],CI.prototype,"format",void 0),CI=u([L("esri.layer.support.I3STextureFormat")],CI);let AI=class extends Ce{constructor(){super(...arguments),this.atlas=!1}};u([d({type:[CI]})],AI.prototype,"formats",void 0),u([d({type:Boolean})],AI.prototype,"atlas",void 0),AI=u([L("esri.layer.support.I3STextureSetDefinition")],AI);let Sf=class extends Ce{};u([bt({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],Sf.prototype,"type",void 0),u([d({type:Number})],Sf.prototype,"component",void 0),Sf=u([L("esri.layer.support.I3SGeometryAttribute")],Sf);let MI=class extends Ce{};u([bt({draco:"draco"})],MI.prototype,"encoding",void 0),u([d({type:[String]})],MI.prototype,"attributes",void 0),MI=u([L("esri.layer.support.I3SGeometryCompressedAttributes")],MI);let qp=class extends Ce{constructor(){super(...arguments),this.offset=0}};u([d({type:Number})],qp.prototype,"offset",void 0),u([d({type:Sf})],qp.prototype,"position",void 0),u([d({type:Sf})],qp.prototype,"normal",void 0),u([d({type:Sf})],qp.prototype,"uv0",void 0),u([d({type:Sf})],qp.prototype,"color",void 0),u([d({type:Sf})],qp.prototype,"uvRegion",void 0),u([d({type:Sf})],qp.prototype,"featureId",void 0),u([d({type:Sf})],qp.prototype,"faceRange",void 0),u([d({type:MI})],qp.prototype,"compressedAttributes",void 0),qp=u([L("esri.layer.support.I3SGeometryBuffer")],qp);let OI=class extends Ce{};u([bt({triangle:"triangle"})],OI.prototype,"topology",void 0),u([d()],OI.prototype,"geometryBuffers",void 0),OI=u([L("esri.layer.support.I3SGeometryDefinition")],OI);let w1=class extends Ce{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};u([d({type:String,json:{read:!0,write:!0}})],w1.prototype,"name",void 0),u([d({type:String,json:{read:!0,write:!0}})],w1.prototype,"field",void 0),u([d({type:[Number],json:{read:!0,write:!0}})],w1.prototype,"currentRangeExtent",void 0),u([d({type:[Number],json:{read:!0,write:!0}})],w1.prototype,"fullRangeExtent",void 0),u([d({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],w1.prototype,"type",void 0),w1=u([L("esri.layers.support.RangeInfo")],w1);function oQ(e){return Nse[NLt(e)]||kLt}function NLt(e){return e instanceof Blob?e.type:FLt(e.url)}function FLt(e){const t=CK(e);return aQ[t]||vLe}const Nse={},vLe="text/plain",kLt=Nse[vLe],aQ={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const e in aQ)Nse[aQ[e]]=e;function ULt(e){const t=_(e)&&e.origins?e.origins:[void 0];return(i,r)=>{const s=zLt(e,i,r);for(const n of t){const o=kQ(i,n,r);for(const a in s)o[a]=s[a]}}}function zLt(e,t,i){if(_(e)&&e.type==="resource")return VLt(e,t,i);switch(_(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:r,write:s}=UVe;return{read:r,write:s}}}}function VLt(e,t,i){const r=lL(t,i);return{type:String,read:(s,n,o)=>{const a=sB(s,n,o);return r.type===String?a:typeof r.type=="function"?new r.type({url:a}):void 0},write:{writer(s,n,o,a){if(!a||!a.resources)return typeof s=="string"?void(n[o]=mv(s,a)):void(n[o]=s.write({},a));const l=HLt(s),c=l?mv(l,me(F({},a),{verifyItemRelativeUrls:a&&a.verifyItemRelativeUrls?{writtenUrls:a.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null}),YA.NO):null,h=r.type!==String&&(!fLe(this)||a&&a.origin&&this.originIdOf(i)>Hh(a.origin));a&&a.portalItem&&_(c)&&!Nu(c)?h?BLt(this,i,s,c,n,o,a,e):GLt(c,n,o,a):a&&a.portalItem&&(M(c)||_(A1e(c))||Cb(c)||h)?_Le(this,i,s,c,n,o,a,e):n[o]=c}}}}function _Le(e,t,i,r,s,n,o,a){const l=AB(),c=wLe(i,r,o),h=Bc(Wr(a,"prefix"),l),p=`${h}.${oQ(c)}`,f=o.portalItem.resourceFromPath(p);Cb(r)&&o.resources.pendingOperations.push(jLt(r).then(m=>{f.path=`${h}.${oQ(m)}`,s[n]=f.itemRelativeUrl}).catch(()=>{})),bLe(e,t,f,c,o.resources.toAdd),s[n]=f.itemRelativeUrl}function BLt(e,t,i,r,s,n,o,a){const l=o.portalItem.resourceFromPath(r),c=wLe(i,r,o);oQ(c)===CK(l.path)?(bLe(e,t,l,c,o.resources.toUpdate),s[n]=r):_Le(e,t,i,r,s,n,o,a)}function GLt(e,t,i,r){r.resources.toKeep.push({resource:r.portalItem.resourceFromPath(e)}),t[i]=e}function bLe(e,t,i,r,s){s.push({resource:i,content:r,finish:n=>{qLt(e,t,n)}})}function wLe(e,t,i){return typeof e=="string"?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}async function jLt(e){const t=(await Promise.resolve().then(function(){return k1e})).default,{data:i}=await t(e,{responseType:"blob"});return i}function HLt(e){return M(e)?null:typeof e=="string"?e:e.url}function qLt(e,t,i){typeof e[t]=="string"?e[t]=i.url:e[t].url=i.url}var Hk;let lQ=Hk=class extends eO(nt.ofType(Uo)){constructor(e){super(e)}clone(){return new Hk(this.items.map(e=>e.clone()))}write(e,t){return this.toJSON(t)}toJSON(e){var i;const t=(i=e==null?void 0:e.layer)==null?void 0:i.spatialReference;return t?this.toArray().map(r=>{if(!t.equals(r.spatialReference)){if(!Jg(r.spatialReference,t))return e&&e.messages&&e.messages.push(new Uc("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),null;const n=new Uo;w8e(r,n,t),r=n}const s=r.toJSON(e);return delete s.spatialReference,s}).filter(r=>r!=null):((e==null?void 0:e.messages)&&e.messages.push(new Uc("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),this.toArray().map(r=>r.toJSON(e)))}static fromJSON(e,t){const i=new Hk;return e.forEach(r=>i.add(Uo.fromJSON(r,t))),i}};lQ=Hk=u([L("esri.layers.support.PolygonCollection")],lQ);const cQ=lQ;var uQ;let CC=uQ=class extends Ce{constructor(e){super(e),this.spatialRelationship="disjoint",this.geometries=new cQ,this._geometriesSource=null,this._handles=new Nt}initialize(){this._handles.add(os(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,Ui))}destroy(){this._handles.destroy()}readGeometries(e,t,i){this._geometriesSource={url:fv(e,i),context:i}}async loadGeometries(e,t){if(M(this._geometriesSource))return;const{url:i,context:r}=this._geometriesSource,s=await Zt(i,{responseType:"json",signal:Wr(t,"signal")}),n=e.toJSON(),o=s.data.map(a=>me(F({},a),{spatialReference:n}));this.geometries=cQ.fromJSON(o,r),this._geometriesSource=null}clone(){return new uQ({geometries:ue(this.geometries),spatialRelationship:this.spatialRelationship})}};u([d({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],CC.prototype,"spatialRelationship",void 0),u([d({type:cQ,nonNullable:!0,json:{write:!0}}),ULt({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],CC.prototype,"geometries",void 0),u([De(["web-scene","portal-item"],"geometries")],CC.prototype,"readGeometries",null),CC=uQ=u([L("esri.layers.support.SceneFilter")],CC);const WLt=CC,ZLt=["3DObject","Point"],OE=ve.getLogger("esri.layers.SceneLayer"),t0e=pEe();let Ht=class extends ILt(Tte(Ate(Mte(KB(OL(wte(_S))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new nt,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0}normalizeCtorArgs(e,t){return typeof e=="string"?F({url:e},t):e}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){var r,s,n,o;const i=(s=(r=this.getFeatureType(t==null?void 0:t.feature))==null?void 0:r.domains)==null?void 0:s[e];return i&&i.type!=="inherited"?i:(o=(n=this.getField(e))==null?void 0:n.domain)!=null?o:null}getFeatureType(e){return e&&_(this.associatedLayer)?this.associatedLayer.getFeatureType(e):null}get types(){return _(this.associatedLayer)?this.associatedLayer.types:[]}get typeIdField(){return _(this.associatedLayer)?this.associatedLayer.typeIdField:null}get formTemplate(){return _(this.associatedLayer)?this.associatedLayer.formTemplate:null}get fieldsIndex(){return new Lte(this.fields)}readNodePages(e,t,i){return t.layerType==="Point"&&(e=t.pointNodePages),e==null||typeof e!="object"?null:yT.fromJSON(e,i)}set elevationInfo(e){this._set("elevationInfo",e),this.loaded&&this._validateElevationInfo()}get geometryType(){return XLt[this.profile]||"mesh"}set renderer(e){fU(e,this.fieldsIndex),this._set("renderer",e)}readCachedDrawingInfo(e){return e!=null&&typeof e=="object"||(e={}),e.color==null&&(e.color=!1),e}get capabilities(){const e=_(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:LLt,{query:t,editing:{supportsGlobalId:i,supportsRollbackOnFailure:r,supportsUploadWithItemId:s,supportsReturnServiceEditsInSourceSpatialReference:n},data:{supportsZ:o,supportsM:a,isVersioned:l,supportsAttachment:c},operations:{supportsEditing:h,supportsUpdate:p,supportsQuery:f,supportsQueryAttachments:m}}=e,g=e.operations.supportsChangeTracking;return{query:t,editing:{supportsGlobalId:i,supportsReturnServiceEditsInSourceSpatialReference:n,supportsRollbackOnFailure:r,supportsGeometryUpdate:!1,supportsUploadWithItemId:s},data:{supportsAttachment:c,supportsZ:o,supportsM:a,isVersioned:l},operations:{supportsQuery:f,supportsQueryAttachments:m,supportsEditing:h&&g,supportsAdd:!1,supportsDelete:!1,supportsUpdate:p&&g}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges}set editingEnabled(e){e!=null?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}get defaultPopupTemplate(){return _(this.associatedLayer)||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,t){return!e&&t.fields&&t.fields.some(i=>(i.type==="esriFieldTypeOID"&&(e=i.name),!!e)),e||void 0}readGlobalIdField(e,t){return!e&&t.fields&&t.fields.some(i=>(i.type==="esriFieldTypeGlobalID"&&(e=i.name),!!e)),e||void 0}get displayField(){return _(this.associatedLayer)?this.associatedLayer.displayField:null}readProfile(e,t){const i=t.store.profile;return i!=null&&i0e[i]?i0e[i]:(OE.error("Unknown or missing profile",{profile:i,layer:this}),"mesh-pyramids")}load(e){const t=_(e)?e.signal:null,i=this.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(cl).then(()=>this._fetchService(t)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,t),this._setAssociatedFeatureLayer(t),_(this.filter)?this.filter.loadGeometries(this.spatialReference):null])).then(()=>this._validateElevationInfo()).then(()=>this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>fEe(this,{origin:"service"},t)).then(()=>fU(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(i),Promise.resolve(this)}async beforeSave(){_(this.filter)&&await this.load()}createQuery(){const e=new Ou;return this.geometryType!=="mesh"&&(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryExtent(e||this.createQuery(),t))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryFeatureCount(e||this.createQuery(),t))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryFeatures(e||this.createQuery(),t)).then(i=>{if(i==null?void 0:i.features)for(const r of i.features)r.layer=this,r.sourceLayer=this;return i})}queryObjectIds(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryObjectIds(e||this.createQuery(),t))}queryAttachments(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryAttachments(e,t))}getFieldUsageInfo(e){const t={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||t:(OE.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),t)}createPopupTemplate(e){return Nte(this,e)}_getAssociatedLayerForQuery(){const e=this.associatedLayer;return _(e)&&e.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),M(this.associatedLayer))throw new W("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(e){throw new W("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:e})}return this.associatedLayer}hasCachedStatistics(e){return this.statisticsInfo!=null&&this.statisticsInfo.some(t=>t.name===e)}async queryCachedStatistics(e,t){if(await this.load(t),!this.statisticsInfo)throw new W("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const i=this.fieldsIndex.get(e);if(!i)throw new W("scenelayer:field-unexisting",`Field '${e}' does not exist on the layer`);for(const r of this.statisticsInfo)if(r.name===i.name){const s=Bc(this.parsedUrl.path,r.href);return Zt(s,{query:{f:"json",token:this.apiKey},responseType:"json",signal:t?t.signal:null}).then(n=>n.data)}throw new W("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available")}async saveAs(e,t){return this._debouncedSaveOperations(JM.SAVE_AS,me(F({},t),{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"}),e)}async save(){const e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations(JM.SAVE,e)}async applyEdits(e,t){const i=await import("./editingSupport.216e71af.js");if(await this.load(),M(this.associatedLayer))throw new W(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),i.applyEdits(this,this.associatedLayer.source,e,t)}on(e,t){return super.on(e,t)}validateLayer(e){if(e.layerType&&!ZLt.includes(e.layerType))throw new W("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new W("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new W("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});function t(i,r){let s=!1,n=!1;if(i==null)s=!0,n=!0;else{const o=r&&r.isGeographic;switch(i){case"east-north-up":case"earth-centered":s=!0,n=o;break;case"vertex-reference-frame":s=!0,n=!o;break;default:s=!1}}if(!s)throw new W("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!n)throw new W("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}t(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const e=[];if(this.profile==="points")e.push("Point");else{if(this.profile!=="mesh-pyramids")throw new W("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);e.push("3DObject")}return e}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(const e of this.fields){const t=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(s=>s.name===e.name)),i=!!(_(this.associatedLayer)&&this.associatedLayer.fields&&this.associatedLayer.fields.some(s=>s&&e.name===s.name)),r={supportsLabelingInfo:t,supportsRenderer:t,supportsPopupTemplate:t||i,supportsLayerQuery:i};this._fieldUsageInfo[e.name]=r}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides()}_applyAssociatedLayerFieldsOverrides(){if(M(this.associatedLayer)||!this.associatedLayer.fields)return;let e=null;for(const t of this.associatedLayer.fields){const i=this.getField(t.name);i?(!i.domain&&t.domain&&(i.domain=t.domain.clone()),i.editable=t.editable,i.nullable=t.nullable,i.length=t.length):(e||(e=this.fields?this.fields.slice():[]),e.push(t.clone()))}e&&this._set("fields",e)}_applyAssociatedLayerPopupOverrides(){if(M(this.associatedLayer))return;const e=["popupTemplate","popupEnabled"],t=ho(this);for(let i=0;i<e.length;i++){const r=e[i],s=this.originIdOf(r),n=this.associatedLayer.originIdOf(r);s<n&&(n===st.SERVICE||n===st.PORTAL_ITEM)&&t.setAtOrigin(r,this.associatedLayer[r],n)}}async _setAssociatedFeatureLayer(e){if(!["mesh-pyramids","points"].includes(this.profile))return;const t=new DLt(this.parsedUrl,this.portalItem,this.apiKey,e);try{this.associatedLayer=await t.fetch()}catch(i){as(i)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await gv(()=>this.popupEnabled&&this.popupTemplate!=null);const e=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?OE.warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${e}`):OE.info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${e}`)}_validateElevationInfo(){const e=this.elevationInfo;e&&(this.profile==="mesh-pyramids"&&e.mode==="relative-to-scene"&&OE.warn(".elevationInfo=","Mesh scene layers don't support relative-to-scene elevation mode"),e.featureExpressionInfo&&e.featureExpressionInfo.expression!=="0"&&OE.warn(".elevationInfo=","Scene layers do not support featureExpressionInfo"))}};u([d({types:{key:"type",base:K0,typeMap:{selection:iY}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],Ht.prototype,"featureReduction",void 0),u([d({type:[w1],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],Ht.prototype,"rangeInfos",void 0),u([d({json:{read:!1}})],Ht.prototype,"associatedLayer",void 0),u([d({type:["show","hide"]})],Ht.prototype,"listMode",void 0),u([d({type:["ArcGISSceneServiceLayer"]})],Ht.prototype,"operationalLayerType",void 0),u([d({json:{read:!1},readOnly:!0})],Ht.prototype,"type",void 0),u([d(me(F({},t0e.fields),{readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}}))],Ht.prototype,"fields",void 0),u([d()],Ht.prototype,"types",null),u([d()],Ht.prototype,"typeIdField",null),u([d()],Ht.prototype,"formTemplate",null),u([d({readOnly:!0})],Ht.prototype,"fieldsIndex",null),u([d({type:Dte,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],Ht.prototype,"floorInfo",void 0),u([d(t0e.outFields)],Ht.prototype,"outFields",void 0),u([d({type:yT,readOnly:!0,json:{read:!1}})],Ht.prototype,"nodePages",void 0),u([De("service","nodePages",["nodePages","pointNodePages"])],Ht.prototype,"readNodePages",null),u([d({type:[zd],readOnly:!0})],Ht.prototype,"materialDefinitions",void 0),u([d({type:[AI],readOnly:!0})],Ht.prototype,"textureSetDefinitions",void 0),u([d({type:[OI],readOnly:!0})],Ht.prototype,"geometryDefinitions",void 0),u([d({readOnly:!0})],Ht.prototype,"serviceUpdateTimeStamp",void 0),u([d({readOnly:!0})],Ht.prototype,"attributeStorageInfo",void 0),u([d({readOnly:!0})],Ht.prototype,"statisticsInfo",void 0),u([d({type:nt.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],Ht.prototype,"excludeObjectIds",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Ht.prototype,"definitionExpression",void 0),u([d({type:WLt,json:{name:"layerDefinition.polygonFilter",write:!0}})],Ht.prototype,"filter",void 0),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Ht.prototype,"path",void 0),u([d(K2e)],Ht.prototype,"elevationInfo",null),u([d({type:String})],Ht.prototype,"geometryType",null),u([d(QB)],Ht.prototype,"labelsVisible",void 0),u([d({type:[_O],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:pz},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:pz},write:!0}})],Ht.prototype,"labelingInfo",void 0),u([d(Q2e)],Ht.prototype,"legendEnabled",void 0),u([d({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(e,t){var r,s;if(typeof e=="number"&&e>=0&&e<=1)return e;const i=(s=(r=t.layerDefinition)==null?void 0:r.drawingInfo)==null?void 0:s.transparency;return i!==void 0?ZA(i):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],Ht.prototype,"opacity",void 0),u([d({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Ht.prototype,"priority",void 0),u([d({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Ht.prototype,"semantic",void 0),u([d({types:yte,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],Ht.prototype,"renderer",null),u([d({json:{read:!1}})],Ht.prototype,"cachedDrawingInfo",void 0),u([De("service","cachedDrawingInfo")],Ht.prototype,"readCachedDrawingInfo",null),u([d({readOnly:!0,json:{read:!1}})],Ht.prototype,"capabilities",null),u([d({type:Boolean,json:{read:!1}})],Ht.prototype,"editingEnabled",null),u([d(RL)],Ht.prototype,"popupEnabled",void 0),u([d({type:ZS,json:{name:"popupInfo",write:!0}})],Ht.prototype,"popupTemplate",void 0),u([d({readOnly:!0,json:{read:!1}})],Ht.prototype,"defaultPopupTemplate",null),u([d({type:String,json:{read:!1}})],Ht.prototype,"objectIdField",void 0),u([De("service","objectIdField",["objectIdField","fields"])],Ht.prototype,"readObjectIdField",null),u([d({type:String,json:{read:!1}})],Ht.prototype,"globalIdField",void 0),u([De("service","globalIdField",["globalIdField","fields"])],Ht.prototype,"readGlobalIdField",null),u([d({readOnly:!0,type:String,json:{read:!1}})],Ht.prototype,"displayField",null),u([d({type:String,json:{read:!1}})],Ht.prototype,"profile",void 0),u([De("service","profile",["store.profile"])],Ht.prototype,"readProfile",null),u([d({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],Ht.prototype,"normalReferenceFrame",void 0),u([d(J2e)],Ht.prototype,"screenSizePerspectiveEnabled",void 0),Ht=u([L("esri.layers.SceneLayer")],Ht);const i0e={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},XLt={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"},YLt=Ht;var fUt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:YLt});let b0=class extends qte(cs.EventedAccessor){constructor(e){super(e),this._initialViewpoint=null,this._goingHomeController=null,this.go=this.go.bind(this)}destroy(){this._cancelGo(),this.view=null}get state(){return this.get("view.ready")?this._goingHomeController?"going-home":"ready":"disabled"}set view(e){this._initialViewpoint=null,this._set("view",e),e&&e.when().then(()=>{this.view===e&&(this._initialViewpoint=e.viewpoint.clone(),this.notifyChange("viewpoint"))})}get viewpoint(){return this._get("viewpoint")||this._initialViewpoint}set viewpoint(e){this._set("viewpoint",e)}async go(){if(!this.get("view.ready"))throw new W("home:disabled-state","Cannot go when disabled.");this._cancelGo(),this.emit("go");const e=new AbortController;this._goingHomeController=e;try{await this.view.when(),await this.callGoTo({target:this.viewpoint,options:{signal:e.signal}})}catch{}this._goingHomeController=null}cancelGo(){this._cancelGo()}_cancelGo(){const{_goingHomeController:e}=this;e&&e.abort(),this._goingHomeController=null}};u([d()],b0.prototype,"_goingHomeController",void 0),u([d({readOnly:!0})],b0.prototype,"state",null),u([d()],b0.prototype,"view",null),u([d({type:xp})],b0.prototype,"viewpoint",null),u([d()],b0.prototype,"go",null),u([d()],b0.prototype,"cancelGo",null),b0=u([L("esri.widgets.Home.HomeViewModel")],b0);const xLe=b0,Zw={base:"esri-home esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",homeIcon:"esri-icon esri-icon-home",loadingIcon:"esri-icon-loading-indicator",rotatingIcon:"esri-rotating",widgetIcon:"esri-icon-home",disabled:"esri-disabled"};let _c=class extends Yr{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=Zw.widgetIcon,this.label=void 0,this.messages=null,this.messagesCommon=null,this.view=null,this.viewModel=new xLe,this.viewpoint=null}get homeTitle(){var r;const e=(r=this.viewModel)==null?void 0:r.state,{messagesCommon:t,messages:i}=this;return e==="going-home"?t.cancel:i.title}cancelGo(){return null}go(){return null}render(){var r;const e=(r=this.viewModel)==null?void 0:r.state,{homeTitle:t}=this,i={[Zw.disabled]:e==="disabled"};return N("div",{bind:this,class:this.classes(Zw.base,i),role:"button",tabIndex:0,onclick:this._go,onkeydown:this._go,"aria-label":t,title:t},this.renderIcon(),this.renderText())}renderIcon(){var i;const e=(i=this.viewModel)==null?void 0:i.state,t={[Zw.loadingIcon]:e==="going-home",[Zw.rotatingIcon]:e==="going-home"};return N("span",{"aria-hidden":"true",class:this.classes(Zw.homeIcon,t)})}renderText(){const{messages:e}=this;return N("span",{class:Zw.text},e.button)}_go(){const{viewModel:e}=this;e.state==="going-home"?e.cancelGo():e.go()}};u([ze("viewModel.goToOverride")],_c.prototype,"goToOverride",void 0),u([d({readOnly:!0})],_c.prototype,"homeTitle",null),u([d()],_c.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],_c.prototype,"label",void 0),u([d(),pr("esri/widgets/Home/t9n/Home")],_c.prototype,"messages",void 0),u([d(),pr("esri/t9n/common")],_c.prototype,"messagesCommon",void 0),u([ze("viewModel.view")],_c.prototype,"view",void 0),u([d({type:xLe}),cTe("go")],_c.prototype,"viewModel",void 0),u([ze("viewModel.viewpoint")],_c.prototype,"viewpoint",void 0),u([ze("viewModel.cancelGo")],_c.prototype,"cancelGo",null),u([ze("viewModel.go")],_c.prototype,"go",null),u([Da()],_c.prototype,"_go",null),_c=u([L("esri.widgets.Home")],_c);const mUt=_c,iL=-1;let hg=class extends Ee{constructor(e){super(e),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=ye("mapview-transitions-duration"),this.effects=[]}set effect(e){if(this._get("effect")!==(e=e||"")){this._set("effect",e);try{this._transitionTo(r0e(e))}catch(t){this._transitionTo([]),ve.getLogger(this.declaredClass).warn("Invalid Effect",{effect:e,error:t})}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(e){this._updateForScale(e)}get transitioning(){return this._to!==null}canTransitionTo(e){try{return this.scale>0&&s0e(this._current,r0e(e),this.scale)}catch{return!1}}transitionStep(e,t){this._applyTimeTransition(e),this._updateForScale(t)}end(){this._applyTimeTransition(this.duration)}_transitionTo(e){this.scale>0&&s0e(this._current,e,this.scale)?(this._final=e,this._to=ue(e),JLt(this._current,this._to,this.scale),this._from=ue(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._set("effects",this._current[0]?ue(this._current[0].effects):[])}_applyTimeTransition(e){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=e;const t=Math.min(1,this._time/this.duration);for(let i=0;i<this._current.length;i++){const r=this._current[i],s=this._from[i],n=this._to[i];r.scale=QLt(s.scale,n.scale,t);for(let o=0;o<r.effects.length;o++){const a=r.effects[o],l=s.effects[o],c=n.effects[o];a.interpolate(l,c,t)}}t===1&&(this._current=this._final,this._set("effects",this._current[0]?ue(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(e){if(this._set("scale",e),this._current.length===0)return;const t=this._current,i=this._current.length-1;let r,s,n=1;if(t.length===1||e>=t[0].scale)s=r=t[0].effects;else if(e<=t[i].scale)s=r=t[i].effects;else for(let o=0;o<i;o++){const a=t[o],l=t[o+1];if(a.scale>=e&&l.scale<=e){n=(e-a.scale)/(l.scale-a.scale),r=a.effects,s=l.effects;break}}for(let o=0;o<this.effects.length;o++)this.effects[o].interpolate(r[o],s[o],n)}};function r0e(e){const t=Cee(e)||[];return KLt(t)?[{scale:iL,effects:t}]:t}function s0e(e,t,i){var r,s,n,o;return!((r=e[0])==null?void 0:r.effects)||!((s=t[0])==null?void 0:s.effects)?!0:!((((n=e[0])==null?void 0:n.scale)===iL||((o=t[0])==null?void 0:o.scale)===iL)&&(e.length>1||t.length>1)&&i<=0)&&pTe(e[0].effects,t[0].effects)}function JLt(e,t,i){var l,c;const r=e.length>t.length?e:t,s=e.length>t.length?t:e,n=s[s.length-1],o=(l=n==null?void 0:n.scale)!=null?l:i,a=(c=n==null?void 0:n.effects)!=null?c:[];for(let h=s.length;h<r.length;h++)s.push({scale:o,effects:[...a]});for(let h=0;h<r.length;h++)s[h].scale=s[h].scale===iL?i:s[h].scale,r[h].scale=r[h].scale===iL?i:r[h].scale,fTe(s[h].effects,r[h].effects)}function QLt(e,t,i){return e+(t-e)*i}function KLt(e){const t=e[0];return!!t&&"type"in t}u([d()],hg.prototype,"_to",void 0),u([d()],hg.prototype,"duration",void 0),u([d({value:""})],hg.prototype,"effect",null),u([d({readOnly:!0})],hg.prototype,"effects",void 0),u([d({readOnly:!0})],hg.prototype,"hasEffects",null),u([d({value:0})],hg.prototype,"scale",null),u([d({readOnly:!0})],hg.prototype,"transitioning",null),hg=u([L("esri.layers.effects.EffectView")],hg);function gUt(e){var i;const t=e.layer;return"floorInfo"in t&&((i=t.floorInfo)==null?void 0:i.floorField)&&"floors"in e.view?TLe(e.view.floors,t.floorInfo.floorField):null}function n0e(e,t){var i;return"floorInfo"in t&&((i=t.floorInfo)==null?void 0:i.floorField)?TLe(e,t.floorInfo.floorField):null}function TLe(e,t){if(!(e==null?void 0:e.length))return null;const i=e.filter(r=>r!=="").map(r=>`'${r}'`);return i.push("''"),`${t} IN (${i.join(",")}) OR ${t} IS NULL`}const eDt={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let _h=class extends pm(Ee){constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map(t=>{const i=n0e(this.floors,t);return t.toExportImageJSON(i)});return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&vLt(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),e.on("sublayer-update",t=>this.notifyChange(eDt[t.propertyName]))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map(t=>t.id).join(","):"show:-1":null}get layerDefs(){var i;const e=!!((i=this.floors)==null?void 0:i.length),t=this.visibleSublayers.filter(r=>r.definitionExpression!=null||e&&r.floorInfo!=null);return t.length?JSON.stringify(t.reduce((r,s)=>{const n=n0e(this.floors,s),o=_te(n,s.definitionExpression);return _(o)&&(r[s.id]=o),r},{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,i=s=>{const n=this.scale,o=n===0,a=s.minScale===0||n<=s.minScale,l=s.maxScale===0||n>=s.maxScale;s.visible&&(o||a&&l)&&(s.sublayers?s.sublayers.forEach(i):e.unshift(s))};t&&t.forEach(i);const r=this._get("visibleSublayers");return!r||r.length!==e.length||r.some((s,n)=>e[n]!==s)?e:r}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t=me(F({},t),{layers:this.layers,layerDefs:this.layerDefs}),t}};u([d({readOnly:!0})],_h.prototype,"dynamicLayers",null),u([d()],_h.prototype,"floors",void 0),u([d({readOnly:!0})],_h.prototype,"hasDynamicLayers",null),u([d()],_h.prototype,"layer",null),u([d({readOnly:!0})],_h.prototype,"layers",null),u([d({readOnly:!0})],_h.prototype,"layerDefs",null),u([d({type:Number})],_h.prototype,"scale",void 0),u([d(gKe)],_h.prototype,"timeExtent",void 0),u([d({readOnly:!0})],_h.prototype,"version",null),u([d({readOnly:!0})],_h.prototype,"visibleSublayers",null),_h=u([L("esri.layers.mixins.ExportImageParameters")],_h);function SLe(e){return M(e)||e.type==="simple"||e.type==="unique-value"||e.type==="class-breaks"||e.type==="dictionary"||e.type==="heatmap"}function yUt(e){if(M(e))return null;if(!SLe(e))return new W("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${e.type||e.declaredClass}'`,{renderer:e});switch(e.type){case"simple":return tDt(e);case"unique-value":return iDt(e);case"class-breaks":return rDt(e);case"dictionary":case"heatmap":return null}return null}function Fse(e,t){if(!t)return null;let i;if(i=Array.isArray(t)?t:[t],i.length>0){const r=i.map(n=>n.details.symbol.type||n.details.symbol.declaredClass).filter(n=>!!n);r.sort();const s=[];return r.forEach((n,o)=>{o!==0&&n===r[o-1]||s.push(n)}),new W("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${s.join(", ")}) which are not supported in 3D`,{renderer:e,symbolErrors:i})}return null}function tDt(e){return Fse(e,lM(e.symbol).error)}function iDt(e){const t=e.uniqueValueInfos.map(r=>lM(r.symbol).error).filter(r=>!!r),i=lM(e.defaultSymbol);return i.error&&t.unshift(i.error),Fse(e,t)}function rDt(e){const t=e.classBreakInfos.map(r=>lM(r.symbol).error).filter(r=>!!r),i=lM(e.defaultSymbol);return i.error&&t.unshift(i.error),Fse(e,t)}const sDt=(e,t)=>{const i=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return(t==null?void 0:t.levels)?t.levels[i]:null};function nDt(e,t){if(!e||!("visualVariables"in e)||!e.visualVariables)return null;const i=e.visualVariables.find(s=>s.type==="size"),r=sDt(t,i);return r?new ute({field:i.field,minSize:r[2].size,minDataValue:r[2].value,maxSize:r[3].size,maxDataValue:r[3].value}):null}function ELe(e,t,i,r){return e.name?e.styleName&&e.styleName==="Esri2DPointSymbolsStyle"?oDt(e,t,r):L2e(e,t,r).then(s=>CLe(s,e.name,t,i,r)):Promise.reject(new W("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))}function CLe(e,t,i,r,s){const n=e.data,o=i&&_(i.portal)?i.portal:Bo.getDefault(),a={portal:o,url:pn(e.baseUrl),origin:"portal-item"},l=n.items.find(m=>m.name===t);if(!l){const m=`The symbol name '${t}' could not be found`;return Promise.reject(new W("symbolstyleutils:symbol-name-not-found",m,{symbolName:t}))}let c=fv(OQe(l,r),a),h=l.thumbnail&&l.thumbnail.href;const p=l.thumbnail&&l.thumbnail.imageData;rvt()&&(c=hJ(c),h=hJ(h));const f={portal:o,url:pn(SK(c)),origin:"portal-item"};return mte(c,s).then(m=>{const g=r==="cimRef"?D2e(m.data):m.data,y=C2e(g,f);if(y&&om(y)){if(h){const x=fv(h,a);y.thumbnail=new HT({url:x})}else p&&(y.thumbnail=new HT({url:`data:image/png;base64,${p}`}));e.styleUrl?y.styleOrigin=new k3({portal:i.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(y.styleOrigin=new k3({portal:i.portal,styleName:e.styleName,name:t}))}return y})}function oDt(e,t,i){const r=RQe.replace(/\{SymbolName\}/gi,e.name),s=_(t.portal)?t.portal:Bo.getDefault();return mte(r,i).then(n=>{const o=D2e(n.data);return C2e(o,{portal:s,url:pn(SK(r)),origin:"portal-item"})})}var aDt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",fetchSymbolFromStyle:CLe,resolveWebStyleSymbol:ELe});const vT=jo.size,qk=jo.maxSize,kse=jo.maxOutlineSize,o0e=jo.lineWidth,hQ=jo.tallSymbolWidth,lDt=ve.getLogger("esri.symbols.support.previewSymbol3D");function iA(e){const t=e.outline,i=_(e.material)?e.material.color:null,r=_(i)?i.toHex():null;if(M(t)||"pattern"in t&&_(t.pattern)&&t.pattern.type==="style"&&t.pattern.style==="none")return e.type==="fill"&&r==="#ffffff"?{color:"#bdc3c7",width:.75}:null;const s=$i(t.size)||0;return{color:"rgba("+(_(t.color)?t.color.toRgba():"255,255,255,1")+")",width:Math.min(s,kse),style:"pattern"in t&&_(t.pattern)&&t.pattern.type==="style"?Lee(t.pattern.style):null,join:"butt",cap:"patternCap"in t?t.patternCap:"butt"}}function cDt(e,t){const i=t&&t.resource,r=i&&i.href;if(e.thumbnail&&e.thumbnail.url)return Promise.resolve(e.thumbnail.url);if(r&&t.type!=="object")return Promise.resolve(xTe(e,t));const s=ji("esri/images/Legend/legend3dsymboldefault.png");return e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)?ELe(e.styleOrigin,{portal:e.styleOrigin.portal},"webRef").catch(n=>n).then(n=>{var o;return((o=n==null?void 0:n.thumbnail)==null?void 0:o.url)||s}):Promise.resolve(s)}function zH(e,t=1){const i=e.a,r=zte(e),s=r.h,n=r.s/t,o=100-(100-r.v)/t,{r:a,g:l,b:c}=PL({h:s,s:n,v:o});return[a,l,c,i]}function CV(e){return e.type==="water"?M(e.color)?null:e.color:M(e.material)||M(e.material.color)?null:e.material.color}function es(e,t=0){const i=CV(e);if(!i){if(e.type==="fill")return null;const s=Fqe.r,n=pb(s,t);return[n,n,n,100]}const r=i.toRgba();for(let s=0;s<3;s++)r[s]=pb(r[s],t);return r}async function ALe(e,t){const i=e.style;return i==="none"?null:{type:"pattern",x:0,y:0,src:await Nqe(ji(`esri/symbols/patterns/${i}.png`),t.toCss(!0)),width:5,height:5}}function a0e(e){return e.outline?iA(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function MLe(e,t){const i=CV(e);if(!i)return null;let r="rgba(";return r+=pb(i.r,t)+",",r+=pb(i.g,t)+",",r+=pb(i.b,t)+",",r+i.a+");"}function dQ(e,t){const i=MLe(e,t);return i?"pattern"in e&&_(e.pattern)&&e.pattern.type==="style"&&e.pattern.style==="none"?null:{color:i,width:Math.min(e.size?$i(e.size):.75,kse),style:"pattern"in e&&_(e.pattern)&&e.pattern.type==="style"?Lee(e.pattern.style):null,cap:"cap"in e?e.cap:null,join:"join"in e?e.join==="miter"?$i(2):e.join:null}:{}}function $4(e,t,i){const r=.75*i;return{type:"linear",x1:r?.25*r:0,y1:r?.5*r:0,x2:r||4,y2:r?.5*r:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function uDt(e){const t=e.depth,i=e.height,r=e.width;return r&&t&&i&&r===t&&r<i}function hDt(e,t,i){const r=[];if(!e)return r;switch(e.type){case"icon":{const o=t,a=t;switch(e.resource&&e.resource.primitive||O1e){case"circle":r.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:es(e,0),stroke:iA(e)});break;case"square":r.push({shape:{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[0,0]},{command:"L",values:[o,0]},{command:"L",values:[o,a]},{command:"Z",values:[]}]},fill:es(e,0),stroke:iA(e)});break;case"triangle":r.push({shape:{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,a]},{command:"Z",values:[]}]},fill:es(e,0),stroke:iA(e)});break;case"cross":r.push({shape:{type:"path",path:[{command:"M",values:[.5*o,0]},{command:"L",values:[.5*o,a]},{command:"M",values:[0,.5*a]},{command:"L",values:[o,.5*a]}]},stroke:a0e(e)});break;case"x":r.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,a]},{command:"M",values:[o,0]},{command:"L",values:[0,a]}]},stroke:a0e(e)});break;case"kite":r.push({shape:{type:"path",path:[{command:"M",values:[0,.5*a]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,.5*a]},{command:"L",values:[.5*o,a]},{command:"Z",values:[]}]},fill:es(e,0),stroke:iA(e)})}break}case"object":switch(e.resource&&e.resource.primitive||OK){case"cone":{const s=$4(es(e,0),es(e,-.6),i?hQ:t),n=Ket(t,i);r.push({shape:n[0],fill:s}),r.push({shape:n[1],fill:s});break}case"inverted-cone":{const s=es(e,0),n=$4(s,es(e,-.6),t),o=ett(t);r.push({shape:o[0],fill:n}),r.push({shape:o[1],fill:s});break}case"cube":{const s=Jet(t,i);r.push({shape:s[0],fill:es(e,0)}),r.push({shape:s[1],fill:es(e,-.3)}),r.push({shape:s[2],fill:es(e,-.5)});break}case"cylinder":{const s=$4(es(e,0),es(e,-.6),i?hQ:t),n=Qet(t,i);r.push({shape:n[0],fill:s}),r.push({shape:n[1],fill:s}),r.push({shape:n[2],fill:es(e,0)});break}case"diamond":{const s=ttt(t);r.push({shape:s[0],fill:es(e,-.3)}),r.push({shape:s[1],fill:es(e,0)}),r.push({shape:s[2],fill:es(e,-.3)}),r.push({shape:s[3],fill:es(e,-.7)});break}case"sphere":{const s=$4(es(e,0),es(e,-.6));s.x1=0,s.y1=0,s.x2=.25*t,s.y2=.25*t,r.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:s});break}case"tetrahedron":{const s=itt(t);r.push({shape:s[0],fill:es(e,-.3)}),r.push({shape:s[1],fill:es(e,0)}),r.push({shape:s[2],fill:es(e,-.6)});break}}break}return r}function J8(e){const t=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null;return t?$i(t):null}function dDt(e){return e.type==="icon"?"multiply":"tint"}function pDt(e,t){const i=J8(t),r=t&&t.maxSize?$i(t.maxSize):null,s=t&&t.disableUpsampling,n=e.symbolLayers,o=[];let a=0,l=0;const c=n.getItemAt(n.length-1);let h;return c&&c.type==="icon"&&(h=c.size&&$i(c.size)),n.forEach(p=>{var g;if(p.type!=="icon"&&p.type!=="object")return;const f=p.type==="icon"?p.size&&$i(p.size):0,m=i||f?Math.ceil(Math.min(i||f,r||qk)):vT;if(p&&p.resource&&p.resource.href){const y=cDt(e,p).then(x=>{const b=p.get("material.color"),S=dDt(p);return Ztt(x,m,b,S,s)}).then(x=>{const b=x.width,S=x.height;return a=Math.max(a,b),l=Math.max(l,S),[{shape:{type:"image",x:0,y:0,width:b,height:S,src:x.url},fill:null,stroke:null}]});o.push(y)}else{let y=m;p.type==="icon"&&h&&i&&(y=m*(f/h));const x=(t==null?void 0:t.symbolConfig)==="tall"||((g=t==null?void 0:t.symbolConfig)==null?void 0:g.isTall)||p.type==="object"&&uDt(p);a=Math.max(a,x?hQ:y),l=Math.max(l,y),o.push(Promise.resolve(hDt(p,y,x)))}}),Us(o).then(p=>{const f=[];return p.forEach(m=>{m.value?f.push(m.value):m.error&&lDt.warn("error while building swatchInfo!",m.error)}),IL(f,[a,l],{node:t&&t.node,scale:!1,opacity:t&&t.opacity})})}function fDt(e,t){const i=e.symbolLayers,r=[],s=zB(e),n=J8(t),o=(t&&t.maxSize?$i(t.maxSize):null)||kse;let a,l=0,c=0;return i.forEach((h,p)=>{if(!h||h.type!=="line"&&h.type!=="path")return;const f=[];switch(h.type){case"line":{const m=dQ(h,0);if(M(m))break;const g=m&&m.width||0;p===0&&(a=g);const y=Math.min(n||g,o),x=p===0?y:n?y*(g/a):y,b=x>o0e/2?2*x:o0e;c=Math.max(c,x),l=Math.max(l,b),m.width=x,f.push({shape:{type:"path",path:[{command:"M",values:[0,.5*c]},{command:"L",values:[l,.5*c]}]},stroke:m});break}case"path":{const m=Math.min(n||vT,o),g=es(h,0),y=es(h,-.2),x=MLe(h,-.4),b=x?{color:x,width:1}:{};if(h.profile==="quad"){const S=h.width,T=h.height,C=Zet(S&&T?S/T:1,T===0,S===0),A=me(F({},b),{join:"bevel"});f.push({shape:C[0],fill:y,stroke:A}),f.push({shape:C[1],fill:y,stroke:A}),f.push({shape:C[2],fill:g,stroke:A})}else f.push({shape:sY.pathSymbol3DLayer[0],fill:y,stroke:b}),f.push({shape:sY.pathSymbol3DLayer[1],fill:g,stroke:b});c=Math.max(c,m),l=c}}r.push(f)}),Promise.resolve(IL(r,[l,c],{node:t&&t.node,scale:s,opacity:t&&t.opacity}))}async function mDt(e,t){const i=e.type==="mesh-3d",r=e.symbolLayers,s=J8(t),n=t&&t.maxSize?$i(t.maxSize):null,o=s||vT,a=[];let l=0,c=0,h=!1;for(let p=0;p<r.length;p++){const f=r.getItemAt(p),m=[];if(i&&f.type!=="fill")continue;const g=sY.fill[0];switch(f.type){case"fill":{const y=iA(f),x=Math.min(o,n||qk);l=Math.max(l,x),c=Math.max(c,x),h=!0;let b=es(f,0);const S="pattern"in f&&f.pattern,T=CV(f);!i&&_(S)&&S.type==="style"&&S.style!=="solid"&&T&&(b=await ALe(S,T)),m.push({shape:g,fill:b,stroke:y});break}case"line":{const y=dQ(f,0);if(M(y))break;const x={stroke:y,shape:g};l=Math.max(l,vT),c=Math.max(c,vT),m.push(x);break}case"extrude":{const y=F({join:"round",width:1},dQ(f,-.4)),x=es(f,0),b=es(f,-.2),S=Math.min(o,n||qk),T=Xet(S);y.width=1,m.push({shape:T[0],fill:b,stroke:y}),m.push({shape:T[1],fill:b,stroke:y}),m.push({shape:T[2],fill:x,stroke:y});const C=vT,A=.7*vT+.5*S;l=Math.max(l,C),c=Math.max(c,A);break}case"water":{const y=CV(f),x=zH(y),b=zH(y,2),S=zH(y,3),T=Yet();h=!0,m.push({shape:T[0],fill:x}),m.push({shape:T[1],fill:b}),m.push({shape:T[2],fill:S});const C=Math.min(o,n||qk);l=Math.max(l,C),c=Math.max(c,C);break}}a.push(m)}return IL(a,[l,c],{node:t&&t.node,scale:h,opacity:t&&t.opacity})}function gDt(e,t){if(e.symbolLayers.length===0)return Promise.reject(new W("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return pDt(e,t);case"line-3d":return fDt(e,t);case"polygon-3d":case"mesh-3d":return mDt(e,t)}return Promise.reject(new W("symbolPreview: swatchInfo3D","symbol not supported."))}var yDt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getPatternDescriptor:ALe,getSizeFromOptions:J8,getSymbolLayerFill:es,previewSymbol3D:gDt});const l0e={HH:315,HL:45,LL:135,LH:225},vDt={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function _Dt(e){if(!e)return;const{type:t}=e;if(t.includes("3d"))return es(e.symbolLayers.getItemAt(0));if(t==="simple-line"){const i=q3(e);return i&&i.color}if(e.type==="simple-marker"&&(e.style==="x"||e.style==="cross")){const i=q3(e);return i&&i.color}return Dqe(e)}function bDt(e,t){const i=t.HH.label,r=t.LL.label,s=t.HL.label,n=t.LH.label;switch(e){case"HH":default:return{top:i,bottom:r,left:s,right:n};case"HL":return{top:s,bottom:n,left:r,right:i};case"LL":return{top:r,bottom:i,left:n,right:s};case"LH":return{top:n,bottom:s,left:i,right:r}}}function wDt(e){const{focus:t,infos:i,numClasses:r}=e,s=vDt[r],n={};i.forEach(a=>{n[a.value]={label:a.label,fill:_Dt(a.symbol)}});const o=[];for(let a=0;a<r;a++){const l=[];for(let c=0;c<r;c++){const h=n[s[a][c]];l.push(h.fill)}o.push(l)}return{type:"relationship-ramp",numClasses:r,focus:t,colors:o,labels:bDt(t,n),rotation:OLe(t)}}function OLe(e){let t=l0e[e];return e&&t==null&&(t=l0e.HH),t||0}const pQ=30,fQ=12,RLe=[255,255,255],PLe=[200,200,200],rA=[128,128,128],xDt=20,TDt=5;function SDt(e){return e.declaredClass==="esri.symbols.SimpleMarkerSymbol"}function EDt(e){return e.declaredClass==="esri.symbols.PictureMarkerSymbol"}function CDt(e){return e.declaredClass==="esri.symbols.SimpleLineSymbol"}function ADt(e){return e.declaredClass==="esri.symbols.TextSymbol"}function MDt(e,t){const i=e.length-1;return e.map((r,s)=>ATe(r,s,i,t))}async function ODt(e,t,i,r,s,n){const o=t.legendOptions,a=o&&o.customValues,l=await IDt(e,i),c=!!l,h=!!a,p=t.minSize!=null&&t.maxSize!=null,f=t.stops&&t.stops.length>1,m=!!t.target;if(!c||!h&&!(p||f&&!m))return;const g=zB(l);let y=null,x=null,b=null;x=g&&!f?QU([t.minDataValue,t.maxDataValue]):a||await LDt(t,l,r,s);const S=e==null?void 0:e.authoringInfo,T=(S==null?void 0:S.type)==="univariate-color-size",C=T&&(S==null?void 0:S.univariateTheme)==="above-and-below";if(!x&&f&&(x=t.stops.map(U=>U.value),y=t.stops.some(U=>!!U.label),e.type==="flow"&&(x=QU(x)),y&&(b=t.stops.map(U=>U.label))),g&&(x==null?void 0:x.length)>2&&!C&&(x=[x[0],x[x.length-1]]),!x)return null;T&&(x==null?void 0:x.length)!==5&&(x=LLe({minSize:x[0],maxSize:x[x.length-1]}));const A=g?RDt(e,x):null,O=zqe(l),D=y?null:MDt(x,n);return(await Promise.all(x.map(async(U,k)=>{const B=g?A[k]:await AC(t,l,U,r,s);return{value:U,symbol:FDt(C&&e.type==="class-breaks"?PDt(e,k):l,B),label:y?b[k]:D[k],size:B,outlineSize:O}}))).reverse()}function RDt(e,t){const i=e==null?void 0:e.authoringInfo,r=(i==null?void 0:i.type)==="univariate-color-size";let s=[fQ,pQ];if(r){const n=t[0],o=t[t.length-1],a=fQ,l=pQ;s=t.map(c=>a+(c-n)/(o-n)*(l-a))}return r&&(i==null?void 0:i.univariateTheme)==="below"&&s.reverse(),s}function PDt(e,t){const i=e.classBreakInfos,r=i.length,s=r<2||!(t>=2)?i[0].symbol.clone():i[r-1].symbol.clone();return e.visualVariables.some(n=>n.type==="color")&&(s.type.includes("3d")?ILe(s):$Le(s)),s}async function IDt(e,t){var s;if(e.type==="flow")return MTe(e,t);if(e.type==="pie-chart")return new hl({color:null,outline:((s=e.outline)==null?void 0:s.width)?e.outline:new dl});let i=null,r=null;if(e.type==="simple")i=e.symbol;else if(e.type==="class-breaks"){const n=e.classBreakInfos;i=n&&n[0]&&n[0].symbol,r=n.length>1}else if(e.type==="unique-value"){const n=e.uniqueValueInfos;i=n&&n[0]&&n[0].symbol,r=n.length>1}return!i||$Dt(i)?null:(i=i.clone(),(t||r)&&(i.type.includes("3d")?ILe(i):$Le(i)),i)}function $Dt(e){return e?om(e)?!!e.symbolLayers&&e.symbolLayers.some(t=>t&&t.type==="fill"):e.type.includes("fill"):!1}function ILe(e){e.type==="line-3d"?e.symbolLayers.forEach(t=>{t.material={color:rA}}):e.symbolLayers.forEach(t=>{t.type!=="icon"||t.resource&&t.resource.href?t.material={color:PLe}:(t.material={color:RLe},t.outline={color:rA,size:1.5})})}function $Le(e){var i,r;const t=RB();e.type==="cim"?vTe(e,new Le(PLe)):e.type.includes("line")?e.color=rA:(e.color=t?rA:RLe,e.type==="simple-marker"&&(e.outline?((r=(i=e.outline)==null?void 0:i.color)==null?void 0:r.toHex())==="#ffffff"&&(e.outline.color=rA):e.outline={color:rA,width:1.5}))}async function LDt(e,t,i,r){const s=(await Promise.resolve().then(function(){return o2})).getSizeRangeAtScale(e,i,r),n=s&&LLe(s);if(!s&&!n)return;let o=n.map(a=>DDt(a,e,s));o=QU(o);for(let a=1;a<o.length-1;a++){const l=await NDt(e,t,o[a],o[a-1],i,r);l&&(o[a]=l[0],n[a]=l[1])}return o}function LLe(e){const t=e.minSize,i=e.maxSize,r=TDt,s=(i-t)/(r-1),n=[];for(let o=0;o<r;o++)n.push(t+s*o);return n}function DDt(e,t,i){const r=i.minSize,s=i.maxSize,n=t.minDataValue,o=t.maxDataValue;let a=null;return e<=r?a=n:e>=s?a=o:a=(e-r)/(s-r)*(o-n)+n,a}async function NDt(e,t,i,r,s,n){const o=await AC(e,t,i,s,n),a=await AC(e,t,r,s,n),l=JU(i),c=l.fractional,h=xDt;let p=l.integer,f=null,m=null;i>0&&i<1&&(f=10**c,p=JU(i*=f).integer);for(let g=p-1;g>=0;g--){const y=10**g;let x=Math.floor(i/y)*y,b=Math.ceil(i/y)*y;f!=null&&(x/=f,b/=f);let S=(x+b)/2;[,S]=QU([x,S,b],{indexes:[1]});const T=await AC(e,t,x,s,n),C=await AC(e,t,b,s,n),A=await AC(e,t,S,s,n),O=_5(o,T,a,null),D=_5(o,C,a,null),U=_5(o,A,a,null);let k=O.previous<=h,B=D.previous<=h;if(k&&B&&(O.previous<=D.previous?(k=!0,B=!1):(B=!0,k=!1)),k?m=[x,T]:B?m=[b,C]:U.previous<=h&&(m=[S,A]),m)break}return m}async function AC(e,t,i,r,s){const{getSize:n}=await Promise.resolve().then(function(){return o2});return n(e,i,{scale:r,view:s,shape:t.type==="simple-marker"?t.style:null})}function FDt(e,t){const i=e.clone();if(om(i))zB(i)||i.symbolLayers.forEach(r=>{r.type!=="fill"&&(r.size=t)});else if(SDt(i))i.size=t;else if(EDt(i)){const r=i.width,s=i.height;i.height=t,i.width=t*(r/s)}else CDt(i)?i.width=t:ADt(i)&&i.font&&(i.font.size=t);return i}function kDt(e){const i=Math.floor(Math.log10(Math.abs(e)))+1,r=i<4||i>6?4:i,s=1e6,n=Math.abs(e)>=s?"compact":"standard";return Wl(e,{notation:n,minimumSignificantDigits:2,maximumSignificantDigits:r})}const D_=ve.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),UDt="https://utility.arcgis.com/sharing/tools/legend",zDt="esri.layers.ImageryLayer",VDt="esri.layers.ImageryTileLayer",BDt="esri.layers.WCSLayer",L4=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,GDt=new Ti({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),c0e={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},D4=new hl({size:6,outline:{color:[128,128,128,.5],width:.5}}),jDt=new wp({style:"solid"});function mQ(e){return e.type==="flow"}function DLe(e){return e.type==="vector-field"}function NLe(e){return e.type==="raster-colormap"}function FLe(e){return e.type==="raster-stretch"}function kLe(e){return e.type==="raster-shaded-relief"}function MC(e){return e.declaredClass==="esri.renderers.SimpleRenderer"}function OC(e){return e.declaredClass==="esri.renderers.ClassBreaksRenderer"}function gQ(e){return e.declaredClass==="esri.renderers.UniqueValueRenderer"}function ULe(e){return e.declaredClass==="esri.renderers.HeatmapRenderer"}function HDt(e){return Use(e)||zse(e)||Vse(e)||qDt(e)}function qDt(e){return e.declaredClass==="esri.renderers.PointCloudRGBRenderer"}function Use(e){return e.declaredClass==="esri.renderers.PointCloudClassBreaksRenderer"}function zse(e){return e.declaredClass==="esri.renderers.PointCloudStretchRenderer"}function Vse(e){return e.declaredClass==="esri.renderers.PointCloudUniqueValueRenderer"}function zLe(e){return e.declaredClass==="esri.renderers.DotDensityRenderer"}function VLe(e){return e.declaredClass==="esri.renderers.PieChartRenderer"}function WDt(e,t){return MC(e)||OC(e)||gQ(e)||ULe(e)||zLe(e)||VLe(e)?t.type==="2d"||SLe(e):FLe(e)||NLe(e)||kLe(e)||Use(e)||zse(e)||Vse(e)||DLe(e)||mQ(e)}function u0e(e){return e.declaredClass==="esri.layers.BuildingSceneLayer"}function ZDt(e){return e.declaredClass==="esri.layers.VoxelLayer"}function XDt(e){return e.declaredClass==="esri.layers.WMSLayer"}function YDt(e){return e.declaredClass==="esri.layers.WMTSLayer"}function h0e(e){return e.declaredClass==="esri.layers.MapImageLayer"}function JDt(e){return e.declaredClass==="esri.layers.TileLayer"}function QDt(e){return e.declaredClass==="esri.layers.FeatureLayer"}function oP(e){return e.declaredClass===zDt}function VH(e){return e.declaredClass===VDt}function KDt(e){return e.declaredClass===BDt}function eNt(e){return e.type==="stretch-ramp"}function tNt(e){var t;return((t="authoringInfo"in e&&(e==null?void 0:e.authoringInfo))==null?void 0:t.type)==="univariate-color-size"}function iNt(e){const t="authoringInfo"in e&&(e==null?void 0:e.authoringInfo);return(t==null?void 0:t.type)==="univariate-color-size"&&(t==null?void 0:t.univariateTheme)==="above-and-below"}const rNt=new hl({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let RE={},Eo=class extends Ee{constructor(e){super(e),this._handles=new Nt,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this.children=new nt,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){const e=()=>this.notifyChange("ready");this._handles.add([os(()=>this.children,"change",t=>{const{added:i,removed:r}=t,s=this._handles;i.forEach(n=>{const o=`activeLayerInfo-ready-watcher-${n.layer.uid}`;s.add(re(()=>n.ready,e,Et),o)}),r.forEach(n=>s.remove(n.layer.uid)),e()})]),this.keepCacheOnDestroy||(RE={})}destroy(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(RE=null)}get effectList(){const e=this.layer;let t=null;return"effect"in e&&e.effect&&(t=new hg,t.effect=e.effect,t.end(),t.scale=this.scale),t}get opacity(){var s;const e=this.layer.opacity,t=(s=this.parent)==null?void 0:s.opacity,i=this.layer.parent,r=i&&"uid"in i?this._getParentLayerOpacity(i):null;return t!=null?t*e:r!=null?r*e:e}get ready(){return this.layer===null||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view&&this.view.scale}get isScaleDriven(){const e=this.layer;if(e===null)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction){if(e.featureReduction.type==="cluster")return!0;if(e.featureReduction.type==="binning"&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return"renderer"in e&&e.renderer?this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}async buildLegendElementsForFeatureCollections(e){if(!(!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView()))return this.legendElements=[],void this.notifyChange("ready");const t=Array.from(e,i=>{if(QDt(i))return this._getRendererLegendElements(i.renderer,{title:i.title});if(i.featureSet&&i.featureSet.features.length){const r=i.layerDefinition,s=r&&r.drawingInfo,n=s&&IQe(s.renderer),o=GDt.read(r.geometryType);return n?this._getRendererLegendElements(n,{title:i.name,geometryType:o}):(D_.warn("drawingInfo not available!"),null)}return null});try{const i=[];await Us(t).then(r=>{r.forEach(({value:s})=>s&&i.push(...s))}),this.legendElements=i,this.notifyChange("ready")}catch(i){D_.warn("error while building legend for layer!",i)}}async buildLegendElementsForRenderer(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getRendererLegendElements(e):[],this.notifyChange("ready")}catch(t){D_.warn("error while building legend for layer!",t)}}async buildLegendElementsForTools(){var t,i;const e=this.layer;if(ZDt(e))this._constructLegendElementsForVoxellayer();else if(YDt(e))this._constructLegendElementsForWMTSlayer();else if(XDt(e))await this._constructLegendElementsForWMSSublayers();else if(u0e(e))await this._constructLegendElementsForBuildingSceneLayer();else if(h0e(e)||JDt(e)||u0e(e))await this._constructLegendElementsForSublayers();else{this._handles.remove("imageryLayers-watcher");let r="default";oP(e)&&(r=(((t=e==null?void 0:e.renderingRule)==null?void 0:t.functionName)||"default")+"_"+(((i=e.bandIds)==null?void 0:i.length)?e.bandIds.join(""):"###")),await this._getLegendLayers(`${e.uid}-${r}`).then(async s=>{this.legendElements=[],this.notifyChange("ready");const n=s.map(async o=>{if(oP(e)||VH(e)){const l=re(()=>["renderingRule"in e&&e.renderingRule,e.bandIds],()=>UV(async()=>{RE.default=null,e.renderer?await this.buildLegendElementsForRenderer(e.renderer):await this.buildLegendElementsForTools()})());this._handles.add(l,"imageryLayers-watcher")}const a=this._generateSymbolTableElementForLegendLayer(o);a&&a.infos.length&&(oP(e)&&(a.title=e.title),this.legendElements.push(a)),this.notifyChange("ready")});await Us(n)}).catch(s=>{D_.warn("Request to server for legend has failed!",s)})}}async _isLayerInCurrentView(){const e=this.layer,t=this.layerView,i=t&&"createQuery"in t&&"queryFeatureCount"in t;if(!i&&!(t&&"createQuery"in e&&"queryFeatureCount"in e))return!0;await gv(()=>!t.updating);const r=i?"createQuery"in t&&t.createQuery():"createQuery"in e&&e.createQuery();return r.geometry=this.view.extent,(i?"queryFeatureCount"in t&&await t.queryFeatureCount(r):"queryFeatureCount"in e&&await e.queryFeatureCount(r))!==0}_getParentLayerOpacity(e){let t=1;const i=e.parent;return i&&"uid"in i&&(t=this._getParentLayerOpacity(i)),e.opacity*t}_isGroupActive(){const e=this.children;return!!e.length&&e.some(t=>t.ready)}_isRendererScaleDriven(e){if(e.type==="dot-density")return!0;const t="valueExpression"in e&&e.valueExpression;if(L4.test(t))return!0;const i="visualVariables"in e&&e.visualVariables;return!!i&&i.some(r=>this._isScaleDrivenSizeVariable(r))}_isScaleDrivenSizeVariable(e){if(e&&e.type!=="size")return!1;const t=e,i=t.minSize,r=t.maxSize;return typeof i=="object"&&i?this._isScaleDrivenSizeVariable(i):typeof r=="object"&&r?this._isScaleDrivenSizeVariable(r):!!t.expression||L4.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some(i=>this._isLayerScaleDriven(i));const t=e.parent;if(e.loaded===!1&&t&&h0e(t)&&"source"in e&&e.source&&e.source.type==="map-layer"){for(const i of t.sourceJSON.layers)if(i.id===e.source.mapLayerId&&(i.minScale>0||i.maxScale>0))return!0}return!1}async _constructLegendElementsForVoxellayer(){var n;this.legendElements=[],this._handles.remove("voxel-style-watcher");const e=this.layer;this._handles.add(re(()=>e.currentVariableId,()=>this._constructLegendElementsForVoxellayer()),"voxel-style-watcher");const t=e.getVariableStyle(null),i=[];if(t){if((n=t.uniqueValues)==null?void 0:n.length){const o=[];t.uniqueValues.forEach(a=>{a.enabled&&o.push({label:a.label||`${a.value}`,value:a.value,symbol:new wp({color:a.color,outline:null})})}),o.length&&i.push({type:"symbol-table",title:t.label,infos:o})}else if(t.transferFunction){const{colorStops:o,stretchRange:a}=t.transferFunction,l=o.toArray().reverse(),c=a.map((p,f)=>`${f===0?ETe:CTe} ${kDt(p)}`).reverse(),h=l.map(p=>({color:p.color,value:null,label:null}));h[0].label=c[0],h[h.length-1].label=c[1],i.push({type:"color-ramp",title:t.label,infos:h,preview:Sx(l.map(p=>p.color))})}}const r=e.opacity,s=i.reduce((o,a)=>o.concat(this._getAllInfos(a)),[]).filter(o=>!!(o==null?void 0:o.symbol)).map(o=>this._getSymbolPreview(o,r));await Us(s),this.legendElements=i,this.notifyChange("ready")}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");const e=this.layer.activeLayer;if(this._handles.add(re(()=>{const{layer:t}=this;return t&&"activeLayer"in t&&t.activeLayer},()=>this._constructLegendElementsForWMTSlayer()),"wmts-activeLayer-watcher"),e.styleId&&e.styles){let t=null;e.styles.some(i=>e.styleId===i.id&&(t=i.legendUrl,!0)),t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}])}this.notifyChange("ready")}async _constructLegendElementsForWMSSublayers(){this.legendElements=[],this._handles.remove("wms-sublayers-watcher");const e=this.layer;let t=null;(e.customParameters||e.customLayerParameters)&&(t=F(F({},e.customParameters),e.customLayerParameters)),this._handles.add(re(()=>{const{layer:i}=this;return i&&"sublayers"in i&&i.sublayers},()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher"),this.legendElements=await this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready")}async _generateLegendElementsForWMSSublayers(e,t){const i=[];this._handles.add(e.on("change",()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher");const r=e.toArray();for(const s of r){const n=re(()=>[s.title,s.visible,s.legendEnabled],()=>this._constructLegendElementsForWMSSublayers());if(this._handles.add(n,"wms-sublayers-watcher"),!this.respectLayerVisibility||s.visible&&s.legendEnabled){const o=await this._generateSymbolTableElementForWMSSublayer(s,t);o&&o.infos.length&&i.unshift(o)}}return i}async _generateSymbolTableElementForWMSSublayer(e,t){if(!e.legendUrl&&e.sublayers){const i=(await this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter(r=>r);return{type:"symbol-table",title:e.title,infos:i}}return this._generateSymbolTableElementForLegendUrl(e,t)}async _generateSymbolTableElementForLegendUrl(e,t){var o;let i=e.legendUrl;if(!i)return;const r={type:"symbol-table",title:e.title||e.name||e.id&&e.id+"",infos:[]};t&&(i=s5(i,t));let s=null;const n=(o=e.layer)==null?void 0:o.opacity;try{s=(await Zt(i,{responseType:"image"})).data,s&&(s.style.opacity=n)}catch{}return r.infos.push({src:i,preview:s,opacity:n}),r}_getLegendLayers(e,t){const i=RE&&RE[e];return i?Promise.resolve(i):this._legendRequest(t).then(r=>{const s=r.layers;return RE[e]=s,s})}_legendRequest(e){const t=this.layer;let i={f:"json",dynamicLayers:e};if(oP(t)){const s=t.exportImageServiceParameters.renderingRule;if(s&&(i.renderingRule=JSON.stringify(s.rasterFunctionDefinition||s.toJSON())),t.bandIds&&(i.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){const{raster:n,viewId:o,customParameters:a}=t;i=F(F({raster:n,viewId:o},i),a)}}let r=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){const s=r.indexOf("?");s>-1?r=r.substring(0,s)+"/legend"+r.substring(s):r+="/legend"}else{const s=r.toLowerCase().indexOf("/rest/"),n=r.substring(0,s)+r.substring(s+5,r.length);r=UDt+"?soapUrl="+encodeURI(n)+"&returnbytes=true"}return Zt(r,{query:i}).then(s=>s.data)}async _constructLegendElementsForBuildingSceneLayer(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(re(()=>e.sublayers,()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){D_.warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForBuildingSublayers(e,t){let i=[];this._handles.add(e.on("change",()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");const r=e.toArray();for(const s of r){const n=re(()=>["renderer"in s&&s.renderer,s.opacity,s.title,s.visible],()=>this._constructLegendElementsForBuildingSceneLayer());if(this._handles.add(n,"sublayers-watcher"),!this.respectLayerVisibility||s.visible){const o=s&&s.opacity!=null?s.opacity:null,a=o!=null?o*t:t;if(s.type==="building-group"){const l={type:"symbol-table",title:s.title,infos:[]},c=await this._generateLegendElementsForBuildingSublayers(s.sublayers,a);l.infos.push(...c),i=[l,...i]}else s.renderer&&(i=[...await this._getRendererLegendElements(s.renderer,{title:s.title,opacity:a,sublayer:s}),...i])}}return i.filter(s=>!!s&&(!("infos"in s)||s.infos.length>0))}async _constructLegendElementsForSublayers(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(re(()=>e.sublayers,()=>this._constructLegendElementsForSublayers),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){D_.warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForSublayers(e,t,i){const r=this.layer;let s=[];this._handles.add(e.on("change",()=>this._constructLegendElementsForSublayers()),"sublayers-watcher");let n=e.toArray();!i&&this.sublayerIds&&this.sublayerIds.length&&(n=this.sublayerIds.map(o=>r.findSublayerById(o)).filter(Boolean));for(const o of n){const a=re(()=>[o.renderer,o.opacity,o.title,o.visible,o.legendEnabled],()=>this._constructLegendElementsForSublayers());if(this._handles.add(a,"sublayers-watcher"),!this.respectLayerVisibility||o.visible&&o.legendEnabled&&this._isSublayerInScale(o)){const l=o&&o.opacity!=null?o.opacity:null,c=l!=null?l*t:t;if(o.renderer&&!o.sublayers&&o.originIdOf("renderer")>st.SERVICE)await o.load(),s=[...await this._getRendererLegendElements(o.renderer,{title:o.title,opacity:c,sublayer:o}),...s];else{const h=await this._generateSymbolTableElementForSublayer(o,c,i);h&&s.unshift(h)}}}return s.filter(o=>!!o&&(!("infos"in o)||o.infos.length>0))}async _generateSymbolTableElementForSublayer(e,t,i){if(!i){i=new Map;const s=this.layer,n=e.source;let o=null;if(!(!n||n.type==="map-layer"&&n.mapLayerId===e.id&&(!n.gdbVersion||n.gdbVersion===("gdbVersion"in s&&s.gdbVersion)))||e.originIdOf("renderer")>st.SERVICE||e.originIdOf("labelingInfo")>st.SERVICE||e.originIdOf("labelsVisible")>st.SERVICE){const l=new _h({layer:this.layer});o=l.hasDynamicLayers?l.dynamicLayers:null,l.destroy()}const a=o||`${s.uid}-default`;(await this._getLegendLayers(a,o)).forEach(l=>i.set(l.layerId,l))}const r=i.get(e.id);if((!r||(r==null?void 0:r.subLayerIds)&&r.defaultVisibility)&&e.sublayers){const s=await this._generateLegendElementsForSublayers(e.sublayers,t,i);return{type:"symbol-table",title:e.title,infos:s}}return this._generateSymbolTableElementForLegendLayer(r,e,t)}_generateSymbolTableElementForLegendLayer(e,t,i){var a;if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;const r=t==null?void 0:t.renderer;let s=(t==null?void 0:t.title)||e.layerName;if(r&&(!t||(t==null?void 0:t.originIdOf("renderer"))>st.SERVICE)){const l=(t==null?void 0:t.title)||this._getRendererTitle(r,t);l&&(s&&typeof l!="string"&&"title"in l&&(l.title=s),s=l)}const n={type:"symbol-table",title:s,legendType:e.legendType?e.legendType:null,infos:[]},o=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return((a=e.legendGroups)==null?void 0:a.length)>0?e.legendGroups.forEach(l=>{var h;const c={type:"symbol-table",title:l.heading,legendType:e.legendType?e.legendType:null,infos:this._generateSymbolTableElementInfosForLegendLayer(o.filter(p=>p.groupId===l.id),e.layerId,i)};((h=c.infos)==null?void 0:h.length)>0&&n.infos.push(c)}):n.infos=this._generateSymbolTableElementInfosForLegendLayer(o,e.layerId,i),n.infos.length>0?n:null}_generateSymbolTableElementInfosForLegendLayer(e,t,i){return e.map(r=>{let s=r.url;if(r.imageData&&r.imageData.length>0)s=`data:image/png;base64,${r.imageData}`;else{if(s.indexOf("http")===0)return null;s=qVe(`${this.layer.url}/${t}/images/${s}`)}return{label:r.label,src:s,opacity:i==null?this.opacity:i,width:r.width,height:r.height}}).filter(r=>!!r)}_isSublayerInScale(e){const t=e.minScale||0,i=e.maxScale||0;return!(t>0&&t<this.scale||i>this.scale)}_isLegendLayerInScale(e,t){const i=t||this.layer;let r=null,s=null,n=!0;return!i.minScale&&i.minScale!==0||!i.maxScale&&i.maxScale!==0?(e.minScale===0&&i.tileInfo&&(r=i.tileInfo.lods[0].scale),e.maxScale===0&&i.tileInfo&&(s=i.tileInfo.lods[i.tileInfo.lods.length-1].scale)):(r=Math.min(i.minScale,e.minScale)||i.minScale||e.minScale,s=Math.max(i.maxScale,e.maxScale)),(r>0&&r<this.scale||s>this.scale)&&(n=!1),n}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&this.layer.version<10.1||e.length===0)return e;const i=t.renderer,r=e.some(o=>o.values);let s=null,n=null;return r&&e.some((o,a)=>(o.values||(s=a,n=o,n.label||(n.label="others")),n!=null)),i?i.type==="unique-value"?n&&(e.splice(s,1),e.push(n)):i.type==="class-breaks"&&(n&&e.splice(s,1),e.reverse(),n&&e.push(n)):n&&(e.splice(s,1),e.push(n)),e}async _getRendererLegendElements(e,t={}){return WDt(e,this.view)?HDt(e)?this._constructPointCloudRendererLegendElements(e,t):zLe(e)?this._constructDotDensityRendererLegendElements(e):VLe(e)?this._constructPieChartRendererLegendElements(e):this._constructRendererLegendElements(e,t):(D_.warn(`Renderer of type '${e.type}' not supported!`),[])}_getPointCloudRendererTitle(e){return e.legendOptions&&e.legendOptions.title||e.field}_constructPointCloudRendererLegendElements(e,t={}){const i=t.title,r=[];let s=null,n=null;if(Use(e))s={type:"symbol-table",title:i||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach(a=>{s.infos.unshift({label:a.label||a.minValue+" - "+a.maxValue,value:[a.minValue,a.maxValue],symbol:this._getAppliedCloneSymbol(D4,a.color)})});else if(zse(e)){const a=e.stops;let l=null;if(a.length&&(a.length===1&&(l=a[0].color),!l)){const h=a[0].value,p=a[a.length-1].value;h!=null&&p!=null&&(l=RTe(h+(p-h)/2,a))}s={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(D4,l||D4.color)}]};const c=sWe(e.stops);n={type:"color-ramp",title:i||this._getPointCloudRendererTitle(e),infos:c,preview:Sx(c.map(h=>h.color))}}else Vse(e)&&(s={type:"symbol-table",title:i||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach(a=>{s.infos.push({label:a.label||a.values.join(", "),value:a.values.join(", "),symbol:this._getAppliedCloneSymbol(D4,a.color)})}));s&&s.infos.length&&r.push(s),n&&n.infos.length&&r.push(n);const o=r.reduce((a,l)=>a.concat(l.infos),[]).filter(a=>!!a.symbol).map(a=>this._getSymbolPreview(a,this.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}}));return Us(o).then(()=>r)}_getElementInfoForDotDensity(e,t){var f;const{backgroundColor:i,outline:r,dotSize:s}=e,n=(f=this.effectList)==null?void 0:f.effects.map(m=>m.toJSON()),o=KU(n),a=s+"-"+t+"-"+i+"-"+(r&&JSON.stringify(r.toJSON()))+"-"+o,l=this._dotDensityUrlCache,c=l.has(a)?l.get(a):Xtt(e,t);l.set(a,c);const h={shape:{type:"image",x:0,y:0,width:c.width,height:c.height,src:c.src},fill:null,stroke:null,offset:[0,0]},p=IL([[h]],[c.width,c.height],{effectView:this.effectList});return{opacity:1,src:c.src,preview:p,width:c.width,height:c.height}}_constructDotDensityRendererLegendElements(e){const t=e.calculateDotValue(this.view.scale),i=e.legendOptions&&e.legendOptions.unit,r={type:"symbol-table",title:{value:t&&Math.round(t),unit:i||""},infos:[]};return e.attributes.forEach(s=>{const n=this._getElementInfoForDotDensity(e,s.color);n.label=s.label||s.valueExpressionTitle||s.field,r.infos.push(n)}),Promise.resolve([r])}async _constructPieChartRendererLegendElements(e){var l,c,h,p;const t=this.layer.opacity,i=[],r="Others",s=e.outline;e.attributes.forEach(f=>{const m=new hl({color:f.color,outline:s}),g=f.label||f.valueExpressionTitle||f.field;i.push({label:g,symbol:m})});const n=i.length?[...i]:[];if(((l=e.othersCategory)==null?void 0:l.color)&&((c=e.othersCategory)==null?void 0:c.threshold)!==0){const f=new hl({color:e.othersCategory.color,outline:s});i.push({label:e.othersCategory.label||r,symbol:f})}if((h=e.defaultColor)==null?void 0:h.a){const f=new hl({color:e.defaultColor,outline:s});i.push({label:e.defaultLabel,symbol:f})}const o=await this._getVisualVariableLegendElements(e,this.layer)||[];if(i.length){o.unshift({type:"symbol-table",title:null,infos:i});const f=n.filter(g=>g.label!==r).map(g=>g.symbol.color).filter(Boolean),m=Ytt(f,{holePercentage:e.holePercentage,backgroundColor:(p=e.backgroundFillSymbol)==null?void 0:p.color,effectList:this.effectList,outline:s});o.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(e,this.layer),infos:i,preview:m})}const a=o.reduce((f,m)=>f.concat(this._getAllInfos(m)),[]).filter(f=>!!(f==null?void 0:f.symbol)&&!(f==null?void 0:f.preview)).map(f=>this._getSymbolPreview(f,t,{effectList:this.effectList}));return await Us(a),o}async _constructRendererLegendElements(e,t={}){var x;const{title:i,sublayer:r}=t,s=r||this.layer;let n=await this._loadRenderer(e);this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;const o=await this._getVisualVariableLegendElements(n,s)||[],a={type:"symbol-table",title:i||this._getRendererTitle(n,s),infos:[]};let l=null,c=!1;const h=new Set;if(mQ(n)&&!this._hasSizeRamp){const b=await MTe(n);a.infos.push({label:null,symbol:b})}else if(tNt(n)){let b=i;const S=iNt(n)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",T=o.findIndex(U=>U.type==="color-ramp"),C=T!==-1?o.splice(T,1)[0]:null,A=o.findIndex(U=>U.type==="size-ramp"),O=A!==-1?o.splice(A,1)[0]:null,D=[];C&&(b=C.title,D.push(C)),O&&(b=O.title,D.push(O)),D.length>0&&o.push({type:S,title:b,infos:D})}else if(ULe(n)){const b=PTe(n);o.push({type:"heatmap-ramp",title:i||((x=n.legendOptions)==null?void 0:x.title),infos:b,preview:Sx(b.map(S=>S.color),{effectList:this.effectList})})}else if(gQ(n)){const b=n&&n.authoringInfo;if(b&&b.type==="relationship"){const{focus:S,numClasses:T,field1:C,field2:A}=b;if(T&&C&&A){const O=[C,A];let D=OLe(S)||0;for(const k of O){const{field:B,normalizationField:j,label:H}=k,K=H||{field:this._getFieldAlias(B,s),normField:j&&this._getFieldAlias(j,s)},ee=rNt.clone();ee.angle=D,a.infos.push({label:K,symbol:ee}),h.add(ee),D+=90}const U=wDt({focus:S,numClasses:T,infos:n.uniqueValueInfos});o.unshift(U)}}else{const S=n.field;n.uniqueValueInfos.forEach(T=>{T.symbol&&a.infos.push({label:T.label||this._getDomainName(S,T.value,s)||T.value,value:T.value,symbol:T.symbol})})}n.defaultSymbol&&(a.infos.push({label:n.defaultLabel||"others",symbol:n.defaultSymbol}),c=!0)}else if(OC(n))l=this._isUnclassedRenderer(n),(!l||!this._hasSizeRamp)&&(n.classBreakInfos.forEach(b=>{b.symbol&&a.infos.unshift({label:b.label||(l?null:b.minValue+" - "+b.maxValue),value:[b.minValue,b.maxValue],symbol:b.symbol})}),l&&(a.title=null),this._updateInfosforClassedSizeRenderer(n,a.infos)),n.defaultSymbol&&!l&&(a.infos.push({label:n.defaultLabel||"others",symbol:n.defaultSymbol}),c=!0);else if(FLe(n))if(VH(this.layer)||KDt(this.layer)){const b=this._constructTileImageryStretchRendererElements(n);eNt(b)?o.push(b):a.infos=b}else{const b=this.layer;let S,T;n.statistics&&n.statistics.length&&(S=n.statistics[0].min!=null?n.statistics[0].min:n.statistics[0][0],T=n.statistics[0].max!=null?n.statistics[0].max:n.statistics[0][1]);let C=[];const A=b.renderingRule?await b.generateRasterInfo(b.renderingRule):b.serviceRasterInfo,O=A.keyProperties.BandProperties,D=c0e[b.rasterInfo.pixelType.toLowerCase()];A.bandCount===1||b.bandIds&&b.bandIds.length===1?(S=S!=null?S:A.statistics?A.statistics[b.bandIds[0]].min:D[0],T=T!=null?T:A.statistics?A.statistics[b.bandIds[0]].max:D[1],S||T?o.push(this._getStretchLegendElements(n,{min:S,max:T})):this._getServerSideLegend()):A.bandCount>=3?O&&O.length>=A.bandCount?b.bandIds&&b.bandIds.length===3?(C=b.bandIds.map(U=>O[U].BandName),a.infos=this._createSymbolTableElementMultiBand(C)):b.format==="lerc"?(C=[0,1,2].map(U=>O[U].BandName),a.infos=this._createSymbolTableElementMultiBand(C)):this._getServerSideLegend():b.format==="lerc"?(C=["band1","band2","band3"],a.infos=this._createSymbolTableElementMultiBand(C)):this._getServerSideLegend():this._getServerSideLegend()}else if(NLe(n))n.colormapInfos.forEach(b=>{a.infos.push({label:b.label,value:b.value,symbol:this._getAppliedCloneSymbol(jDt,b.color)})});else if(MC(n)){let b=n.symbol;switch(t.geometryType){case"point":b="pointSymbol"in s&&s.pointSymbol;break;case"polyline":b="lineSymbol"in s&&s.lineSymbol;break;case"polygon":b="polygonSymbol"in s&&s.polygonSymbol}n.symbol&&!this._hasSizeRamp&&a.infos.push({label:n.label,symbol:b})}else if(DLe(n)){n.outputUnit&&(this.title="("+n.toJSON().outputUnit+")"),a.title=n.attributeField;const b=n.getClassBreakInfos();(b==null?void 0:b.length)?b.forEach(S=>{a.infos.push({label:S.minValue+" - "+S.maxValue,symbol:S.symbol})}):a.infos.push({label:n.attributeField,symbol:n.getDefaultSymbol()})}else kLe(n)&&o.push(this._getStretchLegendElements(n,{min:0,max:255}));const p=n.defaultSymbol;!p||c||MC(n)||l&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||o.push({type:"symbol-table",infos:[{label:n.defaultLabel||"others",symbol:p}]}),a.infos.length&&o.unshift(a);const f=t.opacity==null?this.opacity:t.opacity,m=this._isTallSymbol("visualVariables"in n&&n.visualVariables),g=oP(this.layer)||VH(this.layer),y=o.reduce((b,S)=>b.concat(this._getAllInfos(S)),[]).filter(b=>!!(b==null?void 0:b.symbol)).map(b=>this._getSymbolPreview(b,f,{isDefault:b.symbol===p,applyScaleDrivenSize:!h.has(b.symbol),symbolConfig:{isTall:m,isSquareFill:g},effectList:h.has(b.symbol)?null:this.effectList}));return n=null,await Us(y),o}_getServerSideLegend(){setTimeout(()=>this.buildLegendElementsForTools(),0)}_getAllInfos(e){const t=e==null?void 0:e.infos;return t?t.reduce((i,r)=>i.concat(this._getAllInfos(r)),[]):[e]}_constructTileImageryStretchRendererElements(e){var h,p;const t=this.layer,i=t.rasterInfo,r=i.bandCount||e.statistics.length;let s,n,o=[];const a=i.keyProperties&&i.keyProperties.BandProperties,l=((h=e==null?void 0:e.statistics)==null?void 0:h.length)?e.statistics:i==null?void 0:i.statistics;if(l)s=l[0].min!==void 0?l[0].min:l[0][0],n=l[0].max||l[0][1];else{const f=c0e[t.rasterInfo.pixelType.toLowerCase()];s=f[0],n=f[1]}if(t.hasStandardTime()&&(s=t.getStandardTimeValue(s),n=t.getStandardTimeValue(n)),i.bandCount===1||((p=t.bandIds)==null?void 0:p.length)===1)return this._getStretchLegendElements(e,{min:s,max:n});function c(f){var g;const m=(((g=t==null?void 0:t.bandIds)==null?void 0:g.length)?t.bandIds:Array.from(Array(Math.min(i.bandCount,3)).keys())).map(y=>f&&f[y]&&f[y].BandName||"band"+(y+1));return m.length<3?m.push(m[1]):m.length>3&&m.splice(3),m}return o=a&&a.length>=r?c(a):c(),this._createSymbolTableElementMultiBand(o)}_getStretchLegendElements(e,t){const i=e.colorRamp,r=oWe(i,t);return{type:"stretch-ramp",title:"",infos:r,preview:Sx(r.map(s=>s.color))}}async _getSizeLegendElement(e,t,i,r){return{type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(t):e,infos:await ODt(i,t,await vZ(i),this.scale,this.view.type,r)}}_createSymbolTableElementMultiBand(e){const t=[],i=["red","green","blue"];return e.forEach((r,s)=>{var n;t.push({label:{colorName:i[s],bandName:r},src:tWe[s],opacity:(n=this.opacity)!=null?n:1})}),t}_updateInfosforClassedSizeRenderer(e,t){const i=e.authoringInfo&&e.authoringInfo.type==="class-breaks-size",r=e.classBreakInfos.some(s=>zB(s.symbol));if(i&&r){const s=pQ,n=fQ,o=e.classBreakInfos.length,a=(s-n)/(o>1?o-1:o);t.forEach((l,c)=>{l.size=s-a*c})}}_isTallSymbol(e){let t=!1,i=!1;if(e)for(let r=0;r<e.length&&(!t||!i);r++){const s=e[r];s.type==="size"&&(s.axis==="height"&&(t=!0),s.axis==="width-and-depth"&&(i=!0))}return t&&i}async _getSymbolPreview(e,t,i){let r=!(i==null?void 0:i.isDefault)&&e.size==null&&this._hasSizeRamp?Vc(jo.size):e.size;if(this._scaleDrivenSizeVariable&&(i==null?void 0:i.applyScaleDrivenSize)){const{getSize:s}=await Promise.resolve().then(function(){return o2});r=s(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:e.symbol.type==="simple-marker"?e.symbol.style:null})}return VEe(e.symbol,{size:r,opacity:t,scale:!1,symbolConfig:i==null?void 0:i.symbolConfig,effectView:i==null?void 0:i.effectList}).then(s=>(e.preview=s,e)).catch(()=>(e.preview=null,e))}async _loadRenderer(e){var n,o;const t=[],i=this.layer;e=e.clone(),this._hasClusterSizeVariable=!1;const r="visualVariables"in e&&((n=e.visualVariables)==null?void 0:n.some(a=>a.type==="size"&&a.target!=="outline"&&!L4.test(a.valueExpression)));if(e&&"visualVariables"in e&&!r&&"featureReduction"in i&&((o=i.featureReduction)==null?void 0:o.type)==="cluster"){const a=this.layerView._effectiveRenderer,l=nDt(a,this.view);if(l){const c=i.featureReduction;if("clusterMinSize"in c&&"clusterMaxSize"in c){const{clusterMinSize:p,clusterMaxSize:f}=c;l.legendOptions=new y2e({showLegend:p!==f})}const h=e.visualVariables||[];e.visualVariables=h.concat([l]),this._hasClusterSizeVariable=!0}}const s=await vZ(e);if(OC(e)||gQ(e)){const a=(e.classBreakInfos||e.uniqueValueInfos).map(l=>this._fetchSymbol(l.symbol,s).then(c=>{l.symbol=c}).catch(()=>{l.symbol=null}));Array.prototype.push.apply(t,a)}return t.push(this._fetchSymbol(e.symbol||e.defaultSymbol,e.defaultSymbol?null:s).then(a=>{this._applySymbolToRenderer(e,a,MC(e))}).catch(()=>{this._applySymbolToRenderer(e,null,MC(e))})),Us(t).then(()=>e)}_applySymbolToRenderer(e,t,i){i?e.symbol=t:e.defaultSymbol=t}async _fetchSymbol(e,t){if(!e)throw new Error;if(e.type==="web-style"){const i=this._webStyleSymbolCache;try{const r=await(this.view.type==="2d"?e.fetchCIMSymbol({cache:i}):e.fetchSymbol({cache:i}));return this._getAppliedCloneSymbol(r,t)}catch{throw D_.warn("Fetching web-style failed!"),new Error}}return this._getAppliedCloneSymbol(e,t)}_getAppliedCloneSymbol(e,t){if(!e||!t)return e;const i=e.clone(),r=t&&t.toRgba();return i.type.includes("3d")?this._applyColorTo3dSymbol(i,r):i.type==="cim"?vTe(i,t):i.color&&(i.color=new Le(r||i.color)),i}_applyColorTo3dSymbol(e,t){t&&e.symbolLayers.forEach(i=>{i&&(i.material||(i.material={}),i.material.color=new Le(t))})}async _getVisualVariableLegendElements(e,t){if(!("visualVariables"in e)||!e.visualVariables||e.type==="vector-field")return null;const i=e.visualVariables,r=[],s=[],n=[];for(const h of i)h.type==="color"?r.push(h):h.type==="size"?s.push(h):h.type==="opacity"&&n.push(h);const o=[...r,...s,...n];let a,l;if(r.length===0&&OC(e)&&e.classBreakInfos&&e.classBreakInfos.length===1){const h=e.classBreakInfos[0];a=h&&h.symbol}if(r.length===0&&MC(e)&&(a=e.symbol),a)if(a.type.includes("3d")){const h=a.symbolLayers.getItemAt(0);h.type==="water"?_(h.color)&&(l=h.color):_(h.material)&&_(h.material.color)&&(l=h.material.color)}else a.url||(l=a.color);const c=this.effectList;return(await Promise.all(o.map(async h=>{if(!h.legendOptions||h.legendOptions.showLegend!==!1){const p=mQ(e)?h.field:this._getRampTitle(h,t);let f=null;const m="getField"in t&&t.getField&&t.getField(h.field),g=m&&rze(m);if(h.type==="color"){const y=await _Z(h,null,g);f={type:"color-ramp",title:p,infos:y,preview:Sx(y.map(x=>x.color),{effectList:c})},this._hasColorRamp||(this._hasColorRamp=!(f.infos==null||!f.infos.length))}else if(h.type==="size"&&h.target!=="outline")L4.test(h.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=h):(f=await this._getSizeLegendElement(p,h,e,g),this._hasSizeRamp||(this._hasSizeRamp=!(f.infos==null||!f.infos.length)));else if(h.type==="opacity"){const y=await _Z(h,l,g);f={type:"opacity-ramp",title:p,infos:y,preview:Sx(y.map(x=>x.color),{effectList:c})},this._hasOpacityRamp||(this._hasOpacityRamp=!(f.infos==null||!f.infos.length))}return f&&f.infos?f:null}}))).filter(h=>!!h)}_getDomainName(e,t,i){if(e&&typeof e!="function"){const r="getField"in i&&i.getField&&i.getField(e),s=r&&"getFieldDomain"in i&&i.getFieldDomain?i.getFieldDomain(r.name):null;return s&&s.type==="coded-value"?s.getName(t):null}return null}_getClusterTitle(e){const t=this.layer,i=e.field;if("featureReduction"in t&&t.featureReduction&&t.featureReduction.type==="cluster"){const r=t.featureReduction,s="popupTemplate"in r&&r.popupTemplate,n=s&&s.fieldInfos;if(n){for(const o of n)if(o.fieldName===i)return i==="cluster_count"?o.label||{showCount:!0}:o.label}}return{showCount:!0}}_getRampTitle(e,t){let i=e.field,r=e.normalizationField,s=!1,n=!1,o=!1,a=null;i=typeof i=="function"?null:i,r=typeof r=="function"?null:r;const l=e.legendOptions&&e.legendOptions.title;if(l!=null)a=l;else if(e.valueExpressionTitle)a=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables){const c=t.renderer.authoringInfo.visualVariables;for(let h=0;h<c.length;h++){const p=c[h];if(p.type==="color"){if(p.style==="ratio"){s=!0;break}if(p.style==="percent"){n=!0;break}if(p.style==="percent-of-total"){o=!0;break}}}}a={field:i&&this._getFieldAlias(i,t),normField:r&&this._getFieldAlias(r,t),ratio:s,ratioPercent:n,ratioPercentTotal:o}}return a}_getRendererTitle(e,t){const i=e;if(i.legendOptions&&i.legendOptions.title)return i.legendOptions.title;if(i.valueExpressionTitle)return i.valueExpressionTitle;let r=i.field,s=null,n=null;OC(i)&&(s=i.normalizationField,n=i.normalizationType==="percent-of-total"),r=typeof r=="function"?null:r,s=typeof s=="function"?null:s;let o=null;return(r||s)&&(o={field:r&&this._getFieldAlias(r,t),normField:s&&this._getFieldAlias(s,t),normByPct:n}),o}_getFieldAlias(e,t){const i="popupTemplate"in t&&t.popupTemplate,r=i&&i.fieldInfos;let s=null;r&&r.some(l=>e===l.fieldName&&(s=l,!0));let n=null;"getField"in t&&t.getField?n=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(n=t.fieldsIndex.get(e));const o=s||n;let a=null;return o&&(a=s&&s.label||n&&n.alias||"name"in o&&o.name||"fieldName"in o&&o.fieldName),a}_isUnclassedRenderer(e){const t=e.visualVariables;let i=!1;return OC(e)&&e.classBreakInfos&&e.classBreakInfos.length===1&&t&&(i=e.field?t.some(r=>!(!r||e.field!==r.field||(e.normalizationField||r.normalizationField)&&e.normalizationField!==r.normalizationField)):!!t.length),i}};u([d()],Eo.prototype,"children",void 0),u([d({readOnly:!0})],Eo.prototype,"effectList",null),u([d()],Eo.prototype,"layerView",void 0),u([d()],Eo.prototype,"layer",void 0),u([d()],Eo.prototype,"legendElements",void 0),u([d({readOnly:!0})],Eo.prototype,"opacity",null),u([d()],Eo.prototype,"parent",void 0),u([d({readOnly:!0,dependsOn:[]})],Eo.prototype,"ready",null),u([d()],Eo.prototype,"hideLayersNotInCurrentView",void 0),u([d()],Eo.prototype,"keepCacheOnDestroy",void 0),u([d()],Eo.prototype,"respectLayerVisibility",void 0),u([d({readOnly:!0})],Eo.prototype,"scale",null),u([d()],Eo.prototype,"sublayerIds",void 0),u([d({readOnly:!0})],Eo.prototype,"isScaleDriven",null),u([d()],Eo.prototype,"title",void 0),u([d({readOnly:!0,dependsOn:["ready"],value:0})],Eo.prototype,"version",null),u([d()],Eo.prototype,"view",void 0),Eo=u([L("esri.widgets.Legend.support.ActiveLayerInfo")],Eo);const BLe=Eo,Xw={state:"state",view:"view",allLayerViews:"all-layer-views",legendProperties:"legend-properties"},GLe=nt.ofType(BLe),sNt=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],jLe="view.basemapView.baseLayerViews",HLe="view.groundView.layerViews",qLe="view.basemapView.referenceLayerViews",nNt=[jLe,HLe,"view.layerViews",qLe];let Vd=class extends Ee{constructor(e){super(e),this._handles=new Nt,this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new nt,this.activeLayerInfos=new GLe,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this._handles.add(re(()=>this.view,()=>this._viewHandles(),Et),Xw.view),this._handles.add(L_e(()=>this._refresh()))}destroy(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}_viewHandles(){this._handles.remove(Xw.state),this.view&&this._handles.add(re(()=>this.state,()=>this._stateHandles(),Et),Xw.state)}_stateHandles(){this._resetAll(),this.state==="ready"&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this._handles.remove([Xw.allLayerViews,Xw.legendProperties]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(e){this._handles.remove(e);const t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t&&t.parent&&t.parent.children.remove(t)}_watchPropertiesAndAllLayerViews(){const{allLayerViews:e}=this.view;e.length&&this._refresh(),this._handles.add(e.on("change",t=>this._allLayerViewsChangeHandle(t)),Xw.allLayerViews),this._handles.add(re(()=>[this.layerInfos,this.basemapLegendVisible,this.groundLegendVisible],()=>this._propertiesChangeHandle()),Xw.legendProperties)}_allLayerViewsChangeHandle(e){e.removed.forEach(t=>this._destroyViewActiveLayerInfo(t.uid)),this._refresh()}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(e){if(e.length<2)return;const t=[];e.forEach(r=>{if(!r.parent){const s=r.layer.parent,n=s&&"uid"in s&&this._layerViewByLayerId[s.uid],o=n&&this._activeLayerInfosByLayerViewId[n.uid];o&&e.includes(o)&&(t.push(r),r.parent=o,o.children.add(r),this._sortActiveLayerInfos(o.children))}}),e.removeMany(t);const i={};this.view.allLayerViews.forEach((r,s)=>i[r.layer.uid]=s),e.sort((r,s)=>{const n=i[r.layer.uid]||0;return(i[s.layer.uid]||0)-n})}_generateLayerViews(){const e=[];return nNt.filter(this._filterLayerViews,this).map(this.get,this).filter(t=>t!=null).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){const t=!this.basemapLegendVisible&&(e===jLe||e===qLe),i=!this.groundLegendVisible&&e===HLe;return!t&&!i}_collectLayerViews(e,t){const i=r=>(r&&r.forEach(s=>{t.push(s),i(s[e])}),t);return i}_filterLayerViewsByLayerInfos(e){const t=this.layerInfos;return!t||!t.length||t.some(i=>this._hasLayerInfo(i,e))}_hasLayerInfo(e,t){const i=this._isLayerUIDMatching(e.layer,t.layer.uid);return i&&(this._layerInfosByLayerViewId[t.uid]=e),i}_isLayerUIDMatching(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}_hasLayerUID(e,t){return e&&e.some(i=>this._isLayerUIDMatching(i,t))}_isLayerViewSupported(e){return!!sNt.includes(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add(re(()=>{var t;return[e.legendEnabled,(t=e.layer)==null?void 0:t.legendEnabled]},()=>this._layerActiveHandle(e)),e.uid))}_layerActiveHandle(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e))}_isLayerActive(e){return!this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}_buildActiveLayerInfo(e){var o;const t=e.layer,i=e.uid,r=this._layerInfosByLayerViewId[i];let s=this._activeLayerInfosByLayerViewId[i];if(!s){const a=r&&r.title!==void 0&&r.layer.uid===t.uid;s=new BLe({layer:t,layerView:e,title:a?r.title:t.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:r&&r.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[i]=s}const n=t.parent&&"uid"in t.parent&&this._layerViewByLayerId[(o=t.parent)==null?void 0:o.uid];if(s.parent=this._activeLayerInfosByLayerViewId[n==null?void 0:n.uid],!this._handles.has(i)){const a=[re(()=>t.title,l=>this._titleHandle(l,s)),re(()=>[t.opacity,"renderer"in t&&t.renderer,"pointSymbol"in t&&t.pointSymbol,"lineSymbol"in t&&t.lineSymbol,"polygonSymbol"in t&&t.polygonSymbol],()=>this._constructLegendElements(s)),Jn(()=>{var l;return((l=this.view)==null?void 0:l.stationary)===!0},()=>this._scaleHandle(s),Et),re(()=>e._effectiveRenderer,()=>this._constructLegendElements(s)),re(()=>"effect"in t&&t.effect,()=>this._constructLegendElements(s))];if(this.respectLayerVisibility){const l=re(()=>e.legendEnabled,h=>this._legendEnabledHandle(h,s)),c=re(()=>t.legendEnabled,h=>this._legendEnabledHandle(h,s));a.push(l,c)}this._handles.add(a,i)}s.isScaleDriven||this._constructLegendElements(s),this._addActiveLayerInfo(s)}_titleHandle(e,t){t.title=e,this._constructLegendElements(t)}_legendEnabledHandle(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}_scaleHandle(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}_addActiveLayerInfo(e){var r;const{layerView:t,layer:i}=e;if(this._isLayerActive(t)&&!this.activeLayerInfos.includes(e)){const s=e.parent;if(s)s.children.includes(e)||s.children.push(e),this._sortActiveLayerInfos(s.children);else{const n=(r=this.layerInfos)==null?void 0:r.some(o=>o.layer.uid===i.uid);i.parent&&"uid"in i.parent&&!n?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){const n=[];this._activeLayerInfosWithNoParent.forEach(o=>{const a=o.layer.parent,l=a&&"uid"in a&&this._layerViewByLayerId[a==null?void 0:a.uid],c=this._activeLayerInfosByLayerViewId[l==null?void 0:l.uid];c&&(n.push(o),o.parent=c)}),n.length&&(this._activeLayerInfosWithNoParent.removeMany(n),n.forEach(o=>this._addActiveLayerInfo(o)))}}}_removeActiveLayerInfo(e){const t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}_constructLegendElements(e){var i;const t=e.layer;"featureCollections"in t&&t.featureCollections?e.buildLegendElementsForFeatureCollections(t.featureCollections):"featureReduction"in t&&((i=t.featureReduction)==null?void 0:i.type)==="binning"&&"renderer"in t.featureReduction?e.buildLegendElementsForRenderer(t.featureReduction.renderer):"renderer"in t&&t.renderer?e.buildLegendElementsForRenderer(t.renderer):"url"in t&&t.url?e.buildLegendElementsForTools():e.children.forEach(r=>this._constructLegendElements(r))}};u([d({type:GLe})],Vd.prototype,"activeLayerInfos",void 0),u([d()],Vd.prototype,"basemapLegendVisible",void 0),u([d()],Vd.prototype,"groundLegendVisible",void 0),u([d()],Vd.prototype,"hideLayersNotInCurrentView",void 0),u([d()],Vd.prototype,"keepCacheOnDestroy",void 0),u([d()],Vd.prototype,"respectLayerVisibility",void 0),u([d()],Vd.prototype,"layerInfos",void 0),u([d({readOnly:!0})],Vd.prototype,"state",null),u([d()],Vd.prototype,"view",void 0),Vd=u([L("esri.widgets.Legend.LegendViewModel")],Vd);const oNt=Vd,aNt="http://www.w3.org/2000/svg",gs={diamondContainer:"esri-relationship-ramp--diamond__container",diamondLeftCol:"esri-relationship-ramp--diamond__left-column",diamondRightCol:"esri-relationship-ramp--diamond__right-column",diamondMidCol:"esri-relationship-ramp--diamond__middle-column",diamondMidColLabel:"esri-relationship-ramp--diamond__middle-column--label",diamondMidColRamp:"esri-relationship-ramp--diamond__middle-column--ramp",squareTable:"esri-relationship-ramp--square__table",squareTableRow:"esri-relationship-ramp--square__table-row",squareTableCell:"esri-relationship-ramp--square__table-cell",squareTableLabel:"esri-relationship-ramp--square__table-label",squareTableLabelLeftBottom:"esri-relationship-ramp--square__table-label--left-bottom",squareTableLabelRightBottom:"esri-relationship-ramp--square__table-label--right-bottom",squareTableLabelLeftTop:"esri-relationship-ramp--square__table-label--left-top",squareTableLabelRightTop:"esri-relationship-ramp--square__table-label--right-top"};function WLe(e,t,i,r){const{focus:s,labels:n}=e,o=!!s,a=lNt(e,t,i,r),l={justifyContent:"center"},c=jl();return o?N("div",{class:gs.diamondContainer,styles:l},N("div",{class:gs.diamondLeftCol},c?n.right:n.left),N("div",{class:gs.diamondMidCol},N("div",{class:gs.diamondMidColLabel},n.top),a,N("div",{class:gs.diamondMidColLabel},n.bottom)),N("div",{class:gs.diamondRightCol},c?n.left:n.right)):N("div",{class:gs.squareTable},N("div",{class:gs.squareTableRow},N("div",{class:CT(gs.squareTableCell,gs.squareTableLabel,gs.squareTableLabelRightBottom)},c?n.top:n.left),N("div",{class:gs.squareTableCell}),N("div",{class:CT(gs.squareTableCell,gs.squareTableLabel,gs.squareTableLabelLeftBottom)},c?n.left:n.top)),N("div",{class:gs.squareTableRow},N("div",{class:gs.squareTableCell}),a,N("div",{class:gs.squareTableCell})),N("div",{class:gs.squareTableRow},N("div",{class:CT(gs.squareTableCell,gs.squareTableLabel,gs.squareTableLabelRightTop)},c?n.right:n.bottom),N("div",{class:gs.squareTableCell}),N("div",{class:CT(gs.squareTableCell,gs.squareTableLabel,gs.squareTableLabelLeftTop)},c?n.bottom:n.right)))}function d0e(e,t,i){const r=`${i}_arrowStart`,s=`${i}_arrowEnd`,n=e==="left",o={markerStart:null,markerEnd:null};switch(t){case"HL":n?o.markerStart=`url(#${s})`:o.markerEnd=`url(#${r})`;break;case"LL":o.markerStart=`url(#${s})`;break;case"LH":n?o.markerEnd=`url(#${r})`:o.markerStart=`url(#${s})`;break;default:o.markerEnd=`url(#${r})`}return o}function lNt(e,t,i,r,s=60){const{focus:n,numClasses:o,colors:a,rotation:l}=e,c=!!n,h=Math.sqrt(s**2+s**2)+(c?0:5),p=[],f=[],m=[],g=(s||75)/o;for(let B=0;B<o;B++){const j=B*g;for(let H=0;H<o;H++){const K=H*g,ee=jte(a[B][H]),ce=Hte(null),le={type:"rect",x:K,y:j,width:g,height:g};p.push(FEe(ee)),f.push(Gte(le,ee.fill,ce,null)),m.push(kEe(le))}}const y=10,x=15,b=15,S=10;let T=null;c||(T="margin: -15px -15px -18px -15px");const C=d0e("left",n,t),A=d0e("right",n,t),O=UEe(m),D=nY(O,h,h,0,!1,l,!1),U=nY(O,h,h,0,!1,c?-45:null,!1),k={filter:Z3(r),opacity:i==null?null:`${i}`};return N("div",{styles:k,class:c?gs.diamondMidColRamp:gs.squareTableCell},N("svg",{xmlns:aNt,width:h,height:h,style:T},N("defs",null,N("marker",{id:`${t}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},N("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),N("marker",{id:`${t}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},N("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),p),N("g",{transform:D},f),N("g",{transform:U},N("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":C.markerStart,"marker-end":C.markerEnd,x1:-y,y1:s-x,x2:-y,y2:x}),N("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":A.markerStart,"marker-end":A.markerEnd,x1:b,y1:s+S,x2:s-b,y2:s+S}))))}const cNt=zU(),ZLe=10,Bse=20,Q8=10,Gse=20,jse={univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",colorRamp:"esri-legend__color-ramp"};function uNt(e="vertical"){const t="stroke:rgb(200, 200, 200);stroke-width:1";return e==="vertical"?N("svg",{height:"4",width:"10"},N("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):N("svg",{height:"10",width:"10"},N("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function hNt(e,t="vertical"){const i=document.createElement("div");return i.style.height=`${Bse}px`,i.className=jse.univariateAboveAndBelowSymbol,e!=null&&(i.style.opacity=e.toString()),cNt.append(i,uNt.bind(null,t)),i}function XLe(e,t,i="vertical",r){e.infos.forEach((s,n)=>{if(r&&n===2)s.preview=hNt(t,i);else{const o=$i(s.size)+(i==="horizontal"?Gse:Q8),a=s.preview.tagName.toLowerCase()==="div",l=a?s.preview:document.createElement("div");l.className=jse.univariateAboveAndBelowSymbol,i==="horizontal"?l.style.width=`${o}px`:l.style.height=`${o}px`,a||l.appendChild(s.preview),s.preview=l}})}function AV(e,t="classic"){const i=e.infos;return t==="classic"?($i(i[0].size)+Q8)/2:($i(i[0].size)-$i(i[i.length-1].size))/2}function LA(e,t){if(!e)return null;const i=e.infos.map(s=>s.color),r=Sx(t.type==="full"?i:t.type==="above"?i.slice(0,3):i.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList});return r.className=jse.colorRamp,t.opacity!=null&&(r.style.opacity=t.opacity.toString()),r}function yQ(e,t,i,r="vertical"){let s=0;const n=e.infos,o=Math.floor(n.length/2),a=t==="full"||t==="above"?0:o,l=t==="full"||t==="below"?n.length-1:o;for(let c=a;c<=l;c++)i&&c===o?s+=r==="horizontal"?ZLe:Bse:s+=$i(n[c].size)+(r==="horizontal"?Gse:Q8);return Math.round(s)}function DA(e,t,i,r="vertical"){const s=yQ(e,t,i,r),n=e.infos,o=Math.floor(n.length/2),a=t==="full"||t==="above"?0:o,l=t==="full"||t==="below"?n.length-1:o,c=t==="full"?n[a].size+n[l].size:t==="above"?n[a].size:n[l].size,h=i?r==="vertical"?Bse:ZLe:0,p=r==="vertical"?Q8*(t==="full"?2:1):Gse*(t==="full"?2:1);return Math.round(s-($i(c)/2+h/2+p/2))}function YLe(e,t,i="vertical"){const r=e.infos;let s=r.find(({type:o})=>o==="size-ramp"),n=r.find(({type:o})=>o==="color-ramp");return s&&(s=F({},s),s.infos=[...s.infos],XLe(s,t,i,!0)),n&&(n=F({},n),n.infos=[...n.infos]),i==="horizontal"&&(s==null||s.infos.reverse(),n==null||n.infos.reverse()),{sizeRampElement:s,colorRampElement:n}}function JLe(e,t="vertical"){const i=e.infos;let r=i.find(({type:n})=>n==="size-ramp"),s=i.find(({type:n})=>n==="color-ramp");return r&&(r=F({},r),r.infos=[...r.infos],XLe(r,null,t,!1)),s&&(s=F({},s),s.infos=[...s.infos]),t==="horizontal"&&(r==null||r.infos.reverse(),s==null||s.infos.reverse()),{sizeRampElement:r,colorRampElement:s}}function dNt(e,t){return t}function la(e){const t=this;e.appendChild(t)}function NA(e,t,i){if(!t)return;if(typeof t=="string"||typeof t=="number")return t;if("value"in t||"unit"in t)return xc(e.dotValue,t);if("colorName"in t||"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:null;let r=null;return dNt(t,i)?r=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:QLe(t,i)&&(r=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),r?xc(r==="showField"?"{field}":e[r],{field:t.field,normField:t.normField}):null}function QLe(e,t){return!t}function KLe(e,t){return!!(t&&t==="Stretched"&&e.version>=10.3&&e.declaredClass==="esri.layers.ImageryLayer")}const Pt={activated:"esri-legend--card__carousel-indicator--activated",base:"esri-legend--card",stacked:"esri-legend--stacked",carouselTitle:"esri-legend--card__carousel-title",indicator:"esri-legend--card__carousel-indicator",intervalSeparator:"esri-legend--card__interval-separator",imageryLayerStretchedImage:"esri-legend--card__imagery-layer-image--stretched",imageLabel:"esri-legend--card__image-label",layerCaption:"esri-legend--card__layer-caption",labelElement:"esri-legend--card__label-element",layerRow:"esri-legend--card__layer-row",labelCell:"esri-legend--card__label-cell",message:"esri-legend--card__message",rampLabel:"esri-legend--card__ramp-label",section:"esri-legend--card__section",relationshipSection:"esri-legend--card__relationship-section",serviceCaptionText:"esri-legend--card__service-caption-text",serviceContent:"esri-legend--card__service-content",service:"esri-legend--card__service",groupLayer:"esri-legend--card__group-layer",groupLayerChild:"esri-legend--card__group-layer-child",symbol:"esri-legend--card__symbol",sizeRampRow:"esri-legend--card__size-ramp-row",symbolRow:"esri-legend--card__symbol-row",symbolCell:"esri-legend--card__symbol-cell",indicatorContainer:"esri-legend--card__carousel-indicator-container",intervalSeparatorsContainer:"esri-legend--card__interval-separators-container",relationshipLabelContainer:"esri-legend--card__relationship-label-container",labelContainer:"esri-legend--card__label-container",serviceCaptionContainer:"esri-legend--card__service-caption-container",symbolContainer:"esri-legend--card__symbol-container",sizeRampContainer:"esri-legend--card__size-ramp-container",sizeRampPreview:"esri-legend--card__size-ramp-preview",pieChartRampPreview:"esri-legend--card__pie-chart-ramp-preview",rampContainer:"esri-legend__ramps",sizeRampHorizontal:"esri-legend__size-ramp--horizontal",rampLabelsContainer:"esri-legend__ramp-labels",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card",hidden:"esri-hidden"},pNt=25,fNt=25,mNt=768,gNt=100;var T3;(function(e){e.Auto="auto",e.Stack="stack",e.SideBySide="side-by-side"})(T3||(T3={}));const yNt="#ddd",PE=window.devicePixelRatio;function vNt(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const i=e.symbolLayers.getItemAt(t-1),r=i.resource&&i.resource.primitive;return r==="circle"||r==="cross"||r==="kite"||r==="sphere"||r==="cube"||r==="diamond"}{const t=e.style;return t==="circle"||t==="diamond"||t==="cross"}}}function _Nt(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const i=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return i==="triangle"||i==="cone"||i==="tetrahedron"}return e.style==="triangle"}}let yf=class extends Yr{constructor(e,t){super(e,t),this._handles=new Nt,this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout=T3.Stack,this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.own(re(()=>this.activeLayerInfos,e=>{this._handles.removeAll(),this._watchForSectionChanges(e)}))}destroy(){this._handles.destroy(),this._handles=null}render(){this._hasIndicators=this.layout===T3.Auto&&this.view.container.clientWidth<=mNt||this.layout===T3.Stack;const e=this.activeLayerInfos,t=e&&e.toArray().map(a=>this._renderLegendForLayer(a)).filter(a=>!!a);this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const i=this._sectionNames.length,r=this._sectionNames.map((a,l)=>{const c=xc(this.messagesCommon.pagination.pageText,{index:l+1,total:i});return N("div",{key:a,role:"tab",id:a,"aria-label":c,"aria-controls":`${a}-panel`,"aria-selected":(this._selectedSectionName===a).toString(),tabIndex:this._selectedSectionName===a?0:-1,title:c,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes(Pt.indicator,{[Pt.activated]:this._selectedSectionName===a}),"data-section-name":a})}),s=this._hasIndicators&&i>1?N("div",{class:Pt.indicatorContainer,key:"carousel-navigation",role:"tablist"},r):null,n=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):t&&t.length?t:null,o={[Pt.stacked]:this._hasIndicators};return N("div",{class:this.classes(Pt.base,o)},n||N("div",{class:Pt.message},this.messages.noLegend),s)}_selectSection(e){const t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}_switchSectionOnArrowPress(e){const t=e.key,i=t==="ArrowLeft"?-1:1,r=e.target.getAttribute("data-section-name"),s=this._sectionNames.indexOf(r),n=this._sectionNames;let o=null;s!==-1&&(n[s+i]?o=document.getElementById(n[s+i]):t==="ArrowLeft"?o=document.getElementById(n[n.length-1]):t==="ArrowRight"&&(o=document.getElementById(n[0])),o&&o.focus())}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach(i=>{const r=`activeLayerInfo-${i.layer.uid}-version-change`;this._handles.remove(r),this._watchForSectionChanges(i.children),this._handles.add(re(()=>i.version,()=>this._generateSectionNames()),r)});const t="activeLayerInfos-collection-change";this._handles.remove(t),this._handles.add(e.on("change",()=>this._watchForSectionChanges(e)),t)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(e,t,i){return`${this.id}${e.uid}-type-${t.type}-${i}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach((t,i)=>{this._sectionNames.push(this._getSectionName(e.layer,t,i))})}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const t=e.children.map(i=>this._renderLegendForLayer(i)).toArray();return N("div",{key:e.layer.uid,class:this.classes(Pt.service,Pt.groupLayer)},N("div",{class:Pt.serviceCaptionContainer},e.title),t)}{const t=e.legendElements;if(t&&!t.length)return null;const i=t.some(n=>n.type==="relationship-ramp"),r=t.map((n,o)=>this._renderLegendForElement(n,e,o,i)).filter(n=>!!n);if(!r.length)return null;const s={[Pt.groupLayerChild]:!!e.parent};return N("div",{key:e.layer.uid,class:this.classes(Pt.service,s)},N("div",{class:Pt.serviceCaptionContainer},N("div",{class:Pt.serviceCaptionText},e.title)),N("div",{class:Pt.serviceContent},r))}}_renderLegendForElement(e,t,i,r=!1){const s=e.type==="color-ramp",n=e.type==="opacity-ramp",o=e.type==="size-ramp",a=t.layer;let l=null;if(typeof e.title=="string")l=e.title;else if(e.title){const g=e.title,y=NA(this.messages,g,s||n);l=g.title?`${g.title} (${y})`:y}const c=this._getSectionName(a,e,i),h=this._hasIndicators?N("div",null,N(J0,{level:this.headingLevel,class:Pt.carouselTitle},t.title),N(J0,{level:wHe(this.headingLevel),class:Pt.layerCaption},l)):l?N(J0,{level:this.headingLevel,class:Pt.layerCaption},l):null,p=t.effectList;let f=null;if(e.type==="symbol-table"){const g=e.infos.map((y,x)=>this._renderLegendForElementInfo(y,t,e.legendType,x)).filter(y=>!!y);if(g.length){const y=g[0].properties.classes&&g[0].properties.classes[Pt.symbolRow],x={[Pt.labelContainer]:!y&&!r,[Pt.relationshipLabelContainer]:r};f=N("div",{class:this.classes(x)},g)}}else e.type==="color-ramp"||e.type==="opacity-ramp"||e.type==="heatmap-ramp"?f=this._renderLegendForRamp(e,a.opacity,p):o?f=this._renderSizeRamp(e,a.opacity):e.type==="pie-chart-ramp"?f=this._renderPieChartRamp(e):e.type==="relationship-ramp"?f=WLe(e,this.id,a.opacity,p):e.type==="univariate-above-and-below-ramp"?f=this._renderUnivariateAboveAndBelowRamp(e,a.opacity,p):e.type==="univariate-color-size-ramp"&&(f=this._renderUnivariateColorSizeRamp(e,a.opacity,p));if(!f)return null;const m=N("div",{key:c,class:Pt.section,id:`${c}-panel`,role:"tabpanel","aria-labelledby":c,tabIndex:0},[h,f]);return this._sectionMap.set(c,m),m}_renderPieChartRamp(e){return N("div",{class:Pt.pieChartRampPreview,bind:e.preview,afterCreate:la})}_renderUnivariateAboveAndBelowRamp(e,t,i){const{sizeRampElement:r,colorRampElement:s}=YLe(e,t,"horizontal");if(!r)return null;const n=yQ(r,"full",!0,"horizontal"),o=DA(r,"above",!0,"horizontal"),a=DA(r,"below",!0,"horizontal"),l=12,c=LA(s,{width:o,height:l,rampAlignment:"horizontal",opacity:t,type:"above",effectList:i}),h=LA(s,{width:a,height:l,rampAlignment:"horizontal",opacity:t,type:"below",effectList:i}),p=AV(r,"card"),f=r.infos.map(T=>T.label),m=f.length-1,g=f.map((T,C)=>C===0||C===m?N("div",{key:C},T):null),y={display:"flex",flexDirection:"column"},x={display:"flex",flexDirection:"row"},b={marginTop:"3px",display:"flex"};jl(this.container)?b.marginRight=`${p}px`:b.marginLeft=`${p}px`;const S={width:`${n}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return N("div",{class:Pt.layerRow,key:"size-ramp-preview",styles:y},N("div",{class:this.classes(Pt.symbolContainer,Pt.sizeRampHorizontal),styles:x},r.infos.map((T,C)=>N("div",{key:C,class:Pt.symbol,bind:T.preview,afterCreate:la}))),c?N("div",{class:Pt.univariateAboveAndBelowColorRamp,styles:b,key:"color-ramp-preview"},N("div",{bind:c,afterCreate:la}),N("div",{bind:h,afterCreate:la})):null,N("div",{class:Pt.layerInfo},N("div",{class:Pt.rampLabelsContainer,styles:S},g)))}_renderUnivariateColorSizeRamp(e,t,i){const{sizeRampElement:r,colorRampElement:s}=JLe(e,"horizontal");if(!r)return null;const n=yQ(r,"full",!1,"horizontal"),o=DA(r,"full",!1,"horizontal"),a=LA(s,{width:o,height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:i}),l=AV(r,"card"),c=r.infos.length-1,h=r.infos.map((y,x)=>x===0||x===c?N("div",{key:x},y.label):null),p={display:"flex",flexDirection:"column"},f={display:"flex",flexDirection:"row"},m={marginTop:"3px",display:"flex"};jl(this.container)?m.marginRight=`${l}px`:m.marginLeft=`${l}px`;const g={width:`${n}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return N("div",{class:Pt.layerRow,key:"size-ramp-preview",styles:p},N("div",{class:this.classes(Pt.symbolContainer,Pt.sizeRampHorizontal),styles:f},r.infos.map((y,x)=>N("div",{key:x,class:Pt.symbol,bind:y.preview,afterCreate:la}))),N("div",{class:Pt.univariateAboveAndBelowColorRamp,styles:m,key:"color-ramp-preview"},N("div",{bind:a,afterCreate:la})),N("div",{class:Pt.layerInfo},N("div",{class:Pt.rampLabelsContainer,styles:g},h)))}_renderLegendForElementInfo(e,t,i,r){var o,a;const s=t.layer;if(e.type)return this._renderLegendForElement(e,t,r);const n=KLe(s,i);if(e.preview){if(!e.symbol||!e.symbol.type.includes("simple-fill")){if(!e.label)return N("div",{key:r,bind:e.preview,afterCreate:la});const A={[Pt.symbolCell]:this._hasIndicators};return N("div",{key:r,class:this.classes(Pt.layerRow,{[Pt.symbolRow]:this._hasIndicators})},N("div",{class:this.classes(A),bind:e.preview,afterCreate:la}),N("div",{class:this.classes(Pt.imageLabel,{[Pt.labelCell]:this._hasIndicators})},NA(this.messages,e.label,!1)||""))}let l=255,c=255,h=255,p=0,f=255,m=255,g=255,y=0;const x=e.symbol.color&&e.symbol.color.a,b=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;x&&(l=e.symbol.color.r,c=e.symbol.color.g,h=e.symbol.color.b,p=e.symbol.color.a*s.opacity),b&&(f=e.symbol.outline.color.r,m=e.symbol.outline.color.g,g=e.symbol.outline.color.b,y=e.symbol.outline.color.a*s.opacity);const S=(a=(o=e.symbol.color)==null?void 0:o.isBright)!=null?a:!0,T=S?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",C={background:x?`rgba(${l}, ${c}, ${h}, ${p})`:"none",color:S?"black":"white",textShadow:`-1px -1px 0 ${T},
                                              1px -1px 0 ${T},
                                              -1px 1px 0 ${T},
                                              1px 1px 0 ${T}`,border:b?`1px solid rgba(${f}, ${m}, ${g}, ${y})`:"none",filter:Z3(t.effectList)};return N("div",{key:r,class:Pt.layerRow},N("div",{class:Pt.labelElement,styles:C}," ",e.label," "))}if(e.src){const l=this._renderImage(e,s,n);return N("div",{key:r,class:Pt.layerRow},l,N("div",{class:Pt.imageLabel},e.label||""))}}_renderImage(e,t,i){const{label:r,src:s,opacity:n}=e,o={[Pt.imageryLayerStretchedImage]:i,[Pt.symbol]:!i},a={opacity:`${n!=null?n:t.opacity}`};return N("img",{alt:NA(this.messages,r,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(o),styles:a})}_renderSizeRampLines(e){const t=e.infos,i=t[0],r=t[t.length-1],s=i.symbol,n=this._hasIndicators,o=$i(i.size+i.outlineSize)*PE,a=$i(r.size+r.outlineSize)*PE,l=n?o:o+50*PE,c=n?o/2+50*PE:o,h=_Nt(s),p=vNt(s),f=document.createElement("canvas");f.width=l,f.height=c,f.style.width=f.width/PE+"px",f.style.height=f.height/PE+"px";const m=f.getContext("2d");if(n){m.beginPath();const g=0,y=0,x=l/2-a/2,b=c;m.moveTo(g,y),m.lineTo(x,b);const S=l,T=0,C=l/2+a/2,A=c;m.moveTo(S,T),m.lineTo(C,A)}else{m.beginPath();const g=0,y=c/2-a/2,x=l,b=0;m.moveTo(g,y),m.lineTo(x,b);const S=0,T=c/2+a/2,C=l,A=c;m.moveTo(S,T),m.lineTo(C,A)}return m.strokeStyle=yNt,m.stroke(),N("div",{bind:f,afterCreate:la,styles:n?{display:"flex",marginTop:`-${h?0:p?o/2:0}px`,marginBottom:`-${h?a:p?a/2:0}px`}:{display:"flex",marginRight:`-${h?0:p?o/2:0}px`,marginLeft:`-${h?0:p?a/2:0}px`}})}_renderSizeRamp(e,t){const i=e.infos,r=i[0].label,s=i[i.length-1].label;let n=i[0].preview,o=i[i.length-1].preview;const a=this._hasIndicators,l={"flex-direction":a?"column":"row-reverse"};n&&(n=n.cloneNode(!0),n.style.display="flex"),o&&(o=o.cloneNode(!0),o.style.display="flex");const c={opacity:t!=null?`${t}`:""};return N("div",{class:this.classes(Pt.layerRow,{[Pt.sizeRampRow]:a})},N("div",{class:Pt.rampLabel},a?r:s),N("div",{class:Pt.sizeRampContainer,styles:l},N("div",{bind:n,afterCreate:la,class:Pt.sizeRampPreview,styles:c}),this._renderSizeRampLines(e),N("div",{bind:o,afterCreate:la,class:Pt.sizeRampContainer,styles:c})),N("div",{class:Pt.rampLabel},a?s:r))}_renderLegendForRamp(e,t,i){const r=e.infos,s=e.type==="heatmap-ramp",n=r.length-1,o=fNt,a=n>2&&!s?pNt*n:gNt,l=a+20,c=10,h=r.slice(0).reverse();h.forEach((A,O)=>{A.offset=s?A.ratio:O/n});const p=h.length-1,f=h.length%2!=0&&h[h.length/2|0],m=f&&N("div",{class:Pt.intervalSeparatorsContainer},N("div",{class:Pt.intervalSeparator},"|"),N("div",{class:Pt.rampLabel},f.label)),g=r[r.length-1].label,y=r[0].label,x=[[{shape:{type:"path",path:`M0 ${o/2} L${c} 0 L${c} ${o} Z`},fill:h[0].color,stroke:{width:0}},{shape:{type:"rect",x:c,y:0,width:a,height:o},fill:{type:"linear",x1:c,y1:0,x2:a+c,y2:0,colors:h},stroke:{width:0}},{shape:{type:"path",path:`M${a+c} 0 L${l} ${o/2} L${a+c} ${o} Z`},fill:h[p].color,stroke:{width:0}}]],b=zEe(x,l,o),{messages:S}=this,T={filter:Z3(i),opacity:t==null?null:`${t}`},C={justifyContent:"center"};return N("div",{class:Pt.layerRow,styles:C},N("div",{class:Pt.rampLabel},s?S[g]:g),N("div",{class:Pt.symbolContainer},N("div",{styles:T},b),m),N("div",{class:Pt.rampLabel},s?S[y]:y))}};u([d()],yf.prototype,"activeLayerInfos",void 0),u([d()],yf.prototype,"headingLevel",void 0),u([d()],yf.prototype,"layout",void 0),u([d(),pr("esri/widgets/Legend/t9n/Legend")],yf.prototype,"messages",void 0),u([d(),pr("esri/t9n/common")],yf.prototype,"messagesCommon",void 0),u([d({readOnly:!0})],yf.prototype,"type",void 0),u([d()],yf.prototype,"view",void 0),u([Da()],yf.prototype,"_selectSection",null),yf=u([L("esri.widgets.Legend.styles.Card")],yf);const BH=yf,Kt={service:"esri-legend__service",label:"esri-legend__service-label",layer:"esri-legend__layer",groupLayer:"esri-legend__group-layer",groupLayerChild:"esri-legend__group-layer-child",layerTable:"esri-legend__layer-table",layerTableSizeRamp:"esri-legend__layer-table--size-ramp",layerChildTable:"esri-legend__layer-child-table",layerCaption:"esri-legend__layer-caption",layerBody:"esri-legend__layer-body",layerRow:"esri-legend__layer-row",layerCell:"esri-legend__layer-cell",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",imageryLayerStretchedImage:"esri-legend__imagery-layer-image--stretched",imageryLayerCellStretched:"esri-legend__imagery-layer-cell--stretched",imageryLayerInfoStretched:"esri-legend__imagery-layer-info--stretched",symbolContainer:"esri-legend__layer-cell esri-legend__layer-cell--symbols",symbol:"esri-legend__symbol",rampContainer:"esri-legend__ramps",sizeRamp:"esri-legend__size-ramp",colorRamp:"esri-legend__color-ramp",opacityRamp:"esri-legend__opacity-ramp",borderlessRamp:"esri-legend__borderless-ramp",rampTick:"esri-legend__ramp-tick",rampFirstTick:"esri-legend__ramp-tick-first",rampLastTick:"esri-legend__ramp-tick-last",rampLabelsContainer:"esri-legend__ramp-labels",rampLabel:"esri-legend__ramp-label",univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label",message:"esri-legend__message",header:"esri-widget__heading",hidden:"esri-hidden"},bNt="esri-legend__",wNt=24,p0e={display:"flex",alignItems:"flex-start"},GH={marginLeft:"3px"},IE={display:"table-cell",verticalAlign:"middle"};let Yx=class extends Yr{constructor(e,t){super(e,t),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,t=e&&e.toArray().map(i=>this._renderLegendForLayer(i)).filter(i=>!!i);return N("div",null,t&&t.length?t:N("div",{class:Kt.message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const t=!!e.children.length,i=`${bNt}${e.layer.uid}-version-${e.version}`,r=e.title?J0({level:this.headingLevel,class:this.classes(Kt.header,Kt.label)},e.title):null;if(t){const s=e.children.map(n=>this._renderLegendForLayer(n)).toArray();return N("div",{key:i,class:this.classes(Kt.service,Kt.groupLayer)},r,s)}{const s=e.legendElements;if(s&&!s.length)return null;const n=s.map(a=>this._renderLegendForElement(a,e.layer,e.effectList)).filter(a=>!!a);if(!n.length)return null;const o={[Kt.groupLayerChild]:!!e.parent};return N("div",{key:i,class:this.classes(Kt.service,o),tabIndex:0},r,N("div",{class:Kt.layer},n))}}_renderLegendForElement(e,t,i,r){const s=e.type==="color-ramp",n=e.type==="opacity-ramp",o=e.type==="size-ramp";let a=null;if(e.type==="symbol-table"||o){const m=e.infos.map(g=>this._renderLegendForElementInfo(g,t,i,o,e.legendType)).filter(g=>!!g);m.length&&(a=N("div",{class:Kt.layerBody},m))}else e.type==="color-ramp"||e.type==="opacity-ramp"||e.type==="heatmap-ramp"||e.type==="stretch-ramp"?a=this._renderLegendForRamp(e,t.opacity):e.type==="relationship-ramp"?a=WLe(e,this.id,t.opacity,i):e.type==="pie-chart-ramp"?a=this._renderPieChartRamp(e):e.type==="univariate-above-and-below-ramp"?a=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,i):e.type==="univariate-color-size-ramp"&&(a=this._renderUnivariateColorSizeRamp(e,t.opacity,i));if(!a)return null;const l=e.title;let c=null;if(typeof l=="string")c=l;else if(l){const m=NA(this.messages,l,s||n);c=QLe(l,s||n)&&l.title?`${l.title} (${m})`:m}const h=r?Kt.layerChildTable:Kt.layerTable,p=c?N("div",{class:Kt.layerCaption},c):null,f={[Kt.layerTableSizeRamp]:o||!r};return N("div",{class:this.classes(h,f)},p,a)}_renderPieChartRamp(e){return N("div",{bind:e.preview,afterCreate:la})}_renderUnivariateAboveAndBelowRamp(e,t,i){const{sizeRampElement:r,colorRampElement:s}=YLe(e,t);if(!r)return null;const n=DA(r,"above",!0),o=DA(r,"below",!0),a=12,l=LA(s,{width:a,height:n,rampAlignment:"vertical",opacity:t,type:"above",effectList:i}),c=LA(s,{width:a,height:o,rampAlignment:"vertical",opacity:t,type:"below",effectList:i}),h=AV(r),p=r.infos.map(C=>C.label),f=p.map((C,A)=>A===0?N("div",{key:A,class:C?l?Kt.univariateAboveAndBelowLabel:Kt.rampLabel:null},C):A===2?N("div",null):null),m=p.length-1,g=Math.floor(p.length/2),y=p.map((C,A)=>A===g||A===m?N("div",{key:A,class:C?l?Kt.univariateAboveAndBelowLabel:Kt.rampLabel:null},C):null),x={display:"table-cell",verticalAlign:"middle"},b={marginTop:`${h}px`},S={height:`${n}px`},T={height:`${o}px`};return N("div",{key:"univariate-above-and-below-ramp-preview",styles:p0e},N("div",{class:Kt.layerBody},r.infos.map((C,A)=>N("div",{class:this.classes(Kt.layerRow,Kt.sizeRamp)},N("div",{class:Kt.symbol,styles:x,bind:C.preview,afterCreate:la}),l||A%2!=0?null:N("div",{class:Kt.layerInfo},p[A])))),l?N("div",{styles:b,key:"color-ramp-preview"},N("div",{styles:GH},N("div",{styles:IE},N("div",{class:Kt.rampContainer,bind:l,afterCreate:la})),N("div",{styles:IE},N("div",{class:Kt.rampLabelsContainer,styles:S},f))),N("div",{styles:GH},N("div",{styles:IE},N("div",{class:Kt.rampContainer,bind:c,afterCreate:la})),N("div",{styles:IE},N("div",{class:Kt.rampLabelsContainer,styles:T},y)))):null)}_renderUnivariateColorSizeRamp(e,t,i){const{sizeRampElement:r,colorRampElement:s}=JLe(e);if(!r)return null;const n=AV(r),o=12,a=DA(r,"full",!1),l=LA(s,{width:o,height:a,rampAlignment:"vertical",opacity:t,type:"full",effectList:i}),c=r.infos.length-1,h=r.infos.map((g,y)=>y===0||y===c?N("div",{key:y,class:g.label?s?Kt.univariateAboveAndBelowLabel:Kt.rampLabel:null},g.label):null),p={display:"table-cell",verticalAlign:"middle"},f={marginTop:`${n}px`},m={height:`${a}px`};return N("div",{key:"univariate-above-and-below-ramp-preview",styles:p0e},N("div",{class:Kt.layerBody},r.infos.map(g=>N("div",{class:this.classes(Kt.layerRow,Kt.sizeRamp)},N("div",{class:Kt.symbol,styles:p,bind:g.preview,afterCreate:la})))),N("div",{styles:f,key:"color-ramp-preview"},N("div",{styles:GH},N("div",{styles:IE},N("div",{class:Kt.rampContainer,bind:l,afterCreate:la})),N("div",{styles:IE},N("div",{class:Kt.rampLabelsContainer,styles:m},h)))))}_renderLegendForRamp(e,t){const i=e.infos,r=e.type==="opacity-ramp",s=e.type==="heatmap-ramp",n=e.type==="stretch-ramp",o=e.preview,a=r?Kt.opacityRamp:"";o.className=`${Kt.colorRamp} ${a}`,t!=null&&(o.style.opacity=t.toString());const l=i.map(p=>N("div",{class:p.label?Kt.rampLabel:null},s?this.messages[p.label]||p.label:n?this._getStretchStopLabel(p):p.label)),c={width:`${wNt}px`},h={height:o.style.height};return N("div",{class:Kt.layerRow},N("div",{class:Kt.symbolContainer,styles:c},N("div",{class:Kt.rampContainer,bind:o,afterCreate:la})),N("div",{class:Kt.layerInfo},N("div",{class:Kt.rampLabelsContainer,styles:h},l)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+(typeof e.value=="string"?e.value:Wl(e.value,{style:"decimal",notation:e.value.toString().includes("e")?"scientific":"standard"})):""}_renderLegendForElementInfo(e,t,i,r,s){if(e.type)return this._renderLegendForElement(e,t,i,!0);let n=null;const o=KLe(t,s);if(e.preview?n=N("div",{class:Kt.symbol,bind:e.preview,afterCreate:la}):e.src&&(n=this._renderImage(e,t,o)),!n)return null;const a={[Kt.imageryLayerInfoStretched]:o},l={[Kt.imageryLayerInfoStretched]:o,[Kt.sizeRamp]:!o&&r};return N("div",{class:Kt.layerRow},N("div",{class:this.classes(Kt.symbolContainer,l)},n),N("div",{class:this.classes(Kt.layerInfo,a)},NA(this.messages,e.label,!1)||""))}_renderImage(e,t,i){const{label:r,src:s,opacity:n}=e,o={[Kt.imageryLayerStretchedImage]:i,[Kt.symbol]:!i},a={opacity:`${n!=null?n:t.opacity}`};return N("img",{alt:NA(this.messages,r,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(o),styles:a})}};u([d()],Yx.prototype,"activeLayerInfos",void 0),u([d()],Yx.prototype,"headingLevel",void 0),u([d(),pr("esri/widgets/Legend/t9n/Legend")],Yx.prototype,"messages",void 0),u([d({readOnly:!0})],Yx.prototype,"type",void 0),Yx=u([L("esri.widgets.Legend.styles.Classic")],Yx);const $E=Yx,N4={base:"esri-legend",widget:"esri-widget",panel:"esri-widget--panel",widgetIcon:"esri-icon-layer-list"};let Oa=class extends Yr{constructor(e,t){super(e,t),this._handles=new Nt,this.activeLayerInfos=null,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.headingLevel=3,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.iconClass=N4.widgetIcon,this.label=void 0,this.layerInfos=null,this.messages=null,this.style=new $E,this.view=null,this.viewModel=new oNt}initialize(){this.own([os(()=>this.view,"resize",()=>this.scheduleRender()),os(()=>this.activeLayerInfos,"change",()=>this._refreshActiveLayerInfos(this.activeLayerInfos)),re(()=>this.headingLevel,e=>{const{style:t}=this;t&&(t.headingLevel=e)}),re(()=>this.style,(e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,e.type==="card"&&(e.view=this.view),e.headingLevel=this.headingLevel)},Et)])}destroy(){this._handles=We(this._handles)}castStyle(e){if(e instanceof BH||e instanceof $E)return e;if(typeof e=="string")return e==="card"?new BH:new $E;if(e&&typeof e.type=="string"){const t=F({},e);return delete t.type,new(e.type==="card"?BH:$E)(t)}return new $E}render(){return N("div",{class:this.classes(N4.base,N4.widget,this.style instanceof $E?N4.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach(t=>this._renderOnActiveLayerInfoChange(t)),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const t=re(()=>e.version,()=>this.scheduleRender());this._handles.add(t,`version_${e.layer.uid}`);const i=os(()=>e.children,"change",()=>e.children.forEach(r=>this._renderOnActiveLayerInfoChange(r)),Et);this._handles.add(i,`children_${e.layer.uid}`),e.children.forEach(r=>this._renderOnActiveLayerInfoChange(r))}};u([ze("viewModel.activeLayerInfos")],Oa.prototype,"activeLayerInfos",void 0),u([ze("viewModel.basemapLegendVisible")],Oa.prototype,"basemapLegendVisible",void 0),u([ze("viewModel.groundLegendVisible")],Oa.prototype,"groundLegendVisible",void 0),u([d()],Oa.prototype,"headingLevel",void 0),u([ze("viewModel.hideLayersNotInCurrentView")],Oa.prototype,"hideLayersNotInCurrentView",void 0),u([ze("viewModel.keepCacheOnDestroy")],Oa.prototype,"keepCacheOnDestroy",void 0),u([ze("viewModel.respectLayerVisibility")],Oa.prototype,"respectLayerVisibility",void 0),u([d()],Oa.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Oa.prototype,"label",void 0),u([ze("viewModel.layerInfos")],Oa.prototype,"layerInfos",void 0),u([d(),pr("esri/widgets/Legend/t9n/Legend")],Oa.prototype,"messages",void 0),u([d()],Oa.prototype,"style",void 0),u([Jt("style")],Oa.prototype,"castStyle",null),u([ze("viewModel.view")],Oa.prototype,"view",void 0),u([d()],Oa.prototype,"viewModel",void 0),Oa=u([L("esri.widgets.Legend")],Oa);const vUt=Oa;export{Ui as $,Uo as A,u as B,TLt as C,d as D,L as E,Ee as F,wp as G,_ as H,QS as I,nO as J,fz as K,lrt as L,M,ui as N,ZV as O,gte as P,We as Q,_oe as R,pL as S,qkt as T,hUt as U,yv as V,s3 as W,gM as X,SQe as Y,as as Z,re as _,eB as a,Bh as a$,j5t as a0,H5t as a1,_S as a2,Zpt as a3,Tv as a4,Ou as a5,nt as a6,fi as a7,Fo as a8,N5t as a9,mK as aA,pe as aB,qg as aC,id as aD,$ as aE,In as aF,wv as aG,yi as aH,hM as aI,ai as aJ,B5t as aK,lM as aL,V5t as aM,tkt as aN,vre as aO,z5t as aP,U5t as aQ,Jn as aR,os as aS,bO as aT,Ot as aU,hn as aV,W as aW,aRe as aX,Us as aY,Mn as aZ,DNt as a_,W5t as aa,KKe as ab,eet as ac,tet as ad,cEe as ae,Lze as af,a5t as ag,cs as ah,L5t as ai,v8e as aj,Ga as ak,ey as al,Q1t as am,jft as an,Hu as ao,qt as ap,MQ as aq,ye as ar,gFt as as,ve as at,cd as au,Vo as av,rd as aw,X2e as ax,Ye as ay,Nr as az,aB as b,Pxe as b$,da as b0,hv as b1,Wr as b2,Df as b3,gv as b4,he as b5,Zn as b6,we as b7,fe as b8,dt as b9,yU as bA,o1e as bB,_bt as bC,Ri as bD,nUt as bE,INt as bF,X0e as bG,W0e as bH,ji as bI,rt as bJ,$e as bK,Ii as bL,Fr as bM,zf as bN,Vs as bO,Zt as bP,mt as bQ,Mr as bR,uV as bS,tt as bT,Ywe as bU,U1 as bV,h7e as bW,Oje as bX,Bd as bY,QOt as bZ,t4t as b_,Lh as ba,dN as bb,$5t as bc,rae as bd,M5t as be,qft as bf,oB as bg,Jg as bh,ANt as bi,KS as bj,K1t as bk,nre as bl,SLe as bm,sm as bn,qn as bo,Zb as bp,Qt as bq,VPe as br,yFt as bs,yUt as bt,$r as bu,mB as bv,p5t as bw,pv as bx,n1e as by,GT as bz,PK as c,nB as c$,e4t as c0,QFt as c1,XOt as c2,KFt as c3,ue as c4,rB as c5,Nee as c6,zbe as c7,J4t as c8,yle as c9,jg as cA,qKe as cB,WKe as cC,ZKe as cD,qWe as cE,HWe as cF,Jye as cG,Bo as cH,hee as cI,H4e as cJ,JFt as cK,uM as cL,bv as cM,sKe as cN,TFt as cO,RC as cP,KA as cQ,Tp as cR,fEe as cS,Fa as cT,Wf as cU,Irt as cV,y5t as cW,Bxt as cX,ckt as cY,Bre as cZ,pm as c_,wZe as ca,NTe as cb,jWe as cc,bFt as cd,qVe as ce,N7e as cf,UTe as cg,uZ as ch,WWe as ci,VZ as cj,GB as ck,Bc as cl,tO as cm,$Z as cn,pn as co,eN as cp,Ph as cq,oZe as cr,VT as cs,Ti as ct,Zg as cu,UV as cv,JQe as cw,py as cx,Bu as cy,at as cz,LK as d,aie as d$,$n as d0,zh as d1,nm as d2,vu as d3,hL as d4,vs as d5,P as d6,jT as d7,IB as d8,dr as d9,Rt as dA,my as dB,ke as dC,Q as dD,Ir as dE,al as dF,Sr as dG,Lr as dH,Er as dI,lr as dJ,ri as dK,Gv as dL,c6 as dM,ew as dN,jc as dO,I6 as dP,xi as dQ,ny as dR,Hb as dS,iw as dT,D6 as dU,vy as dV,$6 as dW,M6 as dX,DS as dY,Y6 as dZ,tgt as d_,va as da,an as db,mi as dc,wi as dd,En as de,$t as df,_s as dg,FM as dh,f5t as di,i5 as dj,HS as dk,Ewt as dl,mr as dm,Kh as dn,Ua as dp,Di as dq,pwe as dr,E as ds,Qs as dt,ld as du,oi as dv,lt as dw,oe as dx,qz as dy,gy as dz,RK as e,UEt as e$,AO as e0,XOe as e1,cn as e2,gB as e3,wt as e4,G8 as e5,Z2t as e6,E_e as e7,XNt as e8,uze as e9,qh as eA,h1e as eB,Pu as eC,jv as eD,sIe as eE,PV as eF,aS as eG,X6e as eH,Xe as eI,Y0 as eJ,sGe as eK,Ne as eL,xs as eM,Olt as eN,Fkt as eO,bkt as eP,kkt as eQ,Aie as eR,Rb as eS,rse as eT,Ikt as eU,Mkt as eV,Okt as eW,Akt as eX,iZ as eY,rOe as eZ,Xu as e_,tEt as ea,oKe as eb,RJ as ec,td as ed,Uc as ee,zit as ef,_ce as eg,De as eh,Zr as ei,n5t as ej,Lte as ek,SLt as el,Nte as em,LLt as en,yT as eo,zd as ep,AI as eq,OI as er,Y2e as es,yte as et,RL as eu,ZS as ev,bt as ew,pEe as ex,QV as ey,Toe as ez,dL as f,rft as f$,Ckt as f0,O2t as f1,UO as f2,Nkt as f3,R2t as f4,RFt as f5,Lme as f6,OA as f7,ZT as f8,As as f9,kG as fA,He as fB,Qi as fC,si as fD,eFt as fE,yB as fF,Ue as fG,zkt as fH,Ukt as fI,qu as fJ,br as fK,Vkt as fL,v5t as fM,kA as fN,Rr as fO,A2t as fP,f4t as fQ,pkt as fR,Wh as fS,kV as fT,BNt as fU,C$ as fV,P3 as fW,ud as fX,k5t as fY,HAe as fZ,Lf as f_,H6e as fa,Cp as fb,nv as fc,LFt as fd,zi as fe,Hn as ff,rm as fg,Tkt as fh,C8e as fi,W2t as fj,zT as fk,Dkt as fl,_r as fm,sO as fn,Lkt as fo,Xt as fp,eEt as fq,b2e as fr,w2e as fs,F5t as ft,$kt as fu,Ekt as fv,Skt as fw,mL as fx,V3 as fy,uK as fz,WOt as g,gKe as g$,uEt as g0,hEt as g1,_kt as g2,rb as g3,rGe as g4,uo as g5,Pr as g6,Pe as g7,Vl as g8,xe as g9,RH as gA,GNt as gB,ja as gC,H$e as gD,Iee as gE,xqe as gF,PH as gG,Nye as gH,aUt as gI,XA as gJ,SV as gK,ZM as gL,_a as gM,oUt as gN,SI as gO,sUt as gP,bZe as gQ,WNt as gR,Ase as gS,tUt as gT,iUt as gU,rUt as gV,hO as gW,dO as gX,GTe as gY,R5t as gZ,aKe as g_,Xg as ga,Z5 as gb,Sg as gc,iEt as gd,Uue as ge,xkt as gf,woe as gg,m5t as gh,Owt as gi,G0e as gj,p4t as gk,Wl as gl,D8e as gm,N8e as gn,ULt as go,it as gp,Ce as gq,w8e as gr,OQ as gs,Awe as gt,hUe as gu,vUe as gv,BT as gw,QTe as gx,b_e as gy,WQ as gz,W1 as h,wre as h$,B5e as h0,gUt as h1,tFt as h2,YNt as h3,QNt as h4,JNt as h5,KNt as h6,I3 as h7,mp as h8,cze as h9,kt as hA,gt as hB,ss as hC,Yl as hD,_t as hE,Xl as hF,ht as hG,wr as hH,ka as hI,xv as hJ,Bs as hK,Z7 as hL,Li as hM,ty as hN,Qb as hO,O6 as hP,T5t as hQ,Ke as hR,$i as hS,swe as hT,DFt as hU,Qwe as hV,K4t as hW,jV as hX,M4t as hY,ONt as hZ,Go as h_,DOe as ha,C5t as hb,Hpt as hc,P5t as hd,hK as he,hFt as hf,$Nt as hg,ukt as hh,lFt as hi,JV as hj,rZe as hk,I5t as hl,ms as hm,HTe as hn,xte as ho,Kb as hp,Pgt as hq,Nn as hr,ed as hs,Wt as ht,pg as hu,zs as hv,Yi as hw,At as hx,Qe as hy,Mt as hz,ju as i,S5t as i$,kc as i0,yr as i1,z4 as i2,__e as i3,VNt as i4,Ig as i5,D4t as i6,r5t as i7,R1e as i8,Mb as i9,OT as iA,mkt as iB,gkt as iC,pFt as iD,Jze as iE,Ux as iF,fkt as iG,Xz as iH,Ib as iI,Xr as iJ,tv as iK,Lc as iL,Zu as iM,Bv as iN,ya as iO,St as iP,vFt as iQ,_L as iR,Xi as iS,qi as iT,ll as iU,l1e as iV,ykt as iW,vkt as iX,fK as iY,Twe as iZ,dB as i_,tJ as ia,Pv as ib,Wn as ic,YFt as id,vLt as ie,n0e as ig,_te as ih,qS as ii,xb as ij,goe as ik,fWe as il,pWe as im,_h as io,OFt as ip,zNt as iq,fb as ir,X0 as is,Gg as it,KD as iu,eK as iv,KQ as iw,tK as ix,FTe as iy,HNt as iz,Le as j,Jt as j$,Ln as j0,Ci as j1,Wi as j2,ekt as j3,Rkt as j4,Pkt as j5,ITe as j6,NP as j7,$we as j8,Cve as j9,kW as jA,VW as jB,IU as jC,g8e as jD,YT as jE,pbe as jF,wg as jG,nkt as jH,lkt as jI,nIe as jJ,ame as jK,skt as jL,okt as jM,rkt as jN,d3 as jO,b5 as jP,Oxt as jQ,Rp as jR,TNt as jS,gie as jT,zl as jU,nme as jV,oxt as jW,axt as jX,h5t as jY,PL as jZ,u5t as j_,Tz as ja,ED as jb,dkt as jc,Cme as jd,hkt as je,ml as jf,gA as jg,zHe as jh,bS as ji,Wu as jj,bu as jk,uv as jl,zV as jm,fB as jn,sEt as jo,wkt as jp,oUe as jq,YIe as jr,Ze as js,j0e as jt,s5 as ju,nS as jv,ATt as jw,xOt as jx,UW as jy,Ws as jz,jkt as k,sS as k$,un as k0,ep as k1,n_e as k2,R$ as k3,x4t as k4,Vc as k5,iz as k6,QGe as k7,xse as k8,S8e as k9,R6e as kA,O6e as kB,VK as kC,UK as kD,hbe as kE,FPt as kF,Ss as kG,pM as kH,ko as kI,er as kJ,F0 as kK,awe as kL,po as kM,Pn as kN,Tc as kO,RV as kP,wb as kQ,Rv as kR,iee as kS,iM as kT,Or as kU,u$t as kV,$o as kW,ys as kX,hb as kY,bB as kZ,WFt as k_,qFt as ka,T8e as kb,Re as kc,Tt as kd,fS as ke,Jh as kf,$Ft as kg,jFt as kh,fGe as ki,a2 as kj,dq as kk,ghe as kl,Yt as km,Ag as kn,mbe as ko,v6e as kp,lA as kq,y8e as kr,Ei as ks,ba as kt,rs as ku,S3 as kv,Z5t as kw,L_e as kx,SNt as ky,tr as kz,cK as l,Do as l$,XFt as l0,rst as l1,ast as l2,Uae as l3,d4t as l4,Kg as l5,i4t as l6,o4t as l7,OB as l8,r4t as l9,Ic as lA,sl as lB,yGe as lC,ZFt as lD,$M as lE,ln as lF,Hv as lG,VV as lH,tp as lI,ooe as lJ,Xkt as lK,d$t as lL,tMt as lM,iLe as lN,Rse as lO,A$t as lP,ug as lQ,zA as lR,Jpt as lS,VA as lT,g5t as lU,_T as lV,zu as lW,Dpt as lX,AFt as lY,CFt as lZ,dy as l_,a4t as la,s4t as lb,l4t as lc,n4t as ld,c4t as le,u4t as lf,h4t as lg,FW as lh,$h as li,Oc as lj,Yte as lk,lUt as ll,a6 as lm,Rze as ln,Ts as lo,Je as lp,Rn as lq,HFt as lr,mGe as ls,Hl as lt,kre as lu,mwt as lv,YC as lw,aJ as lx,US as ly,MFt as lz,Hkt as m,nr as m$,xr as m0,Iue as m1,LQ as m2,L0 as m3,YAe as m4,t2 as m5,tee as m6,XT as m7,nFt as m8,VFt as m9,Rf as mA,bp as mB,s$ as mC,WEe as mD,Lse as mE,dm as mF,Ise as mG,Z8 as mH,Nie as mI,Tct as mJ,x5t as mK,b5t as mL,w5t as mM,zFt as mN,lOe as mO,PM as mP,FA as mQ,tre as mR,uB as mS,Vu as mT,foe as mU,jA as mV,ad as mW,J6 as mX,ws as mY,Zl as mZ,Gl as m_,uFt as ma,Pue as mb,hy as mc,ZK as md,Wbe as me,Yg as mf,ls as mg,ry as mh,Dt as mi,Va as mj,L6 as mk,R6 as ml,Ct as mm,fr as mn,fFt as mo,wfe as mp,eee as mq,Ks as mr,Ov as ms,uUt as mt,hm as mu,aFt as mv,NFt as mw,n$e as mx,Wkt as my,GFt as mz,v$e as n,F3 as n$,fo as n0,eOe as n1,kFt as n2,sdt as n3,od as n4,jh as n5,X8e as n6,um as n7,W8 as n8,em as n9,vv as nA,see as nB,sd as nC,V6e as nD,Dg as nE,Obe as nF,JA as nG,tGe as nH,Ype as nI,Snt as nJ,FFt as nK,B3 as nL,QA as nM,oFt as nN,iut as nO,nee as nP,DGe as nQ,xB as nR,pr as nS,Yr as nT,N as nU,xc as nV,AT as nW,YU as nX,Es as nY,eve as nZ,cA as n_,eLe as na,H8 as nb,B8 as nc,KPt as nd,ENt as ne,z4e as nf,BFt as ng,N8 as nh,NU as ni,pOt as nj,fOt as nk,Gkt as nl,Bkt as nm,wQ as nn,UPt as no,RQ as np,cFt as nq,x1 as nr,Rue as ns,jd as nt,Zkt as nu,eO as nv,ikt as nw,Jb as nx,DV as ny,i2 as nz,DIt as o,cJe as o$,v1e as o0,wFt as o1,jS as o2,Eb as o3,or as o4,Zf as o5,iB as o6,QM as o7,SFt as o8,g4t as o9,lJe as oA,aJe as oB,vS as oC,Ih as oD,n2e as oE,WZe as oF,tJe as oG,sJe as oH,ei as oI,s2e as oJ,ul as oK,vJe as oL,pJe as oM,s2 as oN,GV as oO,bJe as oP,wJe as oQ,xJe as oR,rte as oS,SJe as oT,TJe as oU,EJe as oV,$1e as oW,J3 as oX,JYe as oY,gJe as oZ,fJe as o_,y4t as oa,mLt as ob,Tte as oc,Ate as od,Mte as oe,OL as of,Mxt as og,cl as oh,e2 as oi,Ete as oj,Sc as ok,Ec as ol,rl as om,Gu as on,fy as oo,S5 as op,Q3 as oq,nte as or,az as os,xn as ot,_Je as ou,db as ov,kl as ow,yJe as ox,Ep as oy,dJe as oz,fte as p,B0 as p$,LJe as p0,PJe as p1,RJe as p2,W4t as p3,IJe as p4,$Je as p5,uJe as p6,hJe as p7,mJe as p8,MJe as p9,uq as pA,Iu as pB,fn as pC,nd as pD,WL as pE,Dbe as pF,Xn as pG,a8 as pH,r8e as pI,J5t as pJ,vM as pK,jb as pL,X5t as pM,Q5t as pN,Y5t as pO,$0t as pP,F0t as pQ,L0t as pR,D0t as pS,N0t as pT,WCe as pU,tie as pV,ZCe as pW,Lv as pX,A4t as pY,$4t as pZ,I4t as p_,qee as pa,Y4t as pb,nJe as pc,oJe as pd,rJe as pe,iJe as pf,DC as pg,E5t as ph,Qke as pi,A3t as pj,t5t as pk,yQe as pl,U$e as pm,Iye as pn,iQ as po,S3t as pp,E3t as pq,C3t as pr,V$e as ps,R3t as pt,P3t as pu,B$e as pv,YYe as pw,YUe as px,bT as py,LU as pz,mUt as q,sue as q$,oEe as q0,cWe as q1,KTe as q2,R4t as q3,O4t as q4,voe as q5,iFt as q6,rFt as q7,sFt as q8,k4e as q9,Eu as qA,P4t as qB,BB as qC,UIe as qD,Ki as qE,Sv as qF,Xh as qG,Z1 as qH,zte as qI,Vf as qJ,cse as qK,UFt as qL,hGe as qM,kNt as qN,FNt as qO,CVe as qP,TK as qQ,akt as qR,Su as qS,IQ as qT,ome as qU,mZ as qV,LD as qW,zG as qX,rVe as qY,FIe as qZ,KSt as q_,O5t as qa,A5t as qb,Dc as qc,GWe as qd,TQe as qe,VUe as qf,CWe as qg,N4t as qh,FWe as qi,ole as qj,jTe as qk,Pde as ql,L4t as qm,HBe as qn,i5t as qo,mIt as qp,X3 as qq,p9 as qr,f9 as qs,sU as qt,U4e as qu,RNt as qv,B4e as qw,Nh as qx,C4t as qy,PNt as qz,vUt as r,BV as r$,Au as r0,wEe as r1,Jkt as r2,gL as r3,Ykt as r4,xie as r5,Iyt as r6,Pyt as r7,s$e as r8,jo as r9,Qot as rA,yat as rB,Aat as rC,Ydt as rD,Wz as rE,Lgt as rF,Ugt as rG,Sgt as rH,lo as rI,ma as rJ,dTt as rK,g3e as rL,TCt as rM,XS as rN,hl as rO,dl as rP,Krt as rQ,Ak as rR,dSt as rS,$Ee as rT,hnt as rU,qNt as rV,xUe as rW,GIt as rX,w$e as rY,D6e as rZ,jl as r_,Dqe as ra,q3 as rb,sY as rc,c5t as rd,IL as re,Nqe as rf,Cqe as rg,E4t as rh,w4t as ri,b4t as rj,v4t as rk,IC as rl,Mqe as rm,_4t as rn,Eqe as ro,Sqe as rp,cL as rq,ryt as rr,T4t as rs,S4t as rt,Tst as ru,Bnt as rv,pAe as rw,Eot as rx,Zot as ry,vie as rz,YLt as s,kwe as s$,Qkt as s0,IFt as s1,PFt as s2,T$e as s3,S$e as s4,cUt as s5,G5t as s6,kPt as s7,UNt as s8,mFt as s9,xgt as sA,mTt as sB,fTt as sC,v8 as sD,gTt as sE,Jz as sF,Amt as sG,o3e as sH,qEt as sI,nse as sJ,ZCt as sK,v3e as sL,JCt as sM,_3e as sN,KCt as sO,b3e as sP,pAt as sQ,R8 as sR,wAt as sS,RAt as sT,Qmt as sU,mAt as sV,qAt as sW,Wyt as sX,U0t as sY,t1t as sZ,S1t as s_,pK as sa,d5t as sb,BIt as sc,Hr as sd,QK as se,zB as sf,SGe as sg,Kkt as sh,T4 as si,Sb as sj,J8e as sk,f4e as sl,Xrt as sm,Yrt as sn,U8 as so,l5t as sp,eUt as sq,bye as sr,ts as ss,NBe as st,jNt as su,wUe as sv,Qr as sw,Aot as sx,Dft as sy,m4t as sz,vCe as t,Kqe as t$,PGe as t0,il as t1,JEe as t2,drt as t3,v1t as t4,wK as t5,SK as t6,yd as t7,I0t as t8,q5t as t9,lKe as tA,PKe as tB,fU as tC,S_e as tD,oet as tE,QB as tF,_O as tG,pz as tH,U5 as tI,ML as tJ,J2e as tK,Ite as tL,$te as tM,ute as tN,ze as tO,tq as tP,d9 as tQ,fke as tR,fet as tS,yO as tT,Tr as tU,d2e as tV,u2e as tW,h2e as tX,g2e as tY,Qqe as tZ,KJe as t_,Ste as ta,KB as tb,art as tc,nrt as td,irt as te,gue as tf,eCe as tg,ho as th,nEe as ti,J_e as tj,AB as tk,ILt as tl,wte as tm,JM as tn,DLt as to,o5t as tp,K2e as tq,sB as tr,Ab as ts,R3 as tt,Cte as tu,Q2e as tv,qc as tw,lB as tx,wKe as ty,Z2e as tz,mCe as u,mz as u$,x2e as u0,O2e as u1,uz as u2,NNt as u3,c2e as u4,hz as u5,nKe as u6,dLt as u7,gf as u8,fv as u9,s5t as uA,jke as uB,Qne as uC,G as uD,EFt as uE,q4t as uF,Qle as uG,k4t as uH,Jle as uI,AJe as uJ,H4t as uK,X4t as uL,Z4t as uM,z4t as uN,U4t as uO,V4t as uP,B4t as uQ,j4t as uR,eJe as uS,ece as uT,G4t as uU,CJe as uV,XB as uW,a2e as uX,l2e as uY,e5t as uZ,btt as u_,ZNt as ua,dn as ub,LNt as uc,dS as ud,dFt as ue,xLt as uf,gLt as ug,Hh as uh,st as ui,dUt as uj,Y8 as uk,Wg as ul,Bg as um,q_e as un,S1e as uo,MNt as up,N2e as uq,vKe as ur,yKe as us,KM as ut,rbe as uu,Nu as uv,Xf as uw,_Ft as ux,M1e as uy,mKe as uz,Ha as v,pUt as v$,nT as v0,Mx as v1,r6 as v2,i6 as v3,gtt as v4,F4t as v5,Bte as v6,L2e as v7,RQe as v8,mte as v9,CNt as vA,mre as vB,dvt as vC,gPe as vD,ovt as vE,bPe as vF,vPe as vG,hvt as vH,dJ as vI,_Pe as vJ,Nb as vK,avt as vL,Db as vM,eJ as vN,OS as vO,Yft as vP,zvt as vQ,Uvt as vR,kvt as vS,_5t as vT,k1e as vU,Q4t as vV,Ret as vW,D5t as vX,K5t as vY,_ye as vZ,Ese as v_,D2e as va,OQe as vb,rvt as vc,hJ as vd,YKe as ve,JKe as vf,QKe as vg,hte as vh,i$t as vi,uy as vj,xnt as vk,V8e as vl,U8e as vm,Cg as vn,uPe as vo,$Q as vp,dnt as vq,xFt as vr,wPe as vs,TPe as vt,l3 as vu,pT as vv,Ho as vw,Hc as vx,Mp as vy,nE as vz,Lg as w,fUt as w0,yz as x,Nt as y,Et as z};
