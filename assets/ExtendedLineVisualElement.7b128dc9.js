import{mG as A,lY as P,lZ as v,v as G,aC as p,jq as M,jP as E,ks as T,lu as W,Y as S,F as i,d1 as L,bg as F,az as c,g7 as $,iX as f,ly as w,kt as y,fY as R,I as m,lt as N,aw as O,m5 as x,mH as I,iS as V,mI as Y,mJ as U,mK as j,d4 as H,mL as u}from"./vendor.508dc62e.js";import{_ as k}from"./VisualElementResources.d0f6f93b.js";import{n as X}from"./Object3DVisualElement.0959ced1.js";class Z extends X{constructor(e){super(e),this._ray=v(),this._externalResources=null,this._handles=new G,this._isWorldDown=!1,this._start=p(),this._end=M(1,0,0),this._width=1,this._color=E(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=E(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=a.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=T.OccludeAndTransparent,this._fadedExtensions=D,this.applyProps(e)}createExternalResources(){const e=new W(this.materialParameters);this._handles.add(S(()=>this.view.state.camera,()=>{this._updateGeometry()}));const s=new k({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:s}}destroyExternalResources(){i(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(e){i(this._externalResources)&&e(this._externalResources.material)}createGeometries(e){const s=[p(),p()],t=this.extensionType===a.FADED;t&&s.push(p(),p());const r=t?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,n=L.createPolylineGeometry(s,null,r);e.addGeometry(n,F(this._externalResources).material),this._updateVertices(e)}updateVisibility(e){super.updateVisibility(e),i(this._externalResources)&&(this._externalResources.laserline.visible=e)}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,c(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),$(this._end,e,this._end),f(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,w(this._start,e)||(c(this._start,e),f(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,w(this._end,e)||(c(this._end,e),f(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){y(e,this._color)||(R(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){y(e,this._innerColor)||(R(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const s=i(e)!==i(this._stipplePattern);this._stipplePattern=e,s?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(m(e)||m(this._stippleOffColor)||!y(e,this._stippleOffColor))&&(this._stippleOffColor=i(e)?N(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this._updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&i(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,i(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,i(e)&&(this._externalResources.laserline.style=e))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,i(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=O(e,D),this.recreateGeometry()}_updateMaterial(){m(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateGeometry(){i(this.object)&&this._updateVertices(this.object)}_updateVertices(e){const s=this._extensionType===a.FADED?this._updateLineSegmentFinite(b):this._updateLineSegmentInfinite(this._extensionType,b);this._updateVertexAttributes(e,s),i(this._externalResources)&&(this._externalResources.laserline.intersectsLine=s)}_updateLineSegmentFinite(e){return x(this._start,this._end,e)}_updateLineSegmentInfinite(e,s){const t=this.view.state.camera;switch(I(this._ray,o),e){case a.LINE:o.c0=-Number.MAX_VALUE;break;case a.RAY:case a.GROUND_RAY:{const h=this._ray.origin,_=O(this.view.elevationProvider.getElevation(h[0],h[1],h[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),g=this.view.renderCoordsHelper.getAltitude(h);this._isWorldDown&&g<_&&V(o.ray.direction,o.ray.direction),this._extensionType===a.GROUND_RAY&&_!=null&&(o.c1=Math.abs(g-_));break}}if(!Y(t.frustum,o))return x(this._start,this._end,s);const r=U(o,d),n=j(o,q);return x(r,n,s)}_updateVertexAttributes(e,s){const t=e.geometries[0].getMutableAttribute(H.POSITION).data;if(this.extensionType===a.FADED){const r=u(s,-this.fadedExtensions.start,d);t[0]=r[0],t[1]=r[1],t[2]=r[2];const n=u(s,0,d);t[3]=n[0],t[4]=n[1],t[5]=n[2];const h=u(s,1,d);t[6]=h[0],t[7]=h[1],t[8]=h[2];const _=u(s,1+this.fadedExtensions.end,d);t[9]=_[0],t[10]=_[1],t[11]=_[2]}else{const r=u(s,0,d);t[0]=r[0],t[1]=r[1],t[2]=r[2];const n=u(s,1,d);t[3]=n[0],t[4]=n[1],t[5]=n[2]}e.geometryVertexAttrsUpdated(e.geometryRecords[0])}}const o=A(),d=p(),q=p(),b=P();var a;(function(l){l[l.LINE=0]="LINE",l[l.RAY=1]="RAY",l[l.GROUND_RAY=2]="GROUND_RAY",l[l.FADED=3]="FADED"})(a||(a={}));const C=1/3,D={start:C,end:C};export{Z as G,a as V};
